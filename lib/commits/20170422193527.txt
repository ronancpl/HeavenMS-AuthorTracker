{"fetchDate": "2019-12-19", "content": [{"sha": "828a8a02a2d1496722ac85c529028a33bfa134fb", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ODI4YThhMDJhMmQxNDk2NzIyYWM4NWM1MjkwMjhhMzNiZmExMzRmYg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-22T19:35:27Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-22T19:35:27Z"}, "message": "Implemented EllinPQ + some bug fixes\n\nImplemented EllinPQ, adjusted several drop rates and data, fixes some\nbugs at quests at client-side.", "tree": {"sha": "6e2efff6112735067d8a233315e8b9fa4698d808", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/6e2efff6112735067d8a233315e8b9fa4698d808"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/828a8a02a2d1496722ac85c529028a33bfa134fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/828a8a02a2d1496722ac85c529028a33bfa134fb", "html_url": "https://github.com/ronancpl/HeavenMS/commit/828a8a02a2d1496722ac85c529028a33bfa134fb", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/828a8a02a2d1496722ac85c529028a33bfa134fb/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "72ef73a949432b7d938422f7473b44b3af4370e2", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/72ef73a949432b7d938422f7473b44b3af4370e2", "html_url": "https://github.com/ronancpl/HeavenMS/commit/72ef73a949432b7d938422f7473b44b3af4370e2"}], "stats": {"total": 1125, "additions": 746, "deletions": 379}, "files": [{"sha": "0d5ee42075389dad8e1e11d363f1cf45a09dd7fa", "filename": "README.txt", "status": "modified", "additions": 25, "deletions": 68, "changes": 93, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/README.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/README.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.txt?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -2,18 +2,11 @@ MapleSolaxiaV2\n \n Freelance developer: Ronan C. P. Lana\n \n-Credits are to be given to the original MapleSolaxia staff and other colaborators, as just some minor\n-changes/patches on the game were applied by myself, in which some of them diverged from the original v83\n-patch contents.\n+Credits are to be given to the original MapleSolaxia staff and other colaborators, as just some minor changes/patches on the game were applied by myself, in which some of them diverged from the original v83 patch contents.\n \n-This is a NetBeans 8.0.2 Project. This means that it's easier to install the project via opening the server\n-project folder inside NetBeans' IDE. Once installed, build this project on your machine and run the server using\n-the \"launch.bat\" application.\n+This is a NetBeans 8.0.2 Project. This means that it's easier to install the project via opening the server project folder inside NetBeans' IDE. Once installed, build this project on your machine and run the server using the \"launch.bat\" application.\n \n-In this project, many gameplay-wise issues generated from either the original WZ files and the server sources\n-have been partially or completely solved. From now on, considering the use of some of this system's edited WZ\n-and server-side files should be a great asset for new private server instances. My opinion, though! Refer to\n-\"README_wzchanges.txt\" for more information on what have been changed from Nexon's v83 WZ files.\n+In this project, many gameplay-wise issues generated from either the original WZ files and the server sources have been partially or completely solved. From now on, considering the use of some of this system's edited WZ and server-side files should be a great asset for new private server instances. My opinion, though! Refer to \"README_wzchanges.txt\" for more information on what have been changed from Nexon's v83 WZ files.\n \n ---- Download items ----\n \n@@ -22,8 +15,7 @@ Client files & general tools: https://drive.google.com/drive/folders/0BzDsHSr-0V\n \n ---- Preparing the ambient ----\n \n-The following link teaches on how to install a MapleStory v83 private server, however IT DIFFERS on what is\n-used here: http://forum.ragezone.com/f428/maplestory-private-server-v83-741739/\n+The following link teaches on how to install a MapleStory v83 private server, however IT DIFFERS on what is used here: http://forum.ragezone.com/f428/maplestory-private-server-v83-741739/\n \n Use that link ONLY AS AN ORIENTATION on where here things become ambiguous.\n \n@@ -56,9 +48,7 @@ The Wamp icon must look completely green (if its orange or red, you have a probl\n \n For Hamachi:\n Try opening it. It's that simple.\n-Hamachi is optional, though. You don't have to install Hamachi if you want to make the server just for use on\n-your own machine. However, if you want to let other players access your server, consider alternatively using\n-port-forwarding methods.\n+Hamachi is optional, though. You don't have to install Hamachi if you want to make the server just for use on your own machine. However, if you want to let other players access your server, consider alternatively using port-forwarding methods.\n \n ---- Installing the SERVER ----\n \n@@ -75,111 +65,78 @@ Now it is OPTIONAL, you don't need to run it if you don't want, as it will simpl\n some new goods, not present in the original MapleStory, to sell:\n \t- File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_shopupdate.sql, and execute it.\n \n-At the end of the execution of these SQLs, you should have installed a database schema named \"maplesolaxia\". REGISTER\n-YOUR FIRST ACCOUNT to be used in-game by creating manually a entry on the table \"accounts\" at that database with a\n-login and a password.\n+At the end of the execution of these SQLs, you should have installed a database schema named \"maplesolaxia\". REGISTER YOUR FIRST ACCOUNT to be used in-game by creating manually a entry on the table \"accounts\" at that database with a login and a password.\n \n-Configure the IP you want to use for your MapleStory server in \"configuration.ini\" file, or set it as \"localhost\"\n-if you want to run it only on your machine. Alternatively, you can use the IP given by Hamachi to use on a\n-Hamachi network, or you can use a non-Hamachi method of port-forwarding. Neither will be approached here.\n+Configure the IP you want to use for your MapleStory server in \"configuration.ini\" file, or set it as \"localhost\" if you want to run it only on your machine. Alternatively, you can use the IP given by Hamachi to use on a Hamachi network, or you can use a non-Hamachi method of port-forwarding. Neither will be approached here.\n \n-Now open NetBeans, and choose to Open a project... Select then the \"MapleSolaxia\" folder, that should already be\n-a project recognizable by NetBeans. If it doesn't, you have a problem.\n+Now open NetBeans, and choose to Open a project... Select then the \"MapleSolaxia\" folder, that should already be a project recognizable by NetBeans. If it doesn't, you have a problem.\n \n-Finally, select \"Clean and Build project\" to build the JAR file for the MapleStory server. Once done, make sure both\n-WampServer and Hamachi are on and functioning, and then execute \"launch.bat\" on the root of the project. If no errors\n-were raised from this action, your MapleStory server is now online.\n+Finally, select \"Clean and Build project\" to build the JAR file for the MapleStory server. Once done, make sure both WampServer and Hamachi are on and functioning, and then execute \"launch.bat\" on the root of the project. If no errors were raised from this action, your MapleStory server is now online.\n \n ---- Installing the CLIENT ----\n \n The client's set-up is quite straightforward:\n-\t- From \"ManagerMsv83.exe\", install MapleStory on your folder of preference (e.g. \"C:\\Nexon\\MapleStory\") and\n-follow their instructions.\n+\t- From \"ManagerMsv83.exe\", install MapleStory on your folder of preference (e.g. \"C:\\Nexon\\MapleStory\") and follow their instructions.\n \t- Once done, erase these files: \"HShield\" (folder), \"ASPLauncher.exe\", \"MapleStory.exe\" and \"patcher.exe\".\n \t- Extract into the client folder the \"localhost.exe\" from Localhostv83.\n \t- Overwrite the original WZ files with the ones provided from \"client_wz\" folder on the Google Drive.\n \n-If you are not using \"localhost\" as the target IP on the server's config file, you will need to HEX-EDIT \"localhost.exe\"\n-to fetch your IP. The \"localhost.exe\" uses the following byte addresses to store the server's IP address:\n+If you are not using \"localhost\" as the target IP on the server's config file, you will need to HEX-EDIT \"localhost.exe\" to fetch your IP. The \"localhost.exe\" uses the following byte addresses to store the server's IP address:\n \t- 006FE084;\n \t- 006FE094;\n \t- 006FE0A4;\n \n-To hex-edit, install the Neo Hex Editor from \"free-hex-editor-neo.exe\" and follow their instructions. Once done, open\n-\"localhost.exe\" for editing and overwrite the IP values under these 3 addresses. Save the changes and exit the editor.\n+To hex-edit, install the Neo Hex Editor from \"free-hex-editor-neo.exe\" and follow their instructions. Once done, open \"localhost.exe\" for editing and overwrite the IP values under these 3 addresses. Save the changes and exit the editor.\n \n-Open the \"localhost.exe\" client. If by any means the program did not open, and checking que server log your ping has\n-been listened and you are using Windows 8 or 10, it probably might be some compatibility issue. Extract \"lolwut.exe\"\n-from \"lolwut-v0.01.rar\" and place it on the MapleStory client folder (\"C:\\Nexon\\MapleStory\"). Your \"localhost.exe\"\n-property settings must follow these:\n+Open the \"localhost.exe\" client. If by any means the program did not open, and checking que server log your ping has been listened and you are using Windows 8 or 10, it probably might be some compatibility issue. Extract \"lolwut.exe\" from \"lolwut-v0.01.rar\" and place it on the MapleStory client folder (\"C:\\Nexon\\MapleStory\"). Your \"localhost.exe\" property settings must follow these:\n \t- Run in compatibility mode: Windows 7;\n \t- Unchecked reduced color mode;\n \t- 640 x 480 resolution;\n \t- Unchecked disable display on high DPI settings;\n \t- Run as an administrator;\n \t- Opening \"lolwut.exe\", use Fraysa's method.\n \n-Alternatively, there is available the No-Damage Cap version of the MapleStory client. Just extract and use the\n-\"localhost.exe\" from the one package with the given name.\n+Alternatively, there is available the No-Damage Cap version of the MapleStory client. Just extract and use the \"localhost.exe\" from the one package with the given name.\n \n-Important: should the client being refused to connect to the game server, it may be because firewall issues. Head to\n-the end of this file to proceed to enabling this connection with the computer's firewall. Alternatively, one can\n-deactivate the firewall and try opening the client again.\n+Important: should the client being refused to connect to the game server, it may be because firewall issues. Head to the end of this file to proceed to enabling this connection with the computer's firewall. Alternatively, one can deactivate the firewall and try opening the client again.\n \n ---- Important note about CLIENT EDITING ----\n \n DO NOT USE the server's XMLs for reimporting into the client's WZ, it WILL generate some kind of bugs afterwards.\n \t- Use instead the HaRepacker 4.2.4, encryption \"GMS (old)\".\n \t- Open the desired WZ for editing and, USING THE UI, make the desired changes.\n \t- Save the changed WZ, overwriting the original content at the client folder.\n-\t- Finally, RE-EXPORT (\"Private Server...\" exporting option) the changed XMLs into the server's WZ.XML files,\n-overwriting the old contents.\n+\t- Finally, RE-EXPORT (\"Private Server...\" exporting option) the changed XMLs into the server's WZ.XML files, overwriting the old contents.\n \n These steps are IMPORTANT to maintain synchronization between the server and client modules.\n \n-As an example of client WZ editing, consider the MobBookUpdate project I developed, for updating all reported drop\n-data of the mobs in the game based on the current drop data on the database:\n-\n+As an example of client WZ editing, consider the MobBookUpdate project I developed, for updating all reported drop data of the mobs in the game based on the current drop data on the database:\n \t- Open the MobBookUpdate project on NetBeans, located at \"C:\\Nexon\\MapleSolaxia\\MobBookUpdate\", and build it.\n \t- At the subfolder \"lib\", copy the file \"MonsterBook.img.xml\". This is from the original WZ v83.\n \t- Paste it on the \"dist\" subfolder.\n \t- Inside \"dist\", open the command prompt by alt+right clicking there.\n \t- Execute \"java -jar MobBookUpdate.jar\". It will generate a \"MonsterBook_updated.img.xml\" file.\n-\t- At last, overwrite the \"MonsterBook.img.xml\" on \"C:\\Nexon\\MapleSolaxia\\wz\\String.wz\" with this file, renaming\n-it back to \"MonsterBook.img.xml\".\n+\t- At last, overwrite the \"MonsterBook.img.xml\" on \"C:\\Nexon\\MapleSolaxia\\wz\\String.wz\" with this file, renaming it back to \"MonsterBook.img.xml\".\n \n-At this point, the server-side Monster Book has been updated with the current state of the database's drop data. Then,\n-open HaRepacker 4.2.2 and load \"String.wz\" from \"C:\\Nexon\\MapleStory\". Drop the \"MonsterBook.img\" node by removing it\n-from the hierarchy tree, then (CONTRARY TO WHAT SHOULD BE DONE NORMALLY!) import the server's \"MonsterBook.img.xml\".\n+At this point, the server-side Monster Book has been updated with the current state of the database's drop data. Then, open HaRepacker 4.2.2 and load \"String.wz\" from \"C:\\Nexon\\MapleStory\". Drop the \"MonsterBook.img\" node by removing it from the hierarchy tree, then (CONTRARY TO WHAT SHOULD BE DONE NORMALLY!) import the server's \"MonsterBook.img.xml\".\n \n-Take note that this is absolutely dangerous if done unwary. Once the MonsterBook does not hold client specific data in\n-it's node contents, importing the XML causes no harm at all. However, try not to remove/reimport nodes from WZ files,\n-as it may cause data losses. Use the HaRepacker's UI instead to make the changes.\n+Take note that this is absolutely dangerous if done unwary. Once the MonsterBook does not hold client specific data in it's node contents, importing the XML causes no harm at all. However, try not to remove/reimport nodes from WZ files, as it may cause data losses. Use the HaRepacker's UI instead to make the changes.\n \n Save the changes and overwrite the older WZ on the MapleStory client folder.\n \n ---- Portforwarding the SERVER ----\n \n-To use portforward, you will need to have permission to change things on the LAN router. Access yor router using the\n-Internet browser. URLs vary accordingly with the manufacturer. To discover it, open the command prompt and type\n-\"ipconfig\" and search for the \"default gateway\" field. The IP shown there is the URL needed to access the router.\n-Also, look for the IP given to your machine (aka \"IPv4 address\" field), which will be the server one.\n+To use portforward, you will need to have permission to change things on the LAN router. Access yor router using the Internet browser. URLs vary accordingly with the manufacturer. To discover it, open the command prompt and type \"ipconfig\" and search for the \"default gateway\" field. The IP shown there is the URL needed to access the router. Also, look for the IP given to your machine (aka \"IPv4 address\" field), which will be the server one. \n \n-The default login/password also varies, so use the link http://www.routerpasswords.com/ as reference. Usually, login\n-as \"admin\" and password as \"password\" completes the task well.\n+The default login/password also varies, so use the link http://www.routerpasswords.com/ as reference. Usually, login as \"admin\" and password as \"password\" completes the task well.\n \n-Now you have logged in the router system, find for anything related to portforwarding. Should the system prompts you\n-between portforwarding and portriggering, pick the first, it is what we will be using.\n+Now you have logged in the router system, find for anything related to portforwarding. Should the system prompts you between portforwarding and portriggering, pick the first, it is what we will be using.\n \n-Now, it is needed to enable the right ports for the Internet. For MapleSolaxia, it is basically needed to open ports\n-7575 to 7575 + (number of channels) and port 8484. Create a new custom service which enables that range of ports for\n-the server's channel and opt to use TCP/UDP protocols. Finally, create a custom service now for using port 8484.\n+Now, it is needed to enable the right ports for the Internet. For MapleSolaxia, it is basically needed to open ports 7575 to 7575 + (number of channels) and port 8484. Create a new custom service which enables that range of ports for the server's channel and opt to use TCP/UDP protocols. Finally, create a custom service now for using port 8484.\n \n Optionally, if you want to host a webpage, portforward the port 80 (the HTTP port) as well.\n \n-It is not done yet, sometimes the firewalls will block connections between the LAN and the Internet. To overcome this,\n-it is needed to create some rules for the firewall to permit these connections. Search for the advanced options with\n-firewalls on your computer and, with it open, create two rules (one outbound and one inbound).\n+It is not done yet, sometimes the firewalls will block connections between the LAN and the Internet. To overcome this, it is needed to create some rules for the firewall to permit these connections. Search for the advanced options with firewalls on your computer and, with it open, create two rules (one outbound and one inbound).\n \n These rules must target \"one application\", \"enable connections\" and must target your MapleStory client (aka localhost).\n "}, {"sha": "650b8d523979a843dc4c68ad84f75c939f4db876", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -159,4 +159,14 @@ Corre\n 18 Abril 2017,\n Adi\ufffd\ufffdo de area boss: giant centipede.\n Corre\ufffd\ufffdo do evento Hak: viajantes n\ufffdo estavam sendo devidamente liberados no fim do evento.\n-Adi\ufffd\ufffdo de documenta\ufffd\ufffdo para portforwarding do sistema.\n\\ No newline at end of file\n+Adi\ufffd\ufffdo de documenta\ufffd\ufffdo para portforwarding do sistema.\n+\n+21 Abril 2017,\n+Implementa\ufffd\ufffdo do EllinPQ.\n+Corre\ufffd\ufffdo em m\ufffddulos da classe ActivateItemReactor.\n+Atualiza\ufffd\ufffdo em diversos drops nos SQLs.\n+\n+22 Abril 2017,\n+V\ufffdrias corre\ufffd\ufffdes envolvendo concorr\ufffdncias em propriedades do MapleCharacter.\n+Adi\ufffd\ufffdo de constante USE_EQUIPMNT_LVLUP: d\ufffd pra nivelar qualquer equip at\ufffd o n\ufffdvel desejado.\n+Algumas corre\ufffd\ufffdes em quests no cliente e no servidor.\n\\ No newline at end of file"}, {"sha": "19a5a99d4ba7ad93ac63904f2b9951fe85b0abe7", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -3,16 +3,13 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/scripting/event/EventManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/net/server/channel/Channel.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2090005.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/event/Hak.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/net/server/PlayerStorage.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/event/PiratePQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/net/server/channel/handlers/BeholderHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/client/inventory/Equip.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/net/server/world/MapleParty.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/net/server/channel/handlers/PlayerLoggedinHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/src/client/MapleCharacter.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/client/command/Commands.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/scripting/event/EventInstanceManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/event/Boats.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/tools/MaplePacketCreator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/constants/ServerConstants.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMap.java</file>\n         </group>\n     </open-files>"}, {"sha": "7a92c046e04e2adf2d5f5a1d019c43ac50f019e6", "filename": "scripts/event/0_EXAMPLE.js", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/0_EXAMPLE.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/0_EXAMPLE.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/0_EXAMPLE.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -15,14 +15,23 @@ function changedMap(eim, player, mapid) {\n }\n \n function scheduledTimeout(eim) {\n-    // When event timeout..\n+    // When event timeout without before completion..\n+}\n \n-    // restartEventTimer(long time)\n-    // stopEventTimer()\n-    // startEventTimer(long time)\n-    // isTimerStarted()\n+function timeOut(eim) {\n+    if (eim.getPlayerCount() > 0) {\n+        var pIter = eim.getPlayers().iterator();\n+        while (pIter.hasNext()){\n+            var player = pIter.next();\n+            player.dropMessage(6, \"You have run out of time to complete this event!\");\n+            playerExit(eim, player);\n+        }\n+    }\n+    eim.dispose();\n }\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {\n     // When invoking unregisterMonster(MapleMonster mob) OR killed\n     // Happens only when size = 0"}, {"sha": "e3d0d53c982842e0c51d2698da93f812aa1a2a6b", "filename": "scripts/event/3rdjob.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/3rdjob.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/3rdjob.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdjob.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -89,6 +89,7 @@ function playerDisconnected(eim, player) {\n     eim.dispose();\n }\n \n+function monsterKilled(mob, eim) {}\n \n function allMonstersDead(eim) {\n     var winner = eim.getPlayers().get(0);"}, {"sha": "114960b8200fe7749fafb293457cba79bbef6c6e", "filename": "scripts/event/4jberserk.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/4jberserk.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/4jberserk.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jberserk.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -154,6 +154,8 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {\n     eim.setProperty(\"canWarp\",\"true\");\n }"}, {"sha": "629942683bc15aba35d9a65fda6b1fb6c9faf89e", "filename": "scripts/event/4jrush.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/4jrush.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/4jrush.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jrush.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -122,9 +122,9 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-//do nothing; KPQ has nothing to do with monster killing\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {}\n \n function cancelSchedule() {\n }"}, {"sha": "c78bfd5937f96c3f6b1d2278a7b70b510a9fd6a8", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -180,6 +180,8 @@ function clearPQ(eim) {\n     end(eim);\n }\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {\n }\n "}, {"sha": "bf9a06fe796c7ec0ec9ce786f840bdf86af1be22", "filename": "scripts/event/CathedralWedding.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/CathedralWedding.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/CathedralWedding.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CathedralWedding.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -164,11 +164,11 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n \n function timeOut() {\n     var iter = em.getInstances().iterator();"}, {"sha": "93343be89848ebd6e12c94087ee933b70001cba9", "filename": "scripts/event/Ellin.js", "status": "modified", "additions": 82, "deletions": 35, "changes": 117, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/Ellin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/Ellin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Ellin.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -1,5 +1,9 @@\n+importPackage(Packages.client.inventory);\n+importPackage(Packages.tools);\n+\n var minPlayers = 2;\n var entryMap = 930000000;\n+var exitMap = 930000800;\n \n function init() {\n         em.setProperty(\"state\", \"0\");\n@@ -18,73 +22,116 @@ function setup(level, leaderid) {\n \teim.setInstanceMap(930000400).resetPQ(level);\n \tvar map = eim.setInstanceMap(930000500);\n \tmap.resetPQ(level);\n-\tmap.shuffleReactors();\n+        map.shuffleReactors();\n \teim.setInstanceMap(930000600).resetPQ(level);\n \teim.setInstanceMap(930000700).resetPQ(level);\n \n-        eim.startEventTimer(20 * 60000); //20 mins\n+        respawnStg2(eim);\n+        eim.startEventTimer(30 * 60000); //30 mins\n         return eim;\n }\n \n-function playerEntry(eim, player) {\n-        var map = eim.getMapInstance(entryMap);\n-        player.changeMap(map, map.getPortal(0));\n+function respawnStg2(eim) {    \n+    if(!eim.getMapInstance(930000200).getAllPlayer().isEmpty()) eim.getMapInstance(930000200).instanceMapRespawn();\n+    em.schedule(\"respawnStg2\", eim, 4 * 1000);\n }\n \n-function playerRevive(eim, player) {\n+function changedMap(eim, player, mapid) {\n+    if (mapid < 930000000 || mapid > 930000800) {\n+\teim.unregisterPlayer(player);\n+        if(eim.getPlayers().isEmpty()) end(eim);\n+    }\n+}\n+\n+function playerEntry(eim, player) {\n+    var map = eim.getMapInstance(entryMap);\n+    player.changeMap(map, map.getPortal(0));\n }\n \n function scheduledTimeout(eim) {\n-        end(eim);\n+    end(eim);\n }\n \n-function changedMap(eim, player, mapid) {\n-    if (mapid < 930000000 || mapid > 930000700) {\n-\teim.unregisterPlayer(player);\n+function removePlayer(eim, player) {\n+    eim.unregisterPlayer(player);\n+    player.changeMap(exitMap, 0);\n+}\n \n-\tif (eim.disposeIfPlayerBelow(0, 0)) {\n-\t\tem.setProperty(\"state\", \"0\");\n-\t\tem.setProperty(\"leader\", \"true\");\n-\t}\n-    }\n+function playerDead(eim, player) {}\n+\n+function playerRevive(eim, player) { // player presses ok on the death pop up.\n+    if (eim.isLeader(player) || party.size() <= minPlayers) { // Check for party leader\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++)\n+            playerExit(eim, party.get(i));\n+        eim.dispose();\n+    } else\n+        playerExit(eim, player);\n }\n \n+\n function playerDisconnected(eim, player) {\n-    return 0;\n+    var party = eim.getPlayers();\n+    if (eim.isLeader(player) || party.size() < minPlayers) {\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++)\n+            if (party.get(i).equals(player))\n+                removePlayer(eim, player);\n+            else\n+                playerExit(eim, party.get(i));\n+        eim.dispose();\n+    } else\n+        removePlayer(eim, player);\n }\n \n-function monsterValue(eim, mobId) {\n-    return 1;\n+function leftParty(eim, player) {\n+    var party = eim.getPlayers();\n+    if (party.size() < minPlayers) {\n+        for (var i = 0; i < party.size(); i++)\n+            playerExit(eim,party.get(i));\n+        eim.dispose();\n+    } else\n+        playerExit(eim, player);\n+}\n+\n+function disbandParty(eim) {\n+    var party = eim.getPlayers();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n+    }\n+    eim.dispose();\n }\n \n function playerExit(eim, player) {\n     eim.unregisterPlayer(player);\n+    player.changeMap(exitMap, 0);\n+}\n \n-    if (eim.disposeIfPlayerBelow(0, 0)) {\n-\tem.setProperty(\"state\", \"0\");\n-\t\tem.setProperty(\"leader\", \"true\");\n-\t}\n+function monsterValue(eim, mobId) {\n+    return 1;\n }\n \n function end(eim) {\n-    eim.disposeIfPlayerBelow(100, 930000800);\n-    em.setProperty(\"state\", \"0\");\n-    em.setProperty(\"leader\", \"true\");\n+    var party = eim.getPlayers();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n+    }\n+    eim.dispose();\n }\n \n function clearPQ(eim) {\n     end(eim);\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function leftParty (eim, player) {\n-    // If only 2 players are left, uncompletable:\n-\tend(eim);\n-}\n-function disbandParty (eim) {\n-\tend(eim);\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n+\n+function dispose(eim) {\n+    em.cancelSchedule();\n+    \n+    em.setProperty(\"state\", \"0\");\n+    em.setProperty(\"leader\", \"true\");\n }\n-function playerDead(eim, player) {}\n-function cancelSchedule() {}\n\\ No newline at end of file"}, {"sha": "ebc48f38d0cbc6526649dab4c14a74c6f0382276", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -190,9 +190,9 @@ function finish(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-//do nothing; GQ has nothing to do with monster killing\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {}\n \n function cancelSchedule() {\n }"}, {"sha": "cbf8af191c67e77ced759355f6603ad2dc078c2a", "filename": "scripts/event/HenesysPQ.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/HenesysPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/HenesysPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HenesysPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -165,6 +165,8 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {}\n \n function dispose() {"}, {"sha": "ceecb12b8f71601185cefdeb5d6fa8fa463195bd", "filename": "scripts/event/HorntailFight.js", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/HorntailFight.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/HorntailFight.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailFight.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -136,14 +136,13 @@ function finish(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n \n-function timeOut() {\n-}\n+function cancelSchedule() {}\n+\n+function timeOut() {}\n \n function debug(eim,msg) {\n     var iter = eim.getPlayers().iterator();"}, {"sha": "322c98ad0e96a37a1e3f87e73b2345740acc98f1", "filename": "scripts/event/KerningPQ.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/KerningPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/KerningPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KerningPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -137,11 +137,11 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n \n function dispose(eim) {\n \tem.cancelSchedule();"}, {"sha": "439c452d4c9f5060542255bf02e837b4ed99b571", "filename": "scripts/event/LudiMazePQ.js", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/LudiMazePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/LudiMazePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiMazePQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -126,16 +126,14 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-//do nothing; LMPQ has nothing to do with monster killing\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n \n-function dispose(eim) {\n+function cancelSchedule() {}\n+\n+function dispose(eim) {}\n \n-}\n function timeOut(eim) {\n     if (eim != null) {\n         if (eim.getPlayerCount() > 0) {"}, {"sha": "1e382ab818298deb99b03cc56dc66c55442ce20f", "filename": "scripts/event/LudiPQ.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/LudiPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/LudiPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -146,8 +146,9 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {}\n \n function dispose() {\n     em.schedule(\"OpenLPQ\", 10000); // 10 seconds ?"}, {"sha": "25d9f76ec3ba105366dae285f6be8aaa8ae0f44d", "filename": "scripts/event/OrbisPQ.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/OrbisPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/OrbisPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/OrbisPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -224,9 +224,9 @@ function finish(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-//Open Portal? o.O\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {} //Open Portal? o.O\n \n function cancelSchedule() {\n }"}, {"sha": "438fc0ffce4a9c8bef8140fccca71e8f023d515d", "filename": "scripts/event/PiratePQ.js", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/PiratePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/PiratePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PiratePQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -22,9 +22,12 @@ function setup(level, leaderid) {\n         em.setProperty(\"level\", level);\n         em.setProperty(\"openedChests\", \"0\");\n         eim.setInstanceMap(925100000).resetPQ(level);\n+        eim.setInstanceMap(925100000).shuffleReactors();\n+        \n \teim.setInstanceMap(925100100).resetPQ(level);\n \tvar map = eim.setInstanceMap(925100200);\n \tmap.resetPQ(level);\n+        map.shuffleReactors();\n \tfor (var i = 0; i < 5; i++) {\n \t\tvar mob = em.getMonster(9300124);\n \t\tvar mob2 = em.getMonster(9300125);\n@@ -58,6 +61,7 @@ function setup(level, leaderid) {\n \teim.setInstanceMap(925100202).resetPQ(level);\n \tmap = eim.setInstanceMap(925100300);\n \tmap.resetPQ(level);\n+        map.shuffleReactors();\n \tfor (var i = 0; i < 5; i++) {\n \t\tvar mob = em.getMonster(9300124);\n \t\tvar mob2 = em.getMonster(9300125);\n@@ -93,7 +97,7 @@ function setup(level, leaderid) {\n \teim.setInstanceMap(925100500).resetPQ(level);\n         \n         respawnStg4(eim);\n-        eim.startEventTimer(1200000); //20 mins\n+        eim.startEventTimer(20 * 60000); //20 mins\n         return eim;\n }\n \n@@ -108,8 +112,7 @@ function scheduledTimeout(eim) {\n \n function removePlayer(eim, player) {\n     eim.unregisterPlayer(player);\n-    player.getMap().removePlayer(player);\n-    player.setMap(exitMap);\n+    player.changeMap(exitMap, 0);\n }\n \n function changedMap(eim, player, mapid) {\n@@ -170,7 +173,7 @@ function disbandParty(eim) {\n \n function playerExit(eim, player) {\n     eim.unregisterPlayer(player);\n-    player.changeMap(exitMap, exitMap.getPortal(0));\n+    player.changeMap(exitMap, 0);\n }\n \n function monsterValue(eim, mobId) {\n@@ -189,15 +192,15 @@ function clearPQ(eim) {\n     end(eim);\n }\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {}\n \n function cancelSchedule() {}\n \n-function respawnStg4(eim) {\n-        //if(em.getProperty(\"stage4\") == \"0\") {\n-                eim.getMapInstance(925100400).instanceMapRespawn();\n-                em.schedule(\"respawnStg4\", eim, 10 * 1000);\n-        //}\n+function respawnStg4(eim) {    \n+    eim.getMapInstance(925100400).instanceMapRespawn();\n+    em.schedule(\"respawnStg4\", eim, 10 * 1000);\n }\n \n function dispose(eim) {"}, {"sha": "1634c255d8766cb5756f1ba779e76984ebc73702", "filename": "scripts/event/RockSpirit.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/RockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/RockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpirit.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -120,6 +120,8 @@ function dispose() {}\n \n function clearPQ(eim) {}\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {}\n \n function timeOut(eim) {"}, {"sha": "ef923bd3aa77d9afdcdd9dc8638b1d0f841eacbd", "filename": "scripts/event/ScargaBattle.js", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ScargaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ScargaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ScargaBattle.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -36,10 +36,10 @@ function init() {\n }\n \n function setup() {\n-    var eim = em.newInstance(\"ScargaBattle_\" + em.getProperty(\"channel\"));\n+        var eim = em.newInstance(\"ScargaBattle_\" + em.getProperty(\"channel\"));\n \tvar timer = 1000 * 60 * fightTime;\n \teim.setProperty(\"summoned\", \"false\");\n-    em.schedule(\"timeOut\", eim, timer);\n+        em.schedule(\"timeOut\", eim, timer);\n \teim.startEventTimer(timer);\n \treturn eim;\n }\n@@ -133,21 +133,21 @@ function finish(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n \n function timeOut(eim) {\n     if (eim != null) {\n         if (eim.getPlayerCount() > 0) {\n             var pIter = eim.getPlayers().iterator();\n             while (pIter.hasNext()){\n-\t\t\t\tvar player = pIter.next();\n-\t\t\t\tplayer.dropMessage(6, \"You have run out of time to defeat Scarlion and Targa!\");\n+\t\tvar player = pIter.next();\n+\t\tplayer.dropMessage(6, \"You have run out of time to defeat Scarlion and Targa!\");\n                 playerExit(eim, player);\n-\t\t\t}\n+            }\n         }\n         eim.dispose();\n     }"}, {"sha": "383fc20352429269259ef3493a7c80ddc7ab90af", "filename": "scripts/event/VIPRockSpirit.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/VIPRockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/VIPRockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/VIPRockSpirit.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -120,6 +120,8 @@ function dispose() {}\n \n function clearPQ(eim) {}\n \n+function monsterKilled(mob, eim) {}\n+\n function allMonstersDead(eim) {}\n \n function timeOut(eim) {"}, {"sha": "874802136fae11183f0b03cd31741bcbab1a3ebc", "filename": "scripts/event/ZakumBattle.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ZakumBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ZakumBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumBattle.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -151,11 +151,11 @@ function finish(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-}\n+function monsterKilled(mob, eim) {}\n \n-function cancelSchedule() {\n-}\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n \n function altarTimeOut(eim) {\n     if (eim != null && eim.getProperty(\"summoned\").equals(\"false\")) {"}, {"sha": "f54ae1515dd653a208f1cb60111221c995ff6578", "filename": "scripts/event/ZakumPQ.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ZakumPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/ZakumPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumPQ.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -139,9 +139,9 @@ function clearPQ(eim) {\n     eim.dispose();\n }\n \n-function allMonstersDead(eim) {\n-//do nothing; ZPQ has nothing to do with monster killing\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {}\n \n function cancelSchedule() {\n }"}, {"sha": "f05813503ba69555c7b38911cdd45fc16c62ecba", "filename": "scripts/event/s4aWorld.js", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/s4aWorld.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/event/s4aWorld.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/s4aWorld.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -76,9 +76,8 @@ function clearPQ(eim) {\n     em.setProperty(\"started\", \"false\");\n }\n \n-function allMonstersDead(eim) {\n-//has nothing to do with monster killing\n-}\n+function monsterKilled(mob, eim) {}\n+\n+function allMonstersDead(eim) {}\n \n-function cancelSchedule() {\n-}\n\\ No newline at end of file\n+function cancelSchedule() {}\n\\ No newline at end of file"}, {"sha": "78226f09d14be1769ca2eb092266b156d0e38ed5", "filename": "scripts/npc/world0/1072008.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/1072008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/1072008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1072008.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -15,19 +15,19 @@ function action(mode,type,selection) {\n     if (status == -1) {\n \tif (cm.getMapId() == 108000502) {\n \t    if (!(cm.haveItem(4031856,15))) {\n-\t    \tcm.sendNext(\"Go, and get me 15 #bPotent Wind Crystals#k.\");\n+\t    \tcm.sendNext(\"Go, and get me 15 #b#t4031856##k.\");\n \t    \tcm.dispose();\n \t    } else {\n \t    \tstatus = 2;\n-\t    \tcm.sendNext(\"Wow, you have brought me 15 #bPotent Wind Crystals#k! Congratulations. Let me warp you out now.\");\n+\t    \tcm.sendNext(\"Wow, you have brought me 15 #b#t4031856##k! Congratulations. Let me warp you out now.\");\n \t    }\n \t} else if (cm.getMapId() == 108000501) {\n \t    if (!(cm.haveItem(4031857,15))) {\n-\t    \tcm.sendNext(\"Go, and get me 15 #bPotent Power Crystals#k.\");\n+\t    \tcm.sendNext(\"Go, and get me 15 #b#t4031857##k.\");\n \t    \tcm.dispose();\n \t    } else {\n \t    \tstatus = 2;\n-\t    \tcm.sendNext(\"Wow, you have brought me 15 #bPotent Power Crystals#k! Congratulations. Let me warp you out now.\");\n+\t    \tcm.sendNext(\"Wow, you have brought me 15 #b#t4031857##k! Congratulations. Let me warp you out now.\");\n \t    }\n \t} else {\n \t    cm.sendNext(\"Error. Please report this.\");"}, {"sha": "246f67d8760a2927d81462f3b0e9fa1d4f2116b6", "filename": "scripts/npc/world0/2094000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2094000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2094000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094000.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -84,7 +84,7 @@ function action(mode, type, selection) {\n                     cm.dispose();\n                 }\n                 else {\n-                    cm.sendOk(\"Your party is not a party of two to six members. Make sure all your members are present and qualified to participate in this quest.  I see #b\" + levelValid.toString() + \" #kmembers are in the right level range, and #b\" + inMap.toString() + \"#k are in my map. If this seems wrong, #blog out and log back in,#k or reform the party.\");\n+                    cm.sendOk(\"Your party is not a party of 2 to 6 members between level \" + minLevel + \" and \" + maxLevel + \". Make sure all your members are present and qualified to participate in this quest.\");\n                     cm.dispose();\n                 }\n             }"}, {"sha": "e055145b677af2a16ec24ea1f8330fbc601609bc", "filename": "scripts/npc/world0/2133000.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -1,4 +1,7 @@\n var status = -1;\n+var minPlayers = 0;\n+\n+var minLevel = 44, maxLevel = 170;\n \n function start() {\n     action(1,0,0);\n@@ -14,9 +17,6 @@ function action(mode, type, selection) {\n \tstatus--;\n     }\n     if (status == 0) {\n-\t    cm.removeAll(4001163);\n-\t    cm.removeAll(4001169);\n-\t    cm.removeAll(2270004);\n \tcm.sendSimple(\"#b#L0#Give me Altaire Earrings.#l\\r\\n#L1#Give me Glittering Altaire Earrings.#l\\r\\n#L3#Give me Brilliant Altaire Earrings.#l\\r\\n#L2#Attempt Forest of Poison Haze.#l#k\");\n     } else if (status == 1) {\n \tif (selection == 0) {\n@@ -54,21 +54,21 @@ function action(mode, type, selection) {\n \t\twhile (it.hasNext()) {\n \t\t\tvar cPlayer = it.next();\n \t\t\tvar ccPlayer = cm.getPlayer().getMap().getCharacterById(cPlayer.getId());\n-\t\t\tif (ccPlayer == null || ccPlayer.getLevel() < 44 || ccPlayer.getLevel() > 55) {\n+\t\t\tif (ccPlayer == null || ccPlayer.getLevel() < minLevel || ccPlayer.getLevel() > maxLevel) {\n \t\t\t\tnext = false;\n \t\t\t\tbreak;\n \t\t\t}\n \t\t\tsize += (ccPlayer.isGM() ? 4 : 1);\n \t\t}\t\n-\t\tif (next && size >= 2) {\n+\t\tif (next && size >= minPlayers) {\n \t\t\tvar em = cm.getEventManager(\"Ellin\");\n \t\t\tif (em == null) {\n \t\t\t\tcm.sendOk(\"Please try again later.\");\n \t\t\t} else {\n \t\t\t\tem.startInstance(cm.getPlayer().getParty(), cm.getPlayer().getMap(), 1);    //common level only\n \t\t\t}\n \t\t} else {\n-\t\t\tcm.sendOk(\"All 2+ members of your party must be here and between level 44 and 55.\");\n+\t\t\tcm.sendOk(\"All 2+ members of your party must be here and between level \" + minLevel + \" and \" + maxLevel + \".\");\n \t\t}\n \t    }\n \t}"}, {"sha": "c76e2bd7a33320c9608581dcf084811e6b811ea0", "filename": "scripts/npc/world0/2133000.txt", "status": "removed", "additions": 0, "deletions": 73, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/72ef73a949432b7d938422f7473b44b3af4370e2/scripts/npc/world0/2133000.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/72ef73a949432b7d938422f7473b44b3af4370e2/scripts/npc/world0/2133000.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.txt?ref=72ef73a949432b7d938422f7473b44b3af4370e2", "patch": "@@ -1,73 +0,0 @@\n-var status = -1;\n-\n-function action(mode, type, selection) {\n-    if (mode == 1) {\n-\tstatus++;\n-    } else {\n-\tif (status == 0) {\n-\t    cm.dispose();\n-\t}\n-\tstatus--;\n-    }\n-    if (status == 0) {\n-\t    cm.removeAll(4001163);\n-\t    cm.removeAll(4001169);\n-\t    cm.removeAll(2270004);\n-\tcm.sendSimple(\"#b#L0#Give me Altaire Earrings.#l\\r\\n#L1#Give me Glittering Altaire Earrings.#l\\r\\n#L3#Give me Brilliant Altaire Earrings.#l\\r\\n#L2#Attempt Forest of Poison Haze.#l#k\");\n-    } else if (status == 1) {\n-\tif (selection == 0) {\n-\t    if (!cm.haveItem(1032060) && cm.haveItem(4001198, 10)) {\n-\t\tcm.gainItem(1032060,1);\n-\t\tcm.gainItem(4001198, -10);\n-\t    } else {\n-\t\tcm.sendOk(\"You either have Altair Earrings already or you do not have 10 Altair Fragments\");\n-\t    }\n-\t} else if (selection == 1){\n-\t    if (cm.haveItem(1032060) && !cm.haveItem(1032061) && cm.haveItem(4001198, 10)) {\n-\t\tcm.gainItem(1032060,-1);\n-\t\tcm.gainItem(1032061, 1);\n-\t\tcm.gainItem(4001198, -10);\n-\t    } else {\n-\t\tcm.sendOk(\"You either don't have Altair Earrings already or you do not have 10 Altair Fragments\");\n-\t    }\n-\t} else if (selection == 1){\n-\t    if (cm.haveItem(1032061) && !cm.haveItem(1032101) && cm.haveItem(4001198, 10)) {\n-\t\tcm.gainItem(1032061,-1);\n-\t\tcm.gainItem(1032101, 1);\n-\t\tcm.gainItem(4001198, -10);\n-\t    } else {\n-\t\tcm.sendOk(\"You either don't have Glittering Altair Earrings already or you do not have 10 Altair Fragments\");\n-\t    }\n-\t} else if (selection == 2) {\n-\t    if (cm.getPlayer().getParty() == null || !cm.isLeader()) {\n-\t\tcm.sendOk(\"The leader of the party must be here.\");\n-\t    } else {\n-\t\tvar party = cm.getPlayer().getParty().getMembers();\n-\t\tvar mapId = cm.getPlayer().getMapId();\n-\t\tvar next = true;\n-\t\tvar size = 0;\n-\t\tvar it = party.iterator();\n-\t\twhile (it.hasNext()) {\n-\t\t\tvar cPlayer = it.next();\n-\t\t\tvar ccPlayer = cm.getPlayer().getMap().getCharacterById(cPlayer.getId());\n-\t\t\tif (ccPlayer == null || ccPlayer.getLevel() < 70 || ccPlayer.getLevel() > 255) {\n-\t\t\t\tnext = false;\n-\t\t\t\tbreak;\n-\t\t\t}\n-\t\t\tsize += (ccPlayer.isGM() ? 4 : 1);\n-\t\t}\t\n-\t\tif (next && size >= 2) {\n-\t\t\tvar em = cm.getEventManager(\"Ellin\");\n-\t\t\tif (em == null) {\n-\t\t\t\tcm.sendOk(\"Please try again later.\");\n-\t\t\t} else {\n-\t\t\t\tem.startInstance(cm.getPlayer().getParty(), cm.getPlayer().getMap(), 120);\n-\t\t\t}\n-\t\t} else {\n-\t\t\tcm.sendOk(\"All 2+ members of your party must be here and above level 70.\");\n-\t\t}\n-\t    }\n-\t}\n-\tcm.dispose();\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "0e626c461408758c5a2e2fdcecc06506f4e61c8e", "filename": "scripts/npc/world0/2133001.js", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133001.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -28,8 +28,13 @@ function action(mode, type, selection) {\n \t\tcm.warpParty(930000500);\n \t\tcm.gainItem(4001169,-20);\n \t    } else if (!cm.haveItem(2270004)) {\n-\t\tcm.gainItem(2270004,10);\n-\t\tcm.sendOk(\"Good luck in purifying these monsters!\");\n+                if(cm.canHold(2270004,10)) {\n+                    cm.gainItem(2270004,10);\n+                    cm.sendOk(\"Good luck in purifying these monsters!\");\n+                }\n+\t\telse {\n+                    cm.sendOk(\"Make space on your USE inventory before receiving the purifiers!\");\n+                }\n \t    } else {\n \t\tcm.sendOk(\"We have to purify all these contaminated monsters! Get me 20 Monster Marbles from them!\");\n \t    }"}, {"sha": "4ac0936ee63e90ee054857e64a7645d1092e08ea", "filename": "scripts/npc/world0/2133002.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/2133002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133002.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -16,9 +16,9 @@ function action(mode, type, selection) {\n     if (status == 0) {\n \tcm.sendYesNo(\"Would you like to get out?\");\n     } else if (status == 1) {\n-\t    cm.removeAll(4001163);\n-\t    cm.removeAll(4001169);\n-\t    cm.removeAll(2270004);\n+\tcm.removeAll(4001163);\n+\tcm.removeAll(4001169);\n+\tcm.removeAll(2270004);\n \tcm.warp(930000800,0);\n \tcm.dispose();\n     }"}, {"sha": "0a85afe5986115af2a7eaef520dbac5140813f5e", "filename": "scripts/npc/world0/9120023.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/9120023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/npc/world0/9120023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9120023.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,4 @@\n+function start() {\n+    cm.sendOk(\"The quality of the movies they are launching these days are impressive!\");\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "1adad84b73d08bc0508fe623bddcf6124d8ee23d", "filename": "scripts/portal/party6_out.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_out.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_out.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_out.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+\tif ((pi.getMap().getMonsters().size() == 0 || pi.getMap().getMonsterById(9300183) != null) && (pi.getMap().getReactorByName(\"\") == null || pi.getMap().getReactorByName(\"\").getState() == 1)) {\n+\t\tpi.warp(930000800,0);\n+                return true;\n+\t} else {\n+\t\tpi.playerMessage(5, \"Please eliminate the Poison Golem.\");\n+                return false;\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "4c42fd8832f3a3a51d0926ca76a0abf13da297c2", "filename": "scripts/portal/party6_stage.js", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,30 @@\n+function enter(pi) {\n+\tswitch(pi.getMapId()) {\n+\t\tcase 930000000:\n+\t\t\tpi.warp(930000100,0);\n+                        return true;\n+\t\t\tbreak;\n+\t\tcase 930000100:\n+\t\t\tif (pi.getMap().getMonsters().size() == 0) {\n+\t\t\t\tpi.warp(930000200,0);\n+                                return true;\n+\t\t\t} else {\n+\t\t\t\tpi.playerMessage(5, \"Eliminate all the monsters.\");\n+                                return false;\n+\t\t\t}\n+\t\t\tbreak;\n+\t\tcase 930000200:\n+\t\t\tif (pi.getMap().getReactorByName(\"spine\") != null && pi.getMap().getReactorByName(\"spine\").getState() < 4) {\n+\t\t\t\tpi.playerMessage(5, \"The spine blocks the way.\");\n+                                return false;\n+\t\t\t} else {\n+\t\t\t\tpi.warp(930000300,0); //assuming they cant get past reactor without it being gone\n+                                return true;\n+\t\t\t}\n+\t\t\tbreak;\n+                        \n+                default:\n+                        pi.playerMessage(5, \"This portal leads to an unbound path.\");\n+                        return false;\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "d0c7fb034fbc7eb072c518b571a3e706aafa955d", "filename": "scripts/portal/party6_stage501.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage501.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage501.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage501.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"02st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "494ab578719f097e16807a9cd2484f31e60fc853", "filename": "scripts/portal/party6_stage502.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage502.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage502.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage502.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"03st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "f7b4f86b975272cf5db8841323c5f7135ecad7d8", "filename": "scripts/portal/party6_stage503.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage503.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage503.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage503.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"04st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "867dd3c9c0c706ce95bdc0f5359b891b9bbaf4ca", "filename": "scripts/portal/party6_stage504.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage504.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage504.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage504.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"05st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "d577846d32b7398c753170efa25b0c61a733257f", "filename": "scripts/portal/party6_stage505.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage505.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage505.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage505.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"06st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "0f665872d09b4dd2974fd70ac1983427fb0a6381", "filename": "scripts/portal/party6_stage506.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage506.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage506.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage506.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"07st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "61b94556cd7644c2c807128095c68698ac0d14f0", "filename": "scripts/portal/party6_stage507.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage507.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage507.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage507.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"08st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "e6d3719430529184986302e425753bff6a27e55a", "filename": "scripts/portal/party6_stage508.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage508.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage508.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage508.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"09st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "cecdd2c598032cedc3a72ead260e9169afed34cc", "filename": "scripts/portal/party6_stage509.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage509.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage509.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage509.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"10st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "1b58a5b5b3a36fe87cb0c553ab49a41fed17680a", "filename": "scripts/portal/party6_stage510.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage510.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage510.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage510.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"11st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "bf25c5697982851c5a5e83e93075c1d66bd55d7f", "filename": "scripts/portal/party6_stage511.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage511.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage511.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage511.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"12st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "0aa9b3e9e334d0873084b8d202fb9ea61d2bd760", "filename": "scripts/portal/party6_stage512.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage512.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage512.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage512.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"13st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "c265e24fe616d2e7a8c553275c15d6fd28f42d78", "filename": "scripts/portal/party6_stage513.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage513.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage513.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage513.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"14st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "59dfd30e57ff65badff0174006d2b71a76dfb088", "filename": "scripts/portal/party6_stage514.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage514.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage514.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage514.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"15st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "887fd53a90e54922f2fe06d5965d96d02b1f465a", "filename": "scripts/portal/party6_stage515.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage515.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage515.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage515.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (java.lang.Math.random() < 0.1) {\n+\tpi.warp(930000300,\"16st\");\n+    } else {\n+\tpi.warp(930000300, \"01st\");\n+    }\n+    \n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "53a860e4d494eb13a8ef50f25d42217a7438c8f5", "filename": "scripts/portal/party6_stage800.js", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage800.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/portal/party6_stage800.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage800.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,19 @@\n+function enter(pi) {\n+    pi.removeAll(4001162);\n+    pi.removeAll(4001163);\n+    pi.removeAll(4001164);\n+    pi.removeAll(4001169);\n+    pi.removeAll(2270004);\n+    \n+    if(pi.getMap().getReactorByName(\"\") != null && pi.getMap().getReactorByName(\"\").getState() == 1) {\n+        if(!pi.canHold(4001198, 1)) {\n+            pi.playerMessage(5, \"Check for a free space on your ETC inventory before entering this portal.\");\n+            return false;\n+        }\n+        \n+        pi.gainItem(4001198, 1);\n+    }\n+    \n+    pi.warp(300030100,0);\n+    return true;\n+}\n\\ No newline at end of file"}, {"sha": "bcd3f8b77737c987fcf7d34532d74e0eee3e2759", "filename": "scripts/reactor/1202002.js", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/1202002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/1202002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1202002.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,30 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc> \n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+ * \n+ * 1102002.js: Nautilus bottom shells\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "b29c20ad9bbde8098a66e51f197e1ae081ea4ecf", "filename": "scripts/reactor/3001000.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3001000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3001000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/3001000.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,4 @@\n+function act(){\n+\trm.playerMessage(5, \"Poison Golem has been spawned.\");\n+\trm.spawnMonster(9300180,1);\n+}\n\\ No newline at end of file"}, {"sha": "918a2d06d12340e8eb2ef1fd30a3606016de5698", "filename": "scripts/reactor/3002000.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3002000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3002000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/3002000.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*3002000.js - Pond at Ellin PQ.\n+ *@author Ronan\n+ */\n+\n+function act() {\n+        rm.dropItems();\n+}"}, {"sha": "bbad6f2f1e4e7c53d66e1e391a2abdfd4ff3a400", "filename": "scripts/reactor/3002001.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3002001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3002001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/3002001.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,3 @@\n+function act() {\n+\trm.dropItems();\n+}"}, {"sha": "1d5be873897a7fb783cc058ce84ea9d351a49437", "filename": "scripts/reactor/3008000.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3008000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/scripts/reactor/3008000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/3008000.js?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -0,0 +1,3 @@\n+function act() {\n+\trm.givePartyExp(52000, rm.getPlayer().getPartyMembers());\n+}\n\\ No newline at end of file"}, {"sha": "4cffab1c8697c9fb37404811b3340f7cb1bf006c", "filename": "sql/db_database.sql", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -4113,7 +4113,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (3904, 5120100, 4020001, 1, 1, 0, 90000),\n (3905, 5120100, 4010006, 1, 1, 0, 90000),\n (3906, 5120100, 4020007, 1, 1, 0, 90000),\n-(3907, 5120100, 4011007, 1, 1, 0, 90000),\n+(3907, 5120100, 4011007, 1, 1, 0, 30000),\n (3908, 5120100, 2044602, 1, 1, 0, 3000),\n (3909, 5120100, 1041082, 1, 1, 0, 8000),\n (3910, 5120100, 1061081, 1, 1, 0, 8000),\n@@ -5827,7 +5827,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (5617, 6400000, 2000004, 1, 1, 0, 20000),\n (5618, 6400000, 4020003, 1, 1, 0, 9000),\n (5619, 6400000, 4010006, 1, 1, 0, 9000),\n-(5620, 6400000, 4003002, 1, 1, 0, 200000),\n+(5620, 6400000, 4003002, 1, 1, 0, 20000),\n (5621, 6400000, 4004001, 1, 1, 0, 10000),\n (5622, 6400000, 1082084, 1, 1, 0, 1000),\n (5623, 6400000, 1072142, 1, 1, 0, 800),\n@@ -11423,7 +11423,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (11210, 9001002, 4031059, 1, 1, 0, 999999),\n (11211, 9001003, 4031059, 1, 1, 0, 999999),\n (11212, 9001008, 4031059, 1, 1, 0, 499999),\n-(11213, 9001005, 4031013, 1, 1, 0, 300000),\n+(11213, 9001005, 4031857, 1, 1, 0, 300000),\n (11214, 9001012, 4032311, 1, 1, 0, 300000),\n (11215, 9001012, 4032311, 1, 1, 0, 300000),\n (11216, 9001013, 4032312, 1, 1, 0, 999999),\n@@ -11622,7 +11622,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (11628, 6220000, 1472055, 1, 1, 0, 1250),\n (11627, 5120500, 1472055, 1, 1, 0, 750),\n (11626, 5120000, 1472055, 1, 1, 0, 750),\n-(11625, 9001006, 4031013, 1, 1, 0, 400000),\n+(11625, 9001006, 4031856, 1, 1, 0, 400000),\n (11624, 8190003, 4031461, 1, 1, 6169, 1000),\n (11623, 9400218, 4001106, 25, 50, 0, 999999),\n (11622, 9400217, 4001106, 1, 3, 0, 999999),\n@@ -12786,11 +12786,11 @@ CREATE TABLE IF NOT EXISTS `drop_data_global` (\n ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC AUTO_INCREMENT=5 ;\n \n INSERT INTO `drop_data_global` (`id`, `continent`, `dropType`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`, `comments`) VALUES\n-(1, 0, 0, 4031865, 1, 1, 0, 40000, 'NX Card 100 PTS'),\n-(2, 0, 0, 4031866, 1, 1, 0, 25000, 'NX Card 250 PTS'),\n-(3, 0, 0, 4001126, 1, 2, 0, 10000, 'Maple Leaves'),\n-(4, 0, 0, 2049100, 1, 1, 0, 1500, 'Chaos Scroll 60%'),\n-(5, 0, 0, 4001006, 1, 1, 0, 12000, 'Flaming Feather');\n+(1, 0, 0, 4031865, 1, 1, 0, 35000, 'NX Card 100 PTS'),\n+(2, 0, 0, 4031866, 1, 1, 0, 20000, 'NX Card 250 PTS'),\n+(3, 0, 0, 4001126, 1, 2, 0, 8000, 'Maple Leaves'),\n+(4, 0, 0, 2049100, 1, 1, 0, 1200, 'Chaos Scroll 60%'),\n+(5, 0, 0, 4001006, 1, 1, 0, 10000, 'Flaming Feather');\n \n CREATE TABLE IF NOT EXISTS `dueyitems` (\n   `id` int(10) unsigned NOT NULL AUTO_INCREMENT,"}, {"sha": "922086d6e94264043d2dbc4452ca1393c25b67f1", "filename": "sql/db_drops.sql", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -7802,7 +7802,6 @@\n (5100000, 4000048, 1, 1, 0, 200000), \n (5100000, 4000021, 1, 1, 0, 200000), \n (5100000, 4003005, 1, 1, 0, 7000), \n-(5100000, 2022066, 1, 1, 0, 3000), \n (5100000, 2000002, 1, 1, 0, 40000), \n (5100000, 2000003, 1, 1, 0, 40000), \n (5100000, 2040804, 1, 1, 0, 750), \n@@ -18794,11 +18793,14 @@\n (9300106, 4031551, 1, 1, 3829, 40000),\n (9300107, 4031551, 1, 1, 3829, 40000),\n (9300119, 4031551, 1, 1, 3829, 40000),\n-(9300119, 0, 801, 1199, 0, 400000);\n-\n+(9300119, 0, 801, 1199, 0, 400000),\n+(9300173, 4001161, 1, 1, 0, 200000);\n \n # (dropperid, itemid, minqty, maxqty, questid, chance)\n \n+  # delete item drops from Seruf shell\n+  DELETE FROM temp_data WHERE dropperid=4220001;\n+\n   UPDATE IGNORE temp_data SET chance=700 WHERE itemid=1302056;\n \n   UPDATE IGNORE temp_data SET dropperid=9000002 WHERE dropperid=9000000;\n@@ -18866,6 +18868,7 @@\n   UPDATE drop_data SET questid=7777 WHERE itemid=4001359;\n   UPDATE drop_data SET questid=7777 WHERE itemid=4001342;\n   UPDATE drop_data SET questid=7777 WHERE itemid=4031906;\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4032474;\n   UPDATE drop_data SET chance=0 WHERE itemid=2050099;\n   UPDATE drop_data SET chance=40000 WHERE itemid=4031991;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4031477;"}, {"sha": "7b02358529610c59effa3ddfd338beff2458d548", "filename": "sql/db_shopupdate.sql", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_shopupdate.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/sql/db_shopupdate.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_shopupdate.sql?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -36,7 +36,7 @@ INSERT IGNORE INTO `shopitems` (`shopitemid`, `shopid`, `itemid`, `price`, `pitc\n (995056, 9201082, 2043801, 520000, 0, 25),\n (995057, 9201082, 2044601, 520000, 0, 26),\n (995058, 9201082, 2040727, 10000, 0, 27),\n-(995059, 9201082, 2040807, 1500000, 0, 28),\n+(995059, 9201082, 2040807, 1000000, 0, 28),\n (995060, 9201082, 2040026, 15000, 0, 29),\n (995061, 9201082, 2040031, 15000, 0, 30),\n (995062, 9201082, 2040302, 25000, 0, 31),\n@@ -75,9 +75,9 @@ INSERT IGNORE INTO `shopitems` (`shopitemid`, `shopid`, `itemid`, `price`, `pitc\n (996009, 9201082, 2049209, 170000, 0, 64),\n (996010, 9201082, 2049210, 140000, 0, 65),\n (996011, 9201082, 2049211, 170000, 0, 66),\n-(996196, 9201082, 2070016, 100000000, 0, 67),\n-(996197, 9201082, 2070018, 175000000, 0, 68),\n-(994782, 9201082, 2030007, 700000, 0, 69),\n-(994783, 9201082, 4001017, 30000000, 0, 70);\n+(996196, 9201082, 2070016, 120000000, 0, 67),\n+(996197, 9201082, 2070018, 190000000, 0, 68),\n+(994782, 9201082, 2030007, 1800000, 0, 69),\n+(994783, 9201082, 4001017, 60000000, 0, 70);\n \n-UPDATE shopitems SET price = 11*price WHERE (`position` >= 27 and `position` <= 66);\n\\ No newline at end of file\n+UPDATE shopitems SET price = 11*price WHERE (`position` >= 27 and `position` <= 66 and `shopid` = 9201082);\n\\ No newline at end of file"}, {"sha": "61f76fe54da0616d49661a52db28127cec4e3999", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 91, "deletions": 22, "changes": 113, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -48,6 +48,8 @@\n //import java.util.TimeZone;\n import java.util.concurrent.ScheduledFuture;\n import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.locks.ReentrantLock;\n+import java.util.concurrent.locks.Lock;\n import java.util.regex.Pattern;\n \n import net.server.PlayerBuffValueHolder;\n@@ -274,6 +276,7 @@\n     private long useDuey;\n     private long petLootCd;\n     private int newWarpMap = -1;\n+    private Lock sLock = new ReentrantLock(true);\n \n     private MapleCharacter() {\n         setStance(0);\n@@ -552,7 +555,12 @@ public int addMP(MapleClient c) {\n     }\n \n     public void addSummon(int id, MapleSummon summon) {\n-        summons.put(id, summon);\n+        sLock.lock();\n+        try {\n+            summons.put(id, summon);\n+        } finally {\n+            sLock.unlock();\n+        }\n     }\n \n     public void addVisibleMapObject(MapleMapObject mo) {\n@@ -1360,22 +1368,28 @@ private void deregisterBuffStats(List<MapleBuffStat> stats) {\n                         }\n                     } else if (stat == MapleBuffStat.SUMMON || stat == MapleBuffStat.PUPPET) {\n                         int summonId = mbsvh.effect.getSourceId();\n-                        MapleSummon summon = summons.get(summonId);\n-                        if (summon != null) {\n-                            getMap().broadcastMessage(MaplePacketCreator.removeSummon(summon, true), summon.getPosition());\n-                            getMap().removeMapObject(summon);\n-                            removeVisibleMapObject(summon);\n-                            summons.remove(summonId);\n-                        }\n-                        if (summon.getSkill() == DarkKnight.BEHOLDER) {\n-                            if (beholderHealingSchedule != null) {\n-                                beholderHealingSchedule.cancel(false);\n-                                beholderHealingSchedule = null;\n+                        \n+                        sLock.lock();\n+                        try {\n+                            MapleSummon summon = summons.get(summonId);\n+                            if (summon != null) {\n+                                getMap().broadcastMessage(MaplePacketCreator.removeSummon(summon, true), summon.getPosition());\n+                                getMap().removeMapObject(summon);\n+                                removeVisibleMapObject(summon);\n+                                summons.remove(summonId);\n                             }\n-                            if (beholderBuffSchedule != null) {\n-                                beholderBuffSchedule.cancel(false);\n-                                beholderBuffSchedule = null;\n+                            if (summon.getSkill() == DarkKnight.BEHOLDER) {\n+                                if (beholderHealingSchedule != null) {\n+                                    beholderHealingSchedule.cancel(false);\n+                                    beholderHealingSchedule = null;\n+                                }\n+                                if (beholderBuffSchedule != null) {\n+                                    beholderBuffSchedule.cancel(false);\n+                                    beholderBuffSchedule = null;\n+                                }\n                             }\n+                        } finally {\n+                            sLock.unlock();\n                         }\n                     } else if (stat == MapleBuffStat.DRAGONBLOOD) {\n                         dragonBloodSchedule.cancel(false);\n@@ -1725,7 +1739,7 @@ public int getAccountID() {\n         return ret;\n     }\n \n-\tpublic List<Pair<MapleBuffStat, Integer>> getAllStatups() {\n+    public List<Pair<MapleBuffStat, Integer>> getAllStatups() {\n         List<Pair<MapleBuffStat, Integer>> ret = new ArrayList<>();\n         for (MapleBuffStat mbs : effects.keySet()) {\n             MapleBuffStatValueHolder mbsvh = effects.get(mbs);\n@@ -1827,6 +1841,8 @@ public MapleStatEffect getBuffEffect(MapleBuffStat stat) {\n     private List<MapleBuffStat> getBuffStats(MapleStatEffect effect, long startTime) {\n         List<MapleBuffStat> stats = new ArrayList<>();\n         for (Entry<MapleBuffStat, MapleBuffStatValueHolder> stateffect : effects.entrySet()) {\n+            if(stateffect.getValue() == null) continue;\n+            \n             if (stateffect.getValue().effect.sameSource(effect) && (startTime == -1 || startTime == stateffect.getValue().startTime)) {\n                 stats.add(stateffect.getKey());\n             }\n@@ -2284,6 +2300,18 @@ public MapleParty getParty() {\n     public int getPartyId() {\n         return (party != null ? party.getId() : -1);\n     }\n+    \n+    public List<MapleCharacter> getPartyMembers() {\n+        List<MapleCharacter> list = new LinkedList<>();\n+        \n+        if(party != null) {\n+            for(MaplePartyCharacter partyMembers: party.getMembers()) {\n+                list.add(partyMembers.getPlayer());\n+            }\n+        }\n+        \n+        return list;\n+    }\n \n     public MaplePlayerShop getPlayerShop() {\n         return playerShop;\n@@ -2500,9 +2528,50 @@ public MapleStorage getStorage() {\n     public int getStr() {\n         return str;\n     }\n-\n-    public Map<Integer, MapleSummon> getSummons() {\n-        return summons;\n+    \n+    public Collection<MapleSummon> getSummonsValues() {\n+        sLock.lock();\n+        try {\n+            return summons.values();\n+        } finally {\n+            sLock.unlock();\n+        }\n+    }\n+    \n+    public void clearSummons() {\n+        sLock.lock();\n+        try {\n+            summons.clear();\n+        } finally {\n+            sLock.unlock();\n+        }\n+    }\n+    \n+    public MapleSummon getSummonByKey(int id) {\n+        sLock.lock();\n+        try {\n+            return summons.get(id);\n+        } finally {\n+            sLock.unlock();\n+        }\n+    }\n+    \n+    public boolean isSummonsEmpty() {\n+        sLock.lock();\n+        try {\n+            return summons.isEmpty();\n+        } finally {\n+            sLock.unlock();\n+        }\n+    }\n+    \n+    public boolean containsSummon(MapleSummon summon) {\n+        sLock.lock();\n+        try {\n+            return summons.containsValue(summon);\n+        } finally {\n+            sLock.unlock();\n+        }\n     }\n \n     public int getTotalStr() {\n@@ -4908,7 +4977,7 @@ public String toString() {\n         }\n     }\n \n-    public boolean skillisCooling(int skillId) {\n+    public boolean skillIsCooling(int skillId) {\n         return coolDowns.containsKey(Integer.valueOf(skillId));\n     }\n \n@@ -5403,8 +5472,8 @@ public void increaseEquipExp(int mobexp) {\n                 continue;\n             }\n \n-            if ((itemName.contains(\"Reverse\") && nEquip.getItemLevel() < 4) || itemName.contains(\"Timeless\") && nEquip.getItemLevel() < 6) {\n-                nEquip.gainItemExp(client, mobexp, itemName.contains(\"Timeless\"));\n+            if ((nEquip.getItemLevel() < ServerConstants.USE_EQUIPMNT_LVLUP) && (itemName.contains(\"Reverse\") && nEquip.getItemLevel() < 4) || itemName.contains(\"Timeless\") && nEquip.getItemLevel() < 6) {\n+                nEquip.gainItemExp(client, mobexp, itemName.contains(\"Reverse\"));\n             }\n         }\n     }"}, {"sha": "1d56e7c146e95f89bd50f328fac3be74b47ee0eb", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -638,17 +638,34 @@ public static boolean executePlayerCommand(MapleClient c, String[] sub, char hea\n \t\t\tbreak;\n                     \n                 //debug only\n-                case \"map\":\n+                case \"debugpos\":\n                         if(ServerConstants.USE_DEBUG) {\n                             player.dropMessage(\"Current map position: (\" + player.getPosition().getX() + \", \" + player.getPosition().getY() + \").\");\n-                            break;\n                         }\n-                case \"mapcount\":\n+                        break;\n+                    \n+                case \"debugmapcount\":\n                         if(ServerConstants.USE_DEBUG) {\n                             player.dropMessage(\"Current map count: (\" + player.getMap().getAllPlayers().size() + \").\");\n-                            break;\n                         }\n-                    \n+                        break;\n+                \n+                case \"debugevent\":\n+                        if(ServerConstants.USE_DEBUG) {\n+                            if(player.getEventInstance() == null) player.dropMessage(\"Player currently not in a event.\");\n+                            else player.dropMessage(\"Current event name: \" + player.getEventInstance().getName() + \".\");\n+                        }\n+                        break;\n+                \n+                case \"debugreactors\":\n+                        if(ServerConstants.USE_DEBUG) {\n+                            player.dropMessage(\"Current reactor states on map \" + player.getMapId() + \":\");\n+                            for(Pair p: player.getMap().reportReactorStates()) {\n+                                player.dropMessage(\"Reactor id: \" + p.getLeft() + \" -> State: \" + p.getRight() + \".\");\n+                            }\n+                        }\n+                        break;\n+                            \n \t\tdefault:\n \t\t\tif (player.gmLevel() == 0) {\n \t\t\t\tplayer.yellowMessage(\"Player Command \" + heading + sub[0] + \" does not exist, see @help for a list of commands.\");"}, {"sha": "5eb5eabedf19a2c28a477c96a0d17aad8fcb40a6", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -312,14 +312,14 @@ public int getItemExp() {\n         return (int) itemExp;\n     }\n \n-    public void gainItemExp(MapleClient c, int gain, boolean timeless) {\n-        int expneeded = timeless ? (10 * itemLevel + 70) : (5 * itemLevel + 65);\n+    public void gainItemExp(MapleClient c, int gain, boolean reverse) {\n+        int expneeded = !reverse ? (10 * itemLevel + 70) : (5 * itemLevel + 65);\n         float modifier = 364 / expneeded;\n         float exp = (expneeded / (1000000 * modifier * modifier)) * gain;\n         itemExp += exp;\n         if (itemExp >= 364) {\n             itemExp = (itemExp - 364);\n-            gainLevel(c, timeless);\n+            gainLevel(c, !reverse);\n         } else {\n             c.getPlayer().forceUpdateItem(this);\n         }"}, {"sha": "e8bfa62b56bbeebfdc3ca0a6d1f8a5a91f1883d9", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -49,8 +49,9 @@\n     //public static final boolean USE_ULTRA_THREE_SNAILS = true;\n     public static final boolean USE_ADD_SLOTS_BY_LEVEL = true;  //slots are added each 20 levels.\n     public static final boolean USE_ADD_RATES_BY_LEVEL = true;  //rates are added each 20 levels.\n-    public static final int FAME_GAIN_BY_QUEST = 4;  //fame gain each N quest completes, set 0 to disable.\n-    public static final int SCROLL_CHANCE_RATE = 10;    //number of tries for success on a scroll, set 0 for default.\n+    public static final int USE_EQUIPMNT_LVLUP = 7;             //all equips lvlup at max level as N, set 0 to disable.\n+    public static final int FAME_GAIN_BY_QUEST = 4;             //fame gain each N quest completes, set 0 to disable.\n+    public static final int SCROLL_CHANCE_RATE = 10;            //number of tries for success on a scroll, set 0 for default.\n     \n     //Pet auto-pot recovery rates\n     public static final double PET_AUTOHP_RATIO = 0.99;         //will automatically consume potions until given ratio of the MaxHP/MaxMP is reached."}, {"sha": "8522533d06eadef12dc6618691ab793f5544acfb", "filename": "src/net/server/channel/handlers/AutoAssignHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/AutoAssignHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/AutoAssignHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AutoAssignHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -75,8 +75,8 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             //c.getPlayer().message(\"----------------------------------------SDL: \" + eqpStr + eqpDex + eqpLuk + \" BASE STATS --> STR: \" + chr.getStr() + \" DEX: \" + chr.getDex() + \" INT: \" + chr.getInt() + \" LUK: \" + chr.getLuk());\n             //c.getPlayer().message(\"SUM EQUIP STATS -> STR: \" + str + \" DEX: \" + dex + \" LUK: \" + luk + \" INT: \" + int_);\n             \n-            //---------- Ronan Lana's AUTOASSIGN -------------\n-            //this method excels for possibility to assign APs properly and not blocking the requirements when swapping one guaranteed equipment.\n+            // ---------- Ronan Lana's AUTOASSIGN -------------\n+            // This method excels for assigning APs in such a way to cover all equipments AP requirements.\n             if (chr.getRemainingAp() < 1) {\n                 return;\n             }"}, {"sha": "527c1b906308296fa27a1dac781da328ce93fcb7", "filename": "src/net/server/channel/handlers/BeholderHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/BeholderHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/BeholderHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/BeholderHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -37,7 +37,7 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         //System.out.println(slea.toString());\n-        Collection<MapleSummon> summons = c.getPlayer().getSummons().values();\n+        Collection<MapleSummon> summons = c.getPlayer().getSummonsValues();\n         int oid = slea.readInt();\n         MapleSummon summon = null;\n         for (MapleSummon sum : summons) {\n@@ -53,7 +53,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 slea.readByte(); //Not sure.\n             }            //show to others here\n         } else {\n-            c.getPlayer().getSummons().clear();\n+            c.getPlayer().clearSummons();\n         }\n     }\n }"}, {"sha": "74fe99fb6f69c2e3dd93c36fa21216239a097eff", "filename": "src/net/server/channel/handlers/CloseRangeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CloseRangeDamageHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -145,7 +145,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             Skill skill = SkillFactory.getSkill(attack.skill);\n             MapleStatEffect effect_ = skill.getEffect(player.getSkillLevel(skill));\n             if (effect_.getCooldown() > 0) {\n-                if (player.skillisCooling(attack.skill)) {\n+                if (player.skillIsCooling(attack.skill)) {\n                     return;\n                 } else {\n                     c.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));"}, {"sha": "f953bbfe40d00ad48a1b00a61c8161db4b6f67f0", "filename": "src/net/server/channel/handlers/DamageSummonHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/DamageSummonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/DamageSummonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DamageSummonHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -38,7 +38,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         int monsterIdFrom = slea.readInt();\n         if (SkillFactory.getSkill(skillid) != null) {\n             MapleCharacter player = c.getPlayer();\n-            MapleSummon summon = player.getSummons().get(skillid);\n+            MapleSummon summon = player.getSummonByKey(skillid);\n             if (summon != null) {\n                 summon.addHP(-damage);\n                 if (summon.getHP() <= 0) {"}, {"sha": "1e3052df3c9b191f94cb252f5dd8483028a4ba24", "filename": "src/net/server/channel/handlers/MagicDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/MagicDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/MagicDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MagicDamageHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -67,7 +67,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\tSkill skill = SkillFactory.getSkill(attack.skill);\n \t\tMapleStatEffect effect_ = skill.getEffect(player.getSkillLevel(skill));\n \t\tif (effect_.getCooldown() > 0) {\n-\t\t\tif (player.skillisCooling(attack.skill)) {\n+\t\t\tif (player.skillIsCooling(attack.skill)) {\n \t\t\t\treturn;\n \t\t\t} else {\n \t\t\t\tc.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));"}, {"sha": "78117909d297c12c7bb2cbd2198cb03264851e65", "filename": "src/net/server/channel/handlers/MoveSummonHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/MoveSummonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/MoveSummonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveSummonHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -38,7 +38,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         Point startPos = new Point(slea.readShort(), slea.readShort());\n         List<LifeMovementFragment> res = parseMovement(slea);\n         MapleCharacter player = c.getPlayer();\n-        Collection<MapleSummon> summons = player.getSummons().values();\n+        Collection<MapleSummon> summons = player.getSummonsValues();\n         MapleSummon summon = null;\n         for (MapleSummon sum : summons) {\n             if (sum.getObjectId() == oid) {"}, {"sha": "a386af7ae084b4c82f86b1244898918b7f113c6a", "filename": "src/net/server/channel/handlers/RangedAttackHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/RangedAttackHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/RangedAttackHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RangedAttackHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -198,7 +198,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     Skill skill = SkillFactory.getSkill(attack.skill);\n                     MapleStatEffect effect_ = skill.getEffect(player.getSkillLevel(skill));\n                     if (effect_.getCooldown() > 0) {\n-                        if (player.skillisCooling(attack.skill)) {\n+                        if (player.skillIsCooling(attack.skill)) {\n                             return;\n                         } else {\n                             c.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));"}, {"sha": "43b9b39064a8cd2482cfd8453076c3c722594244", "filename": "src/net/server/channel/handlers/ReactorHitHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/ReactorHitHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/ReactorHitHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ReactorHitHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -41,7 +41,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         int skillid = slea.readInt();\n         MapleReactor reactor = c.getPlayer().getMap().getReactorByOid(oid);\n         if (reactor != null && reactor.isAlive()) {\n-            reactor.hitReactor(charPos, stance, skillid, c, false);\n+            reactor.hitReactor(charPos, stance, skillid, c);\n         }\n     }\n }"}, {"sha": "b81550354cf3a7ff6215518f47ceb93971718eae", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -73,7 +73,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         MapleStatEffect effect = skill.getEffect(skillLevel);\n         if (effect.getCooldown() > 0) {\n-            if (chr.skillisCooling(skillid)) {\n+            if (chr.skillIsCooling(skillid)) {\n                 return;\n             } else if (skillid != Corsair.BATTLE_SHIP) {\n                 c.announce(MaplePacketCreator.skillCooldown(skillid, effect.getCooldown()));"}, {"sha": "a83372d4bb1271df12d74889b0acc8ce7dc26455", "filename": "src/net/server/channel/handlers/SummonDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/SummonDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/net/server/channel/handlers/SummonDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SummonDamageHandler.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -63,7 +63,7 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             return;\n         }\n         MapleSummon summon = null;\n-        for (MapleSummon sum : player.getSummons().values()) {\n+        for (MapleSummon sum : player.getSummonsValues()) {\n             if (sum.getObjectId() == oid) {\n                 summon = sum;\n             }"}, {"sha": "49f27edcffc21e651d6a6d3e0d6ba945045160de", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -46,6 +46,9 @@\n import server.maps.MapleMapFactory;\n import tools.DatabaseConnection;\n import client.MapleCharacter;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n \n /**\n  *\n@@ -67,6 +70,7 @@\n         private final ReentrantReadWriteLock mutex = new ReentrantReadWriteLock();\n         private final ReadLock rL = mutex.readLock();\n         private final WriteLock wL = mutex.writeLock();\n+        private ScheduledFuture<?> event_schedule = null;\n         private boolean disposed = false;\n \n \tpublic EventInstanceManager(EventManager em, String name) {\n@@ -114,8 +118,18 @@ public void exitPlayer(MapleCharacter chr) {\n \t}\n \n \tpublic void startEventTimer(long time) {\n-\t\ttimeStarted = System.currentTimeMillis();\n+                timeStarted = System.currentTimeMillis();\n \t\teventTime = time;\n+                \n+                event_schedule = TimerManager.getInstance().schedule(new Runnable() {\n+                    public void run() {\n+                        try {\n+                            em.getIv().invokeFunction(\"scheduledTimeout\", EventInstanceManager.this);\n+                        } catch (ScriptException | NoSuchMethodException ex) {\n+                            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                        }\n+                    }\n+                }, time);\n \t}\n \n \tpublic boolean isTimerStarted() {\n@@ -186,6 +200,11 @@ public void movePlayer(MapleCharacter chr) {\n \t\n \tpublic void monsterKilled(MapleMonster mob) {\n \t\tmobs.remove(mob);\n+                try {\n+                        em.getIv().invokeFunction(\"monsterKilled\", mob, this);\n+                } catch (ScriptException | NoSuchMethodException ex) {\n+                        ex.printStackTrace();\n+                }\n \t\tif (mobs.isEmpty()) {\n \t\t\ttry {\n \t\t\t\tem.getIv().invokeFunction(\"allMonstersDead\", this);\n@@ -268,6 +287,8 @@ public void dispose() {\n             } finally {\n                 wL.unlock();\n             }\n+            \n+            event_schedule.cancel(true);\n \n             mobs.clear();\n             killCount.clear();"}, {"sha": "0b8a5115ce47a68f90f05ab1dcd5292d2fc38ab7", "filename": "src/scripting/reactor/ReactorActionManager.java", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/scripting/reactor/ReactorActionManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/scripting/reactor/ReactorActionManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/reactor/ReactorActionManager.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -58,8 +58,12 @@ public void dropItems() {\n     public void dropItems(boolean meso, int mesoChance, int minMeso, int maxMeso) {\n         dropItems(meso, mesoChance, minMeso, maxMeso, 0);\n     }\n-\n+    \n     public void dropItems(boolean meso, int mesoChance, int minMeso, int maxMeso, int minItems) {\n+        dropItems((int)reactor.getPosition().getX(), (int)reactor.getPosition().getY(), meso, mesoChance, minMeso, maxMeso, minItems);\n+    }\n+\n+    public void dropItems(int posX, int posY, boolean meso, int mesoChance, int minMeso, int maxMeso, int minItems) {\n         List<ReactorDropEntry> chances = getDropChances();\n         List<ReactorDropEntry> items = new LinkedList<>();\n         int numItems = 0;\n@@ -79,8 +83,10 @@ public void dropItems(boolean meso, int mesoChance, int minMeso, int maxMeso, in\n             numItems++;\n         }\n         java.util.Collections.shuffle(items);\n-        final Point dropPos = reactor.getPosition();\n+        \n+        final Point dropPos = new Point(posX, posY);\n         dropPos.x -= (12 * numItems);\n+        \n         for (ReactorDropEntry d : items) {\n             if (d.itemId == 0) {\n                 int range = maxMeso - minMeso;\n@@ -98,7 +104,6 @@ public void dropItems(boolean meso, int mesoChance, int minMeso, int maxMeso, in\n                 reactor.getMap().spawnItemDrop(reactor, getPlayer(), drop, dropPos, false, false);\n             }\n             dropPos.x += 25;\n-\n         }\n     }\n "}, {"sha": "cfa50845b48ca41cd601d1e1c3b9945d539a1882", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 45, "deletions": 22, "changes": 67, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -223,7 +223,15 @@ public void setReactorState() {\n             for (MapleMapObject o : mapobjects.values()) {\n                 if (o.getType() == MapleMapObjectType.REACTOR) {\n                     if (((MapleReactor) o).getState() < 1) {\n-                        ((MapleReactor) o).setState((byte) 1);\n+                        MapleReactor mr = (MapleReactor) o;\n+                        mr.lockReactor();\n+                        try {\n+                            mr.setState((byte) 1);\n+                            mr.setShouldCollect(true);\n+                        } finally {\n+                            mr.unlockReactor();\n+                        }\n+                        \n                         broadcastMessage(MaplePacketCreator.triggerReactor((MapleReactor) o, 1));\n                     }\n                 }\n@@ -511,6 +519,16 @@ public int countMonster(int id) {\n         return count;\n     }\n     \n+    public List<Pair> reportReactorStates() {\n+        List<Pair> list = new LinkedList<>();\n+        \n+        for (MapleMapObject m : getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.REACTOR))) {\n+            MapleReactor mr = (MapleReactor) m;\n+            list.add(new Pair(mr.getId(), mr.getState()));\n+        }\n+        return list;\n+    }\n+    \n     public int countAllMonsters() {\n         return getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER)).size();\n     }\n@@ -797,13 +815,6 @@ public void destroyReactor(int oid) {\n         reactor.setAlive(false);\n         removeMapObject(reactor);\n         \n-        reactor.lockReactor();\n-        try {\n-            reactor.setShouldCollect(true);\n-        } finally {\n-            reactor.unlockReactor();\n-        }\n-        \n         if (reactor.getDelay() > 0) {\n             tMan.schedule(new Runnable() {\n                 @Override\n@@ -820,10 +831,10 @@ public void resetReactors() {\n             for (MapleMapObject o : mapobjects.values()) {\n                 if (o.getType() == MapleMapObjectType.REACTOR) {\n                     final MapleReactor r = ((MapleReactor) o);\n-                    r.setState((byte) 0);\n                     \n                     r.lockReactor();\n                     try {\n+                        r.setState((byte) 0);\n                         r.setShouldCollect(true);\n                     } finally {\n                         r.unlockReactor();\n@@ -1213,8 +1224,15 @@ public void sendPackets(MapleClient c) {\n     }\n \n     private void respawnReactor(final MapleReactor reactor) {\n-        reactor.setState((byte) 0);\n-        reactor.setAlive(true);\n+        reactor.lockReactor();\n+        try {\n+            reactor.setShouldCollect(true);\n+            reactor.setState((byte) 0);\n+            reactor.setAlive(true);\n+        } finally {\n+            reactor.unlockReactor();\n+        }\n+        \n         spawnReactor(reactor);\n     }\n \n@@ -1533,7 +1551,7 @@ public void run() {\n \n         MapleStatEffect summonStat = chr.getStatForBuff(MapleBuffStat.SUMMON);\n         if (summonStat != null) {\n-            MapleSummon summon = chr.getSummons().get(summonStat.getSourceId());\n+            MapleSummon summon = chr.getSummonByKey(summonStat.getSourceId());\n             summon.setPosition(chr.getPosition());\n             chr.getMap().spawnSummon(summon);\n             updateMapObjectVisibility(chr, summon);\n@@ -1624,7 +1642,7 @@ public void removePlayer(MapleCharacter chr) {\n         }\n         chr.leaveMap();\n         chr.cancelMapTimeLimitTask();\n-        for (MapleSummon summon : chr.getSummons().values()) {\n+        for (MapleSummon summon : chr.getSummonsValues()) {\n             if (summon.isStationary()) {\n                 chr.cancelBuffStats(MapleBuffStat.PUPPET);\n             } else {\n@@ -1734,7 +1752,7 @@ private void sendObjectPlacement(MapleClient mapleClient) {\n                 if (o.getType() == MapleMapObjectType.SUMMON) {\n                     MapleSummon summon = (MapleSummon) o;\n                     if (summon.getOwner() == chr) {\n-                        if (chr.getSummons().isEmpty() || !chr.getSummons().containsValue(summon)) {\n+                        if (chr.isSummonsEmpty() || !chr.containsSummon(summon)) {\n                             objectWLock.lock();\n                             try {\n                                 mapobjects.remove(o);\n@@ -2105,13 +2123,19 @@ public void run() {\n                         reactor.setShouldCollect(false);\n                         MapleMap.this.broadcastMessage(MaplePacketCreator.removeItemFromMap(mapitem.getObjectId(), 0, 0), mapitem.getPosition());\n                         MapleMap.this.removeMapObject(mapitem);\n-                        reactor.hitReactor(c, true);\n+                        reactor.hitReactor(c);\n \n                         if (reactor.getDelay() > 0) {\n                             tMan.schedule(new Runnable() {\n                                 @Override\n                                 public void run() {\n-                                    reactor.setState((byte) 0);\n+                                    reactor.lockReactor();\n+                                        try {\n+                                            reactor.setState((byte) 0);\n+                                            reactor.setShouldCollect(true);\n+                                        } finally {\n+                                            reactor.unlockReactor();\n+                                        }\n                                     broadcastMessage(MaplePacketCreator.triggerReactor(reactor, 0));\n                                 }\n                             }, reactor.getDelay());\n@@ -2120,8 +2144,7 @@ public void run() {\n                         mapitem.itemLock.unlock();\n                     }\n                 }\n-            }\n-            finally {\n+            } finally {\n                 reactor.unlockReactor();\n             }\n         }\n@@ -2560,12 +2583,12 @@ public final void resetFully() {\n         resetMapObjects();\n     }\n     \n-    public void resetPQ(int difficulty) {\n-        resetMapObjects(difficulty, true);\n+    public void resetPQ() {\n+        resetPQ(1);\n     }\n     \n-    public void resetPQ() {\n-        resetMapObjects(1, true);\n+    public void resetPQ(int difficulty) {\n+        resetMapObjects(difficulty, true);\n     }\n     \n     public void resetMapObjects(int difficulty, boolean isPq) {"}, {"sha": "3354b0111d58f7aa6935df8f5544d14c82c2684a", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -255,6 +255,7 @@ private MapleReactor loadReactor(MapleData reactor, String id) {\n         myReactor.setPosition(new Point(x, y));\n         myReactor.setDelay(MapleDataTool.getInt(reactor.getChildByPath(\"reactorTime\")) * 1000);\n         myReactor.setState((byte) 0);\n+        myReactor.setShouldCollect(true);\n         myReactor.setName(MapleDataTool.getString(reactor.getChildByPath(\"name\"), \"\"));\n         return myReactor;\n     }"}, {"sha": "ecb7894f8f669c4ea03f7a72f68319df14061fcf", "filename": "src/server/maps/MapleReactor.java", "status": "modified", "additions": 15, "deletions": 11, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleReactor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/src/server/maps/MapleReactor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleReactor.java?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -26,6 +26,7 @@\n \n import java.awt.Rectangle;\n import java.util.List;\n+\n import java.util.concurrent.locks.Lock;\n import java.util.concurrent.locks.ReentrantLock;\n \n@@ -46,7 +47,7 @@\n     private MapleMap map;\n     private String name;\n     private boolean alive;\n-    private boolean shouldCollect = true;\n+    private boolean shouldCollect;\n     private Lock reactorLock = new ReentrantLock(true);\n \n     public MapleReactor(MapleReactorStats stats, int rid) {\n@@ -143,31 +144,31 @@ public void sendSpawnData(MapleClient client) {\n     }\n \n     public void forceHitReactor(final byte newState) {\n-        setState((byte) newState);\n+        this.lockReactor();\n         try {\n-            this.lockReactor();\n+            setState((byte) newState);\n             this.setShouldCollect(true);\n-        }\n-        finally {\n+        } finally {\n             this.unlockReactor();\n         }\n+        \n         map.broadcastMessage(MaplePacketCreator.triggerReactor(this, (short) 0));\n     }\n     \n     public void delayedHitReactor(final MapleClient c, long delay) {\n         TimerManager.getInstance().schedule(new Runnable() {\n             @Override\n             public void run() {\n-                hitReactor(c, false);\n+                hitReactor(c);\n             }\n         }, delay);\n     }\n \n-    public void hitReactor(MapleClient c, boolean itemDrop) {\n-        hitReactor(0, (short) 0, 0, c, itemDrop);\n+    public void hitReactor(MapleClient c) {\n+        hitReactor(0, (short) 0, 0, c);\n     }\n     \n-    public synchronized void hitReactor(int charPos, short stance, int skillid, MapleClient c, boolean itemDrop) {\n+    public synchronized void hitReactor(int charPos, short stance, int skillid, MapleClient c) {\n         try {\n             if(!this.isAlive()) {\n                 return;\n@@ -196,11 +197,12 @@ public synchronized void hitReactor(int charPos, short stance, int skillid, Mapl\n                             \n                             ReactorScriptManager.getInstance().act(c, this);\n                         } else { //reactor not broken yet\n-                            if (itemDrop) state++; // Duh, if the reactor is triggered by itemdrop, go directly to next state (in this case, instead of staying at 1, it goes to 2)! :)\n                             map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n-                            if (state == stats.getNextState(state, b) || itemDrop) {//current state = next state, looping reactor\n+                            if (state == stats.getNextState(state, b)) {//current state = next state, looping reactor\n                                 ReactorScriptManager.getInstance().act(c, this);\n                             }\n+                            \n+                            setShouldCollect(true);     // refresh collectability on item drop-based reactors\n                         }\n                         break;\n                     }\n@@ -209,6 +211,8 @@ public synchronized void hitReactor(int charPos, short stance, int skillid, Mapl\n                 state++;\n                 map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n                 ReactorScriptManager.getInstance().act(c, this);\n+                setShouldCollect(true);\n+                System.out.println(\"ehh\");\n             }\n         } catch(Exception e) {\n             e.printStackTrace();"}, {"sha": "c3a28c95e9c2dab7a48351294bf25d46ca62e59d", "filename": "wz/Map.wz/Map/Map3/300000100.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Map.wz/Map/Map3/300000100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Map.wz/Map/Map3/300000100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map3/300000100.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -1314,7 +1314,7 @@\n       <int name=\"x\" value=\"259\"/>\n       <int name=\"y\" value=\"88\"/>\n       <int name=\"tm\" value=\"222020400\"/>\n-      <string name=\"tn\" value=\"in00\"/>\n+      <string name=\"tn\" value=\"in01\"/>\n     </imgdir>\n     <imgdir name=\"2\">\n       <string name=\"pn\" value=\"in00\"/>"}, {"sha": "46adf93101ac0300d846f16349161fcff0e4e884", "filename": "wz/Map.wz/Map/Map9/930000200.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Map.wz/Map/Map9/930000200.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Map.wz/Map/Map9/930000200.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map9/930000200.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -458,7 +458,7 @@\n       <string name=\"id\" value=\"3002000\"/>\n       <int name=\"x\" value=\"1057\"/>\n       <int name=\"y\" value=\"188\"/>\n-      <int name=\"reactorTime\" value=\"0\"/>\n+      <int name=\"reactorTime\" value=\"1\"/>\n       <int name=\"f\" value=\"0\"/>\n       <string name=\"name\" value=\"\"/>\n     </imgdir>"}, {"sha": "09757970c0ac38d84217c87b33d3387521ed29b3", "filename": "wz/Quest.wz/Act.img.xml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Quest.wz/Act.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Quest.wz/Act.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Act.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -12075,6 +12075,7 @@\n       <imgdir name=\"item\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4031856\"/>\n+          <int name=\"count\" value=\"-15\"/>\n         </imgdir>\n       </imgdir>\n     </imgdir>\n@@ -12094,6 +12095,7 @@\n       <imgdir name=\"item\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4031857\"/>\n+          <int name=\"count\" value=\"-15\"/>\n         </imgdir>\n       </imgdir>\n     </imgdir>"}, {"sha": "e0724ce7042739825cd1f6b3b1c67e66d1a61ce8", "filename": "wz/Reactor.wz/2408001.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Reactor.wz/2408001.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Reactor.wz/2408001.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Reactor.wz/2408001.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -93,7 +93,7 @@\n       <int name=\"z\" value=\"0\"/>\n       <int name=\"delay\" value=\"130\"/>\n     </canvas>\n-    <int name=\"rpeat\" value=\"1\"/>\n+    <int name=\"repeat\" value=\"1\"/>\n     <imgdir name=\"event\">\n       <imgdir name=\"0\">\n         <int name=\"type\" value=\"0\"/>"}, {"sha": "ebc3d205a48cfc918cc29a06bff288dde980b775", "filename": "wz/Reactor.wz/3002000.img.xml", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Reactor.wz/3002000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/Reactor.wz/3002000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Reactor.wz/3002000.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -25,13 +25,6 @@\n       <vector name=\"origin\" x=\"170\" y=\"50\"/>\n       <int name=\"z\" value=\"0\"/>\n     </canvas>\n-    <imgdir name=\"event\">\n-      <imgdir name=\"0\">\n-        <int name=\"type\" value=\"101\"/>\n-        <int name=\"state\" value=\"0\"/>\n-      </imgdir>\n-      <int name=\"timeOut\" value=\"2000\"/>\n-    </imgdir>\n   </imgdir>\n   <string name=\"action\" value=\"pFItem0\"/>\n </imgdir>"}, {"sha": "df84fbb3806db1747a384d51591f0576b62cab2e", "filename": "wz/String.wz/Consume.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/String.wz/Consume.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/828a8a02a2d1496722ac85c529028a33bfa134fb/wz/String.wz/Consume.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Consume.img.xml?ref=828a8a02a2d1496722ac85c529028a33bfa134fb", "patch": "@@ -6633,7 +6633,7 @@\n     <string name=\"desc\" value=\"A card that features Leviathan.n#cIf hunting around the area of Dragon ForestnItem/Meso drop rate will be increased#\"/>\n   </imgdir>\n   <imgdir name=\"2388039\">\n-    <string name=\"name\" value=\"Poison Golme Card\"/>\n+    <string name=\"name\" value=\"Poison Golem Card\"/>\n     <string name=\"desc\" value=\"A picture of Poison Golem is on this card.n#cWhile hunting in Ellin ForestnDrop rate of item and meso increase#\"/>\n   </imgdir>\n   <imgdir name=\"2388040\">"}]}]},
