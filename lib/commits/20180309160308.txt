{"fetchDate": "2019-12-19", "content": [{"sha": "77234e29df091fc8e72d341062461f23300fe9f5", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6NzcyMzRlMjlkZjA5MWZjOGU3MmQzNDEwNjI0NjFmMjMzMDBmZTlmNQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-09T16:03:08Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-09T16:03:08Z"}, "message": "Extra MP gain & Expired pet patch\n\nFixed \"extra MaxMP gain with INT accounting\" being given to a leveled up character even when the flag USE_RANDOMIZE_HPMP_GAIN is set to false.\nSolved an issue with pets upon expiration, that would render the pet no longer being able to be unequipped until WoL applied.", "tree": {"sha": "cbf96d54f27f033b97931f07269a033c77c2f202", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/cbf96d54f27f033b97931f07269a033c77c2f202"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/77234e29df091fc8e72d341062461f23300fe9f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/77234e29df091fc8e72d341062461f23300fe9f5", "html_url": "https://github.com/ronancpl/HeavenMS/commit/77234e29df091fc8e72d341062461f23300fe9f5", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/77234e29df091fc8e72d341062461f23300fe9f5/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90ed45d1c393a5421abe0df9abc0ee8af329b9d0", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/90ed45d1c393a5421abe0df9abc0ee8af329b9d0", "html_url": "https://github.com/ronancpl/HeavenMS/commit/90ed45d1c393a5421abe0df9abc0ee8af329b9d0"}], "stats": {"total": 135, "additions": 100, "deletions": 35}, "files": [{"sha": "e069a60282f086f7ba7780ebaa295d59738bc549", "filename": "README.md", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -25,9 +25,18 @@ Recommended localhost: https://hostr.co/r5QDmhlxpp8M\n * MapleSilver's starting on window-mode, with some string fixes. This is a variation of Fraysa's https://hostr.co/gJbLZITRVHmv\n \n ---\n+### Support us\n+\n+Feel free to __root for us__ on our endeavour at our Discord channel, or even actively **help us improve** the server by issuing pull requests with informative details about what's changing.\n+\n+Also, if you liked this project, please don't forget to __star__ the repo ;) .\n+\n+Discord: https://discord.gg/Q7wKxHX\n+\n ### Donation\n \n-If you liked what you have seen on the project, donate a little something as a helping hand for my contributions towards Maple development.\n+If you REALLY liked what you have seen on the project, please feel free to donate a little something as a helping hand for my contributions towards Maple development. Also remember to **support Nexon**!\n+\n Paypal: https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3K8KVTWRLFBQ4\n \n ---"}, {"sha": "5342e10783cff3feb7772460b09eae7442684c8b", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -821,4 +821,8 @@ Resolvido problemas com loots n\u00e3o diferenciando partyids de playerids, al\u00e9m de\n Resolvido caso de deadlock no MapleMap (uso de broadcastMessage, que usa chrLock, ap\u00f3s adquirido objectLock).\n Refatorado dano/cura em mobs, agora encapsulando atomicamente as mudan\u00e7as de HP. Resolvido tamb\u00e9m problemas de acesso concorrente quanto a isso.\n Resolvido problemas com HT e danos de status poison, bagun\u00e7ando as contabiliza\u00e7\u00f5es de HP de vez em quando.\n-Nova PQ: TreasurePQ, level 140+, acess\u00edvel via portal em NLC.\n\\ No newline at end of file\n+Nova PQ: TreasurePQ, level 140+, acess\u00edvel via portal em NLC.\n+\n+08 Mar\u00e7o 2018,\n+Corrigido levelup contabilizando o stat INT nos ganhos de MP mesmo quando a flag USE_RANDOMIZE_HPMP_GAIN est\u00e1 desativada.\n+Aprimorado comando de item/drop agora permitindo gerar pets.\n\\ No newline at end of file"}, {"sha": "5ee0327ee62566573eb3012cafab9557d31c2cda", "filename": "scripts/npc/2013001.js", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/scripts/npc/2013001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/scripts/npc/2013001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2013001.js?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -60,7 +60,6 @@ function action(mode, type, selection) {\n \n         switch(cm.getPlayer().getMapId()) {\n             case 920010000:\n-                print(eim.getIntProperty(\"statusStg0\"));\n                 if(eim.getIntProperty(\"statusStg0\") != 1) {\n                     eim.warpEventTeamToMapSpawnPoint(920010000, 2);\n                     eim.giveEventPlayersExp(3500);"}, {"sha": "be734ed60aa2c9f5b27bdbafb3b015c43da368c7", "filename": "scripts/quest/4659.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/scripts/quest/4659.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/scripts/quest/4659.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/4659.js?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -101,7 +101,7 @@ function end(mode, type, selection) {\n             qm.evolvePet(i, after);\n //            var petId = MaplePet.createPet(rand + 5000049, level, closeness, fullness);\n //            if (petId == -1) return;\n-//            MapleInventoryManipulator.addById(qm.getClient(), rand+5000049, 1, null, petId);\n+//            MapleInventoryManipulator.addById(qm.getClient(), rand+5000049, 1, \"\", petId);\n         } else\n             qm.dropMessage(1,\"Your inventory is full\");\n         qm.dispose();"}, {"sha": "da2cedfc8b46b2352f372f96c47d282f79f37d1a", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 22, "deletions": 8, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -2308,23 +2308,29 @@ public void run() {\n                                 item.setExpiration(-1);\n                                 forceUpdateItem(item);   //TEST :3\n                             } else if (expiration != -1 && expiration < currenttime) {\n-                                if(!ItemConstants.isPet(item.getItemId()) || ItemConstants.isExpirablePet(item.getItemId())) {\n+                                if(!ItemConstants.isPet(item.getItemId())) {\n                                     client.announce(MaplePacketCreator.itemExpired(item.getItemId()));\n                                     toberemove.add(item);\n                                     if(ItemConstants.isRateCoupon(item.getItemId())) {\n                                         deletedCoupon = true;\n                                     }\n                                 } else {\n-                                    item.setExpiration(-1);\n-                                    forceUpdateItem(item);\n+                                    if(item.getPetId() > -1) {\n+                                        int petIdx = getPetIndex(item.getPetId());\n+                                        if(petIdx > -1) unequipPet(getPet(petIdx), true);\n+                                    }\n+                                    \n+                                    if(ItemConstants.isExpirablePet(item.getItemId())) {\n+                                        client.announce(MaplePacketCreator.itemExpired(item.getItemId()));\n+                                        toberemove.add(item);\n+                                    } else {\n+                                        item.setExpiration(-1);\n+                                        forceUpdateItem(item);\n+                                    }\n                                 }\n                             }\n                         }\n                         for (Item item : toberemove) {\n-                            if(item.getPetId() > -1) {\n-                                int petIdx = getPetIndex(item.getPetId());\n-                                if(petIdx > -1) unequipPet(getPet(petIdx), true);\n-                            }\n                             MapleInventoryManipulator.removeFromSlot(client, inv.getType(), item.getPosition(), item.getQuantity(), true);\n                         }\n                         toberemove.clear();\n@@ -4880,7 +4886,15 @@ public void levelUp(boolean takeexp) {\n         if (improvingMaxMPLevel > 0 && (job.isA(MapleJob.MAGICIAN) || job.isA(MapleJob.CRUSADER) || job.isA(MapleJob.BLAZEWIZARD1))) {\n             maxmp += improvingMaxMP.getEffect(improvingMaxMPLevel).getX();\n         }\n-        maxmp += localint_ / 10;\n+        \n+        if (ServerConstants.USE_RANDOMIZE_HPMP_GAIN) {\n+            if (job.isA(MapleJob.MAGICIAN) || job.isA(MapleJob.BLAZEWIZARD1)) {\n+                maxmp += localint_ / 20;\n+            } else {\n+                maxmp += localint_ / 10;\n+            }\n+        }\n+        \n         if (takeexp) {\n             exp.addAndGet(-ExpTable.getExpNeededForLevel(level));\n             if (exp.get() < 0) {"}, {"sha": "7fa53eb4b4c2993f56a4be8d74d52f2226fccf7a", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 52, "deletions": 18, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -474,7 +474,7 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n \t\t\t\t\t\tps.close();\n                                                 con.close();\n \t\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\t\tplayer.dropMessage(\"There was a problem retreiving the required data. Please try again.\");\n+\t\t\t\t\t\tplayer.dropMessage(6, \"There was a problem retrieving the required data. Please try again.\");\n \t\t\t\t\t\te.printStackTrace();\n \t\t\t\t\t\tbreak;\n \t\t\t\t\t}\n@@ -602,7 +602,7 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n \n \t\t\t\t\t\t\tplayer.changeMap(event.getMapId());\n \t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tplayer.dropMessage(\"The limit of players for the event has already been reached.\");\n+\t\t\t\t\t\t\tplayer.dropMessage(5, \"The limit of players for the event has already been reached.\");\n \t\t\t\t\t\t}\n \t\t\t\t\t} else {\n \t\t\t\t\t\tplayer.dropMessage(5, \"You are already in the event.\");\n@@ -1060,7 +1060,7 @@ else if (type.equals(\"cash\")) {\n \t\t\t\t\t\t//victim.getEventInstance().registerPlayer(player);\n \t\t\t\t\t\tplayer.changeMap(victim.getEventInstance().getMapInstance(victim.getMapId()), victim.getMap().findClosestPortal(victim.getPosition()));\n \t\t\t\t\t} else {\n-\t\t\t\t\t\tplayer.dropMessage(\"Please change to channel \" + victim.getClient().getChannel());\n+\t\t\t\t\t\tplayer.dropMessage(6, \"Please change to channel \" + victim.getClient().getChannel());\n \t\t\t\t\t}\n \t\t\t\t} else {//If victim isn't in an event instance, just warp them.\n \t\t\t\t\tplayer.changeMap(victim.getMapId(), victim.getMap().findClosestPortal(victim.getPosition()));\n@@ -1070,7 +1070,7 @@ else if (type.equals(\"cash\")) {\n \t\t\t\t\tplayer.getClient().changeChannel(victim.getClient().getChannel());\n \t\t\t\t}\n \t\t\t} else {\n-\t\t\t\tplayer.dropMessage(\"Unknown player.\");\n+\t\t\t\tplayer.dropMessage(6, \"Unknown player.\");\n \t\t\t}\n                     break;\n                     \n@@ -1117,7 +1117,7 @@ else if (type.equals(\"cash\")) {\n \t\t\t\t\tvictim.getClient().changeChannel(player.getClient().getChannel());\n \t\t\t\t}\n \t\t\t} else {\n-\t\t\t\tplayer.dropMessage(\"Unknown player.\");\n+\t\t\t\tplayer.dropMessage(6, \"Unknown player.\");\n \t\t\t}\n                     break;\n                     \n@@ -1130,13 +1130,13 @@ else if (type.equals(\"cash\")) {\n                         victim = c.getWorldServer().getPlayerStorage().getCharacterByName(sub[1]);\n                         if(victim != null && victim.isLoggedin()) {\n                                 if (player.getClient().getChannel() != victim.getClient().getChannel()) {\n-                                        player.dropMessage(\"Player '\" + victim.getName() + \"' is at channel \" + victim.getClient().getChannel() + \".\");\n+                                        player.dropMessage(5, \"Player '\" + victim.getName() + \"' is at channel \" + victim.getClient().getChannel() + \".\");\n                                 } else {\n                                         MapleMap map = victim.getMap();\n                                         player.changeMap(map, map.findClosestPortal(victim.getPosition()));\n                                 }\n                         } else {\n-                                player.dropMessage(\"Unknown player.\");\n+                                player.dropMessage(6, \"Unknown player.\");\n                         }\n                     break;\n                 \n@@ -1156,31 +1156,65 @@ else if (type.equals(\"cash\")) {\n \t\t\t}\n                         \n \t\t\tint itemId = Integer.parseInt(sub[1]);\n-                        if(MapleItemInformationProvider.getInstance().getName(itemId) == null) {\n+                        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+                        \n+                        if(ii.getName(itemId) == null) {\n                                 player.yellowMessage(\"Item id '\" + sub[1] + \"' does not exist.\");\n                                 break;\n                         }\n                         \n-\t\t\tshort quantity = 1;\n+                        short quantity = 1;\n                         if(sub.length >= 3) quantity = Short.parseShort(sub[2]);\n \t\t\t\n-                        if (ItemConstants.isPet(itemId)) {\n-                                player.message(\"You cannot create a pet with this command.\");\n+                        if (ServerConstants.BLOCK_GENERATE_CASH_ITEM && ii.isCash(itemId)) {\n+                                player.yellowMessage(\"You cannot create a cash item with this command.\");\n                                 break;\n                         }\n                         \n+                        if (ItemConstants.isPet(itemId)) {\n+                                if (sub.length >= 3){   // thanks to istreety & TacoBell\n+                                        quantity = 1;\n+                                        long days = Math.max(1, Integer.parseInt(sub[2]));\n+                                        long expiration = System.currentTimeMillis() + (days * 24 * 60 * 60 * 1000);\n+                                        int petid = MaplePet.createPet(itemId);\n+                                        \n+                                        if(sub[0].equals(\"item\")) {\n+                                                MapleInventoryManipulator.addById(c, itemId, quantity, player.getName(), petid, expiration);\n+                                        } else {\n+                                                Item toDrop = new Item(itemId, (short) 0, quantity, petid);\n+                                                toDrop.setExpiration(expiration);\n+                                                \n+                                                toDrop.setOwner(\"\");\n+                                                if(player.gmLevel() < 3) {\n+                                                        byte b = toDrop.getFlag();\n+                                                        b |= ItemConstants.ACCOUNT_SHARING;\n+                                                        b |= ItemConstants.UNTRADEABLE;\n+\n+                                                        toDrop.setFlag(b);\n+                                                }\n+\n+                                                c.getPlayer().getMap().spawnItemDrop(c.getPlayer(), c.getPlayer(), toDrop, c.getPlayer().getPosition(), true, true);\n+                                        }\n+                                        \n+                                        break;\n+                                } else {\n+                                        player.yellowMessage(\"Pet Syntax: !item <itemid> <expiration>\");\n+                                        break;        \n+                                }\n+                        }\n+                        \n \t\t\tif (sub[0].equals(\"item\")) {\n \t\t\t\tbyte flag = 0;\n                                 if(player.gmLevel() < 3) {\n-                                    flag |= ItemConstants.ACCOUNT_SHARING;\n-                                    flag |= ItemConstants.UNTRADEABLE;\n+                                        flag |= ItemConstants.ACCOUNT_SHARING;\n+                                        flag |= ItemConstants.UNTRADEABLE;\n                                 }\n                                 \n                                 MapleInventoryManipulator.addById(c, itemId, quantity, player.getName(), -1, flag, -1);\n \t\t\t} else {\n \t\t\t\tItem toDrop;\n \t\t\t\tif (ItemConstants.getInventoryType(itemId) == MapleInventoryType.EQUIP) {\n-\t\t\t\t\ttoDrop = MapleItemInformationProvider.getInstance().getEquipById(itemId);\n+\t\t\t\t\ttoDrop = ii.getEquipById(itemId);\n \t\t\t\t} else {\n \t\t\t\t\ttoDrop = new Item(itemId, (short) 0, quantity);\n \t\t\t\t}\n@@ -1659,8 +1693,8 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\tfloat xpos = player.getPosition().x;\n \t\t\tfloat ypos = player.getPosition().y;\n \t\t\tfloat fh = player.getMap().getFootholds().findBelow(player.getPosition()).getId();\n-\t\t\tplayer.dropMessage(\"Position: (\" + xpos + \", \" + ypos + \")\");\n-\t\t\tplayer.dropMessage(\"Foothold ID: \" + fh);\n+\t\t\tplayer.dropMessage(6, \"Position: (\" + xpos + \", \" + ypos + \")\");\n+\t\t\tplayer.dropMessage(6, \"Foothold ID: \" + fh);\n                     break;\n         \n                 case \"togglecoupon\":\n@@ -1853,7 +1887,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n                                         map.damageMonster(player, monster, Integer.MAX_VALUE);\n                                 }\n \t\t\t}\n-\t\t\tplayer.dropMessage(\"Killed \" + monsters.size() + \" monsters.\");\n+\t\t\tplayer.dropMessage(5, \"Killed \" + monsters.size() + \" monsters.\");\n                     break;\n            \n \t\tcase \"notice\":\n@@ -2196,7 +2230,7 @@ public static boolean executeHeavenMsCommandLv4(Channel cserv, Server srv, Maple\n                                 hardsetItemStats((Equip) it, multiply);\n                                 MapleInventoryManipulator.addFromDrop(c, it);\n                         } else {\n-                                player.dropMessage(\"Make sure it's an equippable item.\");\n+                                player.dropMessage(6, \"Make sure it's an equippable item.\");\n                         }\n                         break;\n                     "}, {"sha": "7703f799896e301543bcf35860c2398a77fa1cee", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -84,6 +84,9 @@\n     \n     public static final int PARTY_EXPERIENCE_MOD = 1;               //Change for event stuff.\n     \n+    //Commands Configuration\n+    public static final boolean BLOCK_GENERATE_CASH_ITEM = false;   //Prevents creation of cash items with the item/drop command.\n+    \n     //Miscellaneous Configuration\n     public static final byte MIN_UNDERLEVEL_TO_EXP_GAIN = 5;        //Characters are unable to get EXP from a mob if their level are under this threshold, only if \"USE_ENFORCE_MOB_LEVEL_RANGE\" is enabled. For bosses, this attribute is doubled.\n     public static final byte MAX_MONITORED_BUFFSTATS = 5;           //Limits accounting for \"dormant\" buff effects, that should take place when stronger stat buffs expires."}, {"sha": "5d9ac714fd0ac4bd5d4804fa441f83785b78add2", "filename": "src/net/server/channel/handlers/DistributeAPHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/src/net/server/channel/handlers/DistributeAPHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/src/net/server/channel/handlers/DistributeAPHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DistributeAPHandler.java?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -104,7 +104,7 @@ private static int addHP(MapleClient c, boolean usedAPReset) {\n         return MaxHP + calcHpChange(player, job, usedAPReset);\n     }\n     \n-    public static int calcHpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n+    private static int calcHpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n         int MaxHP = 0;\n         \n         if (job.isA(MapleJob.WARRIOR) || job.isA(MapleJob.DAWNWARRIOR1)) {\n@@ -207,7 +207,7 @@ private static int addMP(MapleClient c, boolean usedAPReset) {\n         return MaxMP + calcMpChange(player, job, usedAPReset);\n     }\n     \n-    public static int calcMpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n+    private static int calcMpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n         int MaxMP = 0;\n         \n         if (job.isA(MapleJob.WARRIOR) || job.isA(MapleJob.DAWNWARRIOR1) || job.isA(MapleJob.ARAN1)) {"}, {"sha": "5163945ee3f1f8778909af0a6e0a00ade935f53b", "filename": "src/server/MapleInventoryManipulator.java", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/77234e29df091fc8e72d341062461f23300fe9f5/src/server/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/77234e29df091fc8e72d341062461f23300fe9f5/src/server/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleInventoryManipulator.java?ref=77234e29df091fc8e72d341062461f23300fe9f5", "patch": "@@ -70,7 +70,7 @@ public static boolean addById(MapleClient c, int itemId, short quantity, String\n         if (!type.equals(MapleInventoryType.EQUIP)) {\n             short slotMax = ii.getSlotMax(c, itemId);\n             List<Item> existing = c.getPlayer().getInventory(type).listById(itemId);\n-            if (!ItemConstants.isRechargable(itemId)) {\n+            if (!ItemConstants.isRechargable(itemId) && petid == -1) {\n                 if (existing.size() > 0) { // first update all existing slots to slotMax\n                     Iterator<Item> i = existing.iterator();\n                     while (quantity > 0) {\n@@ -151,7 +151,7 @@ public static boolean addFromDrop(MapleClient c, Item item) {\n     }\n     \n     public static boolean addFromDrop(MapleClient c, Item item, boolean show) {\n-        return addFromDrop(c, item, show, -1);\n+        return addFromDrop(c, item, show, item.getPetId());\n     }\n \n     public static boolean addFromDrop(MapleClient c, Item item, boolean show, int petId) {\n@@ -166,7 +166,7 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show, int pe\n         if (!type.equals(MapleInventoryType.EQUIP)) {\n             short slotMax = ii.getSlotMax(c, item.getItemId());\n             List<Item> existing = c.getPlayer().getInventory(type).listById(item.getItemId());\n-            if (!ItemConstants.isRechargable(item.getItemId())) {\n+            if (!ItemConstants.isRechargable(item.getItemId()) && petId == -1) {\n                 if (existing.size() > 0) { // first update all existing slots to slotMax\n                     Iterator<Item> i = existing.iterator();\n                     while (quantity > 0) {\n@@ -202,6 +202,8 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show, int pe\n                 }\n             } else {\n                 Item nItem = new Item(item.getItemId(), (short) 0, quantity, petId);\n+                nItem.setExpiration(item.getExpiration());\n+                \n                 short newSlot = c.getPlayer().getInventory(type).addItem(nItem);\n                 if (newSlot == -1) {\n                     c.announce(MaplePacketCreator.getInventoryFull());"}]}]},
