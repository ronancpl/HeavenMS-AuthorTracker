{"fetchDate": "2019-12-19", "content": [{"sha": "c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YzhmOTA1ZTFhNThmMWRhNWE4MWY2MzRlZDVhYTdmNTg3YTI2YWRkZQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-08T00:42:42Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-08T00:42:42Z"}, "message": "Fixed quest rewarding + Lethal attacks in Dojo\n\nFixed quests not giving items in some cases, lethal damages rendering\ndojo uncompletable and added new scripts.", "tree": {"sha": "0c3e743bf6edc4fbe76f20d5ad48aaa5543e4751", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/0c3e743bf6edc4fbe76f20d5ad48aaa5543e4751"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6935d3d3b875693e295b5c678e6550fafdd2052", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f6935d3d3b875693e295b5c678e6550fafdd2052", "html_url": "https://github.com/ronancpl/HeavenMS/commit/f6935d3d3b875693e295b5c678e6550fafdd2052"}], "stats": {"total": 14427, "additions": 7504, "deletions": 6923}, "files": [{"sha": "d96f2ca174adce0fc80f6bd3d7295910724341c9", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -131,4 +131,10 @@ Corre\n \n 06 Abril 2017,\n Tentativa de corre\ufffd\ufffdo em casos de falta de respawn em certas areas do jogo.\n-Otimiza\ufffd\ufffdo de fun\ufffd\ufffdes que lidam com popular ou despopular areas.\n\\ No newline at end of file\n+Otimiza\ufffd\ufffdo de fun\ufffd\ufffdes que lidam com popular ou despopular areas.\n+\n+07 Abril 2017,\n+Corre\ufffd\ufffdo nos m\ufffdtodos que completam quests, que n\ufffdo atribu\ufffdam corretamente itens que dependem de jobs.\n+Agora \ufffd poss\ufffdvel variar atributos de mobs a serem spawnados (classes ChangeableStats, OverrideStats).\n+Removido ataques letais (1HP/1MP) de bosses em Dojo, que tornava imposs\ufffdvel a completude do mesmo.\n+Adi\ufffd\ufffdo de novos scripts de evento no jogo.\n\\ No newline at end of file"}, {"sha": "6807a2ba1902a255b464065dd83188d73fbe6d01", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -2,16 +2,6 @@\n <project-private xmlns=\"http://www.netbeans.org/ns/project-private/1\">\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n-        <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/scripting/event/EventManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2012001.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/net/SendOpcode.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/server/life/SpawnPoint.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2012002.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMapFactory.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/tools/MaplePacketCreator.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/event/Boats.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMap.java</file>\n-        </group>\n+        <group/>\n     </open-files>\n </project-private>"}, {"sha": "1687a153fcd4694700530a39c76e2cb312321319", "filename": "scripts/event/0_EXAMPLE.js", "status": "added", "additions": 76, "deletions": 0, "changes": 76, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/event/0_EXAMPLE.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/event/0_EXAMPLE.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/0_EXAMPLE.js?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -0,0 +1,76 @@\n+function init() {\n+    // After loading, ChannelServer\n+}\n+\n+function setup(eim, leaderid) {\n+    // Setup the instance when invoked, EG : start PQ\n+}\n+\n+function playerEntry(eim, player) {\n+    // Warp player in etc..\n+}\n+\n+function changedMap(eim, player, mapid) {\n+    // What to do when player've changed map, based on the mapid\n+}\n+\n+function scheduledTimeout(eim) {\n+    // When event timeout..\n+\n+    // restartEventTimer(long time)\n+    // stopEventTimer()\n+    // startEventTimer(long time)\n+    // isTimerStarted()\n+}\n+\n+function allMonstersDead(eim) {\n+    // When invoking unregisterMonster(MapleMonster mob) OR killed\n+    // Happens only when size = 0\n+}\n+\n+function playerDead(eim, player) {\n+    // Happens when player dies\n+}\n+\n+function playerRevive(eim, player) {\n+    // Happens when player's revived.\n+    // @Param : returns true/false\n+}\n+\n+function playerDisconnected(eim, player) {\n+    // return 0 - Deregister player normally + Dispose instance if there are zero player left\n+    // return x that is > 0 - Deregister player normally + Dispose instance if there x player or below\n+    // return x that is < 0 - Deregister player normally + Dispose instance if there x player or below, if it's leader = boot all\n+}\n+\n+function monsterValue(eim, mobid) {\n+    // Invoked when a monster that's registered has been killed\n+    // return x amount for this player - \"Saved Points\"\n+}\n+\n+function leftParty(eim, player) {\n+    // Happens when a player left the party\n+}\n+\n+function disbandParty(eim, player) {\n+    // Happens when the party is disbanded by the leader.\n+}\n+\n+function clearPQ(eim) {\n+    // Happens when the function EventInstanceManager.finishPQ() is invoked by NPC/Reactor script\n+}\n+\n+function removePlayer(eim, player) {\n+    // Happens when the funtion NPCConversationalManager.removePlayerFromInstance() is invoked\n+}\n+\n+function registerCarnivalParty(eim, carnivalparty) {\n+    // Happens when carnival PQ is started. - Unused for now.\n+}\n+\n+function onMapLoad(eim, player) {\n+    // Happens when player change map - Unused for now.\n+}\n+\n+function cancelSchedule() {\n+}\n\\ No newline at end of file"}, {"sha": "2cc476082ef7c8518199ed5db5a17588e26df38d", "filename": "scripts/event/s4aWorld.js", "status": "added", "additions": 84, "deletions": 0, "changes": 84, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/event/s4aWorld.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/event/s4aWorld.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/s4aWorld.js?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -0,0 +1,84 @@\n+/*\n+ * 4th Job Snipe / Concentration\n+ */\n+\n+function init() {\n+    em.setProperty(\"started\", \"false\");\n+}\n+\n+function monsterValue(eim, mobId) {\n+    return 1;\n+}\n+\n+function setup() {\n+    var eim = em.newInstance(\"s4aWorld\");\n+\n+    eim.setInstanceMap(910500000).resetFully();\n+    eim.startEventTimer(1200000);\n+\n+    em.setProperty(\"started\", \"true\");\n+\n+    return eim;\n+}\n+\n+function playerEntry(eim, player) {\n+    var map = eim.getMapFactory().getMap(910500000);\n+    player.changeMap(map, map.getPortal(0));\n+}\n+\n+function playerDead(eim, player) {\n+}\n+\n+function playerRevive(eim, player) {\n+}\n+\n+function scheduledTimeout(eim) {\n+    eim.disposeIfPlayerBelow(100, 105090200);\n+\n+    em.setProperty(\"started\", \"false\");\n+}\n+\n+function changedMap(eim, player, mapid) {\n+    if (mapid != 910500000) {\n+\teim.unregisterPlayer(player);\n+\n+\tif (eim.disposeIfPlayerBelow(0, 0)) {\n+\t    em.setProperty(\"started\", \"false\");\n+\t}\n+    }\n+}\n+\n+function playerDisconnected(eim, player) {\n+    return 0;\n+}\n+\n+function leftParty(eim, player) {\n+    // If only 2 players are left, uncompletable:\n+    playerExit(eim, player);\n+}\n+\n+function disbandParty(eim) {\n+    //boot whole party and end\n+    eim.disposeIfPlayerBelow(100, 105090200);\n+\n+    em.setProperty(\"started\", \"false\");\n+}\n+\n+function playerExit(eim, player) {\n+    eim.unregisterPlayer(player);\n+    var map = eim.getMapFactory().getMap(105090200);\n+    player.changeMap(map, map.getPortal(0));\n+}\n+\n+function clearPQ(eim) {\n+    eim.disposeIfPlayerBelow(100, 105090200);\n+\n+    em.setProperty(\"started\", \"false\");\n+}\n+\n+function allMonstersDead(eim) {\n+//has nothing to do with monster killing\n+}\n+\n+function cancelSchedule() {\n+}\n\\ No newline at end of file"}, {"sha": "7161167a13d7299fabd0267015a9fc49c1236a7b", "filename": "scripts/npc/world0/1061012.js", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/npc/world0/1061012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/scripts/npc/world0/1061012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1061012.js?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -0,0 +1,62 @@\n+/*\n+\tNPC Name: \t\tInsiginificant Being\n+\tMap(s): \t\tDungeon : Another Entrance\n+\tDescription: \t\tTakes you to another Dimension\n+*/\n+\n+function start() {\n+    if (cm.getQuestStatus(6108) == 1) {\n+\tvar ret = checkJob();\n+\tif (ret == -1) {\n+\t    cm.sendOk(\"Please form a party and talk to me again.\");\n+\t} else if (ret == 0) {\n+\t    cm.sendOk(\"Please make sure that your party is a size of 2.\");\n+\t} else if (ret == 1) {\n+\t    cm.sendOk(\"One of your party member's job is not eligible for entering the other world.\");\n+\t} else if (ret == 2) {\n+\t    cm.sendOk(\"One of your party member's level is not eligible for entering the other world.\");\n+\t} else {\n+\t    var em = cm.getEventManager(\"s4aWorld\");\n+\t    if (em == null) {\n+\t\tcm.sendOk(\"You're not allowed to enter with unknown reason. Try again.\" );\n+\t    } else if (em.getProperty(\"started\").equals(\"true\")) {\n+\t\tcm.sendOk(\"Someone else is already attempting to defeat the Jr.Balrog in another world.\" );\n+\t    } else {\n+\t\tem.startInstance(cm.getParty(), cm.getMap());\n+\t    }\n+\t}\n+    }\n+    else {\n+        cm.sendOk(\"You're not allowed to enter the other world with unknown reason.\");\n+    }\n+    \n+    cm.dispose();\n+}\n+\n+function action(mode, type, selection) {\n+}\n+\n+function checkJob() {\n+    var party = cm.getParty();\n+\n+    if (party == null) {\n+\treturn -1;\n+    }\n+    //    if (party.getMembers().size() != 2) {\n+    //\treturn 0;\n+    //    }\n+    var it = party.getMembers().iterator();\n+\n+    while (it.hasNext()) {\n+\tvar cPlayer = it.next();\n+\n+\tif (cPlayer.getJobId() == 312 || cPlayer.getJobId() == 322 || cPlayer.getJobId() == 900) {\n+\t    if (cPlayer.getLevel() < 120) {\n+\t\treturn 2;\n+\t    }\n+\t} else {\n+\t    return 1;\n+\t}\n+    }\n+    return 3;\n+}\n\\ No newline at end of file"}, {"sha": "dd396c33e984b591a9bfcb2c4db225a2c1df0c58", "filename": "sql/db_database.sql", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -12786,8 +12786,8 @@ CREATE TABLE IF NOT EXISTS `drop_data_global` (\n ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC AUTO_INCREMENT=5 ;\n \n INSERT INTO `drop_data_global` (`id`, `continent`, `dropType`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`, `comments`) VALUES\n-(1, 0, 0, 4031865, 1, 1, 0, 150000, 'NX Card 100 PTS'),\n-(2, 0, 0, 4031866, 1, 1, 0, 90000, 'NX Card 250 PTS'),\n+(1, 0, 0, 4031865, 1, 1, 0, 125000, 'NX Card 100 PTS'),\n+(2, 0, 0, 4031866, 1, 1, 0, 78000, 'NX Card 250 PTS'),\n (3, 0, 0, 4001126, 1, 2, 0, 10000, 'Maple Leaves'),\n (4, 0, 0, 2049100, 1, 1, 0, 1500, 'Chaos Scroll 60%'),\n (5, 0, 0, 4001006, 1, 1, 0, 12000, 'Flaming Feather');"}, {"sha": "af01c549359bd325a5aa09c662f66a46c2c8465e", "filename": "sql/db_drops.sql", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -18839,9 +18839,9 @@\n   UPDATE drop_data SET questid=6191 WHERE itemid=4001107;\n   UPDATE drop_data SET questid=28344 WHERE itemid=4032475;\n \n-  UPDATE drop_data SET questid=77777 WHERE itemid=4001358;\t#id 77777 for ALL \"quest items\" with no v83 quest.\n-  UPDATE drop_data SET questid=77777 WHERE itemid=4001359;\n-  UPDATE drop_data SET questid=77777 WHERE itemid=4001342;\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4001358;\t#id 7777 for ALL \"quest items\" with no v83 quest.\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4001359;\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4001342;\n   UPDATE drop_data SET chance=0 WHERE itemid=2050099;\n   UPDATE drop_data SET chance=40000 WHERE itemid=4031991;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4031477;"}, {"sha": "9c1287f3e416be75451f5f316082f2fa1d324b96", "filename": "src/client/MapleJob.java", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/client/MapleJob.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/client/MapleJob.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleJob.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -123,4 +123,17 @@ public boolean isBeginner(MapleJob beginners) {\n     public boolean isA(MapleJob basejob) {        \n         return getId() >= basejob.getId() && getId() / 100 == basejob.getId() / 100;\n     }\n+    \n+    public int getJobNiche() {\n+        return (jobid / 100) % 10;\n+        \n+        /*\n+        case 0: BEGINNER;\n+        case 1: WARRIOR;\n+        case 2: MAGICIAN;\n+        case 3: BOWMAN;  \n+        case 4: THIEF;\n+        case 5: PIRATE;\n+        */\n+    }\n }"}, {"sha": "f399d8ebb0bcab54d6a781ad4c8ed5655e86f7e8", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -7,6 +7,17 @@\n  * @author kevintjuh93\n  */\n public class GameConstants {\n+    private static final int[] mobHpVal = {0, 15, 20, 25, 35, 50, 65, 80, 95, 110, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350,\n+        375, 405, 435, 465, 495, 525, 580, 650, 720, 790, 900, 990, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800,\n+        1900, 2000, 2100, 2200, 2300, 2400, 2520, 2640, 2760, 2880, 3000, 3200, 3400, 3600, 3800, 4000, 4300, 4600, 4900, 5200,\n+        5500, 5900, 6300, 6700, 7100, 7500, 8000, 8500, 9000, 9500, 10000, 11000, 12000, 13000, 14000, 15000, 17000, 19000, 21000, 23000,\n+        25000, 27000, 29000, 31000, 33000, 35000, 37000, 39000, 41000, 43000, 45000, 47000, 49000, 51000, 53000, 55000, 57000, 59000, 61000, 63000,\n+        65000, 67000, 69000, 71000, 73000, 75000, 77000, 79000, 81000, 83000, 85000, 89000, 91000, 93000, 95000, 97000, 99000, 101000, 103000,\n+        105000, 107000, 109000, 111000, 113000, 115000, 118000, 120000, 125000, 130000, 135000, 140000, 145000, 150000, 155000, 160000, 165000, 170000, 175000, 180000,\n+        185000, 190000, 195000, 200000, 205000, 210000, 215000, 220000, 225000, 230000, 235000, 240000, 250000, 260000, 270000, 280000, 290000, 300000, 310000, 320000,\n+        330000, 340000, 350000, 360000, 370000, 380000, 390000, 400000, 410000, 420000, 430000, 440000, 450000, 460000, 470000, 480000, 490000, 500000, 510000, 520000,\n+        530000, 550000, 570000, 590000, 610000, 630000, 650000, 670000, 690000, 710000, 730000, 750000, 770000, 790000, 810000, 830000, 850000, 870000, 890000, 910000};\n+    \n \n     public static int getHiddenSkill(final int skill) {\n         switch (skill) {\n@@ -96,4 +107,11 @@ public static boolean hasSPTable(MapleJob job) {\n                 return false;\n         }\n     }\n+        \n+    public static int getMonsterHP(final int level) {\n+        if (level < 0 || level >= mobHpVal.length) {\n+            return Integer.MAX_VALUE;\n+        }\n+        return mobHpVal[level];\n+    }\n }"}, {"sha": "5b46843fbe46e8a6628eb5382eeca6a0396a38cf", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -55,6 +55,9 @@\n     public static final double PET_AUTOHP_RATIO = 0.99;         //will automatically consume potions until given ratio of the MaxHP/MaxMP is reached.\n     public static final double PET_AUTOMP_RATIO = 0.99;\n     \n+    //Should bosses use 1HP,1MP attacks in dojo?\n+    public static final boolean USE_DEADLY_DOJO = false;\n+    \n     //Rates\n     public static final int EXP_RATE = 10;\n     public static final int MESO_RATE = 10;"}, {"sha": "0e864510e705536071775aa6f7b3f78660afce85", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -273,15 +273,14 @@ public void run() {\n                         Skill pickpocket = SkillFactory.getSkill(ChiefBandit.PICKPOCKET);\n                         int delay = 0;\n                         final int maxmeso = player.getBuffedValue(MapleBuffStat.PICKPOCKET).intValue();\n-                        for (Integer eachd : onedList) {\n-\t\t\t\t\t\t\t\n-\t\t\t\t\t\t\teachd += Integer.MAX_VALUE;\n+                        for (Integer eachd : onedList) {\t\t\t\t\n+                            eachd += Integer.MAX_VALUE;\n                             if (pickpocket.getEffect(player.getSkillLevel(pickpocket)).makeChanceResult()) {\n-\t\t\t\t\t\t\t\tfinal Integer eachdf;\n-\t\t\t\t\t\t\t\tif(eachd < 0)\n-\t\t\t\t\t\t\t\t\teachdf = eachd + Integer.MAX_VALUE;\n-\t\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t\t\teachdf = eachd;\n+\t\t\t\tfinal Integer eachdf;\n+\t\t\t\tif(eachd < 0)\n+\t\t\t\t\teachdf = eachd + Integer.MAX_VALUE;\n+\t\t\t\telse\n+\t\t\t\t\teachdf = eachd;\n \t\t\t\t\t\t\t\t\n                                 TimerManager.getInstance().schedule(new Runnable() {\n                                     @Override"}, {"sha": "4c95b0b7fd1e363893ae818eddf7e73b2d2d5284", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -30,6 +30,7 @@\n import client.inventory.MapleInventoryType;\n import client.status.MonsterStatus;\n import client.status.MonsterStatusEffect;\n+import constants.ServerConstants;\n import constants.skills.Aran;\n import constants.skills.Corsair;\n \n@@ -63,7 +64,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         int damage = slea.readInt();\n         int oid = 0, monsteridfrom = 0, pgmr = 0, direction = 0;\n         int pos_x = 0, pos_y = 0, fake = 0;\n-        boolean is_pgmr = false, is_pg = true;\n+        boolean is_pgmr = false, is_pg = true, is_deadly = false;\n         int mpattack = 0;\n         MapleMonster attacker = null;\n         final MapleMap map = player.getMap();\n@@ -111,6 +112,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (attackInfo != null) {\n \t            if (attackInfo.isDeadlyAttack()) {\n \t                mpattack = player.getMp() - 1;\n+                        is_deadly = true;\n \t            }\n \t            mpattack += attackInfo.getMpBurn();\n \t            MobSkill skill = MobSkillFactory.getMobSkill(attackInfo.getDiseaseSkill(), attackInfo.getDiseaseLevel());\n@@ -142,6 +144,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         if (damage == -1) {\n             fake = 4020002 + (player.getJob().getId() / 10 - 40) * 100000;\n         }\n+        \n+        //in dojo player cannot use pot, so deadly attacks should be turned off as well\n+        if(is_deadly && player.getMap().isDojoMap() && !ServerConstants.USE_DEADLY_DOJO) {\n+            damage = 0;\n+            mpattack = 0;\n+        }\n+        \n         if (damage == 0) {\n             player.getAutobanManager().addMiss();\n         } else {"}, {"sha": "450bd9c5c7778b2424a4c67a66f4a33bcadb99d3", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 54, "deletions": 3, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -30,6 +30,8 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Properties;\n+import java.util.concurrent.locks.Lock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n \n import javax.script.ScriptException;\n \n@@ -61,6 +63,8 @@\n \tprivate MapleExpedition expedition = null;\n         private List<Integer> mapIds = new LinkedList<Integer>();\n         private List<Boolean> isInstanced = new LinkedList<Boolean>();\n+        private final ReentrantReadWriteLock mutex = new ReentrantReadWriteLock();\n+        private final Lock rL = mutex.readLock(), wL = mutex.writeLock();\n         private boolean disposed = false;\n \n \tpublic EventInstanceManager(EventManager em, String name) {\n@@ -78,8 +82,16 @@ public void registerPlayer(MapleCharacter chr) {\n \t\tif (chr == null || !chr.isLoggedin()){\n \t\t\treturn;\n \t\t}\n-\t\ttry {\n-\t\t\tchars.add(chr);\n+                \n+                try {\n+                        wL.lock();\n+                        try {\n+                                chars.add(chr);\n+                        }\n+                        finally {\n+                                wL.unlock();\n+                        }\n+                        \n \t\t\tchr.setEventInstance(this);\n \t\t\tem.getIv().invokeFunction(\"playerEntry\", this, chr);\n \t\t} catch (ScriptException | NoSuchMethodException ex) {\n@@ -125,7 +137,13 @@ public void registerExpedition(MapleExpedition exped) {\n \t}\n \n \tpublic void unregisterPlayer(MapleCharacter chr) {\n-\t\tchars.remove(chr);\n+                wL.lock();\n+                try {\n+                    chars.remove(chr);\n+                } finally {\n+                    wL.unlock();\n+                }\n+            \n \t\tchr.setEventInstance(null);\n \t}\n \t\n@@ -346,4 +364,37 @@ public final MapleMap setInstanceMap(final int mapid) { //gets instance map from\n             isInstanced.add(false);\n             return this.getMapFactory().getMap(mapid);\n         }\n+        \n+        public final boolean disposeIfPlayerBelow(final byte size, final int towarp) {\n+            if (disposed) {\n+                return true;\n+            }\n+            MapleMap map = null;\n+            if (towarp > 0) {\n+                map = this.getMapFactory().getMap(towarp);\n+            }\n+\n+            wL.lock();\n+            try {\n+                if (chars != null && chars.size() <= size) {\n+                    final List<MapleCharacter> chrs = new LinkedList<MapleCharacter>(chars);\n+                    for (MapleCharacter chr : chrs) {\n+                        if (chr == null) {\n+                            continue;\n+                        }\n+                        unregisterPlayer(chr);\n+                        if (towarp > 0) {\n+                            chr.changeMap(map, map.getPortal(0));\n+                        }\n+                    }\n+                    dispose();\n+                    return true;\n+                }\n+            } catch (Exception ex) {\n+                ex.printStackTrace();\n+            } finally {\n+                wL.unlock();\n+            }\n+            return false;\n+        }\n }"}, {"sha": "a4ffa7cd8524c6bfde54717d6664ddfe35253d37", "filename": "src/server/life/ChangeableStats.java", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/ChangeableStats.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/ChangeableStats.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/ChangeableStats.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -0,0 +1,50 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package server.life;\n+\n+import constants.GameConstants;\n+\n+public class ChangeableStats extends OverrideMonsterStats {\n+\n+    public int watk, matk, wdef, mdef, level;\n+\n+    public ChangeableStats(MapleMonsterStats stats, OverrideMonsterStats ostats) {\n+        hp = ostats.getHp();\n+        exp = ostats.getExp();\n+        mp = ostats.getMp();\n+        watk = stats.getPADamage();\n+        matk = stats.getMADamage();\n+        wdef = stats.getPDDamage();\n+        mdef = stats.getMDDamage();\n+        level = stats.getLevel();\n+    }\n+\n+    public ChangeableStats(MapleMonsterStats stats, int newLevel, boolean pqMob) { // here we go i think\n+        final double mod = (double) newLevel / (double) stats.getLevel();\n+        final double hpRatio = (double) stats.getHp() / (double) stats.getExp();\n+        final double pqMod = (pqMob ? 1.5 : 1.0); // god damn\n+        hp = (int) Math.round((!stats.isBoss() ? GameConstants.getMonsterHP(newLevel) : (stats.getHp() * mod)) * pqMod); // right here lol\n+        exp = (int) Math.round((!stats.isBoss() ? (GameConstants.getMonsterHP(newLevel) / hpRatio) : (stats.getExp())) * pqMod);\n+        mp = (int) Math.round(stats.getMp() * mod * pqMod);\n+        watk = (int) Math.round(stats.getPADamage() * mod);\n+        matk = (int) Math.round(stats.getMADamage() * mod);\n+        wdef = Math.min(stats.isBoss() ? 30 : 20, (int) Math.round(stats.getPDDamage() * mod));\n+        mdef = Math.min(stats.isBoss() ? 30 : 20, (int) Math.round(stats.getMDDamage() * mod));\n+        level = newLevel;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "dceccf960024ecc65175cd41bb5e2120a6b8a185", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 33, "deletions": 1, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -63,7 +63,7 @@\n import tools.Randomizer;\n \n public class MapleMonster extends AbstractLoadedMapleLife {\n-\n+    private ChangeableStats ostats = null;  //unused, v83 WZs offers no support for changeable stats.\n     private MapleMonsterStats stats;\n     private int hp, mp;\n     private WeakReference<MapleCharacter> controller = new WeakReference<>(null);\n@@ -957,4 +957,36 @@ public int getPADamage() {\n     public Map<MonsterStatus, MonsterStatusEffect> getStati() {\n         return stati;\n     }\n+    \n+    // ---- one can always have fun trying these pieces of codes below in-game rofl ----\n+    \n+    public final ChangeableStats getChangedStats() {\n+\treturn ostats;\n+    }\n+\n+    public final int getMobMaxHp() {\n+        if (ostats != null) {\n+            return ostats.hp;\n+        }\n+        return stats.getHp();\n+    }\n+    \n+    public final void setOverrideStats(final OverrideMonsterStats ostats) {\n+        this.ostats = new ChangeableStats(stats, ostats);\n+        this.hp = ostats.getHp();\n+        this.mp = ostats.getMp();\n+    }\n+\t\n+    public final void changeLevel(final int newLevel) {\n+        changeLevel(newLevel, true);\n+    }\n+\n+    public final void changeLevel(final int newLevel, boolean pqMob) {\n+        if (!stats.isChangeable()) {\n+            return;\n+        }\n+        this.ostats = new ChangeableStats(stats, newLevel, pqMob);\n+        this.hp = ostats.getHp();\n+        this.mp = ostats.getMp();\n+    }\n }"}, {"sha": "2d7c5738c6555c3eea5e10d234cb7086e4610536", "filename": "src/server/life/MapleMonsterStats.java", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/MapleMonsterStats.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/MapleMonsterStats.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterStats.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -36,6 +36,7 @@\n  * @author Frz\n  */\n public class MapleMonsterStats {\n+    private boolean changeable;\n     private int exp, hp, mp, level, PADamage, PDDamage, MADamage, MDDamage, dropPeriod, cp, buffToGive, removeAfter;\n     private boolean boss, undead, ffaLoot, isExplosiveReward, firstAttack, removeOnMiss;\n     private String name;\n@@ -50,6 +51,14 @@\n     private selfDestruction selfDestruction = null;\n     private boolean friendly;\n \n+    public void setChange(boolean change) {\n+        this.changeable = change;\n+    }\n+\n+    public boolean isChangeable() {\n+        return changeable;\n+    }\n+    \n     public int getExp() {\n         return exp;\n     }"}, {"sha": "45be7fd624239964de95240a0be3315cea9d9a09", "filename": "src/server/life/OverrideMonsterStats.java", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/OverrideMonsterStats.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/life/OverrideMonsterStats.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/OverrideMonsterStats.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -0,0 +1,64 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package server.life;\n+\n+public class OverrideMonsterStats {\n+\n+    public int hp;\n+    public int exp, mp;\n+\n+    public OverrideMonsterStats() {\n+        hp = 1;\n+        exp = 0;\n+        mp = 0;\n+    }\n+\n+    public OverrideMonsterStats(int hp, int mp, int exp, boolean change) {\n+        this.hp = /*change ? (hp * 3L / 2L) : */ hp;\n+        this.mp = mp;\n+        this.exp = exp;\n+    }\n+\n+    public OverrideMonsterStats(int hp, int mp, int exp) {\n+        this(hp, mp, exp, true);\n+    }\n+\n+    public int getExp() {\n+        return exp;\n+    }\n+\n+    public void setOExp(int exp) {\n+        this.exp = exp;\n+    }\n+\n+    public int getHp() {\n+        return hp;\n+    }\n+\n+    public void setOHp(int hp) {\n+        this.hp = hp;\n+    }\n+\n+    public int getMp() {\n+        return mp;\n+    }\n+\n+    public void setOMp(int mp) {\n+        this.mp = mp;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "591e841247fcd7530c5718a79ff74e9678a403ae", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -368,22 +368,22 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob) {\n         final MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         final byte droptype = (byte) (mob.getStats().isExplosiveReward() ? 3 : mob.getStats().isFfaLoot() ? 2 : chr.getParty() != null ? 1 : 0);\n         final int mobpos = mob.getPosition().x;\n-        int chServerrate = chr.getDropRate();\n+        int chRate = chr.getDropRate();\n         Item idrop;\n         byte d = 1;\n         Point pos = new Point(0, mob.getPosition().y);\n \n         Map<MonsterStatus, MonsterStatusEffect> stati = mob.getStati();\n         if (stati.containsKey(MonsterStatus.SHOWDOWN)) {\n-            chServerrate *= (stati.get(MonsterStatus.SHOWDOWN).getStati().get(MonsterStatus.SHOWDOWN).doubleValue() / 100.0 + 1.0);\n+            chRate *= (stati.get(MonsterStatus.SHOWDOWN).getStati().get(MonsterStatus.SHOWDOWN).doubleValue() / 100.0 + 1.0);\n         }\n \n         final MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n         final List<MonsterDropEntry> dropEntry = new ArrayList<>(mi.retrieveDrop(mob.getId()));\n \n         Collections.shuffle(dropEntry);\n         for (final MonsterDropEntry de : dropEntry) {\n-            if (Randomizer.nextInt(999999) < de.chance * chServerrate) {\n+            if (Randomizer.nextInt(999999) < de.chance * chRate) {\n                 if (droptype == 3) {\n                     pos.x = (int) (mobpos + (d % 2 == 0 ? (40 * (d + 1) / 2) : -(40 * (d / 2))));\n                 } else {\n@@ -418,9 +418,7 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob) {\n                 } else {\n                     pos.x = (int) (mobpos + ((d % 2 == 0) ? (25 * (d + 1) / 2) : -(25 * (d / 2))));\n                 }\n-                if (de.itemId == 0) {\n-                    //chr.getCashShop().gainCash(1, 80);\n-                } else {\n+                if (de.itemId != 0) {\n                     if (ItemConstants.getInventoryType(de.itemId) == MapleInventoryType.EQUIP) {\n                         idrop = ii.randomizeStats((Equip) ii.getEquipById(de.itemId));\n                     } else {\n@@ -538,7 +536,6 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n                 if (damage > 0) {\n                     monster.damage(chr, damage);\n                     if (!monster.isAlive()) {  // monster just died\n-                        //killMonster(monster, chr, true);\n                         killed = true;\n                     }\n                 } else if (monster.getId() >= 8810002 && monster.getId() <= 8810009) {\n@@ -2437,4 +2434,16 @@ public void resetMapObjects() {\n     public void broadcastShip(final boolean state) {\n         broadcastMessage(MaplePacketCreator.boatPacket(state));\n     }\n+    \n+    public boolean isDojoMap() {\n+        return mapid >= 925020000 && mapid < 925040000;\n+    }\n+    \n+    public final void resetFully() {\n+        resetFully(true);\n+    }\n+\n+    public final void resetFully(final boolean respawn) {\n+        resetMapObjects();\n+    }\n }"}, {"sha": "8bb0ddb71ace35990d69be33b527a449b7e65386", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -104,7 +104,7 @@ private MapleQuest(int id) {\n         MapleData completeReqData = reqData.getChildByPath(\"1\");\n         if (completeReqData != null) {\n             for (MapleData completeReq : completeReqData.getChildren()) {\n-\t\t\t\tMapleQuestRequirementType type = MapleQuestRequirementType.getByWZName(completeReq.getName());\n+\t\tMapleQuestRequirementType type = MapleQuestRequirementType.getByWZName(completeReq.getName());\n                 MapleQuestRequirement req = this.getRequirement(type, completeReq);\n \t\t\t\tif(req == null)\n \t\t\t\t\tcontinue;\n@@ -222,6 +222,10 @@ public void complete(MapleCharacter c, int npc, Integer selection) {\n \t\t    for (MapleQuestAction a : completeActs.values()) {\n \t\t        a.run(c, selection);\n \t\t    }\n+                    \n+                    //dont seems to work...\n+                    //c.getClient().getSession().write(MaplePacketCreator.showForeignEffect(12)); // Quest completion\n+                    //c.getMap().broadcastMessage(c, MaplePacketCreator.showForeignEffect(c.getId(), 12), false);\n \t\t}\n     }\n "}, {"sha": "50e69da3d5495b6a629656410e6156d3d19538d9", "filename": "src/server/quest/MapleQuestRequirementType.java", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/MapleQuestRequirementType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/MapleQuestRequirementType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuestRequirementType.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -76,12 +76,12 @@ public static MapleQuestRequirementType getByWZName(String name) {\n             return INFO_EX;\n         } else if (name.equals(\"questComplete\")) {\n             return COMPLETED_QUEST;\n-\t\t} else if(name.equals(\"start\")) {\n-\t\t\treturn START;\n-\t\t} else if(name.equals(\"end\")) {\n-\t\t\treturn END;\n-\t\t} else if(name.equals(\"daybyday\")) {\n-\t\t\treturn DAY_BY_DAY;\n+\t} else if(name.equals(\"start\")) {\n+\t\treturn START;\n+\t} else if(name.equals(\"end\")) {\n+\t\treturn END;\n+\t} else if(name.equals(\"daybyday\")) {\n+\t\treturn DAY_BY_DAY;\n         } else {\n             return UNDEFINED;\n         }"}, {"sha": "fdd516a2d7fcdd8b30c01d6d7ef3cfdf06f0c147", "filename": "src/server/quest/actions/ItemAction.java", "status": "modified", "additions": 23, "deletions": 8, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/actions/ItemAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/actions/ItemAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/ItemAction.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -178,14 +178,29 @@ private boolean canGetItem(ItemData item, MapleCharacter chr) {\n \t\tif (item.getGender() != 2 && item.getGender() != chr.getGender()) {\n \t\t\treturn false;\n \t\t}\n-\t\t\n-\t\tif(item.getJob() != -1) {\n-\t\t\tif (item.getJob() != chr.getJob().getId()) {\n-\t\t\t\t\treturn false;\n-\t\t\t} else if (MapleJob.getBy5ByteEncoding(item.getJob()).getId() / 100 != chr.getJob().getId() / 100) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t}\n+                \n+                if (item.job > 0) {\n+                    final List<Integer> code = getJobBy5ByteEncoding(item.getJob());\n+                    boolean jobFound = false;\n+                    for (int codec : code) {\n+                        if (codec / 100 == chr.getJob().getId() / 100) {\n+                            jobFound = true;\n+                            break;\n+                        }\n+                    }\n+                    /*\n+                    if (!jobFound && item.jobEx > 0) {\n+                        final List<Integer> codeEx = getJobBySimpleEncoding(item.jobEx);\n+                        for (int codec : codeEx) {\n+                            if ((codec / 100 % 10) == (chr.getJob().getId() / 100 % 10)) {\n+                                jobFound = true;\n+                                break;\n+                            }\n+                        }\n+                    }\n+                    */\n+                    return jobFound;\n+                }\n         return true;\n     }\n \t"}, {"sha": "9bdd70d6839167d3de26906261f50225d99aa876", "filename": "src/server/quest/actions/MapleQuestAction.java", "status": "modified", "additions": 85, "deletions": 2, "changes": 87, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/actions/MapleQuestAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/server/quest/actions/MapleQuestAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/MapleQuestAction.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "patch": "@@ -11,6 +11,9 @@\n import server.quest.MapleQuest;\n import server.quest.MapleQuestActionType;\n \n+import java.util.List;\n+import java.util.ArrayList;\n+\n /**\n  *\n  * @author Tyler (Twdtwd)\n@@ -34,6 +37,86 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n \t}\n \t\n \tpublic MapleQuestActionType getType() {\n-        return type;\n-    }\n+                return type;\n+        }\n+        \n+        public static List<Integer> getJobBy5ByteEncoding(int encoded) {\n+                List<Integer> ret = new ArrayList<Integer>();\n+                if ((encoded & 0x1) != 0) {\n+                    ret.add(0);\n+                }\n+                if ((encoded & 0x2) != 0) {\n+                    ret.add(100);\n+                }\n+                if ((encoded & 0x4) != 0) {\n+                    ret.add(200);\n+                }\n+                if ((encoded & 0x8) != 0) {\n+                    ret.add(300);\n+                }\n+                if ((encoded & 0x10) != 0) {\n+                    ret.add(400);\n+                }\n+                if ((encoded & 0x20) != 0) {\n+                    ret.add(500);\n+                }\n+                if ((encoded & 0x400) != 0) {\n+                    ret.add(1000);\n+                }\n+                if ((encoded & 0x800) != 0) {\n+                    ret.add(1100);\n+                }\n+                if ((encoded & 0x1000) != 0) {\n+                    ret.add(1200);\n+                }\n+                if ((encoded & 0x2000) != 0) {\n+                    ret.add(1300);\n+                }\n+                if ((encoded & 0x4000) != 0) {\n+                    ret.add(1400);\n+                }\n+                if ((encoded & 0x8000) != 0) {\n+                    ret.add(1500);\n+                }\n+                if ((encoded & 0x20000) != 0) {\n+                    ret.add(2001); //im not sure of this one\n+                    ret.add(2200);\n+                }\n+                if ((encoded & 0x100000) != 0) {\n+                    ret.add(2000);\n+                    ret.add(2001); //?\n+                }\n+                if ((encoded & 0x200000) != 0) {\n+                    ret.add(2100);\n+                }\n+                if ((encoded & 0x400000) != 0) {\n+                    ret.add(2001); //?\n+                    ret.add(2200);\n+                }\n+\n+                if ((encoded & 0x40000000) != 0) { //i haven't seen any higher than this o.o\n+                    ret.add(3000);\n+                    ret.add(3200);\n+                    ret.add(3300);\n+                    ret.add(3500);\n+                }\n+                return ret;\n+        }\n+\n+        public static List<Integer> getJobBySimpleEncoding(int encoded) {\n+                List<Integer> ret = new ArrayList<Integer>();\n+                if ((encoded & 0x1) != 0) {\n+                    ret.add(200);\n+                }\n+                if ((encoded & 0x2) != 0) {\n+                    ret.add(300);\n+                }\n+                if ((encoded & 0x4) != 0) {\n+                    ret.add(400);\n+                }\n+                if ((encoded & 0x8) != 0) {\n+                    ret.add(500);\n+                }\n+                return ret;\n+        }\n }"}, {"sha": "9325e2e1aaab2a52b0d6823ae7c8030b78f92beb", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 6873, "deletions": 6869, "changes": 13742, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c8f905e1a58f1da5a81f634ed5aa7f587a26adde/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=c8f905e1a58f1da5a81f634ed5aa7f587a26adde"}]}]},
