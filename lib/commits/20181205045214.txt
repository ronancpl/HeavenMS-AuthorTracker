{"fetchDate": "2019-12-19", "content": [{"sha": "a17c2336938f12714aa354ad3a9b845b4ac2c66f", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YTE3YzIzMzY5MzhmMTI3MTRhYTM1NGFkM2E5Yjg0NWI0YWMyYzY2Zg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-12-05T04:52:14Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-12-05T04:52:14Z"}, "message": "Meso patch + Swift Dmg Reflect buff + GPQ Rewards + Starting Q. items\n\nFixed several RNG pool issues within several handler classes.\nFixed an overflow issue with mesos, that would cause players to lose all amount on inventory.\nChanged the code coupon SQL structure. Now nxcode_items.quantity is to be specified for both nx values and item quantities alike, instead of the use of \"quantity\" only when items are being provided.\nBob Snail now appears each 4 hours, instead of any time.\nRemoved duplicate command Warpto. Warpto merged with Reach command.\nFixed solo expeditions being disposed for \"lack of personnel\" after changing maps (normal limitations should not apply when USE_ENABLE_SOLO_EXPEDITIONS is enabled).\nFixed mobskills \"Weapon/Magic Reflect\" taking too long to show the active status over the mob's head.\nFixed a case with clean slate scroll not working as expected.\nImproved reward contents for the GPQ.\nFixed loot manager not acting properly when verifying one-of-a-kind contents.\nImplemented quest item requirement checkups to start quests. Items required to start a quest now should appear if the player did not start it yet, e.g.: SOS letter.\nFixed an issue with server message/boss HPbar switch interaction that would not work the moment after a player changed channels/entered Cash Shop.\nImproved Victoria Island worldmap design, at the Kerning subway area.", "tree": {"sha": "d759f724382e12c3339750d07cd3cbbbf06512c2", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/d759f724382e12c3339750d07cd3cbbbf06512c2"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/a17c2336938f12714aa354ad3a9b845b4ac2c66f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a17c2336938f12714aa354ad3a9b845b4ac2c66f", "html_url": "https://github.com/ronancpl/HeavenMS/commit/a17c2336938f12714aa354ad3a9b845b4ac2c66f", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a17c2336938f12714aa354ad3a9b845b4ac2c66f/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0910dc24282732922e045e23dc3179a089d925b8", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0910dc24282732922e045e23dc3179a089d925b8", "html_url": "https://github.com/ronancpl/HeavenMS/commit/0910dc24282732922e045e23dc3179a089d925b8"}], "stats": {"total": 966, "additions": 624, "deletions": 342}, "files": [{"sha": "be3bc589a5bcc69793942a9e4081f8a8b774399b", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1482,4 +1482,26 @@ Implementado script para questline de skill Aerial Strike.\n Corrigido limite do Cash Shop storage n\u00e3o atualizando corretamente quando jogador compra expans\u00e3o de 8.\n Atualizado guild rank de jogadores ao resetar guildid dos mesmos, agora evitando jogadores com rank acima de 5 mesmo sem guild.\n Adicionado restri\u00e7\u00e3o no sistema de partilha de EXP. Jogadores que possuem uma diferen\u00e7a de n\u00edvel com o last hitter satisfatoriamente grande n\u00e3o recebe este ganho.\n-Modificado nome de skill Maple Hero destacados em quest e itens para Maple Warrior.\n\\ No newline at end of file\n+Modificado nome de skill Maple Hero destacados em quest e itens para Maple Warrior.\n+\n+24 Novembro 2018,\n+Modificado pontos no c\u00f3digo com RNG especificado incorretamente (pool atuante com mais elementos que o esperado).\n+Corrigido problema de overflow de inteiro com mesos, causando perda total dos mesos do mesmo.\n+\n+27 - 29 Novembro 2018,\n+Modificado code coupons, agora utilizando a coluna de \"quantity\" para defini\u00e7\u00e3o de ganhos dos pontos de cash.\n+Removido m\u00faltiplos Bobs no mapa onde ele aparece. Bob's agora aparecem a cada 4 horas, e caracteristicamente liberam drops de Snails comuns com maiores chances.\n+Removido comando duplicado \"warpto\". Agora sua funcionalidade \u00e9 a mesma do comando \"reach\".\n+Expedi\u00e7\u00f5es agora n\u00e3o finaliza expedi\u00e7\u00f5es inapropriadamente por falta de pessoal quando flag que permite expedi\u00e7\u00f5es solo \u00e9 ativada.\n+Corrigido skill de mobs de \"refletir dano\" n\u00e3o atualizando devidamente o \u00edcone de status assim que a habilidade se ativa.\n+Corrigido clean slate scroll n\u00e3o atuando devidamente.\n+Adicionado diversas novas recompensas ao bonus da GPQ.\n+Corrigido sistema de detec\u00e7\u00e3o de loots n\u00e3o atuando corretamente ao lidar com itens one-of-a-kind.\n+Adicionado checagens de quest itens necess\u00e1rios para come\u00e7ar quests.\n+Corrigido sistema de server messages/boss HP bar n\u00e3o atuando de forma esperada ao mudar de canais/entrar no Cash Shop.\n+\n+01 Dezembro 2018,\n+Corrigido um problema com o gerador de code coupons, que levava em considera\u00e7\u00e3o hifens (\"-\") no c\u00f3digo do cupom, al\u00e9m de um problema de overflow na data de expira\u00e7\u00e3o.\n+\n+03 Dezembro 2018,\n+Melhorado desenho do worldmap de Victoria, na regi\u00e3o do metro de Kerning.\n\\ No newline at end of file"}, {"sha": "304abf01c08f9e2290d9024f21131ffe21c6328c", "filename": "handbook/Equip/Accessory.txt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/handbook/Equip/Accessory.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/handbook/Equip/Accessory.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/handbook/Equip/Accessory.txt?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1,16 +1,16 @@\n-1122040 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n+1122040 - Bronze Maple Necklace - A light-weight bronze Maple Necklace.\n 1122041 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n 1122042 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n 1122043 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n 1122044 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n 1122045 - Sealed Mind of Maple Necklace - A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\n-1122046 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n+1122046 - Silver Maple Necklace - A shiny silver Maple Necklace.\n 1122047 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122048 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122049 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122050 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122051 - Restoring Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n-1122052 - Awakening Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n+1122052 - Golden Maple Necklace - A Maple Necklace of 21 karats.\n 1122053 - Awakening Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122054 - Awakening Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\n 1122055 - Awakening Mind of Maple Necklace - A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level."}, {"sha": "93b71f145f0f7bc77fae1b358dfa3a3045adb403", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -241,7 +241,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -297,7 +297,7 @@ function changedLeader(eim, leader) {}\n function playerDead(eim, player) {}\n \n function playerRevive(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n@@ -309,7 +309,7 @@ function playerRevive(eim, player) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "9f488125752d826a36f4cfc10f1f24eae43d63b4", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -126,7 +126,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -143,7 +143,7 @@ function changedLeader(eim, leader) {}\n function playerDead(eim, player) {}\n \n function playerRevive(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n@@ -155,7 +155,7 @@ function playerRevive(eim, player) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "b29e631378787c711c72cda88118cfb17cb515ef", "filename": "scripts/event/PinkBeanBattle.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/PinkBeanBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/PinkBeanBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PinkBeanBattle.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -128,7 +128,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -169,7 +169,7 @@ function monsterRevive(eim, mob) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "d7d4b9ff1d9a0bbf5df6671b66d08d839989a530", "filename": "scripts/event/ScargaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ScargaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ScargaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ScargaBattle.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -112,7 +112,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -129,7 +129,7 @@ function changedLeader(eim, leader) {}\n function playerDead(eim, player) {}\n \n function playerRevive(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n@@ -141,7 +141,7 @@ function playerRevive(eim, player) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "f3504671a3bcfb9a305e4d6b0e9d1c2cb06164a4", "filename": "scripts/event/ShowaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ShowaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ShowaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ShowaBattle.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -119,7 +119,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -138,7 +138,7 @@ function playerDead(eim, player) {\n }\n \n function playerRevive(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n@@ -150,7 +150,7 @@ function playerRevive(eim, player) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "47b979b565295ad1b657d5eb0da6ac692b1327b1", "filename": "scripts/event/ZakumBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ZakumBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/event/ZakumBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumBattle.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -114,7 +114,7 @@ function scheduledTimeout(eim) {\n \n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n-\tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+\tif (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n             eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n@@ -131,7 +131,7 @@ function changedLeader(eim, leader) {}\n function playerDead(eim, player) {}\n \n function playerRevive(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n@@ -143,7 +143,7 @@ function playerRevive(eim, player) {\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+    if (eim.isExpeditionTeamLackingNow(true, minPlayers, player)) {\n         eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);"}, {"sha": "ac4d479224a263dc4f55412683531fcb90466506", "filename": "scripts/npc/2041026.js", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/2041026.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/2041026.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041026.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -42,15 +42,12 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.haveItem(4220046, 1)) {\n-                            if(cm.isQuestStarted(3250)) {\n-                                cm.completeQuest(3250);\n-                                cm.gainFame(11);\n-                            }\n-                            \n-                            cm.gainItem(4220046, -1);\n-                            cm.sendOk(\"You want to hand the #r#t4220046##k to me, right? Alright, I'll take it for you.\");\n+                                // quest completing here when \"forfeiting Timer's Egg\", as well as reporting missing quests on M. Shrine are thanks to drmdsr & Thora\n+                                \n+                                cm.gainItem(4220046, -1);\n+                                cm.sendOk(\"You want to hand the #r#t4220046##k to me, right? Alright, I'll take it for you.\");\n                         } else {\n-                            cm.sendOk(\"Hello there! I'm #b#p2041026##k, in charge of watching and reporting any paranormal activities in this area.\");\n+                                cm.sendOk(\"Hello there! I'm #b#p2041026##k, in charge of watching and reporting any paranormal activities in this area.\");\n                         }\n                         \n                         cm.dispose();"}, {"sha": "ac3158a2d63cb8d8b6c05c26b089f6518da00e8e", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -60,6 +60,7 @@ function writeFeatureTab_Skills() {\n \n function writeFeatureTab_Quests() {\n         addFeature(\"Doll house quest functional.\");\n+        addFeature(\"Q. items required to start quests shows up properly.\");\n         addFeature(\"Quests are now rewarding items properly.\");\n         addFeature(\"Selection of rewards works properly.\");\n         addFeature(\"Loads of quests have been patched.\");\n@@ -122,6 +123,7 @@ function writeFeatureTab_MonstersMapsReactors() {\n         addFeature(\"Implemented banish mob skill move.\");\n         addFeature(\"Redesigned HT mechanics: assemble & dmg taken.\");\n         addFeature(\"Implemented Zombify disease status.\");\n+        addFeature(\"Dmg Reflect mobskill icons no longer lags to display.\");\n         addFeature(\"Added Boss HP Bar for dozens of bosses.\");\n         addFeature(\"Game will favor showing the targeted boss HPbar.\");\n         addFeature(\"Boss HPBar & Srv Message toggle - GabrielSin's idea.\");"}, {"sha": "edfb3d3aa18c261b0d4f4e88051086dd5dc06cfb", "filename": "scripts/npc/credits.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/credits.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/scripts/npc/credits.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/credits.js?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -38,6 +38,7 @@ function writeServerStaff_HeavenMS() {\n         addPerson(\"Vcoc\", \"Freelance Developer\");\n         addPerson(\"Thora\", \"Contributor\");\n         addPerson(\"GabrielSin\", \"Contributor\");\n+        addPerson(\"Masterrulax\", \"Contributor\");\n         \n         setHistory(2015, 2018);\n }\n@@ -90,15 +91,16 @@ function writeServerStaff_OdinMS() {\n function writeServerStaff_Contributors() {\n         addPerson(\"Jvlaple\", \"Contributor\");\n         addPerson(\"Stereo\", \"Contributor\");\n+        addPerson(\"AngelSL\", \"Contributor\");\n         addPerson(\"Lerk\", \"Contributor\");\n         addPerson(\"Leifde\", \"Contributor\");\n         addPerson(\"ThreeStep\", \"Contributor\");\n         addPerson(\"RMZero213\", \"Contributor\");\n+        addPerson(\"ExtremeDevilz\", \"Contributor\");\n         addPerson(\"aaroncsn\", \"Contributor\");\n         addPerson(\"xQuasar\", \"Contributor\");\n         addPerson(\"Xterminator\", \"Contributor\");\n         addPerson(\"XoticStory\", \"Contributor\");\n-        addPerson(\"Masterrulax\", \"Contributor\");\n }\n \n function writeAllServerStaffs() {"}, {"sha": "a3635fa57491be22ef11435357a31924473946f7", "filename": "sql/db_database.sql", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -10259,7 +10259,6 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (10038, 8140101, 0, 500, 800, 0, 400000),\n (10039, 8140700, 0, 500, 800, 0, 400000),\n (10040, 8140701, 0, 600, 900, 0, 400000),\n-(10041, 9400551, 0, 1000, 5000, 0, 400000),\n (10042, 8190003, 0, 697, 1020, 0, 400000),\n (10043, 8190004, 0, 750, 1150, 0, 400000),\n (10044, 8190005, 0, 800, 1200, 0, 400000),"}, {"sha": "6b906b2ba7517faee996f7ba436e7ade2536746c", "filename": "sql/db_drops.sql", "status": "modified", "additions": 59, "deletions": 21, "changes": 80, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -2268,8 +2268,8 @@ USE `heavenms`;\n (2230104, 1082043, 1, 1, 0, 700), \n (2230104, 1332010, 1, 1, 0, 700), \n (2230104, 1052104, 1, 1, 0, 700), \n-(2230109, 4031209, 1, 1, 3072, 7000), \n-(9410016, 4031209, 1, 1, 3072, 7000), \n+(2230109, 4031209, 1, 1, 3072, 500000), \n+(9410016, 4031209, 1, 1, 3072, 500000), \n (2230109, 4131010, 1, 1, 0, 3000), \n (9410016, 4131010, 1, 1, 0, 3000), \n (2230109, 2000002, 1, 1, 0, 40000), \n@@ -2315,7 +2315,7 @@ USE `heavenms`;\n (2230109, 1002619, 1, 1, 0, 700), \n (9410016, 1002619, 1, 1, 0, 700), \n (2230200, 4000165, 1, 1, 0, 200000), \n-(2230200, 4031209, 1, 1, 3072, 7000), \n+(2230200, 4031209, 1, 1, 3072, 500000), \n (2230200, 4006000, 1, 1, 0, 7000), \n (2230200, 2000001, 1, 1, 0, 40000), \n (2230200, 2040501, 1, 1, 0, 750), \n@@ -2649,7 +2649,7 @@ USE `heavenms`;\n (9400247, 1492004, 1, 1, 0, 700), \n (9500107, 1492004, 1, 1, 0, 700),\n (3000006, 4000166, 1, 1, 0, 200000), \n-(3000006, 4031209, 1, 1, 3072, 7000),\n+(3000006, 4031209, 1, 1, 3072, 500000),\n (3000006, 4131003, 1, 1, 0, 3000), \n (3000006, 2000002, 1, 1, 0, 40000), \n (3000006, 2000003, 1, 1, 0, 40000), \n@@ -2964,7 +2964,7 @@ USE `heavenms`;\n (3210100, 1002178, 1, 1, 0, 700), \n (3210100, 1052107, 1, 1, 0, 700), \n (3230104, 4000167, 1, 1, 0, 200000),\n-(3230104, 4031209, 1, 1, 3072, 7000), \n+(3230104, 4031209, 1, 1, 3072, 500000), \n (3230104, 4030012, 1, 1, 0, 125000), \n (3230104, 2000002, 1, 1, 0, 40000), \n (3230104, 2022040, 1, 1, 0, 3000), \n@@ -4475,8 +4475,8 @@ USE `heavenms`;\n (3230303, 1482005, 1, 1, 0, 700), \n (3230405, 4000154, 1, 1, 0, 200000),\n (9410020, 4000154, 1, 1, 0, 200000), \n-(3230405, 4031209, 1, 1, 3072, 7000), \n-(9410020, 4031209, 1, 1, 3072, 7000), \n+(3230405, 4031209, 1, 1, 3072, 500000), \n+(9410020, 4031209, 1, 1, 3072, 500000), \n (3230405, 2002005, 1, 1, 0, 10000), \n (9410020, 2002005, 1, 1, 0, 10000), \n (3230405, 2022040, 1, 1, 0, 3000), \n@@ -5137,8 +5137,8 @@ USE `heavenms`;\n (9300233, 1052113, 1, 1, 0, 700), \n (4230200, 4000158, 1, 1, 0, 200000), \n (9410018, 4000158, 1, 1, 0, 200000), \n-(4230200, 4031209, 1, 1, 3072, 7000), \n-(9410018, 4031209, 1, 1, 3072, 7000), \n+(4230200, 4031209, 1, 1, 3072, 500000), \n+(9410018, 4031209, 1, 1, 3072, 500000), \n (4230200, 2022040, 1, 1, 0, 3000), \n (9410018, 2022040, 1, 1, 0, 3000), \n (4230200, 2040707, 1, 1, 0, 750), \n@@ -5169,8 +5169,8 @@ USE `heavenms`;\n (9410018, 1072110, 1, 1, 0, 700), \n (4230200, 1472014, 1, 1, 0, 700), \n (9410018, 1472014, 1, 1, 0, 700), \n-(4230201, 4031209, 1, 1, 3072, 7000), \n-(4230201, 2022040, 1, 1, 3072, 3000), \n+(4230201, 4031209, 1, 1, 3072, 500000), \n+(4230201, 2022040, 1, 1, 0, 3000), \n (4230201, 2000002, 1, 1, 0, 40000), \n (4230201, 2000003, 1, 1, 0, 40000), \n (4230201, 2002004, 1, 1, 0, 10000), \n@@ -5817,9 +5817,9 @@ USE `heavenms`;\n (4230124, 4000157, 1, 1, 0, 200000), \n (9300090, 4000157, 1, 1, 0, 200000), \n (9420501, 4000157, 1, 1, 0, 200000), \n-(4230124, 4031209, 1, 1, 3072, 7000), \n-(9300090, 4031209, 1, 1, 3072, 7000), \n-(9420501, 4031209, 1, 1, 3072, 7000), \n+(4230124, 4031209, 1, 1, 3072, 500000), \n+(9300090, 4031209, 1, 1, 3072, 500000), \n+(9420501, 4031209, 1, 1, 3072, 500000), \n (4230124, 4030012, 1, 1, 0, 125000), \n (9300090, 4030012, 1, 1, 0, 125000), \n (9420501, 4030012, 1, 1, 0, 125000), \n@@ -6049,7 +6049,7 @@ USE `heavenms`;\n (4230108, 1472018, 1, 1, 0, 700), \n (4230123, 4000156, 1, 1, 0, 200000), \n (4230123, 4000157, 1, 1, 0, 200000), \n-(4230123, 4031209, 1, 1, 3072, 7000), \n+(4230123, 4031209, 1, 1, 3072, 500000), \n (4230123, 4030012, 1, 1, 0, 125000), \n (4230123, 4003004, 1, 1, 0, 7000), \n (4230123, 4130015, 1, 1, 0, 3000), \n@@ -20167,7 +20167,7 @@ USE `heavenms`;\n (9400748, 1002858, 1, 1, 0, 40000),\n (9400748, 1002859, 1, 1, 0, 40000),\n (9400748, 1002860, 1, 1, 0, 40000),\n-(9400748, 1002861, 1, 1, 0, 80000),\n+(9400748, 1002861, 1, 1, 0, 40000),\n (9400001, 0, 56, 84, 0, 400000),\n (9400001, 4000065, 1, 1, 0, 400000),\n (9400001, 4130013, 1, 1, 0, 7000),\n@@ -20301,7 +20301,8 @@ USE `heavenms`;\n (6130103, 2022001, 1, 1, 0, 20000),\n (6130200, 2022001, 1, 1, 0, 20000),\n (6130201, 2022001, 1, 1, 0, 20000),\n-(2220000, 1322001, 1, 1, 0, 8000);\n+(2220000, 1322001, 1, 1, 0, 8000),\n+(9400551, 4031447, 1, 1, 0, 999999);\n \n # (dropperid, itemid, minqty, maxqty, questid, chance)\n \n@@ -20357,12 +20358,12 @@ USE `heavenms`;\n (8150000, 2290091, 1, 1, 0, 40000),\n (9300028, 2290093, 1, 1, 0, 100000),\n (9400514, 2290095, 1, 1, 0, 40000),\n-(9300028, 2290096, 1, 1, 0, 100000),\n+(9300028, 2290111, 1, 1, 0, 100000),\n (9400121, 2290101, 1, 1, 0, 40000),\n (9400580, 2290103, 1, 1, 0, 1000),\n (9400575, 2290107, 1, 1, 0, 1000),\n (8220007, 2290108, 1, 1, 0, 40000),\n-(9400300, 2290111, 1, 1, 0, 100000),\n+(9400300, 2290096, 1, 1, 0, 100000),\n (9400014, 2290112, 1, 1, 0, 40000),\n (8150302, 2290113, 1, 1, 0, 1000),\n (8200011, 2290114, 1, 1, 0, 1000),\n@@ -20502,6 +20503,16 @@ USE `heavenms`;\n   DELETE FROM temp_data WHERE dropperid=9300090;\n   DELETE FROM temp_data WHERE dropperid=9420501;\n \n+  -- missing content for Bob found thanks to drmdsr & Thora\n+  # normalize item drops for Bob the Snail\n+  INSERT INTO temp_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`)\n+  SELECT  9400551, temp_data.itemid, temp_data.minimum_quantity, temp_data.maximum_quantity, temp_data.questid, LEAST(temp_data.chance * 80, 999999)\n+  FROM    temp_data\n+  WHERE   temp_data.dropperid = 100100;\n+\n+  DELETE FROM temp_data WHERE dropperid=9400551 AND itemid=4000019;\n+  UPDATE IGNORE temp_data SET minimum_quantity=1000, maximum_quantity=5000 WHERE dropperid=9400551 AND itemid=0;\n+\n   # normalize item drops for left-side Pianus\n   DELETE FROM temp_data WHERE dropperid=8520000;\n \n@@ -20578,7 +20589,6 @@ USE `heavenms`;\n   UPDATE IGNORE temp_data SET chance=700 WHERE itemid=1302056;\n \n   UPDATE IGNORE temp_data SET dropperid=9000002 WHERE dropperid=9000000;\n-  UPDATE IGNORE temp_data SET questid=0 WHERE dropperid=2022354;\n   UPDATE IGNORE temp_data SET chance=600000 WHERE itemid=4000058;\n \n   # update USE drops that were supposed to be ETC\n@@ -20797,7 +20807,7 @@ USE `heavenms`;\n   UPDATE drop_data SET questid=20707 WHERE itemid=4032130;\n   UPDATE drop_data SET questid=28170 WHERE itemid=4001345;\n   UPDATE drop_data SET questid=7301 WHERE itemid=4001077;\n-  UPDATE drop_data SET chance=40000, questid=3250 WHERE itemid=4031992;\n+  UPDATE drop_data SET chance=100000, questid=3250 WHERE itemid=4031992;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4001107;\n   UPDATE drop_data SET questid=28344 WHERE itemid=4032475;\n   UPDATE drop_data SET questid=28248 WHERE itemid=4001358;\n@@ -22239,6 +22249,34 @@ USE `heavenms`;\n     (2112010, 2022441, 15, -1),\n     (2112015, 2022441, 15, -1);\n \n+  -- thanks donny (Croosade forums) for showing a lack on GPQ rewards\n+  # adding more rewards into GPQ bonus boxes\n+  INSERT INTO `reactordrops` (`reactorid`, `itemid`, `chance`, `questid`) VALUES\n+    (9202012, 1002379, 45, -1),\n+    (9202012, 1002383, 45, -1),\n+    (9202012, 1002401, 45, -1),\n+    (9202012, 1002408, 45, -1),\n+    (9202012, 1002646, 45, -1),\n+    (9202012, 1002739, 35, -1),\n+    (9202012, 1002740, 35, -1),\n+    (9202012, 1002856, 20, -1),\n+    (9202012, 1002857, 25, -1),\n+    (9202012, 1032046, 30, -1),\n+    (9202012, 1050127, 20, -1),\n+    (9202012, 1051140, 20, -1),\n+    (9202012, 1052148, 35, -1),\n+    (9202012, 1052149, 35, -1),\n+    (9202012, 1072342, 35, -1),\n+    (9202012, 1072343, 35, -1),\n+    (9202012, 1122040, 15, -1),\n+    (9202012, 1122046, 30, -1),\n+    (9202012, 1122052, 40, -1),\n+    (9202012, 1142153, 25, -1),\n+    (9202012, 1302049, 25, -1),\n+    (9202012, 1332053, 25, -1),\n+    (9202012, 1372011, 25, -1),\n+    (9202012, 1442046, 25, -1);\n+\n   # updates info for all cards on monster book\n   DROP TABLE `monstercarddata`;\n   CREATE TABLE IF NOT EXISTS `monstercarddata` ("}, {"sha": "47fe80b03476298e4f65faf5f9efc56cd71d45b2", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1583,7 +1583,6 @@ private void changeMapInternal(final MapleMap to, final Point pos, final byte[]\n         this.unregisterChairBuff();\n         this.clearBanishPlayerData();\n         this.closePlayerInteractions();\n-        this.resetPlayerAggro();\n         \n         client.announce(warpPacket);\n         map.removePlayer(this);\n@@ -2001,7 +2000,7 @@ public void deleteBuddy(int otherCid) {\n     \n     public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n             int cid = player.getId();\n-            if(!Server.getInstance().haveCharacterEntry(senderAccId, cid)) {\n+            if(!Server.getInstance().haveCharacterEntry(senderAccId, cid)) {    // thanks zera (EpiphanyMS) for pointing a critical exploit with non-authored character deletion request\n                     return false;\n             }\n             \n@@ -2979,7 +2978,7 @@ public void gainMeso(int gain, boolean show, boolean enableActions, boolean inCh\n         long nextMeso;\n         petLock.lock();\n         try {\n-            nextMeso = meso.get() + gain;\n+            nextMeso = (long) meso.get() + gain;  // thanks Thora for pointing integer overflow here\n             if (nextMeso > Integer.MAX_VALUE) {\n                 gain -= (nextMeso - Integer.MAX_VALUE);\n             } else if (nextMeso < 0) {\n@@ -4933,6 +4932,7 @@ public void closePlayerInteractions() {\n         closePlayerMessenger();\n         \n         client.closePlayerScriptInteractions();\n+        resetPlayerAggro();\n     }\n     \n     public void closeNpcShop() {\n@@ -5140,10 +5140,17 @@ public final MapleQuestStatus getQuestRemove(final MapleQuest quest) {\n     \n     public boolean needQuestItem(int questid, int itemid) {\n         if (questid <= 0) return true; //For non quest items :3\n-        if (this.getQuestStatus(questid) != 1) return false;\n         \n-        MapleQuest quest = MapleQuest.getInstance(questid);\n-        return getInventory(ItemConstants.getInventoryType(itemid)).countById(itemid) < quest.getItemAmountNeeded(itemid);\n+        int amountNeeded, questStatus = this.getQuestStatus(questid);\n+        if (questStatus == 0) {\n+            amountNeeded = MapleQuest.getInstance(questid).getStartItemAmountNeeded(itemid);\n+        } else if (questStatus != 1) {\n+            return false;\n+        } else {\n+            amountNeeded = MapleQuest.getInstance(questid).getCompleteItemAmountNeeded(itemid);\n+        }\n+        \n+        return amountNeeded > 0 && getInventory(ItemConstants.getInventoryType(itemid)).countById(itemid) < amountNeeded;\n     }\n \n     public int getRank() {"}, {"sha": "5cf01fe6600b3f2c805c441296aefe77a611542a", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -217,9 +217,8 @@ private void registerLv2Commands(){\n         addCommand(\"cleardrops\", 2, ClearDropsCommand.class);\n         addCommand(\"clearslot\", 2, ClearSlotCommand.class);\n         addCommand(\"warp\", 2, WarpCommand.class);\n-        addCommand(\"warpto\", 2, WarpToCommand.class);\n         addCommand(new String[]{\"warphere\", \"summon\"}, 2, SummonCommand.class);\n-        addCommand(new String[]{\"reach\", \"follow\"}, 2, ReachCommand.class);\n+        addCommand(new String[]{\"warpto\", \"reach\", \"follow\"}, 2, ReachCommand.class);\n         addCommand(\"gmshop\", 2, GmShopCommand.class);\n         addCommand(\"heal\", 2, HealCommand.class);\n         addCommand(\"item\", 2, ItemCommand.class);"}, {"sha": "a510070464ee14ebd520d3a61fe2679b4a348492", "filename": "src/client/command/commands/gm2/WarpToCommand.java", "status": "removed", "additions": 0, "deletions": 78, "changes": 78, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0910dc24282732922e045e23dc3179a089d925b8/src/client/command/commands/gm2/WarpToCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0910dc24282732922e045e23dc3179a089d925b8/src/client/command/commands/gm2/WarpToCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/WarpToCommand.java?ref=0910dc24282732922e045e23dc3179a089d925b8", "patch": "@@ -1,78 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.gm2;\n-\n-import client.command.Command;\n-import client.MapleClient;\n-import client.MapleCharacter;\n-import net.server.Server;\n-import net.server.channel.Channel;\n-\n-public class WarpToCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        if (params.length < 2) {\n-            player.yellowMessage(\"Syntax: !warpto <playername> <mapid>\");\n-            return;\n-        }\n-\n-        MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n-        if (victim == null) {//If victim isn't on current channel or isnt a character try and find him by loop all channels on current world.\n-            for (Channel ch : Server.getInstance().getChannelsFromWorld(c.getWorld())) {\n-                victim = ch.getPlayerStorage().getCharacterByName(params[0]);\n-                if (victim != null) {\n-                    break;//We found the person, no need to continue the loop.\n-                }\n-            }\n-        }\n-        if (victim != null) {//If target isn't null attempt to warp.\n-            //Remove warper from current event instance.\n-            if (player.getEventInstance() != null) {\n-                player.getEventInstance().unregisterPlayer(player);\n-            }\n-            //Attempt to join the victims warp instance.\n-            if (victim.getEventInstance() != null) {\n-                if (victim.getClient().getChannel() == player.getClient().getChannel()) {//just in case.. you never know...\n-                    //victim.getEventInstance().registerPlayer(player);\n-                    player.changeMap(victim.getEventInstance().getMapInstance(victim.getMapId()), victim.getMap().findClosestPortal(victim.getPosition()));\n-                } else {\n-                    player.dropMessage(6, \"Please change to channel \" + victim.getClient().getChannel());\n-                }\n-            } else {//If victim isn't in an event instance, just warp them.\n-                player.changeMap(victim.getMapId(), victim.getMap().findClosestPortal(victim.getPosition()));\n-            }\n-            if (player.getClient().getChannel() != victim.getClient().getChannel()) {//And then change channel if needed.\n-                player.dropMessage(\"Changing channel, please wait a moment.\");\n-                player.getClient().changeChannel(victim.getClient().getChannel());\n-            }\n-        } else {\n-            player.dropMessage(6, \"Unknown player.\");\n-        }\n-    }\n-}"}, {"sha": "09f58a4cd518cba0c816e4d9bfded2f0f3902630", "filename": "src/client/command/commands/gm3/GiveMesosCommand.java", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/command/commands/gm3/GiveMesosCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/client/command/commands/gm3/GiveMesosCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/GiveMesosCommand.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -40,18 +40,35 @@ public void execute(MapleClient c, String[] params) {\n             return;\n         }\n \n-        String recv_;\n-        int value_;\n+        String recv_, value_;\n+        long mesos_ = 0;\n+        \n         if (params.length == 2) {\n             recv_ = params[0];\n-            value_ = Integer.parseInt(params[1]);\n+            value_ = params[1];\n         } else {\n             recv_ = c.getPlayer().getName();\n-            value_ = Integer.parseInt(params[0]);\n+            value_ = params[0];\n         }\n+        \n+        try {\n+            mesos_ = Long.parseLong(value_);\n+            if (mesos_ > Integer.MAX_VALUE) {\n+                mesos_ = Integer.MAX_VALUE;\n+            } else if (mesos_ < Integer.MIN_VALUE) {\n+                mesos_ = Integer.MIN_VALUE;\n+            }\n+        } catch (NumberFormatException nfe) {\n+            if (value_.contentEquals(\"max\")) {  // \"max\" descriptor suggestion thanks to Vcoc\n+                mesos_ = Integer.MAX_VALUE;\n+            } else if (value_.contentEquals(\"min\")) {\n+                mesos_ = Integer.MIN_VALUE;\n+            }\n+        }\n+        \n         MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(recv_);\n         if (victim != null) {\n-            victim.gainMeso(value_, true);\n+            victim.gainMeso((int) mesos_, true);\n             player.message(\"MESO given.\");\n         } else {\n             player.message(\"Player '\" + recv_ + \"' could not be found on this channel.\");"}, {"sha": "adc928f9ec1a174536d166c0441b0ee54b7a97fc", "filename": "src/constants/CharsetConstants.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/constants/CharsetConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/constants/CharsetConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/CharsetConstants.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -7,7 +7,7 @@\n package constants;\n  \n /*\n- * Courtesy of GabrielSin (gabrielsin@playellin.net)\n+ * Thanks to GabrielSin (EllinMS) - gabrielsin@playellin.net\n  * Ellin\n  * MapleStory Server\n  * CharsetConstants"}, {"sha": "8ca837828e52ad097bb131e943523892b6ee8fe7", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -71,8 +71,6 @@ public static int getPlayerBonusExpRate(int slot) {\n         put(\"ellin\", 300000000);\n         put(\"nlc\", 600000000);\n         put(\"excavation\", 990000000);\n-        put(\"pianus\", 230040420);\n-        put(\"horntail\", 240060200);\n         put(\"mushmom\", 100000005);\n         put(\"griffey\", 240020101);\n         put(\"manon\", 240020401);\n@@ -85,7 +83,9 @@ public static int getPlayerBonusExpRate(int slot) {\n         put(\"shrine\", 800000000);\n         put(\"skelegon\", 240040511);\n         put(\"hpq\", 100000200);\n-        put(\"ht\", 240050400);\n+        put(\"pianus\", 230040420);\n+        put(\"horntail\", 240050400);\n+        put(\"pinkbean\", 270050000);\n         put(\"ariant\", 260000000);\n         put(\"magatia\", 261000000);\n         put(\"singapore\", 540000000);"}, {"sha": "3e2815dbd67c33275b917e4c10811837ff73f1e6", "filename": "src/net/PacketProcessor.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/PacketProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/PacketProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/PacketProcessor.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -261,6 +261,7 @@ public void reset(int channel) {\n             registerHandler(RecvOpcode.WATER_OF_LIFE, new UseWaterOfLifeHandler());\n             registerHandler(RecvOpcode.ADMIN_CHAT, new AdminChatHandler());\n             registerHandler(RecvOpcode.MOVE_DRAGON, new MoveDragonHandler());\n+            registerHandler(RecvOpcode.USE_ITEMUI, new UseItemCanvasHandler());\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "3759e2be3f131aef30ab3a0fe13e7848cae33c5c", "filename": "src/net/opcodes/RecvOpcode.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/opcodes/RecvOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/opcodes/RecvOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/RecvOpcode.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -188,9 +188,9 @@\n     CHECK_CASH(0xE4),\n     CASHSHOP_OPERATION(0xE5),\n     COUPON_CODE(0xE6),\n-    OPEN_ITEMUI(0xEB),\n-    CLOSE_ITEMUI(0xEC),\n-    USE_ITEMUI(0xED),\n+    OPEN_ITEMUI(0xEC),\n+    CLOSE_ITEMUI(0xED),\n+    USE_ITEMUI(0xEE),\n     MTS_OPERATION(0xFD),\n     USE_MAPLELIFE(0x100),\n     USE_HAMMER(0x104);"}, {"sha": "f177f0a038fe62c2565c6982423e631af4a5c929", "filename": "src/net/server/Server.java", "status": "modified", "additions": 78, "deletions": 77, "changes": 155, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -569,7 +569,7 @@ private void loadCouponRates(Connection c) throws SQLException {\n     }\n     \n     public List<Integer> getActiveCoupons() {\n-        synchronized(activeCoupons) {\n+        synchronized (activeCoupons) {\n             return activeCoupons;\n         }\n     }\n@@ -586,7 +586,7 @@ public void commitActiveCoupons() {\n     \n     public void toggleCoupon(Integer couponId) {\n         if(ItemConstants.isRateCoupon(couponId)) {\n-            synchronized(activeCoupons) {\n+            synchronized (activeCoupons) {\n                 if(activeCoupons.contains(couponId)) {\n                     activeCoupons.remove(couponId);\n                 }\n@@ -600,7 +600,7 @@ public void toggleCoupon(Integer couponId) {\n     }\n     \n     public void updateActiveCoupons() throws SQLException {\n-        synchronized(activeCoupons) {\n+        synchronized (activeCoupons) {\n             activeCoupons.clear();\n             Calendar c = Calendar.getInstance();\n \n@@ -1669,9 +1669,10 @@ public void unregisterLoginState(MapleClient c) {\n     }\n     \n     private void disconnectIdlesOnLoginState() {\n+        List<MapleClient> toDisconnect = new LinkedList<>();\n+        \n         srvLock.lock();\n         try {\n-            List<MapleClient> toDisconnect = new LinkedList<>();\n             long timeNow = System.currentTimeMillis();\n             \n             for(Entry<MapleClient, Long> mc : inLoginState.entrySet()) {\n@@ -1681,17 +1682,19 @@ private void disconnectIdlesOnLoginState() {\n             }\n             \n             for(MapleClient c : toDisconnect) {\n-                if(c.isLoggedIn()) {\n-                    c.disconnect(false, false);\n-                } else {\n-                    c.getSession().close(true);\n-                }\n-                \n                 inLoginState.remove(c);\n             }\n         } finally {\n             srvLock.unlock();\n         }\n+        \n+        for (MapleClient c : toDisconnect) {    // thanks Lei for pointing a deadlock issue with srvLock\n+            if(c.isLoggedIn()) {\n+                c.disconnect(false, false);\n+            } else {\n+                c.getSession().close(true);\n+            }\n+        }\n     }\n     \n     private void disconnectIdlesOnLoginTask() {\n@@ -1707,75 +1710,73 @@ public final Runnable shutdown(final boolean restart) {//no player should be onl\n         return new Runnable() {\n             @Override\n             public void run() {\n-                srvLock.lock();\n-                \n+                shutdownInternal(restart);\n+            }\n+        };\n+    }\n+    \n+    private synchronized void shutdownInternal(boolean restart) {\n+        System.out.println((restart ? \"Restarting\" : \"Shutting down\") + \" the server!\\r\\n\");\n+        if (getWorlds() == null) return;//already shutdown\n+        for (World w : getWorlds()) {\n+            w.shutdown();\n+        }\n+\n+        /*for (World w : getWorlds()) {\n+            while (w.getPlayerStorage().getAllCharacters().size() > 0) {\n                 try {\n-                    System.out.println((restart ? \"Restarting\" : \"Shutting down\") + \" the server!\\r\\n\");\n-                    if (getWorlds() == null) return;//already shutdown\n-                    for (World w : getWorlds()) {\n-                        w.shutdown();\n-                    }\n-                    \n-                    /*for (World w : getWorlds()) {\n-                        while (w.getPlayerStorage().getAllCharacters().size() > 0) {\n-                            try {\n-                                Thread.sleep(1000);\n-                            } catch (InterruptedException ie) {\n-                                System.err.println(\"FUCK MY LIFE\");\n-                            }\n-                        }\n-                    }\n-                    for (Channel ch : getAllChannels()) {\n-                        while (ch.getConnectedClients() > 0) {\n-                            try {\n-                                Thread.sleep(1000);\n-                            } catch (InterruptedException ie) {\n-                                System.err.println(\"FUCK MY LIFE\");\n-                            }\n-                        }\n-                    }*/\n-                    \n-                    List<Channel> allChannels = getAllChannels();\n-                    \n-                    if(ServerConstants.USE_THREAD_TRACKER) ThreadTracker.getInstance().cancelThreadTrackerTask();\n-                    \n-                    for (Channel ch : allChannels) {\n-                        while (!ch.finishedShutdown()) {\n-                            try {\n-                                Thread.sleep(1000);\n-                            } catch (InterruptedException ie) {\n-                                ie.printStackTrace();\n-                                System.err.println(\"FUCK MY LIFE\");\n-                            }\n-                        }\n-                    }\n-                    \n-                    resetServerWorlds();\n-                    \n-                    ThreadManager.getInstance().stop();\n-                    TimerManager.getInstance().purge();\n-                    TimerManager.getInstance().stop();\n-\n-                    System.out.println(\"Worlds + Channels are offline.\");\n-                    acceptor.unbind();\n-                    acceptor = null;\n-                    if (!restart) {\n-                        System.exit(0);\n-                    } else {\n-                        System.out.println(\"\\r\\nRestarting the server....\\r\\n\");\n-                        try {\n-                            instance.finalize();//FUU I CAN AND IT'S FREE\n-                        } catch (Throwable ex) {\n-                            ex.printStackTrace();\n-                        }\n-                        instance = null;\n-                        System.gc();\n-                        getInstance().init();//DID I DO EVERYTHING?! D:\n-                    }\n-                } finally {\n-                    srvLock.unlock();\n+                    Thread.sleep(1000);\n+                } catch (InterruptedException ie) {\n+                    System.err.println(\"FUCK MY LIFE\");\n                 }\n             }\n-        };\n+        }\n+        for (Channel ch : getAllChannels()) {\n+            while (ch.getConnectedClients() > 0) {\n+                try {\n+                    Thread.sleep(1000);\n+                } catch (InterruptedException ie) {\n+                    System.err.println(\"FUCK MY LIFE\");\n+                }\n+            }\n+        }*/\n+\n+        List<Channel> allChannels = getAllChannels();\n+\n+        if(ServerConstants.USE_THREAD_TRACKER) ThreadTracker.getInstance().cancelThreadTrackerTask();\n+\n+        for (Channel ch : allChannels) {\n+            while (!ch.finishedShutdown()) {\n+                try {\n+                    Thread.sleep(1000);\n+                } catch (InterruptedException ie) {\n+                    ie.printStackTrace();\n+                    System.err.println(\"FUCK MY LIFE\");\n+                }\n+            }\n+        }\n+\n+        resetServerWorlds();\n+\n+        ThreadManager.getInstance().stop();\n+        TimerManager.getInstance().purge();\n+        TimerManager.getInstance().stop();\n+\n+        System.out.println(\"Worlds + Channels are offline.\");\n+        acceptor.unbind();\n+        acceptor = null;\n+        if (!restart) {\n+            System.exit(0);\n+        } else {\n+            System.out.println(\"\\r\\nRestarting the server....\\r\\n\");\n+            try {\n+                instance.finalize();//FUU I CAN AND IT'S FREE\n+            } catch (Throwable ex) {\n+                ex.printStackTrace();\n+            }\n+            instance = null;\n+            System.gc();\n+            getInstance().init();//DID I DO EVERYTHING?! D:\n+        }\n     }\n }"}, {"sha": "2da805ecb602894d0f385ec402ca2d7373b15479", "filename": "src/net/server/channel/handlers/AdminCommandHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/AdminCommandHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/AdminCommandHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AdminCommandHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -55,7 +55,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 int[][] toSpawn = MapleItemInformationProvider.getInstance().getSummonMobs(slea.readInt());\n                 for (int z = 0; z < toSpawn.length; z++) {\n                     int[] toSpawnChild = toSpawn[z];\n-                    if (Randomizer.nextInt(101) <= toSpawnChild[1]) {\n+                    if (Randomizer.nextInt(100) < toSpawnChild[1]) {\n                         c.getPlayer().getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(toSpawnChild[0]), c.getPlayer().getPosition());\n                     }\n                 }"}, {"sha": "32c53365a1066c871fa97884f4b8fc590d18d7a7", "filename": "src/net/server/channel/handlers/CouponCodeHandler.java", "status": "modified", "additions": 22, "deletions": 12, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/CouponCodeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/CouponCodeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CouponCodeHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -62,17 +62,17 @@\n \n         ResultSet rs = ps.executeQuery();\n         while (rs.next()) {\n-            int type = rs.getInt(\"type\"), item = rs.getInt(\"item\");\n+            int type = rs.getInt(\"type\"), quantity = rs.getInt(\"quantity\");\n             \n             if (type < 5) {\n                 Integer i = couponPoints.get(type);\n                 if (i != null) {\n-                    couponPoints.put(type, i + item);\n+                    couponPoints.put(type, i + quantity);\n                 } else {\n-                    couponPoints.put(type, item);\n+                    couponPoints.put(type, quantity);\n                 }\n             } else {\n-                int quantity = rs.getInt(\"quantity\");\n+                int item = rs.getInt(\"item\");\n                 \n                 Integer i = couponItems.get(item);\n                 if (i != null) {\n@@ -108,7 +108,7 @@\n         \n         if (!couponPoints.isEmpty()) {\n             for (Entry<Integer, Integer> e : couponPoints.entrySet()) {\n-                ret.add(new Pair<>(e.getKey(), new Pair<>(e.getValue(), 777)));\n+                ret.add(new Pair<>(e.getKey(), new Pair<>(777, e.getValue())));\n             }\n         }\n         \n@@ -199,27 +199,37 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \n                     for (Pair<Integer, Pair<Integer, Integer>> p : codeRes.getRight()) {\n                         type = p.getLeft();\n-                        int item = p.getRight().getLeft();\n+                        int quantity = p.getRight().getRight();\n \n                         CashShop cs = c.getPlayer().getCashShop();\n                         switch (type) {\n                             case 0:\n                             case 4:\n-                                cs.gainCash(1, item);   //nxCredit\n+                                cs.gainCash(1, quantity);    //nxCredit\n                                 break;\n                             case 1:\n-                                cs.gainCash(2, item);   //maplePoint\n+                                cs.gainCash(2, quantity);    //maplePoint\n                                 break;\n                             case 2:\n-                                cs.gainCash(4, item);   //nxPrepaid\n+                                cs.gainCash(4, quantity);    //nxPrepaid\n                                 break;\n                             case 3:\n-                                cs.gainCash(1, item);\n-                                cs.gainCash(4, (item / 5000));\n+                                cs.gainCash(1, quantity);\n+                                cs.gainCash(4, (quantity / 5000));\n                                 break;\n \n                             default:\n-                                short qty = p.getRight().getRight().shortValue();\n+                                int item = p.getRight().getLeft();\n+                                \n+                                short qty;\n+                                if (quantity > Short.MAX_VALUE) {\n+                                    qty = Short.MAX_VALUE;\n+                                } else if (quantity < Short.MIN_VALUE) {\n+                                    qty = Short.MIN_VALUE;\n+                                } else {\n+                                    qty = (short) quantity;\n+                                }\n+                                \n                                 if (MapleItemInformationProvider.getInstance().isCash(item)) {\n                                     Item it = CashShop.generateCouponItem(item, qty);\n "}, {"sha": "56a2cbeff54886d8674cbf8ff37c384f3bdb9306", "filename": "src/net/server/channel/handlers/EnterMTSHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/EnterMTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/EnterMTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterMTSHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -86,6 +86,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 return;\n             }\n \n+            chr.closePlayerInteractions();\n+            \n             chr.unregisterChairBuff();\n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(chr.getId(), chr.getAllBuffs());\n             Server.getInstance().getPlayerBuffStorage().addDiseasesToStorage(chr.getId(), chr.getAllDiseases());"}, {"sha": "70c5157c481b17122275714f0daf00ade4baa392", "filename": "src/net/server/channel/handlers/HealOvertimeHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/HealOvertimeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/HealOvertimeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/HealOvertimeHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -43,7 +43,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         short healHP = slea.readShort();\n         if (healHP != 0) {\n-            abm.setTimestamp(8, timestamp, 4);  // thanks Vcoc for pointing out d/c happening here\n+            abm.setTimestamp(8, timestamp, 28);  // thanks Vcoc & Thora for pointing out d/c happening here\n             if ((abm.getLastSpam(0) + 1500) > timestamp) AutobanFactory.FAST_HP_HEALING.addPoint(abm, \"Fast hp healing\");\n             \n             int abHeal = 120 + (int)(20 * MapleMapFactory.getMapRecoveryRate(chr.getMapId())); // Sleepywood sauna and showa spa...\n@@ -58,7 +58,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n         short healMP = slea.readShort();\n         if (healMP != 0 && healMP < 1000) {\n-            abm.setTimestamp(9, timestamp, 4);\n+            abm.setTimestamp(9, timestamp, 28);\n             if ((abm.getLastSpam(1) + 1500) > timestamp) AutobanFactory.FAST_MP_HEALING.addPoint(abm, \"Fast mp healing\");\n             chr.addMP(healMP);\n             abm.spam(1, timestamp);"}, {"sha": "12ee733f75cb7c3d2da6be93363f3592ea8c1252", "filename": "src/net/server/channel/handlers/NewYearCardHandler.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/NewYearCardHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/NewYearCardHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/NewYearCardHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -37,7 +37,9 @@\n \n /**\n  *\n- * @author Ronan - header layout courtesy of Eric \n+ * @author Ronan\n+ * \n+ * Header layout thanks to Eric \n  */\n public final class NewYearCardHandler extends AbstractMaplePacketHandler {\n "}, {"sha": "40f559b41ce3eb5dba402dfab73e524d48037800", "filename": "src/net/server/channel/handlers/PetCommandHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/PetCommandHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/PetCommandHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetCommandHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -52,7 +52,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             return;\n         }\n         \n-        if (Randomizer.nextInt(101) <= petCommand.getProbability()) {\n+        if (Randomizer.nextInt(100) < petCommand.getProbability()) {\n             pet.gainClosenessFullness(chr, petCommand.getIncrease(), 0, command);\n             chr.getMap().broadcastMessage(MaplePacketCreator.commandResponse(chr.getId(), petIndex, false, command, false));\n         } else {"}, {"sha": "cd318e042cd77907ca1d61fded61fe069ea6df7e", "filename": "src/net/server/channel/handlers/QuestActionHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/QuestActionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/QuestActionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/QuestActionHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -36,7 +36,7 @@\n  */\n public final class QuestActionHandler extends AbstractMaplePacketHandler {\n     \n-    // isNpcNearby credits to gabriel.sin\n+    // isNpcNearby credits to GabrielSin\n     private static boolean isNpcNearby(SeekableLittleEndianAccessor slea, MapleCharacter player, MapleQuest quest, int npcId) {\n         Point playerP = null;\n         "}, {"sha": "f600d032e800fe14d654485a278543f7832948dd", "filename": "src/net/server/channel/handlers/ScrollHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/ScrollHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/ScrollHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScrollHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -74,7 +74,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         Item wscroll = null;\n \n         if (ItemConstants.isCleanSlate(scroll.getItemId())) {\n-            Map<String, Integer> eqStats = ii.getEquipStats(scroll.getItemId());\n+            Map<String, Integer> eqStats = ii.getEquipStats(toScroll.getItemId());  // clean slate issue found thanks to Masterrulax\n             if (eqStats == null || eqStats.get(\"tuc\") == 0) {\n                 c.announce(MaplePacketCreator.getInventoryFull());\n                 return;"}, {"sha": "b38e04a225bfe0b1f0dd628a73c717d99b480599", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -106,7 +106,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                                 for (loseItem loseItem : loseItems) {\n                                     type = ItemConstants.getInventoryType(loseItem.getId());\n                                     for (byte b = 0; b < loseItem.getX(); b++) {//LOL?\n-                                        if (Randomizer.nextInt(101) >= loseItem.getChance()) {\n+                                        if (Randomizer.nextInt(100) < loseItem.getChance()) {\n                                             if (chr.haveItem(loseItem.getId())) {\n                                                 pos.x = (int) (playerpos + ((d % 2 == 0) ? (25 * (d + 1) / 2) : -(25 * (d / 2))));\n                                                 MapleInventoryManipulator.removeById(c, type, loseItem.getId(), 1, false, false);"}, {"sha": "c266d97b4d2b86ef220fc05426963dc895c66401", "filename": "src/net/server/channel/handlers/UseItemCanvasHandler.java", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/UseItemCanvasHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/UseItemCanvasHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseItemCanvasHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -0,0 +1,14 @@\n+package net.server.channel.handlers;\n+\n+import client.MapleClient;\n+import net.AbstractMaplePacketHandler;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.MaplePacketCreator;\n+\n+public final class UseItemCanvasHandler extends AbstractMaplePacketHandler {\n+\n+    @Override\n+    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n+        c.announce(MaplePacketCreator.enableActions());\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "17d6f236f9d1b0860f87b177202d97cb77842944", "filename": "src/net/server/channel/handlers/UseSummonBagHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/UseSummonBagHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/net/server/channel/handlers/UseSummonBagHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseSummonBagHandler.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -54,7 +54,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             int[][] toSpawn = MapleItemInformationProvider.getInstance().getSummonMobs(itemId);\n             for (int z = 0; z < toSpawn.length; z++) {\n                 int[] toSpawnChild = toSpawn[z];\n-                if (Randomizer.nextInt(101) <= toSpawnChild[1]) {\n+                if (Randomizer.nextInt(100) < toSpawnChild[1]) {\n                     c.getPlayer().getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(toSpawnChild[0]), c.getPlayer().getPosition());\n                 }\n             }"}, {"sha": "4ccb8e7d43059cb7fed2d41cdb53368329102cdf", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1111,6 +1111,17 @@ public final boolean checkEventTeamLacking(boolean leavingEventMap, int minPlaye\n                 return false;\n         }\n         \n+        public final boolean isExpeditionTeamLackingNow(boolean leavingEventMap, int minPlayers, MapleCharacter quitter) {\n+                if(eventCleared) {\n+                        if(leavingEventMap && getPlayerCount() <= 1) return true;\n+                } else {\n+                        if(leavingEventMap && getLeaderId() == quitter.getId()) return true;\n+                        if(getPlayerCount() <= (ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS ? 1 : minPlayers)) return true;\n+                }\n+                \n+                return false;\n+        }\n+        \n         public final boolean isEventTeamLackingNow(boolean leavingEventMap, int minPlayers, MapleCharacter quitter) {\n                 if(eventCleared) {\n                         if(leavingEventMap && getPlayerCount() <= 1) return true;"}, {"sha": "2c5d838a9b3dc87240675377df3b7fe7116e67eb", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1001,7 +1001,7 @@ public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll\n                     if (!ServerConstants.USE_PERFECT_SCROLLING && !usingWhiteScroll && !ItemConstants.isCleanSlate(scrollId) && !assertGM) {\n                         nEquip.setUpgradeSlots((byte) (nEquip.getUpgradeSlots() - 1));\n                     }\n-                    if (Randomizer.nextInt(101) < stats.get(\"cursed\")) {\n+                    if (Randomizer.nextInt(100) < stats.get(\"cursed\")) {\n                         return null;\n                     }\n                 }\n@@ -1258,8 +1258,15 @@ public boolean isPickupRestricted(int itemId) {\n         if (pickupRestrictionCache.containsKey(itemId)) {\n             return pickupRestrictionCache.get(itemId);\n         }\n-        MapleData data = getItemData(itemId);\n-        boolean bRestricted = MapleDataTool.getIntConvert(\"info/only\", data, 0) == 1;\n+        \n+        boolean bRestricted = false;\n+        if(itemId != 0) {\n+            MapleData data = getItemData(itemId);\n+            if (data != null) {\n+                bRestricted = MapleDataTool.getIntConvert(\"info/only\", data, 0) == 1;\n+            }\n+        }\n+        \n         pickupRestrictionCache.put(itemId, bRestricted);\n         return bRestricted;\n     }"}, {"sha": "1e62e6f4103d1e61fcfb754712dd6d8c727fd465", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1303,7 +1303,8 @@ public boolean canUseSkill(MobSkill toUse) {\n         }\n         \n         int useLimit = toUse.getLimit();\n-        if (toUse.getSkillId() == 200) {\n+        int useSkillid = toUse.getSkillId();\n+        if (useSkillid == 200) {\n             int i = 0;\n             for (MapleMapObject mo : getMap().getMapObjects()) {\n                 if (mo.getType() == MapleMapObjectType.MONSTER) {\n@@ -1316,12 +1317,16 @@ public boolean canUseSkill(MobSkill toUse) {\n             if (map.isDojoMap()) {  // spawns in dojo should be unlimited\n                 useLimit = 0;\n             }\n+        } else if (useSkillid >= 143 && useSkillid <= 145) {\n+            if (this.isBuffed(MonsterStatus.WEAPON_REFLECT) || this.isBuffed(MonsterStatus.MAGIC_REFLECT)) {\n+                return false;\n+            }\n         }\n         \n         if (useLimit > 0) {\n             monsterLock.lock();\n             try {\n-                Integer times = this.skillsUsed.get(new Pair<>(toUse.getSkillId(), toUse.getSkillLevel()));\n+                Integer times = this.skillsUsed.get(new Pair<>(useSkillid, toUse.getSkillLevel()));\n                 if (times != null && times >= useLimit) {\n                     return false;\n                 }\n@@ -1334,7 +1339,7 @@ public boolean canUseSkill(MobSkill toUse) {\n         try {\n             /*\n             for (Pair<Integer, Integer> skill : usedSkills) {\n-                if (skill.getLeft() == toUse.getSkillId() && skill.getRight() == toUse.getSkillLevel()) {\n+                if (skill.getLeft() == useSkillid && skill.getRight() == toUse.getSkillLevel()) {\n                     return false;\n                 }\n             }"}, {"sha": "70242a96a9246727921b5524cdff80068fdbe9ce", "filename": "src/server/life/MobSkill.java", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/life/MobSkill.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/life/MobSkill.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MobSkill.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -214,20 +214,20 @@ public void applyEffect(MapleCharacter player, MapleMonster monster, boolean ski\n                 }\n                 break;\n \t    case 143: // Weapon Reflect\n-                    stats.put(MonsterStatus.WEAPON_REFLECT, Integer.valueOf(x));\n-                    stats.put(MonsterStatus.WEAPON_IMMUNITY, Integer.valueOf(x));\n+                    stats.put(MonsterStatus.WEAPON_REFLECT, 10);\n+                    stats.put(MonsterStatus.WEAPON_IMMUNITY, 10);\n                     reflection.add(x);\n \t\tbreak;\n \t    case 144: // Magic Reflect\n-                    stats.put(MonsterStatus.MAGIC_REFLECT, Integer.valueOf(x));\n-                    stats.put(MonsterStatus.MAGIC_IMMUNITY, Integer.valueOf(x));\n+                    stats.put(MonsterStatus.MAGIC_REFLECT, 10);\n+                    stats.put(MonsterStatus.MAGIC_IMMUNITY, 10);\n                     reflection.add(x);\n \t\tbreak;\n \t    case 145: // Weapon / Magic reflect\n-                    stats.put(MonsterStatus.WEAPON_REFLECT, Integer.valueOf(x));\n-                    stats.put(MonsterStatus.WEAPON_IMMUNITY, Integer.valueOf(x));\n-                    stats.put(MonsterStatus.MAGIC_REFLECT, Integer.valueOf(x));\n-                    stats.put(MonsterStatus.MAGIC_IMMUNITY, Integer.valueOf(x));\n+                    stats.put(MonsterStatus.WEAPON_REFLECT, 10);\n+                    stats.put(MonsterStatus.WEAPON_IMMUNITY, 10);\n+                    stats.put(MonsterStatus.MAGIC_REFLECT, 10);\n+                    stats.put(MonsterStatus.MAGIC_IMMUNITY, 10);\n                     reflection.add(x);\n                 break;\n             case 154: // accuracy up"}, {"sha": "2b2ae1156adfa4781ff8ca3e3133a8597c41ae25", "filename": "src/server/loot/MapleLootManager.java", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/loot/MapleLootManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/loot/MapleLootManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/loot/MapleLootManager.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -35,15 +35,28 @@\n public class MapleLootManager {\n     \n     private static boolean isRelevantDrop(MonsterDropEntry dropEntry, List<MapleCharacter> partyMembers, List<MapleLootInventory> partyInv) {\n+        int qStartAmount = 0, qCompleteAmount = 0;\n         MapleQuest quest = MapleQuest.getInstance(dropEntry.questid);\n-        int qItemAmount = quest != null ? quest.getItemAmountNeeded(dropEntry.itemId) : 0;\n+        if (quest != null) {\n+            qStartAmount = quest.getStartItemAmountNeeded(dropEntry.itemId);\n+            qCompleteAmount = quest.getCompleteItemAmountNeeded(dropEntry.itemId);\n+        }\n         \n-        boolean restricted = MapleItemInformationProvider.getInstance().isLootRestricted(dropEntry.itemId);\n+        boolean restricted = MapleItemInformationProvider.getInstance().isPickupRestricted(dropEntry.itemId);\n         for (int i = 0; i < partyMembers.size(); i++) {\n             MapleLootInventory chrInv = partyInv.get(i);\n             \n             if (dropEntry.questid > 0) {\n-                if (partyMembers.get(i).getQuestStatus(dropEntry.questid) != 1) {\n+                int qItemAmount, chrQuestStatus = partyMembers.get(i).getQuestStatus(dropEntry.questid);\n+                if (chrQuestStatus == 0) {\n+                    qItemAmount = qStartAmount;\n+                } else if (chrQuestStatus != 1) {\n+                    continue;\n+                } else {\n+                    qItemAmount = qCompleteAmount;\n+                }\n+                \n+                if (qItemAmount <= 0) {\n                     continue;\n                 }\n                 "}, {"sha": "58a1706c4a8be23472c0467c02de4ba2ff04117c", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -371,7 +371,16 @@ public short getId() {\n         return relevantMobs;\n     }\n \n-    public int getItemAmountNeeded(int itemid) {\n+    public int getStartItemAmountNeeded(int itemid) {\n+        MapleQuestRequirement req = startReqs.get(MapleQuestRequirementType.ITEM);\n+        if(req == null)\n+                return 0;\n+\t\t\n+        ItemRequirement ireq = (ItemRequirement) req;\n+        return ireq.getItemAmountNeeded(itemid);\n+    }\n+    \n+    public int getCompleteItemAmountNeeded(int itemid) {\n         MapleQuestRequirement req = completeReqs.get(MapleQuestRequirementType.ITEM);\n         if(req == null)\n                 return 0;"}, {"sha": "7481a2056a332e7cc7b0892b6f1c5ba86aa2fd18", "filename": "src/server/quest/requirements/ItemRequirement.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/quest/requirements/ItemRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/server/quest/requirements/ItemRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/ItemRequirement.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -97,7 +97,7 @@ public boolean check(MapleCharacter chr, Integer npcid) {\n \t}\n \t\n \tpublic int getItemAmountNeeded(int itemid) {\n-\t\tif(items.containsKey(itemid)) {\n+                if(items.containsKey(itemid)) {\n \t\t\treturn items.get(itemid);\n \t\t}\n \t\t"}, {"sha": "ecca589eb1f12ba48ea6af5598c522468d6392f3", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -1065,7 +1065,7 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.writeShort(chr.getHp());\n                 mplew.writeBool(false);\n                 mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(5);\n+                mplew.skip(8);\n                 return mplew.getPacket();\n         }\n         \n@@ -1082,7 +1082,7 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.writeInt(spawnPosition.x);    // spawn position placement thanks to Arnah (Vertisy)\n                 mplew.writeInt(spawnPosition.y);\n                 mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(5);\n+                mplew.skip(8);\n                 return mplew.getPacket();\n         }\n         "}, {"sha": "77afd116a686deed49cf7f66c800cebc77405607", "filename": "tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -239,10 +239,7 @@ protected CodeCouponDescriptor(String name, int quantity, int duration, int mapl\n     }\n     \n     private static String randomizeCouponCode() {\n-        StringBuilder rnd = new StringBuilder(Long.toHexString(Double.doubleToLongBits(Math.random())));\n-        rnd.setCharAt(5, '-');\n-        rnd.insert(11, '-');\n-        return rnd.toString();\n+        return Long.toHexString(Double.doubleToLongBits(Math.random())).substring(0, 15);\n     }\n     \n     private static String generateCouponCode() {\n@@ -276,7 +273,7 @@ private static void commitCodeCouponDescription(CodeCouponDescriptor recipe) thr\n         generatedKeys = null;\n         \n         PreparedStatement ps = con.prepareStatement(\"INSERT IGNORE INTO `nxcode` (`code`, `expiration`) VALUES (?, ?)\", Statement.RETURN_GENERATED_KEYS);\n-        ps.setLong(2, currentTime + (recipe.duration * 60 * 60 * 1000));\n+        ps.setLong(2, currentTime + ((long) recipe.duration * 60 * 60 * 1000));\n         \n         for(int i = 0; i < recipe.quantity; i++) {\n             ps.setString(1, generateCouponCode());\n@@ -300,10 +297,10 @@ private static void commitCodeCouponDescription(CodeCouponDescriptor recipe) thr\n             }\n         }\n         \n-        ps2.setInt(4, 0);\n+        ps2.setInt(3, 0);\n         if (recipe.nxCredit > 0) {\n             ps2.setInt(2, 0);\n-            ps2.setInt(3, recipe.nxCredit);\n+            ps2.setInt(4, recipe.nxCredit);\n             List<Integer> keys = getGeneratedKeys(ps);\n             \n             for(Integer codeid : keys) {\n@@ -314,7 +311,7 @@ private static void commitCodeCouponDescription(CodeCouponDescriptor recipe) thr\n         \n         if (recipe.maplePoint > 0) {\n             ps2.setInt(2, 1);\n-            ps2.setInt(3, recipe.maplePoint);\n+            ps2.setInt(4, recipe.maplePoint);\n             List<Integer> keys = getGeneratedKeys(ps);\n             \n             for(Integer codeid : keys) {\n@@ -325,7 +322,7 @@ private static void commitCodeCouponDescription(CodeCouponDescriptor recipe) thr\n         \n         if (recipe.nxPrepaid > 0) {\n             ps2.setInt(2, 2);\n-            ps2.setInt(3, recipe.nxPrepaid);\n+            ps2.setInt(4, recipe.nxPrepaid);\n             List<Integer> keys = getGeneratedKeys(ps);\n             \n             for(Integer codeid : keys) {"}, {"sha": "d41beb3bcc8431492b638410b3047dd6cef097cb", "filename": "wz/Character.wz/Accessory/01142153.img.xml", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Accessory/01142153.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Accessory/01142153.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Accessory/01142153.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -0,0 +1,122 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+<imgdir name=\"01142153.img\">\n+  <imgdir name=\"info\">\n+    <canvas name=\"icon\" width=\"33\" height=\"31\">\n+      <vector name=\"origin\" x=\"-1\" y=\"31\"/>\n+    </canvas>\n+    <canvas name=\"iconRaw\" width=\"33\" height=\"30\">\n+      <vector name=\"origin\" x=\"-1\" y=\"31\"/>\n+    </canvas>\n+    <string name=\"islot\" value=\"Me\"/>\n+    <string name=\"vslot\" value=\"Me\"/>\n+    <int name=\"reqJob\" value=\"0\"/>\n+    <int name=\"reqLevel\" value=\"21\"/>\n+    <int name=\"reqSTR\" value=\"0\"/>\n+    <int name=\"reqDEX\" value=\"0\"/>\n+    <int name=\"reqINT\" value=\"0\"/>\n+    <int name=\"reqLUK\" value=\"0\"/>\n+    <int name=\"incMHP\" value=\"80\"/>\n+    <int name=\"incMMP\" value=\"80\"/>\n+    <int name=\"tuc\" value=\"0\"/>\n+    <int name=\"price\" value=\"0\"/>\n+    <int name=\"tradeBlock\" value=\"1\"/>\n+    <int name=\"notSale\" value=\"1\"/>\n+    <int name=\"only\" value=\"1\"/>\n+    <int name=\"cash\" value=\"0\"/>\n+    <int name=\"medalTag\" value=\"82\"/>\n+    <imgdir name=\"level\">\n+      <imgdir name=\"info\">\n+        <imgdir name=\"1\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"2\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"3\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"4\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"5\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"6\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"7\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"8\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"9\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"10\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"11\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"12\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"13\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"14\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"15\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"16\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"17\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"18\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"19\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"20\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"21\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"22\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"23\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"24\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"25\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"26\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"27\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"28\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"29\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"30\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+      </imgdir>\n+    </imgdir>\n+  </imgdir>\n+</imgdir>"}, {"sha": "9a880a0e42499300d24ded8eff0701d8792b873c", "filename": "wz/Character.wz/Accessory/01142154.img.xml", "status": "added", "additions": 122, "deletions": 0, "changes": 122, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Accessory/01142154.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Accessory/01142154.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Accessory/01142154.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -0,0 +1,122 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+<imgdir name=\"01142154.img\">\n+  <imgdir name=\"info\">\n+    <canvas name=\"icon\" width=\"26\" height=\"33\">\n+      <vector name=\"origin\" x=\"-4\" y=\"32\"/>\n+    </canvas>\n+    <canvas name=\"iconRaw\" width=\"25\" height=\"33\">\n+      <vector name=\"origin\" x=\"-4\" y=\"32\"/>\n+    </canvas>\n+    <string name=\"islot\" value=\"Me\"/>\n+    <string name=\"vslot\" value=\"Me\"/>\n+    <int name=\"reqJob\" value=\"0\"/>\n+    <int name=\"reqLevel\" value=\"32\"/>\n+    <int name=\"reqSTR\" value=\"0\"/>\n+    <int name=\"reqDEX\" value=\"0\"/>\n+    <int name=\"reqINT\" value=\"0\"/>\n+    <int name=\"reqLUK\" value=\"0\"/>\n+    <int name=\"incMHP\" value=\"100\"/>\n+    <int name=\"incMMP\" value=\"100\"/>\n+    <int name=\"tuc\" value=\"0\"/>\n+    <int name=\"price\" value=\"0\"/>\n+    <int name=\"tradeBlock\" value=\"1\"/>\n+    <int name=\"notSale\" value=\"1\"/>\n+    <int name=\"only\" value=\"1\"/>\n+    <int name=\"cash\" value=\"0\"/>\n+    <int name=\"medalTag\" value=\"83\"/>\n+    <imgdir name=\"level\">\n+      <imgdir name=\"info\">\n+        <imgdir name=\"1\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"2\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"3\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"4\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"5\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"6\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"7\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"8\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"9\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"10\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"11\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"12\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"13\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"14\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"15\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"16\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"17\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"18\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"19\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"20\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"21\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"22\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"23\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"24\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"25\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"26\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"27\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"28\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"29\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+        <imgdir name=\"30\">\n+          <int name=\"exp\" value=\"10000\"/>\n+        </imgdir>\n+      </imgdir>\n+    </imgdir>\n+  </imgdir>\n+</imgdir>"}, {"sha": "b4ef4164815b4fbc3f7498dc10823b8f66a662c8", "filename": "wz/Character.wz/Cap/01002739.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Cap/01002739.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Cap/01002739.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Cap/01002739.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -9,7 +9,7 @@\n     </canvas>\n     <string name=\"islot\" value=\"Cp\"/>\n     <string name=\"vslot\" value=\"CpH1H5\"/>\n-    <int name=\"reqJob\" value=\"5\"/>\n+    <int name=\"reqJob\" value=\"21\"/>\n     <int name=\"reqLevel\" value=\"70\"/>\n     <int name=\"reqSTR\" value=\"0\"/>\n     <int name=\"reqDEX\" value=\"0\"/>"}, {"sha": "d3c52a7054de20bc833fef1d7720177bb2ddc14e", "filename": "wz/Character.wz/Longcoat/01051140.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Longcoat/01051140.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Longcoat/01051140.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Longcoat/01051140.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -21,7 +21,7 @@\n     <int name=\"incPDD\" value=\"20\"/>\n     <int name=\"incSpeed\" value=\"5\"/>\n     <int name=\"price\" value=\"500\"/>\n-    <int name=\"incACC\" value=\"3\"/>\n+    <int name=\"incDEX\" value=\"3\"/>\n     <imgdir name=\"level\">\n       <imgdir name=\"info\">\n         <imgdir name=\"1\">"}, {"sha": "22107e94e4aaa9ed1291085a0850c171e73435b8", "filename": "wz/Character.wz/Longcoat/01052148.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Longcoat/01052148.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Longcoat/01052148.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Longcoat/01052148.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -9,7 +9,7 @@\n     </canvas>\n     <string name=\"islot\" value=\"MaPn\"/>\n     <string name=\"vslot\" value=\"MaPn\"/>\n-    <int name=\"reqJob\" value=\"5\"/>\n+    <int name=\"reqJob\" value=\"21\"/>\n     <int name=\"reqLevel\" value=\"70\"/>\n     <int name=\"reqSTR\" value=\"0\"/>\n     <int name=\"reqDEX\" value=\"0\"/>"}, {"sha": "c40cd29b80740b2cac3b177643ce448ad5c2a024", "filename": "wz/Character.wz/Shoes/01072342.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Shoes/01072342.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Character.wz/Shoes/01072342.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Shoes/01072342.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -9,7 +9,7 @@\n     </canvas>\n     <string name=\"islot\" value=\"So\"/>\n     <string name=\"vslot\" value=\"So\"/>\n-    <int name=\"reqJob\" value=\"5\"/>\n+    <int name=\"reqJob\" value=\"21\"/>\n     <int name=\"reqLevel\" value=\"70\"/>\n     <int name=\"reqSTR\" value=\"0\"/>\n     <int name=\"reqDEX\" value=\"0\"/>"}, {"sha": "a21014f5fd589c921c909083fa759cf83cb57bae", "filename": "wz/Item.wz/Etc/0403.img.xml", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Item.wz/Etc/0403.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Item.wz/Etc/0403.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Etc/0403.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -10450,8 +10450,6 @@\n       </canvas>\n       <int name=\"exp\" value=\"100\"/>\n       <int name=\"price\" value=\"100\"/>\n-      <string name=\"tradeBlock\" value=\"1\"/>\n-      <int name=\"notSale\" value=\"1\"/>\n       <imgdir name=\"message\">\n         <string name=\"0\" value=\"A full grown Timer doesn&apos;t eat Springy Worms.\"/>\n         <string name=\"1\" value=\"Timer has been fed one Springy Worm.\"/>"}, {"sha": "83c8d2a4581f1ac72bad57d6afb16e56956c23ab", "filename": "wz/Map.wz/Map/Map1/105090300.img.xml", "status": "modified", "additions": 1, "deletions": 27, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Map.wz/Map/Map1/105090300.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Map.wz/Map/Map1/105090300.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map1/105090300.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -10547,40 +10547,14 @@\n       <string name=\"id\" value=\"9400551\"/>\n       <int name=\"x\" value=\"1562\"/>\n       <int name=\"y\" value=\"-1239\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"mobTime\" value=\"14400\"/>\n       <int name=\"f\" value=\"0\"/>\n       <int name=\"hide\" value=\"0\"/>\n       <int name=\"fh\" value=\"641\"/>\n       <int name=\"cy\" value=\"-1212\"/>\n       <int name=\"rx0\" value=\"-383\"/>\n       <int name=\"rx1\" value=\"1823\"/>\n     </imgdir>\n-    <imgdir name=\"35\">\n-      <string name=\"type\" value=\"m\"/>\n-      <string name=\"id\" value=\"9400551\"/>\n-      <int name=\"x\" value=\"48\"/>\n-      <int name=\"y\" value=\"-1106\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"837\"/>\n-      <int name=\"cy\" value=\"-1083\"/>\n-      <int name=\"rx0\" value=\"-117\"/>\n-      <int name=\"rx1\" value=\"989\"/>\n-    </imgdir>\n-    <imgdir name=\"36\">\n-      <string name=\"type\" value=\"m\"/>\n-      <string name=\"id\" value=\"9400551\"/>\n-      <int name=\"x\" value=\"48\"/>\n-      <int name=\"y\" value=\"-1666\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"892\"/>\n-      <int name=\"cy\" value=\"-1644\"/>\n-      <int name=\"rx0\" value=\"-117\"/>\n-      <int name=\"rx1\" value=\"961\"/>\n-    </imgdir>\n   </imgdir>\n   <imgdir name=\"foothold\">\n     <imgdir name=\"0\">"}, {"sha": "3fc7819f2b8228b2d3397133861b9cf3f69f1f58", "filename": "wz/Map.wz/WorldMap/WorldMap010.img.xml", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Map.wz/WorldMap/WorldMap010.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Map.wz/WorldMap/WorldMap010.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/WorldMap/WorldMap010.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -810,59 +810,59 @@\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000200\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-266\" y=\"-77\"/>\n+      <vector name=\"spot\" x=\"-268\" y=\"-84\"/>\n     </imgdir>\n     <imgdir name=\"98\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000105\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-277\" y=\"-95\"/>\n+      <vector name=\"spot\" x=\"-290\" y=\"-94\"/>\n     </imgdir>\n     <imgdir name=\"97\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000104\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-272\" y=\"-91\"/>\n+      <vector name=\"spot\" x=\"-297\" y=\"-88\"/>\n     </imgdir>\n     <imgdir name=\"96\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000103\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-268\" y=\"-87\"/>\n+      <vector name=\"spot\" x=\"-290\" y=\"-82\"/>\n     </imgdir>\n     <imgdir name=\"95\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000102\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-264\" y=\"-82\"/>\n+      <vector name=\"spot\" x=\"-279\" y=\"-79\"/>\n     </imgdir>\n     <imgdir name=\"94\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000101\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-258\" y=\"-78\"/>\n+      <vector name=\"spot\" x=\"-267\" y=\"-73\"/>\n     </imgdir>\n     <imgdir name=\"93\">\n       <int name=\"type\" value=\"3\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000100\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-250\" y=\"-72\"/>\n+      <vector name=\"spot\" x=\"-249\" y=\"-65\"/>\n     </imgdir>\n     <imgdir name=\"100\">\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000201\"/>\n       </imgdir>\n-      <vector name=\"spot\" x=\"-273\" y=\"-75\"/>\n+      <vector name=\"spot\" x=\"-261\" y=\"-95\"/>\n     </imgdir>\n     <imgdir name=\"101\">\n-      <vector name=\"spot\" x=\"-283\" y=\"-76\"/>\n+      <vector name=\"spot\" x=\"-270\" y=\"-98\"/>\n       <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n         <int name=\"0\" value=\"103000202\"/>"}, {"sha": "ebc2afd886acca7edec15681ba9cf95fa2535002", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 5, "deletions": 16, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -38100,6 +38100,7 @@\n       <imgdir name=\"item\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"1102061\"/>\n+          <int name=\"count\" value=\"1\"/>\n         </imgdir>\n       </imgdir>\n     </imgdir>\n@@ -40711,6 +40712,10 @@\n           <int name=\"id\" value=\"4220046\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n+        <imgdir name=\"1\">\n+          <int name=\"id\" value=\"4031992\"/>\n+          <int name=\"count\" value=\"30\"/>\n+        </imgdir>\n       </imgdir>\n     </imgdir>\n   </imgdir>\n@@ -49928,8 +49933,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9110002\"/>\n       <int name=\"lvmin\" value=\"20\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"9110002\"/>\n@@ -49945,8 +49948,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9110002\"/>\n       <int name=\"lvmin\" value=\"25\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"9110002\"/>\n@@ -49962,8 +49963,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120001\"/>\n       <int name=\"lvmin\" value=\"25\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"9120001\"/>\n@@ -49979,8 +49978,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120001\"/>\n       <int name=\"lvmin\" value=\"25\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n       <imgdir name=\"quest\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4302\"/>\n@@ -50002,8 +49999,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120001\"/>\n       <int name=\"lvmin\" value=\"25\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n       <imgdir name=\"quest\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4303\"/>\n@@ -50025,8 +50020,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120001\"/>\n       <int name=\"lvmin\" value=\"40\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n       <imgdir name=\"quest\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4304\"/>\n@@ -50069,8 +50062,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120003\"/>\n       <int name=\"lvmin\" value=\"55\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"9120003\"/>\n@@ -50086,8 +50077,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120003\"/>\n       <int name=\"lvmin\" value=\"55\"/>\n-      <string name=\"start\" value=\"2000010100\"/>\n-      <string name=\"end\" value=\"2000010200\"/>\n       <imgdir name=\"quest\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4307\"/>"}, {"sha": "4d6bcc478f8fd554991123fb3b77c92209273c66", "filename": "wz/String.wz/Eqp.img.xml", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/String.wz/Eqp.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a17c2336938f12714aa354ad3a9b845b4ac2c66f/wz/String.wz/Eqp.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Eqp.img.xml?ref=a17c2336938f12714aa354ad3a9b845b4ac2c66f", "patch": "@@ -3,8 +3,8 @@\n   <imgdir name=\"Eqp\">\n     <imgdir name=\"Accessory\">\n       <imgdir name=\"1122040\">\n-        <string name=\"name\" value=\"Sealed Mind of Maple Necklace\"/>\n-        <string name=\"desc\" value=\"A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\"/>\n+        <string name=\"name\" value=\"Bronze Maple Necklace\"/>\n+        <string name=\"desc\" value=\"A light-weight bronze Maple Necklace.\"/>\n       </imgdir>\n       <imgdir name=\"1122041\">\n         <string name=\"name\" value=\"Sealed Mind of Maple Necklace\"/>\n@@ -27,8 +27,8 @@\n         <string name=\"desc\" value=\"A Mind of Maple Necklace that has been sealed up. One more gem, and its mystical powers will begin to be restored.\"/>\n       </imgdir>\n       <imgdir name=\"1122046\">\n-        <string name=\"name\" value=\"Restoring Mind of Maple Necklace\"/>\n-        <string name=\"desc\" value=\"A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\"/>\n+        <string name=\"name\" value=\"Silver Maple Necklace\"/>\n+        <string name=\"desc\" value=\"A shiny silver Maple Necklace.\"/>\n       </imgdir>\n       <imgdir name=\"1122047\">\n         <string name=\"name\" value=\"Restoring Mind of Maple Necklace\"/>\n@@ -51,8 +51,8 @@\n         <string name=\"desc\" value=\"A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\"/>\n       </imgdir>\n       <imgdir name=\"1122052\">\n-        <string name=\"name\" value=\"Awakening Mind of Maple Necklace\"/>\n-        <string name=\"desc\" value=\"A Mind of Maple Necklace that is beginning to be restored. One more gem, and its mystical powers will be amplified and awakened into a power on another level.\"/>\n+        <string name=\"name\" value=\"Golden Maple Necklace\"/>\n+        <string name=\"desc\" value=\"A Maple Necklace of 21 karats.\"/>\n       </imgdir>\n       <imgdir name=\"1122053\">\n         <string name=\"name\" value=\"Awakening Mind of Maple Necklace\"/>"}]}]},
