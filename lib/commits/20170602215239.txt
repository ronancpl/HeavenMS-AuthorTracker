{"fetchDate": "2019-12-19", "content": [{"sha": "02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MDJjYzllZmIwMGYxMmNhMTJjYzMxZmNhNjk3ZjBmYzFhNTI4YmY5Mw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-06-02T21:52:39Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-06-02T21:52:39Z"}, "message": "Optimized equip levelup method + Ultra three snails feature\n\nFixed performance drop on the server when trying to level up equipments\nwhich has high stats points. Added a flag enabling massive damages with\nThree Snails skill.", "tree": {"sha": "27332a8b37e4969dc20ac6ae487ff60f5e3c8692", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/27332a8b37e4969dc20ac6ae487ff60f5e3c8692"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "html_url": "https://github.com/ronancpl/HeavenMS/commit/02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fee0aa7e39673f3967e616435282ccf7ea235044", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/fee0aa7e39673f3967e616435282ccf7ea235044", "html_url": "https://github.com/ronancpl/HeavenMS/commit/fee0aa7e39673f3967e616435282ccf7ea235044"}], "stats": {"total": 362, "additions": 213, "deletions": 149}, "files": [{"sha": "610d8a5853a780dba8a49be0fa48b63b41d1b65f", "filename": "build/built-jar.properties", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/built-jar.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/built-jar.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/built-jar.properties?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -1,4 +1,4 @@\n-#Thu, 01 Jun 2017 21:33:39 -0300\n+#Fri, 02 Jun 2017 18:46:19 -0300\n \n \n C\\:\\\\Nexon\\\\MapleSolaxia\\\\MapleSolaxiaV2="}, {"sha": "7bb4ae622fbf81b1186c196e1e84aed83c2f0470", "filename": "build/classes/client/MapleClient$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleClient$1.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "f62a072de88d1ca4cf975437aba898633a3f8372", "filename": "build/classes/client/MapleClient$CharNameAndId.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient$CharNameAndId.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient$CharNameAndId.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleClient$CharNameAndId.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "6a6d95d87563da1101565c7c02e39a742d994055", "filename": "build/classes/client/MapleClient.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/MapleClient.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleClient.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "424992365914f5e221946c91abdbd874106199d0", "filename": "build/classes/client/inventory/Equip$1.class", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/inventory/Equip$1.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "73fedf82d35fbebf3e24ca30f91b86df0a2f3a9e", "filename": "build/classes/client/inventory/Equip$StatUpgrade.class", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip$StatUpgrade.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip$StatUpgrade.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/inventory/Equip$StatUpgrade.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "154f26ee47a5f645cccea7b19aaa4a74484af0f3", "filename": "build/classes/client/inventory/Equip.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/client/inventory/Equip.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/inventory/Equip.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "7371e4e1f92422c34cdbe4b4501924d9f2d3fec1", "filename": "build/classes/constants/ExpTable.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/constants/ExpTable.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/constants/ExpTable.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/constants/ExpTable.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "bfb0305dc1da28c42502c951730ef1d37924e519", "filename": "build/classes/constants/ServerConstants.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/constants/ServerConstants.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/constants/ServerConstants.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/constants/ServerConstants.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "4da0908c1250db7db6aa990ecf3214cd78adbda2", "filename": "build/classes/net/server/channel/handlers/AbstractDealDamageHandler$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$1.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "a6677b5ce9d0b1d6813d39d972189c6ad602be2a", "filename": "build/classes/net/server/channel/handlers/AbstractDealDamageHandler$2.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$2.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$2.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$2.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "beb70d2fe7a674586b0d18a00167bf850f7ce222", "filename": "build/classes/net/server/channel/handlers/AbstractDealDamageHandler$AttackInfo.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$AttackInfo.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$AttackInfo.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/AbstractDealDamageHandler$AttackInfo.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "dc7d7e52592c117d2d880fb47df63022a629a9ad", "filename": "build/classes/net/server/channel/handlers/AbstractDealDamageHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AbstractDealDamageHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/AbstractDealDamageHandler.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "a59a194050a1730d74b5ac333eda8bc653aa8bda", "filename": "build/classes/net/server/channel/handlers/AutoAssignHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AutoAssignHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/net/server/channel/handlers/AutoAssignHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/AutoAssignHandler.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "0a2799e432f293a6e78fdf602d90dd950a571e1b", "filename": "build/classes/scripting/event/EventInstanceManager.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/scripting/event/EventInstanceManager.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/scripting/event/EventInstanceManager.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/scripting/event/EventInstanceManager.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "9c46b014fe9f9a25a5cbb5876361344bd0f57502", "filename": "build/classes/server/life/MapleMonster.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/server/life/MapleMonster.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/build/classes/server/life/MapleMonster.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/life/MapleMonster.class?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "688bfba31d512e6ce995ef14ddb832703753a277", "filename": "dist/MapleSolaxia.jar", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/dist/MapleSolaxia.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/dist/MapleSolaxia.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/dist/MapleSolaxia.jar?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93"}, {"sha": "442b735d556c89be496c79d0ce47a88e9a1e3bac", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -274,4 +274,8 @@ Compilada uma nova tabela de EXP para equips no jogo.\n Adicionado novo sistema de EXP e nivelamento para todos os equipamentos, para al\ufffdm daqueles de tipo Reverse e Timeless.\n \n 01 Junho 2017,\n-Consertadas mec\ufffdnicas principais para deletar character, possivelmente eliminando quaisquer res\ufffdduos do mesmo da DB. Requer que ENABLE_PIC esteja ativado para funcionar.\n\\ No newline at end of file\n+Consertadas mec\ufffdnicas principais para deletar character, possivelmente eliminando quaisquer res\ufffdduos do mesmo da DB. Requer que ENABLE_PIC esteja ativado para funcionar.\n+\n+02 Junho 2017,\n+Otimizado e corrigido problemas de queda de desempenho ao atribuir lvups a itens com stats muito elevados, que ocasionavam crashs no servidor.\n+Adicionado funcionalidade USE_ULTRA_THREE_SNAILS. Valor mostrado n\ufffdo \ufffd condizente com o dano contabilizado (motivo: client edit).\n\\ No newline at end of file"}, {"sha": "a61a7387185a39eecb4f787ede7d7a530fe0dd65", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -12,16 +12,12 @@\n     </editor-bookmarks>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/AllianceOperationHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/2010007.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/GuildOperationHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/guild/MapleGuild.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/MapleServerHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/guild/MapleAlliance.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/Server.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/npc/NPCConversationManager.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/constants/ServerConstants.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/handlers/login/CreateCharHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/handlers/login/DeleteCharHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleClient.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/tools/MaplePacketCreator.java</file>\n         </group>"}, {"sha": "c42ef3833a31dd9eb80c63cbb5c08e55937ffa8d", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -61,6 +61,7 @@\n \n import client.inventory.MapleInventoryType;\n import constants.ServerConstants;\n+import scripting.AbstractPlayerInteraction;\n import scripting.event.EventManager;\n import scripting.npc.NPCConversationManager;\n import scripting.npc.NPCScriptManager;\n@@ -145,6 +146,10 @@ public MapleCharacter getPlayer() {\n \tpublic void setPlayer(MapleCharacter player) {\n \t\tthis.player = player;\n \t}\n+        \n+        public AbstractPlayerInteraction getAbstractPlayerInteraction() {\n+                return new AbstractPlayerInteraction(this);\n+        }\n \n \tpublic void sendCharList(int server) {\n \t\tthis.session.write(MaplePacketCreator.getCharList(this, server));"}, {"sha": "df1d73d5b3dcbd15f6578407e8c3b1141cc49efb", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 85, "deletions": 54, "changes": 139, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -48,6 +48,24 @@ public int getValue() {\n             return value;\n         }\n     }\n+    \n+    private static enum StatUpgrade {\n+\n+        incDEX(0), incSTR(1), incINT(2), incLUK(3),\n+        incMHP(4), incMMP(5), incPAD(6), incMAD(7),\n+        incPDD(8), incMDD(9), incEVA(10), incACC(11),\n+        incSpeed(12), incJump(13), incVicious(14), incSlot(15);\n+        private int value = -1;\n+\n+        private StatUpgrade(int value) {\n+            this.value = value;\n+        }\n+\n+        private int getValue() {\n+            return value;\n+        }\n+    }\n+    \n     private byte upgradeSlots;\n     private byte level, flag, itemLevel;\n     private short str, dex, _int, luk, hp, mp, watk, matk, wdef, mdef, acc, avoid, hands, speed, jump, vicious;\n@@ -277,13 +295,10 @@ private int getStatModifier(boolean isAttribute) {\n     private int randomizeStatUpgrade(int limit) {\n         Map<Integer, Integer> pool = new HashMap<>();\n         \n-        pool.put(0, 1);\n-        pool.put(1, 1);\n-        for(int i = 2; i <= limit; i++) {\n-            for(int j = 0; j < i; j++) {\n-                pool.put(j, pool.get(j) + 1);\n-            }\n-            pool.put(i, 1);\n+        int top = Math.min(limit, ServerConstants.MAX_EQUIPMNT_LVLUP_STAT_GAIN);\n+        pool.put(0, top);\n+        for(int i = 1; i <= top; i++) {\n+            pool.put(i, top - i + 1);\n         }\n         \n         int poolCount = 0;\n@@ -303,7 +318,7 @@ private int randomizeStatUpgrade(int limit) {\n         return(stat);\n     }\n     \n-    private void getUnitStatUpgrade(List<Pair<String, Integer>> stats, String name, int curStat, boolean isAttribute) {\n+    private void getUnitStatUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgrade name, int curStat, boolean isAttribute) {\n         isUpgradeable = true;\n         \n         int maxUpgrade = randomizeStatUpgrade((int)(1 + (curStat / getStatModifier(isAttribute))));\n@@ -312,118 +327,134 @@ private void getUnitStatUpgrade(List<Pair<String, Integer>> stats, String name,\n         stats.add(new Pair<>(name, maxUpgrade));\n     }\n     \n-    private void getUnitSlotUpgrade(List<Pair<String, Integer>> stats, String name) {\n+    private void getUnitSlotUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgrade name) {\n         if(Math.random() < 0.1) {\n             stats.add(new Pair<>(name, 1));  // 10% success on getting a slot upgrade.\n         }\n     }\n     \n-    private void improveDefaultStats(List<Pair<String, Integer>> stats) {\n-        if(dex > 0) getUnitStatUpgrade(stats, \"incDEX\", dex, true);\n-        if(str > 0) getUnitStatUpgrade(stats, \"incSTR\", str, true);\n-        if(_int > 0) getUnitStatUpgrade(stats, \"incINT\",_int, true);\n-        if(luk > 0) getUnitStatUpgrade(stats, \"incLUK\", luk, true);\n-        if(hp > 0) getUnitStatUpgrade(stats, \"incMHP\", hp, false);\n-        if(mp > 0) getUnitStatUpgrade(stats, \"incMMP\", mp, false);\n-        if(watk > 0) getUnitStatUpgrade(stats, \"incPAD\", watk, false);\n-        if(matk > 0) getUnitStatUpgrade(stats, \"incMAD\", matk, false);\n-        if(wdef > 0) getUnitStatUpgrade(stats, \"incPDD\", wdef, false);\n-        if(mdef > 0) getUnitStatUpgrade(stats, \"incMDD\", mdef, false);\n-        if(avoid > 0) getUnitStatUpgrade(stats, \"incEVA\", avoid, false);\n-        if(acc > 0) getUnitStatUpgrade(stats, \"incACC\", acc, false);\n-        if(speed > 0) getUnitStatUpgrade(stats, \"incSpeed\", speed, false);\n-        if(jump > 0) getUnitStatUpgrade(stats, \"incJump\", jump, false);\n+    private void improveDefaultStats(List<Pair<StatUpgrade, Integer>> stats) {\n+        if(dex > 0) getUnitStatUpgrade(stats, StatUpgrade.incDEX, dex, true);\n+        if(str > 0) getUnitStatUpgrade(stats, StatUpgrade.incSTR, str, true);\n+        if(_int > 0) getUnitStatUpgrade(stats, StatUpgrade.incINT,_int, true);\n+        if(luk > 0) getUnitStatUpgrade(stats, StatUpgrade.incLUK, luk, true);\n+        if(hp > 0) getUnitStatUpgrade(stats, StatUpgrade.incMHP, hp, false);\n+        if(mp > 0) getUnitStatUpgrade(stats, StatUpgrade.incMMP, mp, false);\n+        if(watk > 0) getUnitStatUpgrade(stats, StatUpgrade.incPAD, watk, false);\n+        if(matk > 0) getUnitStatUpgrade(stats, StatUpgrade.incMAD, matk, false);\n+        if(wdef > 0) getUnitStatUpgrade(stats, StatUpgrade.incPDD, wdef, false);\n+        if(mdef > 0) getUnitStatUpgrade(stats, StatUpgrade.incMDD, mdef, false);\n+        if(avoid > 0) getUnitStatUpgrade(stats, StatUpgrade.incEVA, avoid, false);\n+        if(acc > 0) getUnitStatUpgrade(stats, StatUpgrade.incACC, acc, false);\n+        if(speed > 0) getUnitStatUpgrade(stats, StatUpgrade.incSpeed, speed, false);\n+        if(jump > 0) getUnitStatUpgrade(stats, StatUpgrade.incJump, jump, false);\n     }\n     \n-    public void gainLevel(MapleClient c) {\n-        List<Pair<String, Integer>> stats = MapleItemInformationProvider.getInstance().getItemLevelupStats(getItemId(), itemLevel);\n+    private void gainLevel(MapleClient c) {\n+        List<Pair<StatUpgrade, Integer>> stats = new LinkedList<>();\n+                \n+        if(isElemental) {\n+            List<Pair<String, Integer>> elementalStats = MapleItemInformationProvider.getInstance().getItemLevelupStats(getItemId(), itemLevel);\n+            \n+            for(Pair<String, Integer> p: elementalStats) {\n+                if(p.getRight() > 0) stats.add(new Pair(StatUpgrade.valueOf(p.getLeft()), p.getRight()));\n+            }\n+        }\n+        \n         if(!stats.isEmpty()) {\n             if(ServerConstants.USE_EQUIPMNT_LVLUP_SLOTS) {\n-                if(vicious > 0) getUnitSlotUpgrade(stats, \"incVicious\");\n-                getUnitSlotUpgrade(stats, \"incSlot\");\n+                if(vicious > 0) getUnitSlotUpgrade(stats, StatUpgrade.incVicious);\n+                getUnitSlotUpgrade(stats, StatUpgrade.incSlot);\n             }\n         }\n         else {\n             isUpgradeable = false;\n             \n-            do {\n-                improveDefaultStats(stats);\n-\n-                if(ServerConstants.USE_EQUIPMNT_LVLUP_SLOTS) {\n-                    if(vicious > 0) getUnitSlotUpgrade(stats, \"incVicious\");\n-                    getUnitSlotUpgrade(stats, \"incSlot\");\n+            improveDefaultStats(stats);\n+            if(ServerConstants.USE_EQUIPMNT_LVLUP_SLOTS) {\n+                if(vicious > 0) getUnitSlotUpgrade(stats, StatUpgrade.incVicious);\n+                getUnitSlotUpgrade(stats, StatUpgrade.incSlot);\n+            }\n+            \n+            if(isUpgradeable) {\n+                while(stats.isEmpty()) {\n+                    improveDefaultStats(stats);\n+                    if(ServerConstants.USE_EQUIPMNT_LVLUP_SLOTS) {\n+                        if(vicious > 0) getUnitSlotUpgrade(stats, StatUpgrade.incVicious);\n+                        getUnitSlotUpgrade(stats, StatUpgrade.incSlot);\n+                    }\n                 }\n-            } while(stats.isEmpty() && isUpgradeable);\n+            }\n         }\n         \n         itemLevel++;\n         boolean gotVicious = false, gotSlot = false;\n         \n         String lvupStr = \"'\" + MapleItemInformationProvider.getInstance().getName(this.getItemId()) + \"' is now level \" + itemLevel + \"! \";\n-        for (Pair<String, Integer> stat : stats) {\n+        for (Pair<StatUpgrade, Integer> stat : stats) {\n             switch (stat.getLeft()) {\n-                case \"incDEX\":\n+                case incDEX:\n                     dex += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"DEX \";\n                     break;\n-                case \"incSTR\":\n+                case incSTR:\n                     str += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"STR \";\n                     break;\n-                case \"incINT\":\n+                case incINT:\n                     _int += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"INT \";\n                     break;\n-                case \"incLUK\":\n+                case incLUK:\n                     luk += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"LUK \";\n                     break;\n-                case \"incMHP\":\n+                case incMHP:\n                     hp += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"HP \";\n                     break;\n-                case \"incMMP\":\n+                case incMMP:\n                     mp += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"MP \";\n                     break;\n-                case \"incPAD\":\n+                case incPAD:\n                     watk += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"WATK \";\n                     break;\n-                case \"incMAD\":\n+                case incMAD:\n                     matk += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"MATK \";\n                     break;\n-                case \"incPDD\":\n+                case incPDD:\n                     wdef += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"WDEF \";\n                     break;\n-                case \"incMDD\":\n+                case incMDD:\n                     mdef += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"MDEF \";\n                     break;\n-                case \"incEVA\":\n+                case incEVA:\n                     avoid += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"AVOID \";\n                     break;\n-                case \"incACC\":\n+                case incACC:\n                     acc += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"ACC \";\n                     break;\n-                case \"incSpeed\":\n+                case incSpeed:\n                     speed += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"SPEED \";\n                     break;\n-                case \"incJump\":\n+                case incJump:\n                     jump += stat.getRight();\n                     lvupStr += \"+\" + stat.getRight() + \"JUMP \";\n                     break;\n                     \n-                case \"incVicious\":\n+                case incVicious:\n                     vicious -= stat.getRight();\n                     gotVicious = true;\n                     break;\n-                case \"incSlot\":\n+                case incSlot:\n                     upgradeSlots += stat.getRight();\n                     gotSlot = true;\n                     break;\n@@ -453,14 +484,14 @@ public void gainItemExp(MapleClient c, int gain) {  // Ronan's Equip Exp gain me\n         int reqLevel = MapleItemInformationProvider.getInstance().getEquipStats(this.getItemId()).get(\"reqLevel\");\n         \n         float masteryModifier = (float)ExpTable.getExpNeededForLevel(1) / (float)normalizedMasteryExp(reqLevel);\n-        float elementModifier = (isElemental) ? 1.2f : 1.0f;\n+        float elementModifier = (isElemental) ? 0.85f : 0.6f;\n         \n         float baseExpGain = gain * elementModifier * masteryModifier;\n         \n         itemExp += baseExpGain;\n         int expNeeded = ExpTable.getEquipExpNeededForLevel(itemLevel);\n         \n-        //System.out.println(\"Gain: \" + gain + \" Mastery: \" + masteryModifier + \"Base gain: \" + baseExpGain + \" item current exp: \" + itemExp + \" / \" + expNeeded);\n+        //System.out.println(\"'\" + MapleItemInformationProvider.getInstance().getName(this.getItemId()) + \"' -> EXP Gain: \" + gain + \" Mastery: \" + masteryModifier + \"Base gain: \" + baseExpGain + \" exp: \" + itemExp + \" / \" + expNeeded);\n         \n         if (itemExp >= expNeeded) {\n             while(itemExp >= expNeeded) {"}, {"sha": "33924d96ce076adca38df0f88c3a54ffa2f21f2e", "filename": "src/constants/ExpTable.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/constants/ExpTable.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/constants/ExpTable.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ExpTable.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -40,6 +40,6 @@ public static int getMountExpNeededForLevel(int level) {\n     }\n     \n     public static int getEquipExpNeededForLevel(int level) {\n-        return level > 30 ? 2000000000 : exp[level];\n+        return equip[level];\n     }\n }"}, {"sha": "bba8b53cf09273941e6e7abc1c46e85c31bffec0", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -43,7 +43,7 @@\n     public static final boolean USE_AUTOBAN = false;            //Commands the server to detect infractors automatically.\n     public static final boolean USE_ANOTHER_AUTOASSIGN = true;  //Based on distributing AP accordingly with higher secondary stat on equipments.\n     public static final boolean USE_REFRESH_RANK_MOVE = true;\n-    public static final int MAX_AP = 999;\n+    public static final int MAX_AP = 20000;                     //Max AP alloted on the auto-assigner.\n     public static final int MAX_EVENT_LEVELS = 8;               //Event has different levels of rewarding system.\n     public static final long BLOCK_DUEY_RACE_COND = (long)(0.5 * 1000);\n     public static final long PET_LOOT_UPON_ATTACK = (long)(0.7 * 1000); //Time the pet must wait before trying to pick items up.\n@@ -53,14 +53,15 @@\n     public static final boolean USE_PERFECT_SCROLLING = true;   //Scrolls doesn't use slots upon failure.\n     public static final boolean USE_ENHANCED_CHSCROLL = true;   //Equips even more powerful with chaos upgrade.\n     public static final boolean USE_ENHANCED_CRAFTING = true;   //Applys chaos scroll on every equip crafted.\n-    public static final boolean USE_ULTRA_NIMBLE_FEET = true;   //Still needs some client editing to work.\n-    public static final boolean USE_ULTRA_RECOVERY = true;      //Huehue another client edit.\n-    //Public static final boolean USE_ULTRA_THREE_SNAILS = true;\n+    public static final boolean USE_ULTRA_NIMBLE_FEET = true;   //Haste-like speed & jump upgrade.\n+    public static final boolean USE_ULTRA_RECOVERY = true;      //Massive recovery amounts overtime.\n+    public static final boolean USE_ULTRA_THREE_SNAILS = true;  //Massive damage on shell toss.\n     public static final boolean USE_ADD_SLOTS_BY_LEVEL = true;  //Slots are added each 20 levels.\n     public static final boolean USE_ADD_RATES_BY_LEVEL = true;  //Rates are added each 20 levels.\n     public static final boolean USE_STACK_COUPON_RATES = true;  //Multiple coupons effects builds up together.\n     public static final boolean USE_EQUIPMNT_LVLUP_SLOTS = true;//Equips can upgrade slots at level up.\n     public static final boolean USE_EQUIPMNT_LVLUP_POWER = true;//Enable more powerful stats upgrades at equip level up.\n+    public static final int MAX_EQUIPMNT_LVLUP_STAT_GAIN = 120; //Max stat upgrade an equipment can have on a levelup.\n     public static final int USE_EQUIPMNT_LVLUP = 7;             //All equips lvlup at max level of N, set 0 to disable.\n     public static final int FAME_GAIN_BY_QUEST = 4;             //Fame gain each N quest completes, set 0 to disable.\n     public static final int SCROLL_CHANCE_RATE = 10;            //Number of tries for success on a scroll, set 0 for default."}, {"sha": "40beea7f10e557b358cb62ebc2ad7afd36ff23a3", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 89, "deletions": 62, "changes": 151, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -62,6 +62,7 @@\n import client.status.MonsterStatusEffect;\n import constants.GameConstants;\n import constants.ItemConstants;\n+import constants.ServerConstants;\n import constants.skills.Aran;\n import constants.skills.Assassin;\n import constants.skills.Bandit;\n@@ -104,6 +105,7 @@\n import constants.skills.ThunderBreaker;\n import constants.skills.WhiteKnight;\n import constants.skills.WindArcher;\n+import scripting.AbstractPlayerInteraction;\n \n public abstract class AbstractDealDamageHandler extends AbstractMaplePacketHandler {\n \n@@ -191,9 +193,9 @@ protected synchronized void applyAttack(AttackInfo attack, final MapleCharacter\n             }\n \n             //WTF IS THIS F3,1\n-        /*if (attackCount != attack.numDamage && attack.skill != ChiefBandit.MESO_EXPLOSION && attack.skill != NightWalker.VAMPIRE && attack.skill != WindArcher.WIND_SHOT && attack.skill != Aran.COMBO_SMASH && attack.skill != Aran.COMBO_PENRIL && attack.skill != Aran.COMBO_TEMPEST && attack.skill != NightLord.NINJA_AMBUSH && attack.skill != Shadower.NINJA_AMBUSH) {\n-             return;\n-             }*/\n+            /*if (attackCount != attack.numDamage && attack.skill != ChiefBandit.MESO_EXPLOSION && attack.skill != NightWalker.VAMPIRE && attack.skill != WindArcher.WIND_SHOT && attack.skill != Aran.COMBO_SMASH && attack.skill != Aran.COMBO_PENRIL && attack.skill != Aran.COMBO_TEMPEST && attack.skill != NightLord.NINJA_AMBUSH && attack.skill != Shadower.NINJA_AMBUSH) {\n+                return;\n+            }*/\n             \n             int totDamage = 0;\n             final MapleMap map = player.getMap();\n@@ -204,9 +206,9 @@ protected synchronized void applyAttack(AttackInfo attack, final MapleCharacter\n                     MapleMapObject mapobject = map.getMapObject(oned.intValue());\n                     if (mapobject != null && mapobject.getType() == MapleMapObjectType.ITEM) {\n                         final MapleMapItem mapitem = (MapleMapItem) mapobject;\n-\t\t                    if (mapitem.getMeso() == 0) { //Maybe it is possible some how?\n-\t\t                        return;\n-\t\t                    }\n+                            if (mapitem.getMeso() == 0) { //Maybe it is possible some how?\n+                                return;\n+                            }\n                             synchronized (mapitem) {\n                                 if (mapitem.isPickedUp()) {\n                                     return;\n@@ -263,8 +265,7 @@ public void run() {\n                     int totDamageToOneMonster = 0;\n                     List<Integer> onedList = attack.allDamage.get(oned);\n                     for (Integer eachd : onedList) {\n-\t\t\t\t\t\tif(eachd < 0)\n-\t\t\t\t\t\t\teachd += Integer.MAX_VALUE;\n+                        if(eachd < 0) eachd += Integer.MAX_VALUE;\n                         totDamageToOneMonster += eachd;\n                     }\n                     totDamage += totDamageToOneMonster;\n@@ -296,20 +297,20 @@ public void run() {\n                     } else if (attack.skill == Bandit.STEAL) {                    \t\n                         Skill steal = SkillFactory.getSkill(Bandit.STEAL);\n                         if (monster.getStolen().size() < 1) { // One steal per mob <3\n-\t                        if (Math.random() < 0.3 && steal.getEffect(player.getSkillLevel(steal)).makeChanceResult()) { //Else it drops too many cool stuff :(\n-\t                            List<MonsterDropEntry> toSteals = MapleMonsterInformationProvider.getInstance().retrieveDrop(monster.getId());\n-\t                            Collections.shuffle(toSteals);\n-\t                            int toSteal = toSteals.get(rand(0, (toSteals.size() - 1))).itemId;\n-\t                            MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-\t                            Item item;\n-\t                            if (ItemConstants.getInventoryType(toSteal).equals(MapleInventoryType.EQUIP)) {\n-\t                                item = ii.randomizeStats((Equip) ii.getEquipById(toSteal));\n-\t                            } else {\n-\t                                item = new Item(toSteal, (byte) 0, (short) 1, -1);\n-\t                            }\n-\t                            player.getMap().spawnItemDrop(monster, player, item, monster.getPosition(), false, false);\n-\t                            monster.addStolen(toSteal);\n-\t                        }\n+                            if (Math.random() < 0.3 && steal.getEffect(player.getSkillLevel(steal)).makeChanceResult()) { //Else it drops too many cool stuff :(\n+                                List<MonsterDropEntry> toSteals = MapleMonsterInformationProvider.getInstance().retrieveDrop(monster.getId());\n+                                Collections.shuffle(toSteals);\n+                                int toSteal = toSteals.get(rand(0, (toSteals.size() - 1))).itemId;\n+                                MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+                                Item item;\n+                                if (ItemConstants.getInventoryType(toSteal).equals(MapleInventoryType.EQUIP)) {\n+                                    item = ii.randomizeStats((Equip) ii.getEquipById(toSteal));\n+                                } else {\n+                                    item = new Item(toSteal, (byte) 0, (short) 1, -1);\n+                                }\n+                                player.getMap().spawnItemDrop(monster, player, item, monster.getPosition(), false, false);\n+                                monster.addStolen(toSteal);\n+                            }\n                         }                        \n                     } else if (attack.skill == FPArchMage.FIRE_DEMON) {\n                         monster.setTempEffectiveness(Element.ICE, ElementalEffectiveness.WEAK, SkillFactory.getSkill(FPArchMage.FIRE_DEMON).getEffect(player.getSkillLevel(SkillFactory.getSkill(FPArchMage.FIRE_DEMON))).getDuration() * 1000);\n@@ -322,11 +323,11 @@ public void run() {\n                     \n                     if (job == 2111 || job == 2112) {\n                     \tif (player.getBuffedValue(MapleBuffStat.WK_CHARGE) != null) {\n-                    \t\tSkill snowCharge = SkillFactory.getSkill(Aran.SNOW_CHARGE);\n-                    \t\tif (totDamageToOneMonster > 0) {\n+                            Skill snowCharge = SkillFactory.getSkill(Aran.SNOW_CHARGE);\n+                            if (totDamageToOneMonster > 0) {\n                                 MonsterStatusEffect monsterStatusEffect = new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.SPEED, snowCharge.getEffect(player.getSkillLevel(snowCharge)).getX()), snowCharge, null, false);\n                                 monster.applyStatus(player, monsterStatusEffect, false, snowCharge.getEffect(player.getSkillLevel(snowCharge)).getY() * 1000);\n-                    \t\t}\n+                            }\n                     \t}\n                     }\n                     if (player.getBuffedValue(MapleBuffStat.HAMSTRING) != null) {\n@@ -355,26 +356,26 @@ public void run() {\n                             Skill chargeSkill = SkillFactory.getSkill(charge);\n                             if (player.isBuffFrom(MapleBuffStat.WK_CHARGE, chargeSkill)) {                                \n                                 if (totDamageToOneMonster > 0) {\n-                                \tif (charge == WhiteKnight.BW_ICE_CHARGE || charge == WhiteKnight.SWORD_ICE_CHARGE) {\n-                                \t\tmonster.setTempEffectiveness(Element.ICE, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\t\n-                                \t\tbreak;\n-                                \t}\n-                                \tif (charge == WhiteKnight.BW_FIRE_CHARGE || charge == WhiteKnight.SWORD_FIRE_CHARGE) {\n-                                \t\tmonster.setTempEffectiveness(Element.FIRE, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\n-                                \t\tbreak;\n-                                \t}\n+                                    if (charge == WhiteKnight.BW_ICE_CHARGE || charge == WhiteKnight.SWORD_ICE_CHARGE) {\n+                                        monster.setTempEffectiveness(Element.ICE, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\t\n+                                        break;\n+                                    }\n+                                    if (charge == WhiteKnight.BW_FIRE_CHARGE || charge == WhiteKnight.SWORD_FIRE_CHARGE) {\n+                                        monster.setTempEffectiveness(Element.FIRE, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\n+                                        break;\n+                                    }\n                                 }                              \n                             }\n                         }\n                         if (job == 122) {\n-                        \t for (int charge = 1221003; charge < 1221004; charge++) {\n-                                 Skill chargeSkill = SkillFactory.getSkill(charge);\n-                                 if (player.isBuffFrom(MapleBuffStat.WK_CHARGE, chargeSkill)) {                                \n-                                     if (totDamageToOneMonster > 0) {\n-                                     \t monster.setTempEffectiveness(Element.HOLY, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\n-                                     \t break;\n-                                     }\n-                                 }\n+                            for (int charge = 1221003; charge < 1221004; charge++) {\n+                                Skill chargeSkill = SkillFactory.getSkill(charge);\n+                                if (player.isBuffFrom(MapleBuffStat.WK_CHARGE, chargeSkill)) {                                \n+                                    if (totDamageToOneMonster > 0) {\n+                                        monster.setTempEffectiveness(Element.HOLY, ElementalEffectiveness.WEAK, chargeSkill.getEffect(player.getSkillLevel(chargeSkill)).getY() * 1000);\n+                                        break;\n+                                    }\n+                                }\n                             }\n                         }\n                     } else if (player.getBuffedValue(MapleBuffStat.COMBO_DRAIN) != null) {\n@@ -400,36 +401,62 @@ public void run() {\n                         }\n                     } else if (job == 521 || job == 522) { // from what I can gather this is how it should work\n                     \tif (!monster.isBoss()) {\n-\t                    \tSkill type = SkillFactory.getSkill(Outlaw.FLAME_THROWER);\n-\t                    \tif (player.getSkillLevel(type) > 0) {\n-\t                    \t\tMapleStatEffect DoT = type.getEffect(player.getSkillLevel(type));\n-\t                    \t\tMonsterStatusEffect monsterStatusEffect = new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.POISON, 1), type, null, false);\n-\t                    \t\tmonster.applyStatus(player, monsterStatusEffect, true, DoT.getDuration(), false);\n-\t                    \t}\n-\t                    }\n+                            Skill type = SkillFactory.getSkill(Outlaw.FLAME_THROWER);\n+                            if (player.getSkillLevel(type) > 0) {\n+                                MapleStatEffect DoT = type.getEffect(player.getSkillLevel(type));\n+                                MonsterStatusEffect monsterStatusEffect = new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.POISON, 1), type, null, false);\n+                                monster.applyStatus(player, monsterStatusEffect, true, DoT.getDuration(), false);\n+                            }\n+                        }\n                     } else if (job >= 311 && job <= 322) {                   \t\n                     \tif (!monster.isBoss()) {\n-\t                    \tSkill mortalBlow;\n-\t                    \tif (job == 311 || job == 312) {\n-\t                    \t\tmortalBlow = SkillFactory.getSkill(Ranger.MORTAL_BLOW);\n-\t                    \t} else {\n-\t                    \t\tmortalBlow = SkillFactory.getSkill(Sniper.MORTAL_BLOW);\n-\t                    \t}\n-\t                    \tif (player.getSkillLevel(mortalBlow) > 0) {\t                    \t\t\n-\t                    \t\tMapleStatEffect mortal = mortalBlow.getEffect(player.getSkillLevel(mortalBlow));\n-\t                    \t\tif (monster.getHp() <= (monster.getStats().getHp() * mortal.getX()) / 100) {\n-\t                    \t\t\tif (Randomizer.rand(1, 100) <= mortal.getY()) {\n-\t                    \t\t\t\tmonster.getMap().killMonster(monster, player, true);\n-\t                    \t\t\t}\n-\t                    \t\t}\n-\t                    \t}\n+                            Skill mortalBlow;\n+                            if (job == 311 || job == 312) {\n+                                mortalBlow = SkillFactory.getSkill(Ranger.MORTAL_BLOW);\n+                            } else {\n+                                mortalBlow = SkillFactory.getSkill(Sniper.MORTAL_BLOW);\n+                            }\n+                            if (player.getSkillLevel(mortalBlow) > 0) {\t                    \t\t\n+                                MapleStatEffect mortal = mortalBlow.getEffect(player.getSkillLevel(mortalBlow));\n+                                if (monster.getHp() <= (monster.getStats().getHp() * mortal.getX()) / 100) {\n+                                    if (Randomizer.rand(1, 100) <= mortal.getY()) {\n+                                        monster.getMap().killMonster(monster, player, true);\n+                                    }\n+                                }\n+                            }\n                     \t}\n                     }\n                     if (attack.skill != 0) {\n                         if (attackEffect.getFixDamage() != -1) {\n                             if (totDamageToOneMonster != attackEffect.getFixDamage() && totDamageToOneMonster != 0) {\n                                 AutobanFactory.FIX_DAMAGE.autoban(player, String.valueOf(totDamageToOneMonster) + \" damage\");\n                             }\n+                            \n+                            if(ServerConstants.USE_ULTRA_THREE_SNAILS) {\n+                                AbstractPlayerInteraction api = player.getClient().getAbstractPlayerInteraction();\n+                                \n+                                int shellId;\n+                                switch(totDamageToOneMonster) {\n+                                    case 10:\n+                                        shellId = 4000019;\n+                                        break;\n+                                        \n+                                    case 25:\n+                                        shellId = 4000000;\n+                                        break;\n+                                        \n+                                    default:\n+                                        shellId = 4000016;\n+                                }\n+                                \n+                                if(api.haveItem(shellId, 1)) {\n+                                    api.gainItem(shellId, (short)-1, false);\n+                                    totDamageToOneMonster *= player.getLevel();\n+                                }\n+                                else {\n+                                    player.dropMessage(5, \"You ran out of shells to use to activate the hidden power of Three Snails.\");\n+                                }\n+                            }\n                         }\n                     }\n                     if (totDamageToOneMonster > 0 && attackEffect != null && attackEffect.getMonsterStati().size() > 0) {"}, {"sha": "973a93853833d40755d977fb5c4f40de4e712d35", "filename": "src/net/server/channel/handlers/RangedAttackHandler.java", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/net/server/channel/handlers/RangedAttackHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/net/server/channel/handlers/RangedAttackHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RangedAttackHandler.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -54,11 +54,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleCharacter player = c.getPlayer();\n         player.setPetLootCd(System.currentTimeMillis());\n \t\t\n-\t\t/*long timeElapsed = System.currentTimeMillis() - player.getAutobanManager().getLastSpam(8);\n-\t\tif(timeElapsed < 300) {\n-\t\t\tAutobanFactory.FAST_ATTACK.alert(player, \"Time: \" + timeElapsed);\n-\t\t}\n-\t\tplayer.getAutobanManager().spam(8);*/\n+        /*long timeElapsed = System.currentTimeMillis() - player.getAutobanManager().getLastSpam(8);\n+        if(timeElapsed < 300) {\n+            AutobanFactory.FAST_ATTACK.alert(player, \"Time: \" + timeElapsed);\n+        }\n+        player.getAutobanManager().spam(8);*/\n \t\t\n         AttackInfo attack = parseDamage(slea, player, true, false);\n         \n@@ -141,19 +141,19 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n             boolean soulArrow = player.getBuffedValue(MapleBuffStat.SOULARROW) != null;\n             boolean shadowClaw = player.getBuffedValue(MapleBuffStat.SHADOW_CLAW) != null;\n-\t            if (projectile != 0) {\n-\t\t            if (!soulArrow && !shadowClaw && attack.skill != 11101004 && attack.skill != 15111007 && attack.skill != 14101006) {\n-\t\t                byte bulletConsume = bulletCount;\n-\t\t                \n-\t\t                if (effect != null && effect.getBulletConsume() != 0) {\n-\t\t                    bulletConsume = (byte) (effect.getBulletConsume() * (hasShadowPartner ? 2 : 1));           \n-\t\t                }\n-\t\t            \n-                            if(slot < 0) System.out.println(\"<ERROR> Projectile to use was unable to be found.\");\n-                            else MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, bulletConsume, false, true);\n-\t\t    }\n+            if (projectile != 0) {\n+                if (!soulArrow && !shadowClaw && attack.skill != 11101004 && attack.skill != 15111007 && attack.skill != 14101006) {\n+                    byte bulletConsume = bulletCount;\n+\n+                    if (effect != null && effect.getBulletConsume() != 0) {\n+                        bulletConsume = (byte) (effect.getBulletConsume() * (hasShadowPartner ? 2 : 1));           \n+                    }\n+\n+                    if(slot < 0) System.out.println(\"<ERROR> Projectile to use was unable to be found.\");\n+                    else MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, bulletConsume, false, true);\n+                }\n             }\n-\t        if (projectile != 0 || soulArrow || attack.skill == 11101004 || attack.skill == 15111007 || attack.skill == 14101006) {                \n+            if (projectile != 0 || soulArrow || attack.skill == 11101004 || attack.skill == 15111007 || attack.skill == 14101006) {                \n             \tint visProjectile = projectile; //visible projectile sent to players\n                 if (ItemConstants.isThrowingStar(projectile)) {\n                     MapleInventory cash = player.getInventory(MapleInventoryType.CASH);"}, {"sha": "6a074b04241c0d3e258774ce6f6667054c886428", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -648,7 +648,7 @@ public Integer getClearStageMeso(int stage) {   //stage counts from ONE.\n         }\n         \n         private void dropExclusiveItems(MapleCharacter chr) {\n-                AbstractPlayerInteraction api = new AbstractPlayerInteraction(chr.getClient());\n+                AbstractPlayerInteraction api = chr.getClient().getAbstractPlayerInteraction();\n                 \n                 for(Integer item: exclusiveItems) {\n                         api.removeAll(item);\n@@ -749,7 +749,7 @@ public final boolean giveEventReward(MapleCharacter player, int eventLevel) {\n \n                         if(!hasRewardSlot(player, eventLevel)) return false;\n \n-                        AbstractPlayerInteraction api = new AbstractPlayerInteraction(player.getClient());\n+                        AbstractPlayerInteraction api = player.getClient().getAbstractPlayerInteraction();\n                         int rnd = (int)Math.floor(Math.random() * rewardsSet.size());\n \n                         api.gainItem(rewardsSet.get(rnd), rewardsQty.get(rnd).shortValue());"}, {"sha": "9bb32e1d9a6b3b0be0a26d8615e695f6b9bb9b0a", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02cc9efb00f12ca12cc31fca697f0fc1a528bf93/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=02cc9efb00f12ca12cc31fca697f0fc1a528bf93", "patch": "@@ -371,8 +371,8 @@ public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKille\n             }\n             \n             attacker.gainExp(personalExp, partyExp, true, false, isKiller);\n-            attacker.mobKilled(getId());\n             attacker.increaseEquipExp(personalExp);\n+            attacker.mobKilled(getId());\n         }\n     }\n "}]}]},
