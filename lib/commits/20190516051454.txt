{"fetchDate": "2019-12-19", "content": [{"sha": "bb80441af07f0eb3869b8dac4b5f58165f79b90a", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YmI4MDQ0MWFmMDdmMGViMzg2OWI4ZGFjNGI1ZjU4MTY1Zjc5YjkwYQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-05-16T05:14:54Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-05-16T05:14:54Z"}, "message": "Party Search + Conditional Buffs\n\nRevised skillbook drops. New drop chances are related to the holder's level and boss flag.\nAdjusted party bonus EXP gains. The level difference calculation now only takes into account party members that participated in the action.\nImplemented Party Search in the source.\nRefactored command classes initialization to take place when booting up the server.\nImplemented support for conditional buffs (e.g. card buffs that takes place only in certain areas).\nImplemented topological sorting when updating buffs to the player, this allows a better vision of buff streaks to the player (buff-applying the original way assumes stat override client-side, to circumvent that this algorithm makes up for the best-fit scenario).\nFixed Arans not taking Dojo's attack speed buff properly.\nFixed pets being improperly removed from the DB after performing certain inventory actions.", "tree": {"sha": "dd8aff94eb0cf3200b575f149586544164f9c599", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/dd8aff94eb0cf3200b575f149586544164f9c599"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/bb80441af07f0eb3869b8dac4b5f58165f79b90a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/bb80441af07f0eb3869b8dac4b5f58165f79b90a", "html_url": "https://github.com/ronancpl/HeavenMS/commit/bb80441af07f0eb3869b8dac4b5f58165f79b90a", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/bb80441af07f0eb3869b8dac4b5f58165f79b90a/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "397e16bb85f91d2ef7727a361d34f68ef37a82a1", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/397e16bb85f91d2ef7727a361d34f68ef37a82a1", "html_url": "https://github.com/ronancpl/HeavenMS/commit/397e16bb85f91d2ef7727a361d34f68ef37a82a1"}], "stats": {"total": 69300, "additions": 68917, "deletions": 383}, "files": [{"sha": "b810f781b8d5fb4d69d7bf7b61d64feddd457960", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -103,6 +103,10 @@\n /tools/MapleReactorDropFetcher/dist/\n /tools/MapleReactorDropFetcher/nbproject/\n \n+/tools/MapleSkillbookChanceFetcher/build/\n+/tools/MapleSkillbookChanceFetcher/dist/\n+/tools/MapleSkillbookChanceFetcher/nbproject/\n+\n /tools/MapleSkillbookStackUpdate/build/\n /tools/MapleSkillbookStackUpdate/dist/\n /tools/MapleSkillbookStackUpdate/nbproject/"}, {"sha": "70178f3236b91b8f5be8c295e2ceab79a3365198", "filename": "Dockerfile", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/Dockerfile", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/Dockerfile", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/Dockerfile?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,9 @@\n+# Docker support, thanks to xinyifly\n+\n+FROM openjdk:7-alpine\n+RUN apk -U add tini\n+WORKDIR /mnt\n+COPY ./ ./\n+RUN sh ./posix-compile.sh\n+EXPOSE 8484 7575 7576 7577\n+CMD exec tini -- sh ./docker-launch.sh\n\\ No newline at end of file"}, {"sha": "654a2c088cddf6549e6a5804032509a1852ddfec", "filename": "docker-launch.sh", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/docker-launch.sh", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/docker-launch.sh", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docker-launch.sh?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,8 @@\n+#!/bin/bash\n+\n+sed -i \"s/HOST=.*/HOST=${HOST}/\" configuration.ini\n+sed -i \"s|URL=.*|URL=${URL}|\" configuration.ini\n+sed -i \"s/DB_USER=.*/DB_USER=${DB_USER}/\" configuration.ini\n+sed -i \"s/DB_PASS=.*/DB_PASS=${DB_PASS}/\" configuration.ini\n+\n+exec sh ./posix-launch.sh\n\\ No newline at end of file"}, {"sha": "5a1d1fa2cee624d343634976363af4d9a9bdfb8c", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -1840,6 +1840,7 @@ Revisado refatora\u00e7\u00e3o recente em acesso a valores de stats de jogadores levando\n 24 - 26 Abril 2019,\n Ajustado levemente taxa de respawn de mobs quando n\u00e3o se est\u00e1 usando a flag de respawn completo.\n Ajustado ganhos de stats de ataque ao passar de n\u00edvel weapons, ganha-se menos do stat que n\u00e3o \u00e9 a afinidade (watk/matk).\n+Implementado sistema de Party Search no fonte. L\u00edderes de party s\u00e3o servidos em FIFO, buscando melhores jogadores na faixa escolhida sempre que poss\u00edvel. Thread separada lida com organiza\u00e7\u00e3o e convites automatizados para jogadores.\n Corrigido drops de mesos sendo bloqueados para drops r\u00e1pidos de mesos, indevidamente dificultando jogabilidade para certas classes.\n Corrigido caso de XML parser em MapleSkillBookInformationParser n\u00e3o lidando com terminadores \"/>\" corretamente.\n \n@@ -1851,5 +1852,23 @@ Adicionado server flag para checagem de IP's ao logar jogadores.\n Corrigido mobskills n\u00e3o sendo devidamente aplicados devido a um deslize anterior que tentaria aplicar indevidamente 2x \"uso de skill\" (uma das vezes deveria ser somente checagem de rotina).\n Corrigido puppets de arqueiros interrompendo mob statuses para o dono ao serem lan\u00e7ados em campo.\n \n+03 Maio 2019,\n+Revisado chance de drops de skillbooks. Chance de drops agora est\u00e1 relacionado ao n\u00edvel do mob em conjunto com disponibilidade do mesmo (em bosses chances s\u00e3o melhores de sair o item).\n+Ajustado ganhos de party bonus EXP. Penalidade por diferen\u00e7a de n\u00edvel agora somente leva em conta membros de equipe que efetivamente participaram da a\u00e7\u00e3o.\n+Ajustado as mec\u00e2nicas da Party Search recentemente implementadas, de forma que se comporte bem em jogo.\n+Ajustado inicializa\u00e7\u00e3o do sistema de comandos, agora atuando na inicializa\u00e7\u00e3o do server, evitando bottleneck de primeira instancia\u00e7\u00e3o.\n+\n 04 Maio 2019,\n-Corrigido vis\u00e3o de mob statuses sendo interrompido para o novo controlador ao realizar troca de controladores.\n\\ No newline at end of file\n+Corrigido vis\u00e3o de mob statuses sendo interrompido para o novo controlador ao realizar troca de controladores.\n+\n+07 - 08 Maio 2019,\n+Adicionado ao sistema de buffs suporte para condicionais de atua\u00e7\u00e3o (e.g. buff tendo efeito ativo dependendo do mapa de onde o jogador se encontra).\n+Implementado ordena\u00e7\u00e3o topol\u00f3gica na atualiza\u00e7\u00e3o de buffs. Sistema aponta um \"melhor caminho\" na atualiza\u00e7\u00e3o dos buffs, desta forma mostrando visualmente ao jogador certas combina\u00e7\u00f5es de buffs aplicados que anteriormente falhava em mostrar (e.g. Congrats from GM & Chocolate Wafer).\n+Corrigido Arans n\u00e3o recebendo corretamente buff de velocidade de ataque do Dojo.\n+Implementado convite de Party Search sens\u00edvel ao mapa onde os jogadores l\u00edder e convidado se encontram. O sistema somente detecta para convites jogadores em mapas \"pr\u00f3ximos\".\n+\n+12 Maio 2019,\n+Corrigido pets sendo indevidamente removido da DB ao realizar opera\u00e7\u00f5es de retirada do invent\u00e1rio.\n+\n+15 Maio 2019,\n+Revisado, via testes unit\u00e1rios, robustez dos registros/buscas de jogadores e fluidez do sistema de Party Search.\n\\ No newline at end of file"}, {"sha": "a8be1e38be5ff607986f4321e3d29f284142d45d", "filename": "scripts/npc/1012112.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/1012112.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/1012112.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012112.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -58,7 +58,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n \n-                cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to redeem an instance hat.\");\n+                cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to redeem an instance hat.\");\n             } else if (status == 1) {\n                 if (selection == 0) {\n                     if (cm.getParty() == null) {\n@@ -81,7 +81,8 @@ function action(mode, type, selection) {\n                         cm.dispose();\n                     }\n                 } else if (selection == 1) {\n-                    cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                    var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                    cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                     cm.dispose();\n                 } else if (selection == 2) {\n                     cm.sendOk(\"#e#b<Party Quest: Primrose Hill>#k#n\\r\\nCollect primrose seeds from the flowers at the bottom part of the map and drop them by the platforms above the stage. Primrose seed color must match to grow the seeds, so test until you find the correct combination. When all the seeds have been planted, that is, starting second part of the mission, scout the Moon Bunny while it prepares Rice Cakes for the hungry Growlie. Once Growlie becomes satisfied, your mission is complete.\");"}, {"sha": "e521c4ac445d7c6d6f55f34e1a8c8372db76ec84", "filename": "scripts/npc/1052013.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/1052013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/1052013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052013.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -102,7 +102,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Premium Road - \" + levels[selection] + \">\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThe #p1052014# operates differently than the common ones. They do not use mesos or gachapon tickets, rather #rERASERS#k, that can be obtained by completing the missions held on the Premium Road. To go there, you must find partners and attend to a Party Quest. When teamed up and ready, have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Premium Road - \" + levels[selection] + \">\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThe #p1052014# operates differently than the common ones. They do not use mesos or gachapon tickets, rather #rERASERS#k, that can be obtained by completing the missions held on the Premium Road. To go there, you must find partners and attend to a Party Quest. When teamed up and ready, have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         } else if (status == 2) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -125,7 +125,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Premium Road>#k#n\\r\\nOn the maps ahead, you will face many common-leveled mobs to face on. Grind all the required coupons from them and give it to me. All members will then receive a eraser, corresponding with the level faced. Insert on the machine #bmany of the same eraser or multiple different ones#k to have a better chance on greater prizes.\");"}, {"sha": "415f0f51370aa3a775b58893ca0e066d779b5fca", "filename": "scripts/npc/2013000.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2013000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2013000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2013000.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -58,7 +58,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Tower of Goddess>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to assemble or join a team to solve the puzzles of the #bTower of Goddess#k? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to reclaim a prize.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Tower of Goddess>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to assemble or join a team to solve the puzzles of the #bTower of Goddess#k? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to reclaim a prize.\");\n                         } else if (status == 1) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -81,7 +81,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else if (selection == 2) {\n                                         cm.sendOk(\"#e#b<Party Quest: Tower of Goddess>#k#n\\r\\nOur goddess has been missing since some time ago, rumor has it She has been seen last time inside the Tower of Goddess. Furthermore, our sanctuary has been seized by the overwhelming forces of the pixies, those beings that are recently wandering at the outskirts of Orbis. Their leader, Papa Pixie, currently holds the throne and may know Her whereabouts, so we urge to find a composition of brave heroes to charge into and claim back our sanctuary and rescue Her. If your team is able to be a composite of every job niche available (Warrior, Magician, Bowman, Thief and Pirate), you guys will receive my blessings to aid you in battle. Will you aid us?\\r\\n\");"}, {"sha": "5e7f0b5defc73daec5f76388546911f47423e90c", "filename": "scripts/npc/2040034.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2040034.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2040034.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2040034.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -38,7 +38,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Dimensional Schism>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou can't go any higher because of the extremely dangerous creatures above. Would you like to collaborate with party members to complete the quest? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Dimensional Schism>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou can't go any higher because of the extremely dangerous creatures above. Would you like to collaborate with party members to complete the quest? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -61,7 +61,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: Dimensional Schism>#k#n\\r\\nA Dimensional Schism has appeared in #b#m220000000#!#k We desperately need brave adventurers who can defeat the intruding monsters. Please, party with some dependable allies to save #m220000000#! You must pass through various stages by defeating monsters and solving quizzes, and ultimately defeat #r#o9300012##k.\");"}, {"sha": "4c664b85ae3cf62a2917b5cf179898dc90ccb8a4", "filename": "scripts/npc/2041023.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2041023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2041023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041023.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -66,7 +66,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Elemental Thanatos>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou are looking for Elemental Thanatos, right? If you team up with another mage, with the opposite elemental affinity as yours, you guys will be able to overcome them. As a leader, talk to me when you feel ready to go.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Elemental Thanatos>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou are looking for Elemental Thanatos, right? If you team up with another mage, with the opposite elemental affinity as yours, you guys will be able to overcome them. As a leader, talk to me when you feel ready to go.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -89,7 +89,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: Elemental Thanatos>#k#n\\r\\n Team up with another mage with #rdifferent elemental affinity#k before entering the stage. This team aspect is crucial to overcome the elementals inside.\");"}, {"sha": "0aa28a81d2a0119f20f00f0d7367d111ae67e74a", "filename": "scripts/npc/2083001.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2083001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2083001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2083001.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -64,7 +64,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Horntail Trial Grounds>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThis is the path to Horntail's lair. If you want to face him, you and your team shall be tested on the trial grounds ahead.#b\\r\\n#L0#Let us pass to the trial grounds.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Horntail Trial Grounds>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThis is the path to Horntail's lair. If you want to face him, you and your team shall be tested on the trial grounds ahead.#b\\r\\n#L0#Let us pass to the trial grounds.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         } else if (status == 1) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -87,7 +87,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if(selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Horntail Trial Grounds>#k#n\\r\\nAs the gatekeeper of Horntail's lair, I will grant access #bjust to those worthy#k of his presence. Even for those people, the path inside is that of a maze, full of branches and trials. However, those #radept at fighting squad bosses#k have a better chance to stand to our leader, although those #rof our kind#k have a shabby chance as well.\");"}, {"sha": "0a35405ade6a6f4f6c3937ba75068184b948bd8b", "filename": "scripts/npc/2094000.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2094000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2094000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2094000.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -57,7 +57,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Pirate Ship>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHelp! My son has been kidnapped and is bound on the hands of the fearful #rLord Pirate#k. I need your help... Would you please assemble or join a team to save him? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Pirate Ship>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHelp! My son has been kidnapped and is bound on the hands of the fearful #rLord Pirate#k. I need your help... Would you please assemble or join a team to save him? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -80,7 +80,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: Pirate Ship>#k#n\\r\\nIn this PQ, your mission is to progressively make your way through the ship, taking on all pirates and baddies in your path. Reaching the #rLord Pirate#k, depending on how many great chests you opened on the stages before, the boss will reveal himself even more powerful, so stay alert. Said chests, if opened, gives many extra rewards to your crew, it's worth a shot! Good luck.\");"}, {"sha": "faafa64a3cfad15ee352766e1b7eedef369e07ce", "filename": "scripts/npc/2095000.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2095000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2095000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2095000.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -54,7 +54,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Save Delli>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nAh, #r#p1095000##k sent you here? Is she worried about me? ... I'm terribly sorry to hear that, but I can't really go back just yet, some monsters are under the Black Mage's influence, and it's up to me to liberate them! ... It seems you're not going to accept that either, huh? Would you like to collaborate with party members to help me? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Save Delli>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nAh, #r#p1095000##k sent you here? Is she worried about me? ... I'm terribly sorry to hear that, but I can't really go back just yet, some monsters are under the Black Mage's influence, and it's up to me to liberate them! ... It seems you're not going to accept that either, huh? Would you like to collaborate with party members to help me? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         } else {\n                                 cm.sendYesNo(\"The mission succeeded, thanks for escorting me! I can lead you to #b#m120000104##k, are you ready?\");\n                         }\n@@ -81,7 +81,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Save Delli>#k#n\\r\\n A ambush is under way! I must stand on the field for around 6 minutes to complete the liberation, please protect me during that time so that my mission is completed.\");"}, {"sha": "bbf907d81333a231e9461bd8fe9a1210385f1a76", "filename": "scripts/npc/2112003.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2112003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2112003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2112003.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -65,7 +65,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Romeo and Juliet>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nMy beloved Romeo has been kidnapped! Although he is Zenumist's, I can't stand by and just see him suffer just because of this foolish clash. I need you and your colleagues help to save him! Please, help us!! Please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Romeo and Juliet>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nMy beloved Romeo has been kidnapped! Although he is Zenumist's, I can't stand by and just see him suffer just because of this foolish clash. I need you and your colleagues help to save him! Please, help us!! Please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         } else if (status == 1) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -88,7 +88,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Romeo and Juliet>#k#n\\r\\nNot long ago, a scientist named Yulete has been banished from this town because of his researches of combined alchemies of Alcadno's and Zenumist's. Because of the immensurable amount of power coming from this combination, it is forbidden by law to study both. Yet, he ignored this law and got hands in both researches. As a result, he has been exiled.\\r\\nHe is now retaliating, already took my beloved one and his next target is me, as we are big pictures of Magatia, successors of both societies. But I'm not afraid. We must recover him at all costs!\\r\\n\");"}, {"sha": "02b02a895a217005bc38cc109bae3f9a8165de90", "filename": "scripts/npc/2112004.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2112004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2112004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2112004.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -65,7 +65,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Romeo and Juliet>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nMy beloved Juliet has been kidnapped! Although she is Alcadno's, I can't stand by and just see her suffer just because of this foolish clash. I need you and your colleagues help to save her! Please, help us!! Please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Romeo and Juliet>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nMy beloved Juliet has been kidnapped! Although she is Alcadno's, I can't stand by and just see her suffer just because of this foolish clash. I need you and your colleagues help to save her! Please, help us!! Please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         } else if (status == 1) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -88,7 +88,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Romeo and Juliet>#k#n\\r\\nNot long ago, a scientist named Yulete has been banished from this town because of his researches of combined alchemies of Alcadno's and Zenumist's. Because of the immensurable amount of power coming from this combination, it is forbidden by law to study both. Yet, he ignored this law and got hands in both researches. As a result, he has been exiled.\\r\\nHe is now retaliating, already took my beloved one and his next target is me, as we are big pictures of Magatia, successors of both societies. But I'm not afraid. We must recover her at all costs!\\r\\n\");"}, {"sha": "68ec447716a16e4ac281b1921b2ecd049af05807", "filename": "scripts/npc/2133000.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2133000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/2133000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2133000.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -57,7 +57,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Forest of Poison Haze>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to assemble or join a team to solve the puzzles of the #bForest of Poison Haze#k? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to reclaim a prize.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Forest of Poison Haze>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to assemble or join a team to solve the puzzles of the #bForest of Poison Haze#k? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to reclaim a prize.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -80,7 +80,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else if (selection == 2) {\n                                 cm.sendOk(\"#e#b<Party Quest: Forest of Poison Haze>#k#n\\r\\nIn this PQ, your mission is to progressively make your way through the woods, taking on all baddies in your path, solving many puzzles you encounter and rallying yourselves to take the best of teamwork to overcome time limits and powerful creatures. Clearing the final boss, your team have a chance to obtain a marble that, #bwhen dropped by the fountain at the exit map#k, will guarantee the team extra prizes. Good luck.\");"}, {"sha": "7fa0cbab9c5769d2c466a57b8a03f0b48bc3c63d", "filename": "scripts/npc/9000037.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9000037.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9000037.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9000037.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -122,7 +122,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n                                 \n-                                cm.sendSimple(\"#e#b<Party Quest: Boss Rush>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to collaborate with party members to complete the expedition, or are you brave enough to take it on all by yourself? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Boss Rush>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nWould you like to collaborate with party members to complete the expedition, or are you brave enough to take it on all by yourself? Have your #bparty leader#k talk to me or make yourself a party.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         }\n                 } else if (status == 1) {\n                         if(state == 3) {\n@@ -171,7 +171,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: Boss Rush>#k#n\\r\\nBrave adventurers from all over the places travels here to test their skills and abilities in combat, as they face even more powerful bosses from MapleStory. Join forces with fellow adventurers or face all the burden by yourself and receive all the glory, it is up to you. REWARDS are given accordingly to how far the adventurers reach and extra prizes may are given to a random member of the party, all attributed at the end of an expedition.\\r\\n\\r\\nThis instance also supports #bmultiple lobbies for matchmaking several ranges of team levels#k at once: team up with players with lower level if you want better chances to swiftly set up a boss rush for your team.\");"}, {"sha": "a5e8aa3707c5fb17d141bb95d72102d5594ca193", "filename": "scripts/npc/9020000.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9020000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9020000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9020000.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -62,7 +62,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n                             \n-                                cm.sendSimple(\"#e#b<Party Quest: 1st Accompaniment>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHow about you and your party members collectively beating a quest? Here you'll find obstacles and problems where you won't be able to beat it without great teamwork. If you want to try it, please tell the #bleader of your party#k to talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: 1st Accompaniment>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHow about you and your party members collectively beating a quest? Here you'll find obstacles and problems where you won't be able to beat it without great teamwork. If you want to try it, please tell the #bleader of your party#k to talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                         }\n                 } else if (status == 1) {\n                         if(state == 1) {\n@@ -91,7 +91,8 @@ function action(mode, type, selection) {\n                                                 cm.dispose();\n                                         }\n                                 } else if (selection == 1) {\n-                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"#e#b<Party Quest: 1st Accompaniment>#k#n\\r\\nYour party must pass through many obstacles and puzzles while traversing the sub-objectives of this Party Quest. Coordinate with your team in order to further advance and defeat the final boss and collect the dropped item in order to access the rewards and bonus stage.\");"}, {"sha": "33a156f98ba2224f18d48d8e671f14023c483b4a", "filename": "scripts/npc/9103001.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9103001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9103001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9103001.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -61,7 +61,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Ludibrium Maze>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThis is the entrance to the Ludibrium Maze. Enjoy!\\r\\n#b#L0#Enter the Lubidrium Maze#l\\r\\n#L1#I want to find party members.\\r\\n#L2#What is the Ludibrium Maze?\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Ludibrium Maze>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThis is the entrance to the Ludibrium Maze. Enjoy!\\r\\n#b#L0#Enter the Lubidrium Maze#l\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#What is the Ludibrium Maze?\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -84,7 +84,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: Ludibrium Maze>#k#n\\r\\nThis maze is available to all parties of 3 or more members, and all participants must be between Level 51~70.  You will be given 15 minutes to escape the maze.  At the center of the room, there will be a Warp Portal set up to transport you to a different room.  These portals will transport you to other rooms where you'll (hopefully) find the exit.  Pietri will be waiting at the exit, so all you need to do is talk to him, and he'll let you out.  Break all the boxes located in the room, and a monster inside the box will drop a coupon.  After escaping the maze, you will be awarded with EXP based on the coupons collected.  Additionally, if the leader possesses at least 30 coupons, then a special gift will be presented to the party.  If you cannot escape the maze within the allotted 15 minutes, you will receive 0 EXP for your time in the maze.  If you decide to log off while you're in the maze, you will be automatically kicked out of the maze.  Even if the members of the party leave in the middle of the quest, the remaining members will be able to continue on with the quest, except if they run out of the minimum amount of party members in the maze.  If you are in critical condition and unable to hunt down the monsters, you may avoid them to save yourself.  Your fighting spirit and wits will be tested!  Good luck!\");"}, {"sha": "eb128a35c737be7b948412d37724e03bf4cd6ba3", "filename": "scripts/npc/9105004.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9105004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9105004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9105004.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -72,7 +72,7 @@ function recruitPqAction(mode, type, selection) {\n                         return;\n                 }\n \n-                cm.sendSimple(\"#e#b<Party Quest: Holiday>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHow about you and your party members collectively beating a quest? Here you'll find obstacles and problems where you won't be able to beat it without great teamwork. If you want to try it, please tell the #bleader of your party#k to talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                cm.sendSimple(\"#e#b<Party Quest: Holiday>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nHow about you and your party members collectively beating a quest? Here you'll find obstacles and problems where you won't be able to beat it without great teamwork. If you want to try it, please tell the #bleader of your party#k to talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n         } else if (status == 1) {\n                 if (selection == 0) {\n                         if (cm.getParty() == null) {\n@@ -95,7 +95,8 @@ function recruitPqAction(mode, type, selection) {\n                                 cm.dispose();\n                         }\n                 } else if (selection == 1) {\n-                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                        var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                        cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                         cm.dispose();\n                 } else {\n                         cm.sendOk(\"#e#b<Party Quest: Holiday>#k#n\\r\\n\\r\\nJoin in with your team to build up the Snowman that will protect Happyville from the misdoings of Scrooge. While inside, work out with your team to protect it at any means necessary while collecting Snow Vigor that will help on the build up of the Snowman.\");"}, {"sha": "15ba31bb15690482f81a0e4c55ad60eb8d8a556a", "filename": "scripts/npc/9201048.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9201048.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9201048.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201048.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -57,7 +57,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                     \n-                        cm.sendSimple(\"#e#b<Party Quest: Amorian Challenge>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nIf you're brave enough to attempt the Amorian Challenge, join with others like you and let your #bparty leader#k talk to me. If a party filled with whole married couples register to the challenge, better prizes awaits there.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: Amorian Challenge>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nIf you're brave enough to attempt the Amorian Challenge, join with others like you and let your #bparty leader#k talk to me. If a party filled with whole married couples register to the challenge, better prizes awaits there.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -80,7 +80,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: Amorian Challenge>#k#n\\r\\nI am Amos, hoster of the well-round famed Amorian Challenge. The instance consist of many team puzzles, where cooperation is the fundamental key for progress. Team up with other players to attempt for the bonus stage, where many goodies can be obtained at the end of the instance. If an all-couple party is formed, they can get even better prizes on the extra bonus stage.\");"}, {"sha": "fb9b6316010c92a54ac9b57906eb541784e11663", "filename": "scripts/npc/9220018.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9220018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9220018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9220018.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -56,7 +56,7 @@ function action(mode, type, selection) {\n                                 return;\n                         }\n                         \n-                        cm.sendSimple(\"#e#b<Party Quest: MV's Lair>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou can't go any further because of the extremely dangerous creatures lying ahead. Would you like to collaborate with party members to complete the quest? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                        cm.sendSimple(\"#e#b<Party Quest: MV's Lair>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nYou can't go any further because of the extremely dangerous creatures lying ahead. Would you like to collaborate with party members to complete the quest? If so, please have your #bparty leader#k talk to me.#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I would like to \" + (cm.getPlayer().isRecvPartySearchInviteEnabled() ? \"disable\" : \"enable\") + \" Party Search.\\r\\n#L2#I would like to hear more details.\");\n                 } else if (status == 1) {\n                         if (selection == 0) {\n                                 if (cm.getParty() == null) {\n@@ -79,7 +79,8 @@ function action(mode, type, selection) {\n                                         cm.dispose();\n                                 }\n                         } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                var psState = cm.getPlayer().toggleRecvPartySearchInvite();\n+                                cm.sendOk(\"Your Party Search status is now: #b\" + (psState ? \"enabled\" : \"disabled\") + \"#k. Talk to me whenever you want to change it back.\");\n                                 cm.dispose();\n                         } else {\n                                 cm.sendOk(\"#e#b<Party Quest: MV's Lair>#k#n\\r\\nMV appeared once more, disrupting the welfare of the people of New Leaf City. Join forces with other maplers to fend off this sudden attack. After defeating MV and his minions, fetch your prizes at MV's treasure room.\");"}, {"sha": "35cd83b79b050112ba24719cfe31f16cdb2b4c85", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -75,6 +75,7 @@ function writeFeatureTab_Quests() {\n }\n \n function writeFeatureTab_PlayerSocialNetwork() {\n+        addFeature(\"Party Search fully functional.\");\n         addFeature(\"Guild and Alliance system fully functional.\");\n         addFeature(\"Guild contract system held in Guild Headquarters.\");\n         addFeature(\"Party for novices-only.\");\n@@ -180,6 +181,7 @@ function writeFeatureTab_Playerpotentials() {\n         addFeature(\"Character slots per world/server-wide.\");\n         addFeature(\"Optional cash shop inventory separated by classes.\");\n         addFeature(\"Players manage 'same-typed' invites exclusively.\");\n+        addFeature(\"Player buffs with conditional active effects.\");\n }\n \n function writeFeatureTab_Serverpotentials() {"}, {"sha": "05b2fdae1d70800d8fb4ccc6e7391427189af1d0", "filename": "sql/db_database.sql", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -184,7 +184,7 @@ CREATE TABLE IF NOT EXISTS `characters` (\n   `dataString` varchar(64) NOT NULL DEFAULT '',\n   `lastLogoutTime` timestamp NOT NULL DEFAULT '2015-01-01 05:00:00',\n   `lastExpGainTime` timestamp NOT NULL DEFAULT '2015-01-01 05:00:00',\n-  `pendantExp` tinyint(1) NOT NULL DEFAULT '0',\n+  `partySearch` tinyint(1) NOT NULL DEFAULT '0',\n   `jailexpire` bigint(20) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`id`),\n   KEY `accountid` (`accountid`),\n@@ -12750,7 +12750,7 @@ INSERT IGNORE INTO `temp_data` (`dropperid`, `itemid`, `minimum_quantity`, `maxi\n (8150200, 2290135, 1, 1, 0, 1500),\n (8800002, 2280013, 1, 1, 0, 45000),\n (8140600, 2290132, 1, 1, 0, 1500),\n-(851000, 2290132, 1, 1, 0, 15000),\n+(8510000, 2290132, 1, 1, 0, 15000),\n (8520000, 2290132, 1, 1, 0, 15000),\n (8810018, 2290133, 1, 1, 0, 45000),\n (8200008, 2290133, 1, 1, 0, 1500),"}, {"sha": "67d0abe1b9c5b6adb9f6607ba5ed6f8cda449400", "filename": "sql/db_drops.sql", "status": "modified", "additions": 620, "deletions": 2, "changes": 622, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -17212,7 +17212,7 @@ USE `heavenms`;\n (9400014, 2040719, 1, 4, 0, 10000), \n (9400014, 1102030, 1, 1, 0, 40000), \n (9400014, 1032027, 1, 1, 0, 40000), \n-(9400014, 1402037, 1, 1, 0, 40000), \n+(9400014, 1402037, 1, 1, 0, 40000), # thanks Feras & Kitty for noticing issues with Stonetooth Sword layout\n (9400014, 1372011, 1, 1, 0, 40000), \n (8200008, 4000453, 1, 1, 0, 200000),\n (8200008, 4000459, 1, 1, 0, 200000), \n@@ -23923,4 +23923,622 @@ SET minimum_quantity = CASE\n   ELSE maximum_quantity END\n ;\n \n-  UPDATE drop_data SET `chance`=1287 WHERE `chance`=1500;\n\\ No newline at end of file\n+  UPDATE drop_data SET `chance`=1287 WHERE `chance`=1500;\n+\n+  # MapleSkillbookChanceFetcher! Tuning up some skillbook drop chances in order to fit their dropper's availability (whether's a boss or not) and level.\n+  REPLACE INTO drop_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n+(851000, 2290132, 1, 1, 0, 3861),\n+(7090000, 2290087, 1, 1, 0, 40000),\n+(8090000, 2290045, 1, 1, 0, 40000),\n+(8140103, 2290044, 1, 1, 0, 2000),\n+(8140511, 2290009, 1, 1, 0, 2000),\n+(8140511, 2290050, 1, 1, 0, 2000),\n+(8140511, 2290083, 1, 1, 0, 2000),\n+(8140511, 2290134, 1, 1, 0, 6000),\n+(8140512, 2290013, 1, 1, 0, 2000),\n+(8140512, 2290067, 1, 1, 0, 2000),\n+(8140512, 2290082, 1, 1, 0, 2000),\n+(8140512, 2290097, 1, 1, 0, 2000),\n+(8140512, 2290116, 1, 1, 0, 2000),\n+(8140512, 2290131, 1, 1, 0, 6000),\n+(8140600, 2290132, 1, 1, 0, 6000),\n+(8140700, 2290106, 1, 1, 0, 2000),\n+(8140700, 2290126, 1, 1, 0, 6000),\n+(8140701, 2290122, 1, 1, 0, 2000),\n+(8140702, 2290112, 1, 1, 0, 2000),\n+(8140703, 2290088, 1, 1, 0, 2000),\n+(8140703, 2290099, 1, 1, 0, 2000),\n+(8141000, 2290082, 1, 1, 0, 2000),\n+(8141000, 2290097, 1, 1, 0, 2000),\n+(8141100, 2280005, 1, 1, 0, 2000),\n+(8141300, 2290098, 1, 1, 0, 2000),\n+(8142100, 2290032, 1, 1, 0, 2000),\n+(8142100, 2290082, 1, 1, 0, 2000),\n+(8142100, 2290114, 1, 1, 0, 2000),\n+(8143000, 2280004, 1, 1, 0, 2000),\n+(8150000, 2280013, 1, 1, 0, 120000),\n+(8150000, 2290070, 1, 1, 0, 40000),\n+(8150000, 2290091, 1, 1, 0, 40000),\n+(8150100, 2290042, 1, 1, 0, 2000),\n+(8150100, 2290053, 1, 1, 0, 2000),\n+(8150100, 2290073, 1, 1, 0, 2000),\n+(8150100, 2290102, 1, 1, 0, 2000),\n+(8150100, 2290118, 1, 1, 0, 2000),\n+(8150101, 2290017, 1, 1, 0, 2000),\n+(8150101, 2290021, 1, 1, 0, 2000),\n+(8150101, 2290035, 1, 1, 0, 2000),\n+(8150101, 2290042, 1, 1, 0, 2000),\n+(8150101, 2290052, 1, 1, 0, 2000),\n+(8150101, 2290102, 1, 1, 0, 2000),\n+(8150200, 2290024, 1, 1, 0, 2000),\n+(8150200, 2290100, 1, 1, 0, 2000),\n+(8150200, 2290135, 1, 1, 0, 6000),\n+(8150201, 2290004, 1, 1, 0, 2000),\n+(8150201, 2290006, 1, 1, 0, 2000),\n+(8150201, 2290024, 1, 1, 0, 2000),\n+(8150201, 2290036, 1, 1, 0, 2000),\n+(8150201, 2290056, 1, 1, 0, 2000),\n+(8150201, 2290072, 1, 1, 0, 2000),\n+(8150201, 2290078, 1, 1, 0, 2000),\n+(8150201, 2290117, 1, 1, 0, 2000),\n+(8150300, 2290003, 1, 1, 0, 2000),\n+(8150300, 2290033, 1, 1, 0, 2000),\n+(8150300, 2290111, 1, 1, 0, 2000),\n+(8150300, 2290120, 1, 1, 0, 2000),\n+(8150300, 2290127, 1, 1, 0, 6000),\n+(8150301, 2290023, 1, 1, 0, 2000),\n+(8150301, 2290029, 1, 1, 0, 2000),\n+(8150301, 2290101, 1, 1, 0, 2000),\n+(8150301, 2290107, 1, 1, 0, 2000),\n+(8150302, 2290010, 1, 1, 0, 2000),\n+(8150302, 2290019, 1, 1, 0, 2000),\n+(8150302, 2290026, 1, 1, 0, 2000),\n+(8150302, 2290076, 1, 1, 0, 2000),\n+(8150302, 2290085, 1, 1, 0, 2000),\n+(8150302, 2290096, 1, 1, 0, 2000),\n+(8150302, 2290113, 1, 1, 0, 2000),\n+(8150302, 2290119, 1, 1, 0, 2000),\n+(8150302, 2290128, 1, 1, 0, 6000),\n+(8160000, 2290017, 1, 1, 0, 2000),\n+(8160000, 2290045, 1, 1, 0, 2000),\n+(8160000, 2290065, 1, 1, 0, 2000),\n+(8160000, 2290067, 1, 1, 0, 2000),\n+(8160000, 2290081, 1, 1, 0, 2000),\n+(8170000, 2290012, 1, 1, 0, 2000),\n+(8170000, 2290086, 1, 1, 0, 2000),\n+(8170000, 2290087, 1, 1, 0, 2000),\n+(8170000, 2290134, 1, 1, 0, 6000),\n+(8180000, 2290002, 1, 1, 0, 40000),\n+(8180000, 2290003, 1, 1, 0, 40000),\n+(8180000, 2290014, 1, 1, 0, 40000),\n+(8180000, 2290015, 1, 1, 0, 40000),\n+(8180000, 2290030, 1, 1, 0, 40000),\n+(8180000, 2290035, 1, 1, 0, 40000),\n+(8180000, 2290036, 1, 1, 0, 40000),\n+(8180000, 2290063, 1, 1, 0, 40000),\n+(8180000, 2290080, 1, 1, 0, 40000),\n+(8180000, 2290098, 1, 1, 0, 40000),\n+(8180000, 2290101, 1, 1, 0, 40000),\n+(8180000, 2290117, 1, 1, 0, 40000),\n+(8180000, 2290130, 1, 1, 0, 120000),\n+(8180001, 2290018, 1, 1, 0, 40000),\n+(8180001, 2290019, 1, 1, 0, 40000),\n+(8180001, 2290032, 1, 1, 0, 40000),\n+(8180001, 2290042, 1, 1, 0, 40000),\n+(8180001, 2290058, 1, 1, 0, 40000),\n+(8180001, 2290059, 1, 1, 0, 40000),\n+(8180001, 2290068, 1, 1, 0, 40000),\n+(8180001, 2290069, 1, 1, 0, 40000),\n+(8180001, 2290072, 1, 1, 0, 40000),\n+(8180001, 2290092, 1, 1, 0, 40000),\n+(8180001, 2290099, 1, 1, 0, 40000),\n+(8180001, 2290100, 1, 1, 0, 40000),\n+(8180001, 2290102, 1, 1, 0, 40000),\n+(8180001, 2290119, 1, 1, 0, 40000),\n+(8180001, 2290128, 1, 1, 0, 120000),\n+(8190000, 2280016, 1, 1, 0, 6000),\n+(8190000, 2290030, 1, 1, 0, 2000),\n+(8190000, 2290044, 1, 1, 0, 2000),\n+(8190000, 2290054, 1, 1, 0, 2000),\n+(8190000, 2290066, 1, 1, 0, 2000),\n+(8190000, 2290075, 1, 1, 0, 2000),\n+(8190000, 2290092, 1, 1, 0, 2000),\n+(8190000, 2290103, 1, 1, 0, 2000),\n+(8190002, 2290000, 1, 1, 0, 2000),\n+(8190002, 2290008, 1, 1, 0, 2000),\n+(8190002, 2290018, 1, 1, 0, 2000),\n+(8190002, 2290038, 1, 1, 0, 2000),\n+(8190002, 2290060, 1, 1, 0, 2000),\n+(8190002, 2290080, 1, 1, 0, 2000),\n+(8190002, 2290124, 1, 1, 0, 2000),\n+(8190003, 2280013, 1, 1, 0, 6000),\n+(8190003, 2290007, 1, 1, 0, 2000),\n+(8190003, 2290012, 1, 1, 0, 2000),\n+(8190003, 2290014, 1, 1, 0, 2000),\n+(8190003, 2290033, 1, 1, 0, 2000),\n+(8190003, 2290045, 1, 1, 0, 2000),\n+(8190003, 2290050, 1, 1, 0, 2000),\n+(8190003, 2290055, 1, 1, 0, 2000),\n+(8190003, 2290062, 1, 1, 0, 2000),\n+(8190003, 2290063, 1, 1, 0, 2000),\n+(8190003, 2290070, 1, 1, 0, 2000),\n+(8190003, 2290086, 1, 1, 0, 2000),\n+(8190003, 2290108, 1, 1, 0, 2000),\n+(8190003, 2290133, 1, 1, 0, 6000),\n+(8190004, 2290002, 1, 1, 0, 2000),\n+(8190004, 2290009, 1, 1, 0, 2000),\n+(8190004, 2290021, 1, 1, 0, 2000),\n+(8190004, 2290034, 1, 1, 0, 2000),\n+(8190004, 2290041, 1, 1, 0, 2000),\n+(8190004, 2290052, 1, 1, 0, 2000),\n+(8190004, 2290053, 1, 1, 0, 2000),\n+(8190004, 2290058, 1, 1, 0, 2000),\n+(8190004, 2290068, 1, 1, 0, 2000),\n+(8190004, 2290071, 1, 1, 0, 2000),\n+(8190004, 2290073, 1, 1, 0, 2000),\n+(8190004, 2290090, 1, 1, 0, 2000),\n+(8190004, 2290112, 1, 1, 0, 2000),\n+(8190004, 2290121, 1, 1, 0, 2000),\n+(8190004, 2290130, 1, 1, 0, 6000),\n+(8190005, 2290000, 1, 1, 0, 2000),\n+(8190005, 2290008, 1, 1, 0, 2000),\n+(8190005, 2290018, 1, 1, 0, 2000),\n+(8190005, 2290038, 1, 1, 0, 2000),\n+(8190005, 2290060, 1, 1, 0, 2000),\n+(8190005, 2290080, 1, 1, 0, 2000),\n+(8190005, 2290124, 1, 1, 0, 2000),\n+(8200000, 2290005, 1, 1, 0, 2000),\n+(8200000, 2290011, 1, 1, 0, 2000),\n+(8200000, 2290114, 1, 1, 0, 2000),\n+(8200001, 2280015, 1, 1, 0, 6000),\n+(8200001, 2290050, 1, 1, 0, 2000),\n+(8200001, 2290059, 1, 1, 0, 2000),\n+(8200001, 2290065, 1, 1, 0, 2000),\n+(8200001, 2290129, 1, 1, 0, 6000),\n+(8200002, 2290062, 1, 1, 0, 2000),\n+(8200002, 2290066, 1, 1, 0, 2000),\n+(8200002, 2290070, 1, 1, 0, 2000),\n+(8200002, 2290131, 1, 1, 0, 6000),\n+(8200002, 2290139, 1, 1, 0, 6000),\n+(8200003, 2290012, 1, 1, 0, 2000),\n+(8200003, 2290056, 1, 1, 0, 2000),\n+(8200003, 2290071, 1, 1, 0, 2000),\n+(8200003, 2290101, 1, 1, 0, 2000),\n+(8200003, 2290136, 1, 1, 0, 6000),\n+(8200004, 2280016, 1, 1, 0, 6000),\n+(8200004, 2290069, 1, 1, 0, 2000),\n+(8200004, 2290072, 1, 1, 0, 2000),\n+(8200004, 2290073, 1, 1, 0, 2000),\n+(8200004, 2290127, 1, 1, 0, 6000),\n+(8200004, 2290134, 1, 1, 0, 6000),\n+(8200005, 2280014, 1, 1, 0, 6000),\n+(8200005, 2290078, 1, 1, 0, 2000),\n+(8200005, 2290079, 1, 1, 0, 2000),\n+(8200005, 2290095, 1, 1, 0, 2000),\n+(8200006, 2290003, 1, 1, 0, 2000),\n+(8200006, 2290064, 1, 1, 0, 2000),\n+(8200006, 2290076, 1, 1, 0, 2000),\n+(8200006, 2290077, 1, 1, 0, 2000),\n+(8200006, 2290129, 1, 1, 0, 6000),\n+(8200006, 2290138, 1, 1, 0, 6000),\n+(8200007, 2290006, 1, 1, 0, 2000),\n+(8200007, 2290007, 1, 1, 0, 2000),\n+(8200007, 2290011, 1, 1, 0, 2000),\n+(8200007, 2290016, 1, 1, 0, 2000),\n+(8200007, 2290125, 1, 1, 0, 2000),\n+(8200007, 2290136, 1, 1, 0, 6000),\n+(8200008, 2290006, 1, 1, 0, 2000),\n+(8200008, 2290051, 1, 1, 0, 2000),\n+(8200008, 2290121, 1, 1, 0, 2000),\n+(8200008, 2290122, 1, 1, 0, 2000),\n+(8200008, 2290133, 1, 1, 0, 6000),\n+(8200009, 2290013, 1, 1, 0, 2000),\n+(8200009, 2290016, 1, 1, 0, 2000),\n+(8200009, 2290031, 1, 1, 0, 2000),\n+(8200009, 2290039, 1, 1, 0, 2000),\n+(8200010, 2290026, 1, 1, 0, 2000),\n+(8200010, 2290059, 1, 1, 0, 2000),\n+(8200010, 2290088, 1, 1, 0, 2000),\n+(8200010, 2290089, 1, 1, 0, 2000),\n+(8200010, 2290127, 1, 1, 0, 6000),\n+(8200011, 2290001, 1, 1, 0, 3000),\n+(8200011, 2290040, 1, 1, 0, 3000),\n+(8200011, 2290046, 1, 1, 0, 3000),\n+(8200011, 2290048, 1, 1, 0, 3000),\n+(8200011, 2290049, 1, 1, 0, 3000),\n+(8200011, 2290114, 1, 1, 0, 3000),\n+(8200011, 2290137, 1, 1, 0, 9000),\n+(8200012, 2290041, 1, 1, 0, 3000),\n+(8200012, 2290092, 1, 1, 0, 3000),\n+(8200012, 2290093, 1, 1, 0, 3000),\n+(8200012, 2290115, 1, 1, 0, 3000),\n+(8200012, 2290137, 1, 1, 0, 9000),\n+(8200012, 2290139, 1, 1, 0, 9000),\n+(8220002, 2290020, 1, 1, 0, 40000),\n+(8220002, 2290081, 1, 1, 0, 40000),\n+(8220002, 2290085, 1, 1, 0, 40000),\n+(8220002, 2290133, 1, 1, 0, 120000),\n+(8220003, 2290006, 1, 1, 0, 40000),\n+(8220003, 2290030, 1, 1, 0, 40000),\n+(8220003, 2290031, 1, 1, 0, 40000),\n+(8220003, 2290032, 1, 1, 0, 40000),\n+(8220003, 2290033, 1, 1, 0, 40000),\n+(8220003, 2290060, 1, 1, 0, 40000),\n+(8220003, 2290061, 1, 1, 0, 40000),\n+(8220003, 2290076, 1, 1, 0, 40000),\n+(8220003, 2290077, 1, 1, 0, 40000),\n+(8220003, 2290104, 1, 1, 0, 40000),\n+(8220003, 2290105, 1, 1, 0, 40000),\n+(8220003, 2290117, 1, 1, 0, 40000),\n+(8220003, 2290118, 1, 1, 0, 40000),\n+(8220004, 2290018, 1, 1, 0, 40000),\n+(8220004, 2290019, 1, 1, 0, 40000),\n+(8220004, 2290024, 1, 1, 0, 40000),\n+(8220004, 2290025, 1, 1, 0, 40000),\n+(8220004, 2290058, 1, 1, 0, 40000),\n+(8220004, 2290059, 1, 1, 0, 40000),\n+(8220004, 2290076, 1, 1, 0, 40000),\n+(8220004, 2290077, 1, 1, 0, 40000),\n+(8220004, 2290106, 1, 1, 0, 40000),\n+(8220004, 2290127, 1, 1, 0, 120000),\n+(8220004, 2290134, 1, 1, 0, 120000),\n+(8220005, 2290002, 1, 1, 0, 60000),\n+(8220005, 2290003, 1, 1, 0, 60000),\n+(8220005, 2290036, 1, 1, 0, 60000),\n+(8220005, 2290037, 1, 1, 0, 60000),\n+(8220005, 2290055, 1, 1, 0, 60000),\n+(8220005, 2290080, 1, 1, 0, 60000),\n+(8220005, 2290099, 1, 1, 0, 60000),\n+(8220005, 2290131, 1, 1, 0, 180000),\n+(8220005, 2290136, 1, 1, 0, 180000),\n+(8220006, 2290012, 1, 1, 0, 80000),\n+(8220006, 2290013, 1, 1, 0, 80000),\n+(8220006, 2290042, 1, 1, 0, 80000),\n+(8220006, 2290043, 1, 1, 0, 80000),\n+(8220006, 2290060, 1, 1, 0, 80000),\n+(8220006, 2290061, 1, 1, 0, 80000),\n+(8220006, 2290090, 1, 1, 0, 80000),\n+(8220006, 2290119, 1, 1, 0, 80000),\n+(8220006, 2290120, 1, 1, 0, 80000),\n+(8220006, 2290135, 1, 1, 0, 240000),\n+(8220006, 2290138, 1, 1, 0, 240000),\n+(8220007, 2290035, 1, 1, 0, 40000),\n+(8220007, 2290091, 1, 1, 0, 40000),\n+(8220007, 2290108, 1, 1, 0, 40000),\n+(8220009, 2290031, 1, 1, 0, 40000),\n+(8220009, 2290129, 1, 1, 0, 120000),\n+(8220015, 2280004, 1, 1, 0, 40000),\n+(8220015, 2280005, 1, 1, 0, 40000),\n+(8220015, 2280006, 1, 1, 0, 40000),\n+(8500002, 2280007, 1, 1, 0, 60000),\n+(8500002, 2280008, 1, 1, 0, 60000),\n+(8500002, 2280009, 1, 1, 0, 60000),\n+(8500002, 2280010, 1, 1, 0, 60000),\n+(8500002, 2290006, 1, 1, 0, 60000),\n+(8500002, 2290010, 1, 1, 0, 60000),\n+(8500002, 2290011, 1, 1, 0, 60000),\n+(8500002, 2290013, 1, 1, 0, 60000),\n+(8500002, 2290028, 1, 1, 0, 60000),\n+(8500002, 2290037, 1, 1, 0, 60000),\n+(8500002, 2290043, 1, 1, 0, 60000),\n+(8500002, 2290051, 1, 1, 0, 60000),\n+(8500002, 2290056, 1, 1, 0, 60000),\n+(8500002, 2290061, 1, 1, 0, 60000),\n+(8500002, 2290066, 1, 1, 0, 60000),\n+(8500002, 2290071, 1, 1, 0, 60000),\n+(8500002, 2290078, 1, 1, 0, 60000),\n+(8500002, 2290089, 1, 1, 0, 60000),\n+(8500002, 2290091, 1, 1, 0, 60000),\n+(8500002, 2290104, 1, 1, 0, 60000),\n+(8500002, 2290107, 1, 1, 0, 60000),\n+(8500002, 2290121, 1, 1, 0, 60000),\n+(8500002, 2290123, 1, 1, 0, 60000),\n+(8500002, 2290126, 1, 1, 0, 180000),\n+(8500002, 2290129, 1, 1, 0, 180000),\n+(8510000, 2280007, 1, 1, 0, 40000),\n+(8510000, 2280008, 1, 1, 0, 40000),\n+(8510000, 2280009, 1, 1, 0, 40000),\n+(8510000, 2280010, 1, 1, 0, 40000),\n+(8510000, 2290000, 1, 1, 0, 40000),\n+(8510000, 2290001, 1, 1, 0, 40000),\n+(8510000, 2290004, 1, 1, 0, 40000),\n+(8510000, 2290005, 1, 1, 0, 40000),\n+(8510000, 2290024, 1, 1, 0, 40000),\n+(8510000, 2290025, 1, 1, 0, 40000),\n+(8510000, 2290026, 1, 1, 0, 40000),\n+(8510000, 2290027, 1, 1, 0, 40000),\n+(8510000, 2290052, 1, 1, 0, 40000),\n+(8510000, 2290053, 1, 1, 0, 40000),\n+(8510000, 2290054, 1, 1, 0, 40000),\n+(8510000, 2290055, 1, 1, 0, 40000),\n+(8510000, 2290076, 1, 1, 0, 40000),\n+(8510000, 2290077, 1, 1, 0, 40000),\n+(8510000, 2290082, 1, 1, 0, 40000),\n+(8510000, 2290083, 1, 1, 0, 40000),\n+(8510000, 2290097, 1, 1, 0, 40000),\n+(8510000, 2290099, 1, 1, 0, 40000),\n+(8510000, 2290106, 1, 1, 0, 40000),\n+(8510000, 2290108, 1, 1, 0, 40000),\n+(8510000, 2290112, 1, 1, 0, 40000),\n+(8510000, 2290114, 1, 1, 0, 40000),\n+(8510000, 2290122, 1, 1, 0, 40000),\n+(8510000, 2290124, 1, 1, 0, 40000),\n+(8510000, 2290132, 1, 1, 0, 120000),\n+(8520000, 2280007, 1, 1, 0, 40000),\n+(8520000, 2280008, 1, 1, 0, 40000),\n+(8520000, 2280009, 1, 1, 0, 40000),\n+(8520000, 2280010, 1, 1, 0, 40000),\n+(8520000, 2290000, 1, 1, 0, 40000),\n+(8520000, 2290001, 1, 1, 0, 40000),\n+(8520000, 2290004, 1, 1, 0, 40000),\n+(8520000, 2290005, 1, 1, 0, 40000),\n+(8520000, 2290024, 1, 1, 0, 40000),\n+(8520000, 2290025, 1, 1, 0, 40000),\n+(8520000, 2290026, 1, 1, 0, 40000),\n+(8520000, 2290027, 1, 1, 0, 40000),\n+(8520000, 2290052, 1, 1, 0, 40000),\n+(8520000, 2290053, 1, 1, 0, 40000),\n+(8520000, 2290054, 1, 1, 0, 40000),\n+(8520000, 2290055, 1, 1, 0, 40000),\n+(8520000, 2290076, 1, 1, 0, 40000),\n+(8520000, 2290077, 1, 1, 0, 40000),\n+(8520000, 2290082, 1, 1, 0, 40000),\n+(8520000, 2290083, 1, 1, 0, 40000),\n+(8520000, 2290097, 1, 1, 0, 40000),\n+(8520000, 2290099, 1, 1, 0, 40000),\n+(8520000, 2290106, 1, 1, 0, 40000),\n+(8520000, 2290108, 1, 1, 0, 40000),\n+(8520000, 2290112, 1, 1, 0, 40000),\n+(8520000, 2290114, 1, 1, 0, 40000),\n+(8520000, 2290122, 1, 1, 0, 40000),\n+(8520000, 2290124, 1, 1, 0, 40000),\n+(8520000, 2290132, 1, 1, 0, 120000),\n+(8800002, 2280007, 1, 1, 0, 80000),\n+(8800002, 2280008, 1, 1, 0, 80000),\n+(8800002, 2280009, 1, 1, 0, 80000),\n+(8800002, 2280010, 1, 1, 0, 80000),\n+(8800002, 2280013, 1, 1, 0, 240000),\n+(8800002, 2280014, 1, 1, 0, 240000),\n+(8800002, 2280015, 1, 1, 0, 240000),\n+(8800002, 2280016, 1, 1, 0, 240000),\n+(8800002, 2290006, 1, 1, 0, 80000),\n+(8800002, 2290007, 1, 1, 0, 80000),\n+(8800002, 2290016, 1, 1, 0, 80000),\n+(8800002, 2290020, 1, 1, 0, 80000),\n+(8800002, 2290022, 1, 1, 0, 80000),\n+(8800002, 2290024, 1, 1, 0, 80000),\n+(8800002, 2290028, 1, 1, 0, 80000),\n+(8800002, 2290029, 1, 1, 0, 80000),\n+(8800002, 2290040, 1, 1, 0, 80000),\n+(8800002, 2290046, 1, 1, 0, 80000),\n+(8800002, 2290048, 1, 1, 0, 80000),\n+(8800002, 2290056, 1, 1, 0, 80000),\n+(8800002, 2290057, 1, 1, 0, 80000),\n+(8800002, 2290058, 1, 1, 0, 80000),\n+(8800002, 2290064, 1, 1, 0, 80000),\n+(8800002, 2290067, 1, 1, 0, 80000),\n+(8800002, 2290074, 1, 1, 0, 80000),\n+(8800002, 2290079, 1, 1, 0, 80000),\n+(8800002, 2290084, 1, 1, 0, 80000),\n+(8800002, 2290094, 1, 1, 0, 80000),\n+(8800002, 2290110, 1, 1, 0, 80000),\n+(8800002, 2290115, 1, 1, 0, 80000),\n+(8810018, 2290017, 1, 1, 0, 100000),\n+(8810018, 2290021, 1, 1, 0, 100000),\n+(8810018, 2290023, 1, 1, 0, 100000),\n+(8810018, 2290041, 1, 1, 0, 100000),\n+(8810018, 2290047, 1, 1, 0, 100000),\n+(8810018, 2290049, 1, 1, 0, 100000),\n+(8810018, 2290065, 1, 1, 0, 100000),\n+(8810018, 2290075, 1, 1, 0, 100000),\n+(8810018, 2290085, 1, 1, 0, 100000),\n+(8810018, 2290095, 1, 1, 0, 100000),\n+(8810018, 2290096, 1, 1, 0, 100000),\n+(8810018, 2290111, 1, 1, 0, 100000),\n+(8810018, 2290116, 1, 1, 0, 100000),\n+(8810018, 2290125, 1, 1, 0, 100000),\n+(8810018, 2290133, 1, 1, 0, 300000),\n+(8810018, 2290137, 1, 1, 0, 300000),\n+(8810018, 2290139, 1, 1, 0, 300000),\n+(8820000, 2290010, 1, 1, 0, 120000),\n+(8820000, 2290022, 1, 1, 0, 120000),\n+(8820000, 2290040, 1, 1, 0, 120000),\n+(8820000, 2290046, 1, 1, 0, 120000),\n+(8820000, 2290048, 1, 1, 0, 120000),\n+(8820000, 2290052, 1, 1, 0, 120000),\n+(8820000, 2290084, 1, 1, 0, 120000),\n+(8820000, 2290090, 1, 1, 0, 120000),\n+(8820000, 2290106, 1, 1, 0, 120000),\n+(8820000, 2290119, 1, 1, 0, 120000),\n+(8820001, 2290010, 1, 1, 0, 120000),\n+(8820001, 2290022, 1, 1, 0, 120000),\n+(8820001, 2290040, 1, 1, 0, 120000),\n+(8820001, 2290046, 1, 1, 0, 120000),\n+(8820001, 2290048, 1, 1, 0, 120000),\n+(8820001, 2290052, 1, 1, 0, 120000),\n+(8820001, 2290084, 1, 1, 0, 120000),\n+(8820001, 2290090, 1, 1, 0, 120000),\n+(8820001, 2290106, 1, 1, 0, 120000),\n+(8820001, 2290119, 1, 1, 0, 120000),\n+(9300028, 2280015, 1, 1, 0, 120000),\n+(9300028, 2290026, 1, 1, 0, 40000),\n+(9300028, 2290064, 1, 1, 0, 40000),\n+(9300028, 2290075, 1, 1, 0, 40000),\n+(9300028, 2290093, 1, 1, 0, 40000),\n+(9300028, 2290111, 1, 1, 0, 40000),\n+(9300094, 2280004, 1, 1, 0, 40000),\n+(9300094, 2280005, 1, 1, 0, 40000),\n+(9300094, 2280006, 1, 1, 0, 40000),\n+(9300095, 2280004, 1, 1, 0, 2000),\n+(9300095, 2280005, 1, 1, 0, 2000),\n+(9300095, 2280006, 1, 1, 0, 2000),\n+(9303016, 2290006, 1, 1, 0, 2000),\n+(9303016, 2290030, 1, 1, 0, 2000),\n+(9303016, 2290032, 1, 1, 0, 2000),\n+(9303016, 2290060, 1, 1, 0, 2000),\n+(9303016, 2290076, 1, 1, 0, 2000),\n+(9303016, 2290104, 1, 1, 0, 2000),\n+(9303016, 2290117, 1, 1, 0, 2000),\n+(9400014, 2290053, 1, 1, 0, 40000),\n+(9400014, 2290087, 1, 1, 0, 40000),\n+(9400014, 2290112, 1, 1, 0, 40000),\n+(9400014, 2290122, 1, 1, 0, 40000),\n+(9400120, 2290045, 1, 1, 0, 40000),\n+(9400121, 2280014, 1, 1, 0, 180000),\n+(9400121, 2290081, 1, 1, 0, 60000),\n+(9400121, 2290087, 1, 1, 0, 60000),\n+(9400121, 2290101, 1, 1, 0, 60000),\n+(9400121, 2290103, 1, 1, 0, 60000),\n+(9400122, 2290007, 1, 1, 0, 40000),\n+(9400122, 2290062, 1, 1, 0, 40000),\n+(9400122, 2290116, 1, 1, 0, 40000),\n+(9400300, 2290045, 1, 1, 0, 120000),\n+(9400300, 2290055, 1, 1, 0, 120000),\n+(9400300, 2290063, 1, 1, 0, 120000),\n+(9400300, 2290079, 1, 1, 0, 120000),\n+(9400300, 2290081, 1, 1, 0, 120000),\n+(9400300, 2290096, 1, 1, 0, 120000),\n+(9400514, 2290023, 1, 1, 0, 40000),\n+(9400514, 2290057, 1, 1, 0, 40000),\n+(9400514, 2290088, 1, 1, 0, 40000),\n+(9400514, 2290095, 1, 1, 0, 40000),\n+(9400514, 2290115, 1, 1, 0, 40000),\n+(9400514, 2290139, 1, 1, 0, 120000),\n+(9400549, 2290001, 1, 1, 0, 40000),\n+(9400549, 2290020, 1, 1, 0, 40000),\n+(9400549, 2290045, 1, 1, 0, 40000),\n+(9400549, 2290057, 1, 1, 0, 40000),\n+(9400549, 2290086, 1, 1, 0, 40000),\n+(9400575, 2290009, 1, 1, 0, 40000),\n+(9400575, 2290051, 1, 1, 0, 40000),\n+(9400575, 2290081, 1, 1, 0, 40000),\n+(9400575, 2290087, 1, 1, 0, 40000),\n+(9400575, 2290107, 1, 1, 0, 40000),\n+(9400575, 2290123, 1, 1, 0, 40000),\n+(9400580, 2290004, 1, 1, 0, 2000),\n+(9400580, 2290024, 1, 1, 0, 2000),\n+(9400580, 2290083, 1, 1, 0, 2000),\n+(9400580, 2290087, 1, 1, 0, 2000),\n+(9400580, 2290103, 1, 1, 0, 2000),\n+(9400580, 2290121, 1, 1, 0, 2000),\n+(9400582, 2290005, 1, 1, 0, 2000),\n+(9400582, 2290010, 1, 1, 0, 2000),\n+(9400582, 2290029, 1, 1, 0, 2000),\n+(9400582, 2290047, 1, 1, 0, 2000),\n+(9400582, 2290049, 1, 1, 0, 2000),\n+(9400582, 2290074, 1, 1, 0, 2000),\n+(9400582, 2290079, 1, 1, 0, 2000),\n+(9400582, 2290081, 1, 1, 0, 2000),\n+(9400582, 2290135, 1, 1, 0, 6000),\n+(9400590, 2290088, 1, 1, 0, 60000),\n+(9400590, 2290125, 1, 1, 0, 60000),\n+(9400590, 2290135, 1, 1, 0, 180000),\n+(9400591, 2290039, 1, 1, 0, 60000),\n+(9400591, 2290074, 1, 1, 0, 60000),\n+(9400591, 2290113, 1, 1, 0, 60000),\n+(9400592, 2290047, 1, 1, 0, 60000),\n+(9400592, 2290123, 1, 1, 0, 60000),\n+(9400592, 2290131, 1, 1, 0, 180000),\n+(9400593, 2290069, 1, 1, 0, 60000),\n+(9400593, 2290093, 1, 1, 0, 60000),\n+(9400593, 2290138, 1, 1, 0, 180000),\n+(9420513, 2290039, 1, 1, 0, 40000),\n+(9420513, 2290100, 1, 1, 0, 40000),\n+(9420513, 2290108, 1, 1, 0, 40000),\n+(9420513, 2290118, 1, 1, 0, 40000),\n+(9420513, 2290138, 1, 1, 0, 120000),\n+(9420514, 2290099, 1, 1, 0, 1287),\n+(9420517, 2290000, 1, 1, 0, 1287),\n+(9420517, 2290008, 1, 1, 0, 1287),\n+(9420517, 2290018, 1, 1, 0, 1287),\n+(9420517, 2290038, 1, 1, 0, 1287),\n+(9420517, 2290060, 1, 1, 0, 1287),\n+(9420517, 2290080, 1, 1, 0, 1287),\n+(9420517, 2290103, 1, 1, 0, 1287),\n+(9420518, 2290123, 1, 1, 0, 1287),\n+(9420519, 2290113, 1, 1, 0, 1287),\n+(9420522, 2290000, 1, 1, 0, 1287),\n+(9420522, 2290001, 1, 1, 0, 1287),\n+(9420522, 2290011, 1, 1, 0, 1287),\n+(9420522, 2290025, 1, 1, 0, 1287),\n+(9420522, 2290028, 1, 1, 0, 1287),\n+(9420522, 2290037, 1, 1, 0, 1287),\n+(9420522, 2290043, 1, 1, 0, 1287),\n+(9420522, 2290066, 1, 1, 0, 1287),\n+(9420522, 2290082, 1, 1, 0, 1287),\n+(9420522, 2290083, 1, 1, 0, 1287),\n+(9420522, 2290089, 1, 1, 0, 1287),\n+(9420522, 2290091, 1, 1, 0, 1287),\n+(9420522, 2290107, 1, 1, 0, 1287),\n+(9420540, 2280006, 1, 1, 0, 2000),\n+(9420540, 2290119, 1, 1, 0, 2000),\n+(9420540, 2290120, 1, 1, 0, 2000),\n+(9420544, 2280007, 1, 1, 0, 80000),\n+(9420544, 2280008, 1, 1, 0, 80000),\n+(9420544, 2280009, 1, 1, 0, 80000),\n+(9420544, 2280010, 1, 1, 0, 80000),\n+(9420544, 2290002, 1, 1, 0, 80000),\n+(9420544, 2290015, 1, 1, 0, 80000),\n+(9420544, 2290022, 1, 1, 0, 80000),\n+(9420544, 2290027, 1, 1, 0, 80000),\n+(9420544, 2290034, 1, 1, 0, 80000),\n+(9420544, 2290052, 1, 1, 0, 80000),\n+(9420544, 2290054, 1, 1, 0, 80000),\n+(9420544, 2290089, 1, 1, 0, 80000),\n+(9420544, 2290094, 1, 1, 0, 80000),\n+(9420544, 2290098, 1, 1, 0, 80000),\n+(9420544, 2290105, 1, 1, 0, 80000),\n+(9420544, 2290110, 1, 1, 0, 80000),\n+(9420544, 2290119, 1, 1, 0, 80000),\n+(9420549, 2280007, 1, 1, 0, 80000),\n+(9420549, 2280008, 1, 1, 0, 80000),\n+(9420549, 2280009, 1, 1, 0, 80000),\n+(9420549, 2280010, 1, 1, 0, 80000),\n+(9420549, 2290002, 1, 1, 0, 80000),\n+(9420549, 2290015, 1, 1, 0, 80000),\n+(9420549, 2290022, 1, 1, 0, 80000),\n+(9420549, 2290027, 1, 1, 0, 80000),\n+(9420549, 2290034, 1, 1, 0, 80000),\n+(9420549, 2290052, 1, 1, 0, 80000),\n+(9420549, 2290054, 1, 1, 0, 80000),\n+(9420549, 2290089, 1, 1, 0, 80000),\n+(9420549, 2290094, 1, 1, 0, 80000),\n+(9420549, 2290098, 1, 1, 0, 80000),\n+(9420549, 2290105, 1, 1, 0, 80000),\n+(9420549, 2290110, 1, 1, 0, 80000),\n+(9420549, 2290119, 1, 1, 0, 80000),\n+(9500166, 2290044, 1, 1, 0, 2000),\n+(9500173, 2290018, 1, 1, 0, 40000),\n+(9500173, 2290019, 1, 1, 0, 40000),\n+(9500173, 2290032, 1, 1, 0, 40000),\n+(9500173, 2290042, 1, 1, 0, 40000),\n+(9500173, 2290058, 1, 1, 0, 40000),\n+(9500173, 2290068, 1, 1, 0, 40000),\n+(9500173, 2290072, 1, 1, 0, 40000),\n+(9500173, 2290092, 1, 1, 0, 40000),\n+(9500173, 2290099, 1, 1, 0, 40000),\n+(9500173, 2290102, 1, 1, 0, 40000),\n+(9500173, 2290119, 1, 1, 0, 40000),\n+(9500173, 2290128, 1, 1, 0, 120000),\n+(9500174, 2290002, 1, 1, 0, 40000),\n+(9500174, 2290014, 1, 1, 0, 40000),\n+(9500174, 2290030, 1, 1, 0, 40000),\n+(9500174, 2290080, 1, 1, 0, 40000),\n+(9500174, 2290130, 1, 1, 0, 120000),\n+(9500180, 2290010, 1, 1, 0, 40000),\n+(9500180, 2290028, 1, 1, 0, 40000),\n+(9500180, 2290126, 1, 1, 0, 120000),\n+(9500181, 2290010, 1, 1, 0, 40000),\n+(9500181, 2290028, 1, 1, 0, 40000),\n+(9500181, 2290126, 1, 1, 0, 120000),\n+(9500331, 2290010, 1, 1, 0, 40000),\n+(9500331, 2290028, 1, 1, 0, 40000),\n+(9500331, 2290126, 1, 1, 0, 120000),\n+(9500332, 2290132, 1, 1, 0, 120000),\n+(9500333, 2290006, 1, 1, 0, 40000),\n+(9500333, 2290030, 1, 1, 0, 40000),\n+(9500333, 2290032, 1, 1, 0, 40000),\n+(9500333, 2290060, 1, 1, 0, 40000),\n+(9500333, 2290076, 1, 1, 0, 40000),\n+(9500333, 2290104, 1, 1, 0, 40000),\n+(9500333, 2290117, 1, 1, 0, 40000);\n\\ No newline at end of file"}, {"sha": "a70a7e2bfe631edc9063627da084b90c672b6e80", "filename": "src/client/MapleBuffStat.java", "status": "modified", "additions": 19, "deletions": 18, "changes": 37, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleBuffStat.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleBuffStat.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleBuffStat.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -30,37 +30,35 @@\n     SHARP_EYES(0x20L),\n     MANA_REFLECTION(0x40L),\n     //ALWAYS_RIGHT(0X80L),\n-    \n-    //------ bgn EDITED SLOT (was unused before) --------\n-    MAP_PROTECTION(0x100000000000000L),\n-    //------ end EDITED SLOT ----------------------------\n-    \n     SHADOW_CLAW(0x100L),\n     INFINITY(0x200L),\n     HOLY_SHIELD(0x400L),\n     HAMSTRING(0x800L),\n     BLIND(0x1000L),\n     CONCENTRATE(0x2000L),\n-    HPREC(0x4000L),\n+    PUPPET(0x4000L),\n     ECHO_OF_HERO(0x8000L),\n-    MPREC(0x10000L),\n+    MESO_UP_BY_ITEM(0x10000L),\n     GHOST_MORPH(0x20000L),\n     AURA(0x40000L),\n     CONFUSE(0x80000L),\n-    ARIANT_PQ_SHIELD(0x40000L),\n     \n     // ------ COUPON feature ------\n-    \n     COUPON_EXP1(0x100000L),\n     COUPON_EXP2(0x200000L),\n-    COUPON_EXP3(0x400000L),\n-    COUPON_EXP4(0x800000L),\n-    COUPON_DRP1(0x1000000L),\n-    COUPON_DRP2(0x2000000L),\n-    COUPON_DRP3(0x4000000L),\n+    COUPON_EXP3(0x400000L), COUPON_EXP4(0x400000L),\n+    COUPON_DRP1(0x800000L),\n+    COUPON_DRP2(0x1000000L), COUPON_DRP3(0x1000000L),\n     \n-    // ---- end COUPON feature ----\n+    // ------ monster card buffs, thanks to Arnah (Vertisy) ------\n+    ITEM_UP_BY_ITEM(0x100000L),\n+    RESPECT_PIMMUNE(0x200000L),\n+    RESPECT_MIMMUNE(0x400000L),\n+    DEFENSE_ATT(0x800000L),\n+    DEFENSE_STATE(0x1000000L),\n     \n+    HPREC(0x2000000L),\n+    MPREC(0x4000000L),\n     BERSERK_FURY(0x8000000L),\n     DIVINE_BODY(0x10000000L),\n     SPARK(0x20000000L),\n@@ -73,7 +71,6 @@\n     ACC(0x1000000000L),\n     AVOID(0x2000000000L),\n     HANDS(0x4000000000L),\n-    SHOWDASH(0x4000000000L),\n     SPEED(0x8000000000L),\n     JUMP(0x10000000000L),\n     MAGIC_GUARD(0x20000000000L),\n@@ -96,11 +93,10 @@\n     MESOUP(0x200000000000000L),\n     SHADOWPARTNER(0x400000000000000L),\n     PICKPOCKET(0x800000000000000L),\n-    PUPPET(0x800000000000000L),\n     MESOGUARD(0x1000000000000000L),\n     EXP_INCREASE(0x2000000000000000L),\n     WEAKEN(0x4000000000000000L),\n-    //THAT GAP\n+    MAP_PROTECTION(0x8000000000000000L),\n     \n     //all incorrect buffstats\n     SLOW(0x200000000L, true), \n@@ -144,4 +140,9 @@ public long getValue() {\n     public boolean isFirst() {\n         return isFirst;\n     }\n+    \n+    @Override\n+    public String toString() {\n+        return name();\n+    }\n }"}, {"sha": "8e134781f543be5e5fa5f6f1367a6806ca56626d", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 293, "deletions": 112, "changes": 405, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -44,6 +44,7 @@\n import java.util.Map;\n import java.util.Map.Entry;\n import java.util.Set;\n+import java.util.Stack;\n import java.util.Comparator;\n import java.util.concurrent.locks.Lock;\n import java.util.concurrent.ScheduledFuture;\n@@ -205,7 +206,7 @@\n     private transient int localstr, localdex, localluk, localint_, localmagic, localwatk;\n     private transient int equipmaxhp, equipmaxmp, equipstr, equipdex, equipluk, equipint_, equipmagic, equipwatk, localchairhp, localchairmp;\n     private int localchairrate;\n-    private boolean hidden, equipchanged = true, canDoor = true, berserk, hasMerchant, hasSandboxItem = false, whiteChat = false;\n+    private boolean hidden, equipchanged = true, canDoor = true, berserk, hasMerchant, hasSandboxItem = false, whiteChat = false, canRecvPartySearchInvite = true;\n     private boolean equippedMesoMagnet = false, equippedItemPouch = false, equippedPetItemIgnore = false;\n     private int linkedLevel = 0;\n     private String linkedName = null;\n@@ -286,6 +287,7 @@\n     private Lock cpnLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.CHARACTER_CPN);\n     private Map<Integer, Set<Integer>> excluded = new LinkedHashMap<>();\n     private Set<Integer> excludedItems = new LinkedHashSet<>();\n+    private Set<Integer> disabledPartySearchInvites = new LinkedHashSet<>();\n     private static String[] ariantroomleader = new String[3];\n     private static int[] ariantroomslot = new int[3];\n     private long portaldelay = 0, lastcombo = 0;\n@@ -484,6 +486,10 @@ public boolean isAwayFromWorld() {\n     public void setEnteredChannelWorld() {\n         awayFromWorld.set(false);\n         client.getChannelServer().removePlayerAway(id);\n+        \n+        if (canRecvPartySearchInvite) {\n+            this.getWorldServer().getPartySearchCoordinator().attachPlayer(this);\n+        }\n     }\n     \n     public void setAwayFromChannelWorld() {\n@@ -504,6 +510,46 @@ private void setAwayFromChannelWorld(boolean disconnect) {\n         }\n     }\n     \n+    public void updatePartySearchAvailability(boolean psearchAvailable) {\n+        if (psearchAvailable) {\n+            if (canRecvPartySearchInvite && getParty() == null) {\n+                this.getWorldServer().getPartySearchCoordinator().attachPlayer(this);\n+            }\n+        } else {\n+            if (canRecvPartySearchInvite) {\n+                this.getWorldServer().getPartySearchCoordinator().detachPlayer(this);\n+            }\n+        }\n+    }\n+    \n+    public boolean toggleRecvPartySearchInvite() {\n+        canRecvPartySearchInvite = !canRecvPartySearchInvite;\n+        \n+        if (canRecvPartySearchInvite) {\n+            updatePartySearchAvailability(getParty() == null);\n+        } else {\n+            this.getWorldServer().getPartySearchCoordinator().detachPlayer(this);\n+        }\n+        \n+        return canRecvPartySearchInvite;\n+    }\n+    \n+    public boolean isRecvPartySearchInviteEnabled() {\n+        return canRecvPartySearchInvite;\n+    }\n+    \n+    public void resetPartySearchInvite(int fromLeaderid) {\n+        disabledPartySearchInvites.remove(fromLeaderid);\n+    }\n+    \n+    public void disablePartySearchInvite(int fromLeaderid) {\n+        disabledPartySearchInvites.add(fromLeaderid);\n+    }\n+    \n+    public boolean hasDisabledPartySearchInvite(int fromLeaderid) {\n+        return disabledPartySearchInvites.contains(fromLeaderid);\n+    }\n+    \n     public void setSessionTransitionState() {\n         client.getSession().setAttribute(MapleClient.CLIENT_TRANSITION);\n     }\n@@ -1047,7 +1093,13 @@ public synchronized void changeJob(MapleJob newJob) {\n             return;//the fuck you doing idiot!\n         }\n         \n-        this.job = newJob;\n+        if (canRecvPartySearchInvite && getParty() == null) {\n+            this.updatePartySearchAvailability(false);\n+            this.job = newJob;\n+            this.updatePartySearchAvailability(true);\n+        } else {\n+            this.job = newJob;\n+        }\n         \n         int spGain = 1;\n         if (GameConstants.hasSPTable(newJob)) {\n@@ -3448,6 +3500,10 @@ private MapleBuffStatValueHolder fetchBestEffectFromItemEffectHolder(MapleBuffSt\n         for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl: buffEffects.entrySet()) {\n             MapleBuffStatValueHolder mbsvhi = bpl.getValue().get(mbs);\n             if(mbsvhi != null) {\n+                if(!mbsvhi.effect.isActive(mapid)) {\n+                    continue;\n+                }\n+                \n                 if(mbsvhi.value > max.left) {\n                     max = new Pair<>(mbsvhi.value, mbsvhi.effect.getStatups().size());\n                     mbsvh = mbsvhi;\n@@ -3477,6 +3533,11 @@ public void debugListAllBuffs() {\n         effLock.lock();\n         chrLock.lock();\n         try {\n+            System.out.println(\"-------------------\");\n+            System.out.println(\"CACHED BUFF COUNT: \");\n+            for(Entry<MapleBuffStat, Byte> bpl : buffEffectsCount.entrySet()) {\n+                System.out.println(bpl.getKey() + \": \" + bpl.getValue());\n+            }\n             System.out.println(\"-------------------\");\n             System.out.println(\"CACHED BUFFS: \");\n             for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl : buffEffects.entrySet()) {\n@@ -3664,46 +3725,33 @@ public boolean cancelEffect(MapleStatEffect effect, boolean overwrite, long star\n         }\n     }\n     \n+    public void updateActiveEffects() {\n+        chrLock.lock();\n+        try {\n+            effects.clear();\n+            updateEffects(buffEffectsCount.keySet());\n+        } finally {\n+            chrLock.unlock();\n+        }\n+    }\n+    \n     private void updateEffects(Set<MapleBuffStat> removedStats) {\n         chrLock.lock();\n         try {\n-            Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects = new LinkedHashMap<>();\n-            Map<MapleBuffStat, Pair<Integer, Integer>> maxStatups = new LinkedHashMap<>();\n-            \n-            for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bel : buffEffects.entrySet()) {\n-                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> belv : bel.getValue().entrySet()) {\n-                    if(removedStats.contains(belv.getKey())) {\n-                        if(!retrievedEffects.containsKey(bel.getKey())) {\n-                            retrievedEffects.put(bel.getKey(), new Pair<>(belv.getValue().effect, belv.getValue().startTime));\n-                        }\n-                        \n-                        Pair<Integer, Integer> thisStat = maxStatups.get(belv.getKey());\n-                        if(thisStat == null || belv.getValue().value > thisStat.getRight()) {\n-                            maxStatups.put(belv.getKey(), new Pair<>(bel.getKey(), belv.getValue().value));\n-                        }\n-                    }\n-                }\n-            }\n-            \n-            Map<Integer, Pair<MapleStatEffect, Long>> bestEffects = new LinkedHashMap<>();\n             Set<MapleBuffStat> retrievedStats = new LinkedHashSet<>();\n-            for(Entry<MapleBuffStat, Pair<Integer, Integer>> lmsee: maxStatups.entrySet()) {\n-                if(isSingletonStatup(lmsee.getKey())) {\n-                    continue;\n-                }\n+            \n+            for (MapleBuffStat mbs : removedStats) {\n+                fetchBestEffectFromItemEffectHolder(mbs);\n                 \n-                Integer srcid = lmsee.getValue().getLeft();\n-                if(!bestEffects.containsKey(srcid)) {\n-                    Pair<MapleStatEffect, Long> msel = retrievedEffects.get(srcid);\n-                    \n-                    bestEffects.put(srcid, msel);\n-                    for(Pair<MapleBuffStat, Integer> mbsi : msel.getLeft().getStatups()) {\n-                        retrievedStats.add(mbsi.getLeft());\n+                MapleBuffStatValueHolder mbsvh = effects.get(mbs);\n+                if (mbsvh != null) {\n+                    for (Pair<MapleBuffStat, Integer> statup : mbsvh.effect.getStatups()) {\n+                        retrievedStats.add(statup.getLeft());\n                     }\n                 }\n             }\n             \n-            propagateBuffEffectUpdates(bestEffects, retrievedStats);\n+            propagateBuffEffectUpdates(new LinkedHashMap<Integer, Pair<MapleStatEffect, Long>>(), retrievedStats, removedStats);\n         } finally {\n             chrLock.unlock();\n         }\n@@ -3771,21 +3819,7 @@ private boolean cancelEffect(MapleStatEffect effect, boolean overwrite, long sta\n         }\n         \n         if (!overwrite) {\n-            List<MapleBuffStat> cancelStats = new LinkedList<>();\n-            \n-            chrLock.lock();\n-            try {\n-                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> mbsl : buffstats.entrySet()) {\n-                    cancelStats.add(mbsl.getKey());\n-                }\n-            } finally {\n-                chrLock.unlock();\n-            }\n-            \n-            for(MapleBuffStat mbs : cancelStats) {\n-                removedStats.add(mbs);\n-            }\n-            cancelPlayerBuffs(cancelStats);\n+            removedStats.addAll(buffstats.keySet());\n         }\n         \n         return toCancel;\n@@ -3909,7 +3943,152 @@ public void cancelBuffStats(MapleBuffStat stat) {\n         return extractedStatBuffs;\n     }\n     \n-    private void propagateBuffEffectUpdates(Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects, Set<MapleBuffStat> retrievedStats) {\n+    private void cancelInactiveBuffStats(Set<MapleBuffStat> retrievedStats, Set<MapleBuffStat> removedStats) {\n+        List<MapleBuffStat> inactiveStats = new LinkedList<>();\n+        for (MapleBuffStat mbs : removedStats) {\n+            if (!retrievedStats.contains(mbs)) {\n+                inactiveStats.add(mbs);\n+            }\n+        }\n+        \n+        if (!inactiveStats.isEmpty()) {\n+            client.announce(MaplePacketCreator.cancelBuff(inactiveStats));\n+            getMap().broadcastMessage(this, MaplePacketCreator.cancelForeignBuff(getId(), inactiveStats), false);\n+        }\n+    }\n+    \n+    private static Map<MapleStatEffect, Integer> topologicalSortLeafStatCount(Map<MapleBuffStat, Stack<MapleStatEffect>> buffStack) {\n+        Map<MapleStatEffect, Integer> leafBuffCount = new LinkedHashMap<>();\n+        \n+        for (Entry<MapleBuffStat, Stack<MapleStatEffect>> e : buffStack.entrySet()) {\n+            Stack<MapleStatEffect> mseStack = e.getValue();\n+            if (mseStack.isEmpty()) {\n+                continue;\n+            }\n+            \n+            MapleStatEffect mse = mseStack.peek();\n+            Integer count = leafBuffCount.get(mse);\n+            if (count == null) {\n+                leafBuffCount.put(mse, 1);\n+            } else {\n+                leafBuffCount.put(mse, count + 1);\n+            }\n+        }\n+        \n+        return leafBuffCount;\n+    }\n+    \n+    private static List<MapleStatEffect> topologicalSortRemoveLeafStats(Map<MapleStatEffect, Set<MapleBuffStat>> stackedBuffStats, Map<MapleBuffStat, Stack<MapleStatEffect>> buffStack, Map<MapleStatEffect, Integer> leafStatCount) {\n+        List<MapleStatEffect> clearedStatEffects = new LinkedList<>();\n+        Set<MapleBuffStat> clearedStats = new LinkedHashSet<>();\n+        \n+        for (Entry<MapleStatEffect, Integer> e : leafStatCount.entrySet()) {\n+            MapleStatEffect mse = e.getKey();\n+            \n+            if (stackedBuffStats.get(mse).size() <= e.getValue()) {\n+                clearedStatEffects.add(mse);\n+                \n+                for (MapleBuffStat mbs : stackedBuffStats.get(mse)) {\n+                    clearedStats.add(mbs);\n+                }\n+            }\n+        }\n+        \n+        for (MapleBuffStat mbs : clearedStats) {\n+            MapleStatEffect mse = buffStack.get(mbs).pop();\n+            stackedBuffStats.get(mse).remove(mbs);\n+        }\n+        \n+        return clearedStatEffects;\n+    }\n+    \n+    private static void topologicalSortRebaseLeafStats(Map<MapleStatEffect, Set<MapleBuffStat>> stackedBuffStats, Map<MapleBuffStat, Stack<MapleStatEffect>> buffStack) {\n+        for (Entry<MapleBuffStat, Stack<MapleStatEffect>> e : buffStack.entrySet()) {\n+            Stack<MapleStatEffect> mseStack = e.getValue();\n+            \n+            if (!mseStack.isEmpty()) {\n+                MapleStatEffect mse = mseStack.pop();\n+                stackedBuffStats.get(mse).remove(e.getKey());\n+            }\n+        }\n+    }\n+    \n+    private static List<MapleStatEffect> topologicalSortEffects(Map<MapleBuffStat, List<Pair<MapleStatEffect, Integer>>> buffEffects) {\n+        Map<MapleStatEffect, Set<MapleBuffStat>> stackedBuffStats = new LinkedHashMap<>();\n+        Map<MapleBuffStat, Stack<MapleStatEffect>> buffStack = new LinkedHashMap<>();\n+        \n+        for (Entry<MapleBuffStat, List<Pair<MapleStatEffect, Integer>>> e : buffEffects.entrySet()) {\n+            MapleBuffStat mbs = e.getKey();\n+            \n+            Stack<MapleStatEffect> mbsStack = new Stack<>();\n+            buffStack.put(mbs, mbsStack);\n+            \n+            for (Pair<MapleStatEffect, Integer> emse : e.getValue()) {\n+                MapleStatEffect mse = emse.getLeft();\n+                mbsStack.push(mse);\n+                \n+                Set<MapleBuffStat> mbsStats = stackedBuffStats.get(mse);\n+                if (mbsStats == null) {\n+                    mbsStats = new LinkedHashSet<>();\n+                    stackedBuffStats.put(mse, mbsStats);\n+                }\n+                \n+                mbsStats.add(mbs);\n+            }\n+        }\n+        \n+        List<MapleStatEffect> buffList = new LinkedList<>();\n+        while (true) {\n+            Map<MapleStatEffect, Integer> leafStatCount = topologicalSortLeafStatCount(buffStack);\n+            if (leafStatCount.isEmpty()) break;\n+            \n+            List<MapleStatEffect> clearedNodes = topologicalSortRemoveLeafStats(stackedBuffStats, buffStack, leafStatCount);\n+            if (clearedNodes.isEmpty()) {\n+                topologicalSortRebaseLeafStats(stackedBuffStats, buffStack);\n+            } else {\n+                buffList.addAll(clearedNodes);\n+            }\n+        }\n+        \n+        return buffList;\n+    }\n+    \n+    private static List<MapleStatEffect> sortEffectsList(Map<MapleStatEffect, Integer> updateEffectsList) {\n+        Map<MapleBuffStat, List<Pair<MapleStatEffect, Integer>>> buffEffects = new LinkedHashMap<>();\n+        \n+        for (Entry<MapleStatEffect, Integer> p : updateEffectsList.entrySet()) {\n+            MapleStatEffect mse = p.getKey();\n+            \n+            for (Pair<MapleBuffStat, Integer> statup : mse.getStatups()) {\n+                MapleBuffStat stat = statup.getLeft();\n+                \n+                List<Pair<MapleStatEffect, Integer>> statBuffs = buffEffects.get(stat);\n+                if (statBuffs == null) {\n+                    statBuffs = new ArrayList<>();\n+                    buffEffects.put(stat, statBuffs);\n+                }\n+                \n+                statBuffs.add(new Pair<>(mse, statup.getRight()));\n+            }\n+        }\n+        \n+        Comparator cmp = new Comparator<Pair<MapleStatEffect, Integer>>() {\n+            @Override\n+            public int compare(Pair<MapleStatEffect, Integer> o1, Pair<MapleStatEffect, Integer> o2)\n+            {\n+                return o2.getRight().compareTo(o1.getRight());\n+            }\n+        };\n+        \n+        for (Entry<MapleBuffStat, List<Pair<MapleStatEffect, Integer>>> statBuffs : buffEffects.entrySet()) {\n+            Collections.sort(statBuffs.getValue(), cmp);\n+        }\n+        \n+        return topologicalSortEffects(buffEffects);\n+    }\n+    \n+    private void propagateBuffEffectUpdates(Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects, Set<MapleBuffStat> retrievedStats, Set<MapleBuffStat> removedStats) {\n+        cancelInactiveBuffStats(retrievedStats, removedStats);\n         if (retrievedStats.isEmpty()) {\n             return;\n         }\n@@ -3924,7 +4103,7 @@ private void propagateBuffEffectUpdates(Map<Integer, Pair<MapleStatEffect, Long>\n             maxBuffValue.put(mbs, new Pair<>(Integer.MIN_VALUE, (MapleStatEffect) null));\n         }\n         \n-        Map<MapleStatEffect, Pair<Integer, Integer>> updateEffects = new LinkedHashMap<>();\n+        Map<MapleStatEffect, Integer> updateEffects = new LinkedHashMap<>();\n         \n         List<MapleStatEffect> recalcMseList = new LinkedList<>();\n         for(Entry<Integer, Pair<MapleStatEffect, Long>> re : retrievedEffects.entrySet()) {\n@@ -3937,7 +4116,6 @@ private void propagateBuffEffectUpdates(Map<Integer, Pair<MapleStatEffect, Long>\n             recalcMseList = new LinkedList<>();\n             \n             for(MapleStatEffect mse : mseList) {\n-                int mseAmount = 0;\n                 int maxEffectiveStatup = Integer.MIN_VALUE;\n                 for(Pair<MapleBuffStat, Integer> st : mse.getStatups()) {\n                     MapleBuffStat mbs = st.getLeft();\n@@ -3972,36 +4150,16 @@ private void propagateBuffEffectUpdates(Map<Integer, Pair<MapleStatEffect, Long>\n                             }\n                         }\n                     }\n-                    \n-                    if(relevantStatup) {\n-                        mseAmount += st.getRight();\n-                    }\n                 }\n                 \n-                updateEffects.put(mse, new Pair<>(maxEffectiveStatup, mseAmount));\n+                updateEffects.put(mse, maxEffectiveStatup);\n             }\n         } while(!recalcMseList.isEmpty());\n         \n-        List<Pair<MapleStatEffect, Pair<Integer, Integer>>> updateEffectsList = new ArrayList<>();\n-        for(Entry<MapleStatEffect, Pair<Integer, Integer>> ue : updateEffects.entrySet()) {\n-            updateEffectsList.add(new Pair<>(ue.getKey(), ue.getValue()));\n-        }\n-        \n-        Collections.sort(updateEffectsList, new Comparator<Pair<MapleStatEffect, Pair<Integer, Integer>>>() {\n-            @Override\n-            public int compare(Pair<MapleStatEffect, Pair<Integer, Integer>> o1, Pair<MapleStatEffect, Pair<Integer, Integer>> o2)\n-            {\n-                if(o1.getRight().getLeft().equals(o2.getRight().getLeft())) {\n-                    return o1.getRight().getRight().compareTo(o2.getRight().getRight());\n-                } else {\n-                    return o1.getRight().getLeft().compareTo(o2.getRight().getLeft());\n-                }\n-            }\n-        });\n+        List<MapleStatEffect> updateEffectsList = sortEffectsList(updateEffects);\n         \n         List<Pair<Integer, Pair<MapleStatEffect, Long>>> toUpdateEffects = new LinkedList<>();\n-        for(Pair<MapleStatEffect, Pair<Integer, Integer>> msep : updateEffectsList) {\n-            MapleStatEffect mse = msep.getLeft();\n+        for(MapleStatEffect mse : updateEffectsList) {\n             toUpdateEffects.add(new Pair<>(mse.getBuffSourceId(), retrievedEffects.get(mse.getBuffSourceId())));\n         }\n         \n@@ -4010,9 +4168,7 @@ public int compare(Pair<MapleStatEffect, Pair<Integer, Integer>> o1, Pair<MapleS\n             Pair<MapleStatEffect, Long> msel = lmse.getRight();\n             \n             for(Pair<MapleBuffStat, Integer> statup : getActiveStatupsFromSourceid(lmse.getLeft())) {\n-                if(!isSingletonStatup(statup.getLeft())) {\n-                    activeStatups.add(statup);\n-                }\n+                activeStatups.add(statup);\n             }\n             \n             msel.getLeft().updateBuffEffect(this, activeStatups, msel.getRight());\n@@ -4061,6 +4217,17 @@ private static boolean isSingletonStatup(MapleBuffStat mbs) {\n         }\n     }\n     \n+    private void addItemEffectHolderCount(MapleBuffStat stat) {\n+        Byte val = buffEffectsCount.get(stat);\n+        if (val != null) {\n+            val = (byte) (val + 1);\n+        } else {\n+            val = (byte) 1;\n+        }\n+\n+        buffEffectsCount.put(stat, val);\n+    }\n+    \n     public void registerEffect(MapleStatEffect effect, long starttime, long expirationtime, boolean isSilent) {\n         if (effect.isDragonBlood()) {\n             prepareDragonBlood(effect);\n@@ -4180,6 +4347,7 @@ public void run() {\n                 appliedStatups.put(ps.getLeft(), new MapleBuffStatValueHolder(effect, starttime, ps.getRight()));\n             }\n             \n+            boolean active = effect.isActive(mapid);\n             if(ServerConstants.USE_BUFF_MOST_SIGNIFICANT) {\n                 toDeploy = new LinkedHashMap<>();\n                 Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects = new LinkedHashMap<>();\n@@ -4189,25 +4357,19 @@ public void run() {\n                     MapleBuffStatValueHolder mbsvh = effects.get(statup.getKey());\n                     MapleBuffStatValueHolder statMbsvh = statup.getValue();\n                     \n-                    if(mbsvh == null || mbsvh.value < statMbsvh.value || (mbsvh.value == statMbsvh.value && mbsvh.effect.getStatups().size() <= statMbsvh.effect.getStatups().size())) {\n-                        toDeploy.put(statup.getKey(), statMbsvh);\n-                    } else {\n-                        if(!isSingletonStatup(statup.getKey())) {\n-                            retrievedEffects.put(mbsvh.effect.getBuffSourceId(), new Pair<>(mbsvh.effect, mbsvh.startTime));\n-                            for(Pair<MapleBuffStat, Integer> mbs : mbsvh.effect.getStatups()) {\n-                                retrievedStats.add(mbs.getLeft());\n+                    if(active) {\n+                        if(mbsvh == null || mbsvh.value < statMbsvh.value || (mbsvh.value == statMbsvh.value && mbsvh.effect.getStatups().size() <= statMbsvh.effect.getStatups().size())) {\n+                            toDeploy.put(statup.getKey(), statMbsvh);\n+                        } else {\n+                            if(!isSingletonStatup(statup.getKey())) {\n+                                for(Pair<MapleBuffStat, Integer> mbs : mbsvh.effect.getStatups()) {\n+                                    retrievedStats.add(mbs.getLeft());\n+                                }\n                             }\n                         }\n                     }\n                     \n-                    Byte val = buffEffectsCount.get(statup.getKey());\n-                    if (val != null) {\n-                        val = (byte) (val + 1);\n-                    } else {\n-                        val = (byte) 1;\n-                    }\n-                    \n-                    buffEffectsCount.put(statup.getKey(), val);\n+                    addItemEffectHolderCount(statup.getKey());\n                 }\n                 \n                 if(!isSilent) {\n@@ -4216,22 +4378,18 @@ public void run() {\n                         effects.put(statup.getKey(), statup.getValue());\n                     }\n                     \n-                    retrievedEffects.put(sourceid, new Pair<>(effect, starttime));\n-                    propagateBuffEffectUpdates(retrievedEffects, retrievedStats);\n+                    if (active) {\n+                        retrievedEffects.put(sourceid, new Pair<>(effect, starttime));\n+                    }\n+                    \n+                    propagateBuffEffectUpdates(retrievedEffects, retrievedStats, new LinkedHashSet<MapleBuffStat>());\n                 }\n             } else {\n                 for (Entry<MapleBuffStat, MapleBuffStatValueHolder> statup : appliedStatups.entrySet()) {\n-                    Byte val = buffEffectsCount.get(statup.getKey());\n-                    if (val != null) {\n-                        val = (byte) (val + 1);\n-                    } else {\n-                        val = (byte) 1;\n-                    }\n-                    \n-                    buffEffectsCount.put(statup.getKey(), val);\n+                    addItemEffectHolderCount(statup.getKey());\n                 }\n                 \n-                toDeploy = appliedStatups;\n+                toDeploy = (active ? appliedStatups : new LinkedHashMap<MapleBuffStat, MapleBuffStatValueHolder>());\n             }\n             \n             addItemEffectHolder(sourceid, expirationtime, appliedStatups);\n@@ -4607,6 +4765,24 @@ public int getQuestMesoRate() {\n         return w.getMesoRate() * w.getQuestRate();\n     }\n     \n+    public float getCardRate(int itemid) {\n+        float rate = 100.0f;\n+        \n+        if (itemid == 0) {\n+            MapleStatEffect mseMeso = getBuffEffect(MapleBuffStat.MESO_UP_BY_ITEM);\n+            if (mseMeso != null) {\n+                rate += mseMeso.getCardRate(mapid, itemid);\n+            }\n+        } else {\n+            MapleStatEffect mseItem = getBuffEffect(MapleBuffStat.ITEM_UP_BY_ITEM);\n+            if (mseItem != null) {\n+                rate += mseItem.getCardRate(mapid, itemid);\n+            }\n+        }\n+        \n+        return rate / 100;\n+    }\n+    \n     public int getFace() {\n         return face;\n     }\n@@ -5169,6 +5345,13 @@ public void setGMLevel(int level) {\n         this.gmLevel = Math.max(level, 0);\n     }\n     \n+    public void closePartySearchInteractions() {\n+        this.getWorldServer().getPartySearchCoordinator().unregisterPartyLeader(this);\n+        if (canRecvPartySearchInvite) {\n+            this.getWorldServer().getPartySearchCoordinator().detachPlayer(this);\n+        }\n+    }\n+    \n     public void closePlayerInteractions() {\n         closeNpcShop();\n         closeTrade();\n@@ -5570,8 +5753,8 @@ public int getVanquisherStage() {\n         return vanquisherStage;\n     }\n \n-    public Collection<MapleMapObject> getVisibleMapObjects() {\n-        return Collections.unmodifiableCollection(visibleMapObjects);\n+    public MapleMapObject[] getVisibleMapObjects() {\n+        return visibleMapObjects.toArray(new MapleMapObject[visibleMapObjects.size()]);\n     }\n \n     public int getWorld() {\n@@ -6717,6 +6900,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n             int buddyCapacity = rs.getInt(\"buddyCapacity\");\n             ret.buddylist = new BuddyList(buddyCapacity);\n             ret.lastExpGainTime = rs.getTimestamp(\"lastExpGainTime\").getTime();\n+            ret.canRecvPartySearchInvite = rs.getBoolean(\"partySearch\");\n             \n             ret.getInventory(MapleInventoryType.EQUIP).setSlotLimit(rs.getByte(\"equipslots\"));\n             ret.getInventory(MapleInventoryType.USE).setSlotLimit(rs.getByte(\"useslots\"));\n@@ -7979,12 +8163,8 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             con.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);\n             con.setAutoCommit(false);\n             PreparedStatement ps;\n-            ps = con.prepareStatement(\"UPDATE characters SET level = ?, fame = ?, str = ?, dex = ?, luk = ?, `int` = ?, exp = ?, gachaexp = ?, hp = ?, mp = ?, maxhp = ?, maxmp = ?, sp = ?, ap = ?, gm = ?, skincolor = ?, gender = ?, job = ?, hair = ?, face = ?, map = ?, meso = ?, hpMpUsed = ?, spawnpoint = ?, party = ?, buddyCapacity = ?, messengerid = ?, messengerposition = ?, mountlevel = ?, mountexp = ?, mounttiredness= ?, equipslots = ?, useslots = ?, setupslots = ?, etcslots = ?,  monsterbookcover = ?, vanquisherStage = ?, dojoPoints = ?, lastDojoStage = ?, finishedDojoTutorial = ?, vanquisherKills = ?, matchcardwins = ?, matchcardlosses = ?, matchcardties = ?, omokwins = ?, omoklosses = ?, omokties = ?, dataString = ?, fquest = ?, jailexpire = ?, partnerId = ?, marriageItemId = ?, lastExpGainTime = ?, ariantPoints = ? WHERE id = ?\", Statement.RETURN_GENERATED_KEYS);\n-            if (gmLevel < 1 && level > 199) {\n-                ps.setInt(1, isCygnus() ? 120 : 200);\n-            } else {\n-                ps.setInt(1, level);\n-            }\n+            ps = con.prepareStatement(\"UPDATE characters SET level = ?, fame = ?, str = ?, dex = ?, luk = ?, `int` = ?, exp = ?, gachaexp = ?, hp = ?, mp = ?, maxhp = ?, maxmp = ?, sp = ?, ap = ?, gm = ?, skincolor = ?, gender = ?, job = ?, hair = ?, face = ?, map = ?, meso = ?, hpMpUsed = ?, spawnpoint = ?, party = ?, buddyCapacity = ?, messengerid = ?, messengerposition = ?, mountlevel = ?, mountexp = ?, mounttiredness= ?, equipslots = ?, useslots = ?, setupslots = ?, etcslots = ?,  monsterbookcover = ?, vanquisherStage = ?, dojoPoints = ?, lastDojoStage = ?, finishedDojoTutorial = ?, vanquisherKills = ?, matchcardwins = ?, matchcardlosses = ?, matchcardties = ?, omokwins = ?, omoklosses = ?, omokties = ?, dataString = ?, fquest = ?, jailexpire = ?, partnerId = ?, marriageItemId = ?, lastExpGainTime = ?, ariantPoints = ?, partySearch = ? WHERE id = ?\", Statement.RETURN_GENERATED_KEYS);\n+            ps.setInt(1, level);    // thanks CanIGetaPR for noticing an unnecessary \"level\" limitation when persisting DB data\n             ps.setInt(2, fame);\n             \n             effLock.lock();\n@@ -8094,7 +8274,8 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             ps.setInt(52, marriageItemid);\n             ps.setTimestamp(53, new Timestamp(lastExpGainTime));\n             ps.setInt(54, ariantPoints);\n-            ps.setInt(55, id);\n+            ps.setBoolean(55, canRecvPartySearchInvite);\n+            ps.setInt(56, id);\n \n             int updateRows = ps.executeUpdate();\n             ps.close();"}, {"sha": "3145bc2a4583f496394ea55cb2057586ba59a960", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -888,6 +888,7 @@ private void removePlayer(World wserv, boolean serverTransition) {\n                         player.cancelAllBuffs(true);\n                         \n                         player.closePlayerInteractions();\n+                        player.closePartySearchInteractions();\n                         \n                         if (!serverTransition) {    // thanks MedicOP for detecting an issue with party leader change on changing channels\n                                 removePartyPlayer(wserv);\n@@ -1463,6 +1464,7 @@ public void changeChannel(int channel) {\n                 }\n                 \n \t\tplayer.closePlayerInteractions();\n+                player.closePartySearchInteractions();\n                 \n                 player.unregisterChairBuff();\n \t\tserver.getPlayerBuffStorage().addBuffsToStorage(player.getId(), player.getAllBuffs());"}, {"sha": "25511ef1394cddaeefb5db6235dd6f394f30520e", "filename": "src/client/MapleJob.java", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleJob.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/MapleJob.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleJob.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -114,11 +114,6 @@ public static MapleJob getBy5ByteEncoding(int encoded) {\n                 return BEGINNER;\n         }\n     }\n-\n-    public boolean isBeginner(MapleJob beginners) {\n-    \treturn MAGICIAN == beginners || WARRIOR == beginners || THIEF == beginners || PIRATE == beginners || BOWMAN == beginners || ARAN1 == beginners || THUNDERBREAKER1 == beginners\n-    \t\t\t|| DAWNWARRIOR1 == beginners || NIGHTWALKER1 == beginners || BLAZEWIZARD1 == beginners;\n-     }\n     \n     public boolean isA(MapleJob basejob) {  // thanks Steve (kaito1410) for pointing out an improvement here\n         int basebranch = basejob.getId() / 10;"}, {"sha": "304f19c62a3cfce7e5e03b9149b2f687c0cdaf59", "filename": "src/client/command/commands/gm2/IdCommand.java", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/command/commands/gm2/IdCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/command/commands/gm2/IdCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/IdCommand.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -9,6 +9,7 @@\n import java.io.FileReader;\n import java.io.IOException;\n import java.util.*;\n+import server.ThreadManager;\n \n public class IdCommand extends Command {\n     {\n@@ -34,36 +35,39 @@ public void execute(MapleClient client, final String[] params) {\n             return;\n         }\n         final String queryItem = joinStringArr(Arrays.copyOfRange(params, 1, params.length), \" \");\n-        player.yellowMessage(\"Querying for entry... May take some time... Please try to refine your search\");\n+        player.yellowMessage(\"Querying for entry... May take some time... Please try to refine your search.\");\n         Runnable queryRunnable = new Runnable() {\n             @Override\n             public void run() {\n                 try {\n                     populateIdMap(params[0].toLowerCase());\n \n                     Map<String, String> resultList = fetchResults(itemMap.get(params[0]), queryItem);\n-\n+                    StringBuilder sb = new StringBuilder();\n+                    \n                     if (resultList.size() > 0) {\n                         int count = 0;\n                         for (Map.Entry<String, String> entry: resultList.entrySet()) {\n-                            player.yellowMessage(String.format(\"Id for %s is: %s\", entry.getKey(), entry.getValue()));\n+                            sb.append(String.format(\"Id for %s is: #b%s#k\", entry.getKey(), entry.getValue()) + \"\\r\\n\");\n                             if (++count > 100) {\n                                 break;\n                             }\n                         }\n-                        player.yellowMessage(String.format(\"Results found: %d | Returned: %d/100 | Refine search query to improve time.\", resultList.size(), count - 1));\n+                        sb.append(String.format(\"Results found: #r%d#k | Returned: #b%d#k/100 | Refine search query to improve time.\", resultList.size(), count) + \"\\r\\n\");\n+                        \n+                        player.getClient().getAbstractPlayerInteraction().npcTalk(9010000, sb.toString());\n                     } else {\n-                        player.yellowMessage(String.format(\"Id not found for item: %s, of type: %s\", queryItem, params[0]));\n+                        player.yellowMessage(String.format(\"Id not found for item: %s, of type: %s.\", queryItem, params[0]));\n                     }\n                 } catch (IdTypeNotSupportedException e) {\n-                    player.yellowMessage(\"Your query type is not supported\");\n+                    player.yellowMessage(\"Your query type is not supported.\");\n                 } catch (IOException e) {\n-                    player.yellowMessage(\"Error reading file, please contact your administrator\");\n+                    player.yellowMessage(\"Error reading file, please contact your administrator.\");\n                 }\n             }\n         };\n-        Thread thread = new Thread(queryRunnable);\n-        thread.start();\n+        \n+        ThreadManager.getInstance().newTask(queryRunnable);\n     }\n \n     private void populateIdMap(String type) throws IdTypeNotSupportedException, IOException {"}, {"sha": "e2617b73f46348d76eee4967911fad22ff3a1574", "filename": "src/client/command/commands/gm5/DebugCommand.java", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/command/commands/gm5/DebugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/command/commands/gm5/DebugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/DebugCommand.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -39,10 +39,9 @@\n import java.awt.*;\n import java.util.Arrays;\n import java.util.List;\n-import tools.packets.Wedding;\n \n public class DebugCommand extends Command {\n-    private final static String debugTypes[] = {\"monster\", \"packet\", \"portal\", \"spawnpoint\", \"pos\", \"map\", \"mobsp\", \"event\", \"areas\", \"reactors\", \"servercoupons\", \"playercoupons\", \"timer\", \"marriage\", \"\"};\n+    private final static String debugTypes[] = {\"monster\", \"packet\", \"portal\", \"spawnpoint\", \"pos\", \"map\", \"mobsp\", \"event\", \"areas\", \"reactors\", \"servercoupons\", \"playercoupons\", \"timer\", \"marriage\", \"buff\", \"\"};\n     \n     {\n         setDescription(\"\");\n@@ -158,7 +157,10 @@ public void execute(MapleClient c, String[] params) {\n             case \"marriage\":\n                 c.getChannelServer().debugMarriageStatus();\n                 break;\n-\n+            \n+            case \"buff\":\n+                c.getPlayer().debugListAllBuffs();\n+                break;\n         }\n     }\n }"}, {"sha": "acaa12c9bdbc12aed4ad634489079025bf9b6607", "filename": "src/client/inventory/MaplePet.java", "status": "modified", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/inventory/MaplePet.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/inventory/MaplePet.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MaplePet.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -98,6 +98,65 @@ public static MaplePet loadFromDb(int itemid, short position, int petid) {\n         }\n     }\n     \n+    private static void unreferenceMissingPetsFromInventoryDb() {\n+        PreparedStatement ps = null;\n+        Connection con = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            \n+            ps = con.prepareStatement(\"UPDATE inventoryitems SET petid = -1, expiration = 0 WHERE petid != -1 AND petid NOT IN (SELECT petid FROM pets)\");\n+            ps.executeUpdate();\n+            \n+            ps.close();\n+            con.close();\n+        } catch(SQLException ex) {\n+            ex.printStackTrace();\n+        } finally {\n+            try {\n+                if(ps != null && !ps.isClosed()) {\n+                    ps.close();\n+                }\n+                if(con != null && !con.isClosed()) {\n+                    con.close();\n+                }\n+            } catch (SQLException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+    }\n+    \n+    private static void deleteMissingPetsFromDb() {\n+        PreparedStatement ps = null;\n+        Connection con = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            \n+            ps = con.prepareStatement(\"DELETE FROM pets WHERE petid NOT IN (SELECT petid FROM inventoryitems WHERE petid != -1)\");\n+            ps.executeUpdate();\n+            \n+            ps.close();\n+            con.close();\n+        } catch(SQLException ex) {\n+            ex.printStackTrace();\n+        } finally {\n+            try {\n+                if(ps != null && !ps.isClosed()) {\n+                    ps.close();\n+                }\n+                if(con != null && !con.isClosed()) {\n+                    con.close();\n+                }\n+            } catch (SQLException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+    }\n+    \n+    public static void clearMissingPetsFromDb() {\n+        unreferenceMissingPetsFromInventoryDb();\n+        deleteMissingPetsFromDb();\n+    }\n+    \n     public static void deleteFromDb(MapleCharacter owner, int petid) {\n         try {\n             Connection con = DatabaseConnection.getConnection();"}, {"sha": "ccc36461619bb469db0a5b755e68d1379ecc7098", "filename": "src/client/inventory/manipulator/MapleInventoryManipulator.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/inventory/manipulator/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/client/inventory/manipulator/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleInventoryManipulator.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -439,7 +439,7 @@ public static void removeFromSlot(MapleClient c, MapleInventoryType type, short\n                     announceModifyInventory(c, item, fromDrop, allowZero);\n                 }\n                 \n-                MaplePet.deleteFromDb(chr, petid);\n+                // thanks Robin Schulz for noticing pet issues when moving pets out of inventory\n             } else {\n                 inv.removeItem(slot, quantity, allowZero);\n                 if(type != MapleInventoryType.CANHOLD) {"}, {"sha": "1d6cb3ae55886dc0d68522a5444b5ab7efb0b3c5", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -75,11 +75,10 @@\n     public static final boolean USE_FIXED_RATIO_HPMP_UPDATE = true; //Enables the HeavenMS-builtin HPMP update based on the current pool to max pool ratio.\n     public static final boolean USE_FAMILY_SYSTEM = false;\n     public static final boolean USE_DUEY = true;\n-    public static final boolean USE_RANDOMIZE_HPMP_GAIN = true;     //Enables randomizing on MaxHP/MaxMP gains and INT accounting for the MaxMP gain.\n+    public static final boolean USE_RANDOMIZE_HPMP_GAIN = true;     //Enables randomizing on MaxHP/MaxMP gains and INT accounting for the MaxMP gain on level up.\n     public static final boolean USE_STORAGE_ITEM_SORT = true;       //Enables storage \"Arrange Items\" feature.\n     public static final boolean USE_ITEM_SORT = true;               //Enables inventory \"Item Sort/Merge\" feature.\n     public static final boolean USE_ITEM_SORT_BY_NAME = false;      //Item sorting based on name rather than id.\n-    public static final boolean USE_PARTY_SEARCH = false;\n     public static final boolean USE_PARTY_FOR_STARTERS = true;      //Players level 10 or below can create/invite other players on the given level range.\n     public static final boolean USE_AUTOASSIGN_STARTERS_AP = false; //Beginners level 10 or below have their AP autoassigned (they can't choose to levelup a stat). Set true ONLY if the localhost doesn't support AP assigning for beginners level 10 or below.\n     public static final boolean USE_AUTOASSIGN_SECONDARY_CAP = true;//Prevents AP autoassign from spending on secondary stats after the player class' cap (defined on the autoassign handler) has been reached.\n@@ -95,8 +94,8 @@\n     public static final boolean USE_ENFORCE_JOB_LEVEL_RANGE = false;//Caps the player level on the minimum required to advance their current jobs.\n     public static final boolean USE_ENFORCE_JOB_SP_RANGE = false;   //Caps the player SP level on the total obtainable by their current jobs. After changing jobs, missing SP will be retrieved.\n     public static final boolean USE_ENFORCE_ITEM_SUGGESTION = false;//Forces the Owl of Minerva and the Cash Shop to always display the defined item array instead of those featured by the players.\n-    public static final boolean USE_ENFORCE_UNMERCHABLE_CASH = true;//Forces players to not sell CASH items via merchants.\n-    public static final boolean USE_ENFORCE_UNMERCHABLE_PET = true; //Forces players to not sell pets via merchants. (since non-named pets gets dirty name and other possible DB-related issues)\n+    public static final boolean USE_ENFORCE_UNMERCHABLE_CASH = false;//Forces players to not sell CASH items via merchants.\n+    public static final boolean USE_ENFORCE_UNMERCHABLE_PET = false; //Forces players to not sell pets via merchants. (since non-named pets gets dirty name and other possible DB-related issues)\n     public static final boolean USE_ENFORCE_MERCHANT_SAVE = true;   //Forces automatic DB save on merchant owners, at every item movement on shop.\n     public static final boolean USE_ENFORCE_MDOOR_POSITION = false; //Forces mystic door to be spawned near spawnpoints.\n     public static final boolean USE_SPAWN_LOOT_ON_ANIMATION = false;//Makes loot appear some time after the mob has been killed (following the mob death animation, instead of instantly)."}, {"sha": "e67742ce6677a127b96aa1a2ad7494997f0cae5e", "filename": "src/constants/skills/Legend.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/constants/skills/Legend.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/constants/skills/Legend.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/skills/Legend.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -36,7 +36,7 @@\n     public static final int MAKER = 20001007;\n     public static final int BAMBOO_THRUST = 20001009;\n     public static final int INVICIBLE_BARRIER = 20001010;\n-    public static final int POWER_EXPLOSION = 20011011;\n+    public static final int POWER_EXPLOSION = 20001011;\n     public static final int METEO_SHOWER = 20001011;\n     public static final int BLESSING_OF_THE_FAIRY = 20000012;\n     public static final int TUTORIAL_SKILL1 = 20000014;"}, {"sha": "bbea92c5a30b34ae97ac37dba1d62d2085698b62", "filename": "src/net/PacketProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/PacketProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/PacketProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/PacketProcessor.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -241,13 +241,13 @@ public void reset(int channel) {\n             registerHandler(RecvOpcode.ACCEPT_FAMILY, new AcceptFamilyHandler());\n             registerHandler(RecvOpcode.DUEY_ACTION, new DueyHandler());\n             registerHandler(RecvOpcode.USE_DEATHITEM, new UseDeathItemHandler());\n-            //registerHandler(RecvOpcode.PLAYER_UPDATE, new PlayerUpdateHandler()); unused\n             registerHandler(RecvOpcode.PLAYER_MAP_TRANSFER, new PlayerMapTransitionHandler());\n             registerHandler(RecvOpcode.USE_MAPLELIFE, new UseMapleLifeHandler());\n             registerHandler(RecvOpcode.USE_CATCH_ITEM, new UseCatchItemHandler());\n             registerHandler(RecvOpcode.MOB_DAMAGE_MOB_FRIENDLY, new MobDamageMobFriendlyHandler());\n             registerHandler(RecvOpcode.PARTY_SEARCH_REGISTER, new PartySearchRegisterHandler());\n             registerHandler(RecvOpcode.PARTY_SEARCH_START, new PartySearchStartHandler());\n+            registerHandler(RecvOpcode.PARTY_SEARCH_UPDATE, new PartySearchUpdateHandler());\n             registerHandler(RecvOpcode.ITEM_SORT2, new InventorySortHandler());\n             registerHandler(RecvOpcode.LEFT_KNOCKBACK, new LeftKnockbackHandler());\n             registerHandler(RecvOpcode.SNOWBALL, new SnowballHandler());"}, {"sha": "3d1a942f09052399d1a3006091be5aeb1041ae5e", "filename": "src/net/opcodes/RecvOpcode.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/opcodes/RecvOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/opcodes/RecvOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/RecvOpcode.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -186,7 +186,7 @@\n     MONSTER_CARNIVAL(0xDA),\n     PARTY_SEARCH_REGISTER(0xDC),\n     PARTY_SEARCH_START(0xDE),\n-    PLAYER_UPDATE(0xDF),\n+    PARTY_SEARCH_UPDATE(0xDF),\n     CHECK_CASH(0xE4),\n     CASHSHOP_OPERATION(0xE5),\n     COUPON_CODE(0xE6),"}, {"sha": "cd45f0024980f2b6bb9a51d71dd8bab4a0addfe1", "filename": "src/net/server/Server.java", "status": "modified", "additions": 4, "deletions": 28, "changes": 32, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -80,8 +80,10 @@\n import client.MapleClient;\n import client.MapleCharacter;\n import client.SkillFactory;\n+import client.command.CommandsExecutor;\n import client.inventory.Item;\n import client.inventory.ItemFactory;\n+import client.inventory.MaplePet;\n import client.inventory.manipulator.MapleCashidGenerator;\n import client.newyear.NewYearCardRecord;\n import constants.ItemConstants;\n@@ -838,33 +840,6 @@ private void initWorldPlayerRanking() {\n         return rankSystem;\n     }\n     \n-    private static void clearUnreferencedPetIds() {\n-        PreparedStatement ps = null;\n-        Connection con = null;\n-        try {\n-            con = DatabaseConnection.getConnection();\n-            \n-            ps = con.prepareStatement(\"UPDATE inventoryitems SET petid = -1, expiration = 0 WHERE petid != -1 AND petid NOT IN (SELECT petid FROM pets)\");\n-            ps.executeUpdate();\n-            \n-            ps.close();\n-            con.close();\n-        } catch(SQLException ex) {\n-            ex.printStackTrace();\n-        } finally {\n-            try {\n-                if(ps != null && !ps.isClosed()) {\n-                    ps.close();\n-                }\n-                if(con != null && !con.isClosed()) {\n-                    con.close();\n-                }\n-            } catch (SQLException e) {\n-                e.printStackTrace();\n-            }\n-        }\n-    }\n-    \n     public void init() {\n         Properties p = loadWorldINI();\n         if(p == null) {\n@@ -897,7 +872,7 @@ public void init() {\n             sqle.printStackTrace();\n         }\n         \n-        clearUnreferencedPetIds();\n+        MaplePet.clearMissingPetsFromDb();\n         MapleCashidGenerator.loadExistentCashIdsFromDb();\n         \n         IoBuffer.setUseDirectBuffer(false);\n@@ -971,6 +946,7 @@ public void init() {\n         \n         MapleSkillbookInformationProvider.getInstance();\n         OpcodeConstants.generateOpcodeNames();\n+        CommandsExecutor.getInstance();\n     }\n \n     public static void main(String args[]) {"}, {"sha": "1632e910221d1e80dd0b86fb68dd17a8ac472957", "filename": "src/net/server/audit/locks/MonitoredLockType.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/audit/locks/MonitoredLockType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/audit/locks/MonitoredLockType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredLockType.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -65,6 +65,7 @@\n     PARTY,\n     WORLD_PARTY,\n     WORLD_PARTY_SEARCH_ECHELON,\n+    WORLD_PARTY_SEARCH_QUEUE,\n     WORLD_PARTY_SEARCH_STORAGE,\n     WORLD_SRVMESSAGES,\n     WORLD_PETS,"}, {"sha": "b6f12b4b7120a73fcb0f7f4e15f703a21a0df525", "filename": "src/net/server/channel/handlers/DenyPartyRequestHandler.java", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/DenyPartyRequestHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/DenyPartyRequestHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DenyPartyRequestHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -35,10 +35,15 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         slea.readByte();\n-        MapleCharacter cfrom = c.getChannelServer().getPlayerStorage().getCharacterByName(slea.readMapleAsciiString());\n+        String[] cname = slea.readMapleAsciiString().split(\"PS: \");\n+        \n+        MapleCharacter cfrom = c.getChannelServer().getPlayerStorage().getCharacterByName(cname[cname.length - 1]);\n         if (cfrom != null) {\n-            if (MapleInviteCoordinator.answerInvite(InviteType.PARTY, c.getPlayer().getId(), cfrom.getPartyId(), false).getLeft() == InviteResult.DENIED) {\n-                cfrom.getClient().announce(MaplePacketCreator.partyStatusMessage(23, c.getPlayer().getName()));\n+            MapleCharacter chr = c.getPlayer();\n+            \n+            if (MapleInviteCoordinator.answerInvite(InviteType.PARTY, chr.getId(), cfrom.getPartyId(), false).getLeft() == InviteResult.DENIED) {\n+                chr.updatePartySearchAvailability(chr.getParty() == null);\n+                cfrom.getClient().announce(MaplePacketCreator.partyStatusMessage(23, chr.getName()));\n             }\n         }\n     }"}, {"sha": "915bf996d25a595097b69b16c931e54b9d3d6016", "filename": "src/net/server/channel/handlers/EnterCashShopHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/EnterCashShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/EnterCashShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterCashShopHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -61,6 +61,7 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             }\n \n             mc.closePlayerInteractions();\n+            mc.closePartySearchInteractions();\n \n             mc.unregisterChairBuff();\n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(mc.getId(), mc.getAllBuffs());"}, {"sha": "b62781026ed0052ac1c4ef0826c69257fb11e06b", "filename": "src/net/server/channel/handlers/EnterMTSHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/EnterMTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/EnterMTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterMTSHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -87,6 +87,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n \n             chr.closePlayerInteractions();\n+            chr.closePartySearchInteractions();\n             \n             chr.unregisterChairBuff();\n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(chr.getId(), chr.getAllBuffs());"}, {"sha": "cb1a41e189d58d84d2dfd87139f311b37eebfe9d", "filename": "src/net/server/channel/handlers/GuildOperationHandler.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/GuildOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/GuildOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/GuildOperationHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -78,7 +78,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 Set<MapleCharacter> eligibleMembers = new HashSet<>(MapleGuild.getEligiblePlayersForGuild(mc));\n                 if (eligibleMembers.size() < ServerConstants.CREATE_GUILD_MIN_PARTNERS) {\n                     if (mc.getMap().getAllPlayers().size() < ServerConstants.CREATE_GUILD_MIN_PARTNERS) {\n-                        mc.dropMessage(1, \"The Guild you are trying to create don't meet the minimum criteria of number of founders.\");\n+                        // thanks NovaStory for noticing message in need of smoother info\n+                        mc.dropMessage(1, \"Your Guild doesn't have enough cofounders present here and therefore cannot be created at this time.\");\n                     } else {\n                         // players may be unaware of not belonging on a party in order to become eligible, thanks Hair (Legalize) for pointing this out\n                         mc.dropMessage(1, \"Please make sure everyone you are trying to invite is neither on a guild nor on a party.\");"}, {"sha": "605ee0f1735396d065488a0f0711c89880a15e76", "filename": "src/net/server/channel/handlers/PartyOperationHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartyOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartyOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PartyOperationHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -56,6 +56,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     List<MapleCharacter> partymembers = player.getPartyMembers();\n \n                     MapleParty.leaveParty(party, c);\n+                    player.updatePartySearchAvailability(true);\n                     player.partyOperationUpdate(party, partymembers);\n                 }\n                 break;"}, {"sha": "e0f3f57030e0faae451211738adc29194932f3c6", "filename": "src/net/server/channel/handlers/PartySearchRegisterHandler.java", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchRegisterHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchRegisterHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PartySearchRegisterHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -30,13 +30,7 @@\n  * @author Quasar\n  */\n public class PartySearchRegisterHandler extends AbstractMaplePacketHandler {\n-    public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-    \treturn; //Disabling this for now.\n-/*    \tMapleCharacter chr = c.getPlayer();\n-    \tint min = slea.readInt();\n-    \tint max = slea.readInt();\n-    \tif (chr.getLevel() < min || chr.getLevel() > max || (max - min) > 30 || min > max) { // Client editing\n-    \t\treturn;\n-    \t}*/\n-    }\n+    \n+    @Override\n+    public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {}\n }\n\\ No newline at end of file"}, {"sha": "ca7f1c53f1ad487ada7d8977c8527df3669ea805", "filename": "src/net/server/channel/handlers/PartySearchStartHandler.java", "status": "modified", "additions": 30, "deletions": 86, "changes": 116, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchStartHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchStartHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PartySearchStartHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -21,108 +21,52 @@\n  */\n package net.server.channel.handlers;\n \n-import java.util.Collection;\n-\n import net.AbstractMaplePacketHandler;\n import net.server.world.MapleParty;\n-import server.maps.MapleMap;\n-import server.maps.MapleMapObject;\n-import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.MaplePacketCreator;\n import client.MapleCharacter;\n import client.MapleClient;\n-import client.MapleJob;\n-import constants.ServerConstants;\n-import net.server.world.MaplePartyCharacter;\n-import net.server.world.PartyOperation;\n import net.server.world.World;\n \n /**\n  *\n  * @author XoticStory\n  * @author BubblesDev\n+ * @author Ronan\n  */\n public class PartySearchStartHandler extends AbstractMaplePacketHandler {\n         @Override\n \tpublic void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-\t\tif(!ServerConstants.USE_PARTY_SEARCH){\n-\t\t\treturn;\n-\t\t}\n-                \n-\t\tint min = slea.readInt();\n-\t\tint max = slea.readInt();\n-\t\tslea.readInt(); // members\n-\t\tint jobs = slea.readInt();\n-                \n-                MapleParty party = c.getPlayer().getParty();\n-                if(party == null) return;\n-                \n-\t\tMapleCharacter chr = c.getPlayer();\n-\t\tMapleMap map = chr.getMap();\n-                World world = c.getWorldServer();\n-                \n-\t\tCollection<MapleMapObject> mapobjs = map.getPlayers();\n-                \n-\t\tfor (MapleMapObject mapobj : mapobjs) {\n-\t\t\tif (party.getMembers().size() > 5) {\n-\t\t\t\tbreak;\n-\t\t\t}\n-\t\t\tif (mapobj instanceof MapleCharacter) {\n-\t\t\t\tMapleCharacter tchar = (MapleCharacter) mapobj;\n-\t\t\t\tint charlvl = tchar.getLevel();\n-\t\t\t\tif (charlvl >= min && charlvl <= max && isValidJob(tchar.getJob(), jobs)) {\n-\t\t\t\t\tif (tchar.getParty() == null) {\n-                                                MaplePartyCharacter partyplayer = new MaplePartyCharacter(tchar);\n-                                                tchar.getMap().addPartyMember(tchar);\n+            int min = slea.readInt();\n+            int max = slea.readInt();\n \n-                                                world.updateParty(party.getId(), PartyOperation.JOIN, partyplayer);\n-                                                tchar.receivePartyMemberHP();\n-                                                tchar.updatePartyMemberHP();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t}\n+            MapleCharacter chr = c.getPlayer();\n+            if (min > max) {\n+                chr.dropMessage(1, \"The min. value is higher than the max!\");\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+\n+            if (max - min > 30) {\n+                chr.dropMessage(1, \"You can only search for party members within a range of 30 levels.\");\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+\n+            if (chr.getLevel() < min || chr.getLevel() > max) {\n+                chr.dropMessage(1, \"The range of level for search has to include your own level.\");\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+\n+            slea.readInt(); // members\n+            int jobs = slea.readInt();\n+\n+            MapleParty party = c.getPlayer().getParty();\n+            if (party == null || !c.getPlayer().isPartyLeader()) return;\n \n-\tprivate static boolean isValidJob(MapleJob thejob, int jobs) {\n-\t\tint jobid = thejob.getId();\n-\t\tif (jobid == 0) {\n-\t\t\treturn ((jobs & 2) > 0);\n-\t\t} else if (jobid == 100) {\n-\t\t\treturn ((jobs & 4) > 0);\n-\t\t} else if (jobid > 100 && jobid < 113) {\n-\t\t\treturn ((jobs & 8) > 0);\n-\t\t} else if (jobid > 110 && jobid < 123) {\n-\t\t\treturn ((jobs & 16) > 0);\n-\t\t} else if (jobid > 120 && jobid < 133) {\n-\t\t\treturn ((jobs & 32) > 0);\n-\t\t} else if (jobid == 200) {\n-\t\t\treturn ((jobs & 64) > 0);\n-\t\t} else if (jobid > 209 && jobid < 213) {\n-\t\t\treturn ((jobs & 128) > 0);\n-\t\t} else if (jobid > 219 && jobid < 223) {\n-\t\t\treturn ((jobs & 256) > 0);\n-\t\t} else if (jobid > 229 && jobid < 233) {\n-\t\t\treturn ((jobs & 512) > 0);\n-\t\t} else if (jobid == 500) {\n-\t\t\treturn ((jobs & 1024) > 0);\n-\t\t} else if (jobid > 509 && jobid < 513) {\n-\t\t\treturn ((jobs & 2048) > 0);\n-\t\t} else if (jobid > 519 && jobid < 523) {\n-\t\t\treturn ((jobs & 4096) > 0);\n-\t\t} else if (jobid == 400) {\n-\t\t\treturn ((jobs & 8192) > 0);\n-\t\t} else if (jobid > 400 && jobid < 413) {\n-\t\t\treturn ((jobs & 16384) > 0);\n-\t\t} else if (jobid > 419 && jobid < 423) {\n-\t\t\treturn ((jobs & 32768) > 0);\n-\t\t} else if (jobid == 300) {\n-\t\t\treturn ((jobs & 65536) > 0);\n-\t\t} else if (jobid > 300 && jobid < 313) {\n-\t\t\treturn ((jobs & 131072) > 0);\n-\t\t} else if (jobid > 319 && jobid < 323) {\n-\t\t\treturn ((jobs & 262144) > 0);\n-\t\t}\n-\t\treturn false;\n+            World world = c.getWorldServer();\n+            world.getPartySearchCoordinator().registerPartyLeader(chr, min, max, jobs);\n \t}\n }\n\\ No newline at end of file"}, {"sha": "fb448c7f3d6ff5cd62507daf7e4caaa9bfcf8cc9", "filename": "src/net/server/channel/handlers/PartySearchUpdateHandler.java", "status": "renamed", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchUpdateHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PartySearchUpdateHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PartySearchUpdateHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -25,8 +25,10 @@\n import net.AbstractMaplePacketHandler;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n-public final class PlayerUpdateHandler extends AbstractMaplePacketHandler {\n+public final class PartySearchUpdateHandler extends AbstractMaplePacketHandler {\n     \n     @Override\n-    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {}\n+    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n+        c.getWorldServer().getPartySearchCoordinator().unregisterPartyLeader(c.getPlayer());\n+    }\n }\n\\ No newline at end of file", "previous_filename": "src/net/server/channel/handlers/PlayerUpdateHandler.java"}, {"sha": "cc0d4c9ba3586e7897e5a5691526385a17f25bf4", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -608,6 +608,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 MaplePlayerShop shop = chr.getPlayerShop();\n                 MapleHiredMerchant merchant = chr.getHiredMerchant();\n                 if (shop != null && shop.isOwner(chr)) {\n+                    System.out.println(shopItem.getItem().getPet() + \" \" + shopItem.getItem().getPetId());\n+                    System.out.println(ivItem.getPet() + \" \" + ivItem.getPetId());\n                     if (shop.isOpen() || !shop.addItem(shopItem)) { // thanks Vcoc for pointing an exploit with unlimited shop slots\n                         c.announce(MaplePacketCreator.serverNotice(1, \"You can't sell it anymore.\"));\n                         return;"}, {"sha": "63bb21195b2366f3a895ec0c41fb3d75f9e732f4", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -107,7 +107,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     if (damage > 0) {\n                         loseItems = attacker.getStats().loseItem();\n                         if (loseItems != null) {\n-                            if (chr.getBuffEffect(MapleBuffStat.ARIANT_PQ_SHIELD) == null) {\n+                            if (chr.getBuffEffect(MapleBuffStat.AURA) == null) {\n                                 MapleInventoryType type;\n                                 final int playerpos = chr.getPosition().x;\n                                 byte d = 1;"}, {"sha": "9bb579f31435553a71e55bf308d3a642dc130abe", "filename": "src/net/server/coordinator/MaplePartySearchCoordinator.java", "status": "added", "additions": 366, "deletions": 0, "changes": 366, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/MaplePartySearchCoordinator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/MaplePartySearchCoordinator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/MaplePartySearchCoordinator.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,366 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.coordinator;\n+\n+import client.MapleCharacter;\n+import client.MapleJob;\n+import constants.ServerConstants;\n+import java.io.File;\n+import net.server.world.MapleParty;\n+import net.server.coordinator.MapleInviteCoordinator.InviteType;\n+import net.server.coordinator.partysearch.PartySearchEchelon;\n+import net.server.coordinator.partysearch.PartySearchStorage;\n+import tools.MaplePacketCreator;\n+import tools.Pair;\n+\n+import java.util.Collections;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Set;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;\n+import net.server.audit.locks.MonitoredLockType;\n+import net.server.audit.locks.MonitoredReentrantReadWriteLock;\n+import provider.MapleData;\n+import provider.MapleDataProviderFactory;\n+import provider.MapleDataTool;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class MaplePartySearchCoordinator {\n+    \n+    private Map<MapleJob, PartySearchStorage> storage = new HashMap<>();\n+    private Map<MapleJob, PartySearchEchelon> upcomers = new HashMap<>();\n+    \n+    private List<MapleCharacter> leaderQueue = new LinkedList<>();\n+    private final ReentrantReadWriteLock leaderQueueLock = new MonitoredReentrantReadWriteLock(MonitoredLockType.WORLD_PARTY_SEARCH_QUEUE, true);\n+    private final ReadLock leaderQueueRLock = leaderQueueLock.readLock();\n+    private final WriteLock leaderQueueWLock = leaderQueueLock.writeLock();\n+    \n+    private Map<Integer, MapleCharacter> searchLeaders = new HashMap<>();\n+    private Map<Integer, LeaderSearchMetadata> searchSettings = new HashMap<>();\n+    \n+    private static Map<Integer, Set<Integer>> mapNeighbors = fetchNeighbouringMaps();\n+    private static Map<Integer, MapleJob> jobTable = instantiateJobTable();\n+    \n+    private static Map<Integer, Set<Integer>> fetchNeighbouringMaps() {\n+        Map<Integer, Set<Integer>> mapLinks = new HashMap<>();\n+        \n+        MapleData data = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/\" + \"Etc.wz\")).getData(\"MapNeighbors.img\");\n+        if (data != null) {\n+            for (MapleData mapdata : data.getChildren()) {\n+                int mapid = Integer.valueOf(mapdata.getName());\n+\n+                Set<Integer> neighborMaps = new HashSet<>();\n+                mapLinks.put(mapid, neighborMaps);\n+\n+                for (MapleData neighbordata : mapdata.getChildren()) {\n+                    int neighborid = MapleDataTool.getInt(neighbordata, 999999999);\n+\n+                    if (neighborid != 999999999) {\n+                        neighborMaps.add(neighborid);\n+                    }\n+                }\n+            }\n+        }\n+        \n+        return mapLinks;\n+    }\n+    \n+    public static boolean isInVicinity(int callerMapid, int calleeMapid) {\n+        Set<Integer> vicinityMapids = mapNeighbors.get(calleeMapid);\n+        \n+        if (vicinityMapids != null) {\n+            return vicinityMapids.contains(calleeMapid);\n+        } else {\n+            int callerRange = callerMapid / 10000000;\n+            if (callerRange >= 90) {\n+                return callerRange == (calleeMapid / 1000000);\n+            } else {\n+                return callerRange == (calleeMapid / 10000000);\n+            }\n+        }\n+    }\n+    \n+    private static Map<Integer, MapleJob> instantiateJobTable() {\n+        Map<Integer, MapleJob> table = new HashMap<>();\n+        \n+        List<Pair<Integer, Integer>> jobSearchTypes = new LinkedList<Pair<Integer, Integer>>() {{\n+            add(new Pair<>(MapleJob.MAPLELEAF_BRIGADIER.getId(), 0));\n+            add(new Pair<>(0, 0));\n+            add(new Pair<>(MapleJob.ARAN1.getId(), 0));\n+            add(new Pair<>(100, 3));\n+            add(new Pair<>(MapleJob.DAWNWARRIOR1.getId(), 0));\n+            add(new Pair<>(200, 3));\n+            add(new Pair<>(MapleJob.BLAZEWIZARD1.getId(), 0));\n+            add(new Pair<>(500, 2));\n+            add(new Pair<>(MapleJob.THUNDERBREAKER1.getId(), 0));\n+            add(new Pair<>(400, 2));\n+            add(new Pair<>(MapleJob.NIGHTWALKER1.getId(), 0));\n+            add(new Pair<>(300, 2));\n+            add(new Pair<>(MapleJob.WINDARCHER1.getId(), 0));\n+            add(new Pair<>(MapleJob.EVAN1.getId(), 0));\n+        }};\n+        \n+        int i = 0;\n+        for (Pair<Integer, Integer> p : jobSearchTypes) {\n+            table.put(i, MapleJob.getById(p.getLeft()));\n+            i++;\n+            \n+            for (int j = 1; j <= p.getRight(); j++) {\n+                table.put(i, MapleJob.getById(p.getLeft() + 10 * j));\n+                i++;\n+            }\n+        }\n+        \n+        return table;\n+    }\n+    \n+    private class LeaderSearchMetadata {\n+        private int minLevel;\n+        private int maxLevel;\n+        private List<MapleJob> searchedJobs;\n+        \n+        private int reentryCount;\n+        \n+        private List<MapleJob> decodeSearchedJobs(int jobsSelected) {\n+            List<MapleJob> searchedJobs = new LinkedList<>();\n+            \n+            int topByte = (int)((Math.log(jobsSelected) / Math.log(2)) + 1e-5);\n+            \n+            for (int i = 0; i <= topByte; i++) {\n+                if (jobsSelected % 2 == 1) {\n+                    MapleJob job = jobTable.get(i);\n+                    if (job != null) {\n+                        searchedJobs.add(job);\n+                    }\n+                }\n+                \n+                jobsSelected = jobsSelected >> 1;\n+                if (jobsSelected == 0) {\n+                    break;\n+                }\n+            }\n+            \n+            return searchedJobs;\n+        }\n+        \n+        private LeaderSearchMetadata(int minLevel, int maxLevel, int jobs) {\n+            this.minLevel = minLevel;\n+            this.maxLevel = maxLevel;\n+            this.searchedJobs = decodeSearchedJobs(jobs);\n+            this.reentryCount = 0;\n+        }\n+        \n+    }\n+    \n+    public MaplePartySearchCoordinator() {\n+        for (MapleJob job : jobTable.values()) {\n+            storage.put(job, new PartySearchStorage());\n+            upcomers.put(job, new PartySearchEchelon());\n+        }\n+    }\n+    \n+    public void attachPlayer(MapleCharacter chr) {\n+        upcomers.get(getPartySearchJob(chr.getJob())).attachPlayer(chr);\n+    }\n+    \n+    public void detachPlayer(MapleCharacter chr) {\n+        MapleJob psJob = getPartySearchJob(chr.getJob());\n+        \n+        if (!upcomers.get(psJob).detachPlayer(chr)) {\n+            storage.get(psJob).detachPlayer(chr);\n+        }\n+    }\n+    \n+    public void updatePartySearchStorage() {\n+        for (Entry<MapleJob, PartySearchEchelon> psUpdate : upcomers.entrySet()) {\n+            storage.get(psUpdate.getKey()).updateStorage(psUpdate.getValue().exportEchelon());\n+        }\n+    }\n+    \n+    private static MapleJob getPartySearchJob(MapleJob job) {\n+        if (job.getJobNiche() == 0) {\n+            return MapleJob.BEGINNER;\n+        } else if (job.getId() < 600) { // explorers\n+            return MapleJob.getById((job.getId() / 10) * 10);\n+        } else if (job.getId() >= 1000) {\n+            return MapleJob.getById((job.getId() / 100) * 100);\n+        } else {\n+            return MapleJob.MAPLELEAF_BRIGADIER;\n+        }\n+    }\n+    \n+    private MapleCharacter fetchPlayer(int callerCid, int callerMapid, MapleJob job, int minLevel, int maxLevel) {\n+        return storage.get(getPartySearchJob(job)).callPlayer(callerCid, callerMapid, minLevel, maxLevel);\n+    }\n+    \n+    private void addQueueLeader(MapleCharacter leader) {\n+        leaderQueueRLock.lock();\n+        try {\n+            leaderQueue.add(leader);\n+        } finally {\n+            leaderQueueRLock.unlock();\n+        }\n+    }\n+    \n+    private void removeQueueLeader(MapleCharacter leader) {\n+        leaderQueueRLock.lock();\n+        try {\n+            leaderQueue.remove(leader);\n+        } finally {\n+            leaderQueueRLock.unlock();\n+        }\n+    }\n+    \n+    public void registerPartyLeader(MapleCharacter leader, int minLevel, int maxLevel, int jobs) {\n+        if (searchLeaders.containsKey(leader.getId())) return;\n+        \n+        searchSettings.put(leader.getId(), new LeaderSearchMetadata(minLevel, maxLevel, jobs));\n+        searchLeaders.put(leader.getId(), leader);\n+        addQueueLeader(leader);\n+    }\n+    \n+    public void unregisterPartyLeader(MapleCharacter leader) {\n+        MapleCharacter toRemove = searchLeaders.remove(leader.getId());\n+        if (toRemove != null) {\n+            removeQueueLeader(toRemove);\n+            searchSettings.remove(leader.getId());\n+        }\n+    }\n+    \n+    private MapleCharacter searchPlayer(MapleCharacter leader) {\n+        LeaderSearchMetadata settings = searchSettings.get(leader.getId());\n+        if (settings != null) {\n+            int minLevel = settings.minLevel, maxLevel = settings.maxLevel;\n+            Collections.shuffle(settings.searchedJobs);\n+            \n+            int leaderCid = leader.getId();\n+            int leaderMapid = leader.getMapId();\n+            for (MapleJob searchJob : settings.searchedJobs) {\n+                MapleCharacter chr = fetchPlayer(leaderCid, leaderMapid, searchJob, minLevel, maxLevel);\n+                if (chr != null) {\n+                    return chr;\n+                }\n+            }\n+        }\n+        \n+        return null;\n+    }\n+    \n+    private boolean sendPartyInviteFromSearch(MapleCharacter chr, MapleCharacter leader) {\n+        if (chr == null) {\n+            return false;\n+        }\n+        \n+        int partyid = leader.getPartyId();\n+        if (partyid < 0) {\n+            return false;\n+        }\n+        \n+        if (MapleInviteCoordinator.createInvite(InviteType.PARTY, leader, partyid, chr.getId())) {\n+            chr.disablePartySearchInvite(leader.getId());\n+            chr.announce(MaplePacketCreator.partySearchInvite(leader));\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n+    \n+    private Pair<List<MapleCharacter>, List<MapleCharacter>> fetchQueuedLeaders() {\n+        List<MapleCharacter> queuedLeaders, nextLeaders;\n+        \n+        leaderQueueWLock.lock();\n+        try {\n+            int splitIdx = Math.min(leaderQueue.size(), 100);\n+            \n+            queuedLeaders = new LinkedList<>(leaderQueue.subList(0, splitIdx));\n+            nextLeaders = new LinkedList<>(leaderQueue.subList(splitIdx, leaderQueue.size()));\n+        } finally {\n+            leaderQueueWLock.unlock();\n+        }\n+        \n+        return new Pair<>(queuedLeaders, nextLeaders);\n+    }\n+    \n+    public void runPartySearch() {\n+        Pair<List<MapleCharacter>, List<MapleCharacter>> queuedLeaders = fetchQueuedLeaders();\n+        \n+        List<MapleCharacter> searchedLeaders = new LinkedList<>();\n+        List<MapleCharacter> recalledLeaders = new LinkedList<>();\n+        List<MapleCharacter> expiredLeaders = new LinkedList<>();\n+        \n+        for (MapleCharacter leader : queuedLeaders.getLeft()) {\n+            MapleCharacter chr = searchPlayer(leader);\n+            if (sendPartyInviteFromSearch(chr, leader)) {\n+                searchedLeaders.add(leader);\n+            } else {\n+                LeaderSearchMetadata settings = searchSettings.get(leader.getId());\n+                if (settings != null) {\n+                    if (settings.reentryCount < ServerConstants.PARTY_SEARCH_REENTRY_LIMIT) {\n+                        settings.reentryCount += 1;\n+                        recalledLeaders.add(leader);\n+                    } else {\n+                        expiredLeaders.add(leader);\n+                    }\n+                }\n+            }\n+        }\n+        \n+        leaderQueueRLock.lock();\n+        try {\n+            leaderQueue.clear();\n+            leaderQueue.addAll(queuedLeaders.getRight());\n+\n+            try {\n+                leaderQueue.addAll(25, recalledLeaders);\n+            } catch (IndexOutOfBoundsException e) {\n+                leaderQueue.addAll(recalledLeaders);\n+            }\n+        } finally {\n+            leaderQueueRLock.unlock();\n+        }\n+        \n+        for (MapleCharacter leader : searchedLeaders) {\n+            MapleParty party = leader.getParty();\n+            if (party != null && party.getMembers().size() < 6) {\n+                addQueueLeader(leader);\n+            } else {\n+                if (leader.isLoggedinWorld()) leader.dropMessage(5, \"Your Party Search token session has finished as your party reached full capacity.\");\n+                searchLeaders.remove(leader.getId());\n+                searchSettings.remove(leader.getId());\n+            }\n+        }\n+        \n+        for (MapleCharacter leader : expiredLeaders) {\n+            if (leader.isLoggedinWorld()) leader.dropMessage(5, \"Your Party Search token session expired, please stop your Party Search and retry again later.\");\n+            searchLeaders.remove(leader.getId());\n+            searchSettings.remove(leader.getId());\n+        }\n+    }\n+    \n+}"}, {"sha": "e7cdf50d07250ea0bde63bb0447ba790b7212430", "filename": "src/net/server/coordinator/partysearch/PartySearchCharacter.java", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/partysearch/PartySearchCharacter.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,79 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.coordinator.partysearch;\n+\n+import client.MapleCharacter;\n+import net.server.coordinator.MaplePartySearchCoordinator;\n+\n+import java.lang.ref.WeakReference;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class PartySearchCharacter {\n+    \n+    private WeakReference<MapleCharacter> player;\n+    private int level;\n+    private boolean queued;\n+    \n+    public PartySearchCharacter(MapleCharacter chr) {\n+        player = new WeakReference(chr);\n+        level = chr.getLevel();\n+        queued = true;\n+    }\n+    \n+    @Override\n+    public String toString() {\n+        MapleCharacter chr = player.get();\n+        return chr == null ? \"[empty]\" : chr.toString();\n+    }\n+    \n+    public MapleCharacter callPlayer(int leaderid, int callerMapid) {\n+        MapleCharacter chr = player.get();\n+        if (chr == null || !MaplePartySearchCoordinator.isInVicinity(callerMapid, chr.getMapId())) {\n+            return null;\n+        }\n+        \n+        if (chr.hasDisabledPartySearchInvite(leaderid)) {\n+            return null;\n+        }\n+        \n+        queued = false;\n+        if (chr.isLoggedinWorld() && chr.getParty() == null) {\n+            return chr;\n+        } else {\n+            return null;\n+        }\n+    }\n+    \n+    public MapleCharacter getPlayer() {\n+        return player.get();\n+    }\n+    \n+    public int getLevel() {\n+        return level;\n+    }\n+    \n+    public boolean isQueued() {\n+        return queued;\n+    }\n+    \n+}"}, {"sha": "ff0b08fd7d2110d021ad74a413fc52714cbe50e8", "filename": "src/net/server/coordinator/partysearch/PartySearchEchelon.java", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchEchelon.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchEchelon.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/partysearch/PartySearchEchelon.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,86 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.coordinator.partysearch;\n+\n+import client.MapleCharacter;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+import java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;\n+import net.server.audit.locks.MonitoredLockType;\n+import net.server.audit.locks.MonitoredReentrantReadWriteLock;\n+\n+import java.lang.ref.WeakReference;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class PartySearchEchelon {\n+    \n+    private final ReentrantReadWriteLock psLock = new MonitoredReentrantReadWriteLock(MonitoredLockType.WORLD_PARTY_SEARCH_ECHELON, true);\n+    private final ReadLock psRLock = psLock.readLock();\n+    private final WriteLock psWLock = psLock.writeLock();\n+    \n+    private Map<Integer, WeakReference<MapleCharacter>> echelon = new HashMap<>(20);\n+    \n+    public List<MapleCharacter> exportEchelon() {\n+        psWLock.lock();     // reversing read/write actually could provide a lax yet sure performance/precision trade-off here\n+        try {\n+            List<MapleCharacter> players = new ArrayList<>(echelon.size());\n+            \n+            for (WeakReference<MapleCharacter> chrRef : echelon.values()) {\n+                MapleCharacter chr = chrRef.get();\n+                if (chr != null) {\n+                    players.add(chr);\n+                }\n+            }\n+            \n+            echelon.clear();\n+            return players;\n+        } finally {\n+            psWLock.unlock();\n+        }\n+    }\n+    \n+    public void attachPlayer(MapleCharacter chr) {\n+        psRLock.lock();\n+        try {\n+            echelon.put(chr.getId(), new WeakReference<>(chr));\n+        } finally {\n+            psRLock.unlock();\n+        }\n+    }\n+    \n+    public boolean detachPlayer(MapleCharacter chr) {\n+        psRLock.lock();\n+        try {\n+            return echelon.remove(chr.getId()) != null;\n+        } finally {\n+            psRLock.unlock();\n+        }\n+    }\n+    \n+}"}, {"sha": "a5cc871548179e379087f5f1fed41538000865e3", "filename": "src/net/server/coordinator/partysearch/PartySearchStorage.java", "status": "added", "additions": 258, "deletions": 0, "changes": 258, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchStorage.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/coordinator/partysearch/PartySearchStorage.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/partysearch/PartySearchStorage.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,258 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.coordinator.partysearch;\n+\n+import client.MapleCharacter;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+import java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;\n+import net.server.audit.locks.MonitoredLockType;\n+import net.server.audit.locks.MonitoredReentrantReadWriteLock;\n+\n+import java.awt.geom.Line2D;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class PartySearchStorage {\n+    \n+    private List<PartySearchCharacter> storage = new ArrayList<>(20);\n+    private PartySearchEmptyIntervals emptyManager = new PartySearchEmptyIntervals();\n+    \n+    private class PartySearchEmptyIntervals {\n+        \n+        private List<Line2D> emptyLimits = new ArrayList<>();\n+        \n+        private void refitEmptyIntervals(int st, int en, int minLevel, int maxLevel) {\n+            List<Line2D> checkLimits = new ArrayList<>(emptyLimits.subList(st, en));\n+            \n+            float newLimitX1, newLimitX2;\n+            if (!checkLimits.isEmpty()) {\n+                Line2D firstLimit = checkLimits.get(0);\n+                Line2D lastLimit = checkLimits.get(checkLimits.size() - 1);\n+\n+                newLimitX1 = (float) ((minLevel < firstLimit.getX1()) ? minLevel : firstLimit.getX1());\n+                newLimitX2 = (float) ((maxLevel > lastLimit.getX2()) ? maxLevel : lastLimit.getX2());\n+\n+                for (Line2D limit : checkLimits) {\n+                    emptyLimits.remove(st);\n+                }\n+            } else {\n+                newLimitX1 = minLevel;\n+                newLimitX2 = maxLevel;\n+            }\n+            \n+            emptyLimits.add(st, new Line2D.Float((float) newLimitX1, 0, (float) newLimitX2, 0));\n+        }\n+        \n+        private int bsearchInterval(int level) {\n+            int st = 0, en = emptyLimits.size() - 1;\n+\n+            int mid, idx;\n+            while (en >= st) {\n+                idx = (st + en) / 2;\n+                mid = (int) emptyLimits.get(idx).getX1();\n+\n+                if (mid == level) {\n+                    return idx;\n+                } else if (mid < level) {\n+                    st = idx + 1;\n+                } else {\n+                    en = idx - 1;\n+                }\n+            }\n+\n+            return en;\n+        }\n+        \n+        public void addEmptyInterval(int fromLevel, int toLevel) {\n+            synchronized (emptyLimits) {    // adding intervals occurs on a same-thread process, so this is actually not performance grinding\n+                int st = bsearchInterval(fromLevel);\n+                if (st < 0) {\n+                    st = 0;\n+                } else if (emptyLimits.get(st).getX2() < fromLevel) {\n+                    st += 1;\n+                }\n+\n+                int en = bsearchInterval(toLevel);\n+                if (en < st) en = st - 1;\n+\n+                refitEmptyIntervals(st, en + 1, fromLevel, toLevel);\n+            }\n+        }\n+        \n+        public boolean isInEmptyInterval(int minLevel, int maxLevel) {\n+            synchronized (emptyLimits) {\n+                int idx = bsearchInterval(minLevel);\n+                return idx >= 0 && maxLevel <= emptyLimits.get(idx).getX2();\n+            }\n+        }\n+        \n+        public void clearEmptyInterval() {\n+            synchronized (emptyLimits) {\n+                emptyLimits.clear();\n+            }\n+        }\n+        \n+    }\n+    \n+    private final ReentrantReadWriteLock psLock = new MonitoredReentrantReadWriteLock(MonitoredLockType.WORLD_PARTY_SEARCH_STORAGE, true);\n+    private final ReadLock psRLock = psLock.readLock();\n+    private final WriteLock psWLock = psLock.writeLock();\n+    \n+    public List<PartySearchCharacter> getStorageList() {\n+        psRLock.lock();\n+        try {\n+            return new ArrayList<>(storage);\n+        } finally {\n+            psRLock.unlock();\n+        }\n+    }\n+    \n+    private Map<Integer, MapleCharacter> fetchRemainingPlayers() {\n+        List<PartySearchCharacter> players = getStorageList();\n+        Map<Integer, MapleCharacter> remainingPlayers = new HashMap<>(players.size());\n+        \n+        for (PartySearchCharacter psc : players) {\n+            if (psc.isQueued()) {\n+                MapleCharacter chr = psc.getPlayer();\n+                if (chr != null) {\n+                    remainingPlayers.put(chr.getId(), chr);\n+                }\n+            }\n+        }\n+        \n+        return remainingPlayers;\n+    }\n+    \n+    public void updateStorage(Collection<MapleCharacter> echelon) {\n+        Map<Integer, MapleCharacter> newcomers = new HashMap<>();\n+        for (MapleCharacter chr : echelon) {\n+            newcomers.put(chr.getId(), chr);\n+        }\n+        \n+        Map<Integer, MapleCharacter> curStorage = fetchRemainingPlayers();\n+        curStorage.putAll(newcomers);\n+        \n+        List<PartySearchCharacter> pscList = new ArrayList<>(curStorage.size());\n+        for (MapleCharacter chr : curStorage.values()) {\n+            pscList.add(new PartySearchCharacter(chr));\n+        }\n+\n+        Collections.sort(pscList, new Comparator<PartySearchCharacter>() {\n+            @Override\n+            public int compare(PartySearchCharacter c1, PartySearchCharacter c2)\n+            {\n+                int levelP1 = c1.getLevel(), levelP2 = c2.getLevel();\n+                return levelP1 > levelP2 ? 1 : (levelP1 == levelP2 ? 0 : -1);\n+            }\n+        });\n+        \n+        psWLock.lock();\n+        try {\n+            storage.clear();\n+            storage.addAll(pscList);\n+        } finally {\n+            psWLock.unlock();\n+        }\n+        \n+        emptyManager.clearEmptyInterval();\n+    }\n+    \n+    private static int bsearchStorage(List<PartySearchCharacter> storage, int level) {\n+        int st = 0, en = storage.size() - 1;\n+        \n+        int mid, idx;\n+        while (en >= st) {\n+            idx = (st + en) / 2;\n+            mid = storage.get(idx).getLevel();\n+            \n+            if (mid == level) {\n+                return idx;\n+            } else if (mid < level) {\n+                st = idx + 1;\n+            } else {\n+                en = idx - 1;\n+            }\n+        }\n+        \n+        return en;\n+    }\n+    \n+    public MapleCharacter callPlayer(int callerCid, int callerMapid, int minLevel, int maxLevel) {\n+        if (emptyManager.isInEmptyInterval(minLevel, maxLevel)) {\n+            return null;\n+        }\n+        \n+        List<PartySearchCharacter> pscList = getStorageList();\n+        \n+        int idx = bsearchStorage(pscList, maxLevel);\n+        for (int i = idx; i >= 0; i--) {\n+            PartySearchCharacter psc = pscList.get(i);\n+            if (!psc.isQueued()) {\n+                continue;\n+            }\n+            \n+            if (psc.getLevel() < minLevel) {\n+                break;\n+            }\n+            \n+            MapleCharacter chr = psc.callPlayer(callerCid, callerMapid);\n+            if (chr != null) {\n+                return chr;\n+            }\n+        }\n+        \n+        emptyManager.addEmptyInterval(minLevel, maxLevel);\n+        return null;\n+    }\n+    \n+    public void detachPlayer(MapleCharacter chr) {\n+        PartySearchCharacter toRemove = null;\n+        for (PartySearchCharacter psc : getStorageList()) {\n+            MapleCharacter player = psc.getPlayer();\n+            \n+            if (player != null && player.getId() == chr.getId()) {\n+                toRemove = psc;\n+                break;\n+            }\n+        }\n+        \n+        if (toRemove != null) {\n+            psWLock.lock();\n+            try {\n+                storage.remove(toRemove);\n+            } finally {\n+                psWLock.unlock();\n+            }\n+        }\n+    }\n+    \n+}"}, {"sha": "aefa89325d2ea5dae1797ec5fb66a43e75fb0441", "filename": "src/net/server/worker/PartySearchWorker.java", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/worker/PartySearchWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/worker/PartySearchWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/PartySearchWorker.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,38 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.worker;\n+\n+import net.server.world.World;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class PartySearchWorker extends BaseWorker implements Runnable {\n+    \n+    @Override\n+    public void run() {\n+        wserv.runPartySearchUpdateSchedule();\n+    }\n+    \n+    public PartySearchWorker(World world) {\n+        super(world);\n+    }\n+}"}, {"sha": "728cfbe4a407398170c2f22c22f39ea43f5b9eb2", "filename": "src/net/server/world/MapleParty.java", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/world/MapleParty.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/world/MapleParty.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/MapleParty.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -341,7 +341,8 @@ public static boolean createParty(MapleCharacter player, boolean silentCheck) {\n             player.setMPC(partyplayer);\n             player.getMap().addPartyMember(player);\n             player.silentPartyUpdate();\n-\n+            \n+            player.updatePartySearchAvailability(false);\n             player.partyOperationUpdate(party, null);\n             \n             player.announce(MaplePacketCreator.partyCreated(party, partyplayer.getId()));\n@@ -370,7 +371,9 @@ public static boolean joinParty(MapleCharacter player, int partyid, boolean sile\n                     world.updateParty(party.getId(), PartyOperation.JOIN, partyplayer);\n                     player.receivePartyMemberHP();\n                     player.updatePartyMemberHP();\n-\n+                    \n+                    player.resetPartySearchInvite(party.getLeaderId());\n+                    player.updatePartySearchAvailability(false);\n                     player.partyOperationUpdate(party, null);\n                     return true;\n                 } else {\n@@ -466,7 +469,8 @@ public static void expelFromParty(MapleParty party, MapleClient c, int expelCid)\n \n                         emc.setParty(null);\n                         world.updateParty(party.getId(), PartyOperation.EXPEL, expelled);\n-\n+                        \n+                        emc.updatePartySearchAvailability(true);\n                         emc.partyOperationUpdate(party, partyMembers);\n                     } else {\n                         world.updateParty(party.getId(), PartyOperation.EXPEL, expelled);"}, {"sha": "db516bca896d541c5f41d9b3810601ee90a66110", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -70,6 +70,7 @@\n import net.server.worker.HiredMerchantWorker;\n import net.server.worker.MapOwnershipWorker;\n import net.server.worker.MountTirednessWorker;\n+import net.server.worker.PartySearchWorker;\n import net.server.worker.PetFullnessWorker;\n import net.server.worker.ServerMessageWorker;\n import net.server.worker.TimedMapObjectWorker;\n@@ -94,6 +95,7 @@\n import net.server.coordinator.MapleInviteCoordinator.InviteResult;\n import net.server.coordinator.MapleInviteCoordinator.InviteType;\n import net.server.coordinator.MapleMatchCheckerCoordinator;\n+import net.server.coordinator.MaplePartySearchCoordinator;\n \n /**\n  *\n@@ -115,6 +117,7 @@\n     private Map<Integer, MapleGuildSummary> gsStore = new HashMap<>();\n     private PlayerStorage players = new PlayerStorage();\n     private MapleMatchCheckerCoordinator matchChecker = new MapleMatchCheckerCoordinator();\n+    private MaplePartySearchCoordinator partySearch = new MaplePartySearchCoordinator();\n     \n     private final ReentrantReadWriteLock chnLock = new MonitoredReentrantReadWriteLock(MonitoredLockType.WORLD_CHANNELS, true);\n     private ReadLock chnRLock = chnLock.readLock();\n@@ -170,6 +173,7 @@\n     private ScheduledFuture<?> marriagesSchedule;\n     private ScheduledFuture<?> mapOwnershipSchedule;\n     private ScheduledFuture<?> fishingSchedule;\n+    private ScheduledFuture<?> partySearchSchedule;\n     \n     public World(int world, int flag, String eventmsg, int exprate, int droprate, int bossdroprate, int mesorate, int questrate, int travelrate, int fishingrate) {\n         this.id = world;\n@@ -202,6 +206,7 @@ public World(int world, int flag, String eventmsg, int exprate, int droprate, in\n         marriagesSchedule = tman.register(new WeddingReservationWorker(this), ServerConstants.WEDDING_RESERVATION_INTERVAL * 60 * 1000, ServerConstants.WEDDING_RESERVATION_INTERVAL * 60 * 1000);\n         mapOwnershipSchedule = tman.register(new MapOwnershipWorker(this), 20 * 1000, 20 * 1000);\n         fishingSchedule = tman.register(new FishingWorker(this), 10 * 1000, 10 * 1000);\n+        partySearchSchedule = tman.register(new PartySearchWorker(this), 10 * 1000, 10 * 1000);\n         \n     }\n \n@@ -494,6 +499,10 @@ public PlayerStorage getPlayerStorage() {\n     public MapleMatchCheckerCoordinator getMatchCheckerCoordinator() {\n         return matchChecker;\n     }\n+    \n+    public MaplePartySearchCoordinator getPartySearchCoordinator() {\n+        return partySearch;\n+    }\n \n     public void addPlayer(MapleCharacter chr) {\n         players.addPlayer(chr);\n@@ -1975,6 +1984,11 @@ public void runCheckFishingSchedule() {\n         }\n     }\n     \n+    public void runPartySearchUpdateSchedule() {\n+        partySearch.updatePartySearchStorage();\n+        partySearch.runPartySearch();\n+    }\n+    \n     private void clearWorldData() {\n         List<MapleParty> pList;\n         partyLock.lock();\n@@ -2061,6 +2075,11 @@ public final void shutdown() {\n             fishingSchedule = null;\n         }\n         \n+        if(partySearchSchedule != null) {\n+            partySearchSchedule.cancel(false);\n+            partySearchSchedule = null;\n+        }\n+        \n         players.disconnectAll();\n         players = null;\n         "}, {"sha": "2e8ac01bc86634904da7e8db27f24315a3d44a72", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 117, "deletions": 5, "changes": 122, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -146,7 +146,55 @@\n     private Point lt, rb;\n     private byte bulletCount, bulletConsume;\n     private byte mapProtection;\n-\n+    private CardItemupStats cardStats;\n+    \n+    private static class CardItemupStats {\n+        protected int itemCode, prob;\n+        private List<Pair<Integer, Integer>> areas;\n+        \n+        private CardItemupStats(int code, int prob, List<Pair<Integer, Integer>> areas) {\n+            this.itemCode = code;\n+            this.prob = prob;\n+            this.areas = areas;\n+        }\n+        \n+        private boolean isInArea(int mapid) {\n+            if (this.areas == null) {\n+                return true;\n+            }\n+            \n+            for (Pair<Integer, Integer> a : this.areas) {\n+                if (mapid >= a.left && mapid <= a.right) {\n+                    return true;\n+                }\n+            }\n+            \n+            return false;\n+        }\n+    }\n+    \n+    public boolean isActive(int mapid) {\n+        return cardStats == null || cardStats.isInArea(mapid);\n+    }\n+    \n+    public int getCardRate(int mapid, int itemid) {\n+        if (cardStats != null) {\n+            if (cardStats.itemCode == Integer.MAX_VALUE) {\n+                return cardStats.prob;\n+            } else if (cardStats.itemCode < 1000) {\n+                if (itemid / 10000 == cardStats.itemCode) {\n+                    return cardStats.prob;\n+                }\n+            } else {\n+                if (itemid == cardStats.itemCode) {\n+                    return cardStats.prob;\n+                }\n+            }\n+        }\n+        \n+        return 0;\n+    }\n+    \n     public static MapleStatEffect loadSkillEffectFromData(MapleData source, int skillid, boolean overtime) {\n         return loadFromData(source, skillid, true, overtime);\n     }\n@@ -248,7 +296,7 @@ private static MapleStatEffect loadFromData(MapleData source, int sourceid, bool\n         ret.jump = (short) MapleDataTool.getInt(\"jump\", source, 0);\n \n         ret.barrier = MapleDataTool.getInt(\"barrier\", source, 0);\n-        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.ARIANT_PQ_SHIELD, ret.barrier);\n+        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.AURA, ret.barrier);\n         \n         ret.mapProtection = mapProtection(sourceid);\n         addBuffStatPairToListIfNotZero(statups, MapleBuffStat.MAP_PROTECTION, Integer.valueOf(ret.mapProtection));\n@@ -303,6 +351,65 @@ private static MapleStatEffect loadFromData(MapleData source, int sourceid, bool\n                             addBuffStatPairToListIfNotZero(statups, MapleBuffStat.COUPON_DRP3, 1);\n                             break;\n                     }\n+                } else if (isMonsterCard(sourceid)) {\n+                    int prob = 0, itemupCode = Integer.MAX_VALUE;\n+                    List<Pair<Integer, Integer>> areas = null;\n+                    \n+                    MapleData con = source.getChildByPath(\"con\");\n+                    if (con != null) {\n+                        areas = new ArrayList<>(3);\n+\n+                        for (MapleData conData : con.getChildren()) {\n+                            int startMap = MapleDataTool.getInt(\"sMap\", conData, 0);\n+                            int endMap = MapleDataTool.getInt(\"eMap\", conData, 0);\n+\n+                            areas.add(new Pair<>(startMap, endMap));\n+                        }\n+                    }\n+                    \n+                    if (MapleDataTool.getInt(\"mesoupbyitem\", source, 0) != 0) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.MESO_UP_BY_ITEM, 4);\n+                        prob = MapleDataTool.getInt(\"prob\", source, 1);\n+                    }\n+                    \n+                    int itemupType = MapleDataTool.getInt(\"itemupbyitem\", source, 0);\n+                    if (itemupType != 0) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.ITEM_UP_BY_ITEM, 4);\n+                        prob = MapleDataTool.getInt(\"prob\", source, 1);\n+                        \n+                        switch (itemupType) {\n+                            case 2:\n+                                itemupCode = MapleDataTool.getInt(\"itemCode\", source, 1);\n+                                break;\n+                                \n+                            case 3:\n+                                itemupCode = MapleDataTool.getInt(\"itemRange\", source, 1);    // 3 digits\n+                                break;\n+                        }\n+                    }\n+                    \n+                    if (MapleDataTool.getInt(\"respectPimmune\", source, 0) != 0) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.RESPECT_PIMMUNE, 4);\n+                    }\n+                    \n+                    if (MapleDataTool.getInt(\"respectMimmune\", source, 0) != 0) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.RESPECT_MIMMUNE, 4);\n+                    }\n+                    \n+                    if (MapleDataTool.getString(\"defenseAtt\", source, null) != null) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.DEFENSE_ATT, 4);\n+                    }\n+                    \n+                    if (MapleDataTool.getString(\"defenseState\", source, null) != null) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.DEFENSE_STATE, 4);\n+                    }\n+                    \n+                    int thaw = MapleDataTool.getInt(\"thaw\", source, 0);\n+                    if (thaw != 0) {\n+                        addBuffStatPairToListIfNotZero(statups, MapleBuffStat.MAP_PROTECTION, thaw > 0 ? 1 : 2);\n+                    }\n+                    \n+                    ret.cardStats = new CardItemupStats(itemupCode, prob, areas);\n                 } else if (isExpIncrease(sourceid)) {\n                     addBuffStatPairToListIfNotZero(statups, MapleBuffStat.EXP_INCREASE, MapleDataTool.getInt(\"expinc\", source, 0));\n                 }\n@@ -1139,7 +1246,7 @@ public void updateBuffEffect(MapleCharacter target, List<Pair<MapleBuffStat, Int\n             target.announce(MaplePacketCreator.giveBuff((skill ? sourceid : -sourceid), (int) leftDuration, activeStats));\n         }\n     }\n-\n+    \n     private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, boolean primary) {\n         if (!isMonsterRiding() && !isCouponBuff() && !isMysticDoor() && !isHyperBody() && !isCombo()) {     // last mystic door already dispelled if it has been used before.\n             applyto.cancelEffect(this, true, -1);\n@@ -1208,7 +1315,7 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n         if (localstatups.size() > 0) {\n             byte[] buff = null;\n             byte[] mbuff = null;\n-            if (getSummonMovementType() == null) {\n+            if (getSummonMovementType() == null && this.isActive(applyto.getMapId())) {\n                 buff = MaplePacketCreator.giveBuff((skill ? sourceid : -sourceid), localDuration, localstatups);\n             }\n             if (isDash()) {\n@@ -1253,7 +1360,7 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n                 List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.MORPH, Integer.valueOf(getMorph(applyto))));\n                 mbuff = MaplePacketCreator.giveForeignBuff(applyto.getId(), stat);\n             } else if (isAriantShield()) {\n-                List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.ARIANT_PQ_SHIELD, 1));\n+                List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.AURA, 1));\n                 mbuff = MaplePacketCreator.giveForeignBuff(applyto.getId(), stat);\n             }\n \n@@ -1495,6 +1602,11 @@ public static boolean isExpIncrease(int sourceid) {\n     public static boolean isAriantShield(int sourceid) {\n         return sourceid == 2022269;\n     }\n+    \n+    public static boolean isMonsterCard(int sourceid) {\n+        int itemType = sourceid / 10000;\n+        return itemType == 238;\n+    }\n \n     private boolean isDs() {\n         return skill && (sourceid == Rogue.DARK_SIGHT || sourceid == NightWalker.DARK_SIGHT);"}, {"sha": "e1492fa3b7d50b107696d6dc92adbadcbc523186", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -475,7 +475,7 @@ public boolean isAttackedBy(MapleCharacter chr) {\n         return takenDamage.containsKey(chr.getId());\n     }\n     \n-    private void distributeExperienceToParty(int pid, float exp, int mostDamageCid, int minThresholdLevel, int killerLevel, Set<MapleCharacter> underleveled, Map<MapleCharacter, Float> partyExpReward) {\n+    private void distributeExperienceToParty(int pid, float exp, int mostDamageCid, int minThresholdLevel, int killerLevel, Set<MapleCharacter> underleveled, Map<MapleCharacter, Float> partyExpReward, Set<MapleCharacter> participants) {\n         MapleCharacter pchar = getMap().getAnyCharacterFromParty(pid);  // thanks G h o s t, Alfred, Vcoc, BHB for poiting out a bug in detecting party members after membership transactions in a party took place\n         \n         List<MapleCharacter> members;\n@@ -486,7 +486,7 @@ private void distributeExperienceToParty(int pid, float exp, int mostDamageCid,\n         }\n         \n         List<MapleCharacter> expSharers = new LinkedList<>();\n-        int expSharersMaxLevel = 1;\n+        int expParticipantsMaxLevel = 1;\n         boolean hasMostDamageCid = false;\n         for (MapleCharacter mc : members) {\n             if (mc.getId() == mostDamageCid) {\n@@ -497,8 +497,8 @@ private void distributeExperienceToParty(int pid, float exp, int mostDamageCid,\n                 if (Math.abs(killerLevel - mc.getLevel()) < ServerConstants.MIN_RANGELEVEL_TO_EXP_LEECH) {\n                     // thanks Thora for pointing out leech level limitation\n                     \n-                    if (expSharersMaxLevel < mc.getLevel()) {\n-                        expSharersMaxLevel = mc.getLevel();\n+                    if (expParticipantsMaxLevel < mc.getLevel() && participants.contains(mc)) {\n+                        expParticipantsMaxLevel = mc.getLevel();\n                     }\n                     expSharers.add(mc);\n                 }\n@@ -509,14 +509,16 @@ private void distributeExperienceToParty(int pid, float exp, int mostDamageCid,\n         \n         int numExpSharers = expSharers.size();\n         \n-        // PARTY BONUS: 2p -> +2% , 3p -> +4% , 4p -> +6% , 5p -> +8% , 6p -> +10%\n+        // PARTY BONUS: 2p -> +5% , 3p -> +6.25% , 4p -> +7.5% , 5p -> +8.75% , 6p -> +10%\n         // MOST DAMAGE BONUS: 1.5x bonus\n-        final float partyModifier = numExpSharers <= 1 ? 0.0f : 0.02f * (numExpSharers - 1);\n+        \n+        // thanks Crypter for reporting an insufficiency on party exp bonuses\n+        final float partyModifier = numExpSharers <= 1 ? 0.0f : 0.05f + (0.0125f * (numExpSharers - 1));\n         final float mostDamageModifier = hasMostDamageCid ? 1.5f : 1.0f;\n         final float partyExp = exp * partyModifier * mostDamageModifier;\n         \n         for (MapleCharacter mc : expSharers) {\n-            float levelPenaltyModifier = (float) Math.sqrt(((float) mc.getLevel()) / expSharersMaxLevel);\n+            float levelPenaltyModifier = (float) Math.min(1.0, Math.sqrt(((float) mc.getLevel()) / expParticipantsMaxLevel));\n             partyExpReward.put(mc, partyExp * levelPenaltyModifier);\n         }\n     }\n@@ -640,9 +642,10 @@ private void distributeExperience(int killerId) {\n             }\n         }\n         \n+        Set<MapleCharacter> participants = personalExpReward.keySet();\n         int mostDamageCid = this.getHighestDamagerId();\n         for (Entry<Integer, Float> party : partyExp.entrySet()) {\n-            distributeExperienceToParty(party.getKey(), party.getValue(), mostDamageCid, minThresholdLevel, killerLevel, underleveled, partyExpReward);\n+            distributeExperienceToParty(party.getKey(), party.getValue(), mostDamageCid, minThresholdLevel, killerLevel, underleveled, partyExpReward, participants);\n         }\n         \n         for(MapleCharacter mc : underleveled) {"}, {"sha": "f8e5a89f2cf4b08879fa4483500cb7473bd308bf", "filename": "src/server/maps/MapleHiredMerchant.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/maps/MapleHiredMerchant.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/maps/MapleHiredMerchant.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleHiredMerchant.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -239,6 +239,7 @@ public void takeItemBack(int slot, MapleCharacter chr) {\n     }\n     \n     private static boolean canBuy(MapleClient c, Item newItem) {\n+        System.out.println(newItem.getPet().getName());\n         return MapleInventoryManipulator.checkSpace(c, newItem.getItemId(), newItem.getQuantity(), newItem.getOwner()) && MapleInventoryManipulator.addFromDrop(c, newItem, false);\n     }\n     "}, {"sha": "50675f9d510efd1d2b3c3c72bd8b93d1387ac955", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -652,7 +652,8 @@ private byte dropItemsFromMonsterOnMap(List<MonsterDropEntry> dropEntry, Point p\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         \n         for (final MonsterDropEntry de : dropEntry) {\n-            int dropChance = (int) Math.min((float) de.chance * chRate, Integer.MAX_VALUE);\n+            float cardRate = chr.getCardRate(de.itemId);\n+            int dropChance = (int) Math.min((float) de.chance * chRate * cardRate, Integer.MAX_VALUE);\n             \n             if (Randomizer.nextInt(999999) < dropChance) {\n                 if (droptype == 3) {\n@@ -2481,7 +2482,9 @@ public void addPlayer(final MapleCharacter chr) {\n         } finally {\n             chrWLock.unlock();\n         }\n+        \n         chr.setMapId(mapid);\n+        chr.updateActiveEffects();\n         \n         if (chrSize == 1) {\n             if(!hasItemMonitor()) {\n@@ -3305,11 +3308,10 @@ public void movePlayer(MapleCharacter player, Point newPosition) {\n         player.setPosition(newPosition);\n         \n         try {\n-            Collection<MapleMapObject> visibleObjects = player.getVisibleMapObjects();\n-            MapleMapObject[] visibleObjectsNow = visibleObjects.toArray(new MapleMapObject[visibleObjects.size()]);\n+            MapleMapObject[] visibleObjects = player.getVisibleMapObjects();\n \n             Map<Integer, MapleMapObject> mapObjects = getCopyMapObjects();\n-            for (MapleMapObject mo : visibleObjectsNow) {\n+            for (MapleMapObject mo : visibleObjects) {\n                 if (mo != null) {\n                     if (mapObjects.get(mo.getObjectId()) == mo) {\n                         updateMapObjectVisibility(player, mo);"}, {"sha": "19ecefd217e4d42cb15f194a0fe541436828c067", "filename": "src/server/partyquest/MonsterCarnival.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/partyquest/MonsterCarnival.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/server/partyquest/MonsterCarnival.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/partyquest/MonsterCarnival.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -1,6 +1,5 @@\n package server.partyquest;\n \n-import java.util.List;\n import java.util.concurrent.ScheduledFuture;\n import client.MapleCharacter;\n import constants.LanguageConstants;\n@@ -10,9 +9,7 @@\n import net.server.world.MapleParty;\n import net.server.world.MaplePartyCharacter;\n import server.TimerManager;\n-import server.life.MapleMonster;\n import server.maps.MapleMap;\n-import server.maps.MapleMapObject;\n import server.maps.MapleReactor;\n import tools.MaplePacketCreator;\n "}, {"sha": "a04f087288b235fee616554b5e08ab675d5119d8", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 45, "deletions": 30, "changes": 75, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -1853,36 +1853,7 @@ private static void encodeParentlessMobSpawnEffect(MaplePacketLittleEndianWriter\n \t\treturn mplew.getPacket();\n \t}\n         \n-        /**\n-         * Gets a packet spawning a player as a mapobject to other clients.\n-         *\n-         * @param target The client receiving this packet.\n-         * @param chr The character to spawn to other clients.\n-         * @param enteringField Whether the character to spawn is not yet present in the map or already is.\n-         * @return The spawn player packet.\n-         */\n-        public static byte[] spawnPlayerMapObject(MapleClient target, MapleCharacter chr, boolean enteringField) {\n-                final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n-                mplew.writeShort(SendOpcode.SPAWN_PLAYER.getValue());\n-                mplew.writeInt(chr.getId());\n-                mplew.write(chr.getLevel()); //v83\n-                mplew.writeMapleAsciiString(chr.getName());\n-                if (chr.getGuildId() < 1) {\n-                        mplew.writeMapleAsciiString(\"\");\n-                        mplew.write(new byte[6]);\n-                } else {\n-                        MapleGuildSummary gs = chr.getClient().getWorldServer().getGuildSummary(chr.getGuildId(), chr.getWorld());\n-                        if (gs != null) {\n-                                mplew.writeMapleAsciiString(gs.getName());\n-                                mplew.writeShort(gs.getLogoBG());\n-                                mplew.write(gs.getLogoBGColor());\n-                                mplew.writeShort(gs.getLogo());\n-                                mplew.write(gs.getLogoColor());\n-                        } else {\n-                                mplew.writeMapleAsciiString(\"\");\n-                                mplew.write(new byte[6]);\n-                        }\n-                }\n+        private static void writeForeignBuffs(MaplePacketLittleEndianWriter mplew, MapleCharacter chr) {\n                 mplew.writeInt(0);\n                 mplew.writeShort(0); //v83\n                 mplew.write(0xFC);\n@@ -1962,6 +1933,40 @@ private static void encodeParentlessMobSpawnEffect(MaplePacketLittleEndianWriter\n                 mplew.writeInt(CHAR_MAGIC_SPAWN);\n                 mplew.writeShort(0);\n                 mplew.write(0);\n+        }\n+        \n+        /**\n+         * Gets a packet spawning a player as a mapobject to other clients.\n+         *\n+         * @param target The client receiving this packet.\n+         * @param chr The character to spawn to other clients.\n+         * @param enteringField Whether the character to spawn is not yet present in the map or already is.\n+         * @return The spawn player packet.\n+         */\n+        public static byte[] spawnPlayerMapObject(MapleClient target, MapleCharacter chr, boolean enteringField) {\n+                final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n+                mplew.writeShort(SendOpcode.SPAWN_PLAYER.getValue());\n+                mplew.writeInt(chr.getId());\n+                mplew.write(chr.getLevel()); //v83\n+                mplew.writeMapleAsciiString(chr.getName());\n+                if (chr.getGuildId() < 1) {\n+                        mplew.writeMapleAsciiString(\"\");\n+                        mplew.write(new byte[6]);\n+                } else {\n+                        MapleGuildSummary gs = chr.getClient().getWorldServer().getGuildSummary(chr.getGuildId(), chr.getWorld());\n+                        if (gs != null) {\n+                                mplew.writeMapleAsciiString(gs.getName());\n+                                mplew.writeShort(gs.getLogoBG());\n+                                mplew.write(gs.getLogoBGColor());\n+                                mplew.writeShort(gs.getLogo());\n+                                mplew.write(gs.getLogoColor());\n+                        } else {\n+                                mplew.writeMapleAsciiString(\"\");\n+                                mplew.write(new byte[6]);\n+                        }\n+                }\n+                \n+                writeForeignBuffs(mplew, chr);\n                 \n                 mplew.writeShort(chr.getJob().getId());\n                 \n@@ -3807,6 +3812,16 @@ private static void writeLongMaskChair(final MaplePacketLittleEndianWriter mplew\n                 mplew.write(0);\n                 return mplew.getPacket();\n         }\n+        \n+        public static byte[] partySearchInvite(MapleCharacter from) {\n+                final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n+                mplew.writeShort(SendOpcode.PARTY_OPERATION.getValue());\n+                mplew.write(4);\n+                mplew.writeInt(from.getParty().getId());\n+                mplew.writeMapleAsciiString(\"PS: \" + from.getName());\n+                mplew.write(0);\n+                return mplew.getPacket();\n+        }\n \n         /**\n          * 10: A beginner can't create a party. 1/5/6/11/14/19: Your request for a"}, {"sha": "11bf1501b7329176bbbf90c9352844a45d42fb12", "filename": "tools/MapleMesoFetcher/dist/MapleMesoFetcher.jar", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleMesoFetcher/dist/MapleMesoFetcher.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleMesoFetcher/dist/MapleMesoFetcher.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleMesoFetcher/dist/MapleMesoFetcher.jar?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a"}, {"sha": "d8592441fcfef084d917496d4904233a191a59b0", "filename": "tools/MapleSkillbookChanceFetcher/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/build.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleSkillbookChanceFetcher\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleSkillbookChanceFetcher.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleSkillbookChanceFetcher-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "41b45f95223ef5827281f3191a5d4a85871cde34", "filename": "tools/MapleSkillbookChanceFetcher/lib/meso_drop_data.sql", "status": "added", "additions": 447, "deletions": 0, "changes": 447, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/meso_drop_data.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/meso_drop_data.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/lib/meso_drop_data.sql?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,447 @@\n+ # SQL File autogenerated from the MapleMesoFetcher feature by Ronan Lana.\n+ # Generated data takes into account mob stats such as level and boss for the meso ranges.\n+ # Only mobs with 4 or more items with no meso entry on the DB it was compiled are presented here.\n+\n+  INSERT IGNORE INTO drop_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n+(100122, 0, 35, 52, 0, 400000),\n+(100123, 0, 38, 55, 0, 400000),\n+(100124, 0, 40, 59, 0, 400000),\n+(100130, 0, 31, 45, 0, 400000),\n+(100131, 0, 33, 49, 0, 400000),\n+(100132, 0, 35, 52, 0, 400000),\n+(100133, 0, 38, 55, 0, 400000),\n+(100134, 0, 40, 59, 0, 400000),\n+(1110130, 0, 49, 72, 0, 400000),\n+(1140130, 0, 56, 83, 0, 400000),\n+(2100100, 0, 58, 85, 0, 400000),\n+(2100101, 0, 60, 88, 0, 400000),\n+(2100106, 0, 66, 97, 0, 400000),\n+(2100107, 0, 73, 108, 0, 400000),\n+(2100108, 0, 78, 115, 0, 400000),\n+(2110300, 0, 66, 97, 0, 400000),\n+(2110301, 0, 78, 115, 0, 400000),\n+(2230105, 0, 64, 94, 0, 400000),\n+(2230107, 0, 66, 97, 0, 400000),\n+(2230110, 0, 64, 94, 0, 400000),\n+(2230111, 0, 66, 97, 0, 400000),\n+(2230131, 0, 66, 97, 0, 400000),\n+(3000005, 0, 81, 119, 0, 400000),\n+(3100101, 0, 86, 127, 0, 400000),\n+(3100102, 0, 81, 119, 0, 400000),\n+(3110301, 0, 86, 127, 0, 400000),\n+(3110302, 0, 95, 140, 0, 400000),\n+(3110303, 0, 105, 155, 0, 400000),\n+(3220000, 0, 285, 1400, 0, 400000),\n+(3220001, 0, 315, 1550, 0, 400000),\n+(3300000, 0, 81, 119, 0, 400000),\n+(3300001, 0, 81, 119, 0, 400000),\n+(3300002, 0, 83, 123, 0, 400000),\n+(3300003, 0, 86, 127, 0, 400000),\n+(3300004, 0, 89, 131, 0, 400000),\n+(3300005, 0, 95, 140, 0, 400000),\n+(3300006, 0, 95, 140, 0, 400000),\n+(3300007, 0, 95, 140, 0, 400000),\n+(3300008, 0, 315, 1550, 0, 400000),\n+(4110300, 0, 120, 177, 0, 400000),\n+(4110301, 0, 132, 195, 0, 400000),\n+(4130103, 0, 423, 2080, 0, 400000),\n+(4220000, 0, 396, 1950, 0, 400000),\n+(4230122, 0, 120, 177, 0, 400000),\n+(4230125, 0, 128, 189, 0, 400000),\n+(4230400, 0, 132, 195, 0, 400000),\n+(4230502, 0, 124, 182, 0, 400000),\n+(4230503, 0, 132, 195, 0, 400000),\n+(4230504, 0, 132, 195, 0, 400000),\n+(4230600, 0, 112, 165, 0, 400000),\n+(4240000, 0, 151, 222, 0, 400000),\n+(4250000, 0, 120, 177, 0, 400000),\n+(4250001, 0, 137, 201, 0, 400000),\n+(5110300, 0, 156, 230, 0, 400000),\n+(5120500, 0, 190, 280, 0, 400000),\n+(5120501, 0, 172, 254, 0, 400000),\n+(5120502, 0, 178, 262, 0, 400000),\n+(5120505, 0, 203, 299, 0, 400000),\n+(5120506, 0, 184, 271, 0, 400000),\n+(5130105, 0, 190, 280, 0, 400000),\n+(5130108, 0, 196, 289, 0, 400000),\n+(5220000, 0, 552, 2710, 0, 400000),\n+(5220002, 0, 468, 2300, 0, 400000),\n+(5220003, 0, 630, 3090, 0, 400000),\n+(5220004, 0, 468, 2300, 0, 400000),\n+(5250000, 0, 184, 271, 0, 400000),\n+(5250001, 0, 161, 237, 0, 400000),\n+(5250002, 0, 196, 289, 0, 400000),\n+(6110300, 0, 255, 377, 0, 400000),\n+(6130102, 0, 217, 320, 0, 400000),\n+(6130103, 0, 217, 320, 0, 400000),\n+(6130203, 0, 217, 320, 0, 400000),\n+(6130207, 0, 231, 341, 0, 400000),\n+(6130209, 0, 264, 389, 0, 400000),\n+(6220000, 0, 765, 3770, 0, 400000),\n+(6220001, 0, 765, 3770, 0, 400000),\n+(6230100, 0, 231, 341, 0, 400000),\n+(6230401, 0, 239, 353, 0, 400000),\n+(6300005, 0, 765, 3770, 0, 400000),\n+(6400006, 0, 384, 1890, 0, 400000),\n+(6400008, 0, 552, 2710, 0, 400000),\n+(6400009, 0, 552, 2710, 0, 400000),\n+(7110300, 0, 355, 524, 0, 400000),\n+(7110301, 0, 332, 490, 0, 400000),\n+(7120103, 0, 301, 444, 0, 400000),\n+(7120104, 0, 311, 459, 0, 400000),\n+(7120106, 0, 355, 524, 0, 400000),\n+(7120107, 0, 355, 524, 0, 400000),\n+(7120108, 0, 379, 559, 0, 400000),\n+(7120109, 0, 405, 597, 0, 400000),\n+(7130000, 0, 332, 490, 0, 400000),\n+(7130002, 0, 321, 474, 0, 400000),\n+(7130003, 0, 367, 541, 0, 400000),\n+(7130004, 0, 391, 578, 0, 400000),\n+(7130102, 0, 391, 578, 0, 400000),\n+(7130103, 0, 332, 490, 0, 400000),\n+(7130400, 0, 903, 4440, 0, 400000),\n+(7130401, 0, 903, 4440, 0, 400000),\n+(7130402, 0, 903, 4440, 0, 400000),\n+(7130601, 0, 367, 541, 0, 400000),\n+(7220000, 0, 933, 4590, 0, 400000),\n+(7220001, 0, 903, 4440, 0, 400000),\n+(7220002, 0, 1137, 5590, 0, 400000),\n+(8110300, 0, 418, 617, 0, 400000),\n+(8120102, 0, 446, 659, 0, 400000),\n+(8120103, 0, 477, 704, 0, 400000),\n+(8120104, 0, 509, 752, 0, 400000),\n+(8120105, 0, 544, 803, 0, 400000),\n+(8120106, 0, 562, 830, 0, 400000),\n+(8120107, 0, 562, 830, 0, 400000),\n+(8140000, 0, 418, 617, 0, 400000),\n+(8140100, 0, 446, 659, 0, 400000),\n+(8140511, 0, 581, 871, 0, 400000),\n+(8140512, 0, 608, 908, 0, 400000),\n+(8140600, 0, 594, 889, 0, 400000),\n+(8140702, 0, 637, 946, 0, 400000),\n+(8140703, 0, 666, 986, 0, 400000),\n+(8141300, 0, 622, 927, 0, 400000),\n+(8150000, 0, 2142, 10490, 0, 400000),\n+(8150100, 0, 714, 1049, 0, 400000),\n+(8150101, 0, 747, 1093, 0, 400000),\n+(8150200, 0, 714, 1049, 0, 400000),\n+(8150201, 0, 800, 1162, 0, 400000),\n+(8150300, 0, 666, 986, 0, 400000),\n+(8150301, 0, 730, 1070, 0, 400000),\n+(8150302, 0, 764, 1115, 0, 400000),\n+(8190001, 0, 800, 1162, 0, 400000),\n+(8220003, 0, 3381, 15830, 0, 400000),\n+(8220005, 0, 4350, 19860, 0, 400000),\n+(8220006, 0, 5466, 24400, 0, 400000),\n+(8220007, 0, 1704, 8530, 0, 400000),\n+(8220009, 0, 1479, 7280, 0, 400000),\n+(8830000, 0, 2400, 11620, 0, 400000),\n+(9001009, 0, 1254, 6170, 0, 400000),\n+(9001011, 0, 95, 140, 0, 400000),\n+(9200016, 0, 81, 119, 0, 400000),\n+(9200019, 0, 203, 299, 0, 400000),\n+(9300011, 0, 109, 160, 0, 400000),\n+(9300058, 0, 38, 55, 0, 400000),\n+(9300059, 0, 42, 61, 0, 400000),\n+(9300060, 0, 120, 177, 0, 400000),\n+(9300078, 0, 800, 1162, 0, 400000),\n+(9300080, 0, 282, 416, 0, 400000),\n+(9300096, 0, 544, 803, 0, 400000),\n+(9300105, 0, 717, 3530, 0, 400000),\n+(9300106, 0, 846, 4160, 0, 400000),\n+(9300127, 0, 81, 119, 0, 400000),\n+(9300129, 0, 81, 119, 0, 400000),\n+(9300131, 0, 109, 160, 0, 400000),\n+(9300132, 0, 81, 119, 0, 400000),\n+(9300133, 0, 81, 119, 0, 400000),\n+(9300134, 0, 81, 119, 0, 400000),\n+(9300136, 0, 243, 1190, 0, 400000),\n+(9300139, 0, 1296, 6380, 0, 400000),\n+(9300155, 0, 38, 55, 0, 400000),\n+(9300160, 0, 396, 1950, 0, 400000),\n+(9300161, 0, 396, 1950, 0, 400000),\n+(9300163, 0, 1127, 1583, 0, 400000),\n+(9300164, 0, 1127, 1583, 0, 400000),\n+(9300165, 0, 1127, 1583, 0, 400000),\n+(9300182, 0, 1479, 7280, 0, 400000),\n+(9300184, 0, 174, 850, 0, 400000),\n+(9300185, 0, 285, 1400, 0, 400000),\n+(9300186, 0, 315, 1550, 0, 400000),\n+(9300187, 0, 336, 1650, 0, 400000),\n+(9300188, 0, 468, 2300, 0, 400000),\n+(9300189, 0, 468, 2300, 0, 400000),\n+(9300190, 0, 552, 2710, 0, 400000),\n+(9300191, 0, 651, 3200, 0, 400000),\n+(9300192, 0, 570, 2800, 0, 400000),\n+(9300193, 0, 630, 3090, 0, 400000),\n+(9300194, 0, 765, 3770, 0, 400000),\n+(9300195, 0, 765, 3770, 0, 400000),\n+(9300196, 0, 765, 3770, 0, 400000),\n+(9300197, 0, 765, 3770, 0, 400000),\n+(9300198, 0, 651, 3200, 0, 400000),\n+(9300199, 0, 903, 4440, 0, 400000),\n+(9300200, 0, 933, 4590, 0, 400000),\n+(9300201, 0, 1479, 7280, 0, 400000),\n+(9300202, 0, 1137, 5590, 0, 400000),\n+(9300203, 0, 1254, 6170, 0, 400000),\n+(9300204, 0, 1383, 6810, 0, 400000),\n+(9300205, 0, 1296, 6380, 0, 400000),\n+(9300206, 0, 1479, 7280, 0, 400000),\n+(9300207, 0, 1479, 7280, 0, 400000),\n+(9300208, 0, 1704, 8530, 0, 400000),\n+(9300209, 0, 1704, 8530, 0, 400000),\n+(9300210, 0, 2142, 10490, 0, 400000),\n+(9300211, 0, 2400, 11620, 0, 400000),\n+(9300212, 0, 2400, 11620, 0, 400000),\n+(9300213, 0, 3381, 15830, 0, 400000),\n+(9300214, 0, 3792, 17550, 0, 400000),\n+(9300215, 0, 6714, 29370, 0, 400000),\n+(9300217, 0, 32, 47, 0, 400000),\n+(9300218, 0, 34, 50, 0, 400000),\n+(9300219, 0, 34, 50, 0, 400000),\n+(9300220, 0, 52, 77, 0, 400000),\n+(9300221, 0, 68, 101, 0, 400000),\n+(9300222, 0, 75, 111, 0, 400000),\n+(9300223, 0, 36, 54, 0, 400000),\n+(9300224, 0, 102, 150, 0, 400000),\n+(9300225, 0, 102, 150, 0, 400000),\n+(9300226, 0, 112, 165, 0, 400000),\n+(9300227, 0, 102, 150, 0, 400000),\n+(9300228, 0, 146, 215, 0, 400000),\n+(9300229, 0, 39, 57, 0, 400000),\n+(9300230, 0, 116, 171, 0, 400000),\n+(9300231, 0, 137, 201, 0, 400000),\n+(9300232, 0, 92, 136, 0, 400000),\n+(9300233, 0, 112, 165, 0, 400000),\n+(9300234, 0, 86, 127, 0, 400000),\n+(9300235, 0, 167, 245, 0, 400000),\n+(9300236, 0, 190, 280, 0, 400000),\n+(9300237, 0, 210, 309, 0, 400000),\n+(9300238, 0, 66, 97, 0, 400000),\n+(9300239, 0, 120, 177, 0, 400000),\n+(9300240, 0, 132, 195, 0, 400000),\n+(9300241, 0, 282, 416, 0, 400000),\n+(9300242, 0, 301, 444, 0, 400000),\n+(9300243, 0, 190, 280, 0, 400000),\n+(9300244, 0, 190, 280, 0, 400000),\n+(9300245, 0, 217, 320, 0, 400000),\n+(9300246, 0, 231, 341, 0, 400000),\n+(9300247, 0, 255, 377, 0, 400000),\n+(9300248, 0, 264, 389, 0, 400000),\n+(9300249, 0, 301, 444, 0, 400000),\n+(9300250, 0, 355, 524, 0, 400000),\n+(9300251, 0, 332, 490, 0, 400000),\n+(9300252, 0, 132, 195, 0, 400000),\n+(9300253, 0, 156, 230, 0, 400000),\n+(9300254, 0, 332, 490, 0, 400000),\n+(9300255, 0, 141, 208, 0, 400000),\n+(9300256, 0, 217, 320, 0, 400000),\n+(9300257, 0, 217, 320, 0, 400000),\n+(9300258, 0, 255, 377, 0, 400000),\n+(9300259, 0, 58, 85, 0, 400000),\n+(9300260, 0, 418, 617, 0, 400000),\n+(9300261, 0, 544, 803, 0, 400000),\n+(9300262, 0, 544, 803, 0, 400000),\n+(9300263, 0, 544, 803, 0, 400000),\n+(9300264, 0, 764, 1115, 0, 400000),\n+(9300265, 0, 730, 1070, 0, 400000),\n+(9300266, 0, 933, 4590, 0, 400000),\n+(9300267, 0, 1254, 6170, 0, 400000),\n+(9300268, 0, 933, 4590, 0, 400000),\n+(9300269, 0, 174, 850, 0, 400000),\n+(9300270, 0, 418, 617, 0, 400000),\n+(9300274, 0, 39, 57, 0, 400000),\n+(9300289, 0, 1704, 8530, 0, 400000),\n+(9300294, 0, 2142, 10490, 0, 400000),\n+(9300315, 0, 483, 2370, 0, 400000),\n+(9300316, 0, 516, 2540, 0, 400000),\n+(9300317, 0, 552, 2710, 0, 400000),\n+(9300318, 0, 588, 2890, 0, 400000),\n+(9300319, 0, 630, 3090, 0, 400000),\n+(9300320, 0, 672, 3300, 0, 400000),\n+(9300321, 0, 717, 3530, 0, 400000),\n+(9300322, 0, 765, 3770, 0, 400000),\n+(9300332, 0, 112, 165, 0, 400000),\n+(9300334, 0, 151, 222, 0, 400000),\n+(9300335, 0, 116, 171, 0, 400000),\n+(9300336, 0, 137, 201, 0, 400000),\n+(9300337, 0, 137, 201, 0, 400000),\n+(9300367, 0, 126, 610, 0, 400000),\n+(9300368, 0, 174, 850, 0, 400000),\n+(9300369, 0, 243, 1190, 0, 400000),\n+(9300370, 0, 336, 1650, 0, 400000),\n+(9300371, 0, 468, 2300, 0, 400000),\n+(9300372, 0, 651, 3200, 0, 400000),\n+(9300373, 0, 903, 4440, 0, 400000),\n+(9300374, 0, 1254, 6170, 0, 400000),\n+(9300375, 0, 1704, 8530, 0, 400000),\n+(9300376, 0, 1704, 8530, 0, 400000),\n+(9300377, 0, 2691, 12890, 0, 400000),\n+(9303000, 0, 42, 61, 0, 400000),\n+(9303001, 0, 42, 61, 0, 400000),\n+(9303003, 0, 42, 61, 0, 400000),\n+(9303004, 0, 42, 61, 0, 400000),\n+(9303005, 0, 71, 104, 0, 400000),\n+(9303006, 0, 71, 104, 0, 400000),\n+(9303007, 0, 71, 104, 0, 400000),\n+(9303008, 0, 71, 104, 0, 400000),\n+(9303009, 0, 161, 237, 0, 400000),\n+(9303010, 0, 161, 237, 0, 400000),\n+(9303011, 0, 161, 237, 0, 400000),\n+(9303013, 0, 432, 638, 0, 400000),\n+(9303014, 0, 432, 638, 0, 400000),\n+(9303016, 0, 432, 638, 0, 400000),\n+(9400009, 0, 7014, 8225, 0, 400000),\n+(9400012, 0, 217, 320, 0, 400000),\n+(9400120, 0, 1911, 9460, 0, 400000),\n+(9400122, 0, 1911, 9460, 0, 400000),\n+(9400200, 0, 184, 271, 0, 400000),\n+(9400203, 0, 112, 165, 0, 400000),\n+(9400205, 0, 1704, 8530, 0, 400000),\n+(9400238, 0, 81, 119, 0, 400000),\n+(9400239, 0, 66, 97, 0, 400000),\n+(9400241, 0, 38, 55, 0, 400000),\n+(9400242, 0, 42, 61, 0, 400000),\n+(9400243, 0, 184, 271, 0, 400000),\n+(9400244, 0, 210, 309, 0, 400000),\n+(9400245, 0, 66, 97, 0, 400000),\n+(9400246, 0, 62, 91, 0, 400000),\n+(9400247, 0, 81, 119, 0, 400000),\n+(9400248, 0, 66, 97, 0, 400000),\n+(9400500, 0, 93, 450, 0, 400000),\n+(9400501, 0, 35, 52, 0, 400000),\n+(9400502, 0, 105, 520, 0, 400000),\n+(9400503, 0, 105, 520, 0, 400000),\n+(9400504, 0, 31, 45, 0, 400000),\n+(9400538, 0, 56, 83, 0, 400000),\n+(9400539, 0, 60, 88, 0, 400000),\n+(9400540, 0, 68, 101, 0, 400000),\n+(9400541, 0, 68, 101, 0, 400000),\n+(9400542, 0, 98, 145, 0, 400000),\n+(9400543, 0, 116, 171, 0, 400000),\n+(9400544, 0, 156, 230, 0, 400000),\n+(9400546, 0, 128, 189, 0, 400000),\n+(9400547, 0, 73, 108, 0, 400000),\n+(9400548, 0, 81, 119, 0, 400000),\n+(9400550, 0, 73, 108, 0, 400000),\n+(9400556, 0, 60, 88, 0, 400000),\n+(9400558, 0, 81, 119, 0, 400000),\n+(9400560, 0, 156, 230, 0, 400000),\n+(9400561, 0, 217, 320, 0, 400000),\n+(9400562, 0, 217, 320, 0, 400000),\n+(9400563, 0, 112, 165, 0, 400000),\n+(9400565, 0, 60, 88, 0, 400000),\n+(9400570, 0, 49, 72, 0, 400000),\n+(9400571, 0, 468, 2300, 0, 400000),\n+(9400573, 0, 112, 165, 0, 400000),\n+(9400574, 0, 714, 1049, 0, 400000),\n+(9400576, 0, 301, 444, 0, 400000),\n+(9400578, 0, 568, 853, 0, 400000),\n+(9400579, 0, 714, 1049, 0, 400000),\n+(9400580, 0, 637, 946, 0, 400000),\n+(9400581, 0, 418, 617, 0, 400000),\n+(9400582, 0, 1127, 1583, 0, 400000),\n+(9400609, 0, 204, 1010, 0, 400000),\n+(9400612, 0, 204, 1010, 0, 400000),\n+(9400633, 0, 258, 1270, 0, 400000),\n+(9400644, 0, 42, 61, 0, 400000),\n+(9410014, 0, 493, 728, 0, 400000),\n+(9410015, 0, 1479, 7280, 0, 400000),\n+(9420507, 0, 146, 215, 0, 400000),\n+(9420527, 0, 132, 195, 0, 400000),\n+(9420528, 0, 141, 208, 0, 400000),\n+(9420529, 0, 167, 245, 0, 400000),\n+(9420530, 0, 190, 280, 0, 400000),\n+(9420531, 0, 210, 309, 0, 400000),\n+(9420532, 0, 210, 309, 0, 400000),\n+(9420533, 0, 224, 330, 0, 400000),\n+(9420534, 0, 255, 377, 0, 400000),\n+(9420535, 0, 282, 416, 0, 400000),\n+(9420536, 0, 321, 474, 0, 400000),\n+(9420537, 0, 355, 524, 0, 400000),\n+(9420538, 0, 446, 659, 0, 400000),\n+(9420539, 0, 526, 777, 0, 400000),\n+(9420545, 0, 210, 309, 0, 400000),\n+(9420550, 0, 210, 309, 0, 400000),\n+(9500101, 0, 38, 55, 0, 400000),\n+(9500102, 0, 39, 57, 0, 400000),\n+(9500103, 0, 49, 72, 0, 400000),\n+(9500104, 0, 44, 65, 0, 400000),\n+(9500105, 0, 49, 72, 0, 400000),\n+(9500106, 0, 62, 91, 0, 400000),\n+(9500107, 0, 81, 119, 0, 400000),\n+(9500108, 0, 86, 127, 0, 400000),\n+(9500109, 0, 86, 127, 0, 400000),\n+(9500110, 0, 95, 140, 0, 400000),\n+(9500111, 0, 95, 140, 0, 400000),\n+(9500112, 0, 95, 140, 0, 400000),\n+(9500113, 0, 98, 145, 0, 400000),\n+(9500115, 0, 102, 150, 0, 400000),\n+(9500116, 0, 112, 165, 0, 400000),\n+(9500117, 0, 98, 145, 0, 400000),\n+(9500118, 0, 109, 160, 0, 400000),\n+(9500119, 0, 109, 160, 0, 400000),\n+(9500120, 0, 132, 195, 0, 400000),\n+(9500121, 0, 146, 215, 0, 400000),\n+(9500122, 0, 151, 222, 0, 400000),\n+(9500123, 0, 210, 309, 0, 400000),\n+(9500124, 0, 651, 3200, 0, 400000),\n+(9500125, 0, 217, 320, 0, 400000),\n+(9500126, 0, 247, 365, 0, 400000),\n+(9500127, 0, 273, 402, 0, 400000),\n+(9500128, 0, 282, 416, 0, 400000),\n+(9500129, 0, 301, 444, 0, 400000),\n+(9500130, 0, 903, 4440, 0, 400000),\n+(9500131, 0, 332, 490, 0, 400000),\n+(9500132, 0, 355, 524, 0, 400000),\n+(9500134, 0, 418, 617, 0, 400000),\n+(9500135, 0, 493, 728, 0, 400000),\n+(9500136, 0, 682, 1006, 0, 400000),\n+(9500137, 0, 637, 946, 0, 400000),\n+(9500138, 0, 568, 853, 0, 400000),\n+(9500139, 0, 1254, 6170, 0, 400000),\n+(9500140, 0, 2142, 10490, 0, 400000),\n+(9500156, 0, 146, 215, 0, 400000),\n+(9500157, 0, 95, 140, 0, 400000),\n+(9500158, 0, 903, 4440, 0, 400000),\n+(9500159, 0, 903, 4440, 0, 400000),\n+(9500160, 0, 903, 4440, 0, 400000),\n+(9500161, 0, 418, 617, 0, 400000),\n+(9500162, 0, 418, 617, 0, 400000),\n+(9500163, 0, 461, 681, 0, 400000),\n+(9500164, 0, 544, 803, 0, 400000),\n+(9500165, 0, 544, 803, 0, 400000),\n+(9500166, 0, 544, 803, 0, 400000),\n+(9500178, 0, 112, 165, 0, 400000),\n+(9500180, 0, 1704, 8530, 0, 400000),\n+(9500181, 0, 1704, 8530, 0, 400000),\n+(9500306, 0, 174, 850, 0, 400000),\n+(9500307, 0, 285, 1400, 0, 400000),\n+(9500308, 0, 468, 2300, 0, 400000),\n+(9500309, 0, 552, 2710, 0, 400000),\n+(9500310, 0, 630, 3090, 0, 400000),\n+(9500311, 0, 765, 3770, 0, 400000),\n+(9500312, 0, 903, 4440, 0, 400000),\n+(9500313, 0, 933, 4590, 0, 400000),\n+(9500314, 0, 1137, 5590, 0, 400000),\n+(9500317, 0, 126, 610, 0, 400000),\n+(9500318, 0, 336, 1650, 0, 400000),\n+(9500319, 0, 903, 4440, 0, 400000),\n+(9500321, 0, 42, 61, 0, 400000),\n+(9500326, 0, 396, 1950, 0, 400000),\n+(9500327, 0, 243, 1190, 0, 400000),\n+(9500328, 0, 285, 1400, 0, 400000),\n+(9500331, 0, 552, 2710, 0, 400000),\n+(9500332, 0, 396, 1950, 0, 400000),\n+(9500333, 0, 468, 2300, 0, 400000),\n+(9500334, 0, 552, 2710, 0, 400000),\n+(9500335, 0, 468, 2300, 0, 400000),\n+(9500366, 0, 49, 72, 0, 400000),\n+(9500367, 0, 49, 72, 0, 400000),\n+(9500368, 0, 49, 72, 0, 400000),\n+(9500369, 0, 49, 72, 0, 400000),\n+(9500370, 0, 49, 72, 0, 400000),\n+(9500371, 0, 49, 72, 0, 400000),\n+(9500372, 0, 49, 72, 0, 400000);\n+\n+  DELETE FROM drop_data WHERE dropperid >= 9300184 AND dropperid <= 9300215 AND itemid = 0;"}, {"sha": "0539039f716034c4896c8eaa81c075c7fa3bc997", "filename": "tools/MapleSkillbookChanceFetcher/lib/mysql-connector-java-bin.jar", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/mysql-connector-java-bin.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/mysql-connector-java-bin.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/lib/mysql-connector-java-bin.jar?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a"}, {"sha": "8dc97ded6574edaa2c90e45dd7b739287dc169a1", "filename": "tools/MapleSkillbookChanceFetcher/lib/skillbook_drop_data.sql", "status": "added", "additions": 619, "deletions": 0, "changes": 619, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/skillbook_drop_data.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/lib/skillbook_drop_data.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/lib/skillbook_drop_data.sql?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,619 @@\n+ # SQL File autogenerated from the MapleSkillbookChanceFetcher feature by Ronan Lana.\n+ # Generated data takes into account mob stats such as level and boss for the chance rates.\n+\n+  REPLACE INTO drop_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n+(851000, 2290132, 1, 1, 0, 3861),\n+(7090000, 2290087, 1, 1, 0, 40000),\n+(8090000, 2290045, 1, 1, 0, 40000),\n+(8140103, 2290044, 1, 1, 0, 2000),\n+(8140511, 2290009, 1, 1, 0, 2000),\n+(8140511, 2290050, 1, 1, 0, 2000),\n+(8140511, 2290083, 1, 1, 0, 2000),\n+(8140511, 2290134, 1, 1, 0, 6000),\n+(8140512, 2290013, 1, 1, 0, 2000),\n+(8140512, 2290067, 1, 1, 0, 2000),\n+(8140512, 2290082, 1, 1, 0, 2000),\n+(8140512, 2290097, 1, 1, 0, 2000),\n+(8140512, 2290116, 1, 1, 0, 2000),\n+(8140512, 2290131, 1, 1, 0, 6000),\n+(8140600, 2290132, 1, 1, 0, 6000),\n+(8140700, 2290106, 1, 1, 0, 2000),\n+(8140700, 2290126, 1, 1, 0, 6000),\n+(8140701, 2290122, 1, 1, 0, 2000),\n+(8140702, 2290112, 1, 1, 0, 2000),\n+(8140703, 2290088, 1, 1, 0, 2000),\n+(8140703, 2290099, 1, 1, 0, 2000),\n+(8141000, 2290082, 1, 1, 0, 2000),\n+(8141000, 2290097, 1, 1, 0, 2000),\n+(8141100, 2280005, 1, 1, 0, 2000),\n+(8141300, 2290098, 1, 1, 0, 2000),\n+(8142100, 2290032, 1, 1, 0, 2000),\n+(8142100, 2290082, 1, 1, 0, 2000),\n+(8142100, 2290114, 1, 1, 0, 2000),\n+(8143000, 2280004, 1, 1, 0, 2000),\n+(8150000, 2280013, 1, 1, 0, 120000),\n+(8150000, 2290070, 1, 1, 0, 40000),\n+(8150000, 2290091, 1, 1, 0, 40000),\n+(8150100, 2290042, 1, 1, 0, 2000),\n+(8150100, 2290053, 1, 1, 0, 2000),\n+(8150100, 2290073, 1, 1, 0, 2000),\n+(8150100, 2290102, 1, 1, 0, 2000),\n+(8150100, 2290118, 1, 1, 0, 2000),\n+(8150101, 2290017, 1, 1, 0, 2000),\n+(8150101, 2290021, 1, 1, 0, 2000),\n+(8150101, 2290035, 1, 1, 0, 2000),\n+(8150101, 2290042, 1, 1, 0, 2000),\n+(8150101, 2290052, 1, 1, 0, 2000),\n+(8150101, 2290102, 1, 1, 0, 2000),\n+(8150200, 2290024, 1, 1, 0, 2000),\n+(8150200, 2290100, 1, 1, 0, 2000),\n+(8150200, 2290135, 1, 1, 0, 6000),\n+(8150201, 2290004, 1, 1, 0, 2000),\n+(8150201, 2290006, 1, 1, 0, 2000),\n+(8150201, 2290024, 1, 1, 0, 2000),\n+(8150201, 2290036, 1, 1, 0, 2000),\n+(8150201, 2290056, 1, 1, 0, 2000),\n+(8150201, 2290072, 1, 1, 0, 2000),\n+(8150201, 2290078, 1, 1, 0, 2000),\n+(8150201, 2290117, 1, 1, 0, 2000),\n+(8150300, 2290003, 1, 1, 0, 2000),\n+(8150300, 2290033, 1, 1, 0, 2000),\n+(8150300, 2290111, 1, 1, 0, 2000),\n+(8150300, 2290120, 1, 1, 0, 2000),\n+(8150300, 2290127, 1, 1, 0, 6000),\n+(8150301, 2290023, 1, 1, 0, 2000),\n+(8150301, 2290029, 1, 1, 0, 2000),\n+(8150301, 2290101, 1, 1, 0, 2000),\n+(8150301, 2290107, 1, 1, 0, 2000),\n+(8150302, 2290010, 1, 1, 0, 2000),\n+(8150302, 2290019, 1, 1, 0, 2000),\n+(8150302, 2290026, 1, 1, 0, 2000),\n+(8150302, 2290076, 1, 1, 0, 2000),\n+(8150302, 2290085, 1, 1, 0, 2000),\n+(8150302, 2290096, 1, 1, 0, 2000),\n+(8150302, 2290113, 1, 1, 0, 2000),\n+(8150302, 2290119, 1, 1, 0, 2000),\n+(8150302, 2290128, 1, 1, 0, 6000),\n+(8160000, 2290017, 1, 1, 0, 2000),\n+(8160000, 2290045, 1, 1, 0, 2000),\n+(8160000, 2290065, 1, 1, 0, 2000),\n+(8160000, 2290067, 1, 1, 0, 2000),\n+(8160000, 2290081, 1, 1, 0, 2000),\n+(8170000, 2290012, 1, 1, 0, 2000),\n+(8170000, 2290086, 1, 1, 0, 2000),\n+(8170000, 2290087, 1, 1, 0, 2000),\n+(8170000, 2290134, 1, 1, 0, 6000),\n+(8180000, 2290002, 1, 1, 0, 40000),\n+(8180000, 2290003, 1, 1, 0, 40000),\n+(8180000, 2290014, 1, 1, 0, 40000),\n+(8180000, 2290015, 1, 1, 0, 40000),\n+(8180000, 2290030, 1, 1, 0, 40000),\n+(8180000, 2290035, 1, 1, 0, 40000),\n+(8180000, 2290036, 1, 1, 0, 40000),\n+(8180000, 2290063, 1, 1, 0, 40000),\n+(8180000, 2290080, 1, 1, 0, 40000),\n+(8180000, 2290098, 1, 1, 0, 40000),\n+(8180000, 2290101, 1, 1, 0, 40000),\n+(8180000, 2290117, 1, 1, 0, 40000),\n+(8180000, 2290130, 1, 1, 0, 120000),\n+(8180001, 2290018, 1, 1, 0, 40000),\n+(8180001, 2290019, 1, 1, 0, 40000),\n+(8180001, 2290032, 1, 1, 0, 40000),\n+(8180001, 2290042, 1, 1, 0, 40000),\n+(8180001, 2290058, 1, 1, 0, 40000),\n+(8180001, 2290059, 1, 1, 0, 40000),\n+(8180001, 2290068, 1, 1, 0, 40000),\n+(8180001, 2290069, 1, 1, 0, 40000),\n+(8180001, 2290072, 1, 1, 0, 40000),\n+(8180001, 2290092, 1, 1, 0, 40000),\n+(8180001, 2290099, 1, 1, 0, 40000),\n+(8180001, 2290100, 1, 1, 0, 40000),\n+(8180001, 2290102, 1, 1, 0, 40000),\n+(8180001, 2290119, 1, 1, 0, 40000),\n+(8180001, 2290128, 1, 1, 0, 120000),\n+(8190000, 2280016, 1, 1, 0, 6000),\n+(8190000, 2290030, 1, 1, 0, 2000),\n+(8190000, 2290044, 1, 1, 0, 2000),\n+(8190000, 2290054, 1, 1, 0, 2000),\n+(8190000, 2290066, 1, 1, 0, 2000),\n+(8190000, 2290075, 1, 1, 0, 2000),\n+(8190000, 2290092, 1, 1, 0, 2000),\n+(8190000, 2290103, 1, 1, 0, 2000),\n+(8190002, 2290000, 1, 1, 0, 2000),\n+(8190002, 2290008, 1, 1, 0, 2000),\n+(8190002, 2290018, 1, 1, 0, 2000),\n+(8190002, 2290038, 1, 1, 0, 2000),\n+(8190002, 2290060, 1, 1, 0, 2000),\n+(8190002, 2290080, 1, 1, 0, 2000),\n+(8190002, 2290124, 1, 1, 0, 2000),\n+(8190003, 2280013, 1, 1, 0, 6000),\n+(8190003, 2290007, 1, 1, 0, 2000),\n+(8190003, 2290012, 1, 1, 0, 2000),\n+(8190003, 2290014, 1, 1, 0, 2000),\n+(8190003, 2290033, 1, 1, 0, 2000),\n+(8190003, 2290045, 1, 1, 0, 2000),\n+(8190003, 2290050, 1, 1, 0, 2000),\n+(8190003, 2290055, 1, 1, 0, 2000),\n+(8190003, 2290062, 1, 1, 0, 2000),\n+(8190003, 2290063, 1, 1, 0, 2000),\n+(8190003, 2290070, 1, 1, 0, 2000),\n+(8190003, 2290086, 1, 1, 0, 2000),\n+(8190003, 2290108, 1, 1, 0, 2000),\n+(8190003, 2290133, 1, 1, 0, 6000),\n+(8190004, 2290002, 1, 1, 0, 2000),\n+(8190004, 2290009, 1, 1, 0, 2000),\n+(8190004, 2290021, 1, 1, 0, 2000),\n+(8190004, 2290034, 1, 1, 0, 2000),\n+(8190004, 2290041, 1, 1, 0, 2000),\n+(8190004, 2290052, 1, 1, 0, 2000),\n+(8190004, 2290053, 1, 1, 0, 2000),\n+(8190004, 2290058, 1, 1, 0, 2000),\n+(8190004, 2290068, 1, 1, 0, 2000),\n+(8190004, 2290071, 1, 1, 0, 2000),\n+(8190004, 2290073, 1, 1, 0, 2000),\n+(8190004, 2290090, 1, 1, 0, 2000),\n+(8190004, 2290112, 1, 1, 0, 2000),\n+(8190004, 2290121, 1, 1, 0, 2000),\n+(8190004, 2290130, 1, 1, 0, 6000),\n+(8190005, 2290000, 1, 1, 0, 2000),\n+(8190005, 2290008, 1, 1, 0, 2000),\n+(8190005, 2290018, 1, 1, 0, 2000),\n+(8190005, 2290038, 1, 1, 0, 2000),\n+(8190005, 2290060, 1, 1, 0, 2000),\n+(8190005, 2290080, 1, 1, 0, 2000),\n+(8190005, 2290124, 1, 1, 0, 2000),\n+(8200000, 2290005, 1, 1, 0, 2000),\n+(8200000, 2290011, 1, 1, 0, 2000),\n+(8200000, 2290114, 1, 1, 0, 2000),\n+(8200001, 2280015, 1, 1, 0, 6000),\n+(8200001, 2290050, 1, 1, 0, 2000),\n+(8200001, 2290059, 1, 1, 0, 2000),\n+(8200001, 2290065, 1, 1, 0, 2000),\n+(8200001, 2290129, 1, 1, 0, 6000),\n+(8200002, 2290062, 1, 1, 0, 2000),\n+(8200002, 2290066, 1, 1, 0, 2000),\n+(8200002, 2290070, 1, 1, 0, 2000),\n+(8200002, 2290131, 1, 1, 0, 6000),\n+(8200002, 2290139, 1, 1, 0, 6000),\n+(8200003, 2290012, 1, 1, 0, 2000),\n+(8200003, 2290056, 1, 1, 0, 2000),\n+(8200003, 2290071, 1, 1, 0, 2000),\n+(8200003, 2290101, 1, 1, 0, 2000),\n+(8200003, 2290136, 1, 1, 0, 6000),\n+(8200004, 2280016, 1, 1, 0, 6000),\n+(8200004, 2290069, 1, 1, 0, 2000),\n+(8200004, 2290072, 1, 1, 0, 2000),\n+(8200004, 2290073, 1, 1, 0, 2000),\n+(8200004, 2290127, 1, 1, 0, 6000),\n+(8200004, 2290134, 1, 1, 0, 6000),\n+(8200005, 2280014, 1, 1, 0, 6000),\n+(8200005, 2290078, 1, 1, 0, 2000),\n+(8200005, 2290079, 1, 1, 0, 2000),\n+(8200005, 2290095, 1, 1, 0, 2000),\n+(8200006, 2290003, 1, 1, 0, 2000),\n+(8200006, 2290064, 1, 1, 0, 2000),\n+(8200006, 2290076, 1, 1, 0, 2000),\n+(8200006, 2290077, 1, 1, 0, 2000),\n+(8200006, 2290129, 1, 1, 0, 6000),\n+(8200006, 2290138, 1, 1, 0, 6000),\n+(8200007, 2290006, 1, 1, 0, 2000),\n+(8200007, 2290007, 1, 1, 0, 2000),\n+(8200007, 2290011, 1, 1, 0, 2000),\n+(8200007, 2290016, 1, 1, 0, 2000),\n+(8200007, 2290125, 1, 1, 0, 2000),\n+(8200007, 2290136, 1, 1, 0, 6000),\n+(8200008, 2290006, 1, 1, 0, 2000),\n+(8200008, 2290051, 1, 1, 0, 2000),\n+(8200008, 2290121, 1, 1, 0, 2000),\n+(8200008, 2290122, 1, 1, 0, 2000),\n+(8200008, 2290133, 1, 1, 0, 6000),\n+(8200009, 2290013, 1, 1, 0, 2000),\n+(8200009, 2290016, 1, 1, 0, 2000),\n+(8200009, 2290031, 1, 1, 0, 2000),\n+(8200009, 2290039, 1, 1, 0, 2000),\n+(8200010, 2290026, 1, 1, 0, 2000),\n+(8200010, 2290059, 1, 1, 0, 2000),\n+(8200010, 2290088, 1, 1, 0, 2000),\n+(8200010, 2290089, 1, 1, 0, 2000),\n+(8200010, 2290127, 1, 1, 0, 6000),\n+(8200011, 2290001, 1, 1, 0, 3000),\n+(8200011, 2290040, 1, 1, 0, 3000),\n+(8200011, 2290046, 1, 1, 0, 3000),\n+(8200011, 2290048, 1, 1, 0, 3000),\n+(8200011, 2290049, 1, 1, 0, 3000),\n+(8200011, 2290114, 1, 1, 0, 3000),\n+(8200011, 2290137, 1, 1, 0, 9000),\n+(8200012, 2290041, 1, 1, 0, 3000),\n+(8200012, 2290092, 1, 1, 0, 3000),\n+(8200012, 2290093, 1, 1, 0, 3000),\n+(8200012, 2290115, 1, 1, 0, 3000),\n+(8200012, 2290137, 1, 1, 0, 9000),\n+(8200012, 2290139, 1, 1, 0, 9000),\n+(8220002, 2290020, 1, 1, 0, 40000),\n+(8220002, 2290081, 1, 1, 0, 40000),\n+(8220002, 2290085, 1, 1, 0, 40000),\n+(8220002, 2290133, 1, 1, 0, 120000),\n+(8220003, 2290006, 1, 1, 0, 40000),\n+(8220003, 2290030, 1, 1, 0, 40000),\n+(8220003, 2290031, 1, 1, 0, 40000),\n+(8220003, 2290032, 1, 1, 0, 40000),\n+(8220003, 2290033, 1, 1, 0, 40000),\n+(8220003, 2290060, 1, 1, 0, 40000),\n+(8220003, 2290061, 1, 1, 0, 40000),\n+(8220003, 2290076, 1, 1, 0, 40000),\n+(8220003, 2290077, 1, 1, 0, 40000),\n+(8220003, 2290104, 1, 1, 0, 40000),\n+(8220003, 2290105, 1, 1, 0, 40000),\n+(8220003, 2290117, 1, 1, 0, 40000),\n+(8220003, 2290118, 1, 1, 0, 40000),\n+(8220004, 2290018, 1, 1, 0, 40000),\n+(8220004, 2290019, 1, 1, 0, 40000),\n+(8220004, 2290024, 1, 1, 0, 40000),\n+(8220004, 2290025, 1, 1, 0, 40000),\n+(8220004, 2290058, 1, 1, 0, 40000),\n+(8220004, 2290059, 1, 1, 0, 40000),\n+(8220004, 2290076, 1, 1, 0, 40000),\n+(8220004, 2290077, 1, 1, 0, 40000),\n+(8220004, 2290106, 1, 1, 0, 40000),\n+(8220004, 2290127, 1, 1, 0, 120000),\n+(8220004, 2290134, 1, 1, 0, 120000),\n+(8220005, 2290002, 1, 1, 0, 60000),\n+(8220005, 2290003, 1, 1, 0, 60000),\n+(8220005, 2290036, 1, 1, 0, 60000),\n+(8220005, 2290037, 1, 1, 0, 60000),\n+(8220005, 2290055, 1, 1, 0, 60000),\n+(8220005, 2290080, 1, 1, 0, 60000),\n+(8220005, 2290099, 1, 1, 0, 60000),\n+(8220005, 2290131, 1, 1, 0, 180000),\n+(8220005, 2290136, 1, 1, 0, 180000),\n+(8220006, 2290012, 1, 1, 0, 80000),\n+(8220006, 2290013, 1, 1, 0, 80000),\n+(8220006, 2290042, 1, 1, 0, 80000),\n+(8220006, 2290043, 1, 1, 0, 80000),\n+(8220006, 2290060, 1, 1, 0, 80000),\n+(8220006, 2290061, 1, 1, 0, 80000),\n+(8220006, 2290090, 1, 1, 0, 80000),\n+(8220006, 2290119, 1, 1, 0, 80000),\n+(8220006, 2290120, 1, 1, 0, 80000),\n+(8220006, 2290135, 1, 1, 0, 240000),\n+(8220006, 2290138, 1, 1, 0, 240000),\n+(8220007, 2290035, 1, 1, 0, 40000),\n+(8220007, 2290091, 1, 1, 0, 40000),\n+(8220007, 2290108, 1, 1, 0, 40000),\n+(8220009, 2290031, 1, 1, 0, 40000),\n+(8220009, 2290129, 1, 1, 0, 120000),\n+(8220015, 2280004, 1, 1, 0, 40000),\n+(8220015, 2280005, 1, 1, 0, 40000),\n+(8220015, 2280006, 1, 1, 0, 40000),\n+(8500002, 2280007, 1, 1, 0, 60000),\n+(8500002, 2280008, 1, 1, 0, 60000),\n+(8500002, 2280009, 1, 1, 0, 60000),\n+(8500002, 2280010, 1, 1, 0, 60000),\n+(8500002, 2290006, 1, 1, 0, 60000),\n+(8500002, 2290010, 1, 1, 0, 60000),\n+(8500002, 2290011, 1, 1, 0, 60000),\n+(8500002, 2290013, 1, 1, 0, 60000),\n+(8500002, 2290028, 1, 1, 0, 60000),\n+(8500002, 2290037, 1, 1, 0, 60000),\n+(8500002, 2290043, 1, 1, 0, 60000),\n+(8500002, 2290051, 1, 1, 0, 60000),\n+(8500002, 2290056, 1, 1, 0, 60000),\n+(8500002, 2290061, 1, 1, 0, 60000),\n+(8500002, 2290066, 1, 1, 0, 60000),\n+(8500002, 2290071, 1, 1, 0, 60000),\n+(8500002, 2290078, 1, 1, 0, 60000),\n+(8500002, 2290089, 1, 1, 0, 60000),\n+(8500002, 2290091, 1, 1, 0, 60000),\n+(8500002, 2290104, 1, 1, 0, 60000),\n+(8500002, 2290107, 1, 1, 0, 60000),\n+(8500002, 2290121, 1, 1, 0, 60000),\n+(8500002, 2290123, 1, 1, 0, 60000),\n+(8500002, 2290126, 1, 1, 0, 180000),\n+(8500002, 2290129, 1, 1, 0, 180000),\n+(8510000, 2280007, 1, 1, 0, 40000),\n+(8510000, 2280008, 1, 1, 0, 40000),\n+(8510000, 2280009, 1, 1, 0, 40000),\n+(8510000, 2280010, 1, 1, 0, 40000),\n+(8510000, 2290000, 1, 1, 0, 40000),\n+(8510000, 2290001, 1, 1, 0, 40000),\n+(8510000, 2290004, 1, 1, 0, 40000),\n+(8510000, 2290005, 1, 1, 0, 40000),\n+(8510000, 2290024, 1, 1, 0, 40000),\n+(8510000, 2290025, 1, 1, 0, 40000),\n+(8510000, 2290026, 1, 1, 0, 40000),\n+(8510000, 2290027, 1, 1, 0, 40000),\n+(8510000, 2290052, 1, 1, 0, 40000),\n+(8510000, 2290053, 1, 1, 0, 40000),\n+(8510000, 2290054, 1, 1, 0, 40000),\n+(8510000, 2290055, 1, 1, 0, 40000),\n+(8510000, 2290076, 1, 1, 0, 40000),\n+(8510000, 2290077, 1, 1, 0, 40000),\n+(8510000, 2290082, 1, 1, 0, 40000),\n+(8510000, 2290083, 1, 1, 0, 40000),\n+(8510000, 2290097, 1, 1, 0, 40000),\n+(8510000, 2290099, 1, 1, 0, 40000),\n+(8510000, 2290106, 1, 1, 0, 40000),\n+(8510000, 2290108, 1, 1, 0, 40000),\n+(8510000, 2290112, 1, 1, 0, 40000),\n+(8510000, 2290114, 1, 1, 0, 40000),\n+(8510000, 2290122, 1, 1, 0, 40000),\n+(8510000, 2290124, 1, 1, 0, 40000),\n+(8510000, 2290132, 1, 1, 0, 120000),\n+(8520000, 2280007, 1, 1, 0, 40000),\n+(8520000, 2280008, 1, 1, 0, 40000),\n+(8520000, 2280009, 1, 1, 0, 40000),\n+(8520000, 2280010, 1, 1, 0, 40000),\n+(8520000, 2290000, 1, 1, 0, 40000),\n+(8520000, 2290001, 1, 1, 0, 40000),\n+(8520000, 2290004, 1, 1, 0, 40000),\n+(8520000, 2290005, 1, 1, 0, 40000),\n+(8520000, 2290024, 1, 1, 0, 40000),\n+(8520000, 2290025, 1, 1, 0, 40000),\n+(8520000, 2290026, 1, 1, 0, 40000),\n+(8520000, 2290027, 1, 1, 0, 40000),\n+(8520000, 2290052, 1, 1, 0, 40000),\n+(8520000, 2290053, 1, 1, 0, 40000),\n+(8520000, 2290054, 1, 1, 0, 40000),\n+(8520000, 2290055, 1, 1, 0, 40000),\n+(8520000, 2290076, 1, 1, 0, 40000),\n+(8520000, 2290077, 1, 1, 0, 40000),\n+(8520000, 2290082, 1, 1, 0, 40000),\n+(8520000, 2290083, 1, 1, 0, 40000),\n+(8520000, 2290097, 1, 1, 0, 40000),\n+(8520000, 2290099, 1, 1, 0, 40000),\n+(8520000, 2290106, 1, 1, 0, 40000),\n+(8520000, 2290108, 1, 1, 0, 40000),\n+(8520000, 2290112, 1, 1, 0, 40000),\n+(8520000, 2290114, 1, 1, 0, 40000),\n+(8520000, 2290122, 1, 1, 0, 40000),\n+(8520000, 2290124, 1, 1, 0, 40000),\n+(8520000, 2290132, 1, 1, 0, 120000),\n+(8800002, 2280007, 1, 1, 0, 80000),\n+(8800002, 2280008, 1, 1, 0, 80000),\n+(8800002, 2280009, 1, 1, 0, 80000),\n+(8800002, 2280010, 1, 1, 0, 80000),\n+(8800002, 2280013, 1, 1, 0, 240000),\n+(8800002, 2280014, 1, 1, 0, 240000),\n+(8800002, 2280015, 1, 1, 0, 240000),\n+(8800002, 2280016, 1, 1, 0, 240000),\n+(8800002, 2290006, 1, 1, 0, 80000),\n+(8800002, 2290007, 1, 1, 0, 80000),\n+(8800002, 2290016, 1, 1, 0, 80000),\n+(8800002, 2290020, 1, 1, 0, 80000),\n+(8800002, 2290022, 1, 1, 0, 80000),\n+(8800002, 2290024, 1, 1, 0, 80000),\n+(8800002, 2290028, 1, 1, 0, 80000),\n+(8800002, 2290029, 1, 1, 0, 80000),\n+(8800002, 2290040, 1, 1, 0, 80000),\n+(8800002, 2290046, 1, 1, 0, 80000),\n+(8800002, 2290048, 1, 1, 0, 80000),\n+(8800002, 2290056, 1, 1, 0, 80000),\n+(8800002, 2290057, 1, 1, 0, 80000),\n+(8800002, 2290058, 1, 1, 0, 80000),\n+(8800002, 2290064, 1, 1, 0, 80000),\n+(8800002, 2290067, 1, 1, 0, 80000),\n+(8800002, 2290074, 1, 1, 0, 80000),\n+(8800002, 2290079, 1, 1, 0, 80000),\n+(8800002, 2290084, 1, 1, 0, 80000),\n+(8800002, 2290094, 1, 1, 0, 80000),\n+(8800002, 2290110, 1, 1, 0, 80000),\n+(8800002, 2290115, 1, 1, 0, 80000),\n+(8810018, 2290017, 1, 1, 0, 100000),\n+(8810018, 2290021, 1, 1, 0, 100000),\n+(8810018, 2290023, 1, 1, 0, 100000),\n+(8810018, 2290041, 1, 1, 0, 100000),\n+(8810018, 2290047, 1, 1, 0, 100000),\n+(8810018, 2290049, 1, 1, 0, 100000),\n+(8810018, 2290065, 1, 1, 0, 100000),\n+(8810018, 2290075, 1, 1, 0, 100000),\n+(8810018, 2290085, 1, 1, 0, 100000),\n+(8810018, 2290095, 1, 1, 0, 100000),\n+(8810018, 2290096, 1, 1, 0, 100000),\n+(8810018, 2290111, 1, 1, 0, 100000),\n+(8810018, 2290116, 1, 1, 0, 100000),\n+(8810018, 2290125, 1, 1, 0, 100000),\n+(8810018, 2290133, 1, 1, 0, 300000),\n+(8810018, 2290137, 1, 1, 0, 300000),\n+(8810018, 2290139, 1, 1, 0, 300000),\n+(8820000, 2290010, 1, 1, 0, 120000),\n+(8820000, 2290022, 1, 1, 0, 120000),\n+(8820000, 2290040, 1, 1, 0, 120000),\n+(8820000, 2290046, 1, 1, 0, 120000),\n+(8820000, 2290048, 1, 1, 0, 120000),\n+(8820000, 2290052, 1, 1, 0, 120000),\n+(8820000, 2290084, 1, 1, 0, 120000),\n+(8820000, 2290090, 1, 1, 0, 120000),\n+(8820000, 2290106, 1, 1, 0, 120000),\n+(8820000, 2290119, 1, 1, 0, 120000),\n+(8820001, 2290010, 1, 1, 0, 120000),\n+(8820001, 2290022, 1, 1, 0, 120000),\n+(8820001, 2290040, 1, 1, 0, 120000),\n+(8820001, 2290046, 1, 1, 0, 120000),\n+(8820001, 2290048, 1, 1, 0, 120000),\n+(8820001, 2290052, 1, 1, 0, 120000),\n+(8820001, 2290084, 1, 1, 0, 120000),\n+(8820001, 2290090, 1, 1, 0, 120000),\n+(8820001, 2290106, 1, 1, 0, 120000),\n+(8820001, 2290119, 1, 1, 0, 120000),\n+(9300028, 2280015, 1, 1, 0, 120000),\n+(9300028, 2290026, 1, 1, 0, 40000),\n+(9300028, 2290064, 1, 1, 0, 40000),\n+(9300028, 2290075, 1, 1, 0, 40000),\n+(9300028, 2290093, 1, 1, 0, 40000),\n+(9300028, 2290111, 1, 1, 0, 40000),\n+(9300094, 2280004, 1, 1, 0, 40000),\n+(9300094, 2280005, 1, 1, 0, 40000),\n+(9300094, 2280006, 1, 1, 0, 40000),\n+(9300095, 2280004, 1, 1, 0, 2000),\n+(9300095, 2280005, 1, 1, 0, 2000),\n+(9300095, 2280006, 1, 1, 0, 2000),\n+(9303016, 2290006, 1, 1, 0, 2000),\n+(9303016, 2290030, 1, 1, 0, 2000),\n+(9303016, 2290032, 1, 1, 0, 2000),\n+(9303016, 2290060, 1, 1, 0, 2000),\n+(9303016, 2290076, 1, 1, 0, 2000),\n+(9303016, 2290104, 1, 1, 0, 2000),\n+(9303016, 2290117, 1, 1, 0, 2000),\n+(9400014, 2290053, 1, 1, 0, 40000),\n+(9400014, 2290087, 1, 1, 0, 40000),\n+(9400014, 2290112, 1, 1, 0, 40000),\n+(9400014, 2290122, 1, 1, 0, 40000),\n+(9400120, 2290045, 1, 1, 0, 40000),\n+(9400121, 2280014, 1, 1, 0, 180000),\n+(9400121, 2290081, 1, 1, 0, 60000),\n+(9400121, 2290087, 1, 1, 0, 60000),\n+(9400121, 2290101, 1, 1, 0, 60000),\n+(9400121, 2290103, 1, 1, 0, 60000),\n+(9400122, 2290007, 1, 1, 0, 40000),\n+(9400122, 2290062, 1, 1, 0, 40000),\n+(9400122, 2290116, 1, 1, 0, 40000),\n+(9400300, 2290045, 1, 1, 0, 120000),\n+(9400300, 2290055, 1, 1, 0, 120000),\n+(9400300, 2290063, 1, 1, 0, 120000),\n+(9400300, 2290079, 1, 1, 0, 120000),\n+(9400300, 2290081, 1, 1, 0, 120000),\n+(9400300, 2290096, 1, 1, 0, 120000),\n+(9400514, 2290023, 1, 1, 0, 40000),\n+(9400514, 2290057, 1, 1, 0, 40000),\n+(9400514, 2290088, 1, 1, 0, 40000),\n+(9400514, 2290095, 1, 1, 0, 40000),\n+(9400514, 2290115, 1, 1, 0, 40000),\n+(9400514, 2290139, 1, 1, 0, 120000),\n+(9400549, 2290001, 1, 1, 0, 40000),\n+(9400549, 2290020, 1, 1, 0, 40000),\n+(9400549, 2290045, 1, 1, 0, 40000),\n+(9400549, 2290057, 1, 1, 0, 40000),\n+(9400549, 2290086, 1, 1, 0, 40000),\n+(9400575, 2290009, 1, 1, 0, 40000),\n+(9400575, 2290051, 1, 1, 0, 40000),\n+(9400575, 2290081, 1, 1, 0, 40000),\n+(9400575, 2290087, 1, 1, 0, 40000),\n+(9400575, 2290107, 1, 1, 0, 40000),\n+(9400575, 2290123, 1, 1, 0, 40000),\n+(9400580, 2290004, 1, 1, 0, 2000),\n+(9400580, 2290024, 1, 1, 0, 2000),\n+(9400580, 2290083, 1, 1, 0, 2000),\n+(9400580, 2290087, 1, 1, 0, 2000),\n+(9400580, 2290103, 1, 1, 0, 2000),\n+(9400580, 2290121, 1, 1, 0, 2000),\n+(9400582, 2290005, 1, 1, 0, 2000),\n+(9400582, 2290010, 1, 1, 0, 2000),\n+(9400582, 2290029, 1, 1, 0, 2000),\n+(9400582, 2290047, 1, 1, 0, 2000),\n+(9400582, 2290049, 1, 1, 0, 2000),\n+(9400582, 2290074, 1, 1, 0, 2000),\n+(9400582, 2290079, 1, 1, 0, 2000),\n+(9400582, 2290081, 1, 1, 0, 2000),\n+(9400582, 2290135, 1, 1, 0, 6000),\n+(9400590, 2290088, 1, 1, 0, 60000),\n+(9400590, 2290125, 1, 1, 0, 60000),\n+(9400590, 2290135, 1, 1, 0, 180000),\n+(9400591, 2290039, 1, 1, 0, 60000),\n+(9400591, 2290074, 1, 1, 0, 60000),\n+(9400591, 2290113, 1, 1, 0, 60000),\n+(9400592, 2290047, 1, 1, 0, 60000),\n+(9400592, 2290123, 1, 1, 0, 60000),\n+(9400592, 2290131, 1, 1, 0, 180000),\n+(9400593, 2290069, 1, 1, 0, 60000),\n+(9400593, 2290093, 1, 1, 0, 60000),\n+(9400593, 2290138, 1, 1, 0, 180000),\n+(9420513, 2290039, 1, 1, 0, 40000),\n+(9420513, 2290100, 1, 1, 0, 40000),\n+(9420513, 2290108, 1, 1, 0, 40000),\n+(9420513, 2290118, 1, 1, 0, 40000),\n+(9420513, 2290138, 1, 1, 0, 120000),\n+(9420514, 2290099, 1, 1, 0, 1287),\n+(9420517, 2290000, 1, 1, 0, 1287),\n+(9420517, 2290008, 1, 1, 0, 1287),\n+(9420517, 2290018, 1, 1, 0, 1287),\n+(9420517, 2290038, 1, 1, 0, 1287),\n+(9420517, 2290060, 1, 1, 0, 1287),\n+(9420517, 2290080, 1, 1, 0, 1287),\n+(9420517, 2290103, 1, 1, 0, 1287),\n+(9420518, 2290123, 1, 1, 0, 1287),\n+(9420519, 2290113, 1, 1, 0, 1287),\n+(9420522, 2290000, 1, 1, 0, 1287),\n+(9420522, 2290001, 1, 1, 0, 1287),\n+(9420522, 2290011, 1, 1, 0, 1287),\n+(9420522, 2290025, 1, 1, 0, 1287),\n+(9420522, 2290028, 1, 1, 0, 1287),\n+(9420522, 2290037, 1, 1, 0, 1287),\n+(9420522, 2290043, 1, 1, 0, 1287),\n+(9420522, 2290066, 1, 1, 0, 1287),\n+(9420522, 2290082, 1, 1, 0, 1287),\n+(9420522, 2290083, 1, 1, 0, 1287),\n+(9420522, 2290089, 1, 1, 0, 1287),\n+(9420522, 2290091, 1, 1, 0, 1287),\n+(9420522, 2290107, 1, 1, 0, 1287),\n+(9420540, 2280006, 1, 1, 0, 2000),\n+(9420540, 2290119, 1, 1, 0, 2000),\n+(9420540, 2290120, 1, 1, 0, 2000),\n+(9420544, 2280007, 1, 1, 0, 80000),\n+(9420544, 2280008, 1, 1, 0, 80000),\n+(9420544, 2280009, 1, 1, 0, 80000),\n+(9420544, 2280010, 1, 1, 0, 80000),\n+(9420544, 2290002, 1, 1, 0, 80000),\n+(9420544, 2290015, 1, 1, 0, 80000),\n+(9420544, 2290022, 1, 1, 0, 80000),\n+(9420544, 2290027, 1, 1, 0, 80000),\n+(9420544, 2290034, 1, 1, 0, 80000),\n+(9420544, 2290052, 1, 1, 0, 80000),\n+(9420544, 2290054, 1, 1, 0, 80000),\n+(9420544, 2290089, 1, 1, 0, 80000),\n+(9420544, 2290094, 1, 1, 0, 80000),\n+(9420544, 2290098, 1, 1, 0, 80000),\n+(9420544, 2290105, 1, 1, 0, 80000),\n+(9420544, 2290110, 1, 1, 0, 80000),\n+(9420544, 2290119, 1, 1, 0, 80000),\n+(9420549, 2280007, 1, 1, 0, 80000),\n+(9420549, 2280008, 1, 1, 0, 80000),\n+(9420549, 2280009, 1, 1, 0, 80000),\n+(9420549, 2280010, 1, 1, 0, 80000),\n+(9420549, 2290002, 1, 1, 0, 80000),\n+(9420549, 2290015, 1, 1, 0, 80000),\n+(9420549, 2290022, 1, 1, 0, 80000),\n+(9420549, 2290027, 1, 1, 0, 80000),\n+(9420549, 2290034, 1, 1, 0, 80000),\n+(9420549, 2290052, 1, 1, 0, 80000),\n+(9420549, 2290054, 1, 1, 0, 80000),\n+(9420549, 2290089, 1, 1, 0, 80000),\n+(9420549, 2290094, 1, 1, 0, 80000),\n+(9420549, 2290098, 1, 1, 0, 80000),\n+(9420549, 2290105, 1, 1, 0, 80000),\n+(9420549, 2290110, 1, 1, 0, 80000),\n+(9420549, 2290119, 1, 1, 0, 80000),\n+(9500166, 2290044, 1, 1, 0, 2000),\n+(9500173, 2290018, 1, 1, 0, 40000),\n+(9500173, 2290019, 1, 1, 0, 40000),\n+(9500173, 2290032, 1, 1, 0, 40000),\n+(9500173, 2290042, 1, 1, 0, 40000),\n+(9500173, 2290058, 1, 1, 0, 40000),\n+(9500173, 2290068, 1, 1, 0, 40000),\n+(9500173, 2290072, 1, 1, 0, 40000),\n+(9500173, 2290092, 1, 1, 0, 40000),\n+(9500173, 2290099, 1, 1, 0, 40000),\n+(9500173, 2290102, 1, 1, 0, 40000),\n+(9500173, 2290119, 1, 1, 0, 40000),\n+(9500173, 2290128, 1, 1, 0, 120000),\n+(9500174, 2290002, 1, 1, 0, 40000),\n+(9500174, 2290014, 1, 1, 0, 40000),\n+(9500174, 2290030, 1, 1, 0, 40000),\n+(9500174, 2290080, 1, 1, 0, 40000),\n+(9500174, 2290130, 1, 1, 0, 120000),\n+(9500180, 2290010, 1, 1, 0, 40000),\n+(9500180, 2290028, 1, 1, 0, 40000),\n+(9500180, 2290126, 1, 1, 0, 120000),\n+(9500181, 2290010, 1, 1, 0, 40000),\n+(9500181, 2290028, 1, 1, 0, 40000),\n+(9500181, 2290126, 1, 1, 0, 120000),\n+(9500331, 2290010, 1, 1, 0, 40000),\n+(9500331, 2290028, 1, 1, 0, 40000),\n+(9500331, 2290126, 1, 1, 0, 120000),\n+(9500332, 2290132, 1, 1, 0, 120000),\n+(9500333, 2290006, 1, 1, 0, 40000),\n+(9500333, 2290030, 1, 1, 0, 40000),\n+(9500333, 2290032, 1, 1, 0, 40000),\n+(9500333, 2290060, 1, 1, 0, 40000),\n+(9500333, 2290076, 1, 1, 0, 40000),\n+(9500333, 2290104, 1, 1, 0, 40000),\n+(9500333, 2290117, 1, 1, 0, 40000),"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleSkillbookChanceFetcher/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/manifest.mf?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "7b663749402e551d1b4d1d029d3828fd7865b7da", "filename": "tools/MapleSkillbookChanceFetcher/nbproject/build-impl.xml", "status": "added", "additions": 1448, "deletions": 0, "changes": 1448, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/build-impl.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/build-impl.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/nbproject/build-impl.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,1448 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+*** GENERATED FROM project.xml - DO NOT EDIT  ***\n+***         EDIT ../build.xml INSTEAD         ***\n+\n+For the purpose of easier reading the script\n+is divided into following sections:\n+\n+  - initialization\n+  - compilation\n+  - jar\n+  - execution\n+  - debugging\n+  - javadoc\n+  - test compilation\n+  - test execution\n+  - test debugging\n+  - applet\n+  - cleanup\n+\n+        -->\n+<project xmlns:j2seproject1=\"http://www.netbeans.org/ns/j2se-project/1\" xmlns:j2seproject3=\"http://www.netbeans.org/ns/j2se-project/3\" xmlns:jaxrpc=\"http://www.netbeans.org/ns/j2se-project/jax-rpc\" basedir=\"..\" default=\"default\" name=\"MapleSkillbookChanceFetcher-impl\">\n+    <fail message=\"Please build using Ant 1.8.0 or higher.\">\n+        <condition>\n+            <not>\n+                <antversion atleast=\"1.8.0\"/>\n+            </not>\n+        </condition>\n+    </fail>\n+    <target depends=\"test,jar,javadoc\" description=\"Build and test whole project.\" name=\"default\"/>\n+    <!-- \n+                ======================\n+                INITIALIZATION SECTION \n+                ======================\n+            -->\n+    <target name=\"-pre-init\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"-pre-init\" name=\"-init-private\">\n+        <property file=\"nbproject/private/config.properties\"/>\n+        <property file=\"nbproject/private/configs/${config}.properties\"/>\n+        <property file=\"nbproject/private/private.properties\"/>\n+    </target>\n+    <target depends=\"-pre-init,-init-private\" name=\"-init-user\">\n+        <property file=\"${user.properties.file}\"/>\n+        <!-- The two properties below are usually overridden -->\n+        <!-- by the active platform. Just a fallback. -->\n+        <property name=\"default.javac.source\" value=\"1.4\"/>\n+        <property name=\"default.javac.target\" value=\"1.4\"/>\n+    </target>\n+    <target depends=\"-pre-init,-init-private,-init-user\" name=\"-init-project\">\n+        <property file=\"nbproject/configs/${config}.properties\"/>\n+        <property file=\"nbproject/project.properties\"/>\n+    </target>\n+    <target depends=\"-pre-init,-init-private,-init-user,-init-project,-init-macrodef-property\" name=\"-do-init\">\n+        <j2seproject1:property name=\"platform.home\" value=\"platforms.${platform.active}.home\"/>\n+        <j2seproject1:property name=\"platform.bootcp\" value=\"platforms.${platform.active}.bootclasspath\"/>\n+        <j2seproject1:property name=\"platform.compiler\" value=\"platforms.${platform.active}.compile\"/>\n+        <j2seproject1:property name=\"platform.javac.tmp\" value=\"platforms.${platform.active}.javac\"/>\n+        <condition property=\"platform.javac\" value=\"${platform.home}/bin/javac\">\n+            <equals arg1=\"${platform.javac.tmp}\" arg2=\"$${platforms.${platform.active}.javac}\"/>\n+        </condition>\n+        <property name=\"platform.javac\" value=\"${platform.javac.tmp}\"/>\n+        <j2seproject1:property name=\"platform.java.tmp\" value=\"platforms.${platform.active}.java\"/>\n+        <condition property=\"platform.java\" value=\"${platform.home}/bin/java\">\n+            <equals arg1=\"${platform.java.tmp}\" arg2=\"$${platforms.${platform.active}.java}\"/>\n+        </condition>\n+        <property name=\"platform.java\" value=\"${platform.java.tmp}\"/>\n+        <j2seproject1:property name=\"platform.javadoc.tmp\" value=\"platforms.${platform.active}.javadoc\"/>\n+        <condition property=\"platform.javadoc\" value=\"${platform.home}/bin/javadoc\">\n+            <equals arg1=\"${platform.javadoc.tmp}\" arg2=\"$${platforms.${platform.active}.javadoc}\"/>\n+        </condition>\n+        <property name=\"platform.javadoc\" value=\"${platform.javadoc.tmp}\"/>\n+        <condition property=\"platform.invalid\" value=\"true\">\n+            <or>\n+                <contains string=\"${platform.javac}\" substring=\"$${platforms.\"/>\n+                <contains string=\"${platform.java}\" substring=\"$${platforms.\"/>\n+                <contains string=\"${platform.javadoc}\" substring=\"$${platforms.\"/>\n+            </or>\n+        </condition>\n+        <fail unless=\"platform.home\">Must set platform.home</fail>\n+        <fail unless=\"platform.bootcp\">Must set platform.bootcp</fail>\n+        <fail unless=\"platform.java\">Must set platform.java</fail>\n+        <fail unless=\"platform.javac\">Must set platform.javac</fail>\n+        <fail if=\"platform.invalid\">\n+ The J2SE Platform is not correctly set up.\n+ Your active platform is: ${platform.active}, but the corresponding property \"platforms.${platform.active}.home\" is not found in the project's properties files. \n+ Either open the project in the IDE and setup the Platform with the same name or add it manually.\n+ For example like this:\n+     ant -Duser.properties.file=&lt;path_to_property_file&gt; jar (where you put the property \"platforms.${platform.active}.home\" in a .properties file)\n+  or ant -Dplatforms.${platform.active}.home=&lt;path_to_JDK_home&gt; jar (where no properties file is used) \n+  </fail>\n+        <available file=\"${manifest.file}\" property=\"manifest.available\"/>\n+        <condition property=\"splashscreen.available\">\n+            <and>\n+                <not>\n+                    <equals arg1=\"${application.splash}\" arg2=\"\" trim=\"true\"/>\n+                </not>\n+                <available file=\"${application.splash}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"main.class.available\">\n+            <and>\n+                <isset property=\"main.class\"/>\n+                <not>\n+                    <equals arg1=\"${main.class}\" arg2=\"\" trim=\"true\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <condition property=\"profile.available\">\n+            <and>\n+                <isset property=\"javac.profile\"/>\n+                <length length=\"0\" string=\"${javac.profile}\" when=\"greater\"/>\n+                <matches pattern=\"1\\.[89](\\..*)?\" string=\"${javac.source}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"do.archive\">\n+            <or>\n+                <not>\n+                    <istrue value=\"${jar.archive.disabled}\"/>\n+                </not>\n+                <istrue value=\"${not.archive.disabled}\"/>\n+            </or>\n+        </condition>\n+        <condition property=\"do.mkdist\">\n+            <and>\n+                <isset property=\"do.archive\"/>\n+                <isset property=\"libs.CopyLibs.classpath\"/>\n+                <not>\n+                    <istrue value=\"${mkdist.disabled}\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <condition property=\"do.archive+manifest.available\">\n+            <and>\n+                <isset property=\"manifest.available\"/>\n+                <istrue value=\"${do.archive}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"do.archive+main.class.available\">\n+            <and>\n+                <isset property=\"main.class.available\"/>\n+                <istrue value=\"${do.archive}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"do.archive+splashscreen.available\">\n+            <and>\n+                <isset property=\"splashscreen.available\"/>\n+                <istrue value=\"${do.archive}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"do.archive+profile.available\">\n+            <and>\n+                <isset property=\"profile.available\"/>\n+                <istrue value=\"${do.archive}\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"have.tests\">\n+            <or>\n+                <available file=\"${test.src.dir}\"/>\n+            </or>\n+        </condition>\n+        <condition property=\"have.sources\">\n+            <or>\n+                <available file=\"${src.dir}\"/>\n+            </or>\n+        </condition>\n+        <condition property=\"netbeans.home+have.tests\">\n+            <and>\n+                <isset property=\"netbeans.home\"/>\n+                <isset property=\"have.tests\"/>\n+            </and>\n+        </condition>\n+        <condition property=\"no.javadoc.preview\">\n+            <and>\n+                <isset property=\"javadoc.preview\"/>\n+                <isfalse value=\"${javadoc.preview}\"/>\n+            </and>\n+        </condition>\n+        <property name=\"run.jvmargs\" value=\"\"/>\n+        <property name=\"run.jvmargs.ide\" value=\"\"/>\n+        <property name=\"javac.compilerargs\" value=\"\"/>\n+        <property name=\"work.dir\" value=\"${basedir}\"/>\n+        <condition property=\"no.deps\">\n+            <and>\n+                <istrue value=\"${no.dependencies}\"/>\n+            </and>\n+        </condition>\n+        <property name=\"javac.debug\" value=\"true\"/>\n+        <property name=\"javadoc.preview\" value=\"true\"/>\n+        <property name=\"application.args\" value=\"\"/>\n+        <property name=\"source.encoding\" value=\"${file.encoding}\"/>\n+        <property name=\"runtime.encoding\" value=\"${source.encoding}\"/>\n+        <condition property=\"javadoc.encoding.used\" value=\"${javadoc.encoding}\">\n+            <and>\n+                <isset property=\"javadoc.encoding\"/>\n+                <not>\n+                    <equals arg1=\"${javadoc.encoding}\" arg2=\"\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <property name=\"javadoc.encoding.used\" value=\"${source.encoding}\"/>\n+        <property name=\"includes\" value=\"**\"/>\n+        <property name=\"excludes\" value=\"\"/>\n+        <property name=\"do.depend\" value=\"false\"/>\n+        <condition property=\"do.depend.true\">\n+            <istrue value=\"${do.depend}\"/>\n+        </condition>\n+        <path id=\"endorsed.classpath.path\" path=\"${endorsed.classpath}\"/>\n+        <condition else=\"\" property=\"endorsed.classpath.cmd.line.arg\" value=\"-Xbootclasspath/p:'${toString:endorsed.classpath.path}'\">\n+            <and>\n+                <isset property=\"endorsed.classpath\"/>\n+                <not>\n+                    <equals arg1=\"${endorsed.classpath}\" arg2=\"\" trim=\"true\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <condition else=\"\" property=\"javac.profile.cmd.line.arg\" value=\"-profile ${javac.profile}\">\n+            <isset property=\"profile.available\"/>\n+        </condition>\n+        <property name=\"jar.index\" value=\"false\"/>\n+        <property name=\"jar.index.metainf\" value=\"${jar.index}\"/>\n+        <property name=\"copylibs.rebase\" value=\"true\"/>\n+        <available file=\"${meta.inf.dir}/persistence.xml\" property=\"has.persistence.xml\"/>\n+        <condition property=\"junit.available\">\n+            <or>\n+                <available classname=\"org.junit.Test\" classpath=\"${run.test.classpath}\"/>\n+                <available classname=\"junit.framework.Test\" classpath=\"${run.test.classpath}\"/>\n+            </or>\n+        </condition>\n+        <condition property=\"testng.available\">\n+            <available classname=\"org.testng.annotations.Test\" classpath=\"${run.test.classpath}\"/>\n+        </condition>\n+        <condition property=\"junit+testng.available\">\n+            <and>\n+                <istrue value=\"${junit.available}\"/>\n+                <istrue value=\"${testng.available}\"/>\n+            </and>\n+        </condition>\n+        <condition else=\"testng\" property=\"testng.mode\" value=\"mixed\">\n+            <istrue value=\"${junit+testng.available}\"/>\n+        </condition>\n+        <condition else=\"\" property=\"testng.debug.mode\" value=\"-mixed\">\n+            <istrue value=\"${junit+testng.available}\"/>\n+        </condition>\n+    </target>\n+    <target name=\"-post-init\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"-pre-init,-init-private,-init-user,-init-project,-do-init\" name=\"-init-check\">\n+        <fail unless=\"src.dir\">Must set src.dir</fail>\n+        <fail unless=\"test.src.dir\">Must set test.src.dir</fail>\n+        <fail unless=\"build.dir\">Must set build.dir</fail>\n+        <fail unless=\"dist.dir\">Must set dist.dir</fail>\n+        <fail unless=\"build.classes.dir\">Must set build.classes.dir</fail>\n+        <fail unless=\"dist.javadoc.dir\">Must set dist.javadoc.dir</fail>\n+        <fail unless=\"build.test.classes.dir\">Must set build.test.classes.dir</fail>\n+        <fail unless=\"build.test.results.dir\">Must set build.test.results.dir</fail>\n+        <fail unless=\"build.classes.excludes\">Must set build.classes.excludes</fail>\n+        <fail unless=\"dist.jar\">Must set dist.jar</fail>\n+    </target>\n+    <target name=\"-init-macrodef-property\">\n+        <macrodef name=\"property\" uri=\"http://www.netbeans.org/ns/j2se-project/1\">\n+            <attribute name=\"name\"/>\n+            <attribute name=\"value\"/>\n+            <sequential>\n+                <property name=\"@{name}\" value=\"${@{value}}\"/>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-ap-cmdline-properties\" if=\"ap.supported.internal\" name=\"-init-macrodef-javac-with-processors\">\n+        <macrodef name=\"javac\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${src.dir}\" name=\"srcdir\"/>\n+            <attribute default=\"${build.classes.dir}\" name=\"destdir\"/>\n+            <attribute default=\"${javac.classpath}\" name=\"classpath\"/>\n+            <attribute default=\"${javac.processorpath}\" name=\"processorpath\"/>\n+            <attribute default=\"${build.generated.sources.dir}/ap-source-output\" name=\"apgeneratedsrcdir\"/>\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"${javac.debug}\" name=\"debug\"/>\n+            <attribute default=\"${empty.dir}\" name=\"sourcepath\"/>\n+            <attribute default=\"${empty.dir}\" name=\"gensrcdir\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property location=\"${build.dir}/empty\" name=\"empty.dir\"/>\n+                <mkdir dir=\"${empty.dir}\"/>\n+                <mkdir dir=\"@{apgeneratedsrcdir}\"/>\n+                <javac debug=\"@{debug}\" deprecation=\"${javac.deprecation}\" destdir=\"@{destdir}\" encoding=\"${source.encoding}\" excludes=\"@{excludes}\" executable=\"${platform.javac}\" fork=\"yes\" includeantruntime=\"false\" includes=\"@{includes}\" source=\"${javac.source}\" sourcepath=\"@{sourcepath}\" srcdir=\"@{srcdir}\" target=\"${javac.target}\" tempdir=\"${java.io.tmpdir}\">\n+                    <src>\n+                        <dirset dir=\"@{gensrcdir}\" erroronmissingdir=\"false\">\n+                            <include name=\"*\"/>\n+                        </dirset>\n+                    </src>\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                    <compilerarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                    <compilerarg line=\"${javac.profile.cmd.line.arg}\"/>\n+                    <compilerarg line=\"${javac.compilerargs}\"/>\n+                    <compilerarg value=\"-processorpath\"/>\n+                    <compilerarg path=\"@{processorpath}:${empty.dir}\"/>\n+                    <compilerarg line=\"${ap.processors.internal}\"/>\n+                    <compilerarg line=\"${annotation.processing.processor.options}\"/>\n+                    <compilerarg value=\"-s\"/>\n+                    <compilerarg path=\"@{apgeneratedsrcdir}\"/>\n+                    <compilerarg line=\"${ap.proc.none.internal}\"/>\n+                    <customize/>\n+                </javac>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-ap-cmdline-properties\" name=\"-init-macrodef-javac-without-processors\" unless=\"ap.supported.internal\">\n+        <macrodef name=\"javac\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${src.dir}\" name=\"srcdir\"/>\n+            <attribute default=\"${build.classes.dir}\" name=\"destdir\"/>\n+            <attribute default=\"${javac.classpath}\" name=\"classpath\"/>\n+            <attribute default=\"${javac.processorpath}\" name=\"processorpath\"/>\n+            <attribute default=\"${build.generated.sources.dir}/ap-source-output\" name=\"apgeneratedsrcdir\"/>\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"${javac.debug}\" name=\"debug\"/>\n+            <attribute default=\"${empty.dir}\" name=\"sourcepath\"/>\n+            <attribute default=\"${empty.dir}\" name=\"gensrcdir\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property location=\"${build.dir}/empty\" name=\"empty.dir\"/>\n+                <mkdir dir=\"${empty.dir}\"/>\n+                <javac debug=\"@{debug}\" deprecation=\"${javac.deprecation}\" destdir=\"@{destdir}\" encoding=\"${source.encoding}\" excludes=\"@{excludes}\" executable=\"${platform.javac}\" fork=\"yes\" includeantruntime=\"false\" includes=\"@{includes}\" source=\"${javac.source}\" sourcepath=\"@{sourcepath}\" srcdir=\"@{srcdir}\" target=\"${javac.target}\" tempdir=\"${java.io.tmpdir}\">\n+                    <src>\n+                        <dirset dir=\"@{gensrcdir}\" erroronmissingdir=\"false\">\n+                            <include name=\"*\"/>\n+                        </dirset>\n+                    </src>\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                    <compilerarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                    <compilerarg line=\"${javac.profile.cmd.line.arg}\"/>\n+                    <compilerarg line=\"${javac.compilerargs}\"/>\n+                    <customize/>\n+                </javac>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-javac-with-processors,-init-macrodef-javac-without-processors\" name=\"-init-macrodef-javac\">\n+        <macrodef name=\"depend\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${src.dir}\" name=\"srcdir\"/>\n+            <attribute default=\"${build.classes.dir}\" name=\"destdir\"/>\n+            <attribute default=\"${javac.classpath}\" name=\"classpath\"/>\n+            <sequential>\n+                <depend cache=\"${build.dir}/depcache\" destdir=\"@{destdir}\" excludes=\"${excludes}\" includes=\"${includes}\" srcdir=\"@{srcdir}\">\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                </depend>\n+            </sequential>\n+        </macrodef>\n+        <macrodef name=\"force-recompile\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${build.classes.dir}\" name=\"destdir\"/>\n+            <sequential>\n+                <fail unless=\"javac.includes\">Must set javac.includes</fail>\n+                <pathconvert pathsep=\"${line.separator}\" property=\"javac.includes.binary\">\n+                    <path>\n+                        <filelist dir=\"@{destdir}\" files=\"${javac.includes}\"/>\n+                    </path>\n+                    <globmapper from=\"*.java\" to=\"*.class\"/>\n+                </pathconvert>\n+                <tempfile deleteonexit=\"true\" property=\"javac.includesfile.binary\"/>\n+                <echo file=\"${javac.includesfile.binary}\" message=\"${javac.includes.binary}\"/>\n+                <delete>\n+                    <files includesfile=\"${javac.includesfile.binary}\"/>\n+                </delete>\n+                <delete>\n+                    <fileset file=\"${javac.includesfile.binary}\"/>\n+                </delete>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target if=\"${junit.available}\" name=\"-init-macrodef-junit-init\">\n+        <condition else=\"false\" property=\"nb.junit.batch\" value=\"true\">\n+            <and>\n+                <istrue value=\"${junit.available}\"/>\n+                <not>\n+                    <isset property=\"test.method\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <condition else=\"false\" property=\"nb.junit.single\" value=\"true\">\n+            <and>\n+                <istrue value=\"${junit.available}\"/>\n+                <isset property=\"test.method\"/>\n+            </and>\n+        </condition>\n+    </target>\n+    <target name=\"-init-test-properties\">\n+        <property name=\"test.binaryincludes\" value=\"&lt;nothing&gt;\"/>\n+        <property name=\"test.binarytestincludes\" value=\"\"/>\n+        <property name=\"test.binaryexcludes\" value=\"\"/>\n+    </target>\n+    <target if=\"${nb.junit.single}\" name=\"-init-macrodef-junit-single\" unless=\"${nb.junit.batch}\">\n+        <macrodef name=\"junit\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property name=\"junit.forkmode\" value=\"perTest\"/>\n+                <junit dir=\"${work.dir}\" errorproperty=\"tests.failed\" failureproperty=\"tests.failed\" fork=\"true\" forkmode=\"${junit.forkmode}\" jvm=\"${platform.java}\" showoutput=\"true\" tempdir=\"${build.dir}\">\n+                    <test methods=\"@{testmethods}\" name=\"@{testincludes}\" todir=\"${build.test.results.dir}\"/>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"test-sys-prop.\"/>\n+                        <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <formatter type=\"brief\" usefile=\"false\"/>\n+                    <formatter type=\"xml\"/>\n+                    <jvmarg value=\"-ea\"/>\n+                    <customize/>\n+                </junit>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-test-properties\" if=\"${nb.junit.batch}\" name=\"-init-macrodef-junit-batch\" unless=\"${nb.junit.single}\">\n+        <macrodef name=\"junit\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property name=\"junit.forkmode\" value=\"perTest\"/>\n+                <junit dir=\"${work.dir}\" errorproperty=\"tests.failed\" failureproperty=\"tests.failed\" fork=\"true\" forkmode=\"${junit.forkmode}\" jvm=\"${platform.java}\" showoutput=\"true\" tempdir=\"${build.dir}\">\n+                    <batchtest todir=\"${build.test.results.dir}\">\n+                        <fileset dir=\"${test.src.dir}\" excludes=\"@{excludes},${excludes}\" includes=\"@{includes}\">\n+                            <filename name=\"@{testincludes}\"/>\n+                        </fileset>\n+                        <fileset dir=\"${build.test.classes.dir}\" excludes=\"@{excludes},${excludes},${test.binaryexcludes}\" includes=\"${test.binaryincludes}\">\n+                            <filename name=\"${test.binarytestincludes}\"/>\n+                        </fileset>\n+                    </batchtest>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"test-sys-prop.\"/>\n+                        <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <formatter type=\"brief\" usefile=\"false\"/>\n+                    <formatter type=\"xml\"/>\n+                    <jvmarg value=\"-ea\"/>\n+                    <customize/>\n+                </junit>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-junit-init,-init-macrodef-junit-single, -init-macrodef-junit-batch\" if=\"${junit.available}\" name=\"-init-macrodef-junit\"/>\n+    <target if=\"${testng.available}\" name=\"-init-macrodef-testng\">\n+        <macrodef name=\"testng\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <condition else=\"\" property=\"testng.methods.arg\" value=\"@{testincludes}.@{testmethods}\">\n+                    <isset property=\"test.method\"/>\n+                </condition>\n+                <union id=\"test.set\">\n+                    <fileset dir=\"${test.src.dir}\" excludes=\"@{excludes},**/*.xml,${excludes}\" includes=\"@{includes}\">\n+                        <filename name=\"@{testincludes}\"/>\n+                    </fileset>\n+                </union>\n+                <taskdef classname=\"org.testng.TestNGAntTask\" classpath=\"${run.test.classpath}\" name=\"testng\"/>\n+                <testng classfilesetref=\"test.set\" failureProperty=\"tests.failed\" jvm=\"${platform.java}\" listeners=\"org.testng.reporters.VerboseReporter\" methods=\"${testng.methods.arg}\" mode=\"${testng.mode}\" outputdir=\"${build.test.results.dir}\" suitename=\"MapleSkillbookChanceFetcher\" testname=\"TestNG tests\" workingDir=\"${work.dir}\">\n+                    <xmlfileset dir=\"${build.test.classes.dir}\" includes=\"@{testincludes}\"/>\n+                    <propertyset>\n+                        <propertyref prefix=\"test-sys-prop.\"/>\n+                        <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </propertyset>\n+                    <customize/>\n+                </testng>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target name=\"-init-macrodef-test-impl\">\n+        <macrodef name=\"test-impl\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element implicit=\"true\" name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <echo>No tests executed.</echo>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-junit\" if=\"${junit.available}\" name=\"-init-macrodef-junit-impl\">\n+        <macrodef name=\"test-impl\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element implicit=\"true\" name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <j2seproject3:junit excludes=\"@{excludes}\" includes=\"@{includes}\" testincludes=\"@{testincludes}\" testmethods=\"@{testmethods}\">\n+                    <customize/>\n+                </j2seproject3:junit>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-testng\" if=\"${testng.available}\" name=\"-init-macrodef-testng-impl\">\n+        <macrodef name=\"test-impl\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element implicit=\"true\" name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <j2seproject3:testng excludes=\"@{excludes}\" includes=\"@{includes}\" testincludes=\"@{testincludes}\" testmethods=\"@{testmethods}\">\n+                    <customize/>\n+                </j2seproject3:testng>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-test-impl,-init-macrodef-junit-impl,-init-macrodef-testng-impl\" name=\"-init-macrodef-test\">\n+        <macrodef name=\"test\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <sequential>\n+                <j2seproject3:test-impl excludes=\"@{excludes}\" includes=\"@{includes}\" testincludes=\"@{testincludes}\" testmethods=\"@{testmethods}\">\n+                    <customize>\n+                        <classpath>\n+                            <path path=\"${run.test.classpath}\"/>\n+                        </classpath>\n+                        <jvmarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                        <jvmarg line=\"${run.jvmargs}\"/>\n+                        <jvmarg line=\"${run.jvmargs.ide}\"/>\n+                    </customize>\n+                </j2seproject3:test-impl>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target if=\"${junit.available}\" name=\"-init-macrodef-junit-debug\" unless=\"${nb.junit.batch}\">\n+        <macrodef name=\"junit-debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property name=\"junit.forkmode\" value=\"perTest\"/>\n+                <junit dir=\"${work.dir}\" errorproperty=\"tests.failed\" failureproperty=\"tests.failed\" fork=\"true\" forkmode=\"${junit.forkmode}\" jvm=\"${platform.java}\" showoutput=\"true\" tempdir=\"${build.dir}\">\n+                    <test methods=\"@{testmethods}\" name=\"@{testincludes}\" todir=\"${build.test.results.dir}\"/>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"test-sys-prop.\"/>\n+                        <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <formatter type=\"brief\" usefile=\"false\"/>\n+                    <formatter type=\"xml\"/>\n+                    <jvmarg value=\"-ea\"/>\n+                    <jvmarg line=\"${debug-args-line}\"/>\n+                    <jvmarg value=\"-Xrunjdwp:transport=${debug-transport},address=${jpda.address}\"/>\n+                    <customize/>\n+                </junit>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-test-properties\" if=\"${nb.junit.batch}\" name=\"-init-macrodef-junit-debug-batch\">\n+        <macrodef name=\"junit-debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property name=\"junit.forkmode\" value=\"perTest\"/>\n+                <junit dir=\"${work.dir}\" errorproperty=\"tests.failed\" failureproperty=\"tests.failed\" fork=\"true\" forkmode=\"${junit.forkmode}\" jvm=\"${platform.java}\" showoutput=\"true\" tempdir=\"${build.dir}\">\n+                    <batchtest todir=\"${build.test.results.dir}\">\n+                        <fileset dir=\"${test.src.dir}\" excludes=\"@{excludes},${excludes}\" includes=\"@{includes}\">\n+                            <filename name=\"@{testincludes}\"/>\n+                        </fileset>\n+                        <fileset dir=\"${build.test.classes.dir}\" excludes=\"@{excludes},${excludes},${test.binaryexcludes}\" includes=\"${test.binaryincludes}\">\n+                            <filename name=\"${test.binarytestincludes}\"/>\n+                        </fileset>\n+                    </batchtest>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"test-sys-prop.\"/>\n+                        <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <formatter type=\"brief\" usefile=\"false\"/>\n+                    <formatter type=\"xml\"/>\n+                    <jvmarg value=\"-ea\"/>\n+                    <jvmarg line=\"${debug-args-line}\"/>\n+                    <jvmarg value=\"-Xrunjdwp:transport=${debug-transport},address=${jpda.address}\"/>\n+                    <customize/>\n+                </junit>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-junit-debug,-init-macrodef-junit-debug-batch\" if=\"${junit.available}\" name=\"-init-macrodef-junit-debug-impl\">\n+        <macrodef name=\"test-debug-impl\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <element implicit=\"true\" name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <j2seproject3:junit-debug excludes=\"@{excludes}\" includes=\"@{includes}\" testincludes=\"@{testincludes}\" testmethods=\"@{testmethods}\">\n+                    <customize/>\n+                </j2seproject3:junit-debug>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target if=\"${testng.available}\" name=\"-init-macrodef-testng-debug\">\n+        <macrodef name=\"testng-debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${main.class}\" name=\"testClass\"/>\n+            <attribute default=\"\" name=\"testMethod\"/>\n+            <element name=\"customize2\" optional=\"true\"/>\n+            <sequential>\n+                <condition else=\"-testclass @{testClass}\" property=\"test.class.or.method\" value=\"-methods @{testClass}.@{testMethod}\">\n+                    <isset property=\"test.method\"/>\n+                </condition>\n+                <condition else=\"-suitename MapleSkillbookChanceFetcher -testname @{testClass} ${test.class.or.method}\" property=\"testng.cmd.args\" value=\"@{testClass}\">\n+                    <matches pattern=\".*\\.xml\" string=\"@{testClass}\"/>\n+                </condition>\n+                <delete dir=\"${build.test.results.dir}\" quiet=\"true\"/>\n+                <mkdir dir=\"${build.test.results.dir}\"/>\n+                <j2seproject3:debug classname=\"org.testng.TestNG\" classpath=\"${debug.test.classpath}\">\n+                    <customize>\n+                        <customize2/>\n+                        <jvmarg value=\"-ea\"/>\n+                        <arg line=\"${testng.debug.mode}\"/>\n+                        <arg line=\"-d ${build.test.results.dir}\"/>\n+                        <arg line=\"-listener org.testng.reporters.VerboseReporter\"/>\n+                        <arg line=\"${testng.cmd.args}\"/>\n+                    </customize>\n+                </j2seproject3:debug>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-testng-debug\" if=\"${testng.available}\" name=\"-init-macrodef-testng-debug-impl\">\n+        <macrodef name=\"testng-debug-impl\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${main.class}\" name=\"testClass\"/>\n+            <attribute default=\"\" name=\"testMethod\"/>\n+            <element implicit=\"true\" name=\"customize2\" optional=\"true\"/>\n+            <sequential>\n+                <j2seproject3:testng-debug testClass=\"@{testClass}\" testMethod=\"@{testMethod}\">\n+                    <customize2/>\n+                </j2seproject3:testng-debug>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-junit-debug-impl\" if=\"${junit.available}\" name=\"-init-macrodef-test-debug-junit\">\n+        <macrodef name=\"test-debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <attribute default=\"${main.class}\" name=\"testClass\"/>\n+            <attribute default=\"\" name=\"testMethod\"/>\n+            <sequential>\n+                <j2seproject3:test-debug-impl excludes=\"@{excludes}\" includes=\"@{includes}\" testincludes=\"@{testincludes}\" testmethods=\"@{testmethods}\">\n+                    <customize>\n+                        <classpath>\n+                            <path path=\"${run.test.classpath}\"/>\n+                        </classpath>\n+                        <jvmarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                        <jvmarg line=\"${run.jvmargs}\"/>\n+                        <jvmarg line=\"${run.jvmargs.ide}\"/>\n+                    </customize>\n+                </j2seproject3:test-debug-impl>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-testng-debug-impl\" if=\"${testng.available}\" name=\"-init-macrodef-test-debug-testng\">\n+        <macrodef name=\"test-debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${includes}\" name=\"includes\"/>\n+            <attribute default=\"${excludes}\" name=\"excludes\"/>\n+            <attribute default=\"**\" name=\"testincludes\"/>\n+            <attribute default=\"\" name=\"testmethods\"/>\n+            <attribute default=\"${main.class}\" name=\"testClass\"/>\n+            <attribute default=\"\" name=\"testMethod\"/>\n+            <sequential>\n+                <j2seproject3:testng-debug-impl testClass=\"@{testClass}\" testMethod=\"@{testMethod}\">\n+                    <customize2>\n+                        <syspropertyset>\n+                            <propertyref prefix=\"test-sys-prop.\"/>\n+                            <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                        </syspropertyset>\n+                    </customize2>\n+                </j2seproject3:testng-debug-impl>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-init-macrodef-test-debug-junit,-init-macrodef-test-debug-testng\" name=\"-init-macrodef-test-debug\"/>\n+    <!--\n+                pre NB7.2 profiling section; consider it deprecated\n+            -->\n+    <target depends=\"-profile-pre-init, init, -profile-post-init, -profile-init-macrodef-profile, -profile-init-check\" if=\"profiler.info.jvmargs.agent\" name=\"profile-init\"/>\n+    <target if=\"profiler.info.jvmargs.agent\" name=\"-profile-pre-init\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target if=\"profiler.info.jvmargs.agent\" name=\"-profile-post-init\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target if=\"profiler.info.jvmargs.agent\" name=\"-profile-init-macrodef-profile\">\n+        <macrodef name=\"resolve\">\n+            <attribute name=\"name\"/>\n+            <attribute name=\"value\"/>\n+            <sequential>\n+                <property name=\"@{name}\" value=\"${env.@{value}}\"/>\n+            </sequential>\n+        </macrodef>\n+        <macrodef name=\"profile\">\n+            <attribute default=\"${main.class}\" name=\"classname\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property environment=\"env\"/>\n+                <resolve name=\"profiler.current.path\" value=\"${profiler.info.pathvar}\"/>\n+                <java classname=\"@{classname}\" dir=\"${profiler.info.dir}\" fork=\"true\" jvm=\"${profiler.info.jvm}\">\n+                    <jvmarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                    <jvmarg value=\"${profiler.info.jvmargs.agent}\"/>\n+                    <jvmarg line=\"${profiler.info.jvmargs}\"/>\n+                    <env key=\"${profiler.info.pathvar}\" path=\"${profiler.info.agentpath}:${profiler.current.path}\"/>\n+                    <arg line=\"${application.args}\"/>\n+                    <classpath>\n+                        <path path=\"${run.classpath}\"/>\n+                    </classpath>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"run-sys-prop.\"/>\n+                        <mapper from=\"run-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <customize/>\n+                </java>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target depends=\"-profile-pre-init, init, -profile-post-init, -profile-init-macrodef-profile\" if=\"profiler.info.jvmargs.agent\" name=\"-profile-init-check\">\n+        <fail unless=\"profiler.info.jvm\">Must set JVM to use for profiling in profiler.info.jvm</fail>\n+        <fail unless=\"profiler.info.jvmargs.agent\">Must set profiler agent JVM arguments in profiler.info.jvmargs.agent</fail>\n+    </target>\n+    <!--\n+                end of pre NB7.2 profiling section\n+            -->\n+    <target depends=\"-init-debug-args\" name=\"-init-macrodef-nbjpda\">\n+        <macrodef name=\"nbjpdastart\" uri=\"http://www.netbeans.org/ns/j2se-project/1\">\n+            <attribute default=\"${main.class}\" name=\"name\"/>\n+            <attribute default=\"${debug.classpath}\" name=\"classpath\"/>\n+            <attribute default=\"\" name=\"stopclassname\"/>\n+            <sequential>\n+                <nbjpdastart addressproperty=\"jpda.address\" name=\"@{name}\" stopclassname=\"@{stopclassname}\" transport=\"${debug-transport}\">\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                    <bootclasspath>\n+                        <path path=\"${platform.bootcp}\"/>\n+                    </bootclasspath>\n+                </nbjpdastart>\n+            </sequential>\n+        </macrodef>\n+        <macrodef name=\"nbjpdareload\" uri=\"http://www.netbeans.org/ns/j2se-project/1\">\n+            <attribute default=\"${build.classes.dir}\" name=\"dir\"/>\n+            <sequential>\n+                <nbjpdareload>\n+                    <fileset dir=\"@{dir}\" includes=\"${fix.classes}\">\n+                        <include name=\"${fix.includes}*.class\"/>\n+                    </fileset>\n+                </nbjpdareload>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target name=\"-init-debug-args\">\n+        <exec executable=\"${platform.java}\" outputproperty=\"version-output\">\n+            <arg value=\"-version\"/>\n+        </exec>\n+        <condition property=\"have-jdk-older-than-1.4\">\n+            <or>\n+                <contains string=\"${version-output}\" substring=\"java version &quot;1.0\"/>\n+                <contains string=\"${version-output}\" substring=\"java version &quot;1.1\"/>\n+                <contains string=\"${version-output}\" substring=\"java version &quot;1.2\"/>\n+                <contains string=\"${version-output}\" substring=\"java version &quot;1.3\"/>\n+            </or>\n+        </condition>\n+        <condition else=\"-Xdebug\" property=\"debug-args-line\" value=\"-Xdebug -Xnoagent -Djava.compiler=none\">\n+            <istrue value=\"${have-jdk-older-than-1.4}\"/>\n+        </condition>\n+        <condition else=\"dt_socket\" property=\"debug-transport-by-os\" value=\"dt_shmem\">\n+            <os family=\"windows\"/>\n+        </condition>\n+        <condition else=\"${debug-transport-by-os}\" property=\"debug-transport\" value=\"${debug.transport}\">\n+            <isset property=\"debug.transport\"/>\n+        </condition>\n+    </target>\n+    <target depends=\"-init-debug-args\" name=\"-init-macrodef-debug\">\n+        <macrodef name=\"debug\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${main.class}\" name=\"classname\"/>\n+            <attribute default=\"${debug.classpath}\" name=\"classpath\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <java classname=\"@{classname}\" dir=\"${work.dir}\" fork=\"true\" jvm=\"${platform.java}\">\n+                    <jvmarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                    <jvmarg line=\"${debug-args-line}\"/>\n+                    <jvmarg value=\"-Xrunjdwp:transport=${debug-transport},address=${jpda.address}\"/>\n+                    <jvmarg value=\"-Dfile.encoding=${runtime.encoding}\"/>\n+                    <redirector errorencoding=\"${runtime.encoding}\" inputencoding=\"${runtime.encoding}\" outputencoding=\"${runtime.encoding}\"/>\n+                    <jvmarg line=\"${run.jvmargs}\"/>\n+                    <jvmarg line=\"${run.jvmargs.ide}\"/>\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"run-sys-prop.\"/>\n+                        <mapper from=\"run-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <customize/>\n+                </java>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target name=\"-init-macrodef-java\">\n+        <macrodef name=\"java\" uri=\"http://www.netbeans.org/ns/j2se-project/1\">\n+            <attribute default=\"${main.class}\" name=\"classname\"/>\n+            <attribute default=\"${run.classpath}\" name=\"classpath\"/>\n+            <attribute default=\"jvm\" name=\"jvm\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <java classname=\"@{classname}\" dir=\"${work.dir}\" fork=\"true\" jvm=\"${platform.java}\">\n+                    <jvmarg line=\"${endorsed.classpath.cmd.line.arg}\"/>\n+                    <jvmarg value=\"-Dfile.encoding=${runtime.encoding}\"/>\n+                    <redirector errorencoding=\"${runtime.encoding}\" inputencoding=\"${runtime.encoding}\" outputencoding=\"${runtime.encoding}\"/>\n+                    <jvmarg line=\"${run.jvmargs}\"/>\n+                    <jvmarg line=\"${run.jvmargs.ide}\"/>\n+                    <classpath>\n+                        <path path=\"@{classpath}\"/>\n+                    </classpath>\n+                    <syspropertyset>\n+                        <propertyref prefix=\"run-sys-prop.\"/>\n+                        <mapper from=\"run-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+                    </syspropertyset>\n+                    <customize/>\n+                </java>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target name=\"-init-macrodef-copylibs\">\n+        <macrodef name=\"copylibs\" uri=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <attribute default=\"${manifest.file}\" name=\"manifest\"/>\n+            <element name=\"customize\" optional=\"true\"/>\n+            <sequential>\n+                <property location=\"${build.classes.dir}\" name=\"build.classes.dir.resolved\"/>\n+                <pathconvert property=\"run.classpath.without.build.classes.dir\">\n+                    <path path=\"${run.classpath}\"/>\n+                    <map from=\"${build.classes.dir.resolved}\" to=\"\"/>\n+                </pathconvert>\n+                <pathconvert pathsep=\" \" property=\"jar.classpath\">\n+                    <path path=\"${run.classpath.without.build.classes.dir}\"/>\n+                    <chainedmapper>\n+                        <flattenmapper/>\n+                        <filtermapper>\n+                            <replacestring from=\" \" to=\"%20\"/>\n+                        </filtermapper>\n+                        <globmapper from=\"*\" to=\"lib/*\"/>\n+                    </chainedmapper>\n+                </pathconvert>\n+                <taskdef classname=\"org.netbeans.modules.java.j2seproject.copylibstask.CopyLibs\" classpath=\"${libs.CopyLibs.classpath}\" name=\"copylibs\"/>\n+                <copylibs compress=\"${jar.compress}\" excludeFromCopy=\"${copylibs.excludes}\" index=\"${jar.index}\" indexMetaInf=\"${jar.index.metainf}\" jarfile=\"${dist.jar}\" manifest=\"@{manifest}\" rebase=\"${copylibs.rebase}\" runtimeclasspath=\"${run.classpath.without.build.classes.dir}\">\n+                    <fileset dir=\"${build.classes.dir}\" excludes=\"${dist.archive.excludes}\"/>\n+                    <manifest>\n+                        <attribute name=\"Class-Path\" value=\"${jar.classpath}\"/>\n+                        <customize/>\n+                    </manifest>\n+                </copylibs>\n+            </sequential>\n+        </macrodef>\n+    </target>\n+    <target name=\"-init-presetdef-jar\">\n+        <presetdef name=\"jar\" uri=\"http://www.netbeans.org/ns/j2se-project/1\">\n+            <jar compress=\"${jar.compress}\" index=\"${jar.index}\" jarfile=\"${dist.jar}\">\n+                <j2seproject1:fileset dir=\"${build.classes.dir}\" excludes=\"${dist.archive.excludes}\"/>\n+            </jar>\n+        </presetdef>\n+    </target>\n+    <target name=\"-init-ap-cmdline-properties\">\n+        <property name=\"annotation.processing.enabled\" value=\"true\"/>\n+        <property name=\"annotation.processing.processors.list\" value=\"\"/>\n+        <property name=\"annotation.processing.processor.options\" value=\"\"/>\n+        <property name=\"annotation.processing.run.all.processors\" value=\"true\"/>\n+        <property name=\"javac.processorpath\" value=\"${javac.classpath}\"/>\n+        <property name=\"javac.test.processorpath\" value=\"${javac.test.classpath}\"/>\n+        <condition property=\"ap.supported.internal\" value=\"true\">\n+            <not>\n+                <matches pattern=\"1\\.[0-5](\\..*)?\" string=\"${javac.source}\"/>\n+            </not>\n+        </condition>\n+    </target>\n+    <target depends=\"-init-ap-cmdline-properties\" if=\"ap.supported.internal\" name=\"-init-ap-cmdline-supported\">\n+        <condition else=\"\" property=\"ap.processors.internal\" value=\"-processor ${annotation.processing.processors.list}\">\n+            <isfalse value=\"${annotation.processing.run.all.processors}\"/>\n+        </condition>\n+        <condition else=\"\" property=\"ap.proc.none.internal\" value=\"-proc:none\">\n+            <isfalse value=\"${annotation.processing.enabled}\"/>\n+        </condition>\n+    </target>\n+    <target depends=\"-init-ap-cmdline-properties,-init-ap-cmdline-supported\" name=\"-init-ap-cmdline\">\n+        <property name=\"ap.cmd.line.internal\" value=\"\"/>\n+    </target>\n+    <target depends=\"-pre-init,-init-private,-init-user,-init-project,-do-init,-post-init,-init-check,-init-macrodef-property,-init-macrodef-javac,-init-macrodef-test,-init-macrodef-test-debug,-init-macrodef-nbjpda,-init-macrodef-debug,-init-macrodef-java,-init-presetdef-jar,-init-ap-cmdline\" name=\"init\"/>\n+    <!--\n+                ===================\n+                COMPILATION SECTION\n+                ===================\n+            -->\n+    <target name=\"-deps-jar-init\" unless=\"built-jar.properties\">\n+        <property location=\"${build.dir}/built-jar.properties\" name=\"built-jar.properties\"/>\n+        <delete file=\"${built-jar.properties}\" quiet=\"true\"/>\n+    </target>\n+    <target if=\"already.built.jar.${basedir}\" name=\"-warn-already-built-jar\">\n+        <echo level=\"warn\" message=\"Cycle detected: MapleSkillbookChanceFetcher was already built\"/>\n+    </target>\n+    <target depends=\"init,-deps-jar-init\" name=\"deps-jar\" unless=\"no.deps\">\n+        <mkdir dir=\"${build.dir}\"/>\n+        <touch file=\"${built-jar.properties}\" verbose=\"false\"/>\n+        <property file=\"${built-jar.properties}\" prefix=\"already.built.jar.\"/>\n+        <antcall target=\"-warn-already-built-jar\"/>\n+        <propertyfile file=\"${built-jar.properties}\">\n+            <entry key=\"${basedir}\" value=\"\"/>\n+        </propertyfile>\n+    </target>\n+    <target depends=\"init,-check-automatic-build,-clean-after-automatic-build\" name=\"-verify-automatic-build\"/>\n+    <target depends=\"init\" name=\"-check-automatic-build\">\n+        <available file=\"${build.classes.dir}/.netbeans_automatic_build\" property=\"netbeans.automatic.build\"/>\n+    </target>\n+    <target depends=\"init\" if=\"netbeans.automatic.build\" name=\"-clean-after-automatic-build\">\n+        <antcall target=\"clean\"/>\n+    </target>\n+    <target depends=\"init,deps-jar\" name=\"-pre-pre-compile\">\n+        <mkdir dir=\"${build.classes.dir}\"/>\n+    </target>\n+    <target name=\"-pre-compile\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target if=\"do.depend.true\" name=\"-compile-depend\">\n+        <pathconvert property=\"build.generated.subdirs\">\n+            <dirset dir=\"${build.generated.sources.dir}\" erroronmissingdir=\"false\">\n+                <include name=\"*\"/>\n+            </dirset>\n+        </pathconvert>\n+        <j2seproject3:depend srcdir=\"${src.dir}:${build.generated.subdirs}\"/>\n+    </target>\n+    <target depends=\"init,deps-jar,-pre-pre-compile,-pre-compile, -copy-persistence-xml,-compile-depend\" if=\"have.sources\" name=\"-do-compile\">\n+        <j2seproject3:javac gensrcdir=\"${build.generated.sources.dir}\"/>\n+        <copy todir=\"${build.classes.dir}\">\n+            <fileset dir=\"${src.dir}\" excludes=\"${build.classes.excludes},${excludes}\" includes=\"${includes}\"/>\n+        </copy>\n+    </target>\n+    <target if=\"has.persistence.xml\" name=\"-copy-persistence-xml\">\n+        <mkdir dir=\"${build.classes.dir}/META-INF\"/>\n+        <copy todir=\"${build.classes.dir}/META-INF\">\n+            <fileset dir=\"${meta.inf.dir}\" includes=\"persistence.xml orm.xml\"/>\n+        </copy>\n+    </target>\n+    <target name=\"-post-compile\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,deps-jar,-verify-automatic-build,-pre-pre-compile,-pre-compile,-do-compile,-post-compile\" description=\"Compile project.\" name=\"compile\"/>\n+    <target name=\"-pre-compile-single\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,deps-jar,-pre-pre-compile\" name=\"-do-compile-single\">\n+        <fail unless=\"javac.includes\">Must select some files in the IDE or set javac.includes</fail>\n+        <j2seproject3:force-recompile/>\n+        <j2seproject3:javac excludes=\"\" gensrcdir=\"${build.generated.sources.dir}\" includes=\"${javac.includes}\" sourcepath=\"${src.dir}\"/>\n+    </target>\n+    <target name=\"-post-compile-single\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,deps-jar,-verify-automatic-build,-pre-pre-compile,-pre-compile-single,-do-compile-single,-post-compile-single\" name=\"compile-single\"/>\n+    <!--\n+                ====================\n+                JAR BUILDING SECTION\n+                ====================\n+            -->\n+    <target depends=\"init\" name=\"-pre-pre-jar\">\n+        <dirname file=\"${dist.jar}\" property=\"dist.jar.dir\"/>\n+        <mkdir dir=\"${dist.jar.dir}\"/>\n+    </target>\n+    <target name=\"-pre-jar\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init\" if=\"do.archive\" name=\"-do-jar-create-manifest\" unless=\"manifest.available\">\n+        <tempfile deleteonexit=\"true\" destdir=\"${build.dir}\" property=\"tmp.manifest.file\"/>\n+        <touch file=\"${tmp.manifest.file}\" verbose=\"false\"/>\n+    </target>\n+    <target depends=\"init\" if=\"do.archive+manifest.available\" name=\"-do-jar-copy-manifest\">\n+        <tempfile deleteonexit=\"true\" destdir=\"${build.dir}\" property=\"tmp.manifest.file\"/>\n+        <copy file=\"${manifest.file}\" tofile=\"${tmp.manifest.file}\"/>\n+    </target>\n+    <target depends=\"init,-do-jar-create-manifest,-do-jar-copy-manifest\" if=\"do.archive+main.class.available\" name=\"-do-jar-set-mainclass\">\n+        <manifest file=\"${tmp.manifest.file}\" mode=\"update\">\n+            <attribute name=\"Main-Class\" value=\"${main.class}\"/>\n+        </manifest>\n+    </target>\n+    <target depends=\"init,-do-jar-create-manifest,-do-jar-copy-manifest\" if=\"do.archive+profile.available\" name=\"-do-jar-set-profile\">\n+        <manifest file=\"${tmp.manifest.file}\" mode=\"update\">\n+            <attribute name=\"Profile\" value=\"${javac.profile}\"/>\n+        </manifest>\n+    </target>\n+    <target depends=\"init,-do-jar-create-manifest,-do-jar-copy-manifest\" if=\"do.archive+splashscreen.available\" name=\"-do-jar-set-splashscreen\">\n+        <basename file=\"${application.splash}\" property=\"splashscreen.basename\"/>\n+        <mkdir dir=\"${build.classes.dir}/META-INF\"/>\n+        <copy failonerror=\"false\" file=\"${application.splash}\" todir=\"${build.classes.dir}/META-INF\"/>\n+        <manifest file=\"${tmp.manifest.file}\" mode=\"update\">\n+            <attribute name=\"SplashScreen-Image\" value=\"META-INF/${splashscreen.basename}\"/>\n+        </manifest>\n+    </target>\n+    <target depends=\"init,-init-macrodef-copylibs,compile,-pre-pre-jar,-pre-jar,-do-jar-create-manifest,-do-jar-copy-manifest,-do-jar-set-mainclass,-do-jar-set-profile,-do-jar-set-splashscreen\" if=\"do.mkdist\" name=\"-do-jar-copylibs\">\n+        <j2seproject3:copylibs manifest=\"${tmp.manifest.file}\"/>\n+        <echo level=\"info\">To run this application from the command line without Ant, try:</echo>\n+        <property location=\"${dist.jar}\" name=\"dist.jar.resolved\"/>\n+        <echo level=\"info\">${platform.java} -jar \"${dist.jar.resolved}\"</echo>\n+    </target>\n+    <target depends=\"init,compile,-pre-pre-jar,-pre-jar,-do-jar-create-manifest,-do-jar-copy-manifest,-do-jar-set-mainclass,-do-jar-set-profile,-do-jar-set-splashscreen\" if=\"do.archive\" name=\"-do-jar-jar\" unless=\"do.mkdist\">\n+        <j2seproject1:jar manifest=\"${tmp.manifest.file}\"/>\n+        <property location=\"${build.classes.dir}\" name=\"build.classes.dir.resolved\"/>\n+        <property location=\"${dist.jar}\" name=\"dist.jar.resolved\"/>\n+        <pathconvert property=\"run.classpath.with.dist.jar\">\n+            <path path=\"${run.classpath}\"/>\n+            <map from=\"${build.classes.dir.resolved}\" to=\"${dist.jar.resolved}\"/>\n+        </pathconvert>\n+        <condition else=\"\" property=\"jar.usage.message\" value=\"To run this application from the command line without Ant, try:${line.separator}${platform.java} -cp ${run.classpath.with.dist.jar} ${main.class}\">\n+            <isset property=\"main.class.available\"/>\n+        </condition>\n+        <condition else=\"debug\" property=\"jar.usage.level\" value=\"info\">\n+            <isset property=\"main.class.available\"/>\n+        </condition>\n+        <echo level=\"${jar.usage.level}\" message=\"${jar.usage.message}\"/>\n+    </target>\n+    <target depends=\"-do-jar-copylibs\" if=\"do.archive\" name=\"-do-jar-delete-manifest\">\n+        <delete>\n+            <fileset file=\"${tmp.manifest.file}\"/>\n+        </delete>\n+    </target>\n+    <target depends=\"init,compile,-pre-pre-jar,-pre-jar,-do-jar-create-manifest,-do-jar-copy-manifest,-do-jar-set-mainclass,-do-jar-set-profile,-do-jar-set-splashscreen,-do-jar-jar,-do-jar-delete-manifest\" name=\"-do-jar-without-libraries\"/>\n+    <target depends=\"init,compile,-pre-pre-jar,-pre-jar,-do-jar-create-manifest,-do-jar-copy-manifest,-do-jar-set-mainclass,-do-jar-set-profile,-do-jar-set-splashscreen,-do-jar-copylibs,-do-jar-delete-manifest\" name=\"-do-jar-with-libraries\"/>\n+    <target name=\"-post-jar\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,compile,-pre-jar,-do-jar-without-libraries,-do-jar-with-libraries,-post-jar\" name=\"-do-jar\"/>\n+    <target depends=\"init,compile,-pre-jar,-do-jar,-post-jar\" description=\"Build JAR.\" name=\"jar\"/>\n+    <!--\n+                =================\n+                EXECUTION SECTION\n+                =================\n+            -->\n+    <target depends=\"init,compile\" description=\"Run a main class.\" name=\"run\">\n+        <j2seproject1:java>\n+            <customize>\n+                <arg line=\"${application.args}\"/>\n+            </customize>\n+        </j2seproject1:java>\n+    </target>\n+    <target name=\"-do-not-recompile\">\n+        <property name=\"javac.includes.binary\" value=\"\"/>\n+    </target>\n+    <target depends=\"init,compile-single\" name=\"run-single\">\n+        <fail unless=\"run.class\">Must select one file in the IDE or set run.class</fail>\n+        <j2seproject1:java classname=\"${run.class}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single\" name=\"run-test-with-main\">\n+        <fail unless=\"run.class\">Must select one file in the IDE or set run.class</fail>\n+        <j2seproject1:java classname=\"${run.class}\" classpath=\"${run.test.classpath}\"/>\n+    </target>\n+    <!--\n+                =================\n+                DEBUGGING SECTION\n+                =================\n+            -->\n+    <target depends=\"init\" if=\"netbeans.home\" name=\"-debug-start-debugger\">\n+        <j2seproject1:nbjpdastart name=\"${debug.class}\"/>\n+    </target>\n+    <target depends=\"init\" if=\"netbeans.home\" name=\"-debug-start-debugger-main-test\">\n+        <j2seproject1:nbjpdastart classpath=\"${debug.test.classpath}\" name=\"${debug.class}\"/>\n+    </target>\n+    <target depends=\"init,compile\" name=\"-debug-start-debuggee\">\n+        <j2seproject3:debug>\n+            <customize>\n+                <arg line=\"${application.args}\"/>\n+            </customize>\n+        </j2seproject3:debug>\n+    </target>\n+    <target depends=\"init,compile,-debug-start-debugger,-debug-start-debuggee\" description=\"Debug project in IDE.\" if=\"netbeans.home\" name=\"debug\"/>\n+    <target depends=\"init\" if=\"netbeans.home\" name=\"-debug-start-debugger-stepinto\">\n+        <j2seproject1:nbjpdastart stopclassname=\"${main.class}\"/>\n+    </target>\n+    <target depends=\"init,compile,-debug-start-debugger-stepinto,-debug-start-debuggee\" if=\"netbeans.home\" name=\"debug-stepinto\"/>\n+    <target depends=\"init,compile-single\" if=\"netbeans.home\" name=\"-debug-start-debuggee-single\">\n+        <fail unless=\"debug.class\">Must select one file in the IDE or set debug.class</fail>\n+        <j2seproject3:debug classname=\"${debug.class}\"/>\n+    </target>\n+    <target depends=\"init,compile-single,-debug-start-debugger,-debug-start-debuggee-single\" if=\"netbeans.home\" name=\"debug-single\"/>\n+    <target depends=\"init,compile-test-single\" if=\"netbeans.home\" name=\"-debug-start-debuggee-main-test\">\n+        <fail unless=\"debug.class\">Must select one file in the IDE or set debug.class</fail>\n+        <j2seproject3:debug classname=\"${debug.class}\" classpath=\"${debug.test.classpath}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-debug-start-debugger-main-test,-debug-start-debuggee-main-test\" if=\"netbeans.home\" name=\"debug-test-with-main\"/>\n+    <target depends=\"init\" name=\"-pre-debug-fix\">\n+        <fail unless=\"fix.includes\">Must set fix.includes</fail>\n+        <property name=\"javac.includes\" value=\"${fix.includes}.java\"/>\n+    </target>\n+    <target depends=\"init,-pre-debug-fix,compile-single\" if=\"netbeans.home\" name=\"-do-debug-fix\">\n+        <j2seproject1:nbjpdareload/>\n+    </target>\n+    <target depends=\"init,-pre-debug-fix,-do-debug-fix\" if=\"netbeans.home\" name=\"debug-fix\"/>\n+    <!--\n+                =================\n+                PROFILING SECTION\n+                =================\n+            -->\n+    <!--\n+                pre NB7.2 profiler integration\n+            -->\n+    <target depends=\"profile-init,compile\" description=\"Profile a project in the IDE.\" if=\"profiler.info.jvmargs.agent\" name=\"-profile-pre72\">\n+        <fail unless=\"netbeans.home\">This target only works when run from inside the NetBeans IDE.</fail>\n+        <nbprofiledirect>\n+            <classpath>\n+                <path path=\"${run.classpath}\"/>\n+            </classpath>\n+        </nbprofiledirect>\n+        <profile/>\n+    </target>\n+    <target depends=\"profile-init,compile-single\" description=\"Profile a selected class in the IDE.\" if=\"profiler.info.jvmargs.agent\" name=\"-profile-single-pre72\">\n+        <fail unless=\"profile.class\">Must select one file in the IDE or set profile.class</fail>\n+        <fail unless=\"netbeans.home\">This target only works when run from inside the NetBeans IDE.</fail>\n+        <nbprofiledirect>\n+            <classpath>\n+                <path path=\"${run.classpath}\"/>\n+            </classpath>\n+        </nbprofiledirect>\n+        <profile classname=\"${profile.class}\"/>\n+    </target>\n+    <target depends=\"profile-init,compile-single\" if=\"profiler.info.jvmargs.agent\" name=\"-profile-applet-pre72\">\n+        <fail unless=\"netbeans.home\">This target only works when run from inside the NetBeans IDE.</fail>\n+        <nbprofiledirect>\n+            <classpath>\n+                <path path=\"${run.classpath}\"/>\n+            </classpath>\n+        </nbprofiledirect>\n+        <profile classname=\"sun.applet.AppletViewer\">\n+            <customize>\n+                <arg value=\"${applet.url}\"/>\n+            </customize>\n+        </profile>\n+    </target>\n+    <target depends=\"profile-init,compile-test-single\" if=\"profiler.info.jvmargs.agent\" name=\"-profile-test-single-pre72\">\n+        <fail unless=\"netbeans.home\">This target only works when run from inside the NetBeans IDE.</fail>\n+        <nbprofiledirect>\n+            <classpath>\n+                <path path=\"${run.test.classpath}\"/>\n+            </classpath>\n+        </nbprofiledirect>\n+        <junit dir=\"${profiler.info.dir}\" errorproperty=\"tests.failed\" failureproperty=\"tests.failed\" fork=\"true\" jvm=\"${profiler.info.jvm}\" showoutput=\"true\">\n+            <env key=\"${profiler.info.pathvar}\" path=\"${profiler.info.agentpath}:${profiler.current.path}\"/>\n+            <jvmarg value=\"${profiler.info.jvmargs.agent}\"/>\n+            <jvmarg line=\"${profiler.info.jvmargs}\"/>\n+            <test name=\"${profile.class}\"/>\n+            <classpath>\n+                <path path=\"${run.test.classpath}\"/>\n+            </classpath>\n+            <syspropertyset>\n+                <propertyref prefix=\"test-sys-prop.\"/>\n+                <mapper from=\"test-sys-prop.*\" to=\"*\" type=\"glob\"/>\n+            </syspropertyset>\n+            <formatter type=\"brief\" usefile=\"false\"/>\n+            <formatter type=\"xml\"/>\n+        </junit>\n+    </target>\n+    <!--\n+                end of pre NB72 profiling section\n+            -->\n+    <target if=\"netbeans.home\" name=\"-profile-check\">\n+        <condition property=\"profiler.configured\">\n+            <or>\n+                <contains casesensitive=\"true\" string=\"${run.jvmargs.ide}\" substring=\"-agentpath:\"/>\n+                <contains casesensitive=\"true\" string=\"${run.jvmargs.ide}\" substring=\"-javaagent:\"/>\n+            </or>\n+        </condition>\n+    </target>\n+    <target depends=\"-profile-check,-profile-pre72\" description=\"Profile a project in the IDE.\" if=\"profiler.configured\" name=\"profile\" unless=\"profiler.info.jvmargs.agent\">\n+        <startprofiler/>\n+        <antcall target=\"run\"/>\n+    </target>\n+    <target depends=\"-profile-check,-profile-single-pre72\" description=\"Profile a selected class in the IDE.\" if=\"profiler.configured\" name=\"profile-single\" unless=\"profiler.info.jvmargs.agent\">\n+        <fail unless=\"run.class\">Must select one file in the IDE or set run.class</fail>\n+        <startprofiler/>\n+        <antcall target=\"run-single\"/>\n+    </target>\n+    <target depends=\"-profile-test-single-pre72\" description=\"Profile a selected test in the IDE.\" name=\"profile-test-single\"/>\n+    <target depends=\"-profile-check\" description=\"Profile a selected test in the IDE.\" if=\"profiler.configured\" name=\"profile-test\" unless=\"profiler.info.jvmargs\">\n+        <fail unless=\"test.includes\">Must select some files in the IDE or set test.includes</fail>\n+        <startprofiler/>\n+        <antcall target=\"test-single\"/>\n+    </target>\n+    <target depends=\"-profile-check\" description=\"Profile a selected class in the IDE.\" if=\"profiler.configured\" name=\"profile-test-with-main\">\n+        <fail unless=\"run.class\">Must select one file in the IDE or set run.class</fail>\n+        <startprofiler/>\n+        <antcal target=\"run-test-with-main\"/>\n+    </target>\n+    <target depends=\"-profile-check,-profile-applet-pre72\" if=\"profiler.configured\" name=\"profile-applet\" unless=\"profiler.info.jvmargs.agent\">\n+        <fail unless=\"applet.url\">Must select one file in the IDE or set applet.url</fail>\n+        <startprofiler/>\n+        <antcall target=\"run-applet\"/>\n+    </target>\n+    <!--\n+                ===============\n+                JAVADOC SECTION\n+                ===============\n+            -->\n+    <target depends=\"init\" if=\"have.sources\" name=\"-javadoc-build\">\n+        <mkdir dir=\"${dist.javadoc.dir}\"/>\n+        <condition else=\"\" property=\"javadoc.endorsed.classpath.cmd.line.arg\" value=\"-J${endorsed.classpath.cmd.line.arg}\">\n+            <and>\n+                <isset property=\"endorsed.classpath.cmd.line.arg\"/>\n+                <not>\n+                    <equals arg1=\"${endorsed.classpath.cmd.line.arg}\" arg2=\"\"/>\n+                </not>\n+            </and>\n+        </condition>\n+        <exec executable=\"${platform.java}\" failonerror=\"false\" outputproperty=\"platform.version.output\">\n+            <arg value=\"-version\"/>\n+        </exec>\n+        <condition else=\"\" property=\"bug5101868workaround\" value=\"*.java\">\n+            <matches multiline=\"true\" pattern=\"1\\.[56](\\..*)?\" string=\"${platform.version.output}\"/>\n+        </condition>\n+        <javadoc additionalparam=\"-J-Dfile.encoding=${file.encoding} ${javadoc.additionalparam}\" author=\"${javadoc.author}\" charset=\"UTF-8\" destdir=\"${dist.javadoc.dir}\" docencoding=\"UTF-8\" encoding=\"${javadoc.encoding.used}\" executable=\"${platform.javadoc}\" failonerror=\"true\" noindex=\"${javadoc.noindex}\" nonavbar=\"${javadoc.nonavbar}\" notree=\"${javadoc.notree}\" private=\"${javadoc.private}\" source=\"${javac.source}\" splitindex=\"${javadoc.splitindex}\" use=\"${javadoc.use}\" useexternalfile=\"true\" version=\"${javadoc.version}\" windowtitle=\"${javadoc.windowtitle}\">\n+            <classpath>\n+                <path path=\"${javac.classpath}\"/>\n+            </classpath>\n+            <fileset dir=\"${src.dir}\" excludes=\"${bug5101868workaround},${excludes}\" includes=\"${includes}\">\n+                <filename name=\"**/*.java\"/>\n+            </fileset>\n+            <fileset dir=\"${build.generated.sources.dir}\" erroronmissingdir=\"false\">\n+                <include name=\"**/*.java\"/>\n+                <exclude name=\"*.java\"/>\n+            </fileset>\n+            <arg line=\"${javadoc.endorsed.classpath.cmd.line.arg}\"/>\n+        </javadoc>\n+        <copy todir=\"${dist.javadoc.dir}\">\n+            <fileset dir=\"${src.dir}\" excludes=\"${excludes}\" includes=\"${includes}\">\n+                <filename name=\"**/doc-files/**\"/>\n+            </fileset>\n+            <fileset dir=\"${build.generated.sources.dir}\" erroronmissingdir=\"false\">\n+                <include name=\"**/doc-files/**\"/>\n+            </fileset>\n+        </copy>\n+    </target>\n+    <target depends=\"init,-javadoc-build\" if=\"netbeans.home\" name=\"-javadoc-browse\" unless=\"no.javadoc.preview\">\n+        <nbbrowse file=\"${dist.javadoc.dir}/index.html\"/>\n+    </target>\n+    <target depends=\"init,-javadoc-build,-javadoc-browse\" description=\"Build Javadoc.\" name=\"javadoc\"/>\n+    <!--\n+                =========================\n+                TEST COMPILATION SECTION\n+                =========================\n+            -->\n+    <target depends=\"init,compile\" if=\"have.tests\" name=\"-pre-pre-compile-test\">\n+        <mkdir dir=\"${build.test.classes.dir}\"/>\n+    </target>\n+    <target name=\"-pre-compile-test\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target if=\"do.depend.true\" name=\"-compile-test-depend\">\n+        <j2seproject3:depend classpath=\"${javac.test.classpath}\" destdir=\"${build.test.classes.dir}\" srcdir=\"${test.src.dir}\"/>\n+    </target>\n+    <target depends=\"init,deps-jar,compile,-pre-pre-compile-test,-pre-compile-test,-compile-test-depend\" if=\"have.tests\" name=\"-do-compile-test\">\n+        <j2seproject3:javac apgeneratedsrcdir=\"${build.test.classes.dir}\" classpath=\"${javac.test.classpath}\" debug=\"true\" destdir=\"${build.test.classes.dir}\" processorpath=\"${javac.test.processorpath}\" srcdir=\"${test.src.dir}\"/>\n+        <copy todir=\"${build.test.classes.dir}\">\n+            <fileset dir=\"${test.src.dir}\" excludes=\"${build.classes.excludes},${excludes}\" includes=\"${includes}\"/>\n+        </copy>\n+    </target>\n+    <target name=\"-post-compile-test\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,compile,-pre-pre-compile-test,-pre-compile-test,-do-compile-test,-post-compile-test\" name=\"compile-test\"/>\n+    <target name=\"-pre-compile-test-single\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,deps-jar,compile,-pre-pre-compile-test,-pre-compile-test-single\" if=\"have.tests\" name=\"-do-compile-test-single\">\n+        <fail unless=\"javac.includes\">Must select some files in the IDE or set javac.includes</fail>\n+        <j2seproject3:force-recompile destdir=\"${build.test.classes.dir}\"/>\n+        <j2seproject3:javac apgeneratedsrcdir=\"${build.test.classes.dir}\" classpath=\"${javac.test.classpath}\" debug=\"true\" destdir=\"${build.test.classes.dir}\" excludes=\"\" includes=\"${javac.includes}\" processorpath=\"${javac.test.processorpath}\" sourcepath=\"${test.src.dir}\" srcdir=\"${test.src.dir}\"/>\n+        <copy todir=\"${build.test.classes.dir}\">\n+            <fileset dir=\"${test.src.dir}\" excludes=\"${build.classes.excludes},${excludes}\" includes=\"${includes}\"/>\n+        </copy>\n+    </target>\n+    <target name=\"-post-compile-test-single\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,compile,-pre-pre-compile-test,-pre-compile-test-single,-do-compile-test-single,-post-compile-test-single\" name=\"compile-test-single\"/>\n+    <!--\n+                =======================\n+                TEST EXECUTION SECTION\n+                =======================\n+            -->\n+    <target depends=\"init\" if=\"have.tests\" name=\"-pre-test-run\">\n+        <mkdir dir=\"${build.test.results.dir}\"/>\n+    </target>\n+    <target depends=\"init,compile-test,-pre-test-run\" if=\"have.tests\" name=\"-do-test-run\">\n+        <j2seproject3:test includes=\"${includes}\" testincludes=\"**/*Test.java\"/>\n+    </target>\n+    <target depends=\"init,compile-test,-pre-test-run,-do-test-run\" if=\"have.tests\" name=\"-post-test-run\">\n+        <fail if=\"tests.failed\" unless=\"ignore.failing.tests\">Some tests failed; see details above.</fail>\n+    </target>\n+    <target depends=\"init\" if=\"have.tests\" name=\"test-report\"/>\n+    <target depends=\"init\" if=\"netbeans.home+have.tests\" name=\"-test-browse\"/>\n+    <target depends=\"init,compile-test,-pre-test-run,-do-test-run,test-report,-post-test-run,-test-browse\" description=\"Run unit tests.\" name=\"test\"/>\n+    <target depends=\"init\" if=\"have.tests\" name=\"-pre-test-run-single\">\n+        <mkdir dir=\"${build.test.results.dir}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single\" if=\"have.tests\" name=\"-do-test-run-single\">\n+        <fail unless=\"test.includes\">Must select some files in the IDE or set test.includes</fail>\n+        <j2seproject3:test excludes=\"\" includes=\"${test.includes}\" testincludes=\"${test.includes}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single,-do-test-run-single\" if=\"have.tests\" name=\"-post-test-run-single\">\n+        <fail if=\"tests.failed\" unless=\"ignore.failing.tests\">Some tests failed; see details above.</fail>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single,-do-test-run-single,-post-test-run-single\" description=\"Run single unit test.\" name=\"test-single\"/>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single\" if=\"have.tests\" name=\"-do-test-run-single-method\">\n+        <fail unless=\"test.class\">Must select some files in the IDE or set test.class</fail>\n+        <fail unless=\"test.method\">Must select some method in the IDE or set test.method</fail>\n+        <j2seproject3:test excludes=\"\" includes=\"${javac.includes}\" testincludes=\"${test.class}\" testmethods=\"${test.method}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single,-do-test-run-single-method\" if=\"have.tests\" name=\"-post-test-run-single-method\">\n+        <fail if=\"tests.failed\" unless=\"ignore.failing.tests\">Some tests failed; see details above.</fail>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single,-do-test-run-single-method,-post-test-run-single-method\" description=\"Run single unit test.\" name=\"test-single-method\"/>\n+    <!--\n+                =======================\n+                TEST DEBUGGING SECTION\n+                =======================\n+            -->\n+    <target depends=\"init,compile-test-single,-pre-test-run-single\" if=\"have.tests\" name=\"-debug-start-debuggee-test\">\n+        <fail unless=\"test.class\">Must select one file in the IDE or set test.class</fail>\n+        <j2seproject3:test-debug excludes=\"\" includes=\"${javac.includes}\" testClass=\"${test.class}\" testincludes=\"${javac.includes}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-pre-test-run-single\" if=\"have.tests\" name=\"-debug-start-debuggee-test-method\">\n+        <fail unless=\"test.class\">Must select one file in the IDE or set test.class</fail>\n+        <fail unless=\"test.method\">Must select some method in the IDE or set test.method</fail>\n+        <j2seproject3:test-debug excludes=\"\" includes=\"${javac.includes}\" testClass=\"${test.class}\" testMethod=\"${test.method}\" testincludes=\"${test.class}\" testmethods=\"${test.method}\"/>\n+    </target>\n+    <target depends=\"init,compile-test\" if=\"netbeans.home+have.tests\" name=\"-debug-start-debugger-test\">\n+        <j2seproject1:nbjpdastart classpath=\"${debug.test.classpath}\" name=\"${test.class}\"/>\n+    </target>\n+    <target depends=\"init,compile-test-single,-debug-start-debugger-test,-debug-start-debuggee-test\" name=\"debug-test\"/>\n+    <target depends=\"init,compile-test-single,-debug-start-debugger-test,-debug-start-debuggee-test-method\" name=\"debug-test-method\"/>\n+    <target depends=\"init,-pre-debug-fix,compile-test-single\" if=\"netbeans.home\" name=\"-do-debug-fix-test\">\n+        <j2seproject1:nbjpdareload dir=\"${build.test.classes.dir}\"/>\n+    </target>\n+    <target depends=\"init,-pre-debug-fix,-do-debug-fix-test\" if=\"netbeans.home\" name=\"debug-fix-test\"/>\n+    <!--\n+                =========================\n+                APPLET EXECUTION SECTION\n+                =========================\n+            -->\n+    <target depends=\"init,compile-single\" name=\"run-applet\">\n+        <fail unless=\"applet.url\">Must select one file in the IDE or set applet.url</fail>\n+        <j2seproject1:java classname=\"sun.applet.AppletViewer\">\n+            <customize>\n+                <arg value=\"${applet.url}\"/>\n+            </customize>\n+        </j2seproject1:java>\n+    </target>\n+    <!--\n+                =========================\n+                APPLET DEBUGGING  SECTION\n+                =========================\n+            -->\n+    <target depends=\"init,compile-single\" if=\"netbeans.home\" name=\"-debug-start-debuggee-applet\">\n+        <fail unless=\"applet.url\">Must select one file in the IDE or set applet.url</fail>\n+        <j2seproject3:debug classname=\"sun.applet.AppletViewer\">\n+            <customize>\n+                <arg value=\"${applet.url}\"/>\n+            </customize>\n+        </j2seproject3:debug>\n+    </target>\n+    <target depends=\"init,compile-single,-debug-start-debugger,-debug-start-debuggee-applet\" if=\"netbeans.home\" name=\"debug-applet\"/>\n+    <!--\n+                ===============\n+                CLEANUP SECTION\n+                ===============\n+            -->\n+    <target name=\"-deps-clean-init\" unless=\"built-clean.properties\">\n+        <property location=\"${build.dir}/built-clean.properties\" name=\"built-clean.properties\"/>\n+        <delete file=\"${built-clean.properties}\" quiet=\"true\"/>\n+    </target>\n+    <target if=\"already.built.clean.${basedir}\" name=\"-warn-already-built-clean\">\n+        <echo level=\"warn\" message=\"Cycle detected: MapleSkillbookChanceFetcher was already built\"/>\n+    </target>\n+    <target depends=\"init,-deps-clean-init\" name=\"deps-clean\" unless=\"no.deps\">\n+        <mkdir dir=\"${build.dir}\"/>\n+        <touch file=\"${built-clean.properties}\" verbose=\"false\"/>\n+        <property file=\"${built-clean.properties}\" prefix=\"already.built.clean.\"/>\n+        <antcall target=\"-warn-already-built-clean\"/>\n+        <propertyfile file=\"${built-clean.properties}\">\n+            <entry key=\"${basedir}\" value=\"\"/>\n+        </propertyfile>\n+    </target>\n+    <target depends=\"init\" name=\"-do-clean\">\n+        <delete dir=\"${build.dir}\"/>\n+        <delete dir=\"${dist.dir}\" followsymlinks=\"false\" includeemptydirs=\"true\"/>\n+    </target>\n+    <target name=\"-post-clean\">\n+        <!-- Empty placeholder for easier customization. -->\n+        <!-- You can override this target in the ../build.xml file. -->\n+    </target>\n+    <target depends=\"init,deps-clean,-do-clean,-post-clean\" description=\"Clean build products.\" name=\"clean\"/>\n+    <target name=\"-check-call-dep\">\n+        <property file=\"${call.built.properties}\" prefix=\"already.built.\"/>\n+        <condition property=\"should.call.dep\">\n+            <and>\n+                <not>\n+                    <isset property=\"already.built.${call.subproject}\"/>\n+                </not>\n+                <available file=\"${call.script}\"/>\n+            </and>\n+        </condition>\n+    </target>\n+    <target depends=\"-check-call-dep\" if=\"should.call.dep\" name=\"-maybe-call-dep\">\n+        <ant antfile=\"${call.script}\" inheritall=\"false\" target=\"${call.target}\">\n+            <propertyset>\n+                <propertyref prefix=\"transfer.\"/>\n+                <mapper from=\"transfer.*\" to=\"*\" type=\"glob\"/>\n+            </propertyset>\n+        </ant>\n+    </target>\n+</project>"}, {"sha": "54707bdeab7b1b26937b0c38c2d10e5ce716e907", "filename": "tools/MapleSkillbookChanceFetcher/nbproject/genfiles.properties", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/genfiles.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/genfiles.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/nbproject/genfiles.properties?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,8 @@\n+build.xml.data.CRC32=661885c2\n+build.xml.script.CRC32=5e98558c\n+build.xml.stylesheet.CRC32=8064a381@1.75.2.48\n+# This file is used by a NetBeans-based IDE to track changes in generated files such as build-impl.xml.\n+# Do not edit this file. You may delete it but then the IDE will never regenerate such files for you.\n+nbproject/build-impl.xml.data.CRC32=661885c2\n+nbproject/build-impl.xml.script.CRC32=73de760b\n+nbproject/build-impl.xml.stylesheet.CRC32=876e7a8f@1.75.2.48"}, {"sha": "9c0ca12f7ec0aed32f45ba235ddc79568fc9964f", "filename": "tools/MapleSkillbookChanceFetcher/nbproject/project.properties", "status": "added", "additions": 77, "deletions": 0, "changes": 77, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/nbproject/project.properties?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,77 @@\n+annotation.processing.enabled=true\n+annotation.processing.enabled.in.editor=false\n+annotation.processing.processors.list=\n+annotation.processing.run.all.processors=true\n+annotation.processing.source.output=${build.generated.sources.dir}/ap-source-output\n+application.title=MapleSkillbookChanceFetcher\n+application.vendor=USER\n+build.classes.dir=${build.dir}/classes\n+build.classes.excludes=**/*.java,**/*.form\n+# This directory is removed when the project is cleaned:\n+build.dir=build\n+build.generated.dir=${build.dir}/generated\n+build.generated.sources.dir=${build.dir}/generated-sources\n+# Only compile against the classpath explicitly listed here:\n+build.sysclasspath=ignore\n+build.test.classes.dir=${build.dir}/test/classes\n+build.test.results.dir=${build.dir}/test/results\n+# Uncomment to specify the preferred debugger connection transport:\n+#debug.transport=dt_socket\n+debug.classpath=\\\n+    ${run.classpath}\n+debug.test.classpath=\\\n+    ${run.test.classpath}\n+# Os arquivos em build.classes.dir que devem ser exclu\\u00eddos do jar de distribui\\u00e7\\u00e3o\n+dist.archive.excludes=\n+# This directory is removed when the project is cleaned:\n+dist.dir=dist\n+dist.jar=${dist.dir}/MapleSkillbookChanceFetcher.jar\n+dist.javadoc.dir=${dist.dir}/javadoc\n+endorsed.classpath=\n+excludes=\n+file.reference.mysql-connector-java-bin.jar=lib/mysql-connector-java-bin.jar\n+includes=**\n+jar.compress=false\n+javac.classpath=\\\n+    ${file.reference.mysql-connector-java-bin.jar}\n+# Space-separated list of extra javac options\n+javac.compilerargs=\n+javac.deprecation=false\n+javac.processorpath=\\\n+    ${javac.classpath}\n+javac.source=1.7\n+javac.target=1.7\n+javac.test.classpath=\\\n+    ${javac.classpath}:\\\n+    ${build.classes.dir}\n+javac.test.processorpath=\\\n+    ${javac.test.classpath}\n+javadoc.additionalparam=\n+javadoc.author=false\n+javadoc.encoding=${source.encoding}\n+javadoc.noindex=false\n+javadoc.nonavbar=false\n+javadoc.notree=false\n+javadoc.private=false\n+javadoc.splitindex=true\n+javadoc.use=true\n+javadoc.version=false\n+javadoc.windowtitle=\n+main.class=mapleskillbookchancefetcher.MapleSkillbookChanceFetcher\n+manifest.file=manifest.mf\n+meta.inf.dir=${src.dir}/META-INF\n+mkdist.disabled=false\n+platform.active=JDK_1.7\n+run.classpath=\\\n+    ${javac.classpath}:\\\n+    ${build.classes.dir}\n+# Space-separated list of JVM arguments used when running the project.\n+# You may also define separate properties like run-sys-prop.name=value instead of -Dname=value.\n+# To set system properties for unit tests define test-sys-prop.name=value:\n+run.jvmargs=\n+run.test.classpath=\\\n+    ${javac.test.classpath}:\\\n+    ${build.test.classes.dir}\n+source.encoding=UTF-8\n+src.dir=src\n+test.src.dir=test"}, {"sha": "51d885e7453f97b8d84a392c7aff329a3ea75af9", "filename": "tools/MapleSkillbookChanceFetcher/nbproject/project.xml", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/project.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/nbproject/project.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/nbproject/project.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,16 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://www.netbeans.org/ns/project/1\">\n+    <type>org.netbeans.modules.java.j2seproject</type>\n+    <configuration>\n+        <data xmlns=\"http://www.netbeans.org/ns/j2se-project/3\">\n+            <name>MapleSkillbookChanceFetcher</name>\n+            <explicit-platform explicit-source-supported=\"true\"/>\n+            <source-roots>\n+                <root id=\"src.dir\"/>\n+            </source-roots>\n+            <test-roots>\n+                <root id=\"test.src.dir\"/>\n+            </test-roots>\n+        </data>\n+    </configuration>\n+</project>"}, {"sha": "5520ba35017e95e383f631420a2b4661cc943d3d", "filename": "tools/MapleSkillbookChanceFetcher/src/life/Element.java", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/Element.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/Element.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/life/Element.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,46 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package life;\n+\n+public enum Element {\n+    NEUTRAL, FIRE, ICE, LIGHTING, POISON, HOLY, DARK;\n+\n+    public static Element getFromChar(char c) {\n+        switch (Character.toUpperCase(c)) {\n+            case 'F':\n+                return FIRE;\n+            case 'I':\n+                return ICE;\n+            case 'L':\n+                return LIGHTING;\n+            case 'S':\n+                return POISON;\n+            case 'H':\n+                return HOLY;\n+            case 'D':\n+            \treturn DARK;\n+            case 'P':\n+                return NEUTRAL;\n+        }\n+        throw new IllegalArgumentException(\"unknown elemnt char \" + c);\n+    }\n+}"}, {"sha": "f8d23ef5c7ce719cf8660d29c7e09fa901dbb682", "filename": "tools/MapleSkillbookChanceFetcher/src/life/ElementalEffectiveness.java", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/ElementalEffectiveness.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/ElementalEffectiveness.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/life/ElementalEffectiveness.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,41 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package life;\n+\n+public enum ElementalEffectiveness {\n+    NORMAL, IMMUNE, STRONG, WEAK, NEUTRAL;\n+\n+    public static ElementalEffectiveness getByNumber(int num) {\n+        switch (num) {\n+            case 1:\n+                return IMMUNE;\n+            case 2:\n+                return STRONG;\n+            case 3:\n+                return WEAK;\n+            case 4:\n+                return NEUTRAL;\n+            default:\n+                throw new IllegalArgumentException(\"Unkown effectiveness: \" + num);\n+        }\n+    }\n+}"}, {"sha": "23ccd67e43d453cabdb9d9e873ff6b0843767354", "filename": "tools/MapleSkillbookChanceFetcher/src/life/MapleLifeFactory.java", "status": "added", "additions": 240, "deletions": 0, "changes": 240, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/MapleLifeFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/MapleLifeFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/life/MapleLifeFactory.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,240 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License as\n+published by the Free Software Foundation version 3 as published by\n+the Free Software Foundation. You may not use, modify or distribute\n+this program under any other version of the GNU Affero General Public\n+License.\n+\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package life;\n+\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataFileEntry;\n+import provider.MapleDataProvider;\n+import provider.MapleDataProviderFactory;\n+import provider.MapleDataTool;\n+import provider.wz.MapleDataType;\n+import tools.Pair;\n+\n+public class MapleLifeFactory {\n+    private static String wzPath = \"../../wz\";\n+    private static MapleDataProvider data = MapleDataProviderFactory.getDataProvider(new File(wzPath + \"/Mob.wz\"));\n+    private final static MapleDataProvider stringDataWZ = MapleDataProviderFactory.getDataProvider(new File(wzPath + \"/String.wz\"));\n+    private static MapleData mobStringData = stringDataWZ.getData(\"Mob.img\");\n+    private static MapleData npcStringData = stringDataWZ.getData(\"Npc.img\");\n+    private static Map<Integer, MapleMonsterStats> monsterStats = new HashMap<>();\n+\n+    private static int getMonsterId(String fileName) {\n+        return Integer.parseInt(fileName.substring(0, 7));\n+    }\n+    \n+    public static Map<Integer, MapleMonsterStats> getAllMonsterStats() {\n+        MapleDataDirectoryEntry root = data.getRoot();\n+        \n+        System.out.print(\"Parsing mob stats... \");\n+        for (MapleDataFileEntry mFile : root.getFiles()) {\n+            try {\n+                String fileName = mFile.getName();\n+                \n+                //System.out.println(\"Parsing '\" + fileName + \"'\");\n+                MapleData monsterData = data.getData(fileName);\n+                if (monsterData == null) {\n+                    continue;\n+                }\n+                \n+                Integer mid = getMonsterId(fileName);\n+        \n+                MapleData monsterInfoData = monsterData.getChildByPath(\"info\");\n+                MapleMonsterStats stats = new MapleMonsterStats();\n+                stats.setHp(MapleDataTool.getIntConvert(\"maxHP\", monsterInfoData));\n+                stats.setFriendly(MapleDataTool.getIntConvert(\"damagedByMob\", monsterInfoData, 0) == 1);\n+                stats.setPADamage(MapleDataTool.getIntConvert(\"PADamage\", monsterInfoData));\n+                stats.setPDDamage(MapleDataTool.getIntConvert(\"PDDamage\", monsterInfoData));\n+                stats.setMADamage(MapleDataTool.getIntConvert(\"MADamage\", monsterInfoData));\n+                stats.setMDDamage(MapleDataTool.getIntConvert(\"MDDamage\", monsterInfoData));  \n+                stats.setMp(MapleDataTool.getIntConvert(\"maxMP\", monsterInfoData, 0));\n+                stats.setExp(MapleDataTool.getIntConvert(\"exp\", monsterInfoData, 0));\n+                stats.setLevel(MapleDataTool.getIntConvert(\"level\", monsterInfoData));\n+                stats.setRemoveAfter(MapleDataTool.getIntConvert(\"removeAfter\", monsterInfoData, 0));\n+                stats.setBoss(MapleDataTool.getIntConvert(\"boss\", monsterInfoData, 0) > 0);\n+                stats.setExplosiveReward(MapleDataTool.getIntConvert(\"explosiveReward\", monsterInfoData, 0) > 0);\n+                stats.setFfaLoot(MapleDataTool.getIntConvert(\"publicReward\", monsterInfoData, 0) > 0);\n+                stats.setUndead(MapleDataTool.getIntConvert(\"undead\", monsterInfoData, 0) > 0);\n+                stats.setName(MapleDataTool.getString(mid + \"/name\", mobStringData, \"MISSINGNO\"));\n+                stats.setBuffToGive(MapleDataTool.getIntConvert(\"buff\", monsterInfoData, -1));\n+                stats.setCP(MapleDataTool.getIntConvert(\"getCP\", monsterInfoData, 0));\n+                stats.setRemoveOnMiss(MapleDataTool.getIntConvert(\"removeOnMiss\", monsterInfoData, 0) > 0);\n+\n+                MapleData special = monsterInfoData.getChildByPath(\"coolDamage\");\n+                if (special != null) {\n+                    int coolDmg = MapleDataTool.getIntConvert(\"coolDamage\", monsterInfoData);\n+                    int coolProb = MapleDataTool.getIntConvert(\"coolDamageProb\", monsterInfoData, 0);\n+                    stats.setCool(new Pair<>(coolDmg, coolProb));\n+                }\n+                special = monsterInfoData.getChildByPath(\"loseItem\");\n+                if (special != null) {\n+                    for (MapleData liData : special.getChildren()) {\n+                        stats.addLoseItem(new loseItem(MapleDataTool.getInt(liData.getChildByPath(\"id\")), (byte) MapleDataTool.getInt(liData.getChildByPath(\"prop\")), (byte) MapleDataTool.getInt(liData.getChildByPath(\"x\"))));\n+                    }\n+                }\n+                special = monsterInfoData.getChildByPath(\"selfDestruction\");\n+                if (special != null) {\n+                    stats.setSelfDestruction(new selfDestruction((byte) MapleDataTool.getInt(special.getChildByPath(\"action\")), MapleDataTool.getIntConvert(\"removeAfter\", special, -1), MapleDataTool.getIntConvert(\"hp\", special, -1)));\n+                }\n+                MapleData firstAttackData = monsterInfoData.getChildByPath(\"firstAttack\");\n+                int firstAttack = 0;\n+                if (firstAttackData != null) {\n+                    if (firstAttackData.getType() == MapleDataType.FLOAT) {\n+                        firstAttack = Math.round(MapleDataTool.getFloat(firstAttackData));\n+                    } else {\n+                        firstAttack = MapleDataTool.getInt(firstAttackData);\n+                    }\n+                }\n+                stats.setFirstAttack(firstAttack > 0);\n+                stats.setDropPeriod(MapleDataTool.getIntConvert(\"dropItemPeriod\", monsterInfoData, 0) * 10000);\n+\n+                stats.setTagColor(MapleDataTool.getIntConvert(\"hpTagColor\", monsterInfoData, 0));\n+                stats.setTagBgColor(MapleDataTool.getIntConvert(\"hpTagBgcolor\", monsterInfoData, 0));\n+\n+                for (MapleData idata : monsterData) {\n+                    if (!idata.getName().equals(\"info\")) {\n+                        int delay = 0;\n+                        for (MapleData pic : idata.getChildren()) {\n+                            delay += MapleDataTool.getIntConvert(\"delay\", pic, 0);\n+                        }\n+                        stats.setAnimationTime(idata.getName(), delay);\n+                    }\n+                }\n+                MapleData reviveInfo = monsterInfoData.getChildByPath(\"revive\");\n+                if (reviveInfo != null) {\n+                    List<Integer> revives = new LinkedList<>();\n+                    for (MapleData data_ : reviveInfo) {\n+                        revives.add(MapleDataTool.getInt(data_));\n+                    }\n+                    stats.setRevives(revives);\n+                }\n+                decodeElementalString(stats, MapleDataTool.getString(\"elemAttr\", monsterInfoData, \"\"));\n+                MapleData monsterSkillData = monsterInfoData.getChildByPath(\"skill\");\n+                if (monsterSkillData != null) {\n+                    int i = 0;\n+                    List<Pair<Integer, Integer>> skills = new ArrayList<>();\n+                    while (monsterSkillData.getChildByPath(Integer.toString(i)) != null) {\n+                        skills.add(new Pair<>(Integer.valueOf(MapleDataTool.getInt(i + \"/skill\", monsterSkillData, 0)), Integer.valueOf(MapleDataTool.getInt(i + \"/level\", monsterSkillData, 0))));\n+                        i++;\n+                    }\n+                    stats.setSkills(skills);\n+                }\n+                MapleData banishData = monsterInfoData.getChildByPath(\"ban\");\n+                if (banishData != null) {\n+                    stats.setBanishInfo(new BanishInfo(MapleDataTool.getString(\"banMsg\", banishData), MapleDataTool.getInt(\"banMap/0/field\", banishData, -1), MapleDataTool.getString(\"banMap/0/portal\", banishData, \"sp\")));\n+                }\n+                \n+                monsterStats.put(mid, stats);\n+            } catch(NullPointerException npe) {\n+                //System.out.println(\"[SEVERE] \" + mFile.getName() + \" failed to load. Issue: \" + npe.getMessage() + \"\\n\\n\");\n+            }\n+        }\n+        \n+        System.out.println(\"done!\");\n+        return monsterStats;\n+    }\n+\n+    private static void decodeElementalString(MapleMonsterStats stats, String elemAttr) {\n+        for (int i = 0; i < elemAttr.length(); i += 2) {\n+            stats.setEffectiveness(Element.getFromChar(elemAttr.charAt(i)), ElementalEffectiveness.getByNumber(Integer.valueOf(String.valueOf(elemAttr.charAt(i + 1)))));\n+        }\n+    }\n+\n+    public static class BanishInfo {\n+\n+        private int map;\n+        private String portal, msg;\n+\n+        public BanishInfo(String msg, int map, String portal) {\n+            this.msg = msg;\n+            this.map = map;\n+            this.portal = portal;\n+        }\n+\n+        public int getMap() {\n+            return map;\n+        }\n+\n+        public String getPortal() {\n+            return portal;\n+        }\n+\n+        public String getMsg() {\n+            return msg;\n+        }\n+    }\n+\n+    public static class loseItem {\n+\n+        private int id;\n+        private byte chance, x;\n+\n+        private loseItem(int id, byte chance, byte x) {\n+            this.id = id;\n+            this.chance = chance;\n+            this.x = x;\n+        }\n+\n+        public int getId() {\n+            return id;\n+        }\n+\n+        public byte getChance() {\n+            return chance;\n+        }\n+\n+        public byte getX() {\n+            return x;\n+        }\n+    }\n+\n+    public static class selfDestruction {\n+\n+        private byte action;\n+        private int removeAfter;\n+        private int hp;\n+\n+        private selfDestruction(byte action, int removeAfter, int hp) {\n+            this.action = action;\n+            this.removeAfter = removeAfter;\n+            this.hp = hp;\n+        }\n+\n+        public int getHp() {\n+            return hp;\n+        }\n+        \n+        public byte getAction() {\n+            return action;\n+        }\n+\n+        public int removeAfter() {\n+            return removeAfter;\n+        }\n+    }\n+}"}, {"sha": "42b091545d642745bb1b54e127e8901698d220aa", "filename": "tools/MapleSkillbookChanceFetcher/src/life/MapleMonsterStats.java", "status": "added", "additions": 336, "deletions": 0, "changes": 336, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/MapleMonsterStats.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/life/MapleMonsterStats.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/life/MapleMonsterStats.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,336 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package life;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import life.MapleLifeFactory.BanishInfo;\n+import life.MapleLifeFactory.loseItem;\n+import life.MapleLifeFactory.selfDestruction;\n+import tools.Pair;\n+\n+/**\n+ * @author Frz\n+ */\n+public class MapleMonsterStats {\n+    private boolean changeable;\n+    private int exp, hp, mp, level, PADamage, PDDamage, MADamage, MDDamage, dropPeriod, cp, buffToGive, removeAfter;\n+    private boolean boss, undead, ffaLoot, isExplosiveReward, firstAttack, removeOnMiss;\n+    private String name;\n+    private Map<String, Integer> animationTimes = new HashMap<String, Integer>();\n+    private Map<Element, ElementalEffectiveness> resistance = new HashMap<Element, ElementalEffectiveness>();\n+    private List<Integer> revives = Collections.emptyList();\n+    private byte tagColor, tagBgColor;\n+    private List<Pair<Integer, Integer>> skills = new ArrayList<Pair<Integer, Integer>>();\n+    private Pair<Integer, Integer> cool = null;\n+    private BanishInfo banish = null;\n+    private List<loseItem> loseItem = null;\n+    private selfDestruction selfDestruction = null;\n+    private boolean friendly;\n+\n+    public void setChange(boolean change) {\n+        this.changeable = change;\n+    }\n+\n+    public boolean isChangeable() {\n+        return changeable;\n+    }\n+    \n+    public int getExp() {\n+        return exp;\n+    }\n+\n+    public void setExp(int exp) {\n+        this.exp = exp;\n+    }\n+\n+    public int getHp() {\n+        return hp;\n+    }\n+\n+    public void setHp(int hp) {\n+        this.hp = hp;\n+    }\n+\n+    public int getMp() {\n+        return mp;\n+    }\n+\n+    public void setMp(int mp) {\n+        this.mp = mp;\n+    }\n+\n+    public int getLevel() {\n+        return level;\n+    }\n+\n+    public void setLevel(int level) {\n+        this.level = level;\n+    }\n+\n+    public int removeAfter() {\n+        return removeAfter;\n+    }\n+\n+    public void setRemoveAfter(int removeAfter) {\n+        this.removeAfter = removeAfter;\n+    }\n+\n+    public int getDropPeriod() {\n+        return dropPeriod;\n+    }\n+\n+    public void setDropPeriod(int dropPeriod) {\n+        this.dropPeriod = dropPeriod;\n+    }\n+\n+    public void setBoss(boolean boss) {\n+        this.boss = boss;\n+    }\n+\n+    public boolean isBoss() {\n+        return boss;\n+    }\n+\n+    public void setFfaLoot(boolean ffaLoot) {\n+        this.ffaLoot = ffaLoot;\n+    }\n+\n+    public boolean isFfaLoot() {\n+        return ffaLoot;\n+    }\n+\n+    public void setAnimationTime(String name, int delay) {\n+        animationTimes.put(name, delay);\n+    }\n+\n+    public int getAnimationTime(String name) {\n+        Integer ret = animationTimes.get(name);\n+        if (ret == null) {\n+            return 500;\n+        }\n+        return ret.intValue();\n+    }\n+\n+    public boolean isMobile() {\n+        return animationTimes.containsKey(\"move\") || animationTimes.containsKey(\"fly\");\n+    }\n+\n+    public List<Integer> getRevives() {\n+        return revives;\n+    }\n+\n+    public void setRevives(List<Integer> revives) {\n+        this.revives = revives;\n+    }\n+\n+    public void setUndead(boolean undead) {\n+        this.undead = undead;\n+    }\n+\n+    public boolean getUndead() {\n+        return undead;\n+    }\n+\n+    public void setEffectiveness(Element e, ElementalEffectiveness ee) {\n+        resistance.put(e, ee);\n+    }\n+\n+    public ElementalEffectiveness getEffectiveness(Element e) {\n+        ElementalEffectiveness elementalEffectiveness = resistance.get(e);\n+        if (elementalEffectiveness == null) {\n+            return ElementalEffectiveness.NORMAL;\n+        } else {\n+            return elementalEffectiveness;\n+        }\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public byte getTagColor() {\n+        return tagColor;\n+    }\n+\n+    public void setTagColor(int tagColor) {\n+        this.tagColor = (byte) tagColor;\n+    }\n+\n+    public byte getTagBgColor() {\n+        return tagBgColor;\n+    }\n+\n+    public void setTagBgColor(int tagBgColor) {\n+        this.tagBgColor = (byte) tagBgColor;\n+    }\n+\n+    public void setSkills(List<Pair<Integer, Integer>> skills) {\n+        for (Pair<Integer, Integer> skill : skills) {\n+            this.skills.add(skill);\n+        }\n+    }\n+\n+    public List<Pair<Integer, Integer>> getSkills() {\n+        return Collections.unmodifiableList(this.skills);\n+    }\n+\n+    public int getNoSkills() {\n+        return this.skills.size();\n+    }\n+\n+    public boolean hasSkill(int skillId, int level) {\n+        for (Pair<Integer, Integer> skill : skills) {\n+            if (skill.getLeft() == skillId && skill.getRight() == level) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    public void setFirstAttack(boolean firstAttack) {\n+        this.firstAttack = firstAttack;\n+    }\n+\n+    public boolean isFirstAttack() {\n+        return firstAttack;\n+    }\n+\n+    public void setBuffToGive(int buff) {\n+        this.buffToGive = buff;\n+    }\n+\n+    public int getBuffToGive() {\n+        return buffToGive;\n+    }\n+\n+    void removeEffectiveness(Element e) {\n+        resistance.remove(e);\n+    }\n+\n+    public BanishInfo getBanishInfo() {\n+        return banish;\n+    }\n+\n+    public void setBanishInfo(BanishInfo banish) {\n+        this.banish = banish;\n+    }\n+\n+    public int getPADamage() {\n+        return PADamage;\n+    }\n+\n+    public void setPADamage(int PADamage) {\n+        this.PADamage = PADamage;\n+    }\n+\n+    public int getCP() {\n+        return cp;\n+    }\n+\n+    public void setCP(int cp) {\n+        this.cp = cp;\n+    }\n+\n+    public List<loseItem> loseItem() {\n+        return loseItem;\n+    }\n+\n+    public void addLoseItem(loseItem li) {\n+        if (loseItem == null) {\n+            loseItem = new LinkedList<loseItem>();\n+        }\n+        loseItem.add(li);\n+    }\n+\n+    public selfDestruction selfDestruction() {\n+        return selfDestruction;\n+    }\n+\n+    public void setSelfDestruction(selfDestruction sd) {\n+        this.selfDestruction = sd;\n+    }\n+    \n+    public void setExplosiveReward(boolean isExplosiveReward) {\n+        this.isExplosiveReward = isExplosiveReward;\n+    }\n+\n+    public boolean isExplosiveReward() {\n+        return isExplosiveReward;\n+    }\n+\n+    public void setRemoveOnMiss(boolean removeOnMiss) {\n+        this.removeOnMiss = removeOnMiss;\n+    }\n+\n+    public boolean removeOnMiss() {\n+        return removeOnMiss;\n+    }\n+\n+    public void setCool(Pair<Integer, Integer> cool) {\n+        this.cool = cool;\n+    }\n+\n+    public Pair<Integer, Integer> getCool() {\n+        return cool;\n+    }\n+    \n+    public int getPDDamage() {\n+        return PDDamage;\n+    }\n+    \n+    public int getMADamage() {\n+        return MADamage;\n+    }\n+    \n+    public int getMDDamage() {\n+        return MDDamage;\n+    }\n+    \n+    public boolean isFriendly() {\n+        return friendly;\n+    }\n+    \n+    public void setFriendly(boolean value) {\n+        this.friendly = value;\n+    }\n+    \n+    public void setPDDamage(int PDDamage) {\n+        this.PDDamage = PDDamage;\n+    }\n+    \n+    public void setMADamage(int MADamage) {\n+        this.MADamage = MADamage;\n+    }\n+    \n+    public void setMDDamage(int MDDamage) {\n+        this.MDDamage = MDDamage;\n+    } \n+}"}, {"sha": "b28c4b499e1b90ba4c6e3e6b51d37cce6cd8129d", "filename": "tools/MapleSkillbookChanceFetcher/src/mapleskillbookchancefetcher/MapleSkillbookChanceFetcher.java", "status": "added", "additions": 159, "deletions": 0, "changes": 159, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/mapleskillbookchancefetcher/MapleSkillbookChanceFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/mapleskillbookchancefetcher/MapleSkillbookChanceFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/mapleskillbookchancefetcher/MapleSkillbookChanceFetcher.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,159 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package mapleskillbookchancefetcher;\n+\n+import life.MapleLifeFactory;\n+import life.MapleMonsterStats;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+\n+import java.io.*;\n+import java.util.Collections;\n+import java.util.Comparator;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import tools.DatabaseConnection;\n+import tools.Pair;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ * \n+ * This application traces missing meso drop data on the underlying DB (that must be\n+ * defined on the DatabaseConnection file of this project) and generates a\n+ * SQL file that proposes missing drop entries for the drop_data table.\n+ * \n+ * The meso range is calculated accordingly with the target mob stats, such as level\n+ * and if it's a boss or not, similarly as how it has been done for the actual meso\n+ * drops.\n+ * \n+ */\n+public class MapleSkillbookChanceFetcher {\n+\n+    private static PrintWriter printWriter;\n+    private static String newFile = \"lib/skillbook_drop_data.sql\";\n+    \n+    private static Map<Integer, MapleMonsterStats> mobStats;\n+    private static Map<Pair<Integer, Integer>, Integer> skillbookChances = new HashMap<>();\n+    \n+    private static List<Entry<Pair<Integer, Integer>, Integer>> sortedSkillbookChances() {\n+        List<Entry<Pair<Integer, Integer>, Integer>> skillbookChancesList = new ArrayList<>(skillbookChances.entrySet());\n+        \n+        Collections.sort(skillbookChancesList, new Comparator<Entry<Pair<Integer, Integer>, Integer>>() {\n+            @Override\n+            public int compare(Entry<Pair<Integer, Integer>, Integer> o1, Entry<Pair<Integer, Integer>, Integer> o2) {\n+                if (o1.getKey().getLeft().equals(o2.getKey().getLeft())) {\n+                    return o1.getKey().getRight() < o2.getKey().getRight() ? -1 : (o1.getKey().getRight().equals(o2.getKey().getRight()) ? 0 : 1);\n+                }\n+                \n+                return (o1.getKey().getLeft() < o2.getKey().getLeft()) ? -1 : 1;\n+            }\n+        });\n+        \n+        return skillbookChancesList;\n+    }\n+            \n+    private static boolean isLegendSkillUpgradeBook(int itemid) {\n+        int itemidBranch = itemid / 10000;\n+        return (itemidBranch == 228 && itemid >= 2280013 || itemidBranch == 229 && itemid >= 2290126);      // drop rate of Legends are higher\n+    }\n+    \n+    private static void fetchSkillbookDropChances() {\n+        Connection con = DatabaseConnection.getConnection();\n+        \n+        try {\n+            PreparedStatement ps = con.prepareStatement(\"SELECT dropperid, itemid FROM drop_data WHERE itemid >= 2280000 AND itemid < 2300000\");\n+            ResultSet rs = ps.executeQuery();\n+            \n+            while(rs.next()) {\n+                int mobid = rs.getInt(\"dropperid\");\n+                int itemid = rs.getInt(\"itemid\");\n+                \n+                int expectedChance = 1000;\n+                \n+                if (mobStats.get(mobid) != null) {\n+                    int level = mobStats.get(mobid).getLevel();\n+                    expectedChance *= Math.max(2, (level - 80) / 15);\n+                    \n+                    if (mobStats.get(mobid).isBoss()) {\n+                        expectedChance *= 20;\n+                    } else {\n+                        expectedChance *= 1;\n+                    }\n+                } else {\n+                    expectedChance = 1287;\n+                }\n+                \n+                if (isLegendSkillUpgradeBook(itemid)) {     // drop rate of Legends seems to be higher than explorers, in retrospect from values in DB\n+                    expectedChance *= 3;\n+                }\n+                \n+                skillbookChances.put(new Pair<>(mobid, itemid), expectedChance);\n+            }\n+            \n+            rs.close();\n+            ps.close();\n+            con.close();\n+        } catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void printSkillbookChanceUpdateSqlHeader() {\n+        printWriter.println(\" # SQL File autogenerated from the MapleSkillbookChanceFetcher feature by Ronan Lana.\");\n+        printWriter.println(\" # Generated data takes into account mob stats such as level and boss for the chance rates.\");\n+        printWriter.println();\n+        \n+        printWriter.println(\"  REPLACE INTO drop_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\");\n+    }\n+    \n+    private static void generateSkillbookChanceUpdateFile() {\n+        try {\n+            printWriter = new PrintWriter(newFile, \"UTF-8\");\n+            \n+            printSkillbookChanceUpdateSqlHeader();\n+            \n+            List<Entry<Pair<Integer, Integer>, Integer>> skillbookChancesList = sortedSkillbookChances();\n+            for (Entry<Pair<Integer, Integer>, Integer> e : skillbookChancesList) {\n+                printWriter.println(\"(\" + e.getKey().getLeft() + \", \" + e.getKey().getRight() + \", 1, 1, 0, \" + e.getValue() + \"),\");\n+            }\n+            \n+            printWriter.close();\n+        } catch (IOException ioe) {\n+            ioe.printStackTrace();\n+        }\n+    }\n+    \n+    public static void main(String[] args) {\n+        // load mob stats from WZ\n+        mobStats = MapleLifeFactory.getAllMonsterStats();\n+        \n+        fetchSkillbookDropChances();\n+        generateSkillbookChanceUpdateFile();\n+    }\n+    \n+}"}, {"sha": "10ab68219636d6faf90029f5bd485ff3a6648c56", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleCanvas.java", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleCanvas.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,30 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.awt.image.BufferedImage;\n+\n+public interface MapleCanvas {\n+    int getHeight();\n+    int getWidth();\n+    BufferedImage getImage();\n+}"}, {"sha": "4d90a9380442c23c911757c8e49cebc2141cf869", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleData.java", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleData.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleData.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleData.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,34 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.util.List;\n+import provider.wz.MapleDataType;\n+\n+public interface MapleData extends MapleDataEntity, Iterable<MapleData> {\n+    @Override\n+    public String getName();\n+    public MapleDataType getType();\n+    public List<MapleData> getChildren();\n+    public MapleData getChildByPath(String path);\n+    public Object getData();\n+}"}, {"sha": "cb043e0c945ea92f8e3aaa122e5b00a63c9588c5", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataDirectoryEntry.java", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataDirectoryEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataDirectoryEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataDirectoryEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,34 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.util.List;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataDirectoryEntry extends MapleDataEntry {\n+    public List<MapleDataDirectoryEntry> getSubdirectories();\n+    public List<MapleDataFileEntry> getFiles();\n+    public MapleDataEntry getEntry(String name);\n+}"}, {"sha": "03ff77649c8e5acc43bd9dc417bd6a5a5bde9f45", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntity.java", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntity.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntity.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntity.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,31 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataEntity {\n+    public String getName();\n+    public MapleDataEntity getParent();\n+}"}, {"sha": "62db6d0abeac3165aaa502d4098c15ce9598acab", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntry.java", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,33 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataEntry extends MapleDataEntity {\n+    public String getName();\n+    public int getSize();\n+    public int getChecksum();\n+    public int getOffset();\n+}"}, {"sha": "902130a612aeb60746ac4fd119b4f88376947472", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataFileEntry.java", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataFileEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataFileEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataFileEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,30 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataFileEntry extends MapleDataEntry {\n+    public void setOffset(int offset);\n+}"}, {"sha": "5237b7ac37e4655b807bc6d47ad4bd10a360cc49", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProvider.java", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProvider.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,27 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+public interface MapleDataProvider {\n+    MapleData getData(String path);\n+    MapleDataDirectoryEntry getRoot();\n+}"}, {"sha": "14753d440683c1c13e8012d993cfbb85b3b76e8b", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProviderFactory.java", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProviderFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProviderFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataProviderFactory.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,55 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import provider.wz.WZFile;\n+import provider.wz.XMLWZFile;\n+\n+public class MapleDataProviderFactory {\n+    private final static String wzPath = System.getProperty(\"wzpath\");\n+\n+    private static MapleDataProvider getWZ(File in, boolean provideImages) {\n+        if (in.getName().toLowerCase().endsWith(\"wz\") && !in.isDirectory()) {\n+            try {\n+                return new WZFile(in, provideImages);\n+            } catch (IOException e) {\n+                throw new RuntimeException(\"Loading WZ File failed\", e);\n+            }\n+        } else {\n+            return new XMLWZFile(in);\n+        }\n+    }\n+\n+    public static MapleDataProvider getDataProvider(File in) {\n+        return getWZ(in, false);\n+    }\n+\n+    public static MapleDataProvider getImageProvidingDataProvider(File in) {\n+        return getWZ(in, true);\n+    }\n+\n+    public static File fileInWZPath(String filename) {\n+        return new File(wzPath, filename);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "25f4c7f81749a8145359d27437f2d7075c5786c3", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/MapleDataTool.java", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/MapleDataTool.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,145 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.awt.Point;\n+import java.awt.image.BufferedImage;\n+import provider.wz.MapleDataType;\n+\n+public class MapleDataTool {\n+    public static String getString(MapleData data) {\n+        return ((String) data.getData());\n+    }\n+\n+    public static String getString(MapleData data, String def) {\n+        if (data == null || data.getData() == null) {\n+            return def;\n+        } else {\n+            return ((String) data.getData());\n+        }\n+    }\n+\n+    public static String getString(String path, MapleData data) {\n+        return getString(data.getChildByPath(path));\n+    }\n+\n+    public static String getString(String path, MapleData data, String def) {\n+        return getString(data.getChildByPath(path), def);\n+    }\n+\n+    public static double getDouble(MapleData data) {\n+        return ((Double) data.getData()).doubleValue();\n+    }\n+\n+    public static float getFloat(MapleData data) {\n+        return ((Float) data.getData()).floatValue();\n+    }\n+\n+    public static int getInt(MapleData data) {\n+        if (data == null || data.getData() == null) {\n+            return 0;// DEF?\n+        }\n+        return ((Integer) data.getData()).intValue();\n+    }\n+\n+    public static int getInt(String path, MapleData data) {\n+        return getInt(data.getChildByPath(path));\n+    }\n+\n+    public static int getIntConvert(MapleData data) {\n+        if (data.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(data));\n+        } else {\n+            return getInt(data);\n+        }\n+    }\n+\n+    public static int getIntConvert(String path, MapleData data) {\n+        MapleData d = data.getChildByPath(path);\n+        if (d.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(d));\n+        } else {\n+            return getInt(d);\n+        }\n+    }\n+\n+    public static int getInt(MapleData data, int def) {\n+        if (data == null || data.getData() == null) {\n+            return  def;\n+        } else if (data.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(data));\n+        } else {\n+            return ((Integer) data.getData()).intValue();\n+        }\n+    }\n+\n+    public static int getInt(String path, MapleData data, int def) {\n+        return getInt(data.getChildByPath(path), def);\n+    }\n+\n+    public static int getIntConvert(String path, MapleData data, int def) {\n+        MapleData d = data.getChildByPath(path);\n+        if (d == null) {\n+            return def;\n+        }\n+        if (d.getType() == MapleDataType.STRING) {\n+            try {\n+                return Integer.parseInt(getString(d));\n+            } catch (NumberFormatException nfe) {\n+                nfe.printStackTrace();\n+                return def;\n+            }\n+        } else {\n+            return getInt(d, def);\n+        }\n+    }\n+\n+    public static BufferedImage getImage(MapleData data) {\n+        return ((MapleCanvas) data.getData()).getImage();\n+    }\n+\n+    public static Point getPoint(MapleData data) {\n+        return ((Point) data.getData());\n+    }\n+\n+    public static Point getPoint(String path, MapleData data) {\n+        return getPoint(data.getChildByPath(path));\n+    }\n+\n+    public static Point getPoint(String path, MapleData data, Point def) {\n+        final MapleData pointData = data.getChildByPath(path);\n+        if (pointData == null) {\n+            return def;\n+        }\n+        return getPoint(pointData);\n+    }\n+\n+    public static String getFullDataPath(MapleData data) {\n+        String path = \"\";\n+        MapleDataEntity myData = data;\n+        while (myData != null) {\n+            path = myData.getName() + \"/\" + path;\n+            myData = myData.getParent();\n+        }\n+        return path.substring(0, path.length() - 1);\n+    }\n+}"}, {"sha": "21736c2c162063c141117bff66deb9f830b4bc06", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/FileStoredPngMapleCanvas.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,70 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import javax.imageio.ImageIO;\n+import provider.MapleCanvas;\n+\n+public class FileStoredPngMapleCanvas implements MapleCanvas {\n+    private File file;\n+    private int width;\n+    private int height;\n+    private BufferedImage image;\n+\n+    public FileStoredPngMapleCanvas(int width, int height, File fileIn) {\n+        this.width = width;\n+        this.height = height;\n+        this.file = fileIn;\n+    }\n+\n+    @Override\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    @Override\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    @Override\n+    public BufferedImage getImage() {\n+        loadImageIfNecessary();\n+        return image;\n+    }\n+\n+    private void loadImageIfNecessary() {\n+        if (image == null) {\n+            try {\n+                image = ImageIO.read(file);\n+                // replace the dimensions loaded from the wz by the REAL dimensions from the image - should be equal tho\n+                width = image.getWidth();\n+                height = image.getHeight();\n+            } catch (IOException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+    }\n+}"}, {"sha": "8add2ccb36fcfa8f1a683da0562601e9f2c0afda", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/ImgMapleSound.java", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/ImgMapleSound.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/ImgMapleSound.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/ImgMapleSound.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,39 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+public class ImgMapleSound {\n+    private int dataLength, offset;\n+\n+    public ImgMapleSound(int dataLength, int offset) {\n+        this.dataLength = dataLength;\n+        this.offset = offset;\n+    }\n+\n+    public int getDataLength() {\n+        return dataLength;\n+    }\n+\n+    public int getOffset() {\n+        return offset;\n+    }\n+}"}, {"sha": "1672a08c598cb21a441ea89664de97fdb9b9c90b", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/ListWZFile.java", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/ListWZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/ListWZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/ListWZFile.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,86 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.BufferedInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import provider.MapleDataProviderFactory;\n+import tools.data.input.GenericLittleEndianAccessor;\n+import tools.data.input.InputStreamByteStream;\n+import tools.data.input.LittleEndianAccessor;\n+\n+public class ListWZFile {\n+    private LittleEndianAccessor lea;\n+    private List<String> entries = new ArrayList<String>();\n+    private static Collection<String> modernImgs = new HashSet<String>();\n+\n+    public static byte[] xorBytes(byte[] a, byte[] b) {\n+        byte[] wusched = new byte[a.length];\n+        for (int i = 0; i < a.length; i++) {\n+            wusched[i] = (byte) (a[i] ^ b[i]);\n+        }\n+        return wusched;\n+    }\n+\n+    public ListWZFile(File listwz) throws FileNotFoundException {\n+        lea = new GenericLittleEndianAccessor(new InputStreamByteStream(new BufferedInputStream(new FileInputStream(listwz))));\n+        while (lea.available() > 0) {\n+            int l = lea.readInt() * 2;\n+            byte[] chunk = new byte[l];\n+            for (int i = 0; i < chunk.length; i++) {\n+                chunk[i] = lea.readByte();\n+            }\n+            lea.readChar();\n+            final String value = String.valueOf(WZTool.readListString(chunk));\n+            entries.add(value);\n+        }\n+        entries = Collections.unmodifiableList(entries);\n+    }\n+\n+    public List<String> getEntries() {\n+        return entries;\n+    }\n+\n+    public static void init() {\n+        final String listWz = System.getProperty(\"listwz\");\n+        if (listWz != null) {\n+            ListWZFile listwz;\n+            try {\n+                listwz = new ListWZFile(MapleDataProviderFactory.fileInWZPath(\"List.wz\"));\n+                modernImgs = new HashSet<String>(listwz.getEntries());\n+            } catch (FileNotFoundException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+    }\n+\n+    public static boolean isModernImgFile(String path) {\n+        return modernImgs.contains(path);\n+    }\n+}"}, {"sha": "e074d57d14a16e7ccc38449c8f9b10d9176215eb", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/MapleDataType.java", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/MapleDataType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/MapleDataType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/MapleDataType.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,26 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+public enum MapleDataType {\n+    NONE, IMG_0x00, SHORT, INT, FLOAT, DOUBLE, STRING, EXTENDED, PROPERTY, CANVAS, VECTOR, CONVEX, SOUND, UOL, UNKNOWN_TYPE, UNKNOWN_EXTENDED_TYPE;\n+}\n\\ No newline at end of file"}, {"sha": "97c2303804d63dbbfc36bb745fb675fff26b61a3", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/PNGMapleCanvas.java", "status": "added", "additions": 151, "deletions": 0, "changes": 151, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/PNGMapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/PNGMapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/PNGMapleCanvas.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,151 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.DataBuffer;\n+import java.awt.image.DataBufferByte;\n+import java.awt.image.PixelInterleavedSampleModel;\n+import java.awt.image.Raster;\n+import java.awt.image.SampleModel;\n+import java.awt.image.WritableRaster;\n+import java.util.zip.DataFormatException;\n+import java.util.zip.Inflater;\n+import provider.MapleCanvas;\n+\n+public class PNGMapleCanvas implements MapleCanvas {\n+    private static final int[] ZAHLEN = new int[]{2, 1, 0, 3};\n+    private int height;\n+    private int width;\n+    private int dataLength;\n+    private int format;\n+    private byte[] data;\n+\n+    public PNGMapleCanvas(int width, int height, int dataLength, int format, byte[] data) {\n+        super();\n+        this.height = height;\n+        this.width = width;\n+        this.dataLength = dataLength;\n+        this.format = format;\n+        this.data = data;\n+    }\n+\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    public int getFormat() {\n+        return format;\n+    }\n+\n+    private byte[] getData() {\n+        return data;\n+    }\n+\n+    @Override\n+    public BufferedImage getImage() {\n+        int sizeUncompressed = 0;\n+        int size8888 = 0;\n+        int maxWriteBuf = 2;\n+        int maxHeight = 3;\n+        byte[] writeBuf = new byte[maxWriteBuf];\n+        @SuppressWarnings (\"unused\")\n+        byte[] rowPointers = new byte[maxHeight];\n+        switch (getFormat()) {\n+            case 1:\n+            case 513:\n+                sizeUncompressed = getHeight() * getWidth() * 4;\n+                break;\n+            case 2:\n+                sizeUncompressed = getHeight() * getWidth() * 8;\n+                break;\n+            case 517:\n+                sizeUncompressed = getHeight() * getWidth() / 128;\n+                break;\n+        }\n+        size8888 = getHeight() * getWidth() * 8;\n+        if (size8888 > maxWriteBuf) {\n+            maxWriteBuf = size8888;\n+            writeBuf = new byte[maxWriteBuf];\n+        }\n+        if (getHeight() > maxHeight) {\n+            maxHeight = getHeight();\n+            rowPointers = new byte[maxHeight];\n+        }\n+        Inflater dec = new Inflater();\n+        dec.setInput(getData(), 0, dataLength);\n+        int declen = 0;\n+        byte[] uc = new byte[sizeUncompressed];\n+        try {\n+            declen = dec.inflate(uc);\n+        } catch (DataFormatException ex) {\n+            throw new RuntimeException(\"zlib fucks\", ex);\n+        }\n+        dec.end();\n+        if (getFormat() == 1) {\n+            for (int i = 0; i < sizeUncompressed; i++) {\n+                byte low = (byte) (uc[i] & 0x0F);\n+                byte high = (byte) (uc[i] & 0xF0);\n+                writeBuf[(i << 1)] = (byte) (((low << 4) | low) & 0xFF);\n+                writeBuf[(i << 1) + 1] = (byte) (high | ((high >>> 4) & 0xF));\n+            }\n+        } else if (getFormat() == 2) {\n+            writeBuf = uc;\n+        } else if (getFormat() == 513) {\n+            for (int i = 0; i < declen; i += 2) {\n+                byte bBits = (byte) ((uc[i] & 0x1F) << 3);\n+                byte gBits = (byte) (((uc[i + 1] & 0x07) << 5) | ((uc[i] & 0xE0) >> 3));\n+                byte rBits = (byte) (uc[i + 1] & 0xF8);\n+                writeBuf[(i << 1)] = (byte) (bBits | (bBits >> 5));\n+                writeBuf[(i << 1) + 1] = (byte) (gBits | (gBits >> 6));\n+                writeBuf[(i << 1) + 2] = (byte) (rBits | (rBits >> 5));\n+                writeBuf[(i << 1) + 3] = (byte) 0xFF;\n+            }\n+        } else if (getFormat() == 517) {\n+            byte b = 0x00;\n+            int pixelIndex = 0;\n+            for (int i = 0; i < declen; i++) {\n+                for (int j = 0; j < 8; j++) {\n+                    b = (byte) (((uc[i] & (0x01 << (7 - j))) >> (7 - j)) * 255);\n+                    for (int k = 0; k < 16; k++) {\n+                        pixelIndex = (i << 9) + (j << 6) + k * 2;\n+                        writeBuf[pixelIndex] = b;\n+                        writeBuf[pixelIndex + 1] = b;\n+                        writeBuf[pixelIndex + 2] = b;\n+                        writeBuf[pixelIndex + 3] = (byte) 0xFF;\n+                    }\n+                }\n+            }\n+        }\n+        DataBufferByte imgData = new DataBufferByte(writeBuf, sizeUncompressed);\n+        SampleModel sm = new PixelInterleavedSampleModel(DataBuffer.TYPE_BYTE, getWidth(), getHeight(), 4, getWidth() * 4, ZAHLEN);\n+        WritableRaster imgRaster = Raster.createWritableRaster(sm, imgData, new Point(0, 0));\n+        BufferedImage aa = new BufferedImage(getWidth(), getHeight(), BufferedImage.TYPE_INT_ARGB);\n+        aa.setData(imgRaster);\n+        return aa;\n+    }\n+}"}, {"sha": "d24b8cb2b992c82b360366af581c08599323781e", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZDirectoryEntry.java", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZDirectoryEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZDirectoryEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZDirectoryEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,68 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataEntity;\n+import provider.MapleDataEntry;\n+import provider.MapleDataFileEntry;\n+\n+public class WZDirectoryEntry extends WZEntry implements MapleDataDirectoryEntry {\n+    private List<MapleDataDirectoryEntry> subdirs = new ArrayList<MapleDataDirectoryEntry>();\n+    private List<MapleDataFileEntry> files = new ArrayList<MapleDataFileEntry>();\n+    private Map<String, MapleDataEntry> entries = new HashMap<String, MapleDataEntry>();\n+\n+    public WZDirectoryEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super(name, size, checksum, parent);\n+    }\n+\n+    public WZDirectoryEntry() {\n+        super(null, 0, 0, null);\n+    }\n+\n+    public void addDirectory(MapleDataDirectoryEntry dir) {\n+        subdirs.add(dir);\n+        entries.put(dir.getName(), dir);\n+    }\n+\n+    public void addFile(MapleDataFileEntry fileEntry) {\n+        files.add(fileEntry);\n+        entries.put(fileEntry.getName(), fileEntry);\n+    }\n+\n+    public List<MapleDataDirectoryEntry> getSubdirectories() {\n+        return Collections.unmodifiableList(subdirs);\n+    }\n+\n+    public List<MapleDataFileEntry> getFiles() {\n+        return Collections.unmodifiableList(files);\n+    }\n+\n+    public MapleDataEntry getEntry(String name) {\n+        return entries.get(name);\n+    }\n+}"}, {"sha": "1e921b208220663ddd15966a89f32f5cfbb4a8a2", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZEntry.java", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,61 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import provider.MapleDataEntity;\n+import provider.MapleDataEntry;\n+\n+public class WZEntry implements MapleDataEntry {\n+    private String name;\n+    private int size;\n+    private int checksum;\n+    private int offset;\n+    private MapleDataEntity parent;\n+\n+    public WZEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super();\n+        this.name = name;\n+        this.size = size;\n+        this.checksum = checksum;\n+        this.parent = parent;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public int getSize() {\n+        return size;\n+    }\n+\n+    public int getChecksum() {\n+        return checksum;\n+    }\n+\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    public MapleDataEntity getParent() {\n+        return parent;\n+    }\n+}"}, {"sha": "c6c0abf5377cf42dbf23295649d0b321fb497913", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFile.java", "status": "added", "additions": 154, "deletions": 0, "changes": 154, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFile.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,154 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.BufferedInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataFileEntry;\n+import provider.MapleDataProvider;\n+import tools.data.input.GenericLittleEndianAccessor;\n+import tools.data.input.GenericSeekableLittleEndianAccessor;\n+import tools.data.input.InputStreamByteStream;\n+import tools.data.input.LittleEndianAccessor;\n+import tools.data.input.RandomAccessByteStream;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+public class WZFile implements MapleDataProvider {\n+    static {\n+        ListWZFile.init();\n+    }\n+    private File wzfile;\n+    private LittleEndianAccessor lea;\n+    private SeekableLittleEndianAccessor slea;\n+    private int headerSize;\n+    private WZDirectoryEntry root;\n+    private boolean provideImages;\n+    private int cOffset;\n+\n+    public WZFile(File wzfile, boolean provideImages) throws IOException {\n+        this.wzfile = wzfile;\n+        lea = new GenericLittleEndianAccessor(new InputStreamByteStream(new BufferedInputStream(new FileInputStream(wzfile))));\n+        RandomAccessFile raf = new RandomAccessFile(wzfile, \"r\");\n+        slea = new GenericSeekableLittleEndianAccessor(new RandomAccessByteStream(raf));\n+        root = new WZDirectoryEntry(wzfile.getName(), 0, 0, null);\n+        this.provideImages = provideImages;\n+        load();\n+    }\n+\n+    private void load() throws IOException {\n+        lea.readAsciiString(4);\n+        lea.readInt();\n+        lea.readInt();\n+        headerSize = lea.readInt();\n+        lea.readNullTerminatedAsciiString();\n+        lea.readShort();\n+        parseDirectory(root);\n+        cOffset = (int) lea.getBytesRead();\n+        getOffsets(root);\n+    }\n+\n+    private void getOffsets(MapleDataDirectoryEntry dir) {\n+        for (MapleDataFileEntry file : dir.getFiles()) {\n+            file.setOffset(cOffset);\n+            cOffset += file.getSize();\n+        }\n+        for (MapleDataDirectoryEntry sdir : dir.getSubdirectories()) {\n+            getOffsets(sdir);\n+        }\n+    }\n+\n+    private void parseDirectory(WZDirectoryEntry dir) {\n+        int entries = WZTool.readValue(lea);\n+        for (int i = 0; i < entries; i++) {\n+            byte marker = lea.readByte();\n+            String name = null;\n+            int size, checksum;\n+            switch (marker) {\n+                case 0x02:\n+                    name = WZTool.readDecodedStringAtOffsetAndReset(slea, lea.readInt() + this.headerSize + 1);\n+                    size = WZTool.readValue(lea);\n+                    checksum = WZTool.readValue(lea);\n+                    lea.readInt(); //dummy int\n+                    dir.addFile(new WZFileEntry(name, size, checksum, dir));\n+                    break;\n+                case 0x03:\n+                case 0x04:\n+                    name = WZTool.readDecodedString(lea);\n+                    size = WZTool.readValue(lea);\n+                    checksum = WZTool.readValue(lea);\n+                    lea.readInt(); //dummy int\n+                    if (marker == 3) {\n+                        dir.addDirectory(new WZDirectoryEntry(name, size, checksum, dir));\n+                    } else {\n+                        dir.addFile(new WZFileEntry(name, size, checksum, dir));\n+                    }\n+                    break;\n+                default:\n+            }\n+        }\n+        for (MapleDataDirectoryEntry idir : dir.getSubdirectories()) {\n+            parseDirectory((WZDirectoryEntry) idir);\n+        }\n+    }\n+\n+    public WZIMGFile getImgFile(String path) throws IOException {\n+        String segments[] = path.split(\"/\");\n+        WZDirectoryEntry dir = root;\n+        for (int x = 0; x < segments.length - 1; x++) {\n+            dir = (WZDirectoryEntry) dir.getEntry(segments[x]);\n+            if (dir == null) {\n+                return null;\n+            }\n+        }\n+        WZFileEntry entry = (WZFileEntry) dir.getEntry(segments[segments.length - 1]);\n+        if (entry == null) {\n+            return null;\n+        }\n+        String fullPath = wzfile.getName().substring(0, wzfile.getName().length() - 3).toLowerCase() + \"/\" + path;\n+        return new WZIMGFile(this.wzfile, entry, provideImages, ListWZFile.isModernImgFile(fullPath));\n+    }\n+\n+    @Override\n+    public synchronized MapleData getData(String path) {\n+        try {\n+            WZIMGFile imgFile = getImgFile(path);\n+            if (imgFile == null) {\n+                return null;\n+            }\n+            MapleData ret = imgFile.getRoot();\n+            return ret;\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public MapleDataDirectoryEntry getRoot() {\n+        return root;\n+    }\n+}"}, {"sha": "792371d9cf3ef340e9c895ec2143cf2918a92952", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFileEntry.java", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFileEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFileEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZFileEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,42 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import provider.MapleDataEntity;\n+import provider.MapleDataFileEntry;\n+\n+public class WZFileEntry extends WZEntry implements MapleDataFileEntry {\n+    private int offset;\n+\n+    public WZFileEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super(name, size, checksum, parent);\n+    }\n+\n+    @Override\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    public void setOffset(int offset) {\n+        this.offset = offset;\n+    }\n+}"}, {"sha": "385d78518357407cf131b0197f29c175b9815c9c", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGEntry.java", "status": "added", "additions": 118, "deletions": 0, "changes": 118, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGEntry.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,118 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.List;\n+import provider.MapleData;\n+import provider.MapleDataEntity;\n+\n+public class WZIMGEntry implements MapleData {\n+    private String name;\n+    private MapleDataType type;\n+    private List<MapleData> children = new ArrayList<MapleData>(10);\n+    private Object data;\n+    private MapleDataEntity parent;\n+\n+    public WZIMGEntry(MapleDataEntity parent) {\n+        this.parent = parent;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return name;\n+    }\n+\n+    @Override\n+    public MapleDataType getType() {\n+        return type;\n+    }\n+\n+    @Override\n+    public List<MapleData> getChildren() {\n+        return Collections.unmodifiableList(children);\n+    }\n+\n+    @Override\n+    public MapleData getChildByPath(String path) {\n+        String segments[] = path.split(\"/\");\n+        if (segments[0].equals(\"..\")) {\n+            return ((MapleData) getParent()).getChildByPath(path.substring(path.indexOf(\"/\") + 1));\n+        }\n+        MapleData ret = this;\n+        for (int x = 0; x < segments.length; x++) {\n+            boolean foundChild = false;\n+            for (MapleData child : ret.getChildren()) {\n+                if (child.getName().equals(segments[x])) {\n+                    ret = child;\n+                    foundChild = true;\n+                    break;\n+                }\n+            }\n+            if (!foundChild) {\n+                return null;\n+            }\n+        }\n+        return ret;\n+    }\n+\n+    @Override\n+    public Object getData() {\n+        return data;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public void setType(MapleDataType type) {\n+        this.type = type;\n+    }\n+\n+    public void setData(Object data) {\n+        this.data = data;\n+    }\n+\n+    public void addChild(WZIMGEntry entry) {\n+        children.add(entry);\n+    }\n+\n+    @Override\n+    public Iterator<MapleData> iterator() {\n+        return getChildren().iterator();\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return getName() + \":\" + getData();\n+    }\n+\n+    public MapleDataEntity getParent() {\n+        return parent;\n+    }\n+\n+    public void finish() {\n+        ((ArrayList<MapleData>) children).trimToSize();\n+    }\n+}"}, {"sha": "bec06c78bdf9568da3ea9819f896e22bbc7f7c44", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGFile.java", "status": "added", "additions": 227, "deletions": 0, "changes": 227, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZIMGFile.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,227 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.io.DataOutputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.RandomAccessFile;\n+import tools.data.input.GenericSeekableLittleEndianAccessor;\n+import tools.data.input.RandomAccessByteStream;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+public class WZIMGFile {\n+    private WZFileEntry file;\n+    private WZIMGEntry root;\n+    private boolean provideImages;\n+    @SuppressWarnings (\"unused\")\n+    private boolean modernImg;\n+\n+    public WZIMGFile(File wzfile, WZFileEntry file, boolean provideImages, boolean modernImg) throws IOException {\n+        RandomAccessFile raf = new RandomAccessFile(wzfile, \"r\");\n+        SeekableLittleEndianAccessor slea = new GenericSeekableLittleEndianAccessor(new RandomAccessByteStream(raf));\n+        slea.seek(file.getOffset());\n+        this.file = file;\n+        this.provideImages = provideImages;\n+        root = new WZIMGEntry(file.getParent());\n+        root.setName(file.getName());\n+        root.setType(MapleDataType.EXTENDED);\n+        this.modernImg = modernImg;\n+        parseExtended(root, slea, 0);\n+        root.finish();\n+        raf.close();\n+    }\n+\n+    protected void dumpImg(OutputStream out, SeekableLittleEndianAccessor slea) throws IOException {\n+        DataOutputStream os = new DataOutputStream(out);\n+        long oldPos = slea.getPosition();\n+        slea.seek(file.getOffset());\n+        for (int x = 0; x < file.getSize(); x++) {\n+            os.write(slea.readByte());\n+        }\n+        slea.seek(oldPos);\n+    }\n+\n+    public WZIMGEntry getRoot() {\n+        return root;\n+    }\n+\n+    private void parse(WZIMGEntry entry, SeekableLittleEndianAccessor slea) {\n+        byte marker = slea.readByte();\n+        switch (marker) {\n+            case 0: {\n+                String name = WZTool.readDecodedString(slea);\n+                entry.setName(name);\n+                break;\n+            }\n+            case 1: {\n+                String name = WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt());\n+                entry.setName(name);\n+                break;\n+            }\n+            default:\n+                System.out.println(\"Unknown Image identifier: \" + marker + \" at offset \" + (slea.getPosition() - file.getOffset()));\n+        }\n+        marker = slea.readByte();\n+        switch (marker) {\n+            case 0:\n+                entry.setType(MapleDataType.IMG_0x00);\n+                break;\n+            case 2:\n+            case 11: //??? no idea, since 0.49\n+                entry.setType(MapleDataType.SHORT);\n+                entry.setData(Short.valueOf(slea.readShort()));\n+                break;\n+            case 3:\n+                entry.setType(MapleDataType.INT);\n+                entry.setData(Integer.valueOf(WZTool.readValue(slea)));\n+                break;\n+            case 4:\n+                entry.setType(MapleDataType.FLOAT);\n+                entry.setData(Float.valueOf(WZTool.readFloatValue(slea)));\n+                break;\n+            case 5:\n+                entry.setType(MapleDataType.DOUBLE);\n+                entry.setData(Double.valueOf(slea.readDouble()));\n+                break;\n+            case 8:\n+                entry.setType(MapleDataType.STRING);\n+                byte iMarker = slea.readByte();\n+                if (iMarker == 0) {\n+                    entry.setData(WZTool.readDecodedString(slea));\n+                } else if (iMarker == 1) {\n+                    entry.setData(WZTool.readDecodedStringAtOffsetAndReset(slea, slea.readInt() + file.getOffset()));\n+                } else {\n+                    System.out.println(\"Unknown String type \" + iMarker);\n+                }\n+                break;\n+            case 9:\n+                entry.setType(MapleDataType.EXTENDED);\n+                long endOfExtendedBlock = slea.readInt();\n+                endOfExtendedBlock += slea.getPosition();\n+                parseExtended(entry, slea, endOfExtendedBlock);\n+                break;\n+            default:\n+                System.out.println(\"Unknown Image type \" + marker);\n+        }\n+    }\n+\n+    private void parseExtended(WZIMGEntry entry, SeekableLittleEndianAccessor slea, long endOfExtendedBlock) {\n+        byte marker = slea.readByte();\n+        String type;\n+        switch (marker) {\n+            case 0x73:\n+                type = WZTool.readDecodedString(slea);\n+                break;\n+            case 0x1B:\n+                type = WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt());\n+                break;\n+            default:\n+                throw new RuntimeException(\"Unknown extended image identifier: \" + marker + \" at offset \" +\n+                        (slea.getPosition() - file.getOffset()));\n+        }\n+        if (type.equals(\"Property\")) {\n+            entry.setType(MapleDataType.PROPERTY);\n+            slea.readByte();\n+            slea.readByte();\n+            int children = WZTool.readValue(slea);\n+            for (int i = 0; i < children; i++) {\n+                WZIMGEntry cEntry = new WZIMGEntry(entry);\n+                parse(cEntry, slea);\n+                cEntry.finish();\n+                entry.addChild(cEntry);\n+            }\n+        } else if (type.equals(\"Canvas\")) {\n+            entry.setType(MapleDataType.CANVAS);\n+            slea.readByte();\n+            marker = slea.readByte();\n+            if (marker == 0) {\n+                // do nothing\n+            } else if (marker == 1) {\n+                slea.readByte();\n+                slea.readByte();\n+                int children = WZTool.readValue(slea);\n+                for (int i = 0; i < children; i++) {\n+                    WZIMGEntry child = new WZIMGEntry(entry);\n+                    parse(child, slea);\n+                    child.finish();\n+                    entry.addChild(child);\n+                }\n+            } else {\n+                System.out.println(\"Canvas marker != 1 (\" + marker + \")\");\n+            }\n+            int width = WZTool.readValue(slea);\n+            int height = WZTool.readValue(slea);\n+            int format = WZTool.readValue(slea);\n+            int format2 = slea.readByte();\n+            slea.readInt();\n+            int dataLength = slea.readInt() - 1;\n+            slea.readByte();\n+            if (provideImages) {\n+                byte[] pngdata = slea.read(dataLength);\n+                entry.setData(new PNGMapleCanvas(width, height, dataLength, format + format2, pngdata));\n+            } else {\n+                entry.setData(new PNGMapleCanvas(width, height, dataLength, format + format2, null));\n+                slea.skip(dataLength);\n+            }\n+        } else if (type.equals(\"Shape2D#Vector2D\")) {\n+            entry.setType(MapleDataType.VECTOR);\n+            int x = WZTool.readValue(slea);\n+            int y = WZTool.readValue(slea);\n+            entry.setData(new Point(x, y));\n+        } else if (type.equals(\"Shape2D#Convex2D\")) {\n+            int children = WZTool.readValue(slea);\n+            for (int i = 0; i < children; i++) {\n+                WZIMGEntry cEntry = new WZIMGEntry(entry);\n+                parseExtended(cEntry, slea, 0);\n+                cEntry.finish();\n+                entry.addChild(cEntry);\n+            }\n+        } else if (type.equals(\"Sound_DX8\")) {\n+            entry.setType(MapleDataType.SOUND);\n+            slea.readByte();\n+            int dataLength = WZTool.readValue(slea);\n+            WZTool.readValue(slea); // no clue what this is\n+            int offset = (int) slea.getPosition();\n+            entry.setData(new ImgMapleSound(dataLength, offset - file.getOffset()));\n+            slea.seek(endOfExtendedBlock);\n+        } else if (type.equals(\"UOL\")) {\n+            entry.setType(MapleDataType.UOL);\n+            slea.readByte();\n+            byte uolmarker = slea.readByte();\n+            switch (uolmarker) {\n+                case 0:\n+                    entry.setData(WZTool.readDecodedString(slea));\n+                    break;\n+                case 1:\n+                    entry.setData(WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt()));\n+                    break;\n+                default:\n+                    System.out.println(\"Unknown UOL marker: \" + uolmarker + \" \" + entry.getName());\n+            }\n+        } else {\n+            throw new RuntimeException(\"Unhandled extended type: \" + type);\n+        }\n+    }\n+}"}, {"sha": "85e1c8d90b12ad81599c4bc39bd3af48af60deeb", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/WZTool.java", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/WZTool.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,187 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import javax.crypto.BadPaddingException;\n+import javax.crypto.Cipher;\n+import javax.crypto.IllegalBlockSizeException;\n+import javax.crypto.NoSuchPaddingException;\n+import javax.crypto.spec.SecretKeySpec;\n+import tools.data.input.LittleEndianAccessor;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+/*\n+ * Ported Code, see WZFile.java for more info\n+ */\n+public class WZTool {\n+    private static byte[] encKey;\n+\n+    static {\n+        byte[] iv = new byte[]{(byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,};\n+        byte[] key = new byte[]{(byte) 0x13, 0x00, 0x00, 0x00,\n+            (byte) 0x08, 0x00, 0x00, 0x00,\n+            (byte) 0x06, 0x00, 0x00, 0x00,\n+            (byte) 0xB4, 0x00, 0x00, 0x00,\n+            (byte) 0x1B, 0x00, 0x00, 0x00,\n+            (byte) 0x0F, 0x00, 0x00, 0x00,\n+            (byte) 0x33, 0x00, 0x00, 0x00,\n+            (byte) 0x52, 0x00, 0x00, 0x00\n+        };\n+        Cipher cipher = null;\n+        SecretKeySpec skeySpec = new SecretKeySpec(key, \"AES\");\n+        try {\n+            cipher = Cipher.getInstance(\"AES\");\n+        } catch (NoSuchAlgorithmException e) {\n+            e.printStackTrace();\n+        } catch (NoSuchPaddingException e) {\n+            e.printStackTrace();\n+        }\n+        try {\n+            cipher.init(Cipher.ENCRYPT_MODE, skeySpec);\n+        } catch (InvalidKeyException e) {\n+            e.printStackTrace();\n+        }\n+        encKey = new byte[0xFFFF];\n+        for (int i = 0; i < (0xFFFF / 16); i++) {\n+            try {\n+                iv = cipher.doFinal(iv);\n+            } catch (IllegalBlockSizeException e) {\n+                e.printStackTrace();\n+            } catch (BadPaddingException e) {\n+                e.printStackTrace();\n+            }\n+            System.arraycopy(iv, 0, encKey, (i * 16), 16);\n+        }\n+        try {\n+            iv = cipher.doFinal(iv);\n+        } catch (IllegalBlockSizeException e) {\n+            e.printStackTrace();\n+        } catch (BadPaddingException e) {\n+            e.printStackTrace();\n+        }\n+        System.arraycopy(iv, 0, encKey, 65520, 15);\n+    }\n+\n+    public static byte[] readListString(byte[] str) {\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ encKey[i]);\n+        }\n+        return str;\n+    }\n+\n+    public static String readDecodedString(LittleEndianAccessor llea) {\n+        int strLength;\n+        byte b = llea.readByte();\n+        if (b == 0x00) {\n+            return \"\";\n+        }\n+        if (b >= 0) {\n+            if (b == 0x7F) {\n+                strLength = llea.readInt();\n+            } else {\n+                strLength = (int) b;\n+            }\n+            if (strLength < 0) {\n+                return \"\";\n+            }\n+            byte str[] = new byte[strLength * 2];\n+            for (int i = 0; i < strLength * 2; i++) {\n+                str[i] = llea.readByte();\n+            }\n+            return DecryptUnicodeStr(str);\n+        } else {\n+            if (b == -128) {\n+                strLength = llea.readInt();\n+            } else {\n+                strLength = -b;\n+            }\n+            if (strLength < 0) {\n+                return \"\";\n+            }\n+            byte str[] = new byte[strLength];\n+            for (int i = 0; i < strLength; i++) {\n+                str[i] = llea.readByte();\n+            }\n+            return DecryptAsciiStr(str);\n+        }\n+    }\n+\n+    public static String DecryptAsciiStr(byte[] str) {\n+        byte xorByte = (byte) 0xAA;\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ xorByte ^ encKey[i]);\n+            xorByte++;\n+        }\n+        return new String(str);\n+    }\n+\n+    public static String DecryptUnicodeStr(byte[] str) {\n+        int xorByte = 0xAAAA;\n+        char[] charRet = new char[str.length / 2];\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ encKey[i]);\n+        }\n+        for (int i = 0; i < (str.length / 2); i++) {\n+            char toXor = (char) ((str[i] << 8) | str[i + 1]);\n+            charRet[i] = (char) (toXor ^ xorByte);\n+            xorByte++;\n+        }\n+        return String.valueOf(charRet);\n+    }\n+\n+    public static String readDecodedStringAtOffset(SeekableLittleEndianAccessor slea, int offset) {\n+        slea.seek(offset);\n+        return readDecodedString(slea);\n+    }\n+\n+    public static String readDecodedStringAtOffsetAndReset(SeekableLittleEndianAccessor slea, int offset) {\n+        long pos = 0;\n+        pos = slea.getPosition();\n+        slea.seek(offset);\n+        String ret = readDecodedString(slea);\n+        slea.seek(pos);\n+        return ret;\n+    }\n+\n+    public static int readValue(LittleEndianAccessor lea) {\n+        byte b = lea.readByte();\n+        if (b == -128) {\n+            return lea.readInt();\n+        } else {\n+            return ((int) b);\n+        }\n+    }\n+\n+    public static float readFloatValue(LittleEndianAccessor lea) {\n+        byte b = lea.readByte();\n+        if (b == -128) {\n+            return lea.readFloat();\n+        } else {\n+            return 0;\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "151a04c2fd6b1e0e6c2084f2cabb9938ff4bfcd4", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLDomMapleData.java", "status": "added", "additions": 219, "deletions": 0, "changes": 219, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLDomMapleData.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLDomMapleData.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLDomMapleData.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,219 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Locale;\n+import java.text.NumberFormat;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import provider.MapleData;\n+import provider.MapleDataEntity;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class XMLDomMapleData implements MapleData {\n+\tprivate Node node;\n+\tprivate File imageDataDir;\n+        private NumberFormat nf;\n+\n+\tpublic XMLDomMapleData(FileInputStream fis, File imageDataDir) {\n+\t\ttry {\n+\t\t\tDocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\n+\t\t\tDocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();\n+\t\t\tDocument document = documentBuilder.parse(fis);\n+\t\t\tthis.node = document.getFirstChild();\n+\t\t} catch (ParserConfigurationException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t} catch (SAXException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t}\n+\t\tthis.imageDataDir = imageDataDir;\n+                this.nf = NumberFormat.getInstance(Locale.FRANCE);\n+\t}\n+\n+\tprivate XMLDomMapleData(Node node) {\n+\t\tthis.node = node;\n+                this.nf = NumberFormat.getInstance(Locale.FRANCE);\n+\t}\n+\n+\t@Override\n+\tpublic MapleData getChildByPath(String path) {\n+\t\tString segments[] = path.split(\"/\");\n+\t\tif (segments[0].equals(\"..\")) {\n+\t\t\treturn ((MapleData) getParent()).getChildByPath(path.substring(path.indexOf(\"/\") + 1));\n+\t\t}\n+\n+\t\tNode myNode = node;\n+\t\tfor (int x = 0; x < segments.length; x++) {\n+\t\t\tNodeList childNodes = myNode.getChildNodes();\n+\t\t\tboolean foundChild = false;\n+\t\t\tfor (int i = 0; i < childNodes.getLength(); i++) {\n+\t\t\t\tNode childNode = childNodes.item(i);\n+\t\t\t\tif (childNode.getNodeType() == Node.ELEMENT_NODE && childNode.getAttributes().getNamedItem(\"name\").getNodeValue().equals(segments[x])) {\n+\t\t\t\t\tmyNode = childNode;\n+\t\t\t\t\tfoundChild = true;\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif (!foundChild) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\t\t}\n+\t\tXMLDomMapleData ret = new XMLDomMapleData(myNode);\n+\t\tret.imageDataDir = new File(imageDataDir, getName() + \"/\" + path).getParentFile();\n+\t\treturn ret;\n+\t}\n+\n+\t@Override\n+\tpublic List<MapleData> getChildren() {\n+\t\tList<MapleData> ret = new ArrayList<MapleData>();\n+\t\tNodeList childNodes = node.getChildNodes();\n+\t\tfor (int i = 0; i < childNodes.getLength(); i++) {\n+\t\t\tNode childNode = childNodes.item(i);\n+\t\t\tif (childNode.getNodeType() == Node.ELEMENT_NODE) {\n+\t\t\t\tXMLDomMapleData child = new XMLDomMapleData(childNode);\n+\t\t\t\tchild.imageDataDir = new File(imageDataDir, getName());\n+\t\t\t\tret.add(child);\n+\t\t\t}\n+\t\t}\n+\t\treturn ret;\n+\t}\n+\n+\t@Override\n+\tpublic Object getData() {\n+\t\tNamedNodeMap attributes = node.getAttributes();\n+\t\tMapleDataType type = getType();\n+\t\tswitch (type) {\n+\t\tcase DOUBLE:\n+\t\tcase FLOAT:\n+\t\tcase INT:\n+                case SHORT: {\n+                        String value = attributes.getNamedItem(\"value\").getNodeValue();\n+                        Number nval;\n+                        \n+                        try {\n+                                nval = nf.parse(value);\n+                        }\n+                        catch(java.text.ParseException pe) {\n+                                pe.printStackTrace();\n+                                nval = 0.0f;\n+                        }\n+                                \n+                        switch (type) {\n+                        case DOUBLE:\n+                                return nval.doubleValue();\n+                        case FLOAT:\n+                                return nval.floatValue();\n+                        case INT:\n+                                return nval.intValue();\n+                        case SHORT:\n+                                return nval.shortValue();\n+                        default:\n+                                return null;\n+                        }\n+                }\n+\t\tcase STRING:\n+\t\tcase UOL: {\n+\t\t\tString value = attributes.getNamedItem(\"value\").getNodeValue();\n+                        return value;\n+\t\t}\n+\t\tcase VECTOR: {\n+\t\t\tString x = attributes.getNamedItem(\"x\").getNodeValue();\n+\t\t\tString y = attributes.getNamedItem(\"y\").getNodeValue();\n+\t\t\treturn new Point(Integer.parseInt(x), Integer.parseInt(y));\n+\t\t}\n+\t\tcase CANVAS: {\n+\t\t\tString width = attributes.getNamedItem(\"width\").getNodeValue();\n+\t\t\tString height = attributes.getNamedItem(\"height\").getNodeValue();\n+\t\t\treturn new FileStoredPngMapleCanvas(Integer.parseInt(width), Integer.parseInt(height), new File(\n+\t\t\t\t\timageDataDir, getName() + \".png\"));\n+\t\t}\n+\t\tdefault:\n+\t\t\treturn null;\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic MapleDataType getType() {\n+\t\tString nodeName = node.getNodeName();\n+\t\tif (nodeName.equals(\"imgdir\")) {\n+\t\t\treturn MapleDataType.PROPERTY;\n+\t\t} else if (nodeName.equals(\"canvas\")) {\n+\t\t\treturn MapleDataType.CANVAS;\n+\t\t} else if (nodeName.equals(\"convex\")) {\n+\t\t\treturn MapleDataType.CONVEX;\n+\t\t} else if (nodeName.equals(\"sound\")) {\n+\t\t\treturn MapleDataType.SOUND;\n+\t\t} else if (nodeName.equals(\"uol\")) {\n+\t\t\treturn MapleDataType.UOL;\n+\t\t} else if (nodeName.equals(\"double\")) {\n+\t\t\treturn MapleDataType.DOUBLE;\n+\t\t} else if (nodeName.equals(\"float\")) {\n+\t\t\treturn MapleDataType.FLOAT;\n+\t\t} else if (nodeName.equals(\"int\")) {\n+\t\t\treturn MapleDataType.INT;\n+\t\t} else if (nodeName.equals(\"short\")) {\n+\t\t\treturn MapleDataType.SHORT;\n+\t\t} else if (nodeName.equals(\"string\")) {\n+\t\t\treturn MapleDataType.STRING;\n+\t\t} else if (nodeName.equals(\"vector\")) {\n+\t\t\treturn MapleDataType.VECTOR;\n+\t\t} else if (nodeName.equals(\"null\")) {\n+\t\t\treturn MapleDataType.IMG_0x00;\n+\t\t}\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic MapleDataEntity getParent() {\n+\t\tNode parentNode = node.getParentNode();\n+\t\tif (parentNode.getNodeType() == Node.DOCUMENT_NODE) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tXMLDomMapleData parentData = new XMLDomMapleData(parentNode);\n+\t\tparentData.imageDataDir = imageDataDir.getParentFile();\n+\t\treturn parentData;\n+\t}\n+\n+\t@Override\n+\tpublic String getName() {\n+\t\treturn node.getAttributes().getNamedItem(\"name\").getNodeValue();\n+\t}\n+\n+\t@Override\n+\tpublic Iterator<MapleData> iterator() {\n+\t\treturn getChildren().iterator();\n+\t}\n+}"}, {"sha": "2a7694fdc97c511f4e0d4b894967b02d813683be", "filename": "tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLWZFile.java", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLWZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLWZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/provider/wz/XMLWZFile.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,85 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataProvider;\n+\n+public class XMLWZFile implements MapleDataProvider {\n+    private File root;\n+    private WZDirectoryEntry rootForNavigation;\n+\n+    public XMLWZFile(File fileIn) {\n+        root = fileIn;\n+        rootForNavigation = new WZDirectoryEntry(fileIn.getName(), 0, 0, null);\n+        fillMapleDataEntitys(root, rootForNavigation);\n+    }\n+\n+    private void fillMapleDataEntitys(File lroot, WZDirectoryEntry wzdir) {\n+        for (File file : lroot.listFiles()) {\n+            String fileName = file.getName();\n+            if (file.isDirectory() && !fileName.endsWith(\".img\")) {\n+                WZDirectoryEntry newDir = new WZDirectoryEntry(fileName, 0, 0, wzdir);\n+                wzdir.addDirectory(newDir);\n+                fillMapleDataEntitys(file, newDir);\n+            } else if (fileName.endsWith(\".xml\")) {\n+                wzdir.addFile(new WZFileEntry(fileName.substring(0, fileName.length() - 4), 0, 0, wzdir));\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public MapleData getData(String path) {\n+        File dataFile = new File(root, path + \".xml\");\n+        File imageDataDir = new File(root, path);\n+        if (!dataFile.exists()) {\n+            return null;//bitches\n+        }\n+        FileInputStream fis;\n+        try {\n+            fis = new FileInputStream(dataFile);\n+        } catch (FileNotFoundException e) {\n+            throw new RuntimeException(\"Datafile \" + path + \" does not exist in \" + root.getAbsolutePath());\n+        }\n+        final XMLDomMapleData domMapleData;\n+        try {\n+            domMapleData = new XMLDomMapleData(fis, imageDataDir.getParentFile());\n+        } finally {\n+            try {\n+                fis.close();\n+            } catch (IOException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+        return domMapleData;\n+    }\n+\n+    @Override\n+    public MapleDataDirectoryEntry getRoot() {\n+        return rootForNavigation;\n+    }\n+}"}, {"sha": "9dcd4e654526bf10315acc9d9b52b1fbfa47b0e6", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/DatabaseConnection.java", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/DatabaseConnection.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/DatabaseConnection.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/DatabaseConnection.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,51 @@\n+package tools;\n+\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.SQLException;\n+\n+/**\n+ * @author Frz (Big Daddy)\n+ * @author The Real Spookster (some modifications to this beautiful code)\n+ */\n+public class DatabaseConnection {\n+    private static String DB_URL = \"jdbc:mysql://localhost:3306/heavenms\";\n+    private static String DB_USER = \"root\";\n+    private static String DB_PASS = \"\";\n+    \n+    public static final int RETURN_GENERATED_KEYS = 1;\n+\n+    private static ThreadLocal<Connection> con = new ThreadLocalConnection();\n+\n+    public static Connection getConnection() {\n+        Connection c = con.get();\n+        try {\n+            c.getMetaData();\n+        } catch (SQLException e) { // connection is dead, therefore discard old object 5ever\n+            con.remove();\n+            c = con.get();\n+        }\n+        return c;\n+    }\n+\n+    private static class ThreadLocalConnection extends ThreadLocal<Connection> {\n+\n+        @Override\n+        protected Connection initialValue() {\n+            try {\n+                Class.forName(\"com.mysql.jdbc.Driver\"); // touch the mysql driver\n+            } catch (ClassNotFoundException e) {\n+                System.out.println(\"[SEVERE] SQL Driver Not Found. Consider death by clams.\");\n+                e.printStackTrace();\n+                return null;\n+            }\n+            try {\n+                return DriverManager.getConnection(DB_URL, DB_USER, DB_PASS);\n+            } catch (SQLException e) {\n+                System.out.println(\"[SEVERE] Unable to make database connection.\");\n+                e.printStackTrace();\n+                return null;\n+            }\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "8cc0c8aa84947f28e2bf1695d146b6c246eddec8", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/HexTool.java", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/HexTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/HexTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/HexTool.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,79 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools;\n+\n+import java.io.ByteArrayOutputStream;\n+\n+public class HexTool {\n+    private static final char[] HEX = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'};\n+\n+    private static String toString(byte byteValue) {\n+        int tmp = byteValue << 8;\n+        char[] retstr = new char[]{HEX[(tmp >> 12) & 0x0F], HEX[(tmp >> 8) & 0x0F]};\n+        return String.valueOf(retstr);\n+    }\n+\n+    public static String toString(byte[] bytes) {\n+        StringBuilder hexed = new StringBuilder();\n+        for (int i = 0; i < bytes.length; i++) {\n+            hexed.append(toString(bytes[i]));\n+            hexed.append(' ');\n+        }\n+        return hexed.substring(0, hexed.length() - 1);\n+    }\n+\n+    public static byte[] getByteArrayFromHexString(String hex) {\n+        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        int nexti = 0;\n+        int nextb = 0;\n+        boolean highoc = true;\n+        outer:\n+        for (;;) {\n+            int number = -1;\n+            while (number == -1) {\n+                if (nexti == hex.length()) {\n+                    break outer;\n+                }\n+                char chr = hex.charAt(nexti);\n+                if (chr >= '0' && chr <= '9') {\n+                    number = chr - '0';\n+                } else if (chr >= 'a' && chr <= 'f') {\n+                    number = chr - 'a' + 10;\n+                } else if (chr >= 'A' && chr <= 'F') {\n+                    number = chr - 'A' + 10;\n+                } else {\n+                    number = -1;\n+                }\n+                nexti++;\n+            }\n+            if (highoc) {\n+                nextb = number << 4;\n+                highoc = false;\n+            } else {\n+                nextb |= number;\n+                highoc = true;\n+                baos.write(nextb);\n+            }\n+        }\n+        return baos.toByteArray();\n+    }\n+}"}, {"sha": "f88718cbe3e8471b9ccca9461e4978c346b1c43c", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/Pair.java", "status": "added", "additions": 121, "deletions": 0, "changes": 121, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/Pair.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/Pair.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/Pair.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,121 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package tools;\n+\n+/**\n+ * Represents a pair of values.\n+ * \n+ * @author Frz\n+ * @since Revision 333\n+ * @version 1.0\n+ * \n+ * @param <E> The type of the left value.\n+ * @param <F> The type of the right value.\n+ */\n+public class Pair<E, F> {\n+\n+    public E left;\n+    public F right;\n+\n+    /**\n+     * Class constructor - pairs two objects together.\n+     *\n+     * @param left The left object.\n+     * @param right The right object.\n+     */\n+    public Pair(E left, F right) {\n+        this.left = left;\n+        this.right = right;\n+    }\n+\n+    /**\n+     * Gets the left value.\n+     *\n+     * @return The left value.\n+     */\n+    public E getLeft() {\n+        return left;\n+    }\n+\n+    /**\n+     * Gets the right value.\n+     *\n+     * @return The right value.\n+     */\n+    public F getRight() {\n+        return right;\n+    }\n+\n+    /**\n+     * Turns the pair into a string.\n+     *\n+     * @return Each value of the pair as a string joined by a colon.\n+     */\n+    @Override\n+    public String toString() {\n+        return left.toString() + \":\" + right.toString();\n+    }\n+\n+    /**\n+     * Gets the hash code of this pair.\n+     */\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((left == null) ? 0 : left.hashCode());\n+        result = prime * result + ((right == null) ? 0 : right.hashCode());\n+        return result;\n+    }\n+\n+    /**\n+     * Checks to see if two pairs are equal.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        }\n+        if (obj == null) {\n+            return false;\n+        }\n+        if (getClass() != obj.getClass()) {\n+            return false;\n+        }\n+        final Pair other = (Pair) obj;\n+        if (left == null) {\n+            if (other.left != null) {\n+                return false;\n+            }\n+        } else if (!left.equals(other.left)) {\n+            return false;\n+        }\n+        if (right == null) {\n+            if (other.right != null) {\n+                return false;\n+            }\n+        } else if (!right.equals(other.right)) {\n+            return false;\n+        }\n+        return true;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "eac7de21eaac3423b32736fe92c5bd80da94d2a6", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteArrayByteStream.java", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteArrayByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteArrayByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteArrayByteStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,72 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import tools.HexTool;\n+\n+public class ByteArrayByteStream implements SeekableInputStreamBytestream {\n+    private int pos = 0;\n+    private long bytesRead = 0;\n+    private byte[] arr;\n+\n+    public ByteArrayByteStream(byte[] arr) {\n+        this.arr = arr;\n+    }\n+\n+    @Override\n+    public long getPosition() {\n+        return pos;\n+    }\n+\n+    @Override\n+    public void seek(long offset) throws IOException {\n+        pos = (int) offset;\n+    }\n+\n+    @Override\n+    public long getBytesRead() {\n+        return bytesRead;\n+    }\n+\n+    @Override\n+    public int readByte() {\n+        bytesRead++;\n+        return ((int) arr[pos++]) & 0xFF;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        String nows = \"kevintjuh93 pwns\";//I lol'd\n+        if (arr.length - pos > 0) {\n+            byte[] now = new byte[arr.length - pos];\n+            System.arraycopy(arr, pos, now, 0, arr.length - pos);\n+            nows = HexTool.toString(now);\n+        }\n+        return \"All: \" + HexTool.toString(arr) + \"\\nNow: \" + nows;\n+    }\n+  \n+    @Override\n+    public long available() {\n+        return arr.length - pos;\n+    }\n+}"}, {"sha": "107f71843e5890dc43f8679eb7608ac631165eae", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteInputStream.java", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteInputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteInputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/ByteInputStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,35 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+/**\n+ * Represents an abstract stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public interface ByteInputStream {\n+    int readByte();\n+    long getBytesRead();\n+    long available();\n+}"}, {"sha": "d08a9b8374c3b3a9c38fd898295446e7d3582d50", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "status": "added", "additions": 239, "deletions": 0, "changes": 239, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericLittleEndianAccessor.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,239 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.awt.Point;\n+import java.io.ByteArrayOutputStream;\n+\n+/**\n+ * Provides a generic interface to a Little Endian stream of bytes.\n+ *\n+ * @version 1.0\n+ * @author Frz\n+ * @since Revision 323\n+ */\n+public class GenericLittleEndianAccessor implements LittleEndianAccessor {\n+    private ByteInputStream bs;\n+\n+    /**\n+     * Class constructor - Wraps the accessor around a stream of bytes.\n+     *\n+     * @param bs The byte stream to wrap the accessor around.\n+     */\n+    public GenericLittleEndianAccessor(ByteInputStream bs) {\n+        this.bs = bs;\n+    }\n+\n+    /**\n+     * Read a single byte from the stream.\n+     *\n+     * @return The byte read.\n+     * @see tools.data.input.ByteInputStream#readByte\n+     */\n+    @Override\n+    public byte readByte() {\n+        return (byte) bs.readByte();\n+    }\n+\n+    /**\n+     * Reads an integer from the stream.\n+     *\n+     * @return The integer read.\n+     */\n+    @Override\n+    public int readInt() {\n+        return bs.readByte() + (bs.readByte() << 8) + (bs.readByte() << 16) + (bs.readByte() << 24);\n+    }\n+\n+    /**\n+     * Reads a short integer from the stream.\n+     *\n+     * @return The short read.\n+     */\n+    @Override\n+    public short readShort() {\n+        return (short) (bs.readByte() + (bs.readByte() << 8));\n+    }\n+\n+    /**\n+     * Reads a single character from the stream.\n+     *\n+     * @return The character read.\n+     */\n+    @Override\n+    public char readChar() {\n+        return (char) readShort();\n+    }\n+\n+    /**\n+     * Reads a long integer from the stream.\n+     *\n+     * @return The long integer read.\n+     */\n+    @Override\n+    public long readLong() {\n+        long byte1 = bs.readByte();\n+        long byte2 = bs.readByte();\n+        long byte3 = bs.readByte();\n+        long byte4 = bs.readByte();\n+        long byte5 = bs.readByte();\n+        long byte6 = bs.readByte();\n+        long byte7 = bs.readByte();\n+        long byte8 = bs.readByte();\n+        return (byte8 << 56) + (byte7 << 48) + (byte6 << 40) + (byte5 << 32) + (byte4 << 24) + (byte3 << 16) + (byte2 << 8) + byte1;\n+    }\n+\n+    /**\n+     * Reads a floating point integer from the stream.\n+     *\n+     * @return The float-type integer read.\n+     */\n+    @Override\n+    public float readFloat() {\n+        return Float.intBitsToFloat(readInt());\n+    }\n+\n+    /**\n+     * Reads a double-precision integer from the stream.\n+     *\n+     * @return The double-type integer read.\n+     */\n+    @Override\n+    public double readDouble() {\n+        return Double.longBitsToDouble(readLong());\n+    }\n+\n+    /**\n+     * Reads an ASCII string from the stream with length <code>n</code>.\n+     *\n+     * @param n Number of characters to read.\n+     * @return The string read.\n+     */\n+    public final String readAsciiString(int n) {\n+        char ret[] = new char[n];\n+        for (int x = 0; x < n; x++) {\n+            ret[x] = (char) readByte();\n+        }\n+        return String.valueOf(ret);\n+    }\n+\n+    /**\n+     * Reads a null-terminated string from the stream.\n+     *\n+     * @return The string read.\n+     */\n+    public final String readNullTerminatedAsciiString() {\n+        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        byte b;\n+        while (true) {\n+            b = readByte();\n+            if (b == 0) {\n+                break;\n+            }\n+            baos.write(b);\n+        }\n+        byte[] buf = baos.toByteArray();\n+        char[] chrBuf = new char[buf.length];\n+        for (int x = 0; x < buf.length; x++) {\n+            chrBuf[x] = (char) buf[x];\n+        }\n+        return String.valueOf(chrBuf);\n+    }\n+\n+    /**\n+     * Gets the number of bytes read from the stream so far.\n+     *\n+     * @return A long integer representing the number of bytes read.\n+     * @see tools.data.input.ByteInputStream#getBytesRead()\n+     */\n+    public long getBytesRead() {\n+        return bs.getBytesRead();\n+    }\n+\n+    /**\n+     * Reads a MapleStory convention lengthed ASCII string.\n+     * This consists of a short integer telling the length of the string,\n+     * then the string itself.\n+     *\n+     * @return The string read.\n+     */\n+    @Override\n+    public String readMapleAsciiString() {\n+        return readAsciiString(readShort());\n+    }\n+\n+    /**\n+     * Reads <code>num</code> bytes off the stream.\n+     *\n+     * @param num The number of bytes to read.\n+     * @return An array of bytes with the length of <code>num</code>\n+     */\n+    @Override\n+    public byte[] read(int num) {\n+        byte[] ret = new byte[num];\n+        for (int x = 0; x < num; x++) {\n+            ret[x] = readByte();\n+        }\n+        return ret;\n+    }\n+\n+    /**\n+     * Reads a MapleStory Position information.\n+     * This consists of 2 short integer.\n+     *\n+     * @return The Position read.\n+     */\n+    @Override\n+    public final Point readPos() {\n+\tfinal int x = readShort();\n+\tfinal int y = readShort();\n+\treturn new Point(x, y);\n+    }\n+\n+    /**\n+     * Skips the current position of the stream <code>num</code> bytes ahead.\n+     *\n+     * @param num Number of bytes to skip.\n+     */\n+    @Override\n+    public void skip(int num) {\n+        for (int x = 0; x < num; x++) {\n+            readByte();\n+        }\n+    }\n+\n+    /**\n+     * @see tools.data.input.ByteInputStream#available\n+     */\n+    @Override\n+    public long available() {\n+        return bs.available();\n+    }\n+\n+    /**\n+     * @see java.lang.Object#toString\n+     */\n+    @Override\n+    public String toString() {\n+        return bs.toString();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "fdd147d79637904e92445553643117eb0aa6ebf4", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "status": "added", "additions": 91, "deletions": 0, "changes": 91, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,91 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides an abstract accessor to a generic Little Endian byte stream. This\n+ * accessor is seekable.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ * @see tools.data.input.GenericLittleEndianAccessor\n+ */\n+public class GenericSeekableLittleEndianAccessor extends GenericLittleEndianAccessor implements SeekableLittleEndianAccessor {\n+    private SeekableInputStreamBytestream bs;\n+\n+    /**\n+     * Class constructor\n+     * Provide a seekable input stream to wrap this object around.\n+     *\n+     * @param bs The byte stream to wrap this around.\n+     */\n+    public GenericSeekableLittleEndianAccessor(SeekableInputStreamBytestream bs) {\n+        super(bs);\n+        this.bs = bs;\n+    }\n+\n+    /**\n+     * Seek the pointer to <code>offset</code>\n+     *\n+     * @param offset The offset to seek to.\n+     * @see tools.data.input.SeekableInputStreamBytestream#seek\n+     */\n+    @Override\n+    public void seek(long offset) {\n+        try {\n+            bs.seek(offset);\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"Seek failed \" + e);\n+        }\n+    }\n+\n+    /**\n+     * Get the current position of the pointer.\n+     *\n+     * @return The current position of the pointer as a long integer.\n+     * @see tools.data.input.SeekableInputStreamBytestream#getPosition\n+     */\n+    @Override\n+    public long getPosition() {\n+        try {\n+            return bs.getPosition();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"getPosition failed\" + e);\n+            return -1;\n+        }\n+    }\n+\n+    /**\n+     * Skip <code>num</code> number of bytes in the stream.\n+     *\n+     * @param num The number of bytes to skip.\n+     */\n+    @Override\n+    public void skip(int num) {\n+        seek(getPosition() + num);\n+    }\n+}"}, {"sha": "70aef3489f8eeaa27e8236c069dd847e069c0a85", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/InputStreamByteStream.java", "status": "added", "additions": 93, "deletions": 0, "changes": 93, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/InputStreamByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/InputStreamByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/InputStreamByteStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,93 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+\n+/**\n+ * Provides an abstract wrapper to a stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class InputStreamByteStream implements ByteInputStream {\n+    private InputStream is;\n+    private long read = 0;\n+\n+    /**\n+     * Class constructor.\n+     * Provide an input stream to wrap this around.\n+     *\n+     * @param is The input stream to wrap this object around.\n+     */\n+    public InputStreamByteStream(InputStream is) {\n+        this.is = is;\n+    }\n+\n+    /**\n+     * Reads the next byte from the stream.\n+     *\n+     * @return Then next byte in the stream.\n+     */\n+    @Override\n+    public int readByte() {\n+        int temp;\n+        try {\n+            temp = is.read();\n+            if (temp == -1) {\n+                throw new RuntimeException(\"EOF\");\n+            }\n+            read++;\n+            return temp;\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of bytes read from the stream.\n+     *\n+     * @return The number of bytes read as a long integer.\n+     */\n+    @Override\n+    public long getBytesRead() {\n+        return read;\n+    }\n+\n+    /**\n+     * Returns the number of bytes left in the stream.\n+     *\n+     * @return The number of bytes available for reading as a long integer.\n+     */\n+    @Override\n+    public long available() {\n+        try {\n+            return is.available();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"ERROR\" + e);\n+            return 0;\n+        }\n+    }\n+}"}, {"sha": "f991dbf537e4230969cf96296d460306fb52c019", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/LittleEndianAccessor.java", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/LittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/LittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/LittleEndianAccessor.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,45 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.awt.Point;\n+\n+/**\n+ * @author Frz\n+ */\n+public interface LittleEndianAccessor {\n+    byte readByte();\n+    char readChar();\n+    short readShort();\n+    int readInt();\n+    Point readPos();\n+    long readLong();\n+    void skip(int num);\n+    byte[] read(int num);\n+    float readFloat();\n+    double readDouble();\n+    String readAsciiString(int n);\n+    String readNullTerminatedAsciiString();\n+    String readMapleAsciiString();\n+    long getBytesRead();\n+    long available();\n+}"}, {"sha": "c0004be17fd1125ee7bff7911c3be489bc488f5c", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/RandomAccessByteStream.java", "status": "added", "additions": 84, "deletions": 0, "changes": 84, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/RandomAccessByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/RandomAccessByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/RandomAccessByteStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,84 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+\n+/**\n+ * Provides an abstract layer to a byte stream. This layer can be accessed\n+ * randomly.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class RandomAccessByteStream implements SeekableInputStreamBytestream {\n+    private RandomAccessFile raf;\n+    private long read = 0;\n+\n+    public RandomAccessByteStream(RandomAccessFile raf) {\n+        super();\n+        this.raf = raf;\n+    }\n+\n+    @Override\n+    public int readByte() {\n+        int temp;\n+        try {\n+            temp = raf.read();\n+            if (temp == -1) {\n+                throw new RuntimeException(\"EOF\");\n+            }\n+            read++;\n+            return temp;\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public void seek(long offset) throws IOException {\n+        raf.seek(offset);\n+    }\n+\n+    @Override\n+    public long getPosition() throws IOException {\n+        return raf.getFilePointer();\n+    }\n+\n+    @Override\n+    public long getBytesRead() {\n+        return read;\n+    }\n+\n+    @Override\n+    public long available() {\n+        try {\n+            return raf.length() - raf.getFilePointer();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"ERROR \" + e);\n+            return 0;\n+        }\n+    }\n+}"}, {"sha": "f4922dc876ef24832968388c0d62c27e9303cf20", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableInputStreamBytestream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,51 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides an abstract interface to a stream of bytes. This stream can be\n+ * seeked.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since 299\n+ */\n+public interface SeekableInputStreamBytestream extends ByteInputStream {\n+    /**\n+     * Seeks the stream by the specified offset.\n+     *\n+     * @param offset\n+     *            Number of bytes to seek.\n+     * @throws IOException\n+     */\n+    void seek(long offset) throws IOException;\n+\n+    /**\n+     * Gets the current position of the stream.\n+     *\n+     * @return The stream position as a long integer.\n+     * @throws IOException\n+     */\n+    long getPosition() throws IOException;\n+}"}, {"sha": "16b2317f7a5b5d000be9d7f12cd86bdc30d2ed89", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,27 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+public interface SeekableLittleEndianAccessor extends LittleEndianAccessor {\n+    void seek(long offset);\n+    long getPosition();\n+}"}, {"sha": "80cbc9301e410f00b74731f7f8ee366109f12a1d", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/output/BAOSByteOutputStream.java", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/BAOSByteOutputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/BAOSByteOutputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/output/BAOSByteOutputStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,56 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.io.ByteArrayOutputStream;\n+\n+/**\n+ * Uses a byte array to output a stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 352\n+ */\n+class BAOSByteOutputStream implements ByteOutputStream {\n+    private ByteArrayOutputStream baos;\n+\n+    /**\n+     * Class constructor - Wraps the stream around a Java BAOS.\n+     *\n+     * @param baos <code>The ByteArrayOutputStream</code> to wrap this around.\n+     */\n+    BAOSByteOutputStream(ByteArrayOutputStream baos) {\n+        super();\n+        this.baos = baos;\n+    }\n+\n+    /**\n+     * Writes a byte to the stream.\n+     *\n+     * @param b The byte to write to the stream.\n+     * @see tools.data.output.ByteOutputStream#writeByte(byte)\n+     */\n+    @Override\n+    public void writeByte(byte b) {\n+        baos.write(b);\n+    }\n+}"}, {"sha": "0df7ca775362e7ef40ee4e5fa9d9b36ebd0b5001", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/output/ByteOutputStream.java", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/ByteOutputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/ByteOutputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/output/ByteOutputStream.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,38 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+/**\n+ * Provides an interface to an output stream of bytes.\n+ * \n+ * @author Frz\n+ * @since Revision 323\n+ * @version 1.0\n+ */\n+interface ByteOutputStream {\n+    /**\n+     * Writes a byte to the stream.\n+     *\n+     * @param b The byte to write.\n+     */\n+    void writeByte(byte b);\n+}"}, {"sha": "e804fd8000c7748c854795b388a49da0a98666d9", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "status": "added", "additions": 183, "deletions": 0, "changes": 183, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/output/GenericLittleEndianWriter.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,183 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.awt.Point;\n+import java.nio.charset.Charset;\n+\n+/**\n+ * Provides a generic writer of a little-endian sequence of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class GenericLittleEndianWriter implements LittleEndianWriter {\n+    private static Charset ASCII = Charset.forName(\"US-ASCII\");\n+    private ByteOutputStream bos;\n+\n+    /**\n+     * Class constructor - Protected to prevent instantiation with no arguments.\n+     */\n+    protected GenericLittleEndianWriter() {\n+        // Blah!\n+    }\n+\n+    /**\n+     * Sets the byte-output stream for this instance of the object.\n+     *\n+     * @param bos The new output stream to set.\n+     */\n+    void setByteOutputStream(ByteOutputStream bos) {\n+        this.bos = bos;\n+    }\n+\n+    /**\n+     * Write an array of bytes to the stream.\n+     *\n+     * @param b The bytes to write.\n+     */\n+    @Override\n+    public void write(byte[] b) {\n+        for (int x = 0; x < b.length; x++) {\n+            bos.writeByte(b[x]);\n+        }\n+    }\n+\n+    /**\n+     * Write a byte to the stream.\n+     *\n+     * @param b The byte to write.\n+     */\n+    @Override\n+    public void write(byte b) {\n+        bos.writeByte(b);\n+    }\n+\n+    /**\n+     * Write a byte in integer form to the stream.\n+     *\n+     * @param b The byte as an <code>Integer</code> to write.\n+     */\n+    @Override\n+    public void write(int b) {\n+        bos.writeByte((byte) b);\n+    }\n+\n+    @Override\n+    public void skip(int b) {\n+        write(new byte[b]);\n+    }\n+\n+    /**\n+     * Write a short integer to the stream.\n+     *\n+     * @param i The short integer to write.\n+     */\n+    @Override\n+    public void writeShort(int i) {\n+        bos.writeByte((byte) (i & 0xFF));\n+        bos.writeByte((byte) ((i >>> 8) & 0xFF));\n+    }\n+\n+    /**\n+     * Writes an integer to the stream.\n+     *\n+     * @param i The integer to write.\n+     */\n+    @Override\n+    public void writeInt(int i) {\n+        bos.writeByte((byte) (i & 0xFF));\n+        bos.writeByte((byte) ((i >>> 8) & 0xFF));\n+        bos.writeByte((byte) ((i >>> 16) & 0xFF));\n+        bos.writeByte((byte) ((i >>> 24) & 0xFF));\n+    }\n+\n+    /**\n+     * Writes an ASCII string the the stream.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    @Override\n+    public void writeAsciiString(String s) {\n+        write(s.getBytes(ASCII));\n+    }\n+\n+    /**\n+     * Writes a maple-convention ASCII string to the stream.\n+     *\n+     * @param s The ASCII string to use maple-convention to write.\n+     */\n+    @Override\n+    public void writeMapleAsciiString(String s) {\n+        writeShort((short) s.length());\n+        writeAsciiString(s);\n+    }\n+\n+    /**\n+     * Writes a null-terminated ASCII string to the stream.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    @Override\n+    public void writeNullTerminatedAsciiString(String s) {\n+        writeAsciiString(s);\n+        write(0);\n+    }\n+\n+    /**\n+     * Write a long integer to the stream.\n+     * @param l The long integer to write.\n+     */\n+    @Override\n+    public void writeLong(long l) {\n+        bos.writeByte((byte) (l & 0xFF));\n+        bos.writeByte((byte) ((l >>> 8) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 16) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 24) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 32) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 40) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 48) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 56) & 0xFF));\n+    }\n+\n+    /**\n+     * Writes a 2D 4 byte position information\n+     *\n+     * @param s The Point position to write.\n+     */\n+    @Override\n+    public void writePos(Point s) {\n+        writeShort(s.x);\n+        writeShort(s.y);\n+    }\n+\n+    /**\n+     * Writes a boolean true ? 1 : 0\n+     *\n+     * @param b The boolean to write.\n+     */\n+    @Override\n+    public void writeBool(final boolean b) {\n+        write(b ? 1 : 0);\n+    }\n+}"}, {"sha": "f17bd7c72ec04f5abf2032a6622141630bd3dc81", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/output/LittleEndianWriter.java", "status": "added", "additions": 114, "deletions": 0, "changes": 114, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/LittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/LittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/output/LittleEndianWriter.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,114 @@\n+/*\n+ This file is part of the OdinMS Maple Story Server\n+ Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+ Matthias Butz <matze@odinms.de>\n+ Jan Christian Meyer <vimes@odinms.de>\n+\n+ This program is free software: you can redistribute it and/or modify\n+ it under the terms of the GNU Affero General Public License as\n+ published by the Free Software Foundation version 3 as published by\n+ the Free Software Foundation. You may not use, modify or distribute\n+ this program under any other version of the GNU Affero General Public\n+ License.\n+\n+ This program is distributed in the hope that it will be useful,\n+ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ GNU Affero General Public License for more details.\n+\n+ You should have received a copy of the GNU Affero General Public License\n+ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package tools.data.output;\n+\n+import java.awt.Point;\n+\n+/**\n+ * Provides an interface to a writer class that writes a little-endian sequence\n+ * of bytes.\n+ *\n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public interface LittleEndianWriter {\n+\n+    /**\n+     * Write an array of bytes to the sequence.\n+     *\n+     * @param b The bytes to write.\n+     */\n+    public void write(byte b[]);\n+\n+    /**\n+     * Write a byte to the sequence.\n+     *\n+     * @param b The byte to write.\n+     */\n+    public void write(byte b);\n+\n+    /**\n+     * Write a byte in integer form to the sequence.\n+     *\n+     * @param b The byte as an <code>Integer</code> to write.\n+     */\n+    public void write(int b);\n+\n+    public void skip(int b);\n+\n+    /**\n+     * Writes an integer to the sequence.\n+     *\n+     * @param i The integer to write.\n+     */\n+    public void writeInt(int i);\n+\n+    /**\n+     * Write a short integer to the sequence.\n+     *\n+     * @param s The short integer to write.\n+     */\n+    public void writeShort(int s);\n+\n+    /**\n+     * Write a long integer to the sequence.\n+     *\n+     * @param l The long integer to write.\n+     */\n+    public void writeLong(long l);\n+\n+    /**\n+     * Writes an ASCII string the the sequence.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    void writeAsciiString(String s);\n+\n+    /**\n+     * Writes a null-terminated ASCII string to the sequence.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    void writeNullTerminatedAsciiString(String s);\n+\n+    /**\n+     * Writes a maple-convention ASCII string to the sequence.\n+     *\n+     * @param s The ASCII string to use maple-convention to write.\n+     */\n+    void writeMapleAsciiString(String s);\n+\n+    /**\n+     * Writes a 2D 4 byte position information\n+     *\n+     * @param s The Point position to write.\n+     */\n+    void writePos(Point s);\n+\n+    /**\n+     * Writes a boolean true ? 1 : 0\n+     *\n+     * @param b The boolean to write.\n+     */\n+    void writeBool(final boolean b);\n+}"}, {"sha": "b02365ec62c9cbaf2998c5816928195512967a7f", "filename": "tools/MapleSkillbookChanceFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/tools/MapleSkillbookChanceFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookChanceFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -0,0 +1,73 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.io.ByteArrayOutputStream;\n+import tools.HexTool;\n+\n+/**\n+ * Writes a maplestory-packet little-endian stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 352\n+ */\n+public class MaplePacketLittleEndianWriter extends GenericLittleEndianWriter {\n+    private ByteArrayOutputStream baos;\n+\n+    /**\n+     * Constructor - initializes this stream with a default size.\n+     */\n+    public MaplePacketLittleEndianWriter() {\n+        this(32);\n+    }\n+\n+    /**\n+     * Constructor - initializes this stream with size <code>size</code>.\n+     *\n+     * @param size The size of the underlying stream.\n+     */\n+    public MaplePacketLittleEndianWriter(int size) {\n+        this.baos = new ByteArrayOutputStream(size);\n+        setByteOutputStream(new BAOSByteOutputStream(baos));\n+    }\n+\n+    /**\n+     * Gets a <code>MaplePacket</code> instance representing this\n+     * sequence of bytes.\n+     *\n+     * @return A <code>MaplePacket</code> with the bytes in this stream.\n+     */\n+    public byte[] getPacket() {\n+        return baos.toByteArray();\n+    }\n+\n+    /**\n+     * Changes this packet into a human-readable hexadecimal stream of bytes.\n+     *\n+     * @return This packet as hex digits.\n+     */\n+    @Override\n+    public String toString() {\n+        return HexTool.toString(baos.toByteArray());\n+    }\n+}"}, {"sha": "a37628bca5e774ce09bdeeb3eea5b5a06f4ead4f", "filename": "wz/Etc.wz/MapNeighbors.img.xml", "status": "added", "additions": 59793, "deletions": 0, "changes": 59793, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Etc.wz/MapNeighbors.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Etc.wz/MapNeighbors.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Etc.wz/MapNeighbors.img.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a"}, {"sha": "296d0a4c72039349374e856ba06cd08ca30697c5", "filename": "wz/Quest.wz/QuestInfo.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Quest.wz/QuestInfo.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Quest.wz/QuestInfo.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/QuestInfo.img.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -2541,7 +2541,7 @@\n     <string name=\"name\" value=\"Mai&apos;s Last Training\"/>\n     <string name=\"parent\" value=\"Mai&apos;s Training!\"/>\n     <int name=\"order\" value=\"4\"/>\n-    <string name=\"1\" value=\"I defeated the Slimes and brought back the Squishy Liquid to Mai. She seemed to be impressed, and instructed me this time to hunt a really powerful monster. She then told me to hunt #r2 Orange Mushrooms#k.\\n\\nOrange Mushroom #r#a10441##k\"/>\n+    <string name=\"1\" value=\"I defeated the Slimes and brought back the Squishy Liquid to Mai. She seemed to be impressed, and instructed me this time to hunt a really powerful monster. She then told me to hunt #r2 Orange Mushrooms#k from inside the #bTraining Center#k.\\n\\nOrange Mushroom #r#a10441##k\"/>\n     <string name=\"2\" value=\"I was able to defeat 2 Orange Mushrooms and reported the result to Mai.\"/>\n     <int name=\"area\" value=\"20\"/>\n   </imgdir>"}, {"sha": "63ab21999a5315bca3b3c12aee795ed6c5ef448a", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -4503,7 +4503,7 @@\n     <imgdir name=\"0\">\n       <string name=\"0\" value=\"Oh wow! You really brought me Squishy Liquid from the Slime. You&apos;re doing much better than I expected. I think... you&apos;re now ready to take on a really challenging monster.\"/>\n       <imgdir name=\"yes\">\n-        <string name=\"0\" value=\"So, reports of late shows up a growth on masses of Orange Mushrooms around. Your job, as an aspiring Explorer, is to help us cutting out #r2 Orange Mushrooms#k. They are pretty tough and powerful, but don&apos;t take so much fear from this fact! If you trust in your abilities and focus on the combat, you should be able to handle those two handily.\"/>\n+        <string name=\"0\" value=\"So, reports of late shows up a growth on masses of Orange Mushrooms around the #bTraining Center#k. Your job, as an aspiring Explorer, is to help us cutting out #r2 Orange Mushrooms#k from there. They are pretty tough and powerful, but don&apos;t take so much fear from this fact! If you trust in your abilities and focus on the combat, you should be able to handle those two handily.\"/>\n       </imgdir>\n       <imgdir name=\"no\">\n         <string name=\"0\" value=\"Hmmm... did I really scare you? Don&apos;t worry. If you are persistent, you&apos;ll be able to handle those two. I won&apos;t make you hunt monsters that you can&apos;t handle, you know.\"/>"}, {"sha": "a1782e3a6c93f2ee83440a6ec82499a1f0944aed", "filename": "wz/String.wz/Consume.img.xml", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/String.wz/Consume.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/bb80441af07f0eb3869b8dac4b5f58165f79b90a/wz/String.wz/Consume.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Consume.img.xml?ref=bb80441af07f0eb3869b8dac4b5f58165f79b90a", "patch": "@@ -5978,10 +5978,6 @@\n   <imgdir name=\"2388027\">\n     <string name=\"name\" value=\"Rudolph Card\"/>\n     <string name=\"desc\" value=\"A card that features Santa&apos;s favorite, Rudolph.\"/>\n-    <imgdir name=\"2390001\">\n-      <string name=\"name\" value=\"Helena&apos;s Marble\"/>\n-      <string name=\"desc\" value=\"A marble given by Helena. Use this to communicate with her regardless of the place. This item is good for one-time use only...\"/>\n-    </imgdir>\n   </imgdir>\n   <imgdir name=\"2388028\">\n     <string name=\"name\" value=\"Kid Snowman Card\"/>"}]}]},
