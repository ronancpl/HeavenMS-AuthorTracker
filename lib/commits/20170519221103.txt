{"fetchDate": "2019-12-19", "content": [{"sha": "36c3b7dea8beafad80c9bd50f27ada824eb085e6", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MzZjM2I3ZGVhOGJlYWZhZDgwYzliZDUwZjI3YWRhODI0ZWIwODVlNg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-19T22:11:03Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-19T22:11:03Z"}, "message": "Fixed Horntail command + minor EXP gain issue fix\n\nNow Horntail can be spawned properly by a command. Fixed a rase case\nwhere an extremely high value of EXP gain would cause integer overflow,\npotentially crashing one's client.", "tree": {"sha": "2a325f154cf23e5bdea4657e5bc7e661e315b3d5", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/2a325f154cf23e5bdea4657e5bc7e661e315b3d5"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/36c3b7dea8beafad80c9bd50f27ada824eb085e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/36c3b7dea8beafad80c9bd50f27ada824eb085e6", "html_url": "https://github.com/ronancpl/HeavenMS/commit/36c3b7dea8beafad80c9bd50f27ada824eb085e6", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/36c3b7dea8beafad80c9bd50f27ada824eb085e6/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "de22d2b3eb4bb7a6f6659ae550e75280f4832cba", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/de22d2b3eb4bb7a6f6659ae550e75280f4832cba", "html_url": "https://github.com/ronancpl/HeavenMS/commit/de22d2b3eb4bb7a6f6659ae550e75280f4832cba"}], "stats": {"total": 172, "additions": 118, "deletions": 54}, "files": [{"sha": "af7c4aae9a6184c5db27bdbccda24d1d48b54af1", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -225,4 +225,8 @@ Implementa\n \n 17 Maio 2017,\n Corre\ufffd\ufffdo de bug com o item \"Pet Name Tag\", que n\ufffdo retirava o item ap\ufffds ser usado.\n-Corre\ufffd\ufffdo em bug de uma quest (id 3927) de Ariant que envolve uma \"parede\".\n\\ No newline at end of file\n+Corre\ufffd\ufffdo em bug de uma quest (id 3927) de Ariant que envolve uma \"parede\".\n+\n+18 - 19 Maio 2017,\n+Implementa\ufffd\ufffdo das mec\ufffdnicas do Horntail (spawn e kill).\n+Corre\ufffd\ufffdo de bugs em casos onde valores de EXP ganhos excedem o limite m\ufffdximo de um inteiro de 32bits.\n\\ No newline at end of file"}, {"sha": "3cdb87e8875d21a1ac3aaa73dd10932d08c023ae", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -3,18 +3,24 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/UseCashItemHandler.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/SpecialMoveHandler.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/CashOperationHandler.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleStatEffect.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/constants/skills/Priest.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/PacketProcessor.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/inventory/MaplePet.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/partyquest/MonsterCarnival.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/command/Commands.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2013002.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/constants/ServerConstants.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/life/MapleMonster.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/tools/MaplePacketCreator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/OrbisPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/MapleServerHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/LudiPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/ScrollHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/ItemRewardHandler.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/GeneralChatHandler.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/AbstractPlayerInteraction.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleBuffStat.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PetFoodHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleInventoryManipulator.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/CashShop.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleMap.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PetLootHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/ItemPickupHandler.java</file>\n         </group>\n     </open-files>\n </project-private>"}, {"sha": "f2fc599687297b0ec8babc0a37c95d56c60769ec", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -1730,17 +1730,18 @@ public void gainExp(int gain, int party, boolean show, boolean inChat, boolean w\n             gain *= 0.5;\n             party *= 0.5;\n         }\n-\t\t\n-        int equip = (gain / 10) * pendantExp;\n-        int total = gain + equip + party;\n-\n+\t\n+        if(gain < 0) gain = Integer.MAX_VALUE;   // integer overflow, heh.\n+        int equip = (int)Math.min((long)((gain / 10) * pendantExp), Integer.MAX_VALUE);\n+        \n+        long total = gain + equip + party;\n         if (level < getMaxLevel()) {\n-            if ((long) this.exp.get() + (long) total > (long) Integer.MAX_VALUE) {\n+            if ((long) this.exp.get() + total > (long) Integer.MAX_VALUE) {\n                 int gainFirst = ExpTable.getExpNeededForLevel(level) - this.exp.get();\n                 total -= gainFirst + 1;\n                 this.gainExp(gainFirst + 1, party, false, inChat, white);\n             }\n-            updateSingleStat(MapleStat.EXP, this.exp.addAndGet(total));\n+            updateSingleStat(MapleStat.EXP, this.exp.addAndGet((int)Math.min(total, Integer.MAX_VALUE)));\n             if (show && gain != 0) {\n                 client.announce(MaplePacketCreator.getShowExpGain(gain, equip, party, inChat, white));\n             }"}, {"sha": "507afee3a970430f42d7732022d7c68b197d697f", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 24, "deletions": 15, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -101,8 +101,7 @@\n import server.maps.FieldLimit;\n \n public class Commands {\n-\n-\tprivate static HashMap<String, Integer> gotomaps = new HashMap<String, Integer>();\n+        private static HashMap<String, Integer> gotomaps = new HashMap<String, Integer>();\n \n \tprivate static String[] tips = {\n \t\t\"Please only use @gm in emergencies or to report somebody.\",\n@@ -612,7 +611,7 @@ public static boolean executePlayerCommand(MapleClient c, String[] sub, char hea\n \t\t\t\t\t\tbar += i < percent ? \"|\" : \".\";\n \t\t\t\t\t}\n \t\t\t\t\tbar += \"]\";\n-\t\t\t\t\tplayer.yellowMessage(monster.getName() + \" has \" + percent + \"% HP left.\");\n+\t\t\t\t\tplayer.yellowMessage(monster.getName() + \" (\" + monster.getId() + \") has \" + percent + \"% HP left.\");\n \t\t\t\t\tplayer.yellowMessage(\"HP: \" + bar);\n \t\t\t\t}\n \t\t\t} \n@@ -755,7 +754,7 @@ public static boolean executeGMCommand(MapleClient c, String[] sub, char heading\n \t\t\tplayer.getMap().clearDrops(player);\n \t\t} else if (sub[0].equals(\"go\")) {\n                         if (sub.length < 2){\n-\t\t\t\tplayer.yellowMessage(\"Syntax: !spawn <mobid>\");\n+\t\t\t\tplayer.yellowMessage(\"Syntax: !go <mapid>\");\n \t\t\t\treturn false;\n \t\t\t}\n                     \n@@ -1132,7 +1131,7 @@ public static boolean executeGMCommand(MapleClient c, String[] sub, char heading\n \t\t\t\t\te.printStackTrace();\n \t\t\t\t}\n \t\t\t}\n-\t\t} else if (sub[0].equals(\"killall\")) {\n+\t\t} else if (sub[0].equals(\"killall\")) {  // will need to be used again in case of horntail or multiple state baddies\n \t\t\tList<MapleMapObject> monsters = player.getMap().getMapObjectsInRange(player.getPosition(), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER));\n \t\t\tMapleMap map = player.getMap();\n \t\t\tfor (MapleMapObject monstermo : monsters) {\n@@ -1147,7 +1146,7 @@ public static boolean executeGMCommand(MapleClient c, String[] sub, char heading\n \t\t\tList<MapleMapObject> monsters = player.getMap().getMapObjectsInRange(player.getPosition(), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER));\n \t\t\tfor (MapleMapObject monstermo : monsters) {\n \t\t\t\tMapleMonster monster = (MapleMonster) monstermo;\n-\t\t\t\tplayer.message(\"Monster ID: \" + monster.getId());\n+\t\t\t\tplayer.message(\"Monster ID: \" + monster.getId() + \" Aggro target: \" + ((monster.getController() != null) ? monster.getController().getName() : \"<none>\"));\n \t\t\t}\n \t\t} else if (sub[0].equals(\"unbug\")) {\n \t\t\tc.getPlayer().getMap().broadcastMessage(MaplePacketCreator.enableActions());\n@@ -1428,6 +1427,24 @@ public void run() {\n \tpublic static void executeAdminCommand(MapleClient c, String[] sub, char heading) {\n \t\tMapleCharacter player = c.getPlayer();\n \t\tswitch (sub[0]) {\n+                case \"zakum\":\n+                        player.getMap().spawnFakeMonsterOnGroundBelow(MapleLifeFactory.getMonster(8800000), player.getPosition());\n+                        for (int x = 8800003; x < 8800011; x++) {\n+                                player.getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(x), player.getPosition());\n+                        }\n+                        break;\n+                    \n+                case \"horntail\":\n+                        final Point targetPoint = player.getPosition();\n+                        final MapleMap targetMap = player.getMap();\n+                        \n+                        targetMap.spawnHorntailOnGroundBelow(targetPoint);\n+                        break;\n+                    \n+                case \"pinkbean\":\n+                       player.getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8820001), player.getPosition());\n+                       break;\n+                    \n \t\tcase \"sp\":  //Changed to support giving sp /a\n                         if (sub.length < 2){\n \t\t\t\tplayer.yellowMessage(\"Syntax: !sp <newsp>\");\n@@ -1443,9 +1460,7 @@ public static void executeAdminCommand(MapleClient c, String[] sub, char heading\n \t\t\t\tvictim.updateSingleStat(MapleStat.AVAILABLESP, player.getRemainingSp());\n \t\t\t}\n \t\t\tbreak;\n-\t\tcase \"horntail\":\n-\t\t\tplayer.getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8810026), player.getPosition());\n-\t\t\tbreak;\n+                \n \t\tcase \"packet\":\n \t\t\tplayer.getMap().broadcastMessage(MaplePacketCreator.customPacket(joinStringFrom(sub, 1)));\n \t\t\tbreak;\n@@ -1613,12 +1628,6 @@ public static void executeAdminCommand(MapleClient c, String[] sub, char heading\n \t\t\t\tplayer.getMap().removeMapObject(item);\n \t\t\t}\n \t\t\tbreak;\n-\t\tcase \"zakum\":\n-\t\t\tplayer.getMap().spawnFakeMonsterOnGroundBelow(MapleLifeFactory.getMonster(8800000), player.getPosition());\n-\t\t\tfor (int x = 8800003; x < 8800011; x++) {\n-\t\t\t\tplayer.getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(x), player.getPosition());\n-\t\t\t}\n-\t\t\tbreak;\n \t\tcase \"clearquestcache\":\n \t\t\tMapleQuest.clearCache();\n \t\t\tplayer.dropMessage(5, \"Quest Cache Cleared.\");"}, {"sha": "f9798b2c80173fa93c632c3c6edd88b33ffdd444", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -210,6 +210,7 @@ public synchronized void damage(MapleCharacter from, int damage) { // may be poi\n         int trueDamage = Math.min(hp, damage); // since magic happens otherwise B^)\n         \n         if(ServerConstants.USE_DEBUG == true && from != null) from.dropMessage(5, \"Hitted MOB \" + this.getId());\n+        dispatchMonsterDamaged(from, trueDamage);\n \n         hp -= damage;\n         if (takenDamage.containsKey(from.getId())) {\n@@ -368,16 +369,14 @@ public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKille\n                     personalExp *= (stati.get(MonsterStatus.SHOWDOWN).getStati().get(MonsterStatus.SHOWDOWN).doubleValue() / 100.0 + 1.0);\n                 }\n             }\n-            if (exp < 0) {//O.O ><\n-                personalExp = Integer.MAX_VALUE;\n-            }\n+            \n             attacker.gainExp(personalExp, partyExp, true, false, isKiller);\n             attacker.mobKilled(getId());\n             attacker.increaseEquipExp(personalExp);//better place\n         }\n     }\n \n-    public MapleCharacter killBy(MapleCharacter killer) {\n+    public MapleCharacter killBy(final MapleCharacter killer) {\n         distributeExperience(killer != null ? killer.getId() : 0);\n \n         if (getController() != null) { // this can/should only happen when a hidden gm attacks the monster\n@@ -424,11 +423,16 @@ public void run() {\n                             mob.disableDrops();\n                         }\n                         reviveMap.spawnMonster(mob);\n+                        \n+                        if(mob.getId() >= 8810010 && mob.getId() <= 8810017 && reviveMap.isHorntailDefeated()) {\n+                            for(int i = 8810018; i >= 8810010; i--)\n+                                reviveMap.killMonster(reviveMap.getMonsterById(i), killer, true);\n+                        }\n                     }\n                 }\n             }, getAnimationTime(\"die1\"));\n         }\n-        else {\n+        else {  // is this even necessary?\n             System.out.println(\"[CRITICAL LOSS] toSpawn is null for \" + this.getName());\n         }\n         \n@@ -447,6 +451,12 @@ public void dispatchMonsterKilled() {\n             listener.monsterKilled(getAnimationTime(\"die1\"));\n         }\n     }\n+    \n+    public void dispatchMonsterDamaged(MapleCharacter from, int trueDmg) {\n+        for (MonsterListener listener : listeners.toArray(new MonsterListener[listeners.size()])) {\n+            listener.monsterDamaged(from, trueDmg);\n+        }\n+    }\n \n     // should only really be used to determine drop owner\n     private int getHighestDamagerId() {\n@@ -992,7 +1002,7 @@ private float getDifficultyRate(final int difficulty) {\n         return(1.0f);\n     }\n     \n-    private final void changeLevelByDifficulty(final int difficulty, boolean pqMob) {\n+    private void changeLevelByDifficulty(final int difficulty, boolean pqMob) {\n         changeLevel((int)(this.getLevel() * getDifficultyRate(difficulty)), pqMob);\n     }\n     "}, {"sha": "49e41620a8b1cafddabac443225c9d995394d001", "filename": "src/server/life/MonsterListener.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/MonsterListener.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/MonsterListener.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MonsterListener.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -1,6 +1,8 @@\n package server.life;\n+import client.MapleCharacter;\n \n public interface MonsterListener {\n     \n     public void monsterKilled(int aniTime);\n+    public void monsterDamaged(MapleCharacter from, int trueDmg);\n }"}, {"sha": "be523cc3e0ba3f80322dd48473080f17a0de03f2", "filename": "src/server/life/SpawnPoint.java", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/SpawnPoint.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/life/SpawnPoint.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/SpawnPoint.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -91,6 +91,9 @@ public void monsterKilled(int aniTime) {\n                 }\n                 spawnedMonsters.decrementAndGet();\n             }\n+            \n+            @Override\n+            public void monsterDamaged(MapleCharacter from, int trueDmg) {}\n         });\n         if (mobTime == 0) {\n             nextPossibleSpawn = System.currentTimeMillis() + mobInterval;"}, {"sha": "87a6a981ae77fb02c0a6777f4d8721a2eaeb1b2f", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 45, "deletions": 16, "changes": 61, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/36c3b7dea8beafad80c9bd50f27ada824eb085e6/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=36c3b7dea8beafad80c9bd50f27ada824eb085e6", "patch": "@@ -77,6 +77,7 @@\n import server.partyquest.MonsterCarnivalParty;\n import server.partyquest.Pyramid;\n import scripting.event.EventInstanceManager;\n+import server.life.MonsterListener;\n import tools.FilePrinter;\n import tools.MaplePacketCreator;\n import tools.Pair;\n@@ -611,7 +612,7 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n             }\n             if (monster.getStats().selfDestruction() != null && monster.getStats().selfDestruction().getHp() > -1) {// should work ;p\n                 if (monster.getHp() <= monster.getStats().selfDestruction().getHp()) {\n-                    killMonster(monster, chr, true, false, monster.getStats().selfDestruction().getAction());\n+                    killMonster(monster, chr, true, monster.getStats().selfDestruction().getAction());\n                     return true;\n                 }\n             }\n@@ -632,20 +633,12 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n     }\n \n     public void killMonster(final MapleMonster monster, final MapleCharacter chr, final boolean withDrops) {\n-        killMonster(monster, chr, withDrops, false, 1);\n+        killMonster(monster, chr, withDrops, 1);\n     }\n \n-    public void killMonster(final MapleMonster monster, final MapleCharacter chr, final boolean withDrops, final boolean secondTime, int animation) {\n-        if (monster.getId() == 8810018 && !secondTime) {\n-            TimerManager.getInstance().schedule(new Runnable() {\n-                @Override\n-                public void run() {\n-                    killMonster(monster, chr, withDrops, true, 1);\n-                    killAllMonsters();\n-                }\n-            }, 3000);\n-            return;\n-        }\n+    public void killMonster(final MapleMonster monster, final MapleCharacter chr, final boolean withDrops, int animation) {\n+        if(monster == null) return;\n+        \n         if (chr == null) {\n             spawnedMonstersOnMap.decrementAndGet();\n             monster.setHp(0);\n@@ -780,7 +773,7 @@ public void killAllMonstersNotFriendly() {\n                 continue;\n             }\n             \n-            killMonster(monster, null, false, false, 1);\n+            killMonster(monster, null, false, 1);\n         }\n     }\n \n@@ -792,7 +785,7 @@ public void killAllMonsters() {\n         for (MapleMapObject monstermo : getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER))) {\n             MapleMonster monster = (MapleMonster) monstermo;\n             \n-            killMonster(monster, null, false, false, 1);\n+            killMonster(monster, null, false, 1);\n         }\n     }\n \n@@ -1174,7 +1167,7 @@ public void run() {\n                 TimerManager.getInstance().schedule(new Runnable() {\n                     @Override\n                     public void run() {\n-                        killMonster(monster, null, false, false, selfDestruction.getAction());\n+                        killMonster(monster, null, false, selfDestruction.getAction());\n                     }\n                 }, selfDestruction.removeAfter() * 1000);\n             }\n@@ -2666,4 +2659,40 @@ public void broadcastEnemyShip(final boolean state) {\n     public boolean isDojoMap() {\n         return mapid >= 925020000 && mapid < 925040000;\n     }\n+    \n+    public boolean isHorntailDefeated() {   // all parts of dead horntail can be found here?\n+        for(int i = 8810010; i <= 8810017; i++) {\n+            if(getMonsterById(i) == null) return false;\n+        }\n+        \n+        return true;\n+    }\n+    \n+    public void spawnHorntailOnGroundBelow(final Point targetPoint) {   // ayy lmao\n+        spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8810026), targetPoint);\n+        TimerManager.getInstance().schedule(new Runnable() {\n+            @Override\n+            public void run() {\n+                for (int x = 8810002; x <= 8810009; x++) {\n+                    spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(x), targetPoint);\n+                }\n+\n+                spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8810018), targetPoint);\n+                \n+                final MapleMonster ht = getMonsterById(8810018);\n+                for(int mobId = 8810002; mobId <= 8810009; mobId++) {\n+                    getMonsterById(mobId).addListener(new MonsterListener() {\n+                        @Override\n+                        public void monsterKilled(int aniTime) {}\n+\n+                        @Override\n+                        public void monsterDamaged(MapleCharacter from, int trueDmg) {\n+                            ht.damage(from, trueDmg);\n+                        }\n+                    });\n+                }\n+            }\n+\n+        }, 5 * 1000);\n+    }\n }"}]}]},
