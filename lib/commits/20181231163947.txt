{"fetchDate": "2019-12-19", "content": [{"sha": "fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ZmM5MzVkNWY4NzgxMjZmZjRmYjE2NWU2ZjUwZWI3Y2E5Y2IzZTQyNQ==", "commit": {"author": {"name": "MedicOP", "email": "MedicOP@users.noreply.github.com", "date": "2018-12-31T16:39:47Z"}, "committer": {"name": "Ronan Lana", "email": "rcpl2010@gmail.com", "date": "2018-12-31T16:39:47Z"}, "message": "Server flag to log chat (#294)", "tree": {"sha": "377b0b84edc64d17e86eded12f0668ba7cd11356", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/377b0b84edc64d17e86eded12f0668ba7cd11356"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "html_url": "https://github.com/ronancpl/HeavenMS/commit/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/comments", "author": {"login": "MedicOP", "id": 18251099, "node_id": "MDQ6VXNlcjE4MjUxMDk5", "avatar_url": "https://avatars3.githubusercontent.com/u/18251099?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MedicOP", "html_url": "https://github.com/MedicOP", "followers_url": "https://api.github.com/users/MedicOP/followers", "following_url": "https://api.github.com/users/MedicOP/following{/other_user}", "gists_url": "https://api.github.com/users/MedicOP/gists{/gist_id}", "starred_url": "https://api.github.com/users/MedicOP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MedicOP/subscriptions", "organizations_url": "https://api.github.com/users/MedicOP/orgs", "repos_url": "https://api.github.com/users/MedicOP/repos", "events_url": "https://api.github.com/users/MedicOP/events{/privacy}", "received_events_url": "https://api.github.com/users/MedicOP/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc73cb00de5035d07d32309e358642a85b4e88c7", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/dc73cb00de5035d07d32309e358642a85b4e88c7", "html_url": "https://github.com/ronancpl/HeavenMS/commit/dc73cb00de5035d07d32309e358642a85b4e88c7"}], "stats": {"total": 57, "additions": 55, "deletions": 2}, "files": [{"sha": "c18274e222aa1d426f6d224aecac47778490a609", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -100,6 +100,7 @@\n     public static final boolean USE_MULTIPLE_SAME_EQUIP_DROP = true;//Enables multiple drops by mobs of the same equipment, number of possible drops based on the quantities provided at the drop data.\n     public static final boolean USE_BANISHABLE_TOWN_SCROLL = true;  //Enables town scrolls to act as if it's a \"player banish\", rendering the antibanish scroll effect available.\n     public static final boolean USE_ENABLE_FULL_RESPAWN = true;     //At respawn task, always respawn missing mobs when they're available. Spawn count doesn't depend on how many players are currently there.\n+    public static final boolean USE_ENABLE_CHAT_LOG = true;         //Write in-game chat to log\n     \n     //Events/PQs Configuration\n     public static final boolean USE_OLD_GMS_STYLED_PQ_NPCS = true;  //Enables PQ NPCs with similar behaviour to old GMS style, that skips info about the PQs and immediately tries to register the party in."}, {"sha": "a27edfa2d069be662131b351de0bcb668774ebda", "filename": "src/net/server/channel/handlers/AdminChatHandler.java", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/AdminChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/AdminChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AdminChatHandler.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -1,7 +1,9 @@\n package net.server.channel.handlers;\n \n import client.MapleClient;\n+import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n+import tools.LogHelper;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -18,16 +20,26 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n         byte mode = slea.readByte();\n         //not saving slides...\n-        byte[] packet = MaplePacketCreator.serverNotice(slea.readByte(), slea.readMapleAsciiString());//maybe I should make a check for the slea.readByte()... but I just hope gm's don't fuck things up :)\n+        String message = slea.readMapleAsciiString();\n+        byte[] packet = MaplePacketCreator.serverNotice(slea.readByte(), message);//maybe I should make a check for the slea.readByte()... but I just hope gm's don't fuck things up :)\n         switch (mode) {\n             case 0:// /alertall, /noticeall, /slideall\n                 c.getWorldServer().broadcastPacket(packet);\n+                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                    LogHelper.logChat(c, \"Alert All\", message);\n+                }\n                 break;\n             case 1:// /alertch, /noticech, /slidech\n                 c.getChannelServer().broadcastPacket(packet);\n+                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                    LogHelper.logChat(c, \"Alert Ch\", message);\n+                }\n                 break;\n             case 2:// /alertm /alertmap, /noticem /noticemap, /slidem /slidemap\n                 c.getPlayer().getMap().broadcastMessage(packet);\n+                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                    LogHelper.logChat(c, \"Alert Map\", message);\n+                }\n                 break;\n \n         }"}, {"sha": "beacc595921d645b85494714b9d37f1b93a61159", "filename": "src/net/server/channel/handlers/GeneralChatHandler.java", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/GeneralChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/GeneralChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/GeneralChatHandler.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -25,8 +25,10 @@\n import client.MapleClient;\n import client.autoban.AutobanFactory;\n import client.command.CommandsExecutor;\n+import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n import tools.FilePrinter;\n+import tools.LogHelper;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -56,9 +58,15 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         }\n \n                         if (!chr.isHidden()) {\n-                                chr.getMap().broadcastMessage(MaplePacketCreator.getChatText(chr.getId(), s, chr.getWhiteChat(), show));\t\n+                                chr.getMap().broadcastMessage(MaplePacketCreator.getChatText(chr.getId(), s, chr.getWhiteChat(), show));\n+                                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                                        LogHelper.logChat(c, \"General\", s);\n+                                }\n                         } else {\n                                 chr.getMap().broadcastGMMessage(MaplePacketCreator.getChatText(chr.getId(), s, chr.getWhiteChat(), show));\n+                                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                                        LogHelper.logChat(c, \"GM General\", s);\n+                                }\n                         }\n \n                         chr.getAutobanManager().spam(7);"}, {"sha": "af883d8ad53104d4129d852fa454076bd249fa61", "filename": "src/net/server/channel/handlers/MultiChatHandler.java", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/MultiChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/MultiChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MultiChatHandler.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -24,10 +24,12 @@\n import client.MapleCharacter;\n import client.MapleClient;\n import client.autoban.AutobanFactory;\n+import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n import net.server.Server;\n import net.server.world.World;\n import tools.FilePrinter;\n+import tools.LogHelper;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -55,14 +57,26 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         World world = c.getWorldServer();\n         if (type == 0) {\n             world.buddyChat(recipients, player.getId(), player.getName(), chattext);\n+            if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                LogHelper.logChat(c, \"Buddy\", chattext);\n+            }\n         } else if (type == 1 && player.getParty() != null) {\n             world.partyChat(player.getParty(), chattext, player.getName());\n+            if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                LogHelper.logChat(c, \"Party\", chattext);\n+            }\n         } else if (type == 2 && player.getGuildId() > 0) {\n             Server.getInstance().guildChat(player.getGuildId(), player.getName(), player.getId(), chattext);\n+            if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                LogHelper.logChat(c, \"Guild\", chattext);\n+            }\n         } else if (type == 3 && player.getGuild() != null) {\n             int allianceId = player.getGuild().getAllianceId();\n             if (allianceId > 0) {\n                 Server.getInstance().allianceMessage(allianceId, MaplePacketCreator.multiChat(player.getName(), chattext, 3), player.getId(), -1);\n+                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                    LogHelper.logChat(c, \"Ally\", chattext);\n+                }\n             }\n         }\n         player.getAutobanManager().spam(7);"}, {"sha": "e7cd003243eab2e6abba04e8940db41404d25e87", "filename": "src/net/server/channel/handlers/PetChatHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/PetChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/PetChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetChatHandler.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -23,8 +23,10 @@\n \n import client.MapleClient;\n import client.autoban.AutobanFactory;\n+import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n import tools.FilePrinter;\n+import tools.LogHelper;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -48,5 +50,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \treturn;\n         }\n         c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.petChat(c.getPlayer().getId(), pet, act, text), true);\n+        if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+            LogHelper.logChat(c, \"Pet\", text);\n+        }\n     } \n }"}, {"sha": "09ec66a389b1362038e62050720bbbf9089f6489", "filename": "src/net/server/channel/handlers/SpouseChatHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/SpouseChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/net/server/channel/handlers/SpouseChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpouseChatHandler.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -23,7 +23,9 @@\n \n import client.MapleCharacter;\n import client.MapleClient;\n+import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n+import tools.LogHelper;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -39,6 +41,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (spouse != null) {\n                 spouse.announce(MaplePacketCreator.OnCoupleMessage(c.getPlayer().getName(), msg, true));\n                 c.announce(MaplePacketCreator.OnCoupleMessage(c.getPlayer().getName(), msg, true));\n+                if (ServerConstants.USE_ENABLE_CHAT_LOG) {\n+                    LogHelper.logChat(c, \"Spouse\", msg);\n+                }\n             } else {\n                 c.getPlayer().dropMessage(5, \"Your spouse is currently offline.\");\n             }"}, {"sha": "f1ec043610f74039ee04e339263b35fe7dddc33d", "filename": "src/tools/LogHelper.java", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/tools/LogHelper.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fc935d5f878126ff4fb165e6f50eb7ca9cb3e425/src/tools/LogHelper.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/LogHelper.java?ref=fc935d5f878126ff4fb165e6f50eb7ca9cb3e425", "patch": "@@ -1,8 +1,10 @@\n package tools;\n \n import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n import java.util.Date;\n \n+import client.MapleClient;\n import net.server.Server;\n import net.server.channel.Channel;\n import net.server.world.MapleParty;\n@@ -71,4 +73,10 @@ public static void logGacha(MapleCharacter player, int itemid, String map) {\n \t\tString log = player.getName() + \" got a \" + itemName + \"(\" + itemid + \") from the \" + map + \" gachapon. - \" + timeStamp + \"\\r\\n\";\n \t\tFilePrinter.print(\"gachapon.txt\", log);\n \t}\n+\n+\tpublic static void logChat(MapleClient player, String chatType, String text){\n+\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"dd-MM-yyyy HH:mm\");\n+\t\tFilePrinter.print(\"chat.txt\", \"[\" + sdf.format(Calendar.getInstance().getTime()) + \"] (\" + chatType + \") \" +player.getPlayer().getName() + \": \" + text + \"\\r\\n\");\n+\t}\n+\n }"}]}]},
