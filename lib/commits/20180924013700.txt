{"fetchDate": "2019-12-19", "content": [{"sha": "5480035005a8056dd027e0f711c668cc13d4c8fa", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6NTQ4MDAzNTAwNWE4MDU2ZGQwMjdlMGY3MTFjNjY4Y2MxM2Q0YzhmYQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-09-24T01:37:00Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-09-24T01:37:00Z"}, "message": "Level/exp on all equips + Player stats overhaul + Chair handler patch\n\nImplemented a massive overhaul on Character.wz, adding in equipment level-related nodes in order to make equipments level/EXP info available for anyone to check.\nImplemented a major overhaul on the player stat management throughout the source, properly encapsulating and concurrency protecting it's mechanics.\nReviewed several MoveLifeHandler aspects, some of them trying to prevent mobs from falling from footholds in certain circumstances.\nFixed MP Recovery instant killing players when they run out of HP to use.\nFixed some chairs arbitrarily disconnecting players upon HP/MP recovery.\nFixed Puppets sticking to maps in certain scenarios.\nCached data and added concurrency protection for EXP gain on equipments.\nReworked Chair Mastery skill, now with recovering amounts based on a player's base HP/MP pool.\nFixed several deadlock issues revolving rate coupons and character inventory.\nImproved overall autopot handler performance.\nReworked door bosses (such as Crocell), now spawning each 3 hours instead of upon player's demand.\nFixed alliances not saving rank names on DB at creation time.\nFixed alliances retaining disbanded guild info on DB.\nAdded Mystic Door support for the Mushroom Castle area.", "tree": {"sha": "5a3e13335e77af64beba0fa161a000fc67994f40", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/5a3e13335e77af64beba0fa161a000fc67994f40"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/5480035005a8056dd027e0f711c668cc13d4c8fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/5480035005a8056dd027e0f711c668cc13d4c8fa", "html_url": "https://github.com/ronancpl/HeavenMS/commit/5480035005a8056dd027e0f711c668cc13d4c8fa", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/5480035005a8056dd027e0f711c668cc13d4c8fa/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398"}], "stats": {"total": 14496, "additions": 8111, "deletions": 6385}, "files": [{"sha": "029f36015fac0fd9a5b6dfe97790c5130286a343", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,6 +23,10 @@\n /tools/MapleCouponInstaller/dist/\n /tools/MapleCouponInstaller/nbproject/\n \n+/tools/MapleEquipmentOmnileveler/build/\n+/tools/MapleEquipmentOmnileveler/dist/\n+/tools/MapleEquipmentOmnileveler/nbproject/\n+\n /tools/MapleIdRetriever/build/\n /tools/MapleIdRetriever/dist/\n /tools/MapleIdRetriever/nbproject/"}, {"sha": "6290ff8250e952a5014a020e2dd87035a6802b62", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -3,7 +3,7 @@\n \n ## Head developer: Ronan C. P. Lana\n \n-Besides myself for maintaining this repository, credits are to be given to Nexon(Duh!), the original MapleSolaxia staff and other colaborators, as just some changes/patches on the game were applied by myself, in which some of them diverged from the original v83 patch contents (alright, not just \"some patches\" by now since a whole lot of major server core changes have been applied on this development).\n+Besides myself for maintaining this repository, credits are to be given to Wizet/Nexon (owners of MapleStory & it's IP contents), the original MapleSolaxia staff and other colaborators, as just some changes/patches on the game were applied by myself, in which some of them diverged from the original v83 patch contents (alright, not just \"some patches\" by now since a whole lot of major server core changes have been applied on this development).\n \n Regarding distributability and usage of the code presented here: like it was before, this MapleStory server is open-source. By that, it is meant that anyone is **free to install, use, modify and redistribute the contents**, as long as there is **no kind of commercial trading involved** and the **credits to the original creators are maintained** within the codes.\n "}, {"sha": "00e72ec4aa9b59015341a98c524dea1f60808c98", "filename": "docs/feature_list.md", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -25,7 +25,7 @@ PQs:\n * HPQ/KPQ/LPQ/LMPQ/OPQ/EllinPQ/PiratePQ/MagatiaPQ/HorntailPQ/AmoriaPQ/TreasurePQ/ElnathPQ/HolidayPQ.\n * CWKPQ as Expedition-based event.\n * Expeditions: Scarga/Horntail/Showa/Balrog/Zakum/Pinkbean.\n-* GuildPQ + Guild queue with multi-lobby systems available.\n+* GuildPQ + Guild queue with multi-lobby system available.\n * Brand-new PQs: BossRushPQ, CafePQ.\n * Mu Lung Dojo.\n * Capt. Latanica remade as an event (parties can now fight the boss).\n@@ -67,6 +67,7 @@ Player Social Network:\n * Further improved the server's ranking system, now displaying properly daily player ranking movement.\n * Automated support for Player NPCs and Hall of Fame.\n * Protected concurrently and improved the face expression system, guarding from trivial packet spam and exploits.\n+* All upgradeable non-cash equipments in inventory with level & EXP information available for read by anyone, given proper visibility.\n \n Cash & Items:\n \n@@ -98,6 +99,7 @@ Monsters, Maps & Reactors:\n * Mobs now can drop more than one of the same equipment (number of possible drops defined at droptime, uses the minimum/maximum quantity fields on DB).\n * Mobs only drops items that are visible/collectable by the player's party.\n * Redesigned HT mechanics for spawn and linked damage to the sponge.\n+* Reviewed aspects of MoveLifeHandler: implemented banish move, patched MP cost not contabilized on non-skill mob moves and slightly fixed mobs dropping from footholds in certain cases.\n * Limited item count on maps, smartly expiring oldest registered items, preventing potential item flooding.\n * Implemented Zombify disease status.\n * Added Boss HP Bar for dozens of bosses (needs provided custom wz).\n@@ -113,6 +115,7 @@ Monsters, Maps & Reactors:\n * Reactors pick items up smartly, checking for an option to pick up on many-items-nearby scenario.\n * Updated many scripted portals not implementing SFX properly.\n * Updated Crimsonwood, World Tour, Nihal Desert and Neo City, enabling quest completion and game progression in these areas.\n+* Added world maps for Mushroom Castle, World Tour (Singapore, Malaysia and Zipangu) & Ellin Forest areas.\n * Giant Cake (anniversary-themed boss) drops Maple equipments, Maple scrolls, summoning bags and many more interesting items.\n \n PQ potentials:\n@@ -122,13 +125,14 @@ PQ potentials:\n * Expedition system - Multiples parties can attempt on a same instance (lobbies and expeds are mutually-exclusive).\n * Guild queue system - Guilds can register themselves on a queue for the GPQ.\n * EIM Pool system - After the first instance setup, next event instances are loaded beforehand and set on a pooling queue, optimizing future loadouts.\n+* Recall system - Players can rejoin the last event instance they were in before disconnection.\n \n Player potentials:\n \n * Adventurer Mount quests functional.\n * All Equipment levels up.\n * Player level rates.\n-* Gain fame by quests.\n+* Gain fame by quests and event instances.\n * Pet evolutions functional (not GMS-like).\n * Reviewed keybinding system.\n * Account's Character slots: either each world has it's own count or there's a shared value between all worlds.\n@@ -145,6 +149,7 @@ Server potentials:\n * Enhanced AP auto-assigner: exactly matches AP with the needed for the player's current level, surplus assigned to the primary attribute.\n * Enhanced inventory check: free slots on inventory smartly fetched on demand.\n * Enhanced auto-loot handler: optimized the brute-force checks for some cash items on the player equipped inventory at every requisition.\n+* Added players-appointed bestsellers item ranking system for Owl of Minerva and Cash Shop.\n * Tweaked pet/mount hunger: calculations for fullness/tiredness takes active time of the subject into account.\n * Consistent experience and meso gain system.\n * NPC crafters (equips, plates/jewels, etc) now won't take items freely if the requirement conditions are not properly met.\n@@ -191,6 +196,7 @@ External tools:\n * MapleBossHpBarFetcher - Searches the quest WZ files and reports in all relevant data regarding mobs that has a boss HP bar whilst not having a proper \"boss\" label.\n * MapleCashDropFetcher - Searches the DB for any CASH drop data entry and lists them on a report file.\n * MapleCouponInstaller - Retrieves coupon info from the WZ and makes a SQL table with it. The server will use that table to gather info regarding rates and intervals.\n+* MapleEquipmentOmnileveler - Updates the equipment WZ nodes with item level information, allowing thus access for item level and EXP info for common equipments.\n * MapleIdRetriever - Two behaviors: generates a SQL table with relation (id, name) of the handbook given as input. Given a file with names, outputs a file with ids.\n * MapleInvalidItemIdFetcher - Generates a file listing all inexistent itemid's currently laying on the DB.\n * MapleInvalidItemWithNoNameFetcher - Generates two files: one listing all itemid's with inexistent name and \"cash\" property. And other with a prepared XML to solve the name issue."}, {"sha": "8895877978c09de8abcce49c28df94b790323479", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 33, "deletions": 1, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1292,4 +1292,36 @@ Corrigido valores incorretos sendo retirado de jogadores para expans\u00e3o de guild\n Adicionado world map em Ellin Forest.\n Protegido concorrentemente sistema de fames.\n Adicionado ganho de quest points para jogadores que participam de PQs. Reformulado sistema de quest points para viabilizar a nova feature.\n-Otimizado m\u00e9todo de ganho de experi\u00eancia em equipamentos, agora devidamente cacheado e sem busca em strings no processo.\n\\ No newline at end of file\n+Otimizado m\u00e9todo de ganho de experi\u00eancia em equipamentos, agora devidamente cacheado e sem busca em strings no processo.\n+\n+08 Agosto 2018,\n+MapleServerHandler agora \u00e9 devidamente deregistrado ao finalizar uma inst\u00e2ncia de channel, eliminando poss\u00edvel foco de memory leak.\n+Fun\u00e7\u00f5es playerDead e playerRevive s\u00e3o agora opcionais em EIM scripts.\n+Nova ferramenta: MapleEquipmentOmnileveler. Permite adicionar e atualizar nodos referentes a n\u00edveis para todos os equipamentos. Em jogo, essa adi\u00e7\u00e3o permite jogadores a ver n\u00edvel de qualquer equipamento do jogo.\n+\n+09 - 10 Agosto 2018,\n+Adicionado c\u00e1lculo de MP ao realizar ataques de mobs.\n+Aplicado v\u00e1rios pequenos ajustes no handler que lida com movimenta\u00e7\u00e3o de mobs, procurando assim reduzir ruidos no fluxo do jogo (e.g. mob caindo de foothold).\n+Corrigido schedules de event instances sendo chamados ap\u00f3s finaliza\u00e7\u00e3o da mesma, levando locks j\u00e1 liberados a serem chamados inesperadamente.\n+Corrigido casos onde jogadores poderiam requisitar instancia\u00e7\u00e3o de uma nova PQ, cujo EM que j\u00e1 tenha sido liberado.\n+Aplicado reformata\u00e7\u00e3o geral no Character.wz, adicionando nodos de level para todos os equipamentos do jogo. Tal mudan\u00e7a permite que todos os equipamentos exponham n\u00edvel e experi\u00eancia em todos os equipamentos no invent\u00e1rio.\n+Implementado c\u00e1lculo de experi\u00eancia no lado do servidor que permite mostrar adequadamente EXP dos equipamentos no lado do cliente.\n+\n+11 - 19 Agosto 2018,\n+Corrigido MP Recovery skill n\u00e3o atuando segundo descri\u00e7\u00e3o, al\u00e9m de matando jogador com pouco HP dispon\u00edvel.\n+Refatorado completamente acessos de stats no c\u00f3digo do server.\n+Refatorado check de Berserk sendo chamado em m\u00faltiplas se\u00e7\u00f5es do c\u00f3digo.\n+Corrigido algumas cadeiras levando jogadores a desconectarem aleatoriamente.\n+Corrigido puppets ficando no mapa indeterminadamente em certos cen\u00e1rios.\n+Acrescentado prote\u00e7\u00e3o contra acesso concorrente em ganhos de EXP em equipamentos.\n+Door bosses (Marbas, Crocell, etc) agora spawnam de tempos em tempos, ao inv\u00e9s de serem chamados ao entrar no mapa.\n+Retrabalhado Chair Mastery, agora com cura atuando em porcentagem de HP/MP base.\n+Corrigido problema de deadlock com invent\u00e1rio de jogadores e EXP/DROP coupons.\n+Corrigido problema de deadlock com pickup de mesos e detec\u00e7\u00e3o de jogadores em party.\n+Corrigido problema de deadlock com o handler de pet autopot.\n+Melhorado desempenho do autopot handler.\n+Corrigido diversos aspectos do novo modelo de acesso de stats, agora propriamente protegido contra acesso concorrente.\n+Revitalizers de mounts s\u00e3o devidamente consumidos mesmo em casos mount tiredness seja zero.\n+Corrigido alliances retendo informa\u00e7\u00f5es de guilds que foram desfeitas na DB.\n+Corrigido alliances n\u00e3o salvando nomes de ranks na DB ao serem criadas.\n+Adicionado suporte para doors na regi\u00e3o de Mushroom Castle.\n\\ No newline at end of file"}, {"sha": "a47477b60b7a35426bbcafed3caddc8e791cf998", "filename": "scripts/event/AreaBossDoor1.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor1.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400610;\n+    var bossMapid = 677000003;\n+    var bossMsg = \"Amdusias has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(467, 0);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "a6189883737af7bdfb6a3008f2c3343c54ab7473", "filename": "scripts/event/AreaBossDoor2.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor2.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400609;\n+    var bossMapid = 677000005;\n+    var bossMsg = \"Andras has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(201, 80);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "2014c572c7df96beeba90188fc149ab5799b31d2", "filename": "scripts/event/AreaBossDoor3.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor3.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor3.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor3.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400613;\n+    var bossMapid = 677000009;\n+    var bossMsg = \"Valefor has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(251, -841);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "81be937ea91bd5453a07d0b3fe16696c9a94730a", "filename": "scripts/event/AreaBossDoor4.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor4.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor4.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor4.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400633;\n+    var bossMapid = 677000012;\n+    var bossMsg = \"Astaroth has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(842, 0);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "4363b431e107102c20a4a5a55e4810ca33ae8ddf", "filename": "scripts/event/AreaBossDoor5.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor5.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor5.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor5.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400612;\n+    var bossMapid = 677000001;\n+    var bossMsg = \"Marbas has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(461, 61);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "0b30926c0706d898ed6b630470c59c0bc5e77335", "filename": "scripts/event/AreaBossDoor6.js", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor6.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/AreaBossDoor6.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor6.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,57 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+-- Odin JavaScript --------------------------------------------------------------------------------\n+\tDoor boss Spawner (based on xQuasar's King Clang spawner)\n+**/\n+\n+function init() {\n+    scheduleNew();\n+}\n+\n+function scheduleNew() {\n+    setupTask = em.schedule(\"start\", 0);    //spawns upon server start. Each 3 hours an server event checks if boss exists, if not spawns it instantly.\n+}\n+\n+function cancelSchedule() {\n+    if (setupTask != null)\n+        setupTask.cancel(true);\n+}\n+\n+function start() {\n+    var bossMobid = 9400611;\n+    var bossMapid = 677000007;\n+    var bossMsg = \"Crocell has appeared!\";\n+    var bossPos = new Packages.java.awt.Point(171, 50);\n+    \n+    var map = em.getChannelServer().getMapFactory().getMap(bossMapid);\n+    if (map.getMonsterById(bossMobid) != null) {\n+        em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+        return;\n+    }\n+    \n+    var boss = Packages.server.life.MapleLifeFactory.getMonster(bossMobid);\n+    map.spawnMonsterOnGroundBelow(boss, bossPos);\n+    map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n+    \n+    em.schedule(\"start\", 3 * 60 * 60 * 1000);\n+}\n\\ No newline at end of file"}, {"sha": "5222bf2d3dec47ad7022f57ad3c4674557a9023d", "filename": "scripts/event/Cygnus_Magic_Library.js", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/Cygnus_Magic_Library.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/Cygnus_Magic_Library.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Cygnus_Magic_Library.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -40,10 +40,7 @@ function scheduledTimeout(eim){\n }\n \n function playerRevive(eim, player){\n-\tplayer.setHp(50);\n-\tplayer.setStance(0);\n-\teim.unregisterPlayer(player);\n-\tplayer.changeMap(entryMap);\n+        player.respawn(eim, entryMap);\n \treturn false;\n }\n "}, {"sha": "eb804b05af271698cfd100df3bac2eb5acb93e90", "filename": "scripts/event/GuardianNex.js", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/GuardianNex.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/GuardianNex.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuardianNex.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -36,10 +36,7 @@ function scheduledTimeout(eim){\n }\n \n function playerRevive(eim, player){\n-\tplayer.setHp(50);\n-\tplayer.setStance(0);\n-\teim.unregisterPlayer(player);\n-\tplayer.changeMap(exitMap);\n+\tplayer.respawn(eim, exitMap);\n \treturn false;\n }\n "}, {"sha": "de751d6f1845ac7c2a74da22239c4f6fd22db252", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -254,16 +254,11 @@ function playerDead(eim, player) {\n function playerRevive(eim, player) { // player presses ok on the death pop up.\n         if(eim.getIntProperty(\"canRevive\") == 0) {\n                 if (eim.isEventTeamLackingNow(true, minPlayers, player) && eim.getIntProperty(\"canJoin\") == 0) {\n-                        eim.unregisterPlayer(player);\n-                        player.setHp(50);\n-                        player.changeMap(exitMap);\n-                        \n+                        player.respawn(eim, exitMap);\n                         end(eim);\n                 }\n                 else {\n-                        eim.unregisterPlayer(player);\n-                        player.setHp(50);\n-                        player.changeMap(exitMap);\n+                        player.respawn(eim, exitMap);\n                 }\n                 \n                 return false;"}, {"sha": "934b7bac3f01adc3673b375f13fe5f400a974465", "filename": "scripts/event/MK_PrimeMinister.js", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/MK_PrimeMinister.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/MK_PrimeMinister.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -39,10 +39,7 @@ function scheduledTimeout(eim){\n }\n \n function playerRevive(eim, player){\n-\tplayer.setHp(50);\n-\tplayer.setStance(0);\n-\teim.unregisterPlayer(player);\n-\tplayer.changeMap(entryMap);\n+\tplayer.respawn(eim, entryMap);\n \treturn false;\n }\n "}, {"sha": "ea9e3c10099b3aa8d50b98ea2c243f2adab66dc6", "filename": "scripts/event/MK_PrimeMinister2.js", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/MK_PrimeMinister2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/MK_PrimeMinister2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister2.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -50,10 +50,7 @@ function scheduledTimeout(eim){\n }\n \n function playerRevive(eim, player){\n-\tplayer.setHp(50);\n-\tplayer.setStance(0);\n-\teim.unregisterPlayer(player);\n-\tplayer.changeMap(entryMap);\n+\tplayer.respawn(eim, entryMap);\n \treturn false;\n }\n "}, {"sha": "d7d4b07f5cb17e21c1492ecd7094d4bb783c49f6", "filename": "scripts/event/Puppeteer.js", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/Puppeteer.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/Puppeteer.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Puppeteer.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -34,10 +34,7 @@ function scheduledTimeout(eim){\n }\n \n function playerRevive(eim, player){\n-\tplayer.setHp(50);\n-\tplayer.setStance(0);\n-\teim.unregisterPlayer(player);\n-\tplayer.changeMap(exitMap);\n+\tplayer.respawn(eim, exitMap);\n \treturn false;\n }\n "}, {"sha": "b1cbdd4662b2ff101508d7cc531d274a8bc103ef", "filename": "scripts/event/RockSpirit.js", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/RockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/RockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpirit.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -61,10 +61,7 @@ function playerEntry(eim, player) {\n }\n \n function playerRevive(eim, player) {\n-    player.setHp(50);\n-    player.setStance(0);\n-    eim.unregisterPlayer(player);\n-    player.changeMap(exitMap);\n+    player.respawn(eim, exitMap);\n     return false;\n }\n \n@@ -136,9 +133,9 @@ function timeOut(eim) {\n         if (eim.getPlayerCount() > 0) {\n             var pIter = eim.getPlayers().iterator();\n             while (pIter.hasNext()){\n-\t\t\t\tvar player = pIter.next();\n+                var player = pIter.next();\n                 playerExit(eim, player);\n-\t\t\t}\n+            }\n         }\n         eim.dispose();\n     }"}, {"sha": "4895d5dc2bd8ad32e5d88b33b5d60f9e3e92cf87", "filename": "scripts/event/RockSpiritVIP.js", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/RockSpiritVIP.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/event/RockSpiritVIP.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpiritVIP.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -57,14 +57,11 @@ function respawn(eim) {\n function playerEntry(eim, player) {\n \tvar amplifierMap = eim.getMapInstance(startMap.getId());\n \tplayer.changeMap(amplifierMap);\n-    eim.schedule(\"timeOut\", timer);\n+        eim.schedule(\"timeOut\", timer);\n }\n \n function playerRevive(eim, player) {\n-    player.setHp(50);\n-    player.setStance(0);\n-    eim.unregisterPlayer(player);\n-    player.changeMap(exitMap);\n+    player.respawn(eim, exitMap);\n     return false;\n }\n \n@@ -136,9 +133,9 @@ function timeOut(eim) {\n         if (eim.getPlayerCount() > 0) {\n             var pIter = eim.getPlayers().iterator();\n             while (pIter.hasNext()){\n-\t\t\t\tvar player = pIter.next();\n+                var player = pIter.next();\n                 playerExit(eim, player);\n-\t\t\t}\n+            }\n         }\n         eim.dispose();\n     }"}, {"sha": "eecf0196a7cd8c3186d25621c3186fdd758bc1e2", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -81,6 +81,7 @@ function writeFeatureTab_PlayerSocialNetwork() {\n         addFeature(\"Protected and improved face expression system.\");\n         addFeature(\"Automated support for Player NPCs and Hall of Fame.\");\n         addFeature(\"Engagement & Wedding system.\");\n+        addFeature(\"Equipments displays to everyone it's level & EXP info.\");\n }\n \n function writeFeatureTab_CashItems() {\n@@ -112,6 +113,9 @@ function writeFeatureTab_MonstersMapsReactors() {\n         addFeature(\"Every skill/mastery book is now obtainable.\");\n         addFeature(\"Mobs now can drop more than one of the same equip.\");\n         addFeature(\"Mobs only drop items collectable by the player/party.\");\n+        addFeature(\"Mobs shouldn't fall from foothold too often now.\");\n+        addFeature(\"Properly applying MP cost on non-skill mob moves.\");\n+        addFeature(\"Implemented banish mob skill move.\");\n         addFeature(\"Redesigned HT mechanics: assemble & dmg taken.\");\n         addFeature(\"Implemented Zombify disease status.\");\n         addFeature(\"Added Boss HP Bar for dozens of bosses.\");\n@@ -126,7 +130,7 @@ function writeFeatureTab_MonstersMapsReactors() {\n         addFeature(\"Uncovered missing portal SFX on scripted portals.\");\n         addFeature(\"PQ boxes sprays items when opened, GMS-like.\");\n         addFeature(\"Reactors pick items up smartly from the field.\");\n-        addFeature(\"Updated scripted portals now with proper portal SFX.\");\n+        addFeature(\"Updated scripted portals, now with proper portal SFX.\");\n         addFeature(\"Reviewed Masteria, W. Tour, N. Desert and Neo City.\");\n         addFeature(\"Added world maps for M. Castle, W. Tour & Ellin areas.\");\n         addFeature(\"Giant Cake boss drops s. bags and Maple items.\");\n@@ -232,6 +236,7 @@ function writeFeatureTab_Project() {\n         addFeature(\"Developed many survey tools for content profiling.\");\n         addFeature(\"ThreadTracker: runtime tool for deadlock detection.\");\n         addFeature(\"Channel, World and Server-wide timer management.\");\n+        addFeature(\"Thoroughly reviewed encapsulation for player stats.\");\n         addFeature(\"Heavily reviewed future task management, spawning much less threads and relieving task overload on the TimerManager.\");\n }\n "}, {"sha": "143f404c800ee1fdc54ebb3e911e1be061c96baf", "filename": "scripts/quest/1021.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/quest/1021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/quest/1021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/1021.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -49,9 +49,8 @@ function start(mode, type, selection) {\n         else if (status == 2)\n             qm.sendAcceptDecline(\"So..... Let me just do this for fun! Abaracadabra~!\");\n         else if (status == 3) {\n-            if (qm.c.getPlayer().getHp() >= 50) {\n-                qm.c.getPlayer().setHp(25);\n-                qm.c.getPlayer().updateSingleStat(MapleStat.HP, 25);\n+            if (qm.getPlayer().getHp() >= 50) {\n+                qm.getPlayer().updateHp(25);\n             }\n             \n             if (!qm.haveItem(2010007)) {"}, {"sha": "2f30a5eef5528e787df2ea2cbb0630cb54c1dbf8", "filename": "scripts/quest/21010.js", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/quest/21010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/scripts/quest/21010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21010.js?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -46,9 +46,8 @@ function start(mode, type, selection) {\n     } else if (status == 3) { \n \tqm.sendAcceptDecline(\"Oh, but it seems our hero has become very weak since the Black Mage's curse. It's only makes sense, considering that the hero has been asleep for hundreds of years. #bHere, I'll give you a HP Recovery Potion.#k\");//nexon probably forgot to remove the '.' before '#k', lol\t\n     } else if (status == 4) {\n-       \tif (qm.c.getPlayer().getHp() >= 50) {\n-            \tqm.c.getPlayer().setHp(25);\n-            \tqm.c.getPlayer().updateSingleStat(MapleStat.HP, 25);\n+       \tif (qm.getPlayer().getHp() >= 50) {\n+            \tqm.getPlayer().updateHp(25);\n         } \n \tif (!qm.isQuestStarted(21010) && !qm.isQuestCompleted(21010)) {\n         \tqm.gainItem(2000022, 1);\n@@ -59,8 +58,8 @@ function start(mode, type, selection) {\n \tqm.sendNextPrev(\"#b(How do I drink the potion? I don't remember..)\", 3);\n     } else if (status == 6) {\t\n \tqm.guideHint(14);\n-        qm.dispose();\t\t\n-\t}\t\n+        qm.dispose();\n+    }\t\n }\n \n function end(mode, type, selection) {"}, {"sha": "589c9cf177ef4381ec1df2458e79b53420033f44", "filename": "sql/db_database.sql", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -55,11 +55,11 @@ CREATE TABLE IF NOT EXISTS `alliance` (\n   `capacity` int(10) unsigned NOT NULL DEFAULT '2',\n   `notice` varchar(20) NOT NULL DEFAULT '',\n \n-  `rank1` varchar(11) NOT NULL DEFAULT '',\n-  `rank2` varchar(11) NOT NULL DEFAULT '',\n-  `rank3` varchar(11) NOT NULL DEFAULT '',\n-  `rank4` varchar(11) NOT NULL DEFAULT '',\n-  `rank5` varchar(11) NOT NULL DEFAULT '',\n+  `rank1` varchar(11) NOT NULL DEFAULT 'Master',\n+  `rank2` varchar(11) NOT NULL DEFAULT 'Jr. Master',\n+  `rank3` varchar(11) NOT NULL DEFAULT 'Member',\n+  `rank4` varchar(11) NOT NULL DEFAULT 'Member',\n+  `rank5` varchar(11) NOT NULL DEFAULT 'Member',\n   PRIMARY KEY (`id`),\n   INDEX (name)\n ) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;"}, {"sha": "439d52a07ddd073a429be0186c50159cc04bad4b", "filename": "src/client/AbstractCharacterListener.java", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/AbstractCharacterListener.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/AbstractCharacterListener.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/AbstractCharacterListener.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,30 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package client;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public interface AbstractCharacterListener {\n+    public void onHpChanged(int oldHp);\n+    public void onHpmpPoolUpdate();\n+    public void onAnnounceStatPoolUpdate();\n+}"}, {"sha": "a7a422391acb35efa16a95899956763b42d10b10", "filename": "src/client/AbstractMapleCharacterObject.java", "status": "added", "additions": 712, "deletions": 0, "changes": 712, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/AbstractMapleCharacterObject.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/AbstractMapleCharacterObject.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/AbstractMapleCharacterObject.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,712 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package client;\n+\n+import constants.GameConstants;\n+import constants.ServerConstants;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.locks.Lock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock;\n+import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;\n+import net.server.audit.locks.MonitoredLockType;\n+import net.server.audit.locks.MonitoredReentrantReadWriteLock;\n+import net.server.audit.locks.factory.MonitoredReentrantLockFactory;\n+import server.maps.AbstractAnimatedMapleMapObject;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ */\n+public abstract class AbstractMapleCharacterObject extends AbstractAnimatedMapleMapObject {\n+    protected int str, dex, luk, int_, hp, maxhp, mp, maxmp;\n+    protected int hpMpApUsed, remainingAp;\n+    protected int[] remainingSp = new int[10];\n+    protected transient int clientmaxhp, clientmaxmp, localmaxhp = 50, localmaxmp = 5;\n+    \n+    private AbstractCharacterListener listener = null;\n+    protected Map<MapleStat, Integer> statUpdates = new HashMap<>();\n+    \n+    protected Lock effLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.CHARACTER_EFF, true);\n+    protected ReadLock statRlock;\n+    protected WriteLock statWlock;\n+    \n+    protected AbstractMapleCharacterObject() {\n+        ReentrantReadWriteLock locks = new MonitoredReentrantReadWriteLock(MonitoredLockType.CHARACTER_STA, true);\n+        statRlock = locks.readLock();\n+        statWlock = locks.writeLock();\n+        \n+        for (int i = 0; i < remainingSp.length; i++) {\n+            remainingSp[i] = 0;\n+        }\n+    }\n+    \n+    protected void setListener(AbstractCharacterListener listener) {\n+        this.listener = listener;\n+    }\n+    \n+    public int getStr() {\n+        statRlock.lock();\n+        try {\n+            return str;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getDex() {\n+        statRlock.lock();\n+        try {\n+            return dex;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getInt() {\n+        statRlock.lock();\n+        try {\n+            return int_;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+\n+    public int getLuk() {\n+        statRlock.lock();\n+        try {\n+            return luk;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getRemainingAp() {\n+        statRlock.lock();\n+        try {\n+            return remainingAp;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    protected int getRemainingSp(int jobid) {\n+        statRlock.lock();\n+        try {\n+            return remainingSp[GameConstants.getSkillBook(jobid)];\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+\n+    public int[] getRemainingSps() {\n+        statRlock.lock();\n+        try {\n+            return Arrays.copyOf(remainingSp, remainingSp.length);\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getHpMpApUsed() {\n+        statRlock.lock();\n+        try {\n+            return hpMpApUsed;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public boolean isAlive() {\n+        statRlock.lock();\n+        try {\n+            return hp > 0;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getHp() {\n+        statRlock.lock();\n+        try {\n+            return hp;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getMp() {\n+        statRlock.lock();\n+        try {\n+            return mp;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getMaxHp() {\n+        statRlock.lock();\n+        try {\n+            return maxhp;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getMaxMp() {\n+        statRlock.lock();\n+        try {\n+            return maxmp;\n+        } finally {\n+            statRlock.unlock();\n+        }\n+    }\n+    \n+    public int getClientMaxHp() {\n+        return clientmaxhp;\n+    }\n+    \n+    public int getClientMaxMp() {\n+        return clientmaxmp;\n+    }\n+    \n+    public int getCurrentMaxHp() {\n+        return localmaxhp;\n+    }\n+\n+    public int getCurrentMaxMp() {\n+        return localmaxmp;\n+    }\n+    \n+    private void setHpMpApUsed(int mpApUsed) {\n+        this.hpMpApUsed = mpApUsed;\n+    }\n+    \n+    private void dispatchHpChanged(int oldHp) {\n+        listener.onHpChanged(oldHp);\n+    }\n+    \n+    private void dispatchHpmpPoolUpdated() {\n+        listener.onHpmpPoolUpdate();\n+    }\n+    \n+    private void dispatchStatPoolUpdateAnnounced() {\n+        listener.onAnnounceStatPoolUpdate();\n+    }\n+    \n+    protected void setHp(int newHp) {\n+        int oldHp = hp;\n+        \n+        int thp = newHp;\n+        if (thp < 0) {\n+            thp = 0;\n+        } else if (thp > localmaxhp) {\n+            thp = localmaxhp;\n+        }\n+        this.hp = thp;\n+        \n+        dispatchHpChanged(oldHp);\n+    }\n+\n+    protected void setMp(int newMp) {\n+        int tmp = newMp;\n+        if (tmp < 0) {\n+            tmp = 0;\n+        } else if (tmp > localmaxmp) {\n+            tmp = localmaxmp;\n+        }\n+        this.mp = tmp;\n+    }\n+    \n+    private void setRemainingAp(int remainingAp) {\n+        this.remainingAp = remainingAp;\n+    }\n+    \n+    private void setRemainingSp(int remainingSp, int skillbook) {\n+        this.remainingSp[skillbook] = remainingSp;\n+    }\n+    \n+    protected void setMaxHp(int hp_) {\n+        this.maxhp = hp_;\n+        this.clientmaxhp = Math.min(30000, hp_);\n+    }\n+    \n+    protected void setMaxMp(int mp_) {\n+        this.maxmp = mp_;\n+        this.clientmaxmp = Math.min(30000, mp_);\n+    }\n+    \n+    private static long calcStatPoolNode(long v, int displacement) {\n+        if (v > Short.MAX_VALUE) {\n+            v = Short.MAX_VALUE;\n+        } else if (v < Short.MIN_VALUE) {\n+            v = Short.MIN_VALUE;\n+        }\n+        \n+        return ((v & 0x0FFFF) << displacement);\n+    }\n+    \n+    private static long calcStatPoolLong(int v1, int v2, int v3, int v4) {\n+        long ret = 0;\n+        \n+        ret |= calcStatPoolNode(v1, 48);\n+        ret |= calcStatPoolNode(v2, 32);\n+        ret |= calcStatPoolNode(v3, 16);\n+        ret |= calcStatPoolNode(v4, 0);\n+        \n+        return ret;\n+    }\n+    \n+    private void changeStatPool(Long hpMpPool, Long strDexIntLuk, Long newSp, int newAp, boolean silent) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            statUpdates.clear();\n+            boolean poolUpdate = false;\n+\n+            if (hpMpPool != null) {\n+                short newHp = (short) (hpMpPool >> 48);\n+                short newMp = (short) (hpMpPool >> 32);\n+                short newMaxHp = (short) (hpMpPool >> 16);\n+                short newMaxMp = (short) (hpMpPool.shortValue());\n+                \n+                if (newMaxHp != Short.MIN_VALUE) {\n+                    if (newMaxHp < 50) {\n+                        newMaxHp = 50;\n+                    }\n+\n+                    poolUpdate = true;\n+                    setMaxHp(newMaxHp);\n+                    statUpdates.put(MapleStat.MAXHP, clientmaxhp);\n+                    statUpdates.put(MapleStat.HP, hp);\n+                }\n+\n+                if (newHp != Short.MIN_VALUE) {\n+                    setHp(newHp);\n+                    statUpdates.put(MapleStat.HP, hp);\n+                }\n+\n+                if (newMaxMp != Short.MIN_VALUE) {\n+                    if (newMaxMp < 5) {\n+                        newMaxMp = 5;\n+                    }\n+\n+                    poolUpdate = true;\n+                    setMaxMp(newMaxMp);\n+                    statUpdates.put(MapleStat.MAXMP, clientmaxmp);\n+                    statUpdates.put(MapleStat.MP, mp);\n+                }\n+\n+                if (newMp != Short.MIN_VALUE) {\n+                    setMp(newMp);\n+                    statUpdates.put(MapleStat.MP, mp);\n+                }\n+            }\n+\n+            if (strDexIntLuk != null) {\n+                short newStr = (short) (strDexIntLuk >> 48);\n+                short newDex = (short) (strDexIntLuk >> 32);\n+                short newInt = (short) (strDexIntLuk >> 16);\n+                short newLuk = (short) (strDexIntLuk.shortValue());\n+\n+                if (newStr >= 4) {\n+                    setStr(newStr);\n+                    statUpdates.put(MapleStat.STR, str);\n+                }\n+\n+                if (newDex >= 4) {\n+                    setDex(newDex);\n+                    statUpdates.put(MapleStat.DEX, dex);\n+                }\n+\n+                if (newInt >= 4) {\n+                    setInt(newInt);\n+                    statUpdates.put(MapleStat.INT, int_);\n+                }\n+\n+                if (newLuk >= 4) {\n+                    setLuk(newLuk);\n+                    statUpdates.put(MapleStat.LUK, luk);\n+                }\n+\n+                if (newAp >= 0) {\n+                    setRemainingAp(newAp);\n+                    statUpdates.put(MapleStat.AVAILABLEAP, remainingAp);\n+                }\n+\n+                poolUpdate = true;  // recalc stats\n+            }\n+            \n+            if (newSp != null) {\n+                short sp = (short) (newSp >> 16);\n+                short skillbook = (short) (newSp.shortValue());\n+                \n+                setRemainingSp(sp, skillbook);\n+                statUpdates.put(MapleStat.AVAILABLESP, remainingSp[skillbook]);\n+            }\n+\n+            if (!statUpdates.isEmpty()) {\n+                if (poolUpdate) {\n+                    dispatchHpmpPoolUpdated();\n+                }\n+\n+                if (!silent) {\n+                    dispatchStatPoolUpdateAnnounced();\n+                }\n+            }\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void healHpMp() {\n+        updateHpMp(30000);\n+    }\n+    \n+    public void updateHpMp(int x) {\n+        updateHpMp(x, x);\n+    }\n+    \n+    public void updateHpMp(int newhp, int newmp) {\n+        changeHpMp(newhp, newmp, false);\n+    }\n+    \n+    protected void changeHpMp(int newhp, int newmp, boolean silent) {\n+        changeHpMpPool(newhp, newmp, Short.MIN_VALUE, Short.MIN_VALUE, silent);\n+    }\n+    \n+    private void changeHpMpPool(int hp, int mp, int maxhp, int maxmp, boolean silent) {\n+        long hpMpPool = calcStatPoolLong(hp, mp, maxhp, maxmp);\n+        changeStatPool(hpMpPool, null, null, -1, silent);\n+    }\n+    \n+    public void updateHp(int hp) {\n+        updateHpMaxHp(hp, Short.MIN_VALUE);\n+    }\n+    \n+    public void updateMaxHp(int maxhp) {\n+        updateHpMaxHp(Short.MIN_VALUE, maxhp);\n+    }\n+    \n+    public void updateHpMaxHp(int hp, int maxhp) {\n+        changeHpMpPool(hp, Short.MIN_VALUE, maxhp, Short.MIN_VALUE, false);\n+    }\n+    \n+    public void updateMp(int mp) {\n+        updateMpMaxMp(mp, Short.MIN_VALUE);\n+    }\n+    \n+    public void updateMaxMp(int maxmp) {\n+        updateMpMaxMp(Short.MIN_VALUE, maxmp);\n+    }\n+    \n+    public void updateMpMaxMp(int mp, int maxmp) {\n+        changeHpMpPool(Short.MIN_VALUE, mp, Short.MIN_VALUE, maxmp, false);\n+    }\n+    \n+    public void updateMaxHpMaxMp(int maxhp, int maxmp) {\n+        changeHpMpPool(Short.MIN_VALUE, Short.MIN_VALUE, maxhp, maxmp, false);\n+    }\n+    \n+    protected void enforceMaxHpMp() {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            if (mp > localmaxmp || hp > localmaxhp) {\n+                changeHpMp(hp, mp, false);\n+            }\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public int safeAddHP(int delta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            if (hp + delta <= 0) {\n+                delta = -hp + 1;\n+            }\n+\n+            addHP(delta);\n+            return delta;\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void addHP(int delta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            updateHp(hp + delta);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void addMP(int delta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            updateMp(mp + delta);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public void addMPHP(int hpDelta, int mpDelta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            updateHpMp(hp + hpDelta, mp + mpDelta);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    protected void addMaxMPMaxHP(int hpdelta, int mpdelta, boolean silent) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            changeHpMpPool(Short.MIN_VALUE, Short.MIN_VALUE, maxhp + hpdelta, maxmp + mpdelta, silent);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void addMaxHP(int delta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            updateMaxHp(maxhp + delta);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void addMaxMP(int delta) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            updateMaxMp(maxmp + delta);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private void setStr(int str) {\n+        this.str = str;\n+    }\n+    \n+    private void setDex(int dex) {\n+        this.dex = dex;\n+    }\n+    \n+    private void setInt(int int_) {\n+        this.int_ = int_;\n+    }\n+    \n+    private void setLuk(int luk) {\n+        this.luk = luk;\n+    }\n+    \n+    public boolean assignStr(int x) {\n+        return assignStrDexIntLuk(x, Short.MIN_VALUE, Short.MIN_VALUE, Short.MIN_VALUE);\n+    }\n+    \n+    public boolean assignDex(int x) {\n+        return assignStrDexIntLuk(Short.MIN_VALUE, x, Short.MIN_VALUE, Short.MIN_VALUE);\n+    }\n+    \n+    public boolean assignInt(int x) {\n+        return assignStrDexIntLuk(Short.MIN_VALUE, Short.MIN_VALUE, x, Short.MIN_VALUE);\n+    }\n+    \n+    public boolean assignLuk(int x) {\n+        return assignStrDexIntLuk(Short.MIN_VALUE, Short.MIN_VALUE, Short.MIN_VALUE, x);\n+    }\n+    \n+    public boolean assignHP(int deltaHP, int deltaAp) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            if (remainingAp - deltaAp < 0 || hpMpApUsed + deltaAp < 0 || maxhp >= 30000) {\n+                return false;\n+            }\n+            \n+            long hpMpPool = calcStatPoolLong(Short.MIN_VALUE, Short.MIN_VALUE, maxhp + deltaHP, maxmp);\n+            long strDexIntLuk = calcStatPoolLong(str, dex, int_, luk);\n+\n+            changeStatPool(hpMpPool, strDexIntLuk, null, remainingAp - deltaAp, false);\n+            setHpMpApUsed(hpMpApUsed + deltaAp);\n+            return true;\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public boolean assignMP(int deltaMP, int deltaAp) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            if (remainingAp - deltaAp < 0 || hpMpApUsed + deltaAp < 0 || maxmp >= 30000) {\n+                return false;\n+            }\n+\n+            long hpMpPool = calcStatPoolLong(Short.MIN_VALUE, Short.MIN_VALUE, maxhp, maxmp + deltaMP);\n+            long strDexIntLuk = calcStatPoolLong(str, dex, int_, luk);\n+\n+            changeStatPool(hpMpPool, strDexIntLuk, null, remainingAp - deltaAp, false);\n+            setHpMpApUsed(hpMpApUsed + deltaAp);\n+            return true;\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private static int apAssigned(int x) {\n+        return x != Short.MIN_VALUE ? x : 0;\n+    }\n+    \n+    public boolean assignStrDexIntLuk(int deltaStr, int deltaDex, int deltaInt, int deltaLuk) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            int apUsed = apAssigned(deltaStr) + apAssigned(deltaDex) + apAssigned(deltaInt) + apAssigned(deltaLuk);\n+            if (apUsed > remainingAp) {\n+                return false;\n+            }\n+\n+            int newStr = str + deltaStr, newDex = dex + deltaDex, newInt = int_ + deltaInt, newLuk = luk + deltaLuk;\n+            if (newStr < 4 && deltaStr != Short.MIN_VALUE || newStr > ServerConstants.MAX_AP) {\n+                return false;\n+            }\n+\n+            if (newDex < 4 && deltaDex != Short.MIN_VALUE || newDex > ServerConstants.MAX_AP) {\n+                return false;\n+            }\n+\n+            if (newInt < 4 && deltaInt != Short.MIN_VALUE || newInt > ServerConstants.MAX_AP) {\n+                return false;\n+            }\n+\n+            if (newLuk < 4 && deltaLuk != Short.MIN_VALUE || newLuk > ServerConstants.MAX_AP) {\n+                return false;\n+            }\n+\n+            int newAp = remainingAp - apUsed;\n+            updateStrDexIntLuk(newStr, newDex, newInt, newLuk, newAp);\n+            return true;\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void updateStrDexIntLuk(int x) {\n+        updateStrDexIntLuk(x, x, x, x, -1);\n+    }\n+    \n+    public void changeRemainingAp(int x, boolean silent) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            changeStrDexIntLuk(str, dex, int_, luk, x, silent);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void gainAp(int deltaAp, boolean silent) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            changeRemainingAp(Math.max(0, remainingAp + deltaAp), silent);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    protected void updateStrDexIntLuk(int str, int dex, int int_, int luk, int remainingAp) {\n+        changeStrDexIntLuk(str, dex, int_, luk, remainingAp, false);\n+    }\n+    \n+    private void changeStrDexIntLuk(int str, int dex, int int_, int luk, int remainingAp, boolean silent) {\n+        long strDexIntLuk = calcStatPoolLong(str, dex, int_, luk);\n+        changeStatPool(null, strDexIntLuk, null, remainingAp, silent);\n+    }\n+    \n+    private void changeStrDexIntLukSp(int str, int dex, int int_, int luk, int remainingAp, int remainingSp, int skillbook, boolean silent) {\n+        long strDexIntLuk = calcStatPoolLong(str, dex, int_, luk);\n+        long sp = calcStatPoolLong(0, 0, remainingSp, skillbook);\n+        changeStatPool(null, strDexIntLuk, sp, remainingAp, silent);\n+    }\n+    \n+    protected void updateStrDexIntLukSp(int str, int dex, int int_, int luk, int remainingAp, int remainingSp, int skillbook) {\n+        changeStrDexIntLukSp(str, dex, int_, luk, remainingAp, remainingSp, skillbook, false);\n+    }\n+    \n+    protected void setRemainingSp(int[] sps) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            System.arraycopy(sps, 0, remainingSp, 0, sps.length);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    protected void updateRemainingSp(int remainingSp, int skillbook) {\n+        changeRemainingSp(remainingSp, skillbook, false);\n+    }\n+    \n+    protected void changeRemainingSp(int remainingSp, int skillbook, boolean silent) {\n+        long sp = calcStatPoolLong(0, 0, remainingSp, skillbook);\n+        changeStatPool(null, null, sp, Short.MIN_VALUE, silent);\n+    }\n+    \n+    public void gainSp(int deltaSp, int skillbook, boolean silent) {\n+        effLock.lock();\n+        statWlock.lock();\n+        try {\n+            changeRemainingSp(Math.max(0, remainingSp[skillbook] + deltaSp), skillbook, silent);\n+        } finally {\n+            statWlock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+}"}, {"sha": "ef7ad023e409d34142c9d6f1f8ba51f5e709c8ab", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 857, "deletions": 877, "changes": 1734, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa"}, {"sha": "451e9a34141ffe78dc2d42cf4377a6141d48209e", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -886,7 +886,7 @@ public final synchronized void disconnect(boolean shutdown, boolean cashshop) {/\n \t\t\tfinal MapleGuild guild = player.getGuild();\n                         \n                         player.cancelMagicDoor();\n-\n+                        \n                         final World wserv = getWorldServer();   // obviously wserv is NOT null if this player was online on it\n                         try {\n                                 removePlayer(wserv);\n@@ -1028,7 +1028,7 @@ public void setWorld(int world) {\n \t}\n \n \tpublic void pongReceived() {\n-\t\tlastPong = System.currentTimeMillis();\n+\t\tlastPong = Server.getInstance().getCurrentTime();\n \t}\n \n         public void testPing(long timeThen) {\n@@ -1381,12 +1381,7 @@ public void changeChannel(int channel) {\n                 player.cancelQuestExpirationTask();\n \t\t//Cancelling magicdoor? Nope\n \t\t//Cancelling mounts? Noty\n-\t\tif (player.getBuffedValue(MapleBuffStat.PUPPET) != null) {\n-\t\t\tplayer.cancelEffectFromBuffStat(MapleBuffStat.PUPPET);\n-\t\t}\n-\t\tif (player.getBuffedValue(MapleBuffStat.COMBO) != null) {\n-\t\t\tplayer.cancelEffectFromBuffStat(MapleBuffStat.COMBO);\n-\t\t}\n+\t\t\n \t\tplayer.getInventory(MapleInventoryType.EQUIPPED).checked(false); //test\n \t\tplayer.getMap().removePlayer(player);\n                 player.clearBanishPlayerData();"}, {"sha": "83fc5dbd8e0b375be93f8aaf969ee607fb4e32b7", "filename": "src/client/autoban/AutobanManager.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/autoban/AutobanManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/autoban/AutobanManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/autoban/AutobanManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -91,14 +91,15 @@ public long getLastSpam(int type) {\n      * Timestamp checker\n      *\n      *  <code>type</code>:<br>\n-     * 0: HealOverTime<br>\n      * 1: Pet Food<br>\n      * 2: InventoryMerge<br>\n      * 3: InventorySort<br>\n      * 4: SpecialMove<br>\n      * 5: UseCatchItem<br>\n      * 6: Item Drop<br>\n      * 7: Chat<br>\n+     * 8: HealOverTimeHP<br>\n+     * 9: HealOverTimeMP<br>\n      *\n      * @param type type\n      * @return Timestamp checker\n@@ -108,7 +109,7 @@ public void setTimestamp(int type, int time, int times) {\n             this.timestampcounter[type]++;\n             if (this.timestampcounter[type] >= times) {\n                 chr.getClient().disconnect(false, false);\n-                //System.out.println(\"Same timestamp for type: \" + type + \"; Character: \" + chr);\n+                FilePrinter.print(FilePrinter.EXPLOITS, \"Player \" + chr + \" was caught spamming TYPE \" + type + \" and has been disconnected.\");\n             }\n             return;\n         }"}, {"sha": "a40e14d7e14b0b6a58fbc5097f5bd96f1fcadf69", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,14 +23,16 @@\n */\n package client.command;\n \n+import client.command.commands.gm0.*;\n+import client.command.commands.gm1.*;\n+import client.command.commands.gm2.*;\n+import client.command.commands.gm3.*;\n+import client.command.commands.gm4.*;\n+import client.command.commands.gm5.*;\n+import client.command.commands.gm6.*;\n+\n import client.MapleClient;\n-import client.command.commands.v0.*;\n-import client.command.commands.v1.*;\n-import client.command.commands.v2.*;\n-import client.command.commands.v3.*;\n-import client.command.commands.v4.*;\n-import client.command.commands.v5.*;\n-import client.command.commands.v6.*;\n+\n import tools.FilePrinter;\n import tools.Pair;\n "}, {"sha": "85ec0e9e04b116f5896095d3877d1ea54931cc4f", "filename": "src/client/command/commands/gm0/BuyBackCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/BuyBackCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/BuyBackCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/BuyBackCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleClient;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/BuyBackCommand.java"}, {"sha": "a11d97d87fea2b60f093403b275c168d51f12024", "filename": "src/client/command/commands/gm0/DisposeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/DisposeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/DisposeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/DisposeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v0/DisposeCommand.java"}, {"sha": "7f10a7dd2c3fcbf3820a8631cad8283c8a7fc247", "filename": "src/client/command/commands/gm0/DropLimitCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/DropLimitCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/DropLimitCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/DropLimitCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleClient;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/DropLimitCommand.java"}, {"sha": "38d230ad49ea9345330101dd48b19a8d8607844d", "filename": "src/client/command/commands/gm0/EquipLvCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/EquipLvCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/EquipLvCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/EquipLvCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v0/EquipLvCommand.java"}, {"sha": "5c4ecd46afaed079b03c6d61f35ef31233f56d8d", "filename": "src/client/command/commands/gm0/GachaCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/GachaCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/GachaCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/GachaCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v0/GachaCommand.java"}, {"sha": "893b98fa153ea296ab9858ea20b1213511812152", "filename": "src/client/command/commands/gm0/GmCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/GmCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/GmCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/GmCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/GmCommand.java"}, {"sha": "42c195e95c2420eaf24d7ce6ecf01eba9be645ee", "filename": "src/client/command/commands/gm0/HelpCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/HelpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/HelpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/HelpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleClient;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/HelpCommand.java"}, {"sha": "60ea01e5062e903c1a9cc6648c251ca240279917", "filename": "src/client/command/commands/gm0/JoinEventCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/JoinEventCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/JoinEventCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/JoinEventCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/JoinEventCommand.java"}, {"sha": "41dfc9db442064d2b6408f40670ea3c1534a2ce4", "filename": "src/client/command/commands/gm0/LeaveEventCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/LeaveEventCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/LeaveEventCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/LeaveEventCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/LeaveEventCommand.java"}, {"sha": "4944b085a8471bc8bea4a1c8e8b1ff844d2a4f86", "filename": "src/client/command/commands/gm0/OnlineCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/OnlineCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/OnlineCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/OnlineCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/OnlineCommand.java"}, {"sha": "fbe368f44d5ffd232fb375e1555b936bd2f4e9f9", "filename": "src/client/command/commands/gm0/RanksCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/RanksCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/RanksCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/RanksCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/RanksCommand.java"}, {"sha": "1ffdfcafbbb6689a4c875544c18df135f85f8b1a", "filename": "src/client/command/commands/gm0/RatesCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/RatesCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/RatesCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/RatesCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/RatesCommand.java"}, {"sha": "0654da4f0febaf5797bda18384b7bb381b5877dc", "filename": "src/client/command/commands/gm0/ReportBugCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/ReportBugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/ReportBugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/ReportBugCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/ReportBugCommand.java"}, {"sha": "99117ef866f01c12f59b9f0bdfa2fbd588ce9ab0", "filename": "src/client/command/commands/gm0/ShowRatesCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/ShowRatesCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/ShowRatesCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/ShowRatesCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/ShowRatesCommand.java"}, {"sha": "525bbac64b7118b96146d2b366589399ba5122a4", "filename": "src/client/command/commands/gm0/StaffCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StaffCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StaffCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StaffCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleClient;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/StaffCommand.java"}, {"sha": "3b14dc0b339492e9efa69054b94edafc889bf108", "filename": "src/client/command/commands/gm0/StatDexCommand.java", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatDexCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatDexCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatDexCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,46 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Arthur L - Refactored command content into modules\n+*/\n+package client.command.commands.gm0;\n+\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import client.command.Command;\n+import constants.ServerConstants;\n+\n+public class StatDexCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        int remainingAp = player.getRemainingAp();\n+\n+        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getDex());\n+        if (!player.assignDex(amount)) {\n+            player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n+        }\n+    }\n+}"}, {"sha": "21a347d8f258588a3ebb45d2ce8469c76acc573f", "filename": "src/client/command/commands/gm0/StatIntCommand.java", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatIntCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatIntCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatIntCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,46 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Arthur L - Refactored command content into modules\n+*/\n+package client.command.commands.gm0;\n+\n+import client.command.Command;\n+import client.MapleClient;\n+import client.MapleCharacter;\n+import constants.ServerConstants;\n+\n+public class StatIntCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        int remainingAp = player.getRemainingAp();\n+\n+        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getInt());\n+        if (!player.assignInt(amount)) {\n+            player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n+        }\n+    }\n+}"}, {"sha": "03a41e0341045f802b9881d720901a55873b69d1", "filename": "src/client/command/commands/gm0/StatLukCommand.java", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatLukCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatLukCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatLukCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,46 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Arthur L - Refactored command content into modules\n+*/\n+package client.command.commands.gm0;\n+\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import client.command.Command;\n+import constants.ServerConstants;\n+\n+public class StatLukCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        int remainingAp = player.getRemainingAp();\n+\n+        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getLuk());\n+        if (!player.assignLuk(amount)) {\n+            player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n+        }\n+    }\n+}"}, {"sha": "ce288f27f38dfcf3b22a25a57e7dfb4ea7979b6b", "filename": "src/client/command/commands/gm0/StatStrCommand.java", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatStrCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/StatStrCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatStrCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,46 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Arthur L - Refactored command content into modules\n+*/\n+package client.command.commands.gm0;\n+\n+import client.command.Command;\n+import client.MapleClient;\n+import client.MapleCharacter;\n+import constants.ServerConstants;\n+\n+public class StatStrCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        int remainingAp = player.getRemainingAp();\n+        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getStr());\n+        \n+        if (!player.assignStr(amount)) {\n+            player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n+        }\n+    }\n+}"}, {"sha": "08f862b90c1e14b52a9e39a2f5c8cb4da21af688", "filename": "src/client/command/commands/gm0/TimeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/TimeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/TimeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/TimeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.MapleClient;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v0/TimeCommand.java"}, {"sha": "6329cae3602232a9aec59324c6779384d01f88ac", "filename": "src/client/command/commands/gm0/UptimeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/UptimeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm0/UptimeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/UptimeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v0;\n+package client.command.commands.gm0;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v0/UptimeCommand.java"}, {"sha": "6040abd57e76eda2cdfdb0e1a40a382afa216b59", "filename": "src/client/command/commands/gm1/BossHpCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/BossHpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/BossHpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/BossHpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v1/BossHpCommand.java"}, {"sha": "9103972c0d9f7f8bc54b0bb26ed33f532aba5e89", "filename": "src/client/command/commands/gm1/BuffMeCommand.java", "status": "renamed", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/BuffMeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/BuffMeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/BuffMeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,10 +21,9 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n-import client.MapleStat;\n import client.SkillFactory;\n import client.command.Command;\n import client.MapleClient;\n@@ -42,9 +41,6 @@ public void execute(MapleClient c, String[] params) {\n         SkillFactory.getSkill(1301007).getEffect(SkillFactory.getSkill(1301007).getMaxLevel()).applyTo(player);\n         SkillFactory.getSkill(2301004).getEffect(SkillFactory.getSkill(2301004).getMaxLevel()).applyTo(player);\n         SkillFactory.getSkill(1005).getEffect(SkillFactory.getSkill(1005).getMaxLevel()).applyTo(player);\n-        player.setHp(player.getMaxHp());\n-        player.updateSingleStat(MapleStat.HP, player.getMaxHp());\n-        player.setMp(player.getMaxMp());\n-        player.updateSingleStat(MapleStat.MP, player.getMaxMp());\n+        player.healHpMp();\n     }\n }", "previous_filename": "src/client/command/commands/v1/BuffMeCommand.java"}, {"sha": "1c93a3207dd8aa1c2dedeaf90d109e440af7ded8", "filename": "src/client/command/commands/gm1/GotoCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/GotoCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/GotoCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/GotoCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v1/GotoCommand.java"}, {"sha": "b8c9dcaef17441c74b69f5323ccfe4c20e43a861", "filename": "src/client/command/commands/gm1/MobHpCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/MobHpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/MobHpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/MobHpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v1/MobHpCommand.java"}, {"sha": "91ab0cb262c3379bd0f2fb0556eedd3ca2e242be", "filename": "src/client/command/commands/gm1/WhatDropsFromCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/WhatDropsFromCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/WhatDropsFromCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhatDropsFromCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v1/WhatDropsFromCommand.java"}, {"sha": "ff130495dcd44fb4df988525efbb40526ce97e65", "filename": "src/client/command/commands/gm1/WhoDropsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/WhoDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm1/WhoDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhoDropsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v1;\n+package client.command.commands.gm1;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v1/WhoDropsCommand.java"}, {"sha": "b6163e3a297864f2ce65ee68603b0b802a6d0b03", "filename": "src/client/command/commands/gm2/ApCommand.java", "status": "renamed", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ApCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ApCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ApCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,9 +21,8 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n@@ -47,17 +46,15 @@ public void execute(MapleClient c, String[] params) {\n             if (newAp < 0) newAp = 0;\n             else if (newAp > ServerConstants.MAX_AP) newAp = ServerConstants.MAX_AP;\n \n-            player.setRemainingAp(newAp);\n-            player.updateSingleStat(MapleStat.AVAILABLEAP, player.getRemainingAp());\n+            player.changeRemainingAp(newAp, false);\n         } else {\n             MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n             if (victim != null) {\n                 int newAp = Integer.parseInt(params[1]);\n                 if (newAp < 0) newAp = 0;\n                 else if (newAp > ServerConstants.MAX_AP) newAp = ServerConstants.MAX_AP;\n \n-                victim.setRemainingAp(newAp);\n-                victim.updateSingleStat(MapleStat.AVAILABLEAP, victim.getRemainingAp());\n+                victim.changeRemainingAp(newAp, false);\n             } else {\n                 player.message(\"Player '\" + params[0] + \"' could not be found on this channel.\");\n             }", "previous_filename": "src/client/command/commands/v2/ApCommand.java"}, {"sha": "18795b676720c41278293a79b330a920deb1b977", "filename": "src/client/command/commands/gm2/BombCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BombCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BombCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/BombCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/BombCommand.java"}, {"sha": "2e2210ce195fd52b733e010ed66e9f6dd24a475c", "filename": "src/client/command/commands/gm2/BuffCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BuffCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BuffCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/BuffCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.Skill;\n import client.SkillFactory;", "previous_filename": "src/client/command/commands/v2/BuffCommand.java"}, {"sha": "c9f35f3fb8e913a430bc4560d659935191bd7aa5", "filename": "src/client/command/commands/gm2/BuffMapCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BuffMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/BuffMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/BuffMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.SkillFactory;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/BuffMapCommand.java"}, {"sha": "27cdfc0e604b25f99f88b01446b65582216e21cc", "filename": "src/client/command/commands/gm2/ClearDropsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ClearDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ClearDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ClearDropsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/ClearDropsCommand.java"}, {"sha": "df84a9678ae761b798a8479f2268be64fc618c59", "filename": "src/client/command/commands/gm2/ClearSlotCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ClearSlotCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ClearSlotCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ClearSlotCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/ClearSlotCommand.java"}, {"sha": "48c41a3ce2acadb913b27adfa0b8b3d125568e3c", "filename": "src/client/command/commands/gm2/DcCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/DcCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/DcCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/DcCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/DcCommand.java"}, {"sha": "a901ad1b19ffa60a1e64e468a7065657438835e4", "filename": "src/client/command/commands/gm2/EmpowerMeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/EmpowerMeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/EmpowerMeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/EmpowerMeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.SkillFactory;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/EmpowerMeCommand.java"}, {"sha": "4eb870054cd68825e9c9252b19dbf378e57c98b1", "filename": "src/client/command/commands/gm2/GmShopCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/GmShopCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/GmShopCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/GmShopCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/GmShopCommand.java"}, {"sha": "1c9884a3e51ed5cffae0dc899e7550b65a1ba26e", "filename": "src/client/command/commands/gm2/HealCommand.java", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/HealCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/HealCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/HealCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;\n@@ -35,7 +35,7 @@\n     @Override\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n-        player.setHpMp(30000);\n+        player.healHpMp();\n     }\n \n }", "previous_filename": "src/client/command/commands/v2/HealCommand.java"}, {"sha": "654136c9b6e621c5c93c33516759e179d3f8f2ac", "filename": "src/client/command/commands/gm2/HideCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/HideCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/HideCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/HideCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.SkillFactory;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/HideCommand.java"}, {"sha": "3d05313ec228452fd450e060fd0a60a3a4652696", "filename": "src/client/command/commands/gm2/ItemCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ItemCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ItemCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ItemCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/ItemCommand.java"}, {"sha": "ac7552217465a8f323770d495ce59ae128cfe6bd", "filename": "src/client/command/commands/gm2/ItemDropCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ItemDropCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ItemDropCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ItemDropCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/ItemDropCommand.java"}, {"sha": "78720b231400acdce925ea87ee7cf90f718948d5", "filename": "src/client/command/commands/gm2/JailCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/JailCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/JailCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/JailCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/JailCommand.java"}, {"sha": "cf679b2c2e73f0f81a5fe9b125f1b7b9f5c4c304", "filename": "src/client/command/commands/gm2/JobCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/JobCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/JobCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/JobCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.MapleJob;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/JobCommand.java"}, {"sha": "e0b0b7392e9185f96a6993843ffe791f46a35dd7", "filename": "src/client/command/commands/gm2/LevelCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/LevelCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/LevelCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/LevelCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/LevelCommand.java"}, {"sha": "bb6e674009d66f4ac9c30817667e80dd9e4865e8", "filename": "src/client/command/commands/gm2/LevelProCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/LevelProCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/LevelProCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/LevelProCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/LevelProCommand.java"}, {"sha": "a534718dc2726ff8dfeb393d437567e4da6c129e", "filename": "src/client/command/commands/gm2/MaxSkillCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MaxSkillCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MaxSkillCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/MaxSkillCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.*;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/MaxSkillCommand.java"}, {"sha": "af770b4fe2f7d2a1e9d5affc6b35478bafb55572", "filename": "src/client/command/commands/gm2/MaxStatCommand.java", "status": "renamed", "additions": 3, "deletions": 14, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MaxStatCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MaxStatCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/MaxStatCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,13 +21,12 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n-import client.command.CommandsExecutor;\n import constants.ServerConstants;\n \n public class MaxStatCommand extends Command {\n@@ -43,21 +42,11 @@ public void execute(MapleClient c, String[] params) {\n         player.resetPlayerRates();\n         if (ServerConstants.USE_ADD_RATES_BY_LEVEL) player.setPlayerRates();\n         player.setWorldRates();\n-        player.setStr(Short.MAX_VALUE);\n-        player.setDex(Short.MAX_VALUE);\n-        player.setInt(Short.MAX_VALUE);\n-        player.setLuk(Short.MAX_VALUE);\n-        player.updateSingleStat(MapleStat.STR, Short.MAX_VALUE);\n-        player.updateSingleStat(MapleStat.DEX, Short.MAX_VALUE);\n-        player.updateSingleStat(MapleStat.INT, Short.MAX_VALUE);\n-        player.updateSingleStat(MapleStat.LUK, Short.MAX_VALUE);\n+        player.updateStrDexIntLuk(Short.MAX_VALUE);\n         player.setFame(13337);\n-        player.setMaxHp(30000);\n-        player.setMaxMp(30000);\n+        player.updateMaxHpMaxMp(30000, 30000);\n         player.updateSingleStat(MapleStat.LEVEL, 255);\n         player.updateSingleStat(MapleStat.FAME, 13337);\n-        player.updateSingleStat(MapleStat.MAXHP, 30000);\n-        player.updateSingleStat(MapleStat.MAXMP, 30000);\n         player.yellowMessage(\"Stats maxed out.\");\n     }\n }", "previous_filename": "src/client/command/commands/v2/MaxStatCommand.java"}, {"sha": "65c2e87ba93462c92d5c2a8bbd4adb53e69b2348", "filename": "src/client/command/commands/gm2/MesosCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MesosCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/MesosCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/MesosCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/MesosCommand.java"}, {"sha": "6f4702b995520259e0791242cf36a763b330084f", "filename": "src/client/command/commands/gm2/ReachCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ReachCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ReachCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ReachCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/ReachCommand.java"}, {"sha": "17e2245a9450e286451226231a9fd1852c4ebd86", "filename": "src/client/command/commands/gm2/RechargeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/RechargeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/RechargeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/RechargeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/RechargeCommand.java"}, {"sha": "8a429e4260347881fa5c9936db0982cce6b2c233", "filename": "src/client/command/commands/gm2/ResetSkillCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ResetSkillCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/ResetSkillCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ResetSkillCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.*;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/ResetSkillCommand.java"}, {"sha": "4fa3d31e35fa7e7952ec518a1999e41f63101234", "filename": "src/client/command/commands/gm2/SearchCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SearchCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SearchCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SearchCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/SearchCommand.java"}, {"sha": "42234661f3ba0a897cb71c4310345d30f2184f3b", "filename": "src/client/command/commands/gm2/SetStatCommand.java", "status": "renamed", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SetStatCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SetStatCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SetStatCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.MapleStat;\n import client.command.Command;\n@@ -41,23 +41,13 @@ public void execute(MapleClient c, String[] params) {\n             return;\n         }\n \n-        int x;\n         try {\n-            x = Integer.parseInt(params[0]);\n+            int x = Integer.parseInt(params[0]);\n \n             if (x > Short.MAX_VALUE) x = Short.MAX_VALUE;\n             else if (x < 0) x = 0;\n \n-            player.setStr(x);\n-            player.setDex(x);\n-            player.setInt(x);\n-            player.setLuk(x);\n-            player.updateSingleStat(MapleStat.STR, x);\n-            player.updateSingleStat(MapleStat.DEX, x);\n-            player.updateSingleStat(MapleStat.INT, x);\n-            player.updateSingleStat(MapleStat.LUK, x);\n-\n-        } catch (NumberFormatException nfe) {\n-        }\n+            player.updateStrDexIntLuk(x);\n+        } catch (NumberFormatException nfe) {}\n     }\n }", "previous_filename": "src/client/command/commands/v2/SetStatCommand.java"}, {"sha": "3804f636b908adf12be01a98baaabf28c1c3a05c", "filename": "src/client/command/commands/gm2/SpCommand.java", "status": "renamed", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,9 +21,8 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n@@ -47,17 +46,15 @@ public void execute(MapleClient c, String[] params) {\n             if (newSp < 0) newSp = 0;\n             else if (newSp > ServerConstants.MAX_AP) newSp = ServerConstants.MAX_AP;\n \n-            player.setRemainingSp(newSp);\n-            player.updateSingleStat(MapleStat.AVAILABLESP, player.getRemainingSp());\n+            player.updateRemainingSp(newSp);\n         } else {\n             MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n             if (victim != null) {\n                 int newSp = Integer.parseInt(params[1]);\n                 if (newSp < 0) newSp = 0;\n                 else if (newSp > ServerConstants.MAX_AP) newSp = ServerConstants.MAX_AP;\n \n-                victim.setRemainingSp(newSp);\n-                victim.updateSingleStat(MapleStat.AVAILABLESP, player.getRemainingSp());\n+                victim.updateRemainingSp(newSp);\n \n                 player.dropMessage(5, \"SP given.\");\n             } else {", "previous_filename": "src/client/command/commands/v2/SpCommand.java"}, {"sha": "c3bd50dec4de1093310eaa12a49b743a5f63756e", "filename": "src/client/command/commands/gm2/SummonCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SummonCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/SummonCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SummonCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/SummonCommand.java"}, {"sha": "06bd0cdf5f3a34ef055f978496ba684de5541eb6", "filename": "src/client/command/commands/gm2/UnBugCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnBugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnBugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/UnBugCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/UnBugCommand.java"}, {"sha": "9826d8b88703bb394af59f67fe454b2a8e8f66cd", "filename": "src/client/command/commands/gm2/UnHideCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnHideCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnHideCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/UnHideCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.SkillFactory;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v2/UnHideCommand.java"}, {"sha": "f5fb8b4da8ba75c39ef22789cddcbd0954fab203", "filename": "src/client/command/commands/gm2/UnJailCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnJailCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/UnJailCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/UnJailCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/UnJailCommand.java"}, {"sha": "e3eaef060eb8728901818300a60f813d450f8b27", "filename": "src/client/command/commands/gm2/WarpCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WarpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WarpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/WarpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/WarpCommand.java"}, {"sha": "a510070464ee14ebd520d3a61fe2679b4a348492", "filename": "src/client/command/commands/gm2/WarpToCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WarpToCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WarpToCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/WarpToCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/WarpToCommand.java"}, {"sha": "2d1eb2756407e740c4f8b91d1543e9ceb761726d", "filename": "src/client/command/commands/gm2/WhereaMiCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WhereaMiCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm2/WhereaMiCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/WhereaMiCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v2;\n+package client.command.commands.gm2;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v2/WhereaMiCommand.java"}, {"sha": "414a3d66e8eab838b929a4eed291d19ca0545c14", "filename": "src/client/command/commands/gm3/BanCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/BanCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/BanCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/BanCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/BanCommand.java"}, {"sha": "0e8967ed278956e2a181819d35b2baa2977c8653", "filename": "src/client/command/commands/gm3/ChatCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ChatCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ChatCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ChatCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ChatCommand.java"}, {"sha": "08f5ae6545d40b14a014c1ea17e06064d0e17b7b", "filename": "src/client/command/commands/gm3/CheckDmgCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/CheckDmgCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/CheckDmgCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/CheckDmgCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleBuffStat;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v3/CheckDmgCommand.java"}, {"sha": "7836d195ec30a9c181fc030475cc6c660b3d1046", "filename": "src/client/command/commands/gm3/ClosePortalCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ClosePortalCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ClosePortalCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ClosePortalCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ClosePortalCommand.java"}, {"sha": "eaba92ecfc1ff987bc29dad81d3a90b02e0a6cae", "filename": "src/client/command/commands/gm3/DebuffCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/DebuffCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/DebuffCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/DebuffCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleDisease;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v3/DebuffCommand.java"}, {"sha": "9fc6de5c40ab86d926475389ecfcb1a936a0cb01", "filename": "src/client/command/commands/gm3/EndEventCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/EndEventCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/EndEventCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/EndEventCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/EndEventCommand.java"}, {"sha": "c9acc0c4318da0e4d6881a20ba32ed7cb2ac9528", "filename": "src/client/command/commands/gm3/ExpedsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ExpedsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ExpedsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ExpedsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ExpedsCommand.java"}, {"sha": "48bc450f357dacc550dda3acd4d657fdd1ba2fcb", "filename": "src/client/command/commands/gm3/FaceCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FaceCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FaceCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/FaceCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleStat;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v3/FaceCommand.java"}, {"sha": "9e1b8e6165f82d02d14e142ae9ac8399348a6ed5", "filename": "src/client/command/commands/gm3/FameCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FameCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FameCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/FameCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleStat;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v3/FameCommand.java"}, {"sha": "5f7c1157291f3dc1683bfc3593a18f17cc2f6b66", "filename": "src/client/command/commands/gm3/FlyCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FlyCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/FlyCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/FlyCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/FlyCommand.java"}, {"sha": "e66dc3b0e8a92bf49dab82b494b193ffb0f0f452", "filename": "src/client/command/commands/gm3/GiveMesosCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveMesosCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveMesosCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/GiveMesosCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/GiveMesosCommand.java"}, {"sha": "04289bec41224416b1b463c09269dd6598d35a3c", "filename": "src/client/command/commands/gm3/GiveNxCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveNxCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveNxCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/GiveNxCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/GiveNxCommand.java"}, {"sha": "798ac91ad935a358cf4ec9d51ab209e1ea0c36ef", "filename": "src/client/command/commands/gm3/GiveVpCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveVpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/GiveVpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/GiveVpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/GiveVpCommand.java"}, {"sha": "489e136cc3e75822aa76ad7b25394009ac689691", "filename": "src/client/command/commands/gm3/HairCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HairCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HairCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/HairCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleStat;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v3/HairCommand.java"}, {"sha": "a3b06d5073c8fd157da0704a2b72700bf58e1cc5", "filename": "src/client/command/commands/gm3/HealMapCommand.java", "status": "renamed", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HealMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HealMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/HealMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleStat;\n import client.command.Command;\n@@ -38,10 +38,7 @@ public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         for (MapleCharacter mch : player.getMap().getCharacters()) {\n             if (mch != null) {\n-                mch.setHp(mch.getMaxHp());\n-                mch.updateSingleStat(MapleStat.HP, mch.getMaxHp());\n-                mch.setMp(mch.getMaxMp());\n-                mch.updateSingleStat(MapleStat.MP, mch.getMaxMp());\n+                mch.healHpMp();\n             }\n         }\n     }", "previous_filename": "src/client/command/commands/v3/HealMapCommand.java"}, {"sha": "7621cb2815a4730bc62c737de7b5950ace78d39b", "filename": "src/client/command/commands/gm3/HealPersonCommand.java", "status": "renamed", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HealPersonCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HealPersonCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/HealPersonCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.MapleStat;\n import client.command.Command;\n@@ -38,10 +38,7 @@ public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n         if (victim != null) {\n-            victim.setHp(victim.getMaxHp());\n-            victim.updateSingleStat(MapleStat.HP, victim.getMaxHp());\n-            victim.setMp(victim.getMaxMp());\n-            victim.updateSingleStat(MapleStat.MP, victim.getMaxMp());\n+            victim.healHpMp();\n         } else {\n             player.message(\"Player '\" + params[0] + \"' could not be found on this channel.\");\n         }", "previous_filename": "src/client/command/commands/v3/HealPersonCommand.java"}, {"sha": "f1a808d8dae27f0f8d29627b8b54834cd9feb2b5", "filename": "src/client/command/commands/gm3/HpMpCommand.java", "status": "renamed", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HpMpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HpMpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/HpMpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,9 +21,8 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n@@ -49,12 +48,7 @@ public void execute(MapleClient c, String[] params) {\n         }\n \n         if (victim != null) {\n-            victim.setHp(statUpdate);\n-            victim.setMp(statUpdate);\n-            victim.updateSingleStat(MapleStat.HP, statUpdate);\n-            victim.updateSingleStat(MapleStat.MP, statUpdate);\n-\n-            victim.checkBerserk(victim.isHidden());\n+            victim.updateHpMp(statUpdate);\n         } else {\n             player.message(\"Player '\" + params[0] + \"' could not be found on this world.\");\n         }", "previous_filename": "src/client/command/commands/v3/HpMpCommand.java"}, {"sha": "82cf06ac925c28c25dde11bcef204e6af3525841", "filename": "src/client/command/commands/gm3/HurtCommand.java", "status": "renamed", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HurtCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/HurtCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/HurtCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,9 +21,8 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n@@ -38,8 +37,7 @@ public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n         if (victim != null) {\n-            victim.setHp(1);\n-            victim.updateSingleStat(MapleStat.HP, 1);\n+            victim.updateHp(1);\n         } else {\n             player.message(\"Player '\" + params[0] + \"' could not be found on this channel.\");\n         }", "previous_filename": "src/client/command/commands/v3/HurtCommand.java"}, {"sha": "c19bee6714e74ee54d321925417ec1be8d932182", "filename": "src/client/command/commands/gm3/IdCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IdCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IdCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/IdCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/IdCommand.java"}, {"sha": "fb13a76a4d2cde5e87f9f1b47f4e62e89a71a4ff", "filename": "src/client/command/commands/gm3/IgnoreCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IgnoreCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IgnoreCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/IgnoreCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/IgnoreCommand.java"}, {"sha": "e66880caac0ecea99f394f36b9edd831e0b9b948", "filename": "src/client/command/commands/gm3/IgnoredCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IgnoredCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/IgnoredCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/IgnoredCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/IgnoredCommand.java"}, {"sha": "e2406f486d4d4bee9555b893a179349860582615", "filename": "src/client/command/commands/gm3/InMapCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/InMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/InMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/InMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/InMapCommand.java"}, {"sha": "533a4715733b98c1b8b60bbdfe2073382999609d", "filename": "src/client/command/commands/gm3/KillAllCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillAllCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillAllCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/KillAllCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/KillAllCommand.java"}, {"sha": "910fd9f53a493e18b83e987ec2371337c350cc8b", "filename": "src/client/command/commands/gm3/KillCommand.java", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/KillCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;\n@@ -44,7 +44,7 @@ public void execute(MapleClient c, String[] params) {\n \n         MapleCharacter victim = c.getChannelServer().getPlayerStorage().getCharacterByName(params[0]);\n         if (victim != null) {\n-            victim.setHpMp(0);\n+            victim.updateHpMp(0);\n             Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, player.getName() + \" used !kill on \" + victim.getName()));\n         } else {\n             player.message(\"Player '\" + params[0] + \"' could not be found on this channel.\");", "previous_filename": "src/client/command/commands/v3/KillCommand.java"}, {"sha": "cc922f739c4621578b4775e1cdbccbe5d9d31b51", "filename": "src/client/command/commands/gm3/KillMapCommand.java", "status": "renamed", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/KillMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/KillMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,9 +21,8 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n@@ -37,8 +36,7 @@\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         for (MapleCharacter mch : player.getMap().getCharacters()) {\n-            mch.setHp(0);\n-            mch.updateSingleStat(MapleStat.HP, 0);\n+            mch.updateHp(0);\n         }\n     }\n }", "previous_filename": "src/client/command/commands/v3/KillMapCommand.java"}, {"sha": "595e7d2fb8ff8fea395d583b37f2e6d2e32362d4", "filename": "src/client/command/commands/gm3/MaxEnergyCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MaxEnergyCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MaxEnergyCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MaxEnergyCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/MaxEnergyCommand.java"}, {"sha": "897166545428d0971309d6c6c15878eb96220e5b", "filename": "src/client/command/commands/gm3/MaxHpMpCommand.java", "status": "renamed", "additions": 11, "deletions": 28, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MaxHpMpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MaxHpMpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MaxHpMpCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,16 +21,11 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n-import client.MapleStat;\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n-import java.util.ArrayList;\n-import java.util.List;\n-import tools.MaplePacketCreator;\n-import tools.Pair;\n \n public class MaxHpMpCommand extends Command {\n     {\n@@ -41,37 +36,25 @@\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         MapleCharacter victim = player;\n+        \n         int statUpdate = 1;\n-\n         if (params.length >= 2) {\n             victim = c.getWorldServer().getPlayerStorage().getCharacterByName(params[0]);\n-            statUpdate = Math.max(1, Integer.valueOf(params[1]));\n+            statUpdate = Integer.valueOf(params[1]);\n         } else if (params.length == 1) {\n-            statUpdate = Math.max(1, Integer.valueOf(params[0]));\n+            statUpdate = Integer.valueOf(params[0]);\n         } else {\n             player.yellowMessage(\"Syntax: !maxhpmp [<playername>] <value>\");\n         }\n-\n+        \n         if (victim != null) {\n-            List<Pair<MapleStat, Integer>> statup = new ArrayList<>(4);\n-            \n-            if (victim.getHp() > statUpdate) {\n-                victim.setHp(statUpdate);\n-                statup.add(new Pair<>(MapleStat.HP, statUpdate));\n-            }\n-            statup.add(new Pair<>(MapleStat.MAXHP, statUpdate));\n-\n-            if (victim.getMp() > statUpdate) {\n-                victim.setMp(statUpdate);\n-                statup.add(new Pair<>(MapleStat.MP, statUpdate));\n-            }\n-            statup.add(new Pair<>(MapleStat.MAXMP, statUpdate));\n-            c.announce(MaplePacketCreator.updatePlayerStats(statup, victim));\n-\n-            victim.setMaxHp(statUpdate);\n-            victim.setMaxMp(statUpdate);\n+            int extraHp = victim.getCurrentMaxHp() - victim.getClientMaxHp();\n+            int extraMp = victim.getCurrentMaxMp() - victim.getClientMaxMp();\n+            statUpdate = Math.max(1 + Math.max(extraHp, extraMp), statUpdate);\n \n-            victim.checkBerserk(victim.isHidden());\n+            int maxhpUpdate = statUpdate - extraHp;\n+            int maxmpUpdate = statUpdate - extraMp;\n+            victim.updateMaxHpMaxMp(maxhpUpdate, maxmpUpdate);\n         } else {\n             player.message(\"Player '\" + params[0] + \"' could not be found on this world.\");\n         }", "previous_filename": "src/client/command/commands/v3/MaxHpMpCommand.java"}, {"sha": "b6127d2055ab34ecb861777f1e73a82d93f96845", "filename": "src/client/command/commands/gm3/MonitorCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MonitorCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MonitorCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MonitorCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/MonitorCommand.java"}, {"sha": "23ab6c0870d7bc3e33dd81f50561b48ce5eb9d29", "filename": "src/client/command/commands/gm3/MonitorsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MonitorsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MonitorsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MonitorsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/MonitorsCommand.java"}, {"sha": "3ca6b4953ec827e22164a9a87df4cb1bbbb4e770", "filename": "src/client/command/commands/gm3/MusicCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MusicCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MusicCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MusicCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/MusicCommand.java"}, {"sha": "8e879cb5c3a453426b6f19a9d68298b233c5bb79", "filename": "src/client/command/commands/gm3/MuteMapCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MuteMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/MuteMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MuteMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/MuteMapCommand.java"}, {"sha": "72f907edaf576c1ad9a20ad9125013c3a6f7a925", "filename": "src/client/command/commands/gm3/NightCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NightCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NightCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/NightCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/NightCommand.java"}, {"sha": "9ee0011f2ff73f209c4bdf7cf794f7800a5168e4", "filename": "src/client/command/commands/gm3/NoticeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NoticeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NoticeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/NoticeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/NoticeCommand.java"}, {"sha": "86a4a155bfb331d6642d5bc26b2ecb5285d2b4c8", "filename": "src/client/command/commands/gm3/NpcCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NpcCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/NpcCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/NpcCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/NpcCommand.java"}, {"sha": "3919cb707adb105841937688ae97a975bec0ba5b", "filename": "src/client/command/commands/gm3/OnlineTwoCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/OnlineTwoCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/OnlineTwoCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/OnlineTwoCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/OnlineTwoCommand.java"}, {"sha": "92dead8050f8768c79754510a08d591ebd130014", "filename": "src/client/command/commands/gm3/OpenPortalCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/OpenPortalCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/OpenPortalCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/OpenPortalCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/OpenPortalCommand.java"}, {"sha": "62e1d130554053891e99b2ada0136a9067c044a0", "filename": "src/client/command/commands/gm3/PeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/PeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/PeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/PeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/PeCommand.java"}, {"sha": "37c198501bace4bb00d40791c5afa9579635c170", "filename": "src/client/command/commands/gm3/PosCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/PosCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/PosCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/PosCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/PosCommand.java"}, {"sha": "63a17198b3e98a0a45c1d3c4f37fbd67efa4691c", "filename": "src/client/command/commands/gm3/QuestCompleteCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestCompleteCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestCompleteCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/QuestCompleteCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/QuestCompleteCommand.java"}, {"sha": "e1c9863c1e96ec569ffcd58ce1583892344175a1", "filename": "src/client/command/commands/gm3/QuestResetCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestResetCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestResetCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/QuestResetCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/QuestResetCommand.java"}, {"sha": "747732d05f45af3984dc7a364faffe924ebbd503", "filename": "src/client/command/commands/gm3/QuestStartCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestStartCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/QuestStartCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/QuestStartCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/QuestStartCommand.java"}, {"sha": "260823dedf587c3b98967ae304636394385a35c5", "filename": "src/client/command/commands/gm3/ReloadDropsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ReloadDropsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ReloadDropsCommand.java"}, {"sha": "727231bc95ded1ae4d4276a589492c0074b441c8", "filename": "src/client/command/commands/gm3/ReloadEventsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadEventsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadEventsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ReloadEventsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ReloadEventsCommand.java"}, {"sha": "4485def5e8d73a79ada1fc27b2b55a9378dce595", "filename": "src/client/command/commands/gm3/ReloadMapCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadMapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadMapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ReloadMapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ReloadMapCommand.java"}, {"sha": "773f607c9cd489e811c93ccb11dd45b2dd3bceaa", "filename": "src/client/command/commands/gm3/ReloadPortalsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadPortalsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadPortalsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ReloadPortalsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ReloadPortalsCommand.java"}, {"sha": "e764a17174948bbbc84217efb4e9934e180213b5", "filename": "src/client/command/commands/gm3/ReloadShopsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadShopsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ReloadShopsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ReloadShopsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ReloadShopsCommand.java"}, {"sha": "14ec86a59cc3baaddb3ece7b76bf0fbf9d33e414", "filename": "src/client/command/commands/gm3/RipCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/RipCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/RipCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/RipCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/RipCommand.java"}, {"sha": "d67d3999b9c43e1db65a8959a5de218ced81e051", "filename": "src/client/command/commands/gm3/SeedCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/SeedCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/SeedCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/SeedCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/SeedCommand.java"}, {"sha": "b194a70cb3aa2b813b9c0cfceeb0a0e8dce79ac5", "filename": "src/client/command/commands/gm3/SpawnCommand.java", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/SpawnCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/SpawnCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/SpawnCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;\n@@ -38,7 +38,7 @@\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         if (params.length < 1) {\n-            player.yellowMessage(\"Syntax: !spawn <mobid>\");\n+            player.yellowMessage(\"Syntax: !spawn <mobid> [<mobqty>]\");\n             return;\n         }\n ", "previous_filename": "src/client/command/commands/v3/SpawnCommand.java"}, {"sha": "cbceb66ce1d040e3b88687f593777aa2cf455440", "filename": "src/client/command/commands/gm3/StartEventCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/StartEventCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/StartEventCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/StartEventCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/StartEventCommand.java"}, {"sha": "ce0b76c5d743ae0ab5b3ae485ef1442edc82428c", "filename": "src/client/command/commands/gm3/ToggleCouponCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ToggleCouponCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/ToggleCouponCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/ToggleCouponCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/ToggleCouponCommand.java"}, {"sha": "4ad73522f7f63c3da8a67649d532e861e2812dd0", "filename": "src/client/command/commands/gm3/UnBanCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/UnBanCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/UnBanCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/UnBanCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/UnBanCommand.java"}, {"sha": "c66e4563fee8e8c7a26fd8f6acdf4cbf56c80d0a", "filename": "src/client/command/commands/gm3/WarpSnowBallCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/WarpSnowBallCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm3/WarpSnowBallCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/WarpSnowBallCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v3;\n+package client.command.commands.gm3;\n \n         import client.command.Command;\n         import client.MapleClient;", "previous_filename": "src/client/command/commands/v3/WarpSnowBallCommand.java"}, {"sha": "1a58b65c85a9c075a8c64e546c585f6c86946442", "filename": "src/client/command/commands/gm4/CakeCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/CakeCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/CakeCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/CakeCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/CakeCommand.java"}, {"sha": "cfac27e79b227d2c005271ee85a755310afbca8f", "filename": "src/client/command/commands/gm4/DropRateCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/DropRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/DropRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/DropRateCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/DropRateCommand.java"}, {"sha": "b0070efddc3072b5f667febde8fd847ee05b4a1e", "filename": "src/client/command/commands/gm4/ExpRateCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ExpRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ExpRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ExpRateCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ExpRateCommand.java"}, {"sha": "7830a66ef06745108bf80fa1ceb35d17b2d2c8f8", "filename": "src/client/command/commands/gm4/ForceVacCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ForceVacCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ForceVacCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ForceVacCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ForceVacCommand.java"}, {"sha": "3fc094478d89c1055c8b0128de948d5462f8db4c", "filename": "src/client/command/commands/gm4/HorntailCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/HorntailCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/HorntailCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/HorntailCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/HorntailCommand.java"}, {"sha": "137749f1d14c4bbb78f97e97bc420d324488d7e1", "filename": "src/client/command/commands/gm4/ItemVacCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ItemVacCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ItemVacCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ItemVacCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ItemVacCommand.java"}, {"sha": "602650cc1be8bd83f8348350b4de58e784fad240", "filename": "src/client/command/commands/gm4/MesoRateCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/MesoRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/MesoRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/MesoRateCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/MesoRateCommand.java"}, {"sha": "1b9f2e5fd17c8577f1194ed6d6d513dfeb8b1014", "filename": "src/client/command/commands/gm4/PapCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PapCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PapCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PapCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/PapCommand.java"}, {"sha": "5ab407353f11d52056ec9750e91273053c93e616", "filename": "src/client/command/commands/gm4/PianusCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PianusCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PianusCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PianusCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/PianusCommand.java"}, {"sha": "9a541d23dbadbd3ccd4d38e959535ffacfdf6749", "filename": "src/client/command/commands/gm4/PinkbeanCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PinkbeanCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PinkbeanCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PinkbeanCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/PinkbeanCommand.java"}, {"sha": "01921cd4183b4d56e8ead67141880da89c45b8cc", "filename": "src/client/command/commands/gm4/PlayerNpcCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PlayerNpcCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PlayerNpcCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PlayerNpcCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/PlayerNpcCommand.java"}, {"sha": "3d5c3d243cb90995ca9397d6f9fdaa4d0a6eb9aa", "filename": "src/client/command/commands/gm4/PlayerNpcRemoveCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PlayerNpcRemoveCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/PlayerNpcRemoveCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PlayerNpcRemoveCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/PlayerNpcRemoveCommand.java"}, {"sha": "40cc7c43a074979929245a81706d454c7e62db82", "filename": "src/client/command/commands/gm4/ProItemCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ProItemCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ProItemCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ProItemCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ProItemCommand.java"}, {"sha": "ea93261dd1aa95b99139f86f153cad7f9033dcfc", "filename": "src/client/command/commands/gm4/QuestRateCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/QuestRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/QuestRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/QuestRateCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/QuestRateCommand.java"}, {"sha": "428133eded4adee296f8f7661c3cf1d3537c42d0", "filename": "src/client/command/commands/gm4/ServerMessageCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ServerMessageCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ServerMessageCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ServerMessageCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ServerMessageCommand.java"}, {"sha": "61546c642002c846cd4bcabff98ae6b2a9a8bc7c", "filename": "src/client/command/commands/gm4/SetEqStatCommand.java", "status": "renamed", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/SetEqStatCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/SetEqStatCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/SetEqStatCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;\n@@ -50,29 +50,29 @@ public void execute(MapleClient c, String[] params) {\n         \n         for (byte i = 1; i <= equip.getSlotLimit(); i++) {\n             try {\n-                Equip eu = (Equip) equip.getItem(i);\n-                if (eu == null) continue;\n+                Equip eq = (Equip) equip.getItem(i);\n+                if (eq == null) continue;\n \n-                eu.setWdef(newStat);\n-                eu.setAcc(newStat);\n-                eu.setAvoid(newStat);\n-                eu.setJump(newSpdJmp);\n-                eu.setMatk(newStat);\n-                eu.setMdef(newStat);\n-                eu.setHp(newStat);\n-                eu.setMp(newStat);\n-                eu.setSpeed(newSpdJmp);\n-                eu.setWatk(newStat);\n-                eu.setDex(newStat);\n-                eu.setInt(newStat);\n-                eu.setStr(newStat);\n-                eu.setLuk(newStat);\n+                eq.setWdef(newStat);\n+                eq.setAcc(newStat);\n+                eq.setAvoid(newStat);\n+                eq.setJump(newSpdJmp);\n+                eq.setMatk(newStat);\n+                eq.setMdef(newStat);\n+                eq.setHp(newStat);\n+                eq.setMp(newStat);\n+                eq.setSpeed(newSpdJmp);\n+                eq.setWatk(newStat);\n+                eq.setDex(newStat);\n+                eq.setInt(newStat);\n+                eq.setStr(newStat);\n+                eq.setLuk(newStat);\n \n-                byte flag = eu.getFlag();\n+                byte flag = eq.getFlag();\n                 flag |= ItemConstants.UNTRADEABLE;\n-                eu.setFlag(flag);\n+                eq.setFlag(flag);\n \n-                player.forceUpdateItem(eu);\n+                player.forceUpdateItem(eq);\n             } catch (Exception e) {\n                 e.printStackTrace();\n             }", "previous_filename": "src/client/command/commands/v4/SetEqStatCommand.java"}, {"sha": "e62d466cc0be83ad614b28d183ae85170aec1c7c", "filename": "src/client/command/commands/gm4/TravelRateCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/TravelRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/TravelRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/TravelRateCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/TravelRateCommand.java"}, {"sha": "97a8f4e482c64e9af325f2e0319446fe569732a0", "filename": "src/client/command/commands/gm4/ZakumCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ZakumCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm4/ZakumCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ZakumCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v4;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v4/ZakumCommand.java"}, {"sha": "1bc4e0f8bcd5f58d04baad86e3640a3236ff2f9f", "filename": "src/client/command/commands/gm5/DebugCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/DebugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/DebugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/DebugCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v5;\n+package client.command.commands.gm5;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v5/DebugCommand.java"}, {"sha": "761418975358ff4b0d7f26eefa6e87908f21ba80", "filename": "src/client/command/commands/gm5/SetCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/SetCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/SetCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/SetCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v5;\n+package client.command.commands.gm5;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v5/SetCommand.java"}, {"sha": "ff1798cc851bb992d740d59df3d47983cffc6dd6", "filename": "src/client/command/commands/gm5/ShowPacketsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/ShowPacketsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm5/ShowPacketsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/ShowPacketsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v5;\n+package client.command.commands.gm5;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v5/ShowPacketsCommand.java"}, {"sha": "c50822e71cc5eb37196a63d535a8502be0168b4e", "filename": "src/client/command/commands/gm6/ClearQuestCacheCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ClearQuestCacheCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ClearQuestCacheCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ClearQuestCacheCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/ClearQuestCacheCommand.java"}, {"sha": "e15b2f32e5507a2220b72cda5f2708ed9531fc15", "filename": "src/client/command/commands/gm6/ClearQuestCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ClearQuestCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ClearQuestCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ClearQuestCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/ClearQuestCommand.java"}, {"sha": "caa2483454de2ca3c34220a68e8bcb5131f4435c", "filename": "src/client/command/commands/gm6/DCAllCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/DCAllCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/DCAllCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/DCAllCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/DCAllCommand.java"}, {"sha": "1161acc4f112a0fc0d19a39bb8db5bc294ac272c", "filename": "src/client/command/commands/gm6/EraseAllPNpcsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/EraseAllPNpcsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/EraseAllPNpcsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/EraseAllPNpcsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/EraseAllPNpcsCommand.java"}, {"sha": "8e6722fac6177042206a8803f8adaf0c878283a7", "filename": "src/client/command/commands/gm6/FredCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/FredCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/FredCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/FredCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/FredCommand.java"}, {"sha": "f6cf6c9e94df3397db0b2a01e1574dd2a95ba95d", "filename": "src/client/command/commands/gm6/GetAccCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/GetAccCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/GetAccCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/GetAccCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/GetAccCommand.java"}, {"sha": "d52fa4921a650855f7e79e3d17fc91e766c93c98", "filename": "src/client/command/commands/gm6/MapPlayersCommand.java", "status": "renamed", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/MapPlayersCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/MapPlayersCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/MapPlayersCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;\n@@ -43,13 +43,13 @@ public void execute(MapleClient c, String[] params) {\n             for (MapleCharacter chr : world.getPlayerStorage().getAllCharacters()) {\n                 int curMap = chr.getMapId();\n                 String hp = Integer.toString(chr.getHp());\n-                String maxhp = Integer.toString(chr.getMaxHp());\n+                String maxhp = Integer.toString(chr.getCurrentMaxHp());\n                 String name = chr.getName() + \": \" + hp + \"/\" + maxhp;\n                 if (map == curMap) {\n                     names = names.equals(\"\") ? name : (names + \", \" + name);\n                 }\n             }\n         }\n-        player.message(\"These b lurkin: \" + names);\n+        player.message(\"Players on mapid \" + map + \": \" + names);\n     }\n }", "previous_filename": "src/client/command/commands/v6/MapPlayersCommand.java"}, {"sha": "648e4450a482ad4b09b3c71d01d2e66b456acfa7", "filename": "src/client/command/commands/gm6/SaveAllCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SaveAllCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SaveAllCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/SaveAllCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/SaveAllCommand.java"}, {"sha": "a9055f2ab8f7b263126da1853c04c1ac1355533a", "filename": "src/client/command/commands/gm6/ServerAddChannelCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerAddChannelCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerAddChannelCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ServerAddChannelCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v6/ServerAddChannelCommand.java"}, {"sha": "00aae016d5581d18f6449d5a50b67ee7a460ba64", "filename": "src/client/command/commands/gm6/ServerAddWorldCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerAddWorldCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerAddWorldCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ServerAddWorldCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v6/ServerAddWorldCommand.java"}, {"sha": "09385dbd4907078776124e99e2bb4a3313180411", "filename": "src/client/command/commands/gm6/ServerRemoveChannelCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerRemoveChannelCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerRemoveChannelCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ServerRemoveChannelCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v6/ServerRemoveChannelCommand.java"}, {"sha": "b298965c7ef4844761e385afa4c824dcbe502f81", "filename": "src/client/command/commands/gm6/ServerRemoveWorldCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerRemoveWorldCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ServerRemoveWorldCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ServerRemoveWorldCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.MapleCharacter;\n import client.command.Command;", "previous_filename": "src/client/command/commands/v6/ServerRemoveWorldCommand.java"}, {"sha": "19d8b01ab1e74b501f3bd4d64276e43a3b4e0e2b", "filename": "src/client/command/commands/gm6/SetGmLevelCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SetGmLevelCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SetGmLevelCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/SetGmLevelCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/SetGmLevelCommand.java"}, {"sha": "97c5fbec0aa72feffcb4470d48071ce6d7603caa", "filename": "src/client/command/commands/gm6/ShutdownCommand.java", "status": "renamed", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ShutdownCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/ShutdownCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/ShutdownCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,13 +21,14 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n import net.server.Server;\n import net.server.world.World;\n+import server.TimerManager;\n \n public class ShutdownCommand extends Command {\n     {\n@@ -39,11 +40,13 @@ public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         if (params.length < 1){\n             player.yellowMessage(\"Syntax: !shutdown [<time>|NOW]\");\n+            return;\n         }\n+        \n         int time = 60000;\n         if (params[0].equalsIgnoreCase(\"now\")){\n             time = 1;\n-        }else {\n+        } else {\n             time *= Integer.parseInt(params[0]);\n         }\n \n@@ -65,5 +68,7 @@ public void execute(MapleClient c, String[] params) {\n                 }\n             }\n         }\n+        \n+        TimerManager.getInstance().schedule(Server.getInstance().shutdown(false), time);\n     }\n }", "previous_filename": "src/client/command/commands/v6/ShutdownCommand.java"}, {"sha": "a1da8ac360033d38e0d8788614fa14c6f4cfb96a", "filename": "src/client/command/commands/gm6/SpawnAllPNpcsCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SpawnAllPNpcsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/SpawnAllPNpcsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/SpawnAllPNpcsCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/SpawnAllPNpcsCommand.java"}, {"sha": "30cd7e25a107902c1eab410a9a62b3c59155793e", "filename": "src/client/command/commands/gm6/WarpWorldCommand.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/WarpWorldCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/command/commands/gm6/WarpWorldCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/WarpWorldCommand.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -21,7 +21,7 @@\n /*\n    @Author: Arthur L - Refactored command content into modules\n */\n-package client.command.commands.v6;\n+package client.command.commands.gm6;\n \n import client.command.Command;\n import client.MapleClient;", "previous_filename": "src/client/command/commands/v6/WarpWorldCommand.java"}, {"sha": "3154f802960c7c69c9ce1be4b13be9aeb4a4e32c", "filename": "src/client/command/commands/v0/StatDexCommand.java", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatDexCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatDexCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/v0/StatDexCommand.java?ref=c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.v0;\n-\n-import client.MapleCharacter;\n-import client.MapleClient;\n-import client.MapleStat;\n-import client.command.Command;\n-\n-public class StatDexCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        int remainingAp = player.getRemainingAp();\n-\n-        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : remainingAp;\n-        if (amount > 0 && amount <= remainingAp && amount <= 32763) {\n-            int playerStat = player.getDex();\n-            \n-            if (amount + playerStat <= 32767 && amount + playerStat >= 4) {\n-                player.setDex(playerStat + amount);\n-                player.updateSingleStat(MapleStat.DEX, playerStat);\n-                player.setRemainingAp(remainingAp - amount);\n-                player.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n-            } else {\n-                player.dropMessage(\"Please make sure the stat you are trying to raise is not over 32,767 or under 4.\");\n-            }\n-        } else {\n-            player.dropMessage(\"Please make sure your AP is not over 32,767 and you have enough to distribute.\");\n-        }\n-    }\n-}"}, {"sha": "be1d310d7015d4ae88c0549cead2c62e737cf542", "filename": "src/client/command/commands/v0/StatIntCommand.java", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatIntCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatIntCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/v0/StatIntCommand.java?ref=c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.v0;\n-\n-import client.MapleStat;\n-import client.command.Command;\n-import client.MapleClient;\n-import client.MapleCharacter;\n-\n-public class StatIntCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        int remainingAp = player.getRemainingAp();\n-\n-        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : remainingAp;\n-        if (amount > 0 && amount <= remainingAp && amount <= 32763) {\n-            int playerStat = player.getInt();\n-            \n-            if (amount + playerStat <= 32767 && amount + playerStat >= 4) {\n-                player.setInt(playerStat + amount);\n-                player.updateSingleStat(MapleStat.INT, playerStat);\n-                player.setRemainingAp(remainingAp - amount);\n-                player.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n-            } else {\n-                player.dropMessage(\"Please make sure the stat you are trying to raise is not over 32,767 or under 4.\");\n-            }\n-        } else {\n-            player.dropMessage(\"Please make sure your AP is not over 32,767 and you have enough to distribute.\");\n-        }\n-    }\n-}"}, {"sha": "5754fbd78f2c83dd331389fab791db53d8771890", "filename": "src/client/command/commands/v0/StatLukCommand.java", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatLukCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatLukCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/v0/StatLukCommand.java?ref=c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.v0;\n-\n-import client.MapleCharacter;\n-import client.MapleClient;\n-import client.MapleStat;\n-import client.command.Command;\n-\n-public class StatLukCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        int remainingAp = player.getRemainingAp();\n-\n-        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : remainingAp;\n-        if (amount > 0 && amount <= remainingAp && amount <= 32763) {\n-            int playerStat = player.getLuk();\n-            \n-            if (amount + playerStat <= 32767 && amount + playerStat >= 4) {\n-                player.setLuk(playerStat + amount);\n-                player.updateSingleStat(MapleStat.LUK, playerStat);\n-                player.setRemainingAp(remainingAp - amount);\n-                player.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n-            } else {\n-                player.dropMessage(\"Please make sure the stat you are trying to raise is not over 32,767 or under 4.\");\n-            }\n-        } else {\n-            player.dropMessage(\"Please make sure your AP is not over 32,767 and you have enough to distribute.\");\n-        }\n-    }\n-}"}, {"sha": "da81e7e7b6af6f62ef9a70857b3cb2122af2e80b", "filename": "src/client/command/commands/v0/StatStrCommand.java", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatStrCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398/src/client/command/commands/v0/StatStrCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/v0/StatStrCommand.java?ref=c3e3c6dfbb33e9e442c07dfddc6f32b8e5439398", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.v0;\n-\n-import client.MapleStat;\n-import client.command.Command;\n-import client.MapleClient;\n-import client.MapleCharacter;\n-\n-public class StatStrCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        int remainingAp = player.getRemainingAp();\n-\n-        int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : remainingAp;\n-        if (amount > 0 && amount <= remainingAp && amount <= 32763) {\n-            int playerStat = player.getStr();\n-            \n-            if (amount + playerStat <= 32767 && amount + playerStat >= 4) {\n-                player.setStr(playerStat + amount);\n-                player.updateSingleStat(MapleStat.STR, playerStat);\n-                player.setRemainingAp(remainingAp - amount);\n-                player.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n-            } else {\n-                player.dropMessage(\"Please make sure the stat you are trying to raise is not over 32,767 or under 4.\");\n-            }\n-        } else {\n-            player.dropMessage(\"Please make sure your AP is not over 32,767 and you have enough to distribute.\");\n-        }\n-    }\n-}"}, {"sha": "67b461365e425048be8a845ff09ccbf9cdc51934", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 15, "deletions": 8, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -498,11 +498,18 @@ private static double normalizedMasteryExp(int reqLevel) {\n         }\n     }\n     \n-    public void gainItemExp(MapleClient c, int gain) {  // Ronan's Equip Exp gain method\n+    public synchronized void gainItemExp(MapleClient c, int gain) {  // Ronan's Equip Exp gain method\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        if(!ii.isUpgradeable(this.getItemId()) || itemLevel >= 30) return;\n+        if(!ii.isUpgradeable(this.getItemId())) {\n+            return;\n+        }\n+        \n+        int equipMaxLevel = Math.min(30, Math.max(ii.getEquipLevel(this.getItemId(), true), ServerConstants.USE_EQUIPMNT_LVLUP));\n+        if (itemLevel >= equipMaxLevel) {\n+            return;\n+        }\n         \n-        int reqLevel = ii.getEquipStats(this.getItemId()).get(\"reqLevel\");\n+        int reqLevel = ii.getEquipLevelReq(this.getItemId());\n         \n         float masteryModifier = (float)(ServerConstants.EQUIP_EXP_RATE * ExpTable.getExpNeededForLevel(1)) / (float)normalizedMasteryExp(reqLevel);\n         float elementModifier = (isElemental) ? 0.85f : 0.6f;\n@@ -516,20 +523,20 @@ public void gainItemExp(MapleClient c, int gain) {  // Ronan's Equip Exp gain me\n         \n         if (itemExp >= expNeeded) {\n             while(itemExp >= expNeeded) {\n-                itemExp = (itemExp - expNeeded);\n+                itemExp -= expNeeded;\n                 gainLevel(c);\n \n-                if(itemLevel == ServerConstants.USE_EQUIPMNT_LVLUP) {\n+                if(itemLevel >= equipMaxLevel) {\n                     itemExp = 0.0f;\n                     break;\n                 }\n                 \n                 expNeeded = ExpTable.getEquipExpNeededForLevel(itemLevel);\n             }\n-        } else {\n-            c.getPlayer().forceUpdateItem(this);\n-            //if(ServerConstants.USE_DEBUG) c.getPlayer().dropMessage(\"'\" + ii.getName(this.getItemId()) + \"': \" + itemExp + \" / \" + expNeeded);\n         }\n+        \n+        c.getPlayer().forceUpdateItem(this);\n+        //if(ServerConstants.USE_DEBUG) c.getPlayer().dropMessage(\"'\" + ii.getName(this.getItemId()) + \"': \" + itemExp + \" / \" + expNeeded);\n     }\n     \n     private boolean reachedMaxLevel() {"}, {"sha": "457c3d25681e23ff53828b3a0bec46dc26373d00", "filename": "src/client/inventory/MapleInventory.java", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/MapleInventory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/MapleInventory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MapleInventory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -306,35 +306,37 @@ protected short addSlot(Item item) {\n             return -1;\n         }\n         \n+        short slotId;\n         lock.lock();\n         try {\n-            short slotId = getNextFreeSlot();\n+            slotId = getNextFreeSlot();\n             if (slotId < 0) {\n                 return -1;\n             }\n-            inventory.put(slotId, item);\n-            \n-            if(ItemConstants.isRateCoupon(item.getItemId())) {\n-                owner.updateCouponRates();\n-            }\n             \n-            return slotId;\n+            inventory.put(slotId, item);\n         } finally {\n             lock.unlock();\n         }\n+        \n+        if (ItemConstants.isRateCoupon(item.getItemId())) {\n+            owner.updateCouponRates();\n+        }\n+\n+        return slotId;\n     }\n     \n     protected void addSlotFromDB(short slot, Item item) {\n         lock.lock();\n         try {\n             inventory.put(slot, item);\n-            \n-            if(ItemConstants.isRateCoupon(item.getItemId())) {\n-                owner.updateCouponRates();\n-            }\n         } finally {\n             lock.unlock();\n         }\n+        \n+        if (ItemConstants.isRateCoupon(item.getItemId())) {\n+            owner.updateCouponRates();\n+        }\n     }\n     \n     public void removeSlot(short slot) {\n@@ -346,7 +348,7 @@ public void removeSlot(short slot) {\n             lock.unlock();\n         }\n         \n-        if(item != null && ItemConstants.isRateCoupon(item.getItemId())) {\n+        if (item != null && ItemConstants.isRateCoupon(item.getItemId())) {\n             owner.updateCouponRates();\n         }\n     }"}, {"sha": "55c42cd874115185c04ac8cae8b01afcc6aaf225", "filename": "src/client/inventory/MapleInventoryProof.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/MapleInventoryProof.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/inventory/MapleInventoryProof.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MapleInventoryProof.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "801816ac3339622d2db97d5c169d1b7eab7a8f14", "filename": "src/client/processor/AssignAPProcessor.java", "status": "modified", "additions": 101, "deletions": 150, "changes": 251, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/AssignAPProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/AssignAPProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/AssignAPProcessor.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -44,7 +44,6 @@\n import java.util.Collections;\n import java.util.List;\n import tools.MaplePacketCreator;\n-import tools.Pair;\n import tools.Randomizer;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -63,9 +62,10 @@ public static void APAutoAssignAction(SeekableLittleEndianAccessor slea, MapleCl\n         c.lockClient();\n         try {\n             int[] statGain = new int[4];\n-            int[] statEqpd = new int[4];\n+            int[] statUpdate = new int[4];\n             statGain[0] = 0; statGain[1] = 0; statGain[2] = 0; statGain[3] = 0;\n \n+            int remainingAp = chr.getRemainingAp();\n             slea.skip(8);\n \n             if(ServerConstants.USE_SERVER_AUTOASSIGNER) {\n@@ -94,11 +94,11 @@ public static void APAutoAssignAction(SeekableLittleEndianAccessor slea, MapleCl\n                     //if(nEquip.getInt() > 0) eqpIntList.add(nEquip.getInt()); //not needed...\n                     int_ += nEquip.getInt();\n                 }\n-\n-                statEqpd[0] = str;\n-                statEqpd[1] = dex;\n-                statEqpd[2] = luk;\n-                statEqpd[3] = int_;\n+                \n+                statUpdate[0] = chr.getStr();\n+                statUpdate[1] = chr.getDex();\n+                statUpdate[2] = chr.getLuk();\n+                statUpdate[3] = chr.getInt();\n \n                 Collections.sort(eqpStrList, Collections.reverseOrder());\n                 Collections.sort(eqpDexList, Collections.reverseOrder());\n@@ -114,7 +114,7 @@ public static void APAutoAssignAction(SeekableLittleEndianAccessor slea, MapleCl\n                 //c.getPlayer().message(\"SUM EQUIP STATS -> STR: \" + str + \" DEX: \" + dex + \" LUK: \" + luk + \" INT: \" + int_);\n \n                 MapleJob stance = c.getPlayer().getJobStyle(opt);\n-                int prStat = 0, scStat = 0, trStat = 0, temp, tempAp = chr.getRemainingAp(), CAP;\n+                int prStat = 0, scStat = 0, trStat = 0, temp, tempAp = remainingAp, CAP;\n                 if (tempAp < 1) return;\n \n                 MapleStat primary, secondary, tertiary = MapleStat.LUK;\n@@ -311,20 +311,18 @@ public static void APAutoAssignAction(SeekableLittleEndianAccessor slea, MapleCl\n \n                 int extras = 0;\n \n-                extras = gainStatByType(chr, primary, statGain, prStat + extras);\n-                extras = gainStatByType(chr, secondary, statGain, scStat + extras);\n-                extras = gainStatByType(chr, tertiary, statGain, trStat + extras);\n+                extras = gainStatByType(primary, statGain, prStat + extras, statUpdate);\n+                extras = gainStatByType(secondary, statGain, scStat + extras, statUpdate);\n+                extras = gainStatByType(tertiary, statGain, trStat + extras, statUpdate);\n \n                 if(extras > 0) {    //redistribute surplus in priority order\n-                    extras = gainStatByType(chr, primary, statGain, extras);\n-                    extras = gainStatByType(chr, secondary, statGain, extras);\n-                    extras = gainStatByType(chr, tertiary, statGain, extras);\n-                    gainStatByType(chr, getQuaternaryStat(stance), statGain, extras);\n+                    extras = gainStatByType(primary, statGain, extras, statUpdate);\n+                    extras = gainStatByType(secondary, statGain, extras, statUpdate);\n+                    extras = gainStatByType(tertiary, statGain, extras, statUpdate);\n+                    gainStatByType(getQuaternaryStat(stance), statGain, extras, statUpdate);\n                 }\n \n-                int remainingAp = (chr.getRemainingAp() - getAccumulatedStatGain(statGain));\n-                chr.setRemainingAp(remainingAp);\n-                chr.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n+                chr.assignStrDexIntLuk(statGain[0], statGain[1], statGain[3], statGain[2]);\n                 c.announce(MaplePacketCreator.enableActions());\n \n                 //----------------------------------------------------------------------------------------\n@@ -345,30 +343,18 @@ public void run() {\n                     \n                     return;\n                 }\n-\n-                for (Item item : equippedC) {   //selecting the biggest AP value of each stat from each equipped item.\n-                    Equip nEquip = (Equip)item;\n-\n-                    statEqpd[0] += nEquip.getStr();\n-                    statEqpd[1] += nEquip.getDex();\n-                    statEqpd[2] += nEquip.getLuk();\n-                    statEqpd[3] += nEquip.getInt();\n-                }\n-\n-                int total = 0;\n-                int extras = 0;\n+                \n                 for (int i = 0; i < 2; i++) {\n                     int type = slea.readInt();\n                     int tempVal = slea.readInt();\n-                    if (tempVal < 0 || tempVal > chr.getRemainingAp()) {\n+                    if (tempVal < 0 || tempVal > remainingAp) {\n                         return;\n                     }\n-                    total += tempVal;\n-                    extras += gainStatByType(chr, MapleStat.getBy5ByteEncoding(type), statGain, tempVal);\n+                    \n+                    gainStatByType(MapleStat.getBy5ByteEncoding(type), statGain, tempVal, statUpdate);\n                 }\n-                int remainingAp = (chr.getRemainingAp() - total) + extras;\n-                chr.setRemainingAp(remainingAp);\n-                chr.updateSingleStat(MapleStat.AVAILABLEAP, remainingAp);\n+                \n+                chr.assignStrDexIntLuk(statGain[0], statGain[1], statGain[3], statGain[2]);\n                 c.announce(MaplePacketCreator.enableActions());\n             }\n         } finally {\n@@ -380,53 +366,51 @@ private static int getNthHighestStat(List<Short> statList, short rank) {    // r\n         return(statList.size() <= rank ? 0 : statList.get(rank));\n     }\n     \n-    private static int gainStatByType(MapleCharacter chr, MapleStat type, int[] statGain, int gain) {\n+    private static int gainStatByType(MapleStat type, int[] statGain, int gain, int statUpdate[]) {\n         if(gain <= 0) return 0;\n         \n         int newVal = 0;\n         if (type.equals(MapleStat.STR)) {\n-            newVal = chr.getStr() + gain;\n+            newVal = statUpdate[0] + gain;\n             if (newVal > ServerConstants.MAX_AP) {\n                 statGain[0] += (gain - (newVal - ServerConstants.MAX_AP));\n-                chr.setStr(ServerConstants.MAX_AP);\n+                statUpdate[0] = ServerConstants.MAX_AP;\n             } else {\n                 statGain[0] += gain;\n-                chr.setStr(newVal);\n+                statUpdate[0] = newVal;\n             }\n         } else if (type.equals(MapleStat.INT)) {\n-            newVal = chr.getInt() + gain;\n+            newVal = statUpdate[3] + gain;\n             if (newVal > ServerConstants.MAX_AP) {\n                 statGain[3] += (gain - (newVal - ServerConstants.MAX_AP));\n-                chr.setInt(ServerConstants.MAX_AP);\n+                statUpdate[3] = ServerConstants.MAX_AP;\n             } else {\n                 statGain[3] += gain;\n-                chr.setInt(newVal);\n+                statUpdate[3] = newVal;\n             }\n         } else if (type.equals(MapleStat.LUK)) {\n-            newVal = chr.getLuk() + gain;\n+            newVal = statUpdate[2] + gain;\n             if (newVal > ServerConstants.MAX_AP) {\n                 statGain[2] += (gain - (newVal - ServerConstants.MAX_AP));\n-                chr.setLuk(ServerConstants.MAX_AP);\n+                statUpdate[2] = ServerConstants.MAX_AP;\n             } else {\n                 statGain[2] += gain;\n-                chr.setLuk(newVal);\n+                statUpdate[2] = newVal;\n             }\n         } else if (type.equals(MapleStat.DEX)) {\n-            newVal = chr.getDex() + gain;\n+            newVal = statUpdate[1] + gain;\n             if (newVal > ServerConstants.MAX_AP) {\n                 statGain[1] += (gain - (newVal - ServerConstants.MAX_AP));\n-                chr.setDex(ServerConstants.MAX_AP);\n+                statUpdate[1] = ServerConstants.MAX_AP;\n             } else {\n                 statGain[1] += gain;\n-                chr.setDex(newVal);\n+                statUpdate[1] = newVal;\n             }\n         }\n         \n         if (newVal > ServerConstants.MAX_AP) {\n-            chr.updateSingleStat(type, ServerConstants.MAX_AP);\n             return newVal - ServerConstants.MAX_AP;\n         }\n-        chr.updateSingleStat(type, newVal);\n         return 0;\n     }\n     \n@@ -435,20 +419,9 @@ private static MapleStat getQuaternaryStat(MapleJob stance) {\n         return MapleStat.STR;\n     }\n     \n-    private static int getAccumulatedStatGain(int[] statGain) {\n-        int acc = 0;\n-        \n-        for(byte i = 0; i < statGain.length; i++) {\n-            acc += statGain[i];\n-        }\n-        \n-        return acc;\n-    }\n-    \n     public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n         c.lockClient();\n         try {\n-            List<Pair<MapleStat, Integer>> statupdate = new ArrayList<>(2);\n             MapleCharacter player = c.getPlayer();\n \n             switch (APFrom) {\n@@ -458,31 +431,47 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-                    player.addStat(1, -1);\n+                    if (!player.assignStr(-1)) {\n+                        player.message(\"Couldn't execute AP reset operation.\");\n+                        c.announce(MaplePacketCreator.enableActions());\n+                        return false;\n+                    }\n                     break;\n                 case 128: // dex\n                     if (player.getDex() < 5) {\n                         player.message(\"You don't have the minimum DEX required to swap.\");\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-                    player.addStat(2, -1);\n+                    if (!player.assignDex(-1)) {\n+                        player.message(\"Couldn't execute AP reset operation.\");\n+                        c.announce(MaplePacketCreator.enableActions());\n+                        return false;\n+                    }\n                     break;\n                 case 256: // int\n                     if (player.getInt() < 5) {\n                         player.message(\"You don't have the minimum INT required to swap.\");\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-                    player.addStat(3, -1);\n+                    if (!player.assignInt(-1)) {\n+                        player.message(\"Couldn't execute AP reset operation.\");\n+                        c.announce(MaplePacketCreator.enableActions());\n+                        return false;\n+                    }\n                     break;\n                 case 512: // luk\n                     if (player.getLuk() < 5) {\n                         player.message(\"You don't have the minimum LUK required to swap.\");\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-                    player.addStat(4, -1);\n+                    if (!player.assignLuk(-1)) {\n+                        player.message(\"Couldn't execute AP reset operation.\");\n+                        c.announce(MaplePacketCreator.enableActions());\n+                        return false;\n+                    }\n                     break;\n                 case 2048: // HP\n                     if(ServerConstants.USE_ENFORCE_HPMP_SWAP) {\n@@ -492,6 +481,7 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n                             return false;\n                         }\n                     }\n+                    \n                     if (player.getHpMpApUsed() < 1) {\n                         player.message(\"You don't have enough HPMP stat points to spend on AP Reset.\");\n                         c.announce(MaplePacketCreator.enableActions());\n@@ -500,27 +490,19 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n \n                     int hp = player.getMaxHp();\n                     int level_ = player.getLevel();\n-\n-                    boolean canWash_ = true;\n                     if (hp < level_ * 14 + 148) {\n-                        canWash_ = false;\n-                    }\n-\n-                    if (!canWash_) {\n                         player.message(\"You don't have the minimum HP pool required to swap.\");\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-\n-                    player.setHpMpApUsed(player.getHpMpApUsed() - 1);\n+                    \n+                    int curHp = player.getHp();\n                     int hplose = -takeHp(player.getJob());\n-                    int nextHp = Math.max(1, player.getHp() + hplose), nextMaxHp = Math.max(50, player.getMaxHp() + hplose);\n-\n-                    player.setHp(nextHp);\n-                    player.setMaxHp(nextMaxHp);\n-                    statupdate.add(new Pair<>(MapleStat.HP, nextHp));\n-                    statupdate.add(new Pair<>(MapleStat.MAXHP, nextMaxHp));\n-\n+                    player.assignHP(hplose, -1);\n+                    if (!ServerConstants.USE_FIXED_RATIO_HPMP_UPDATE) {\n+                        player.updateHp(Math.max(1, curHp + hplose));\n+                    }\n+                    \n                     break;\n                 case 8192: // MP\n                     if(ServerConstants.USE_ENFORCE_HPMP_SWAP) {\n@@ -530,6 +512,7 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n                             return false;\n                         }\n                     }\n+                    \n                     if (player.getHpMpApUsed() < 1) {\n                         player.message(\"You don't have enough HPMP stat points to spend on AP Reset.\");\n                         c.announce(MaplePacketCreator.enableActions());\n@@ -556,24 +539,20 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n                         c.announce(MaplePacketCreator.enableActions());\n                         return false;\n                     }\n-\n-                    player.setHpMpApUsed(player.getHpMpApUsed() - 1);\n+                    \n+                    int curMp = player.getMp();\n                     int mplose = -takeMp(job);\n-                    int nextMp = Math.max(0, player.getMp() + mplose), nextMaxMp = Math.max(5, player.getMaxMp() + mplose);\n-\n-                    player.setMp(nextMp);\n-                    player.setMaxMp(nextMaxMp);\n-                    statupdate.add(new Pair<>(MapleStat.MP, nextMp));\n-                    statupdate.add(new Pair<>(MapleStat.MAXMP, nextMaxMp));\n-\n+                    player.assignMP(mplose, -1);\n+                    if (!ServerConstants.USE_FIXED_RATIO_HPMP_UPDATE) {\n+                        player.updateMp(Math.max(0, curMp + mplose));\n+                    }\n                     break;\n                 default:\n                     c.announce(MaplePacketCreator.updatePlayerStats(MaplePacketCreator.EMPTY_STATUPDATE, true, player));\n                     return false;\n             }\n \n-            addStat(c, APTo, true);\n-            c.announce(MaplePacketCreator.updatePlayerStats(statupdate, true, player));\n+            addStat(player, APTo, true);\n             return true;\n         } finally {\n             c.unlockClient();\n@@ -583,69 +562,65 @@ public static boolean APResetAction(MapleClient c, int APFrom, int APTo) {\n     public static void APAssignAction(MapleClient c, int num) {\n         c.lockClient();\n         try {\n-            if (c.getPlayer().getRemainingAp() > 0) {\n-                if (addStat(c, num, false)) {\n-                    c.getPlayer().setRemainingAp(c.getPlayer().getRemainingAp() - 1);\n-                    c.getPlayer().updateSingleStat(MapleStat.AVAILABLEAP, c.getPlayer().getRemainingAp());\n-                }\n-            }\n-            c.announce(MaplePacketCreator.enableActions());\n+            addStat(c.getPlayer(), num, false);\n         } finally {\n             c.unlockClient();\n         }\n     }\n     \n-    private static boolean addStat(MapleClient c, int apTo, boolean usedAPReset) {\n+    private static boolean addStat(MapleCharacter chr, int apTo, boolean usedAPReset) {\n         switch (apTo) {\n-            case 64: // Str\n-                if (c.getPlayer().getStr() >= 32767) {\n+            case 64:\n+                if (!chr.assignStr(1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }\n-                c.getPlayer().addStat(1, 1);\n                 break;\n             case 128: // Dex\n-                if (c.getPlayer().getDex() >= 32767) {\n+                if (!chr.assignDex(1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }\n-                c.getPlayer().addStat(2, 1);\n                 break;\n             case 256: // Int\n-                if (c.getPlayer().getInt() >= 32767) {\n+                if (!chr.assignInt(1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }\n-                c.getPlayer().addStat(3, 1);\n                 break;\n             case 512: // Luk\n-                if (c.getPlayer().getLuk() >= 32767) {\n+                if (!chr.assignLuk(1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }\n-                c.getPlayer().addStat(4, 1);\n                 break;\n-            case 2048: // HP\n-                addHP(c.getPlayer(), addHP(c, usedAPReset));\n+            case 2048:\n+                if (!chr.assignHP(calcHpChange(chr, usedAPReset), 1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n+                    return false;\n+                }\n                 break;\n-            case 8192: // MP\n-                addMP(c.getPlayer(), addMP(c, usedAPReset));\n+            case 8192:\n+                if (!chr.assignMP(calcMpChange(chr, usedAPReset), 1)) {\n+                    chr.message(\"Couldn't execute AP assign operation.\");\n+                    chr.announce(MaplePacketCreator.enableActions());\n+                    return false;\n+                }\n                 break;\n             default:\n-                c.announce(MaplePacketCreator.updatePlayerStats(MaplePacketCreator.EMPTY_STATUPDATE, true, c.getPlayer()));\n+                chr.announce(MaplePacketCreator.updatePlayerStats(MaplePacketCreator.EMPTY_STATUPDATE, true, chr));\n                 return false;\n         }\n         return true;\n     }\n \n-    private static int addHP(MapleClient c, boolean usedAPReset) {\n-        MapleCharacter player = c.getPlayer();\n+    private static int calcHpChange(MapleCharacter player, boolean usedAPReset) {\n         MapleJob job = player.getJob();\n-        int MaxHP = player.getMaxHp();\n-        if (player.getHpMpApUsed() > 9999 || MaxHP >= 30000) {\n-            return MaxHP;\n-        }\n-        \n-        return MaxHP + calcHpChange(player, job, usedAPReset);\n-    }\n-    \n-    private static int calcHpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n         int MaxHP = 0;\n         \n         if (job.isA(MapleJob.WARRIOR) || job.isA(MapleJob.DAWNWARRIOR1)) {\n@@ -737,18 +712,8 @@ private static int calcHpChange(MapleCharacter player, MapleJob job, boolean use\n         return MaxHP;\n     }\n \n-    private static int addMP(MapleClient c, boolean usedAPReset) {\n-        MapleCharacter player = c.getPlayer();\n-        int MaxMP = player.getMaxMp();\n+    private static int calcMpChange(MapleCharacter player, boolean usedAPReset) {\n         MapleJob job = player.getJob();\n-        if (player.getHpMpApUsed() > 9999 || player.getMaxMp() >= 30000) {\n-            return MaxMP;\n-        }\n-        \n-        return MaxMP + calcMpChange(player, job, usedAPReset);\n-    }\n-    \n-    private static int calcMpChange(MapleCharacter player, MapleJob job, boolean usedAPReset) {\n         int MaxMP = 0;\n         \n         if (job.isA(MapleJob.WARRIOR) || job.isA(MapleJob.DAWNWARRIOR1) || job.isA(MapleJob.ARAN1)) {\n@@ -823,20 +788,6 @@ private static int calcMpChange(MapleCharacter player, MapleJob job, boolean use\n         \n         return MaxMP;\n     }\n-\n-    private static void addHP(MapleCharacter player, int MaxHP) {\n-        MaxHP = Math.min(30000, MaxHP);\n-        player.setHpMpApUsed(player.getHpMpApUsed() + 1);\n-        player.setMaxHp(MaxHP);\n-        player.updateSingleStat(MapleStat.MAXHP, MaxHP);\n-    }\n-\n-    private static void addMP(MapleCharacter player, int MaxMP) {\n-        MaxMP = Math.min(30000, MaxMP);\n-        player.setHpMpApUsed(player.getHpMpApUsed() + 1);\n-        player.setMaxMp(MaxMP);\n-        player.updateSingleStat(MapleStat.MAXMP, MaxMP);\n-    }\n     \n     private static int takeHp(MapleJob job) {\n         int MaxHP = 0;"}, {"sha": "5d263bfe4091144e810bd079f773e325adc72422", "filename": "src/client/processor/AssignSPProcessor.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/AssignSPProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/AssignSPProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/AssignSPProcessor.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -25,7 +25,6 @@\n \n import client.MapleCharacter;\n import client.MapleClient;\n-import client.MapleStat;\n import client.Skill;\n import client.SkillFactory;\n import client.autoban.AutobanFactory;\n@@ -49,7 +48,7 @@ public static void SPAssignAction(MapleClient c, int skillid) {\n             }\n \n             MapleCharacter player = c.getPlayer();\n-            int remainingSp = player.getRemainingSpBySkill(GameConstants.getSkillBook(skillid/10000));\n+            int remainingSp = player.getRemainingSps()[GameConstants.getSkillBook(skillid/10000)];\n             boolean isBeginnerSkill = false;\n             if ((!GameConstants.isPqSkillMap(player.getMapId()) && GameConstants.isPqSkill(skillid)) || (!player.isGM() && GameConstants.isGMSkills(skillid)) || (!GameConstants.isInJobTree(skillid, player.getJob().getId()) && !player.isGM())) {\n                 AutobanFactory.PACKET_EDIT.alert(player, \"tried to packet edit in distributing sp.\");\n@@ -78,9 +77,10 @@ public void run() {\n             int curLevel = player.getSkillLevel(skill);\n             if ((remainingSp > 0 && curLevel + 1 <= (skill.isFourthJob() ? player.getMasterLevel(skill) : skill.getMaxLevel()))) {\n                 if (!isBeginnerSkill) {\n-                    player.setRemainingSp(player.getRemainingSpBySkill(GameConstants.getSkillBook(skillid/10000)) - 1, GameConstants.getSkillBook(skillid/10000));\n-                }       \t\n-                player.updateSingleStat(MapleStat.AVAILABLESP, player.getRemainingSpBySkill(GameConstants.getSkillBook(skillid/10000)));\n+                    player.gainSp(-1, GameConstants.getSkillBook(skillid/10000), false);\n+                } else {\n+                    player.announce(MaplePacketCreator.enableActions());\n+                }\n                 if (skill.getId() == Aran.FULL_SWING) {\n                     player.changeSkillLevel(skill, (byte) (curLevel + 1), player.getMasterLevel(skill), player.getSkillExpiration(skill));\n                     player.changeSkillLevel(SkillFactory.getSkill(Aran.HIDDEN_FULL_DOUBLE), (byte) player.getSkillLevel(skill), player.getMasterLevel(skill),  player.getSkillExpiration(skill));"}, {"sha": "e4f6f5f238831182d1f35bea216d0e3d4b7c56f7", "filename": "src/client/processor/BuybackProcessor.java", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/BuybackProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/BuybackProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/BuybackProcessor.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -49,7 +49,7 @@ public static void processBuyback(MapleClient c) {\n             c.unlockClient();\n         }\n \n-        if(buyback) {\n+        if (buyback) {\n             String jobString;\n             switch(chr.getJobStyle()) {\n                 case WARRIOR:\n@@ -78,15 +78,8 @@ public static void processBuyback(MapleClient c) {\n             }\n \n             chr.setStance(0);\n-\n-            chr.setHp(chr.getMaxHp());\n-            chr.setMp(chr.getMaxMp());\n-\n-            List<Pair<MapleStat, Integer>> hpmpupdate = new ArrayList<>(2);\n-            hpmpupdate.add(new Pair<>(MapleStat.HP, Integer.valueOf(chr.getHp())));\n-            hpmpupdate.add(new Pair<>(MapleStat.MP, Integer.valueOf(chr.getMp())));\n-            c.announce(MaplePacketCreator.updatePlayerStats(hpmpupdate, true, chr));\n-\n+            chr.healHpMp();\n+            \n             AbsoluteLifeMovement alm = new AbsoluteLifeMovement(0, chr.getPosition(), 0, 0);\n             alm.setPixelsPerSecond(new Point(0, 0));\n             List<LifeMovementFragment> moveUpdate = Collections.singletonList((LifeMovementFragment) alm);"}, {"sha": "50b9325b540ae26ae6789e95923e099a9e59b766", "filename": "src/client/processor/MakerProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/MakerProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/client/processor/MakerProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/MakerProcessor.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -256,7 +256,7 @@ private static boolean removeOddMakerReagents(int toCreate, Map<Integer, Short>\n     \n     private static int getMakerReagentSlots(int itemId) {\n         try {\n-            int eqpLevel = ii.getEquipStats(itemId).get(\"reqLevel\");\n+            int eqpLevel = ii.getEquipLevelReq(itemId);\n             \n             if(eqpLevel < 78) {\n                 return 1;"}, {"sha": "a7b4d2f22d2a4c8909b057bf13a22c56ca85847c", "filename": "src/constants/ExpTable.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/ExpTable.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/ExpTable.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ExpTable.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -22,8 +22,8 @@\n package constants;\n \n public final class ExpTable {\n-    private static final int[] exp = {1, 15, 34, 57, 92, 135, 372, 560, 840, 1144, 1242, 1573, 2144, 2800, 3640, 4700, 5893, 7360, 9144, 11120, 13477, 16268, 19320, 22880, 27008, 31477, 36600, 42444, 48720, 55813, 63800, 86784, 98208, 110932, 124432, 139372, 155865, 173280, 192400, 213345, 235372, 259392, 285532, 312928, 342624, 374760, 408336, 445544, 483532, 524160, 567772, 598886, 631704, 666321, 702836, 741351, 781976, 824828, 870028, 917625, 967995, 1021041, 1076994, 1136013, 1198266, 1263930, 1333194, 1406252, 1483314, 1564600, 1650340, 1740778, 1836173, 1936794, 2042930, 2154882, 2272970, 2397528, 2528912, 2667496, 2813674, 2967863, 3130502, 3302053, 3483005, 3673873, 3875201, 4087562, 4311559, 4547832, 4797053, 5059931, 5337215, 5629694, 5938202, 6263614, 6606860, 6968915, 7350811, 7753635, 8178534, 8626718, 9099462, 9598112, 10124088, 10678888, 11264090, 11881362, 12532461, 13219239, 13943653, 14707765, 15513750, 16363902, 17260644, 18206527, 19204245, 20256637, 21366700, 22537594, 23772654, 25075395, 26449526, 27898960, 29427822, 31040466, 32741483, 34535716, 36428273, 38424542, 40530206, 42751262, 45094030, 47565183, 50171755, 52921167, 55821246, 58880250, 62106888, 65510344, 69100311, 72887008, 76881216, 81094306, 85594273, 90225770, 95170142, 100385466, 105886589, 111689174, 117809740, 124265714, 131075474, 138258410, 145834970, 153826726, 162256430, 171148082, 180526997, 190419876, 200854885, 211861732, 223471711, 223471711, 248635353, 262260570, 276632449, 291791906, 307782102, 324648562, 342439302, 361204976, 380999008, 401877754, 423900654, 447130410, 471633156, 497478653, 524740482, 553496261, 583827855, 615821622, 649568646, 685165008, 722712050, 762316670, 804091623, 848155844, 894634784, 943660770, 995373379, 1049919840, 1107455447, 1168144006, 1232158297, 1299680571, 1370903066, 1446028554, 1525246918, 1608855764, 1697021059};\n-    private static final int[] equip = {1, 15, 19, 23, 35, 43, 98, 188, 237, 280, 304, 331, 571, 656, 840, 1060, 1193, 1467, 1784, 1976, 2357, 2791, 3052, 3560, 4128, 4469, 5123, 5844, 6276, 7093};\n+    private static final int[] exp = {15, 15, 34, 57, 92, 135, 372, 560, 840, 1144, 1242, 1573, 2144, 2800, 3640, 4700, 5893, 7360, 9144, 11120, 13477, 16268, 19320, 22880, 27008, 31477, 36600, 42444, 48720, 55813, 63800, 86784, 98208, 110932, 124432, 139372, 155865, 173280, 192400, 213345, 235372, 259392, 285532, 312928, 342624, 374760, 408336, 445544, 483532, 524160, 567772, 598886, 631704, 666321, 702836, 741351, 781976, 824828, 870028, 917625, 967995, 1021041, 1076994, 1136013, 1198266, 1263930, 1333194, 1406252, 1483314, 1564600, 1650340, 1740778, 1836173, 1936794, 2042930, 2154882, 2272970, 2397528, 2528912, 2667496, 2813674, 2967863, 3130502, 3302053, 3483005, 3673873, 3875201, 4087562, 4311559, 4547832, 4797053, 5059931, 5337215, 5629694, 5938202, 6263614, 6606860, 6968915, 7350811, 7753635, 8178534, 8626718, 9099462, 9598112, 10124088, 10678888, 11264090, 11881362, 12532461, 13219239, 13943653, 14707765, 15513750, 16363902, 17260644, 18206527, 19204245, 20256637, 21366700, 22537594, 23772654, 25075395, 26449526, 27898960, 29427822, 31040466, 32741483, 34535716, 36428273, 38424542, 40530206, 42751262, 45094030, 47565183, 50171755, 52921167, 55821246, 58880250, 62106888, 65510344, 69100311, 72887008, 76881216, 81094306, 85594273, 90225770, 95170142, 100385466, 105886589, 111689174, 117809740, 124265714, 131075474, 138258410, 145834970, 153826726, 162256430, 171148082, 180526997, 190419876, 200854885, 211861732, 223471711, 223471711, 248635353, 262260570, 276632449, 291791906, 307782102, 324648562, 342439302, 361204976, 380999008, 401877754, 423900654, 447130410, 471633156, 497478653, 524740482, 553496261, 583827855, 615821622, 649568646, 685165008, 722712050, 762316670, 804091623, 848155844, 894634784, 943660770, 995373379, 1049919840, 1107455447, 1168144006, 1232158297, 1299680571, 1370903066, 1446028554, 1525246918, 1608855764, 1697021059};\n+    private static final int[] equip = {1, 15, 19, 23, 35, 43, 98, 188, 237, 280, 304, 331, 571, 656, 840, 1060, 1193, 1467, 1784, 1976, 2357, 2791, 3052, 3560, 4128, 4469, 5123, 5844, 6276, 7093, 10000};\n     private static final int[] pet = {1, 1, 3, 6, 14, 31, 60, 108, 181, 287, 434, 632, 891, 1224, 1642, 2161, 2793, 3557, 4467, 5542, 6801, 8263, 9950, 11882, 14084, 16578, 19391, 22547, 26074, 30000, 2147483647};\n     private static final int[] mount = {1, 24, 50, 105, 134, 196, 254, 263, 315, 367, 430, 543, 587, 679, 725, 897, 1146, 1394, 1701, 2247, 2543, 2898, 3156, 3313, 3584, 3923, 4150, 4305, 4550};\n "}, {"sha": "f91dd5abf91fba7133d38d7484f70a19b34cd49a", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -94,6 +94,8 @@ public static int getPlayerBonusExpRate(int slot) {\n         put(\"temple\", 270000100);\n         put(\"square\", 103040000);\n         put(\"neo\", 240070000);\n+        put(\"mushking\", 106020000);\n+        put(\"bosspq\", 970030000);\n         put(\"fm\", 910000000);\n     }};\n     "}, {"sha": "03c69079cb1be2aa3bb014f304309dba5718172e", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -60,6 +60,7 @@\n     public static final boolean USE_MTS = false;\n     public static final boolean USE_AUTOHIDE_GM = false;            //When enabled, GMs are automatically hidden when joining. Thanks to Steven Deblois (steven1152).\n     public static final boolean USE_BUYBACK_SYSTEM = true;          //Enables the HeavenMS-builtin buyback system, to be used by dead players when clicking the MTS button.\n+    public static final boolean USE_FIXED_RATIO_HPMP_UPDATE = true; //Enables the HeavenMS-builtin HPMP update based on the current pool to max pool ratio.\n     public static final boolean USE_FAMILY_SYSTEM = false;\n     public static final boolean USE_DUEY = true;\n     public static final boolean USE_RANDOMIZE_HPMP_GAIN = true;     //Enables randomizing on MaxHP/MaxMP gains and INT accounting for the MaxMP gain.\n@@ -206,8 +207,8 @@\n     \n     //Map-Chair Configuration\n     public static final boolean USE_CHAIR_EXTRAHEAL = true;     //Enable map chairs to further recover player's HP and MP (player must have the Chair Mastery skill).\n-    public static final byte CHAIR_EXTRA_HEAL_HP = 70;          //Each chair extra heal proc increasing HP.\n-    public static final byte CHAIR_EXTRA_HEAL_MP = 42;          //Each chair extra heal proc increasing MP.\n+    public static final byte CHAIR_EXTRA_HEAL_MULTIPLIER = 10;  //Due to only being able to be send up-to-255 heal values, values being actually updated is the one displayed times this.\n+    public static final int CHAIR_EXTRA_HEAL_MAX_DELAY = 21;    //Players are expected to recover fully after using this skill for N seconds.\n     \n     //Player NPC Configuration\n     public static final int PLAYERNPC_INITIAL_X = 262;          //Map frame width for putting PlayerNPCs."}, {"sha": "13ef7daa9551c97481f3bdab8be145e537b3418a", "filename": "src/net/MapleServerHandler.java", "status": "modified", "additions": 38, "deletions": 3, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/MapleServerHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/MapleServerHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/MapleServerHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -37,6 +37,7 @@\n \n import net.server.Server;\n import net.server.audit.locks.MonitoredLockType;\n+import net.server.audit.locks.MonitoredReentrantLock;\n import net.server.audit.locks.factory.MonitoredReentrantLockFactory;\n import net.server.coordinator.MapleSessionCoordinator;\n \n@@ -49,12 +50,12 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n import java.util.Arrays;\n \n-import java.util.concurrent.locks.Lock;\n import java.util.concurrent.ScheduledFuture;\n \n import java.util.HashMap;\n import java.util.Map;\n import java.util.Map.Entry;\n+import net.server.audit.LockCollector;\n import server.TimerManager;\n \n public class MapleServerHandler extends IoHandlerAdapter {\n@@ -65,8 +66,8 @@\n     private static final SimpleDateFormat sdf = new SimpleDateFormat(\"dd-MM-yyyy HH:mm\");\n     private static AtomicLong sessionId = new AtomicLong(7777);\n     \n-    private Lock idleLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.SRVHANDLER_IDLE, true);\n-    private Lock tempLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.SRVHANDLER_TEMP, true);\n+    private MonitoredReentrantLock idleLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.SRVHANDLER_IDLE, true);\n+    private MonitoredReentrantLock tempLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.SRVHANDLER_TEMP, true);\n     private Map<MapleClient, Long> idleSessions = new HashMap<>(100);\n     private Map<MapleClient, Long> tempIdleSessions = new HashMap<>();\n     private ScheduledFuture<?> idleManager = null;\n@@ -269,4 +270,38 @@ private void cancelIdleManagerTask() {\n         this.idleManager.cancel(false);\n         this.idleManager = null;\n     }\n+    \n+    private void disposeLocks() {\n+        LockCollector.getInstance().registerDisposeAction(new Runnable() {\n+            @Override\n+            public void run() {\n+                emptyLocks();\n+            }\n+        });\n+    }\n+\n+    private void emptyLocks() {\n+        idleLock.dispose();\n+        tempLock.dispose();\n+    }\n+    \n+    public void dispose() {\n+        cancelIdleManagerTask();\n+        \n+        idleLock.lock();\n+        try {\n+            idleSessions.clear();\n+        } finally {\n+            idleLock.unlock();\n+        }\n+        \n+        tempLock.lock();\n+        try {\n+            tempIdleSessions.clear();\n+        } finally {\n+            tempLock.unlock();\n+        }\n+        \n+        disposeLocks();\n+    }\n }"}, {"sha": "58a16a86497c4ff005e739ff00cf30e4675c671a", "filename": "src/net/server/Server.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -399,7 +399,7 @@ private int initWorld(Properties p) {\n             worlds.add(world);\n \n             Map<Integer, String> channelInfo = new HashMap<>();\n-            long bootTime = System.currentTimeMillis();\n+            long bootTime = getCurrentTime();\n             for (int j = 1; j <= Integer.parseInt(p.getProperty(\"channels\" + i)); j++) {\n                 int channelid = j;\n                 Channel channel = new Channel(i, channelid, bootTime);"}, {"sha": "1df11369c1990e597366c1f61188060b81dd8305", "filename": "src/net/server/audit/locks/MonitoredLockType.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredLockType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredLockType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredLockType.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n@@ -31,6 +31,7 @@\n     CHARACTER_PET,\n     CHARACTER_PRT,\n     CHARACTER_EVT,\n+    CHARACTER_STA,\n     CLIENT,\n     CLIENT_ENCODER,\n     CLIENT_LOGIN,"}, {"sha": "fb5862ac04c8677cb655afb6502987a61cc9f612", "filename": "src/net/server/audit/locks/MonitoredReadLock.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredReadLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredReadLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredReadLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "27df2b477a8353c7601e36f110388720cb2107b3", "filename": "src/net/server/audit/locks/MonitoredReentrantLock.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredReentrantLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredReentrantLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredReentrantLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "f417808e38824c8fbe257a6f1153e47cae21f54a", "filename": "src/net/server/audit/locks/MonitoredWriteLock.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredWriteLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/MonitoredWriteLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredWriteLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "e5e8aa3c73ab54ab9d487d14b9cbb69247c53ab0", "filename": "src/net/server/audit/locks/empty/EmptyReadLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyReadLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyReadLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/empty/EmptyReadLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n@@ -48,7 +48,7 @@ private static String printThreadStack(StackTraceElement[] list) {\n         for(int i = 0; i < list.length; i++) {\n             s += (\"    \" + list[i].toString() + \"\\r\\n\");\n         }\n-        s += \"----------------------------\";\n+        s += \"----------------------------\\r\\n\\r\\n\";\n         \n         return s;\n     }"}, {"sha": "1753efcb43126cdd53e9195e3b2e3a46d72ef505", "filename": "src/net/server/audit/locks/empty/EmptyReentrantLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyReentrantLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyReentrantLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/empty/EmptyReentrantLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n@@ -48,7 +48,7 @@ private static String printThreadStack(StackTraceElement[] list) {\n         for(int i = 0; i < list.length; i++) {\n             s += (\"    \" + list[i].toString() + \"\\r\\n\");\n         }\n-        s += \"----------------------------\";\n+        s += \"----------------------------\\r\\n\\r\\n\";\n         \n         return s;\n     }"}, {"sha": "f051931c5ccdc0237a63635a99ce09e3f81d8073", "filename": "src/net/server/audit/locks/empty/EmptyWriteLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyWriteLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/empty/EmptyWriteLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/empty/EmptyWriteLock.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n@@ -48,7 +48,7 @@ private static String printThreadStack(StackTraceElement[] list) {\n         for(int i = 0; i < list.length; i++) {\n             s += (\"    \" + list[i].toString() + \"\\r\\n\");\n         }\n-        s += \"----------------------------\";\n+        s += \"----------------------------\\r\\n\\r\\n\";\n         \n         return s;\n     }"}, {"sha": "1c3095fa6fd6d68c6dbc60cbe87839a1028b3cb9", "filename": "src/net/server/audit/locks/factory/MonitoredReadLockFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredReadLockFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredReadLockFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/factory/MonitoredReadLockFactory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "521487eef31d32b1eb657eaa66f1b8e5386efdbf", "filename": "src/net/server/audit/locks/factory/MonitoredReentrantLockFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredReentrantLockFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredReentrantLockFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/factory/MonitoredReentrantLockFactory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "d2f1880f20b617b1264d3f62e543096cbe4fafbc", "filename": "src/net/server/audit/locks/factory/MonitoredWriteLockFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredWriteLockFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/audit/locks/factory/MonitoredWriteLockFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/factory/MonitoredWriteLockFactory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "5285ec293996a09c332508505de942ded2db1d3a", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -214,6 +214,8 @@ public final void shutdown() {\n             closeChannelSchedules();\n             players = null;\n             \n+            MapleServerHandler handler = (MapleServerHandler) acceptor.getHandler();\n+            handler.dispose();\n             acceptor.unbind();\n             \n             finishedShutdown = true;\n@@ -611,7 +613,7 @@ public void run() {\n             }\n         }, clockTime + 3000);   // let the TIMES UP display for 3 seconds, then warp\n         \n-        dojoFinishTime[slot] = System.currentTimeMillis() + clockTime;\n+        dojoFinishTime[slot] = Server.getInstance().getCurrentTime() + clockTime;\n     }\n     \n     public void dismissDojoSchedule(int dojoMapId, MapleParty party) {"}, {"sha": "9d945b0af643dd42792f27840d1a594e9583021b", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -298,7 +298,7 @@ public void run() {\n                             }\n                         }\n                     } else if (attack.skill == Marauder.ENERGY_DRAIN || attack.skill == ThunderBreaker.ENERGY_DRAIN || attack.skill == NightWalker.VAMPIRE || attack.skill == Assassin.DRAIN) {\n-                        player.addHP(Math.min(monster.getMaxHp(), Math.min((int) ((double) totDamage * (double) SkillFactory.getSkill(attack.skill).getEffect(player.getSkillLevel(SkillFactory.getSkill(attack.skill))).getX() / 100.0), player.getMaxHp() / 2)));\n+                        player.addHP(Math.min(monster.getMaxHp(), Math.min((int) ((double) totDamage * (double) SkillFactory.getSkill(attack.skill).getEffect(player.getSkillLevel(SkillFactory.getSkill(attack.skill))).getX() / 100.0), player.getCurrentMaxHp() / 2)));\n                     } else if (attack.skill == Bandit.STEAL) {\n                         Skill steal = SkillFactory.getSkill(Bandit.STEAL);\n                         if (monster.getStolen().size() < 1) { // One steal per mob <3\n@@ -399,8 +399,7 @@ public void run() {\n                         Skill skill;\n                         if (player.getBuffedValue(MapleBuffStat.COMBO_DRAIN) != null) {\n                             skill = SkillFactory.getSkill(21100005);\n-                            player.setHp(player.getHp() + ((totDamage * skill.getEffect(player.getSkillLevel(skill)).getX()) / 100), true);\n-                            player.updateSingleStat(MapleStat.HP, player.getHp());\n+                            player.addHP(((totDamage * skill.getEffect(player.getSkillLevel(skill)).getX()) / 100));\n                         }\n                     } else if (job == 412 || job == 422 || job == 1411) {\n                         Skill type = SkillFactory.getSkill(player.getJob().getId() == 412 ? 4120005 : (player.getJob().getId() == 1411 ? 14110004 : 4220005));"}, {"sha": "4824614f04690a9deccfefa35fa1b386d9618349", "filename": "src/net/server/channel/handlers/AllianceOperationHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/AllianceOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/AllianceOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AllianceOperationHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -201,7 +201,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n     \n     private void changeLeaderAllianceRank(MapleAlliance alliance, MapleCharacter newLeader) {\n         MapleGuildCharacter lmgc = alliance.getLeader();\n-        MapleCharacter leader = Server.getInstance().getWorld(newLeader.getWorld()).getPlayerStorage().getCharacterById(lmgc.getId());\n+        MapleCharacter leader = newLeader.getWorldServer().getPlayerStorage().getCharacterById(lmgc.getId());\n         leader.getMGC().setAllianceRank(2);\n         leader.saveGuildStatus();\n         "}, {"sha": "20bd9fad08635ffa35c967e34f570e92aafe4ccf", "filename": "src/net/server/channel/handlers/ChangeMapHandler.java", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/ChangeMapHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/ChangeMapHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ChangeMapHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -85,18 +85,17 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\t\t\texecuteStandardPath = chr.getEventInstance().revivePlayer(chr);\n \t\t\t\t\t}\n \t\t\t\t\tif (executeStandardPath) {\n-\t\t\t\t\t\tMapleMap to = chr.getMap();\n+                                                MapleMap map = chr.getMap();\n+                                                \n \t\t\t\t\t\tif (wheel && chr.haveItemWithId(5510000, false)) {\n \t\t\t\t\t\t\tMapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, 5510000, 1, true, false);\n \t\t\t\t\t\t\tchr.announce(MaplePacketCreator.showWheelsLeft(chr.getItemQuantity(5510000, false)));\n+                                                        \n+                                                        chr.updateHp(50);\n+                                                        chr.changeMap(map, map.getRandomPlayerSpawnpoint());\n \t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tchr.cancelAllBuffs(false);\n-\t\t\t\t\t\t\tto = chr.getWarpMap(chr.getMap().getReturnMapId());\n-\t\t\t\t\t\t\tchr.setStance(0);\n+\t\t\t\t\t\t\tchr.respawn(map.getReturnMapId());\n \t\t\t\t\t\t}\n-\t\t\t\t\t\tchr.setHp(50);\n-                                                chr.updatePartyMemberHP();\n-\t\t\t\t\t\tchr.changeMap(to, to.getRandomPlayerSpawnpoint());\n \t\t\t\t\t}\n \t\t\t\t} else if (targetid != -1) {\n                                         if(chr.isGM()) {"}, {"sha": "d2e46275c6a8294072af5f1100115b6bb2b2ff43", "filename": "src/net/server/channel/handlers/CloseRangeDamageHandler.java", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CloseRangeDamageHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -132,14 +132,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (dmgIt.hasNext()) {\n                 totDamageToOneMonster = dmgIt.next().get(0).intValue();\n             }\n-            int remainingHP = chr.getHp() - totDamageToOneMonster * attack.getAttackEffect(chr, null).getX() / 100;\n-            if (remainingHP > 1) {\n-                chr.setHp(remainingHP);\n-            } else {\n-                chr.setHp(1);\n-            }\n-            chr.updateSingleStat(MapleStat.HP, chr.getHp());\n-            chr.checkBerserk(chr.isHidden());\n+            \n+            chr.safeAddHP(-1 * totDamageToOneMonster * attack.getAttackEffect(chr, null).getX() / 100);\n         }\n         if (attack.numAttacked > 0 && attack.skill == 1211002) {\n             boolean advcharge_prob = false;"}, {"sha": "7acc6ddb72b4814ef2597e1b411999c7bd9d397f", "filename": "src/net/server/channel/handlers/DamageSummonHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/DamageSummonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/DamageSummonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DamageSummonHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -32,6 +32,7 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class DamageSummonHandler extends AbstractMaplePacketHandler {\n+    @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         int oid = slea.readInt();\n         slea.skip(1);   // -1"}, {"sha": "726106708cb78b11cc13998e184e7b38fa2f5a91", "filename": "src/net/server/channel/handlers/HealOvertimeHandler.java", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/HealOvertimeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/HealOvertimeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/HealOvertimeHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -26,6 +26,7 @@\n import client.autoban.AutobanFactory;\n import client.autoban.AutobanManager;\n import net.AbstractMaplePacketHandler;\n+import net.server.Server;\n import server.maps.MapleMapFactory;\n import tools.data.input.SeekableLittleEndianAccessor;\n import tools.MaplePacketCreator;\n@@ -37,26 +38,27 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         if(!chr.isLoggedinWorld()) return;\n         \n         AutobanManager abm = chr.getAutobanManager();\n-        int timestamp = slea.readInt();\n-        abm.setTimestamp(0, timestamp, 3);\n-        slea.skip(4);\n+        int timestamp = (int) (Server.getInstance().getCurrentTime() - Server.uptime);\n+        slea.skip(8);\n+        \n         short healHP = slea.readShort();\n         if (healHP != 0) {\n+            abm.setTimestamp(8, timestamp, 3);  // thanks Vcoc for pointing out d/c happening here\n             if ((abm.getLastSpam(0) + 1500) > timestamp) AutobanFactory.FAST_HP_HEALING.addPoint(abm, \"Fast hp healing\");\n             \n             int abHeal = 120 + (int)(20 * MapleMapFactory.getMapRecoveryRate(chr.getMapId())); // Sleepywood sauna and showa spa...\n             if (healHP > abHeal) {\n                 AutobanFactory.HIGH_HP_HEALING.autoban(chr, \"Healing: \" + healHP + \"; Max is \" + abHeal + \".\");\n                 return;\n             }\n-            chr.addHP(healHP);\n             \n+            chr.addHP(healHP);\n             chr.getMap().broadcastMessage(chr, MaplePacketCreator.showHpHealed(chr.getId(), healHP), false);\n-            chr.checkBerserk(chr.isHidden());\n             abm.spam(0, timestamp);\n         }\n         short healMP = slea.readShort();\n         if (healMP != 0 && healMP < 1000) {\n+            abm.setTimestamp(9, timestamp, 3);\n             if ((abm.getLastSpam(1) + 1500) > timestamp) AutobanFactory.FAST_MP_HEALING.addPoint(abm, \"Fast mp healing\");\n             chr.addMP(healMP);\n             abm.spam(1, timestamp);"}, {"sha": "6ff0918301731fda567f687c9509fbe02a6fb6c8", "filename": "src/net/server/channel/handlers/MoveLifeHandler.java", "status": "modified", "additions": 55, "deletions": 64, "changes": 119, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/MoveLifeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/MoveLifeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveLifeHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -24,7 +24,7 @@\n import client.MapleCharacter;\n import client.MapleClient;\n import java.awt.Point;\n-import java.util.ArrayList;\n+import java.util.LinkedList;\n import java.util.List;\n import server.life.MapleMonster;\n import server.life.MapleMonsterInformationProvider;\n@@ -47,27 +47,29 @@\n  * @author Ronan (HeavenMS)\n  */\n public final class MoveLifeHandler extends AbstractMovementPacketHandler {\n+        \n \t@Override\n \tpublic final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n                 MapleCharacter player = c.getPlayer();\n                 MapleMap map = player.getMap();\n-            \n+                \n \t\tint objectid = slea.readInt();\n \t\tshort moveid = slea.readShort();\n \t\tMapleMapObject mmo = map.getMapObject(objectid);\n \t\tif (mmo == null || mmo.getType() != MapleMapObjectType.MONSTER) {\n \t\t\treturn;\n \t\t}\n+                \n \t\tMapleMonster monster = (MapleMonster) mmo;\n-\t\tList<LifeMovementFragment> res = null;\n-                List<MapleCharacter> banishPlayers = new ArrayList<>();\n+                List<MapleCharacter> banishPlayers = new LinkedList<>();\n+                \n \t\tbyte pNibbles = slea.readByte();\n \t\tbyte rawActivity = slea.readByte();\n-\t\tbyte useSkillId = slea.readByte();\n-\t\tbyte useSkillLevel = slea.readByte();\n+\t\tslea.readByte();\n+\t\tslea.readByte();\n \t\tshort pOption = slea.readShort();\n                 slea.skip(8);\n-\n+                \n \t\tif (rawActivity >= 0) {\n \t\t\trawActivity = (byte) (rawActivity & 0xFF >> 1);\n \t\t}\n@@ -78,100 +80,89 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\tbyte attackId = (byte) (isAttack ? rawActivity - 12 : -1);\n \t\tboolean nextMovementCouldBeSkill = (pNibbles & 0x0F) != 0;\n \t\tboolean pUnk = (pNibbles & 0xF0) != 0;\n-\n-\t\tint nextCastSkill = useSkillId;\n-\t\tint nextCastSkillLevel = useSkillLevel;\n+                \n+                boolean currentController = (monster.getController() == player);\n                 \n \t\tMobSkill toUse = null;\n-                int rndSkill = -1;\n+                int useSkillId = 0, useSkillLevel = 0;\n                 \n-                if(monster.getNoSkills() > 0) {\n-                        if(nextMovementCouldBeSkill) {\n-                                rndSkill = Randomizer.nextInt(monster.getNoSkills());\n+                if (isSkill) {\n+                        int noSkills = monster.getNoSkills();\n+                        if (noSkills > 0) {\n+                                int rndSkill = Randomizer.nextInt(noSkills);\n+\n+                                Pair<Integer, Integer> skillToUse = monster.getSkills().get(rndSkill);\n+                                useSkillId = skillToUse.getLeft();\n+                                useSkillLevel = skillToUse.getRight();\n+                                toUse = MobSkillFactory.getMobSkill(useSkillId, useSkillLevel);\n+                        } else {\n+                                nextMovementCouldBeSkill = false;\n                         }\n                 } else {\n                         nextMovementCouldBeSkill = false;\n                 }\n-\t\t\n-                if(monster.applyAnimationIfRoaming((attackId - 13) / 2, rndSkill)) {\n-                        if (rndSkill > -1) {\n-                                Pair<Integer, Integer> skillToUse = monster.getSkills().get(rndSkill);\n-                                nextCastSkill = skillToUse.getLeft();\n-                                nextCastSkillLevel = skillToUse.getRight();\n-                                toUse = MobSkillFactory.getMobSkill(nextCastSkill, nextCastSkillLevel);\n-                                \n-                                if (!isSkill && !isAttack) {\n-                                        long curtime = currentServerTime();\n-                                        if(curtime >= monster.getNextBasicSkillTime()) {  // dont use the special attack too often, chase the player f3\n-                                                //MobAttackInfo mobAttack = MobAttackInfoFactory.getMobAttackInfo(monster, attackId);\n-                                                monster.setNextBasicSkillTime(curtime);\n-                                        } else {\n-                                                toUse = null;   // paliative measure for suspicious mob movement\n-                                        }\n-                                }\n-\n-                                if (toUse != null) {\n-                                        int percHpLeft = (int) (((float) monster.getHp() / monster.getMaxHp()) * 100);\n-                                        if (nextCastSkill != toUse.getSkillId() || nextCastSkillLevel != toUse.getSkillLevel()) {\n-                                                //toUse.resetAnticipatedSkill();\n-                                                return;\n-                                        } else if (toUse.getHP() < percHpLeft) {\n-                                                toUse = null;\n-                                        } else if (monster.canUseSkill(toUse)) {\n-                                                int animationTime = MapleMonsterInformationProvider.getInstance().getMobSkillAnimationTime(monster.getId(), rndSkill);\n-                                                if(animationTime > 0) {\n-                                                        toUse.applyDelayedEffect(player, monster, true, banishPlayers, animationTime);\n-                                                } else {\n-                                                        toUse.applyEffect(player, monster, true, banishPlayers);\n-                                                }\n-                                        } else {\n-                                                toUse = null;\n-                                        }\n-                                }\n+                \n+                int mobMp;\n+                if (toUse != null && toUse.getHP() >= (int) (((float) monster.getHp() / monster.getMaxHp()) * 100) && monster.canUseSkill(toUse)) {\n+                        mobMp = monster.getMp();\n+                    \n+                        int animationTime = MapleMonsterInformationProvider.getInstance().getMobSkillAnimationTime(toUse);\n+                        if(animationTime > 0) {\n+                                toUse.applyDelayedEffect(player, monster, true, banishPlayers, animationTime);\n+                        } else {\n+                                toUse.applyEffect(player, monster, true, banishPlayers);\n                         }\n                 } else {\n-                        if(rndSkill > -1) {\n-                                nextMovementCouldBeSkill = false;\n+                        int atkStatus = monster.canUseAttack((attackId - 13) / 2);\n+                        if (atkStatus < 1) {\n+                                if (!currentController) {\n+                                        return;\n+                                }\n+                                \n+                                mobMp = atkStatus < 0 ? 0 : monster.getMp();\n+                        } else {\n+                                mobMp = monster.getMp();\n                         }\n-                }\n-                \n-                if(toUse == null) {\n+                        \n                         useSkillId = 0;\n                         useSkillLevel = 0;\n                         rawActivity = -1;\n                         pOption = 0;\n+                        \n+                        toUse = null;\n                 }\n                 \n \t\tslea.readByte();\n \t\tslea.readInt(); // whatever\n \t\tshort start_x = slea.readShort(); // hmm.. startpos?\n \t\tshort start_y = slea.readShort(); // hmm...\n-\t\tPoint startPos = new Point(start_x, start_y);\n-\t\tres = parseMovement(slea);\n-\t\tif (monster.getController() != player) {\n+\t\tPoint startPos = new Point(start_x, start_y - 2);\n+\t\tList<LifeMovementFragment> res = parseMovement(slea);\n+\t\tif (!currentController) {\n \t\t\tif (monster.isAttackedBy(player)) {\n \t\t\t\tmonster.switchController(player, true);\n \t\t\t} else {\n \t\t\t\treturn;\n \t\t\t}\n \t\t} else if (rawActivity == -1 && monster.isControllerKnowsAboutAggro() && !monster.isMobile() && !monster.isFirstAttack()) {\n                         monster.setControllerHasAggro(false);\n-\t\t\tmonster.setControllerKnowsAboutAggro(false);\n+                        monster.setControllerKnowsAboutAggro(false);\n \t\t}\n+                \n \t\tboolean aggro = monster.isControllerHasAggro();\n-\t\t\n                 if (toUse != null) {\n-                        c.announce(MaplePacketCreator.moveMonsterResponse(objectid, moveid, monster.getMp(), aggro, toUse.getSkillId(), toUse.getSkillLevel()));\n+                        c.announce(MaplePacketCreator.moveMonsterResponse(objectid, moveid, mobMp, aggro, toUse.getSkillId(), toUse.getSkillLevel()));\n \t\t} else {\n-\t\t\tc.announce(MaplePacketCreator.moveMonsterResponse(objectid, moveid, monster.getMp(), aggro));\n+\t\t\tc.announce(MaplePacketCreator.moveMonsterResponse(objectid, moveid, mobMp, aggro));\n \t\t}\n                 \n \t\tif (aggro) {\n \t\t\tmonster.setControllerKnowsAboutAggro(true);\n \t\t}\n+                \n \t\tif (res != null) {\n                         map.broadcastMessage(player, MaplePacketCreator.moveMonster(objectid, nextMovementCouldBeSkill, rawActivity, useSkillId, useSkillLevel, pOption, startPos, res), monster.getPosition());\n-\t\t\tupdatePosition(res, monster, -1);\n+\t\t\tupdatePosition(res, monster, -2);\n \t\t\tmap.moveMonster(monster, monster.getPosition());\n \t\t}\n                 \n@@ -180,7 +171,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n \t}\n \n-\tpublic static boolean inRangeInclusive(Byte pVal, Integer pMin, Integer pMax) {\n+\tprivate static boolean inRangeInclusive(Byte pVal, Integer pMin, Integer pMax) {\n \t\treturn !(pVal < pMin) || (pVal > pMax);\n \t}\n }\n\\ No newline at end of file"}, {"sha": "70c35111e954ba5d61d68f1b2ae1379074be31ce", "filename": "src/net/server/channel/handlers/PetAutoPotHandler.java", "status": "modified", "additions": 49, "deletions": 54, "changes": 103, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/PetAutoPotHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/PetAutoPotHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetAutoPotHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,15 +23,13 @@\n \n import client.MapleClient;\n import client.MapleCharacter;\n-import client.inventory.Equip;\n import client.inventory.Item;\n import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import net.AbstractMaplePacketHandler;\n import client.inventory.manipulator.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n import server.MapleStatEffect;\n-import tools.Pair;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n import constants.ServerConstants;\n@@ -47,14 +45,9 @@\n     Item toUse;\n     List<Item> toUseList;\n     \n-    boolean hasHpGain;\n-    boolean hasMpGain;\n-    short maxHp;\n-    short maxMp;\n-    short incHp;\n-    short incMp;\n-    int curHp;\n-    int curMp;\n+    boolean hasHpGain, hasMpGain;\n+    int maxHp, maxMp, curHp, curMp;\n+    double incHp, incMp;\n     \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n@@ -72,60 +65,64 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleCharacter chr = c.getPlayer();\n         MapleInventory useInv = chr.getInventory(MapleInventoryType.USE);\n         \n+        int useCount = 0, qtyCount = 0;\n+        MapleStatEffect stat = null;\n+        \n         useInv.lockInventory();\n         try {\n             toUse = useInv.getItem(slot);\n-        \n-            if(toUse != null) {\n+            \n+            if (toUse != null) {\n                 if (toUse.getItemId() != itemId) {\n                     c.announce(MaplePacketCreator.enableActions());\n                     return;\n                 }\n-\n+                \n                 toUseList = null;\n-\n+                \n                 // from now on, toUse becomes the \"cursor\" for the current pot being used\n-                if(toUse.getQuantity() <= 0) {\n-                    if(!cursorOnNextAvailablePot(chr)) {\n+                if (toUse.getQuantity() <= 0) {\n+                    if (!cursorOnNextAvailablePot(chr)) {\n                         c.announce(MaplePacketCreator.enableActions());\n                         return;\n                     }\n                 }\n-\n-                MapleStatEffect stat = MapleItemInformationProvider.getInstance().getItemEffect(toUse.getItemId());\n+                \n+                stat = MapleItemInformationProvider.getInstance().getItemEffect(toUse.getItemId());\n                 hasHpGain = stat.getHp() > 0 || stat.getHpRate() > 0.0;\n                 hasMpGain = stat.getMp() > 0 || stat.getMpRate() > 0.0;\n-\n-                // contabilize the HP and MP gains from equipments on one's effective MaxHP/MaxMP\n-                Pair<Short, Short> maxHpMp = calcEffectivePool(chr);\n-                maxHp = maxHpMp.left;\n-                maxMp = maxHpMp.right;\n-\n-                incHp = stat.getHp();\n-                if(incHp <= 0 && hasHpGain) incHp = (short)(maxHp * stat.getHpRate());\n-\n-                incMp = stat.getMp();\n-                if(incMp <= 0 && hasMpGain) incMp = (short)(maxMp * stat.getMpRate());\n-\n+                \n+                maxHp = chr.getCurrentMaxHp();\n+                maxMp = chr.getCurrentMaxMp();\n+                \n                 curHp = chr.getHp();\n                 curMp = chr.getMp();\n+                \n+                incHp = stat.getHp();\n+                if(incHp <= 0 && hasHpGain) incHp = Math.ceil(maxHp * stat.getHpRate());\n+                \n+                incMp = stat.getMp();\n+                if(incMp <= 0 && hasMpGain) incMp = Math.ceil(maxMp * stat.getMpRate());\n+                \n+                if (hasHpGain) {\n+                    qtyCount = (int) Math.ceil(((ServerConstants.PET_AUTOHP_RATIO * maxHp) - curHp) / incHp);\n+                }\n+                \n+                if (hasMpGain) {\n+                    qtyCount = Math.max(qtyCount, (int) Math.ceil(((ServerConstants.PET_AUTOMP_RATIO * maxMp) - curMp) / incMp));\n+                }\n \n-                //System.out.println(\"\\n-------------------\\n\");\n-                while(true) {\n-                    do {\n-                        MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n-                        stat.applyTo(chr);\n-\n-                        curHp += incHp;\n-                        curMp += incMp;\n-\n-                        //System.out.println();\n-                        //System.out.println(\"hp: \" + hasHpGain + \" hpgain \" + incHp + \" player hp \" + curHp + \" maxhp \" + maxHp);\n-                        //System.out.println(\"mp: \" + hasMpGain + \" mpgain \" + incMp + \" player mp \" + curMp + \" maxmp \" + maxMp);\n-                        //System.out.println(\"redo? \" + (shouldReusePot() && toUse.getQuantity() > 0));\n-                    } while(shouldReusePot() && toUse.getQuantity() > 0);\n-\n-                    if(toUse.getQuantity() == 0 && shouldReusePot()) {\n+                while (true) {\n+                    short qtyToUse = (short) Math.min(qtyCount, toUse.getQuantity());\n+                    MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, qtyToUse, false);\n+                    \n+                    curHp += (incHp * qtyToUse);\n+                    curMp += (incMp * qtyToUse);\n+                    \n+                    useCount += qtyToUse;\n+                    qtyCount -= qtyToUse;\n+                    \n+                    if(toUse.getQuantity() == 0 && qtyCount > 0) {\n                         // depleted out the current slot, fetch for more\n \n                         if(!cursorOnNextAvailablePot(chr)) {\n@@ -139,6 +136,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         } finally {\n             useInv.unlockInventory();\n         }\n+        \n+        for (int i = 0; i < useCount; i++) {\n+            stat.applyTo(chr);\n+        }\n+        \n+        chr.announce(MaplePacketCreator.enableActions());\n     }\n     \n     private boolean cursorOnNextAvailablePot(MapleCharacter chr) {\n@@ -159,13 +162,5 @@ private boolean cursorOnNextAvailablePot(MapleCharacter chr) {\n         }\n         \n         return false;\n-    }\n-    \n-    private static Pair<Short, Short> calcEffectivePool(MapleCharacter chr) {\n-        return new Pair<>((short) chr.getMaxHpEquipped(), (short) chr.getMaxMpEquipped());\n-    }\n-    \n-    private boolean shouldReusePot() {\n-        return (hasHpGain && curHp < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (hasMpGain && curMp < ServerConstants.PET_AUTOMP_RATIO * maxMp);\n     } \n }"}, {"sha": "3a024519a9cefb3786b65cb3989e6faeec889f7e", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -50,6 +50,7 @@\n import client.MapleClient;\n import client.MapleDisease;\n import client.MapleFamily;\n+import client.MapleKeyBinding;\n import client.SkillFactory;\n import client.inventory.Equip;\n import client.inventory.Item;\n@@ -185,10 +186,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         player.sendKeymap();\n         player.sendMacros();\n         \n-        if(player.getKeymap().get(91) != null)\n-            player.announce(MaplePacketCreator.sendAutoHpPot(player.getKeymap().get(91).getAction()));\n-        if(player.getKeymap().get(92) != null)\n-            player.announce(MaplePacketCreator.sendAutoMpPot(player.getKeymap().get(92).getAction()));\n+        // pot bindings being passed through other characters on the account detected thanks to Croosade dev team\n+        MapleKeyBinding autohpPot = player.getKeymap().get(91);\n+        player.announce(MaplePacketCreator.sendAutoHpPot(autohpPot != null ? autohpPot.getAction() : 0));\n+        \n+        MapleKeyBinding autompPot = player.getKeymap().get(92);\n+        player.announce(MaplePacketCreator.sendAutoMpPot(autompPot != null ? autompPot.getAction() : 0));\n         \n         player.getMap().addPlayer(player);\n         player.visitMap(player.getMap());\n@@ -263,8 +266,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleInventory eqpInv = player.getInventory(MapleInventoryType.EQUIPPED);\n         eqpInv.lockInventory();\n         try {\n-            player.resetEquippedHpMp();\n-            \n             for(Item it : eqpInv.list()) {\n                 player.equippedItem((Equip) it);\n             }"}, {"sha": "03cf2cbaf13bdd6675c0dfa8bb7aa8c718dc8755", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -111,12 +111,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         } else if (skillid == Brawler.MP_RECOVERY) {// MP Recovery\n             Skill s = SkillFactory.getSkill(skillid);\n             MapleStatEffect ef = s.getEffect(chr.getSkillLevel(s));\n-            int lose = chr.getMaxHp() / ef.getX();\n-            chr.setHp(chr.getHp() - lose);\n-            chr.updateSingleStat(MapleStat.HP, chr.getHp());\n-            int gain = lose * (ef.getY() / 100);\n-            chr.setMp(chr.getMp() + gain);\n-            chr.updateSingleStat(MapleStat.MP, chr.getMp());\n+            \n+            int lose = chr.safeAddHP(-1 * (chr.getCurrentMaxHp() / ef.getX()));\n+            int gain = -lose * (ef.getY() / 100);\n+            chr.addMP(gain);\n         } else if (skillid == SuperGM.HEAL_PLUS_DISPEL) {\n             slea.skip(11);\n             chr.getMap().broadcastMessage(chr, MaplePacketCreator.showBuffeffect(chr.getId(), skillid, chr.getSkillLevel(skillid)), false);"}, {"sha": "09fbea6d428c6d3d32ea4c6409508aa418826a3e", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -245,11 +245,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n         if (!chr.isHidden()) {\n             map.broadcastMessage(chr, MaplePacketCreator.damagePlayer(damagefrom, monsteridfrom, chr.getId(), damage, fake, direction, is_pgmr, pgmr, is_pg, oid, pos_x, pos_y), false);\n-            chr.checkBerserk(true);\n-        }\n-        else {\n+        } else {\n             map.broadcastGMMessage(chr, MaplePacketCreator.damagePlayer(damagefrom, monsteridfrom, chr.getId(), damage, fake, direction, is_pgmr, pgmr, is_pg, oid, pos_x, pos_y), false);\n-            chr.checkBerserk(false);\n         }\n         if (GameConstants.isDojo(map.getId())) {\n             chr.setDojoEnergy(chr.getDojoEnergy() + ServerConstants.DOJO_ENERGY_DMG);"}, {"sha": "54c03dd1ed4567e12d86d21fc96b3c6a5e587453", "filename": "src/net/server/channel/handlers/UseItemHandler.java", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/UseItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/UseItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseItemHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -97,12 +97,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             \n             if(toUse.getItemId() != 2022153) {\n                 ii.getItemEffect(toUse.getItemId()).applyTo(chr);\n-                chr.checkBerserk(chr.isHidden());\n             } else {\n                 MapleStatEffect mse = ii.getItemEffect(toUse.getItemId());\n                 for(MapleCharacter player : chr.getMap().getCharacters()) {\n                     mse.applyTo(player);\n-                    player.checkBerserk(player.isHidden());\n                 }\n             }\n         }"}, {"sha": "bf9c3204350445e67904e365376c366cc9c1bb0e", "filename": "src/net/server/channel/handlers/UseMountFoodHandler.java", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/UseMountFoodHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/handlers/UseMountFoodHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseMountFoodHandler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -47,27 +47,27 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleMount mount = chr.getMount();\n         Item item = chr.getInventory(MapleInventoryType.USE).getItem(pos);\n         if (item != null && item.getItemId() == itemid && mount != null) {\n-            float healedFactor;\n             c.lockClient();\n             try {\n                 int curTiredness = mount.getTiredness();\n                 int healedTiredness = Math.min(curTiredness, 30);\n                 \n-                healedFactor = (float) healedTiredness / 30;\n+                float healedFactor = (float) healedTiredness / 30;\n                 mount.setTiredness(curTiredness - healedTiredness);\n-            } finally {\n-                c.unlockClient();\n-            }\n-            \n-            if (healedFactor > 0.0f) {\n-                mount.setExp(mount.getExp() + (int) Math.ceil(healedFactor * (2 * mount.getLevel() + 6)));\n-                int level = mount.getLevel();\n-                boolean levelup = mount.getExp() >= ExpTable.getMountExpNeededForLevel(level) && level < 31;\n-                if (levelup) {\n-                    mount.setLevel(level + 1);\n+                \n+                if (healedFactor > 0.0f) {\n+                    mount.setExp(mount.getExp() + (int) Math.ceil(healedFactor * (2 * mount.getLevel() + 6)));\n+                    int level = mount.getLevel();\n+                    boolean levelup = mount.getExp() >= ExpTable.getMountExpNeededForLevel(level) && level < 31;\n+                    if (levelup) {\n+                        mount.setLevel(level + 1);\n+                    }\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, levelup));\n                 }\n-                chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, levelup));\n+                \n                 MapleInventoryManipulator.removeById(c, MapleInventoryType.USE, itemid, 1, true, false);\n+            } finally {\n+                c.unlockClient();\n             }\n         }\n     }"}, {"sha": "5e47add6b5c6537e884bb931e4ab2b1c9bb1bcef", "filename": "src/net/server/channel/worker/BaseScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/BaseScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/BaseScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/BaseScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "7cb05450049c2501ebbe8db6f335621a0cfb369b", "filename": "src/net/server/channel/worker/EventScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/EventScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/EventScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/EventScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "6dd247020d77cf00224397c927284e14c4451c60", "filename": "src/net/server/channel/worker/FaceExpressionScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/FaceExpressionScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/FaceExpressionScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/FaceExpressionScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "ca22e9986a08496ac6b0f75c64480e8e7c155542", "filename": "src/net/server/channel/worker/MobAnimationScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobAnimationScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobAnimationScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/MobAnimationScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "0f95e4ccc9bd3b3c7e2c0c4bc6e2d4bd647e12c0", "filename": "src/net/server/channel/worker/MobClearSkillScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobClearSkillScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobClearSkillScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/MobClearSkillScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "eb0822e3b44bd297a878c8e2c38f9b4a196ff018", "filename": "src/net/server/channel/worker/MobMistScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobMistScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobMistScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/MobMistScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "42dd02102690106db1e5aa65622d8a177168c04b", "filename": "src/net/server/channel/worker/MobStatusScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobStatusScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/MobStatusScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/MobStatusScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "4b34c589da1e39364da6d7b1a6cea9957f05ff59", "filename": "src/net/server/channel/worker/OverallScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/OverallScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/OverallScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/OverallScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "8e910df12c837c4d4a0a1c3190d223420f0a31da", "filename": "src/net/server/channel/worker/SchedulerListener.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/SchedulerListener.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/channel/worker/SchedulerListener.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/SchedulerListener.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "97809e6787c57d0dfdf4af1f2813e35061e71837", "filename": "src/net/server/guild/MapleAlliance.java", "status": "modified", "additions": 46, "deletions": 11, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/guild/MapleAlliance.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/guild/MapleAlliance.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleAlliance.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -297,17 +297,52 @@ public static void disbandAlliance(int allianceId) {\n         }\n     }\n     \n-    public static void removeGuildFromAlliance(int allianceId, int guildId, int worldId) {\n-        MapleAlliance alliance = Server.getInstance().getAlliance(allianceId);\n-                \n-        Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.removeGuildFromAlliance(alliance, guildId, worldId), -1, -1);\n-        Server.getInstance().removeGuildFromAlliance(alliance.getId(), guildId);\n-\n-        Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.getGuildAlliances(alliance, worldId), -1, -1);\n-        Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.allianceNotice(alliance.getId(), alliance.getNotice()), -1, -1);\n-        Server.getInstance().guildMessage(guildId, MaplePacketCreator.disbandAlliance(alliance.getId()));\n-\n-        alliance.dropMessage(\"[\" + Server.getInstance().getGuild(guildId, worldId).getName() + \"] guild has left the union.\");\n+    private static void removeGuildFromAllianceOnDb(int guildId) {\n+        PreparedStatement ps = null;\n+        Connection con = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            \n+            ps = con.prepareStatement(\"DELETE FROM `allianceguilds` WHERE guildid = ?\");\n+            ps.setInt(1, guildId);\n+            ps.executeUpdate();\n+            ps.close();\n+            \n+            con.close();\n+        } catch (SQLException sqle) {\n+            sqle.printStackTrace();\n+        } finally {\n+            try {\n+                if (ps != null && !ps.isClosed()) {\n+                    ps.close();\n+                }\n+                if (con != null && !con.isClosed()) {\n+                    con.close();\n+                }\n+            } catch (SQLException ex) {\n+                ex.printStackTrace();\n+            }\n+        }\n+    }\n+    \n+    public static boolean removeGuildFromAlliance(int allianceId, int guildId, int worldId) {\n+        Server srv = Server.getInstance();\n+        MapleAlliance alliance = srv.getAlliance(allianceId);\n+    \n+        if (alliance.getLeader().getGuildId() == guildId) {\n+            return false;\n+        }\n+        \n+        srv.allianceMessage(alliance.getId(), MaplePacketCreator.removeGuildFromAlliance(alliance, guildId, worldId), -1, -1);\n+        srv.removeGuildFromAlliance(alliance.getId(), guildId);\n+        removeGuildFromAllianceOnDb(guildId);\n+        \n+        srv.allianceMessage(alliance.getId(), MaplePacketCreator.getGuildAlliances(alliance, worldId), -1, -1);\n+        srv.allianceMessage(alliance.getId(), MaplePacketCreator.allianceNotice(alliance.getId(), alliance.getNotice()), -1, -1);\n+        srv.guildMessage(guildId, MaplePacketCreator.disbandAlliance(alliance.getId()));\n+        \n+        alliance.dropMessage(\"[\" + srv.getGuild(guildId, worldId).getName() + \"] guild has left the union.\");\n+        return true;\n     }\n     \n     public void updateAlliancePackets(MapleCharacter chr) {"}, {"sha": "8d50395f9ab116d345631ef1dcf9dee33e6b10d8", "filename": "src/net/server/guild/MapleGuild.java", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/guild/MapleGuild.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/guild/MapleGuild.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleGuild.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -604,10 +604,9 @@ public void changeRankTitle(String[] ranks) {\n \n     public void disbandGuild() {\n         if(allianceId > 0) {\n-            MapleAlliance alliance = Server.getInstance().getAlliance(allianceId);\n-            \n-            if(alliance.getLeader().getGuildId() != id) MapleAlliance.removeGuildFromAlliance(allianceId, id, world);\n-            else MapleAlliance.disbandAlliance(allianceId);\n+            if (!MapleAlliance.removeGuildFromAlliance(allianceId, id, world)) {\n+                MapleAlliance.disbandAlliance(allianceId);\n+            }\n         }\n         \n         membersLock.lock();"}, {"sha": "e4b854c719ef73a5b9a3ec3819fd02333756c9bd", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -170,7 +170,7 @@ public World(int world, int flag, String eventmsg, int exprate, int droprate, in\n         runningPartyId.set(1);\n         runningMessengerId.set(1);\n         \n-        petUpdate = System.currentTimeMillis();\n+        petUpdate = Server.getInstance().getCurrentTime();\n         mountUpdate = petUpdate;\n         \n         for (int i = 0; i < 9; i++) {\n@@ -1303,7 +1303,7 @@ public void registerPetHunger(MapleCharacter chr, byte petSlot) {\n         activePetsLock.lock();\n         try {\n             int initProc;\n-            if(System.currentTimeMillis() - petUpdate > 55000) initProc = ServerConstants.PET_EXHAUST_COUNT - 2;\n+            if(Server.getInstance().getCurrentTime() - petUpdate > 55000) initProc = ServerConstants.PET_EXHAUST_COUNT - 2;\n             else initProc = ServerConstants.PET_EXHAUST_COUNT - 1;\n             \n             activePets.put(key, initProc);\n@@ -1328,7 +1328,7 @@ public void runPetSchedule() {\n         \n         activePetsLock.lock();\n         try {\n-            petUpdate = System.currentTimeMillis();\n+            petUpdate = Server.getInstance().getCurrentTime();\n             deployedPets = Collections.unmodifiableMap(activePets);\n         } finally {\n             activePetsLock.unlock();\n@@ -1362,7 +1362,7 @@ public void registerMountHunger(MapleCharacter chr) {\n         activeMountsLock.lock();\n         try {\n             int initProc;\n-            if(System.currentTimeMillis() - mountUpdate > 45000) initProc = ServerConstants.MOUNT_EXHAUST_COUNT - 2;\n+            if(Server.getInstance().getCurrentTime() - mountUpdate > 45000) initProc = ServerConstants.MOUNT_EXHAUST_COUNT - 2;\n             else initProc = ServerConstants.MOUNT_EXHAUST_COUNT - 1;\n             \n             activeMounts.put(key, initProc);\n@@ -1386,7 +1386,7 @@ public void runMountSchedule() {\n         Map<Integer, Integer> deployedMounts;\n         activeMountsLock.lock();\n         try {\n-            mountUpdate = System.currentTimeMillis();\n+            mountUpdate = Server.getInstance().getCurrentTime();\n             deployedMounts = Collections.unmodifiableMap(activeMounts);\n         } finally {\n             activeMountsLock.unlock();"}, {"sha": "5592d99d356456937600944fa55a979c8b814ab5", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 33, "deletions": 26, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -67,6 +67,7 @@\n import java.util.logging.Logger;\n import net.server.coordinator.MapleEventRecallCoordinator;\n import scripting.AbstractPlayerInteraction;\n+import scripting.event.worker.EventScriptScheduler;\n import server.MapleItemInformationProvider;\n import server.life.MapleLifeFactory;\n import server.life.MapleNPC;\n@@ -83,6 +84,7 @@\n \tprivate List<MapleMonster> mobs = new LinkedList<>();\n \tprivate Map<MapleCharacter, Integer> killCount = new HashMap<>();\n \tprivate EventManager em;\n+        private EventScriptScheduler ess;\n \tprivate MapleMapFactory mapFactory;\n \tprivate String name;\n \tprivate Properties props = new Properties();\n@@ -124,6 +126,7 @@\n \tpublic EventInstanceManager(EventManager em, String name) {\n \t\tthis.em = em;\n \t\tthis.name = name;\n+                this.ess = new EventScriptScheduler();\n \t\tmapFactory = new MapleMapFactory(this, MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Map.wz\")), MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/String.wz\")), (byte) 0, (byte) 1);//Fk this\n \t\tmapFactory.setChannel(em.getChannelServer().getId());\n \t}\n@@ -553,9 +556,7 @@ public void playerKilled(MapleCharacter chr) {\n                         } finally {\n                                 sL.unlock();\n                         }\n-\t\t} catch (ScriptException | NoSuchMethodException ex) {\n-\t\t\tex.printStackTrace();\n-\t\t}\n+\t\t} catch (ScriptException | NoSuchMethodException ex) {} // optional\n \t}\n \n         public void reviveMonster(MapleMonster mob) {\n@@ -583,9 +584,8 @@ public boolean revivePlayer(MapleCharacter chr) {\n \t\t\tif (b instanceof Boolean) {\n \t\t\t\treturn (Boolean) b;\n \t\t\t}\n-\t\t} catch (ScriptException | NoSuchMethodException ex) {\n-\t\t\tex.printStackTrace();\n-\t\t}\n+\t\t} catch (ScriptException | NoSuchMethodException ex) {} // optional\n+                \n \t\treturn true;\n \t}\n         \n@@ -674,12 +674,15 @@ public synchronized void dispose(boolean shutdown) {    // should not trigger an\n                 }\n \n                 mapFactory.dispose();\n+                ess.dispose();\n+                \n                 wL.lock();\n                 try {\n                         for(MapleCharacter chr: chars.values()) chr.setEventInstance(null);\n                         chars.clear();\n                         mobs.clear();\n                         mapFactory = null;\n+                        ess = null;\n                 } finally {\n                         wL.unlock();\n                 }\n@@ -725,27 +728,31 @@ public MapleMapFactory getMapFactory() {\n \t}\n \n \tpublic void schedule(final String methodName, long delay) {\n-                List<MapleCharacter> chrList = this.getPlayerList();\n-                int mapid = !chrList.isEmpty() ? chrList.get(0).getMapId() : 0;\n-                \n-                Runnable r = new Runnable() {\n-\t\t\t@Override\n-\t\t\tpublic void run() {\n-\t\t\t\ttry {\n-                                        sL.lock();\n-                                        try {\n-                                               if(em == null) return;\n-                                               em.getIv().invokeFunction(methodName, EventInstanceManager.this);\n-                                        } finally {\n-                                                sL.unlock();\n+                rL.lock();\n+                try {\n+                        if (ess != null) {\n+                                Runnable r = new Runnable() {\n+                                        @Override\n+                                        public void run() {\n+                                                try {\n+                                                        sL.lock();\n+                                                        try {\n+                                                               if(em == null) return;\n+                                                               em.getIv().invokeFunction(methodName, EventInstanceManager.this);\n+                                                        } finally {\n+                                                                sL.unlock();\n+                                                        }\n+                                                } catch (ScriptException | NoSuchMethodException ex) {\n+                                                        ex.printStackTrace();\n+                                                }\n                                         }\n-\t\t\t\t} catch (ScriptException | NoSuchMethodException ex) {\n-\t\t\t\t\tex.printStackTrace();\n-\t\t\t\t}\n-\t\t\t}\n-\t\t};\n-                \n-                getEm().getChannelServer().registerEventAction(mapid, r, delay);\n+                                };\n+\n+                                ess.registerEntry(r, delay);\n+                        }\n+                } finally {\n+                        rL.unlock();\n+                }\n \t}\n \n \tpublic String getName() {"}, {"sha": "286997cd2e351702b089976b22cb6e3a923a0f2e", "filename": "src/scripting/event/EventManager.java", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -101,6 +101,10 @@ public EventManager(Channel cserv, Invocable iv, String name) {\n         for(int i = 0; i < maxLobbys; i++) this.openedLobbys.add(false);\n     }\n \n+    private boolean isDisposed() {\n+        return onLoadInstances <= -1000;\n+    }\n+    \n     public void cancel() {  // make sure to only call this when there are NO PLAYERS ONLINE to mess around with the event manager!\n         ess.dispose();\n         \n@@ -342,6 +346,8 @@ public boolean startInstance(int lobbyId, MapleExpedition exped) {\n \n     //Expedition method: starts an expedition\n     public boolean startInstance(int lobbyId, MapleExpedition exped, MapleCharacter leader) {\n+        if (this.isDisposed()) return false;\n+        \n         try {\n             if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n                 playerPermit.add(leader.getId());\n@@ -399,6 +405,8 @@ public boolean startInstance(int lobbyId, MapleCharacter leader) {\n     }\n     \n     public boolean startInstance(int lobbyId, MapleCharacter chr, MapleCharacter leader, int difficulty) {\n+        if (this.isDisposed()) return false;\n+        \n         try {\n             if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n                 playerPermit.add(leader.getId());\n@@ -459,6 +467,8 @@ public boolean startInstance(int lobbyId, MapleParty party, MapleMap map) {\n     }\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, MapleCharacter leader) {\n+        if (this.isDisposed()) return false;\n+        \n         try {\n             if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n                 playerPermit.add(leader.getId());\n@@ -516,6 +526,8 @@ public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, int di\n     }\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, int difficulty, MapleCharacter leader) {\n+        if (this.isDisposed()) return false;\n+        \n         try {\n             if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n                 playerPermit.add(leader.getId());\n@@ -577,6 +589,8 @@ public boolean startInstance(int lobbyId, EventInstanceManager eim, String ldr)\n     }\n     \n     public boolean startInstance(int lobbyId, EventInstanceManager eim, String ldr, MapleCharacter leader) {\n+        if (this.isDisposed()) return false;\n+        \n         try {\n             if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n                 playerPermit.add(leader.getId());\n@@ -811,7 +825,7 @@ private void instantiateQueuedInstance() {\n         int nextEventId;\n         queueLock.lock();\n         try {\n-            if(onLoadInstances <= -1000 || readyInstances.size() + onLoadInstances >= Math.ceil((double)maxLobbys / 3.0)) return;\n+            if (this.isDisposed() || readyInstances.size() + onLoadInstances >= Math.ceil((double)maxLobbys / 3.0)) return;\n             \n             onLoadInstances++;\n             nextEventId = readyId;\n@@ -823,7 +837,7 @@ private void instantiateQueuedInstance() {\n         EventInstanceManager eim = new EventInstanceManager(this, \"sampleName\" + nextEventId);\n         queueLock.lock();\n         try {\n-            if(onLoadInstances <= -1000) {  // EM already disposed\n+            if (this.isDisposed()) {  // EM already disposed\n                 return;\n             }\n             "}, {"sha": "c653a17f6117f760064c9fcd44d525109926f73b", "filename": "src/scripting/event/EventScheduledFuture.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventScheduledFuture.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventScheduledFuture.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventScheduledFuture.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "56c05d5f6a2bbe6f7881f177ce96cd26446e82c7", "filename": "src/scripting/event/EventScriptManager.java", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/EventScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventScriptManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,6 +23,7 @@\n \n import java.util.LinkedHashMap;\n import java.util.Map;\n+import java.util.Map.Entry;\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n@@ -37,6 +38,7 @@\n  * @author Matze\n  */\n public class EventScriptManager extends AbstractScriptManager {\n+    \n     private class EventEntry {\n         public EventEntry(Invocable iv, EventManager em) {\n             this.iv = iv;\n@@ -77,8 +79,20 @@ public void init() {\n         }\n     }\n     \n-    public void reload(){\n+    private void reloadScripts() {\n+        if (events.isEmpty()) return;\n+        \n+        Channel cserv = events.values().iterator().next().em.getChannelServer();\n+        for (Entry<String, EventEntry> entry : events.entrySet()) {\n+            String script = entry.getKey();\n+            Invocable iv = getInvocable(\"event/\" + script + \".js\", null);\n+            events.put(script, new EventEntry(iv, new EventManager(cserv, iv, script)));\n+        }\n+    }\n+    \n+    public void reload() {\n     \tcancel();\n+        reloadScripts();\n     \tinit();\n     }\n "}, {"sha": "02e4cde6dbba8ee74512da8e29f040c0d1e1b8c9", "filename": "src/scripting/event/worker/EventScriptScheduler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/worker/EventScriptScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/event/worker/EventScriptScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/worker/EventScriptScheduler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft 2016 - 2018 RonanLana\n+    Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as"}, {"sha": "9dcc75aa4fb609a753b58192500aa6a7a0e05e34", "filename": "src/scripting/reactor/ReactorActionManager.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/reactor/ReactorActionManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/reactor/ReactorActionManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/reactor/ReactorActionManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -288,6 +288,7 @@ public void spawnFakeMonster(int id) {\n \n     public ScheduledFuture<?> schedule(final String methodName, final EventInstanceManager eim, long delay) {\n         return TimerManager.getInstance().schedule(new Runnable() {\n+            @Override\n             public void run() {\n                 try {\n                     iv.invokeFunction(methodName, eim);\n@@ -300,6 +301,7 @@ public void run() {\n \n     public ScheduledFuture<?> scheduleAtTimestamp(final String methodName, long timestamp) {\n         return TimerManager.getInstance().scheduleAtTimestamp(new Runnable() {\n+            @Override\n             public void run() {\n                 try {\n                     iv.invokeFunction(methodName, (Object) null);"}, {"sha": "45e61feed0c2560582e7442ea0678ac7226c0092", "filename": "src/scripting/reactor/ReactorScriptManager.java", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/reactor/ReactorScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/scripting/reactor/ReactorScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/reactor/ReactorScriptManager.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -58,10 +58,9 @@ public void onHit(MapleClient c, MapleReactor reactor) {\n             ReactorActionManager rm = new ReactorActionManager(c, reactor, iv);\n             engine.put(\"rm\", rm);\n             iv.invokeFunction(\"hit\");\n-        } catch(final NoSuchMethodException e) {\n-            //do nothing, hit is OPTIONAL\n-        }\n-        catch (final ScriptException | NullPointerException e) {\n+        } catch (final NoSuchMethodException e) {} //do nothing, hit is OPTIONAL\n+        \n+          catch (final ScriptException | NullPointerException e) {\n             FilePrinter.printError(FilePrinter.REACTOR + reactor.getId() + \".txt\", e);\n         }\n     }"}, {"sha": "99c6eda687beb825e20525bdc81242cde6d16593", "filename": "src/server/MakerItemFactory.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MakerItemFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MakerItemFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MakerItemFactory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -71,7 +71,7 @@ public static MakerItemCreateEntry generateDisassemblyCrystalEntry(int cost, int\n     private static double getMakerStimulantFee(int itemid) {\n         if(ServerConstants.USE_MAKER_FEE_HEURISTICS) {\n             EquipType et = EquipType.getEquipTypeById(itemid);\n-            int eqpLevel = ii.getEquipStats(itemid).get(\"reqLevel\");\n+            int eqpLevel = ii.getEquipLevelReq(itemid);\n \n             switch(et) {\n                 case CAP:\n@@ -106,7 +106,7 @@ private static double getMakerStimulantFee(int itemid) {\n     private static double getMakerReagentFee(int itemid, int reagentLevel) {\n         if(ServerConstants.USE_MAKER_FEE_HEURISTICS) {\n             EquipType et = EquipType.getEquipTypeById(itemid);\n-            int eqpLevel = ii.getEquipStats(itemid).get(\"reqLevel\");\n+            int eqpLevel = ii.getEquipLevelReq(itemid);\n \n             switch(et) {\n                 case CAP:"}, {"sha": "6c2929ccb89504642da0c66ac7e2f41313b96b40", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 23, "deletions": 5, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -98,6 +98,7 @@ public static MapleItemInformationProvider getInstance() {\n     protected Map<Integer, Map<String, Integer>> equipStatsCache = new HashMap<>();\n     protected Map<Integer, Equip> equipCache = new HashMap<>();\n     protected Map<Integer, MapleData> equipLevelInfoCache = new HashMap<>();\n+    protected Map<Integer, Integer> equipLevelReqCache = new HashMap<>();\n     protected Map<Integer, Integer> equipMaxLevelCache = new HashMap<>();\n     protected Map<Integer, Integer> wholePriceCache = new HashMap<>();\n     protected Map<Integer, Double> unitPriceCache = new HashMap<>();\n@@ -598,6 +599,24 @@ protected String getEquipmentSlot(int itemId) {\n         equipStatsCache.put(itemId, ret);\n         return ret;\n     }\n+    \n+    public Integer getEquipLevelReq(int itemId) {\n+        if (equipLevelReqCache.containsKey(itemId)) {\n+            return equipLevelReqCache.get(itemId);\n+        }\n+        \n+        int ret = 0;\n+        MapleData item = getItemData(itemId);\n+        if (item != null) {\n+            MapleData info = item.getChildByPath(\"info\");\n+            if (info != null) {\n+                ret = MapleDataTool.getInt(\"reqLevel\", info, 0);\n+            }\n+        }\n+        \n+        equipLevelReqCache.put(itemId, ret);\n+        return ret;\n+    }\n \n     public List<Integer> getScrollReqs(int itemId) {\n         List<Integer> ret = new ArrayList<>();\n@@ -1570,7 +1589,7 @@ public boolean isUpgradeable(int itemId) {\n         }\n         for (Item item : items) {\n             Equip equip = (Equip) item;\n-            int reqLevel = getEquipStats(equip.getItemId()).get(\"reqLevel\");\n+            int reqLevel = getEquipLevelReq(equip.getItemId());\n             if (highfivestamp) {\n                 reqLevel -= 5;\n                 if (reqLevel < 0) {\n@@ -1645,7 +1664,7 @@ public boolean canWearEquipment(MapleCharacter chr, Equip equip, int dst) {\n             ex.printStackTrace();\n          }*/\n        \n-        int reqLevel = getEquipStats(equip.getItemId()).get(\"reqLevel\");\n+        int reqLevel = getEquipLevelReq(equip.getItemId());\n         if (highfivestamp) {\n             reqLevel -= 5;\n         }\n@@ -1922,8 +1941,7 @@ public MakerItemCreateEntry getMakerItemEntry(int toCreate) {\n     \n     public int getMakerCrystalFromEquip(Integer equipId) {\n         try {\n-            Map<String, Integer> stats = getEquipStats(equipId);\n-            return getCrystalForLevel(stats.get(\"reqLevel\"));\n+            return getCrystalForLevel(getEquipLevelReq(equipId));\n         } catch (Exception e) {\n             e.printStackTrace();\n         }\n@@ -1933,7 +1951,7 @@ public int getMakerCrystalFromEquip(Integer equipId) {\n     \n     public int getMakerStimulantFromEquip(Integer equipId) {\n         try {\n-            return getCrystalForLevel(getEquipStats(equipId).get(\"reqLevel\"));\n+            return getCrystalForLevel(getEquipLevelReq(equipId));\n         } catch (Exception e) {\n             e.printStackTrace();\n         }"}, {"sha": "9116b4d90a2a5daa0cf74c1de9f4df939be63e9b", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 18, "deletions": 42, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -708,7 +708,7 @@ public void applyPassive(MapleCharacter applyto, MapleMapObject obj, int attack)\n                         if (absorbMp > 0) {\n                             mob.setMp(mob.getMp() - absorbMp);\n                             applyto.addMP(absorbMp);\n-                            applyto.getClient().announce(MaplePacketCreator.showOwnBuffEffect(sourceid, 1));\n+                            applyto.announce(MaplePacketCreator.showOwnBuffEffect(sourceid, 1));\n                             applyto.getMap().broadcastMessage(applyto, MaplePacketCreator.showBuffeffect(applyto.getId(), sourceid, 1), false);\n                         }\n                     }\n@@ -745,14 +745,14 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n         if (primary) {\n             if (itemConNo != 0) {\n                 if(!applyto.getClient().getAbstractPlayerInteraction().hasItem(itemCon, itemConNo)) {\n-                    applyto.getClient().announce(MaplePacketCreator.enableActions());\n+                    applyto.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }\n                 MapleInventoryManipulator.removeById(applyto.getClient(), ItemConstants.getInventoryType(itemCon), itemCon, itemConNo, false, true);\n             }\n         } else {\n-            if(isResurrection()) {\n-                hpchange = applyto.getMaxHp();\n+            if (isResurrection()) {\n+                hpchange = applyto.getCurrentMaxHp();\n                 applyto.setStance(0);\n                 \n                 applyto.getMap().broadcastMessage(applyto, MaplePacketCreator.removePlayerFromMap(applyto.getId()), false);\n@@ -773,38 +773,11 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n          AutobanFactory.MPCON.addPoint(applyfrom.getAutobanManager(), \"mpCon hack for skill:\" + sourceid + \"; Player MP: \" + applyto.getMp() + \" MP Needed: \" + getMpCon());\n          } */\n         \n-        List<Pair<MapleStat, Integer>> hpmpupdate = new ArrayList<>(2);\n-        if (hpchange != 0) {\n-            if (hpchange < 0 && (-hpchange) >= applyto.getHp() && (!applyto.hasDisease(MapleDisease.ZOMBIFY) || hpCon > 0)) {\n-                if(!applyto.isGM()) {\n-                    applyto.getClient().announce(MaplePacketCreator.enableActions());\n-                    return false;\n-                }\n-            }\n-            int newHp = applyto.getHp() + hpchange;\n-            if (newHp < 1) {\n-                newHp = 1;\n-            }\n-            applyto.setHp(newHp);\n-            hpmpupdate.add(new Pair<>(MapleStat.HP, Integer.valueOf(applyto.getHp())));\n+        if (!applyto.applyHpMpChange(hpCon, hpchange, mpchange)) {\n+            applyto.announce(MaplePacketCreator.enableActions());\n+            return false;\n         }\n         \n-        if (mpchange != 0) {\n-            int newMp = applyto.getMp() + mpchange;\n-            if (mpchange < 0 && -mpchange > applyto.getMp()) {\n-                if(!applyto.isGM()) {\n-                    applyto.getClient().announce(MaplePacketCreator.enableActions());\n-                    return false;\n-                }\n-                else {\n-                    newMp = 0;\n-                }\n-            }\n-\n-            applyto.setMp(newMp);\n-            hpmpupdate.add(new Pair<>(MapleStat.MP, Integer.valueOf(applyto.getMp())));\n-        }\n-        applyto.getClient().announce(MaplePacketCreator.updatePlayerStats(hpmpupdate, true, applyto));\n         if (moveTo != -1) {\n             if (moveTo != applyto.getMapId()) {\n                 MapleMap target;\n@@ -835,7 +808,6 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n             } else {\n                 return false;\n             }\n-\n         }\n         if (isShadowClaw()) {\n             int projectile = 0;\n@@ -858,8 +830,13 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n         SummonMovementType summonMovementType = getSummonMovementType();\n         if (overTime || isCygnusFA() || summonMovementType != null) {\n             if (summonMovementType != null && pos != null) {\n-                if(summonMovementType.getValue() == summonMovementType.STATIONARY.getValue()) applyto.cancelBuffStats(MapleBuffStat.PUPPET);\n-                else applyto.cancelBuffStats(MapleBuffStat.SUMMON);\n+                if(summonMovementType.getValue() == summonMovementType.STATIONARY.getValue()) {\n+                    applyto.cancelBuffStats(MapleBuffStat.PUPPET);\n+                } else {\n+                    applyto.cancelBuffStats(MapleBuffStat.SUMMON);\n+                }\n+                \n+                applyto.announce(MaplePacketCreator.enableActions());\n             }\n             \n             applyBuffEffect(applyfrom, applyto, primary);\n@@ -951,7 +928,7 @@ private int applyBuff(MapleCharacter applyfrom, boolean useMaxRange) {\n             affectedc += affectedp.size();   // used for heal\n             for (MapleCharacter affected : affectedp) {\n                 applyTo(applyfrom, affected, false, null, useMaxRange, affectedc);\n-                affected.getClient().announce(MaplePacketCreator.showOwnBuffEffect(sourceid, 2));\n+                affected.announce(MaplePacketCreator.showOwnBuffEffect(sourceid, 2));\n                 affected.getMap().broadcastMessage(affected, MaplePacketCreator.showBuffeffect(affected.getId(), sourceid, 2), false);\n             }\n         }\n@@ -1186,7 +1163,7 @@ private int calcHPChange(MapleCharacter applyfrom, boolean primary, int affected\n                     hpchange /= 2;\n                 }\n             } else { // assumption: this is heal\n-                float hpHeal = (applyfrom.getMaxHpEquipped() * (float) hp / (100.0f * affectedPlayers));\n+                float hpHeal = (applyfrom.getCurrentMaxHp() * (float) hp / (100.0f * affectedPlayers));\n                 hpchange += hpHeal;\n                 if (applyfrom.hasDisease(MapleDisease.ZOMBIFY)) {\n                     hpchange = -hpchange;\n@@ -1196,7 +1173,6 @@ private int calcHPChange(MapleCharacter applyfrom, boolean primary, int affected\n         }\n         if (hpR != 0) {\n             hpchange += (int) (applyfrom.getCurrentMaxHp() * hpR) / (applyfrom.hasDisease(MapleDisease.ZOMBIFY) ? 2 : 1);\n-            applyfrom.checkBerserk(applyfrom.isHidden());\n         }\n         if (primary) {\n             if (hpCon != 0) {\n@@ -1206,7 +1182,7 @@ private int calcHPChange(MapleCharacter applyfrom, boolean primary, int affected\n         if (isChakra()) {\n             hpchange += makeHealHP(getY() / 100.0, applyfrom.getTotalLuk(), 2.3, 3.5);\n         } else if (sourceid == SuperGM.HEAL_PLUS_DISPEL) {\n-            hpchange += (applyfrom.getMaxHp() - applyfrom.getHp());\n+            hpchange += applyfrom.getCurrentMaxHp();\n         }\n \n         return hpchange;\n@@ -1250,7 +1226,7 @@ private int calcMPChange(MapleCharacter applyfrom, boolean primary) {\n             }\n         }\n         if (sourceid == SuperGM.HEAL_PLUS_DISPEL) {\n-            mpchange += (applyfrom.getMaxMp() - applyfrom.getMp());\n+            mpchange += applyfrom.getCurrentMaxMp();\n         }\n \n         return mpchange;"}, {"sha": "072fd5f689d51116d3a93197528650a1983685ea", "filename": "src/server/life/MapleLifeFactory.java", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleLifeFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleLifeFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleLifeFactory.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -132,12 +132,16 @@ public static MapleMonster getMonster(int mid) {\n                     stats.setRevives(revives);\n                 }\n                 decodeElementalString(stats, MapleDataTool.getString(\"elemAttr\", monsterInfoData, \"\"));\n+                \n+                MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n                 MapleData monsterSkillInfoData = monsterInfoData.getChildByPath(\"skill\");\n                 if (monsterSkillInfoData != null) {\n                     int i = 0;\n                     List<Pair<Integer, Integer>> skills = new ArrayList<>();\n                     while (monsterSkillInfoData.getChildByPath(Integer.toString(i)) != null) {\n-                        skills.add(new Pair<>(Integer.valueOf(MapleDataTool.getInt(i + \"/skill\", monsterSkillInfoData, 0)), Integer.valueOf(MapleDataTool.getInt(i + \"/level\", monsterSkillInfoData, 0))));\n+                        int skillId = MapleDataTool.getInt(i + \"/skill\", monsterSkillInfoData, 0);\n+                        int skillLv = MapleDataTool.getInt(i + \"/level\", monsterSkillInfoData, 0);\n+                        skills.add(new Pair<>(skillId, skillLv));\n                         \n                         MapleData monsterSkillData = monsterData.getChildByPath(\"skill\" + (i + 1));\n                         if (monsterSkillData != null) {\n@@ -146,7 +150,8 @@ public static MapleMonster getMonster(int mid) {\n                                 animationTime += MapleDataTool.getIntConvert(\"delay\", effectEntry, 0);\n                             }\n                             \n-                            MapleMonsterInformationProvider.getInstance().setMobSkillAnimationTime(mid, i, animationTime);\n+                            MobSkill skill = MobSkillFactory.getMobSkill(skillId, skillLv);\n+                            mi.setMobSkillAnimationTime(skill, animationTime);\n                         }\n                         \n                         i++;\n@@ -162,7 +167,10 @@ public static MapleMonster getMonster(int mid) {\n                         animationTime += MapleDataTool.getIntConvert(\"delay\", effectEntry, 0);\n                     }\n \n-                    MapleMonsterInformationProvider.getInstance().setMobAttackAnimationTime(mid, i, animationTime);\n+                    int mpCon = MapleDataTool.getIntConvert(\"info/conMP\", monsterAttackData, 0);\n+                    int coolTime = MapleDataTool.getIntConvert(\"info/attackAfter\", monsterAttackData, 0);\n+                    mi.setMobAttackInfo(mid, i, mpCon, coolTime);\n+                    mi.setMobAttackAnimationTime(mid, i, animationTime);\n                     i++;\n                 }\n                 "}, {"sha": "4f7ab8fa3864015a23dac7e08a7df69dbc08d0cb", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 95, "deletions": 30, "changes": 125, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -79,7 +79,6 @@\n     private AtomicInteger hp = new AtomicInteger(1);\n     private AtomicLong maxHpPlusHeal = new AtomicLong(1);\n     private int mp;\n-    private long nextBasicSkillTime;\n     private WeakReference<MapleCharacter> controller = new WeakReference<>(null);\n     private boolean controllerHasAggro, controllerKnowsAboutAggro;\n     private Collection<MonsterListener> listeners = new LinkedList<>();\n@@ -91,6 +90,7 @@\n     private boolean dropsDisabled = false;\n     private List<Pair<Integer, Integer>> usedSkills = new ArrayList<>();\n     private Map<Pair<Integer, Integer>, Integer> skillsUsed = new HashMap<>();\n+    private Set<Integer> usedAttacks = new HashSet<>();\n     private List<Integer> stolenItems = new ArrayList<>();\n     private int team;\n     private int parentMobOid = 0;\n@@ -240,16 +240,16 @@ public void setHpZero() {     // force HP = 0\n         applyAndGetHpDamage(Integer.MAX_VALUE, false);\n     }\n     \n-    public boolean applyAnimationIfRoaming(int attackPos, int skillPos) {   // roam: not casting attack or skill animations\n+    private boolean applyAnimationIfRoaming(int attackPos, MobSkill skill) {   // roam: not casting attack or skill animations\n         if(!animationLock.tryLock()) return false;\n     \n         try {\n             long animationTime;\n         \n-            if(skillPos < 0) {\n+            if(skill == null) {\n                 animationTime = MapleMonsterInformationProvider.getInstance().getMobAttackAnimationTime(this.getId(), attackPos);\n             } else {\n-                animationTime = MapleMonsterInformationProvider.getInstance().getMobSkillAnimationTime(this.getId(), skillPos);\n+                animationTime = MapleMonsterInformationProvider.getInstance().getMobSkillAnimationTime(skill);\n             }\n \n             if(animationTime > 0) {\n@@ -1238,54 +1238,69 @@ public MapleMap getMap() {\n     public boolean hasSkill(int skillId, int level) {\n         return stats.hasSkill(skillId, level);\n     }\n-\n+    \n     public boolean canUseSkill(MobSkill toUse) {\n         if (toUse == null) {\n             return false;\n         }\n         \n-        monsterLock.lock();\n-        try {\n-            for (Pair<Integer, Integer> skill : usedSkills) {\n-                if (skill.getLeft() == toUse.getSkillId() && skill.getRight() == toUse.getSkillLevel()) {\n-                    return false;\n+        if (toUse.getSkillId() == 200) {\n+            int i = 0;\n+            for (MapleMapObject mo : getMap().getMapObjects()) {\n+                if (mo.getType() == MapleMapObjectType.MONSTER) {\n+                    i++;\n                 }\n             }\n-        } finally {\n-            monsterLock.unlock();\n+            if (i > 100) {\n+                return false;\n+            }\n         }\n         \n         if (toUse.getLimit() > 0) {\n             monsterLock.lock();\n             try {\n-                if (this.skillsUsed.containsKey(new Pair<>(toUse.getSkillId(), toUse.getSkillLevel()))) {\n-                    int times = this.skillsUsed.get(new Pair<>(toUse.getSkillId(), toUse.getSkillLevel()));\n-                    if (times >= toUse.getLimit()) {\n-                        return false;\n-                    }\n+                Integer times = this.skillsUsed.get(new Pair<>(toUse.getSkillId(), toUse.getSkillLevel()));\n+                if (times != null && times >= toUse.getLimit()) {\n+                    return false;\n                 }\n             } finally {\n                 monsterLock.unlock();\n             }\n         }\n-        if (toUse.getSkillId() == 200) {\n-            Collection<MapleMapObject> mmo = getMap().getMapObjects();\n-            int i = 0;\n-            for (MapleMapObject mo : mmo) {\n-                if (mo.getType() == MapleMapObjectType.MONSTER) {\n-                    i++;\n+        \n+        monsterLock.lock();\n+        try {\n+            for (Pair<Integer, Integer> skill : usedSkills) {\n+                if (skill.getLeft() == toUse.getSkillId() && skill.getRight() == toUse.getSkillLevel()) {\n+                    return false;\n                 }\n             }\n-            if (i > 100) {\n+            \n+            int mpCon = toUse.getMpCon();\n+            if (mp < mpCon) {\n+                return false;\n+            }\n+            \n+            if (!this.applyAnimationIfRoaming(-1, toUse)) {\n                 return false;\n             }\n+            \n+            this.usedSkill(toUse);\n+        } finally {\n+            monsterLock.unlock();\n         }\n+        \n         return true;\n     }\n \n-    public void usedSkill(final int skillId, final int level, long cooltime) {\n+    private void usedSkill(MobSkill skill) {\n+        final int skillId = skill.getSkillId(), level = skill.getSkillLevel();\n+        long cooltime = skill.getCoolTime();\n+        \n         monsterLock.lock();\n         try {\n+            mp -= skill.getMpCon();\n+            \n             this.usedSkills.add(new Pair<>(skillId, level));\n             if (this.skillsUsed.containsKey(new Pair<>(skillId, level))) {\n                 int times = this.skillsUsed.get(new Pair<>(skillId, level)) + 1;\n@@ -1310,7 +1325,7 @@ public void run() {\n         mmap.getChannelServer().registerMobClearSkillAction(mmap.getId(), r, cooltime);\n     }\n \n-    public void clearSkill(int skillId, int level) {\n+    private void clearSkill(int skillId, int level) {\n         monsterLock.lock();\n         try {\n             int index = -1;\n@@ -1327,13 +1342,63 @@ public void clearSkill(int skillId, int level) {\n             monsterLock.unlock();\n         }\n     }\n+    \n+    public int canUseAttack(int attackPos) {\n+        monsterLock.lock();\n+        try {\n+            if (usedAttacks.contains(attackPos)) {\n+                return -1;\n+            }\n+            \n+            Pair<Integer, Integer> attackInfo = MapleMonsterInformationProvider.getInstance().getMobAttackInfo(this.getId(), attackPos);\n+            if (attackInfo == null) {\n+                return usedAttacks.isEmpty() ? 0 : -1;\n+            }\n+            \n+            int mpCon = attackInfo.getLeft();\n+            if (mp < mpCon) {\n+                return -1;\n+            }\n+            \n+            if (!this.applyAnimationIfRoaming(attackPos, null)) {\n+                return -1;\n+            }\n+            \n+            usedAttack(attackPos, mpCon, attackInfo.getRight());\n+            return 1;\n+        } finally {\n+            monsterLock.unlock();\n+        }\n+    }\n+    \n+    private void usedAttack(final int attackPos, int mpCon, int cooltime) {\n+        monsterLock.lock();\n+        try {\n+            mp -= mpCon;\n+            usedAttacks.add(attackPos);\n+\n+            final MapleMonster mons = this;\n+            MapleMap mmap = mons.getMap();\n+            Runnable r = new Runnable() {\n+                @Override\n+                public void run() {\n+                    mons.clearAttack(attackPos);\n+                }\n+            };\n \n-    public long getNextBasicSkillTime() {\n-        return nextBasicSkillTime;\n+            mmap.getChannelServer().registerMobClearSkillAction(mmap.getId(), r, cooltime);\n+        } finally {\n+            monsterLock.unlock();\n+        }\n     }\n     \n-    public void setNextBasicSkillTime(long time) {\n-        nextBasicSkillTime = time + 4200;\n+    private void clearAttack(int attackPos) {\n+        monsterLock.lock();\n+        try {\n+            usedAttacks.remove(attackPos);\n+        } finally {\n+            monsterLock.unlock();\n+        }\n     }\n     \n     public int getNoSkills() {"}, {"sha": "8b29fb56aa47c7c04f08d019f2841d0d8fad2c8d", "filename": "src/server/life/MapleMonsterInformationProvider.java", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleMonsterInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MapleMonsterInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterInformationProvider.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -60,7 +60,9 @@ public static MapleMonsterInformationProvider getInstance() {\n         private final Map<Integer, List<MonsterDropEntry>> extraMultiEquipDrops = new HashMap<>();\n         \n         private final Map<Pair<Integer, Integer>, Integer> mobAttackAnimationTime = new HashMap<>();\n-        private final Map<Pair<Integer, Integer>, Integer> mobSkillAnimationTime = new HashMap<>();\n+        private final Map<MobSkill, Integer> mobSkillAnimationTime = new HashMap<>();\n+        \n+        private final Map<Integer, Pair<Integer, Integer>> mobAttackInfo = new HashMap<>();\n \n \tprotected MapleMonsterInformationProvider() {\n \t\tretrieveGlobal();\n@@ -237,14 +239,23 @@ public final Integer getMobAttackAnimationTime(int monsterId, int attackPos) {\n                 return time == null ? 0 : time;\n         }\n         \n-        public final void setMobSkillAnimationTime(int monsterId, int skillPos, int animationTime) {\n-                mobSkillAnimationTime.put(new Pair<>(monsterId, skillPos), animationTime);\n+        public final void setMobSkillAnimationTime(MobSkill skill, int animationTime) {\n+                mobSkillAnimationTime.put(skill, animationTime);\n         }\n         \n-        public final Integer getMobSkillAnimationTime(int monsterId, int skillPos) {\n-                Integer time = mobSkillAnimationTime.get(new Pair<>(monsterId, skillPos));\n+        public final Integer getMobSkillAnimationTime(MobSkill skill) {\n+                Integer time = mobSkillAnimationTime.get(skill);\n                 return time == null ? 0 : time;\n         }\n+        \n+        public final void setMobAttackInfo(int monsterId, int attackPos, int mpCon, int coolTime) {\n+                mobAttackInfo.put((monsterId << 3) + attackPos, new Pair<>(mpCon, coolTime));\n+        }\n+        \n+        public final Pair<Integer, Integer> getMobAttackInfo(int monsterId, int attackPos) {\n+                if (attackPos < 0 || attackPos > 7) return null;\n+                return mobAttackInfo.get((monsterId << 3) + attackPos);\n+        }\n \n \tpublic static ArrayList<Pair<Integer, String>> getMobsIDsFromName(String search) {\n \t\tMapleDataProvider dataProvider = MapleDataProviderFactory.getDataProvider(new File(\"wz/String.wz\"));"}, {"sha": "40397c234f8ab5540dfde57416c388bb3cadb6cd", "filename": "src/server/life/MobSkill.java", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MobSkill.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/life/MobSkill.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MobSkill.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -323,8 +323,6 @@ public void applyEffect(MapleCharacter player, MapleMonster monster, boolean ski\n                 player.giveDebuff(disease, this);\n             }\n         }\n-        monster.usedSkill(skillId, skillLevel, cooltime);\n-        monster.setMp(monster.getMp() - getMpCon());\n     }\n \n     private List<MapleCharacter> getPlayersInRange(MapleMonster monster, MapleCharacter player) {"}, {"sha": "66f1bc86781c0b595fa5dca509d71a039433a6a2", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -861,7 +861,7 @@ private synchronized void instantiateItemDrop(MapleMapItem mdrop) {\n     }\n     \n     private void registerItemDrop(MapleMapItem mdrop) {\n-        droppedItems.put(mdrop, !everlast ? System.currentTimeMillis() + ServerConstants.ITEM_EXPIRE_TIME : Long.MAX_VALUE);\n+        droppedItems.put(mdrop, !everlast ? Server.getInstance().getCurrentTime() + ServerConstants.ITEM_EXPIRE_TIME : Long.MAX_VALUE);\n     }\n     \n     private void unregisterItemDrop(MapleMapItem mdrop) {\n@@ -878,7 +878,7 @@ private void makeDisappearExpiredItemDrops() {\n         \n         objectRLock.lock();\n         try {\n-            long timeNow = System.currentTimeMillis();\n+            long timeNow = Server.getInstance().getCurrentTime();\n             \n             for(Entry<MapleMapItem, Long> it : droppedItems.entrySet()) {\n                 if(it.getValue() < timeNow) {\n@@ -1018,7 +1018,7 @@ public void updatePlayerItemDrops(int partyid, int charid, List<MapleCharacter>\n     \n     private void spawnDrop(final Item idrop, final Point dropPos, final MapleMapObject dropper, final MapleCharacter chr, final byte droptype, final short questid) {\n         final MapleMapItem mdrop = new MapleMapItem(idrop, dropPos, dropper, chr, chr.getClient(), droptype, false, questid);\n-        mdrop.setDropTime(System.currentTimeMillis());\n+        mdrop.setDropTime(Server.getInstance().getCurrentTime());\n         spawnAndAddRangedMapObject(mdrop, new DelayedPacketCreation() {\n             @Override\n             public void sendPackets(MapleClient c) {\n@@ -1042,7 +1042,7 @@ public void sendPackets(MapleClient c) {\n     public final void spawnMesoDrop(final int meso, final Point position, final MapleMapObject dropper, final MapleCharacter owner, final boolean playerDrop, final byte droptype) {\n         final Point droppos = calcDropPos(position, position);\n         final MapleMapItem mdrop = new MapleMapItem(meso, droppos, dropper, owner, owner.getClient(), droptype, playerDrop);\n-        mdrop.setDropTime(System.currentTimeMillis());\n+        mdrop.setDropTime(Server.getInstance().getCurrentTime());\n \n         spawnAndAddRangedMapObject(mdrop, new DelayedPacketCreation() {\n             @Override\n@@ -1904,7 +1904,7 @@ public void sendPackets(MapleClient c) {\n         }\n         \n         spawnedMonstersOnMap.incrementAndGet();\n-        applyRemoveAfter(monster);\n+        applyRemoveAfter(monster);  // thanks LightRyuzaki for pointing issues with spawned CWKPQ mobs not applying this\n     }\n \n     public void spawnDojoMonster(final MapleMonster monster) {\n@@ -2050,10 +2050,10 @@ public void run() {\n                     List<MapleMapObject> players = getMapObjectsInBox(mist.getBox(), Collections.singletonList(MapleMapObjectType.PLAYER));\n                     for (MapleMapObject mo : players) {\n                         if (mist.makeChanceResult()) {\n-                        \tMapleCharacter chr = (MapleCharacter) mo;\n-                        \tif (mist.getOwner().getId() == chr.getId() || mist.getOwner().getParty() != null && mist.getOwner().getParty().containsMembers(chr.getMPC())) {\t                        \t\n-\t                        \tchr.addMP((int) mist.getSourceSkill().getEffect(chr.getSkillLevel(mist.getSourceSkill().getId())).getX() * chr.getMp() / 100);\n-                        \t}\n+                            MapleCharacter chr = (MapleCharacter) mo;\n+                            if (mist.getOwner().getId() == chr.getId() || mist.getOwner().getParty() != null && mist.getOwner().getParty().containsMembers(chr.getMPC())) {\t                        \t\n+                                chr.addMP((int) mist.getSourceSkill().getEffect(chr.getSkillLevel(mist.getSourceSkill().getId())).getX() * chr.getMp() / 100);\n+                            }\n                         }\n                     }\n                 }\n@@ -2099,7 +2099,7 @@ public final void spawnItemDrop(final MapleMapObject dropper, final MapleCharact\n     public final void spawnItemDrop(final MapleMapObject dropper, final MapleCharacter owner, final Item item, Point pos, final byte dropType, final boolean playerDrop) {\n         final Point droppos = calcDropPos(pos, pos);\n         final MapleMapItem mdrop = new MapleMapItem(item, droppos, dropper, owner, owner.getClient(), dropType, playerDrop);\n-        mdrop.setDropTime(System.currentTimeMillis());\n+        mdrop.setDropTime(Server.getInstance().getCurrentTime());\n \n         spawnAndAddRangedMapObject(mdrop, new DelayedPacketCreation() {\n             @Override\n@@ -2636,11 +2636,11 @@ public void removePlayer(MapleCharacter chr) {\n             monster.setControllerKnowsAboutAggro(false);\n             updateMonsterController(monster);\n         }\n-        chr.leaveMap();\n         \n+        chr.leaveMap();\n         for (MapleSummon summon : new ArrayList<>(chr.getSummonsValues())) {\n             if (summon.isStationary()) {\n-                chr.cancelBuffStats(MapleBuffStat.PUPPET);\n+                chr.cancelEffectFromBuffStat(MapleBuffStat.PUPPET);\n             } else {\n                 removeMapObject(summon);\n             }"}, {"sha": "73e9b8c27af5064e97075d3ae545ac8e2f4f0575", "filename": "src/server/quest/actions/ExpAction.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/quest/actions/ExpAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/quest/actions/ExpAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/ExpAction.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,6 +23,7 @@\n \n import client.MapleCharacter;\n import constants.ServerConstants;\n+import net.server.world.World;\n import provider.MapleData;\n import provider.MapleDataTool;\n import server.quest.MapleQuest;\n@@ -58,7 +59,8 @@ public static void runAction(MapleCharacter chr, int gain) {\n                         if(!ServerConstants.USE_QUEST_RATE) {\n                                 chr.gainExp(gain * chr.getExpRate(), true, true);\n                         } else {\n-                                chr.gainExp(gain * ServerConstants.EXP_RATE * ServerConstants.QUEST_RATE, true, true);\n+                                World w = chr.getClient().getWorldServer();\n+                                chr.gainExp(gain * w.getExpRate() * w.getQuestRate(), true, true);\n                         }\n \t\t}\n         }"}, {"sha": "1fb79be4f915bb9f2d30ab26901360eeb3e53666", "filename": "src/server/quest/actions/MesoAction.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/quest/actions/MesoAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/server/quest/actions/MesoAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/MesoAction.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -23,6 +23,7 @@\n \n import client.MapleCharacter;\n import constants.ServerConstants;\n+import net.server.world.World;\n import provider.MapleData;\n import provider.MapleDataTool;\n import server.quest.MapleQuest;\n@@ -59,7 +60,8 @@ public static void runAction(MapleCharacter chr, int gain) {\n                         if(!ServerConstants.USE_QUEST_RATE) {\n                                 chr.gainMeso(gain * chr.getMesoRate(), true, false, true);\n                         } else {\n-                                chr.gainMeso(gain * ServerConstants.MESO_RATE * ServerConstants.QUEST_RATE, true, false, true);\n+                                World w = chr.getClient().getWorldServer();\n+                                chr.gainMeso(gain * w.getMesoRate() * w.getQuestRate(), true, false, true);\n                         }\n                 }\n         }"}, {"sha": "c8d1a8fd04a9a1096e7c14d4049a92c70636cd6b", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 46, "deletions": 42, "changes": 88, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -90,6 +90,7 @@\n import client.MapleQuestStatus;\n import client.MapleRing;\n import client.MapleStat;\n+import client.MonsterBook;\n import client.Skill;\n import client.SkillMacro;\n import client.inventory.Equip;\n@@ -103,6 +104,7 @@\n import client.newyear.NewYearCardRecord;\n import client.status.MonsterStatus;\n import client.status.MonsterStatusEffect;\n+import constants.ExpTable;\n import constants.GameConstants;\n import constants.ItemConstants;\n import constants.ServerConstants;\n@@ -143,6 +145,24 @@ private static long getTime(long realTimestamp) {\n                 return mplew.getPacket(); \n         }  \n \n+        private static void addRemainingSkillInfo(final MaplePacketLittleEndianWriter mplew, MapleCharacter chr) {\n+                int remainingSp[] = chr.getRemainingSps();\n+                int effectiveLength = 0;\n+                for (int i = 0; i < remainingSp.length; i++) {\n+                        if (remainingSp[i] > 0) {\n+                                effectiveLength++;\n+                        }\n+                }\n+\n+                mplew.write(effectiveLength);\n+                for (int i = 0; i < remainingSp.length; i++) {\n+                        if (remainingSp[i] > 0) {\n+                                mplew.write(i + 1);\n+                                mplew.write(remainingSp[i]);\n+                        }\n+                }\n+        }\n+        \n         private static void addCharStats(final MaplePacketLittleEndianWriter mplew, MapleCharacter chr) {\n                 mplew.writeInt(chr.getId()); // character id\n                 mplew.writeAsciiString(StringUtil.getRightPaddedStr(chr.getName(), '\\0', 13));\n@@ -168,18 +188,12 @@ private static void addCharStats(final MaplePacketLittleEndianWriter mplew, Mapl\n                 mplew.writeShort(chr.getInt()); // int\n                 mplew.writeShort(chr.getLuk()); // luk\n                 mplew.writeShort(chr.getHp()); // hp (?)\n-                mplew.writeShort(chr.getMaxHp()); // maxhp\n+                mplew.writeShort(chr.getClientMaxHp()); // maxhp\n                 mplew.writeShort(chr.getMp()); // mp (?)\n-                mplew.writeShort(chr.getMaxMp()); // maxmp\n+                mplew.writeShort(chr.getClientMaxMp()); // maxmp\n                 mplew.writeShort(chr.getRemainingAp()); // remaining ap\n                 if (GameConstants.hasSPTable(chr.getJob())) {\n-                        mplew.write(chr.getRemainingSpSize());\n-                        for (int i = 0; i < chr.getRemainingSps().length; i++) {\n-                                if (chr.getRemainingSpBySkill(i) > 0) {\n-                                        mplew.write(i + 1);\n-                                        mplew.write(chr.getRemainingSpBySkill(i));\n-                                }\n-                        }\n+                        addRemainingSkillInfo(mplew, chr);\n                 } else {\n                         mplew.writeShort(chr.getRemainingSp()); // remaining sp\n                 }\n@@ -433,10 +447,14 @@ protected static void addItemInfo(final MaplePacketLittleEndianWriter mplew, Ite\n                                 mplew.write(0x40);\n                         }\n                 } else {\n+                        int itemLevel = equip.getItemLevel();\n+                        \n+                        long expNibble = (ExpTable.getExpNeededForLevel(ii.getEquipLevelReq(item.getItemId())) * equip.getItemExp());\n+                        expNibble /= ExpTable.getEquipExpNeededForLevel(itemLevel);\n+                        \n                         mplew.write(0);\n-                        mplew.write(equip.getItemLevel()); //Item Level\n-                        mplew.writeShort(0);\n-                        mplew.writeShort(equip.getItemExp()); //Works pretty weird :s\n+                        mplew.write(itemLevel); //Item Level\n+                        mplew.writeInt((int) expNibble);\n                         mplew.writeInt(equip.getVicious()); //WTF NEXON ARE YOU SERIOUS?\n                         mplew.writeLong(0);\n                 }\n@@ -960,29 +978,18 @@ private static void addMonsterBookInfo(final MaplePacketLittleEndianWriter mplew\n                 return updatePlayerStats(EMPTY_STATUPDATE, true, null);\n         }\n \n-        /**\n-         * Gets an update for specified stats.\n-         *\n-         * @param stats The stats to update.\n-         * @param chr The update target.\n-         * @return The stat update packet.\n-         */\n-        public static byte[] updatePlayerStats(List<Pair<MapleStat, Integer>> stats, MapleCharacter chr) {\n-                return updatePlayerStats(stats, false, chr);\n-        }\n-\n         /**\n          * Gets an update for specified stats.\n          *\n          * @param stats The list of stats to update.\n-         * @param itemReaction Result of an item reaction(?)\n+         * @param enableActions Allows actions after the update.\n          * @param chr The update target.\n          * @return The stat update packet.\n          */\n-        public static byte[] updatePlayerStats(List<Pair<MapleStat, Integer>> stats, boolean itemReaction, MapleCharacter chr) {\n+        public static byte[] updatePlayerStats(List<Pair<MapleStat, Integer>> stats, boolean enableActions, MapleCharacter chr) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.STAT_CHANGED.getValue());\n-                mplew.write(itemReaction ? 1 : 0);\n+                mplew.write(enableActions ? 1 : 0);\n                 int updateMask = 0;\n                 for (Pair<MapleStat, Integer> statupdate : stats) {\n                         updateMask |= statupdate.getLeft().getValue();\n@@ -1009,13 +1016,7 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                                         mplew.write(statupdate.getRight().shortValue());\n                                 } else if (statupdate.getLeft().getValue() == 0x8000) {\n                                         if (GameConstants.hasSPTable(chr.getJob())) {\n-                                                mplew.write(chr.getRemainingSpSize());\n-                                                for (int i = 0; i < chr.getRemainingSps().length; i++) {\n-                                                        if (chr.getRemainingSpBySkill(i) > 0) {\n-                                                                mplew.write(i + 1);\n-                                                                mplew.write(chr.getRemainingSpBySkill(i));\n-                                                        }\n-                                                }\n+                                                addRemainingSkillInfo(mplew, chr);\n                                         } else {\n                                                 mplew.writeShort(statupdate.getRight().shortValue());\n                                         }\n@@ -2733,22 +2734,25 @@ private static int doubleToShortBits(double d) {\n                 mplew.write(0); //end of pets\n                 \n                 Item mount;     //mounts can potentially crash the client if the player's level is not properly checked\n-                if (chr.getMount() != null && (mount = chr.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -18)) != null && MapleItemInformationProvider.getInstance().getEquipStats(mount.getItemId()).get(\"reqLevel\") <= chr.getLevel()) {\n-                        mplew.write(chr.getMount().getId()); //mount\n-                        mplew.writeInt(chr.getMount().getLevel()); //level\n-                        mplew.writeInt(chr.getMount().getExp()); //exp\n-                        mplew.writeInt(chr.getMount().getTiredness()); //tiredness\n+                if (chr.getMount() != null && (mount = chr.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -18)) != null && MapleItemInformationProvider.getInstance().getEquipLevelReq(mount.getItemId()) <= chr.getLevel()) {\n+                        MapleMount mmount = chr.getMount();\n+                        mplew.write(mmount.getId()); //mount\n+                        mplew.writeInt(mmount.getLevel()); //level\n+                        mplew.writeInt(mmount.getExp()); //exp\n+                        mplew.writeInt(mmount.getTiredness()); //tiredness\n                 } else {\n                         mplew.write(0);\n                 }\n                 mplew.write(chr.getCashShop().getWishList().size());\n                 for (int sn : chr.getCashShop().getWishList()) {\n                         mplew.writeInt(sn);\n                 }\n-                mplew.writeInt(chr.getMonsterBook().getBookLevel());\n-                mplew.writeInt(chr.getMonsterBook().getNormalCard());\n-                mplew.writeInt(chr.getMonsterBook().getSpecialCard());\n-                mplew.writeInt(chr.getMonsterBook().getTotalCards());\n+                \n+                MonsterBook book = chr.getMonsterBook();\n+                mplew.writeInt(book.getBookLevel());\n+                mplew.writeInt(book.getNormalCard());\n+                mplew.writeInt(book.getSpecialCard());\n+                mplew.writeInt(book.getTotalCards());\n                 mplew.writeInt(chr.getMonsterBookCover() > 0 ? MapleItemInformationProvider.getInstance().getCardMobId(chr.getMonsterBookCover()) : 0);\n                 Item medal = chr.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -49);\n                 if (medal != null) {"}, {"sha": "d3a4872ef0572d0e1eba6f76d6afdda0540e2d94", "filename": "tools/MapleEquipmentOmnileveler/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEquipmentOmnileveler/build.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleEquipmentOmnileveler\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleEquipmentOmnileveler.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleEquipmentOmnileveler-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleEquipmentOmnileveler/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEquipmentOmnileveler/manifest.mf?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "81e6602368dd50424a51faab1f1a861c2caedf61", "filename": "tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "status": "added", "additions": 495, "deletions": 0, "changes": 495, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -0,0 +1,495 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package mapleequipmentomnileveler;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.sql.Connection;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ \n+ This application parses the Character.wz folder inputted and adds/updates the \"info/level\"\n+ node on every known equipment id. This addition enables client-side view of the equipment\n+ level attribute on every equipment in the game, given proper item visibility, be it from\n+ own equipments or from other players.\n+ \n+ Estimated parse time: 7 minutes\n+ \n+ */\n+public class MapleEquipmentOmnileveler {\n+\n+    static String equipDirectory = \"lib/original/\";\n+    static String outputDirectory = \"lib/updated/\";\n+    \n+    static Connection con = null;\n+    static PrintWriter printWriter = null;\n+    static InputStreamReader fileReader = null;\n+    static BufferedReader bufferedReader = null;\n+    \n+    static int initialStringLength = 250;\n+    \n+    static int fixedExp = 10000;\n+    static int maxEqpLevel = 30;\n+    \n+    static int infoTagState = -1, infoTagExpState = -1;\n+    \n+    static boolean infoTagLevel;\n+    static boolean infoTagLevelExp;\n+    static boolean infoTagLevelInfo;\n+    \n+    static int parsedLevels = 0;\n+    \n+    static byte status;\n+    static boolean upgradeable;\n+    static boolean cash;\n+    \n+    private static String getName(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+        \n+        i = token.lastIndexOf(\"name\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        try {\n+            token.getChars(i, j, dest, 0);\n+        } catch (StringIndexOutOfBoundsException e) {\n+            // do nothing\n+            return \"\";\n+        } catch (Exception e) {\n+            System.out.println(\"error in: \" + token + \"\");\n+            e.printStackTrace();\n+            try {\n+                Thread.sleep(100000000);\n+            } catch (Exception ex) {}\n+        }\n+        \n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static String getValue(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+\n+        i = token.lastIndexOf(\"value\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static void forwardCursor(int st) {\n+        String line = null;\n+\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                simpleToken(line);\n+                printWriter.println(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void translateLevelCursor(int st) {\n+        String line = null;\n+        \n+        try {\n+            infoTagLevelInfo = false;\n+            while (status >= st && (line = bufferedReader.readLine()) != null) {\n+                translateLevelToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void translateInfoTag(int st) {\n+        infoTagLevel = false;\n+        String line = null;\n+\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) { // skipping directory & canvas definition\n+                translateInfoToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+        \n+        if (!upgradeable || cash) {\n+            throw new RuntimeException();\n+        }\n+    }\n+\n+    private static void simpleToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+        }\n+    }\n+    \n+    private static void printUpdatedLevelExp() {\n+        printWriter.println(\"          <int name=\\\"exp\\\" value=\\\"\" + fixedExp + \"\\\"/>\");\n+    }\n+    \n+    private static void printDefaultLevel(int level) {\n+        printWriter.println(\"        <imgdir name=\\\"\" + level + \"\\\">\");\n+        printUpdatedLevelExp();\n+        printWriter.println(\"        </imgdir>\");\n+    }\n+    \n+    private static void printDefaultLevelInfoTag() {\n+        printWriter.println(\"      <imgdir name=\\\"info\\\">\");\n+        for (int i = 1; i <= maxEqpLevel; i++) printDefaultLevel(i);\n+        printWriter.println(\"      </imgdir>\");\n+    }\n+    \n+    private static void printDefaultLevelTag() {\n+        printWriter.println(\"    <imgdir name=\\\"level\\\">\");\n+        printDefaultLevelInfoTag();\n+        printWriter.println(\"    </imgdir>\");\n+    }\n+    \n+    private static void processLevelInfoTag(int st) {\n+        String line;\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                translateLevelExpToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void processLevelInfoSet(int st) {\n+        parsedLevels = (1 << maxEqpLevel) - 1;\n+        \n+        String line;\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                translateLevelInfoSetToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void translateLevelToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            if (status == 3) {\n+                if (!infoTagLevelInfo) {\n+                    printDefaultLevelInfoTag();\n+                }\n+            }\n+            printWriter.println(token);\n+            \n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            printWriter.println(token);\n+            status += 1;\n+            \n+            if (status == 4) {\n+                String d = getName(token);\n+                if(d.contentEquals(\"info\")) {\n+                    infoTagLevelInfo = true;\n+                    processLevelInfoSet(status);\n+                } else {\n+                    forwardCursor(status);\n+                }\n+            }\n+        }\n+        else {\n+            printWriter.println(token);\n+        }\n+    }\n+    \n+    private static void translateLevelInfoSetToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            \n+            if (status == 3) {\n+                if (parsedLevels != 0) {\n+                    for (int i = 0; i < maxEqpLevel; i++) {\n+                        if ((parsedLevels >> i) % 2 != 0) {\n+                            int level = i + 1;\n+                            printDefaultLevel(level);\n+                        }\n+                    }\n+                }\n+            }\n+            \n+            printWriter.println(token);\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            printWriter.println(token);\n+            status += 1;\n+            \n+            if (status == 5) {\n+                int level = Integer.parseInt(getName(token)) - 1;\n+                parsedLevels ^= (1 << level);\n+                \n+                infoTagLevelExp = false;\n+                infoTagExpState = status;  // status: 5\n+                processLevelInfoTag(status);        \n+                infoTagExpState = -1;\n+            }\n+        }\n+        else {\n+            printWriter.println(token);\n+        }\n+    }\n+    \n+    private static void translateLevelExpToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            \n+            if (status < infoTagExpState) {\n+                if (!infoTagLevelExp) {\n+                    printUpdatedLevelExp();\n+                }\n+            }\n+            \n+            printWriter.println(token);\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            printWriter.println(token);\n+            status += 1;\n+            \n+            forwardCursor(status);\n+        }\n+        else {\n+            String name = getName(token);\n+            if (name.contentEquals(\"exp\")) {\n+                infoTagLevelExp = true;\n+                printUpdatedLevelExp();\n+            } else {\n+                printWriter.println(token);\n+            }\n+        }\n+    }\n+    \n+    private static void translateInfoToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            \n+            if (status < infoTagState) {\n+                if (!infoTagLevel) {\n+                    printDefaultLevelTag();\n+                }\n+            }\n+            \n+            printWriter.println(token);\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+            printWriter.println(token);\n+            \n+            String d = getName(token);\n+            if (d.contentEquals(\"level\")) {\n+                infoTagLevel = true;\n+                translateLevelCursor(status);\n+            } else {\n+                forwardCursor(status);\n+            }\n+        }\n+        else {\n+            String name = getName(token);\n+            \n+            switch(name) {\n+                case \"cash\":\n+                    if (!getValue(token).contentEquals(\"0\")) {\n+                        cash = true;\n+                    }\n+                    break;\n+                    \n+                case \"tuc\":\n+                case \"incPAD\":\n+                case \"incMAD\":\n+                case \"incPDD\":\n+                case \"incMDD\":\n+                case \"incACC\":\n+                case \"incEVA\":\n+                case \"incSpeed\":\n+                case \"incJump\":\n+                case \"incMHP\":\n+                case \"incMMP\":\n+                case \"incSTR\":\n+                case \"incDEX\":\n+                case \"incINT\":\n+                case \"incLUK\":\n+                    if (!getValue(token).contentEquals(\"0\")) {\n+                        upgradeable = true;\n+                    }\n+                    break;\n+            }\n+            \n+            printWriter.println(token);\n+        }\n+    }\n+    \n+    private static boolean translateToken(String token) {\n+        boolean accessInfoTag = false;\n+        \n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            printWriter.println(token);\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            printWriter.println(token);\n+            status += 1;\n+            \n+            if (status == 2) {\n+                String d = getName(token);\n+                if(!d.contentEquals(\"info\")) {\n+                    forwardCursor(status);\n+                } else {\n+                    accessInfoTag = true;\n+                }\n+            } else if (status > 2) {\n+                forwardCursor(status);\n+            }\n+        }\n+        else {\n+            printWriter.println(token);\n+        }\n+        \n+        return accessInfoTag;\n+    }\n+    \n+    private static void copyCashItemData(File file, String curPath) throws IOException {\n+        printWriter = new PrintWriter(outputDirectory + curPath + file.getName(), \"UTF-8\");\n+        \n+        fileReader = new InputStreamReader(new FileInputStream(file), \"UTF-8\");\n+        bufferedReader = new BufferedReader(fileReader);\n+        \n+        String line;\n+        while((line = bufferedReader.readLine()) != null) {\n+            printWriter.println(line);\n+        }\n+\n+        bufferedReader.close();\n+        fileReader.close();\n+\n+        printWriter.close();\n+    }\n+    \n+    private static void parseEquipData(File file, String curPath) throws IOException {\n+        printWriter = new PrintWriter(outputDirectory + curPath + file.getName(), \"UTF-8\");\n+        \n+        fileReader = new InputStreamReader(new FileInputStream(file), \"UTF-8\");\n+        bufferedReader = new BufferedReader(fileReader);\n+        \n+        try {\n+            status = 0;\n+            upgradeable = false;\n+            cash = false;\n+            \n+            String line;\n+            while((line = bufferedReader.readLine()) != null) {\n+                if (translateToken(line)) {\n+                    infoTagState = status;  // status: 2\n+                    translateInfoTag(status);\n+                    infoTagState = -1;\n+                }\n+            }\n+            \n+            bufferedReader.close();\n+            fileReader.close();\n+            \n+            printFileFooter();\n+            printWriter.close();\n+        } catch (RuntimeException e) {\n+            bufferedReader.close();\n+            fileReader.close();\n+            \n+            printWriter.close();\n+            \n+            copyCashItemData(file, curPath);\n+        }\n+    }\n+    \n+    private static void printFileFooter() {\n+        printWriter.println(\"<!--\");\n+        printWriter.println(\" # WZ XML File parsed by the MapleEquipmentOmnilever feature by Ronan Lana.\");\n+        printWriter.println(\" # Generated data takes into account info from the server-side WZ.xmls.\");\n+        printWriter.println(\"-->\");\n+    }\n+    \n+    private static void parseDirectoryEquipData(String curPath) {\n+        File folder = new File(outputDirectory + curPath);\n+        if (!folder.exists()) {\n+            folder.mkdir();\n+        }\n+        \n+        System.out.println(\"Parsing directory '\" + curPath + \"'\");\n+        folder = new File(equipDirectory + curPath);\n+        for (File file : folder.listFiles()) {\n+            if (file.isFile()) {\n+                try {\n+                    parseEquipData(file, curPath);\n+                }\n+                catch(FileNotFoundException ex) {\n+                    System.out.println(\"Unable to open equip file \" + file.getAbsolutePath() + \".\");\n+                }\n+                catch(IOException ex) {\n+                    System.out.println(\"Error reading equip file \" + file.getAbsolutePath() + \".\");\n+                }\n+\n+                catch(Exception e) {\n+                    e.printStackTrace();\n+                }\n+            } else {\n+                parseDirectoryEquipData(curPath + file.getName() + \"/\");\n+            }\n+        }\n+    }\n+    \n+    /**\n+     * @param args the command line arguments\n+     */\n+    public static void main(String[] args) {\n+        parseDirectoryEquipData(\"\");\n+    }\n+    \n+}"}, {"sha": "f320cbff6383529f2f1bc5466e87976fda805b03", "filename": "wz/Map.wz/Map/Map1/106020000.img.xml", "status": "modified", "additions": 1376, "deletions": 1298, "changes": 2674, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Map.wz/Map/Map1/106020000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Map.wz/Map/Map1/106020000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map1/106020000.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa"}, {"sha": "d05451a2e27795a601019f2632ac109c26d7c3f7", "filename": "wz/Map.wz/Map/Map6/677000011.img.xml", "status": "modified", "additions": 3017, "deletions": 3040, "changes": 6057, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Map.wz/Map/Map6/677000011.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Map.wz/Map/Map6/677000011.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/677000011.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa"}, {"sha": "dd1879df1fe50d5302cf0e0cc3dec6e301495985", "filename": "wz/Mob.wz/9400590.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400590.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400590.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400590.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -289,10 +289,10 @@\n         <int name=\"attachfacing\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"2860\"/>\n       <int name=\"PADamage\" value=\"620\"/>\n       <int name=\"disease\" value=\"125\"/>\n       <int name=\"level\" value=\"3\"/>\n+      <int name=\"attackAfter\" value=\"2860\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"151\" height=\"127\">\n       <vector name=\"origin\" x=\"45\" y=\"126\"/>"}, {"sha": "6adf42707749501e84574658ad4cfebdf780a859", "filename": "wz/Mob.wz/9400593.img.xml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400593.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400593.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400593.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -205,8 +205,8 @@\n       </imgdir>\n       <int name=\"attachfacing\" value=\"1\"/>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"540\"/>\n       <int name=\"PADamage\" value=\"610\"/>\n+      <int name=\"attackAfter\" value=\"540\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"95\" height=\"109\">\n       <vector name=\"origin\" x=\"34\" y=\"98\"/>\n@@ -379,8 +379,8 @@\n         <int name=\"attach\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"2040\"/>\n       <int name=\"PADamage\" value=\"610\"/>\n+      <int name=\"attackAfter\" value=\"2040\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"95\" height=\"109\">\n       <vector name=\"origin\" x=\"34\" y=\"97\"/>\n@@ -622,8 +622,8 @@\n         <int name=\"attachfacing\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"450\"/>\n       <int name=\"PADamage\" value=\"610\"/>\n+      <int name=\"attackAfter\" value=\"450\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"95\" height=\"109\">\n       <vector name=\"origin\" x=\"34\" y=\"97\"/>\n@@ -770,8 +770,8 @@\n         <int name=\"attach\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"1500\"/>\n       <int name=\"PADamage\" value=\"610\"/>\n+      <int name=\"attackAfter\" value=\"1500\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"94\" height=\"100\">\n       <vector name=\"origin\" x=\"32\" y=\"97\"/>"}, {"sha": "58ca825878bfff982ddcd0c73e62ae7bea550443", "filename": "wz/Mob.wz/9400597.img.xml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400597.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400597.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400597.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -167,8 +167,8 @@\n         <int name=\"attachfacing\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"420\"/>\n       <int name=\"PADamage\" value=\"600\"/>\n+      <int name=\"attackAfter\" value=\"420\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"250\" height=\"131\">\n       <vector name=\"origin\" x=\"130\" y=\"130\"/>\n@@ -371,8 +371,8 @@\n         <int name=\"attach\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"600\"/>\n       <int name=\"magic\" value=\"1\"/>\n+      <int name=\"attackAfter\" value=\"600\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"250\" height=\"131\">\n       <vector name=\"origin\" x=\"130\" y=\"130\"/>\n@@ -524,8 +524,8 @@\n         <int name=\"attachfacing\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"750\"/>\n       <int name=\"PADamage\" value=\"600\"/>\n+      <int name=\"attackAfter\" value=\"750\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"250\" height=\"131\">\n       <vector name=\"origin\" x=\"130\" y=\"130\"/>"}, {"sha": "4a6d52ae99f508cc1885caac0e8308ac9bd45dab", "filename": "wz/Mob.wz/9400633.img.xml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400633.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Mob.wz/9400633.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400633.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -203,8 +203,8 @@\n       </imgdir>\n       <int name=\"attachfacing\" value=\"1\"/>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"400\"/>\n       <int name=\"PADamage\" value=\"200\"/>\n+      <int name=\"attackAfter\" value=\"400\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"134\" height=\"157\">\n       <vector name=\"origin\" x=\"59\" y=\"156\"/>\n@@ -314,10 +314,10 @@\n       <int name=\"magic\" value=\"1\"/>\n       <int name=\"disease\" value=\"125\"/>\n       <int name=\"level\" value=\"1\"/>\n-      <short name=\"attackAfter\" value=\"840\"/>\n       <int name=\"conMP\" value=\"1\"/>\n       <int name=\"MADamage\" value=\"100\"/>\n       <string name=\"elemAttr\" value=\"S\"/>\n+      <int name=\"attackAfter\" value=\"840\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"134\" height=\"157\">\n       <vector name=\"origin\" x=\"53\" y=\"156\"/>\n@@ -492,12 +492,12 @@\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n       <int name=\"magic\" value=\"1\"/>\n-      <short name=\"attackAfter\" value=\"600\"/>\n       <int name=\"MADamage\" value=\"100\"/>\n       <int name=\"AngerAttack\" value=\"1\"/>\n       <int name=\"disease\" value=\"123\"/>\n       <int name=\"level\" value=\"16\"/>\n       <int name=\"conMP\" value=\"5\"/>\n+      <int name=\"attackAfter\" value=\"600\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"132\" height=\"168\">\n       <vector name=\"origin\" x=\"56\" y=\"167\"/>\n@@ -637,7 +637,6 @@\n         <int name=\"attach\" value=\"1\"/>\n       </imgdir>\n       <int name=\"type\" value=\"0\"/>\n-      <short name=\"attackAfter\" value=\"3300\"/>\n       <int name=\"magic\" value=\"1\"/>\n       <int name=\"MADamage\" value=\"400\"/>\n       <int name=\"specialAttack\" value=\"1\"/>\n@@ -646,6 +645,7 @@\n       <int name=\"conMP\" value=\"10\"/>\n       <int name=\"tremble\" value=\"1\"/>\n       <int name=\"knockback\" value=\"1\"/>\n+      <int name=\"attackAfter\" value=\"3300\"/>\n     </imgdir>\n     <canvas name=\"0\" width=\"126\" height=\"159\">\n       <vector name=\"origin\" x=\"48\" y=\"158\"/>"}, {"sha": "36ddcfb6d68e0ce41d35f2617d4c2f0e4b58b9d6", "filename": "wz/Quest.wz/QuestInfo.img.xml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Quest.wz/QuestInfo.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/Quest.wz/QuestInfo.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/QuestInfo.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -9880,8 +9880,7 @@ Able to proceed to &apos;For the peace of Victoria Island...&apos; as next quest\n     <string name=\"1\" value=\"You can reach #rAstaroth#k by going through the door in the #b#m105050400##k. It&apos;s filled with a horrible stench, so the #rWild Eye&apos;s Gas Mask#k is needed. Defeat #rAstaroth!#k Return to #bthe Rememberer#k in #bSleepywood#k once your task is completed. \"/>\n     <string name=\"2\" value=\"You defeated the demon #rAstaroth#k, who threatened the peace in Victoria.\"/>\n     <int name=\"area\" value=\"30\"/>\n-    <string name=\"demandSummary\" value=\"#o9400633# #a282830# \n-\"/>\n+    <string name=\"demandSummary\" value=\"#o9400633# #a282831#\"/>\n     <string name=\"rewardSummary\" value=\"Exp 10,000\n 1,000 Meso\n \"/>"}, {"sha": "54f08f0160839dd8880b1339d4cef3d6dd7556c3", "filename": "wz/String.wz/Skill.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/String.wz/Skill.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/5480035005a8056dd027e0f711c668cc13d4c8fa/wz/String.wz/Skill.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Skill.img.xml?ref=5480035005a8056dd027e0f711c668cc13d4c8fa", "patch": "@@ -8020,7 +8020,7 @@\n     <string name=\"h7\" value=\"Uses 10% of MaxHP, Uses 85% of the used HP on MP, 40 seconds until next use\"/>\n     <string name=\"h8\" value=\"Uses 10% of MaxHP, Uses 90% of the used HP on MP, 35 seconds until next use\"/>\n     <string name=\"h9\" value=\"Uses 10% of MaxHP, Uses 95% of the used HP on MP, 30 seconds until next use\"/>\n-    <string name=\"h10\" value=\"Uses 10% of MaxHP, Uses 100%of the used HP on MP \ud68c\ub300\uae30 seconds until next use\uc2dc\uac04 25\ucd08\"/>\n+    <string name=\"h10\" value=\"Uses 10% of MaxHP, Uses 100% of the used HP on MP, 25 seconds until next use\"/>\n   </imgdir>\n   <imgdir name=\"5101006\">\n     <string name=\"name\" value=\"Knuckler Booster\"/>\n@@ -12717,7 +12717,7 @@\n   <imgdir name=\"0000100\">\n     <string name=\"name\" value=\"Chair Mastery\"/>\n     <string name=\"desc\" value=\"[Master Level : 1]\\nBonus recovery gain from using map chairs throughout the world.\"/>\n-    <string name=\"h1\" value=\"Passively recover extra amounts of HP and MP by resting on map chairs.\"/>\n+    <string name=\"h1\" value=\"Passively recover extra amounts of HP and MP by resting on map chairs. Heal amount is calculated over a percentage of the character&apos;s base pool.\"/>\n   </imgdir>\n   <imgdir name=\"10000100\">\n     <string name=\"name\" value=\"Chair Mastery\"/>"}]}]},
