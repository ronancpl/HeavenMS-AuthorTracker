{"fetchDate": "2019-12-19", "content": [{"sha": "0b6951527d3803c877205d1f6516911fd8bcc64e", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MGI2OTUxNTI3ZDM4MDNjODc3MjA1ZDFmNjUxNjkxMWZkOGJjYzY0ZQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-03-28T20:09:18Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-03-28T20:09:18Z"}, "message": "Change channel transition patch\n\nSolved an issue where players were being unable to return to the game once changing channels.", "tree": {"sha": "3820efedbec991532a14f756ff1cbd34fb1b3326", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/3820efedbec991532a14f756ff1cbd34fb1b3326"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/0b6951527d3803c877205d1f6516911fd8bcc64e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0b6951527d3803c877205d1f6516911fd8bcc64e", "html_url": "https://github.com/ronancpl/HeavenMS/commit/0b6951527d3803c877205d1f6516911fd8bcc64e", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0b6951527d3803c877205d1f6516911fd8bcc64e/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16deacb426be53a181757fbbafe8f2f76f900730", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/16deacb426be53a181757fbbafe8f2f76f900730", "html_url": "https://github.com/ronancpl/HeavenMS/commit/16deacb426be53a181757fbbafe8f2f76f900730"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "5e062c1ec1415daa54efb1a28d6e806feba52f85", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -1768,4 +1768,7 @@ Corrigido NPC da CPQ2, sa\u00edda abrupta, n\u00e3o retornando jogadores devidamente par\n Corrigido bug na CPQ em tempo estendido n\u00e3o mostrando devidamente o efeito visual de fim de partida.\n \n 27 Mar\u00e7o 2019,\n-Corrigido possibilidade de bloqueio de volta do jogador ao jogo, ao utilizar o sistema de MTS/Cash Shop. Problema ocorria devido a mudan\u00e7as concorrentes de login states ao fazer a transi\u00e7\u00e3o de volta ao jogo.\n\\ No newline at end of file\n+Corrigido possibilidade de bloqueio de volta do jogador ao jogo, ao utilizar o sistema de MTS/Cash Shop. Problema ocorria devido a mudan\u00e7as concorrentes de login states ao fazer a transi\u00e7\u00e3o de volta ao jogo.\n+\n+28 Mar\u00e7o 2019,\n+Corrigido possibilidade de congelamento de tela ao tentar trocar de canais. Problema ocorria devido a mudan\u00e7as concorrentes de login states ao fazer a transi\u00e7\u00e3o de volta ao jogo.\n\\ No newline at end of file"}, {"sha": "5982fee939f7f1b8b1a7bf6b2daafe844fee3287", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -487,7 +487,6 @@ public void setEnteredChannelWorld() {\n     }\n     \n     public void setAwayFromChannelWorld() {\n-        client.getSession().setAttribute(MapleClient.CLIENT_CASH_SHOP);\n         setAwayFromChannelWorld(false);\n     }\n             \n@@ -505,6 +504,10 @@ private void setAwayFromChannelWorld(boolean disconnect) {\n         }\n     }\n     \n+    public void setSessionTransitionState() {\n+        client.getSession().setAttribute(MapleClient.CLIENT_TRANSITION);\n+    }\n+    \n     public long getPetLootCd() {\n         return petLootCd;\n     }"}, {"sha": "c76de7b7481f987f3dc1f28468f9c826fe4b6330", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -91,7 +91,7 @@\n         public static final String CLIENT_HWID = \"HWID\";\n         public static final String CLIENT_NIBBLEHWID = \"HWID2\";\n         public static final String CLIENT_REMOTE_ADDRESS = \"REMOTE_IP\";\n-        public static final String CLIENT_CASH_SHOP = \"CASH_SHOP\";\n+        public static final String CLIENT_TRANSITION = \"TRANSITION\";\n \tprivate MapleAESOFB send;\n \tprivate MapleAESOFB receive;\n \tprivate final IoSession session;\n@@ -1474,6 +1474,7 @@ public void changeChannel(int channel) {\n                 player.unregisterChairBuff();\n \t\tserver.getPlayerBuffStorage().addBuffsToStorage(player.getId(), player.getAllBuffs());\n                 server.getPlayerBuffStorage().addDiseasesToStorage(player.getId(), player.getAllDiseases());\n+                player.setSessionTransitionState();\n                 player.setDisconnectedFromChannelWorld();\n                 player.notifyMapTransferToPartner(-1);\n                 player.removeIncomingInvites();"}, {"sha": "13d7ede8bf80583d43fb046d6a9384da951f66b0", "filename": "src/net/MapleServerHandler.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/MapleServerHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/MapleServerHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/MapleServerHandler.java?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -150,7 +150,8 @@ private void closeMapleSession(IoSession session) {\n         MapleClient client = (MapleClient) session.getAttribute(MapleClient.CLIENT_KEY);\n         if (client != null) {\n             try {\n-                if (!session.containsAttribute(MapleClient.CLIENT_CASH_SHOP)) {\n+                // client freeze issues on session transition states found thanks to yolinlin, Omo Oppa, Nozphex\n+                if (!session.containsAttribute(MapleClient.CLIENT_TRANSITION)) {\n                     client.disconnect(false, false);\n                 }\n             } catch (Throwable t) {"}, {"sha": "69c8fe3a34f9a34e7ee51cf98bd283736d1a1b49", "filename": "src/net/server/channel/handlers/EnterCashShopHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/server/channel/handlers/EnterCashShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/server/channel/handlers/EnterCashShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterCashShopHandler.java?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -65,6 +65,7 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             mc.unregisterChairBuff();\n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(mc.getId(), mc.getAllBuffs());\n             Server.getInstance().getPlayerBuffStorage().addDiseasesToStorage(mc.getId(), mc.getAllDiseases());\n+            mc.setSessionTransitionState();\n             mc.setAwayFromChannelWorld();\n             mc.notifyMapTransferToPartner(-1);\n             mc.removeIncomingInvites();"}, {"sha": "e658dc34b6d88b8e0931cae11c2b898fdbebd347", "filename": "src/net/server/channel/handlers/EnterMTSHandler.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/server/channel/handlers/EnterMTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0b6951527d3803c877205d1f6516911fd8bcc64e/src/net/server/channel/handlers/EnterMTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterMTSHandler.java?ref=0b6951527d3803c877205d1f6516911fd8bcc64e", "patch": "@@ -91,6 +91,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             chr.unregisterChairBuff();\n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(chr.getId(), chr.getAllBuffs());\n             Server.getInstance().getPlayerBuffStorage().addDiseasesToStorage(chr.getId(), chr.getAllDiseases());\n+            chr.setSessionTransitionState();\n             chr.setAwayFromChannelWorld();\n             chr.notifyMapTransferToPartner(-1);\n             chr.removeIncomingInvites();"}]}]},
