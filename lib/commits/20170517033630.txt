{"fetchDate": "2019-12-19", "content": [{"sha": "3fc338467ba0646c4609aba17d1ed2082c64fbad", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6M2ZjMzM4NDY3YmEwNjQ2YzQ2MDlhYmExN2QxZWQyMDgyYzY0ZmJhZA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-17T03:36:30Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-17T03:36:30Z"}, "message": "Henesys PQ\n\nImplemented Henesys PQ.", "tree": {"sha": "b37e9d31b70a1143c597485de3f457bdf7e818df", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/b37e9d31b70a1143c597485de3f457bdf7e818df"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/3fc338467ba0646c4609aba17d1ed2082c64fbad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/3fc338467ba0646c4609aba17d1ed2082c64fbad", "html_url": "https://github.com/ronancpl/HeavenMS/commit/3fc338467ba0646c4609aba17d1ed2082c64fbad", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/3fc338467ba0646c4609aba17d1ed2082c64fbad/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "42e9d260e789139156229c573e60b9e6726d1e63", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/42e9d260e789139156229c573e60b9e6726d1e63", "html_url": "https://github.com/ronancpl/HeavenMS/commit/42e9d260e789139156229c573e60b9e6726d1e63"}], "stats": {"total": 1042, "additions": 519, "deletions": 523}, "files": [{"sha": "b49260ecd547bead5c4abf43f7007fef86f2b52e", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -3,4 +3,7 @@\n /logs/\n /MapleIdRetriever/nbproject/private/\n /MapleIdRetriever/dist/\n-/MapleIdRetriever/build/\n\\ No newline at end of file\n+/MapleIdRetriever/build/\n+/MobBookUpdate/nbproject/private/\n+/MobBookUpdate/dist/\n+/MobBookUpdate/build/\n\\ No newline at end of file"}, {"sha": "29a476cbad4fbec1d9259e04e912b76379b0596a", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -3,11 +3,27 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/world/MaplePartyCharacter.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/1012113.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040047_old.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108004.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108001.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108002.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/KerningPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/1012114.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108005.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9201134.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/LudiPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2030010.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/HenesysPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9040005.js</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/event/EventInstanceManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/BossRushPQ.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9000037.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/event/EventManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/1012112.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108000.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleMap.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleClient.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/9108003.js</file>\n         </group>\n     </open-files>\n </project-private>"}, {"sha": "2241c7bb44154bee0b8a421a4855cfbea8b3101f", "filename": "scripts/event/BossRushPQ.js", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/BossRushPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/BossRushPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BossRushPQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Boss Rush PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 1, maxPlayers = 6;\n var minLevel = 1, maxLevel = 200;"}, {"sha": "9a87733b001650c46144018084ce831fd09556a2", "filename": "scripts/event/EllinPQ.js", "status": "renamed", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/EllinPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/EllinPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/EllinPQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Ellin PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 4, maxPlayers = 6;\n var minLevel = 44, maxLevel = 55;", "previous_filename": "scripts/event/Ellin.js"}, {"sha": "b95aed05cd0e39d3fc5f79540ec488e0d842f501", "filename": "scripts/event/HenesysPQ.js", "status": "modified", "additions": 167, "deletions": 153, "changes": 320, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/HenesysPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/HenesysPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HenesysPQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,195 +1,209 @@\n-/* \n-*\n-*Henesys PQ : FightDesign ->RaGEZONE / FXP\n-*\n+/**\n+ * @author: Ronan\n+ * @event: Henesys PQ\n */\n-// Significant maps (this was already here, helpful though)\n-// 100000200 - Pig Park\n-// 910010000 - 1st Stage\n-// 910010100 - Shortcut\n-// 910010200 - Bonus\n-// 910010300 - Exit\n-// Significant items\n-// 4001101 - Rice Cake\n-// Significant monsters\n-// 9300061 - Bunny\n-// 9300062 - Flyeye\n-// 9300063 - Stirge\n-// 9300064 - Goblin Fires\n-// Significant NPCs\n-// 1012112 - Troy\n-// 1012113 - Tommy\n-// 1012114 - Growlie\n-// map effects\n-// Map/Obj/Effect/quest/gate/3 - warp activation glow\n-// quest/party/clear - CLEAR text\n-// Party1/Clear - clear sound\n-/* INSERT monsterdrops (monsterid,itemid,chance) VALUES (9300061,4001101,1);\n- */\n-\n-\n-importPackage(Packages.net.world);\n-importPackage(Packages.tools);\n-\n-var exitMap;\n-var mainMap;\n-var minPlayers = 3;\n-var pqTime = 10;//10 Minutes\n \n-function init() {\n-    exitMap = em.getChannelServer().getMapFactory().getMap(910010400); // <exit>\n-    exitClearMap = em.getChannelServer().getMapFactory().getMap(910010100); // <clear>\n-    mainMap = em.getChannelServer().getMapFactory().getMap(910010000); // <main>\n-    em.setProperty(\"HPQOpen\", \"true\"); // allows entrance.\n-}\n-\n-function monsterValue(eim, mobId) {\n-    return 1;\n-}\n+var isPq = true;\n+var minPlayers = 1, maxPlayers = 6;\n+var minLevel = 10, maxLevel = 200;\n+var entryMap = 910010000;\n+var exitMap = 910010300;\n+var recruitMap = 100000200;\n+var clearMap = 910010100;\n \n+var minMapId = 910010000;\n+var maxMapId = 910010400;\n \n+var eventTime = 10;     // 10 minutes\n \n+var lobbyRange = [0, 0];\n \n-function setup() {\n-    em.setProperty(\"HPQOpen\", \"false\")\n-    var eim = em.newInstance(\"HenesysPQ_\" + em.getProperty(\"latestLeader\"));\n-    eim.setProperty(\"stage\", \"0\");\n-    eim.setProperty(\"clear\", \"false\");\n-    eim.getMapInstance(910010000).allowSummonState(false);\n-    eim.getMapInstance(910010000).killAllMonsters();\n-    respawn(eim);\n-    var timer = 1000 * 60 * pqTime; // 10 minutes\n-    em.schedule(\"timeOut\", eim, timer);\n-    eim.startEventTimer(timer);\n-    return eim;\n+function init() {\n+        setEventRequirements();\n+}\n+\n+function setLobbyRange() {\n+        return lobbyRange;\n+}\n+\n+function setEventRequirements() {\n+        var reqStr = \"\";\n+        \n+        reqStr += \"\\r\\n    Number of players: \";\n+        if(maxPlayers - minPlayers >= 1) reqStr += minPlayers + \" ~ \" + maxPlayers;\n+        else reqStr += minPlayers;\n+        \n+        reqStr += \"\\r\\n    Level range: \";\n+        if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n+        else reqStr += minLevel;\n+        \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n+        em.setProperty(\"party\", reqStr);\n+}\n+\n+function setEventExclusives(eim) {\n+        var itemSet = [4001095, 4001096, 4001097, 4001098, 4001099, 4001100, 4001101];\n+        eim.setExclusiveItems(itemSet);\n+}\n+\n+function setEventRewards(eim) {\n+        var itemSet, itemQty, evLevel, expStages;\n+\n+        evLevel = 1;    //Rewards at clear PQ\n+        itemSet = [4001129];\n+        itemQty = [1];\n+        eim.setEventRewards(evLevel, itemSet, itemQty);\n+        \n+        expStages = [1600];    //bonus exp given on CLEAR stage signal\n+        eim.setEventClearStageExp(expStages);\n+}\n+\n+function getEligibleParty(party) {      //selects, from the given party, the team that is allowed to attempt this event\n+        var eligible = [];\n+        var hasLeader = false;\n+        \n+        if(party.size() > 0) {\n+                var partyList = party.toArray();\n+\n+                for(var i = 0; i < party.size(); i++) {\n+                        var ch = partyList[i];\n+\n+                        if(ch.getMapId() == recruitMap && ch.getLevel() >= minLevel && ch.getLevel() <= maxLevel) {\n+                                if(ch.isLeader()) hasLeader = true;\n+                                eligible.push(ch);\n+                        }\n+                }\n+        }\n+        \n+        if(!(hasLeader && eligible.length >= minPlayers && eligible.length <= maxPlayers)) eligible = [];\n+        return eligible;\n+}\n+\n+function setup(level, lobbyid) {\n+        var eim = em.newInstance(\"Henesys\" + lobbyid);\n+        eim.setProperty(\"level\", level);\n+        eim.setProperty(\"stage\", \"0\");\n+        \n+        eim.getInstanceMap(910010000).resetPQ(level);\n+        eim.getInstanceMap(910010000).allowSummonState(false);\n+        \n+        eim.getInstanceMap(910010200).resetPQ(level);\n+        \n+        respawnStages(eim);\n+        eim.startEventTimer(eventTime * 60000);\n+        setEventRewards(eim);\n+        setEventExclusives(eim);\n+        return eim;\n+}\n+\n+function respawnStages(eim) {\n+        eim.getInstanceMap(910010000).instanceMapRespawn();\n+        eim.getInstanceMap(910010200).instanceMapRespawn();\n+        \n+        eim.schedule(\"respawnStages\", 15 * 1000);\n }\n \n+function playerEntry(eim, player) {\n+        var map = eim.getMapInstance(entryMap);\n+        player.changeMap(map, map.getPortal(0));\n+}\n \n-function respawn(eim) {\t\n-\tvar map = eim.getMapInstance(910010000);\n-\tif (map.getSummonState()) {\t\n-\t\tmap.instanceMapRespawn();\n-\t}\n-\teim.schedule(\"respawn\", 10000);\n+function scheduledTimeout(eim) {\n+        if(eim.getProperty(\"1stageclear\") != null) {\n+                var curStage = 910010200, toStage = 910010400;\n+                eim.warpEventTeam(curStage, toStage);\n+        }\n+        else {\n+                end(eim);\n+        }\n }\n \n+function playerExit(eim, player) {\n+        eim.unregisterPlayer(player);\n+        player.changeMap(exitMap, 0);\n+}\n+\n+function changedMap(eim, player, mapid) {\n+        if (mapid < minMapId || mapid > maxMapId) {\n+                if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                        eim.unregisterPlayer(player);\n+                        end(eim);\n+                }\n+                else\n+                        eim.unregisterPlayer(player);\n+        }\n+}\n \n-function playerEntry(eim, player) {\n-    var map = eim.getMapInstance(mainMap.getId());\n-    player.changeMap(map, map.getPortal(0));\n+function changedLeader(eim, leader) {\n+        var mapid = leader.getMapId();\n+        if (!eim.isEventCleared() && (mapid < minMapId || mapid > maxMapId)) {\n+                end(eim);\n+        }\n }\n \n-function playerDead(eim, player) {\n-    if (player.isAlive()) {\n-        if (eim.isLeader(player)) {\n-            var party = eim.getPlayers();\n-            for (var i = 0; i < party.size(); i++)\n-                playerExit(eim, party.get(i));\n-            eim.dispose();\n-        } else {\n-            var partyz = eim.getPlayers();\n-            if (partyz.size() < minPlayers) {\n-                for (var j = 0; j < partyz.size(); j++)\n-                    playerExit(eim,partyz.get(j));\n-                eim.dispose();\n-            } else\n-                playerExit(eim, player);\n+function playerDead(eim, player) {}\n+\n+function playerRevive(eim, player) { // player presses ok on the death pop up.\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n         }\n-    }\n+        else\n+                eim.unregisterPlayer(player);\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isLeader(player)) {\n-        var party = eim.getPlayers();\n-        for (var i = 0; i < party.size(); i++) {\n-            if (party.get(i).equals(player)) {\n-                removePlayer(eim, player);\n-            } else {\n-                playerExit(eim, party.get(i));\n-            }\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n         }\n-        eim.dispose();\n-    } else {\n-        var partyz = eim.getPlayers();\n-        if (partyz.size() < minPlayers) {\n-            for (var j = 0; j < partyz.size(); j++) {\n-                playerExit(eim,partyz.get(j));\n-\t\t\t}\n-            eim.dispose();\n-        } else {\n-            playerExit(eim, player);\n-\t\t}\n-    }\n+        else\n+                eim.unregisterPlayer(player);\n }\n \n function leftParty(eim, player) {\n-    var party = eim.getPlayers();\n-    if (party.size() < minPlayers) {\n-        for (var i = 0; i < party.size(); i++)\n-            playerExit(eim,party.get(i));\n-        eim.dispose();\n-    }\n-    else\n-        playerExit(eim, player);\n+        if (eim.isEventTeamLackingNow(false, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n+        }\n+        else\n+                eim.unregisterPlayer(player);\n }\n \n function disbandParty(eim) {\n-    \n-    var party = eim.getPlayers();\n-    for (var i = 0; i < party.size(); i++) {\n-        playerExit(eim, party.get(i));\n-    }\n-    eim.dispose();\n+        end(eim);\n }\n \n-function playerExitClear(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.changeMap(exitClearMap, exitClearMap.getPortal(0));\n+function monsterValue(eim, mobId) {\n+        return 1;\n }\n \n-function playerExit(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.changeMap(exitMap, exitMap.getPortal(0));\n+function end(eim) {\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++) {\n+                playerExit(eim, party.get(i));\n+        }\n+        eim.dispose();\n }\n \n-function removePlayer(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.getMap().removePlayer(player);\n-    player.setMap(exitMap);\n+function giveRandomEventReward(eim, player) {\n+        eim.giveEventReward(player);\n }\n \n function clearPQ(eim) {\n-    var party = eim.getPlayers();\n-    for (var i = 0; i < party.size(); i++)\n-        playerExitClear(eim, party.get(i));\n-    eim.dispose();\n+        eim.stopEventTimer();\n+        eim.setEventCleared();\n+        \n+        eim.warpEventTeam(910010100);\n }\n \n function monsterKilled(mob, eim) {}\n \n function allMonstersDead(eim) {}\n \n-function dispose() {\n-    em.cancelSchedule();\n-    em.schedule(\"OpenHPQ\", 5000);\n-}\n+function cancelSchedule() {}\n \n-function cancelSchedule(eim) {\n-\t//This needed? It causes problem on reloadevents\n-    //eim.startEventTimer(0);\n-}\n-\n-function timeOut(eim) {\n-    if (eim != null) {\n-        if (eim.getPlayerCount() > 0) {\n-            var pIter = eim.getPlayers().iterator();\n-            while (pIter.hasNext())\n-                playerExit(eim, pIter.next());\n-        }\n-        eim.dispose();\n-    }\n-}\n+function dispose(eim) {}\n \n-function OpenHPQ() {\n-    em.setProperty(\"HPQOpen\", \"true\");\n-} \n\\ No newline at end of file"}, {"sha": "d011f3a41a7846530c5a56f333f36b6bde49c1dd", "filename": "scripts/event/KerningPQ.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/KerningPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/KerningPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KerningPQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Kerning PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 3, maxPlayers = 4;\n var minLevel = 21, maxLevel = 30;\n@@ -90,7 +95,7 @@ function setup(level, lobbyid) {\n function respawnStages(eim) {    \n         eim.getMapInstance(103000800).instanceMapRespawn();\n         eim.getMapInstance(103000805).instanceMapRespawn();\n-        eim.schedule(\"respawnStages\", 10 * 1000);\n+        eim.schedule(\"respawnStages\", 15 * 1000);\n }\n \n function playerEntry(eim, player) {"}, {"sha": "9924c47eb4e0cfd1030a1560ac98e8baff3ff042", "filename": "scripts/event/LudiMazePQ.js", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/LudiMazePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/LudiMazePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiMazePQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Ludibrium Maze PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 3, maxPlayers = 6;\n var minLevel = 51, maxLevel = 70;"}, {"sha": "687289163567d93974c0dd252405634a46a208eb", "filename": "scripts/event/LudiPQ.js", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/LudiPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/LudiPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiPQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Ludibrium PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 5, maxPlayers = 6;\n var minLevel = 35, maxLevel = 50;"}, {"sha": "135b886438b2469402387542b085bc10460a3341", "filename": "scripts/event/PiratePQ.js", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/PiratePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/event/PiratePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PiratePQ.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,3 +1,8 @@\n+/**\n+ * @author: Ronan\n+ * @event: Pirate PQ\n+*/\n+\n var isPq = true;\n var minPlayers = 3, maxPlayers = 6;\n var minLevel = 55, maxLevel = 100;"}, {"sha": "7658922a3c7df8e540fd1bddc170d8834158683e", "filename": "scripts/npc/world0/1012112.js", "status": "modified", "additions": 68, "deletions": 150, "changes": 218, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012112.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012112.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1012112.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -45,166 +45,84 @@ function action(mode, type, selection) {\n                 else\n                         status--;\n                 \n-                if (status == 0) {\n-                        em = cm.getEventManager(\"HenesysPQ\");\n-                        if(em == null) {\n-                                cm.sendOk(\"The Henesys PQ has encountered an error.\");\n-                                cm.dispose();\n-                                return;\n-                        }\n-                    \n-                        cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n-                } else if (status == 1) {\n-                        if (selection == 0) {\n-                                if (cm.getParty() == null) {\n-                                        cm.sendOk(\"Hi there! I'm Tory. This place is covered with mysterious aura of the full moon, and no one person can enter here by him/herself.\");\n+                if(cm.getMapId() == 100000200) {\n+                        if (status == 0) {\n+                                em = cm.getEventManager(\"HenesysPQ\");\n+                                if(em == null) {\n+                                        cm.sendOk(\"The Henesys PQ has encountered an error.\");\n                                         cm.dispose();\n-                                } else if(!cm.isLeader()) {\n-                                        cm.sendOk(\"If you'd like to enter here, the leader of your party will have to talk to me. Talk to your party leader about this.\");\n-                                        cm.dispose();\n-                                } else {\n-                                        var eli = em.getEligibleParty(cm.getParty());\n-                                        if(eli.size() > 0) {\n-                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n-                                                        cm.sendOk(\"Someone is already attempting the PQ. Please wait for them to finish, or find another channel.\");\n+                                        return;\n+                                }\n+\n+                                cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to redeem an event hat.\");\n+                        } else if (status == 1) {\n+                                if (selection == 0) {\n+                                        if (cm.getParty() == null) {\n+                                                cm.sendOk(\"Hi there! I'm Tory. This place is covered with mysterious aura of the full moon, and no one person can enter here by him/herself.\");\n+                                                cm.dispose();\n+                                        } else if(!cm.isLeader()) {\n+                                                cm.sendOk(\"If you'd like to enter here, the leader of your party will have to talk to me. Talk to your party leader about this.\");\n+                                                cm.dispose();\n+                                        } else {\n+                                                var eli = em.getEligibleParty(cm.getParty());\n+                                                if(eli.size() > 0) {\n+                                                        if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                                cm.sendOk(\"Someone is already attempting the PQ. Please wait for them to finish, or find another channel.\");\n+                                                        }\n                                                 }\n+                                                else {\n+                                                        cm.sendOk(\"You cannot start this party quest yet, because either your party is not in the range size, some of your party members are not eligible to attempt it or they are not in this map. If you're having trouble finding party members, try Party Search.\");\n+                                                }\n+\n+                                                cm.dispose();\n                                         }\n-                                        else {\n-                                                cm.sendOk(\"You cannot start this party quest yet, because either your party is not in the range size, some of your party members are not eligible to attempt it or they are not in this map. If you're having trouble finding party members, try Party Search.\");\n-                                        }\n-                                        \n+                                } else if (selection == 1) {\n+                                        cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                        cm.dispose();\n+                                } else if (selection == 2) {\n+                                        cm.sendOk(\"#e#b<Party Quest: Primrose Hill>#k#n\\r\\nCollect primrose seeds from the flowers at the bottom part of the map and drop them by the platforms above the stage. Primrose seed color must match to grow the seeds, so test until you find the correct combination. When all the seeds have been planted, that is, starting second part of the mission, scout the Moon Bunny while it prepares Rice Cakes for the hungry Growlie. Once Growlie becomes satisfied, your mission is complete.\");\n                                         cm.dispose();\n+                                } else {\n+                                        cm.sendYesNo(\"So you want to exchange #b20 #b#t4001129##k for the event-designed hat?\");\n                                 }\n-                        } else if (selection == 1) {\n-                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n-                                cm.dispose();\n                         } else {\n-                                cm.sendOk(\"#e#b<Party Quest: Primrose Hill>#k#n\\r\\nCollect primrose seeds from the flowers at the bottom part of the map and drop them by the platforms above the stage. Primrose seed color must match to grow the seeds, so test until you find the correct combination. When all the seeds have been planted, that is, starting second part of the mission, scout the Moon Bunny while it prepares Rice Cakes for the hungry Growlie. Once Growlie becomes satisfied, your mission is complete.\");\n+                                if(cm.hasItem(4001129, 20)) {\n+                                        if(cm.canHold(1002798)) {\n+                                                cm.gainItem(4001129, -20);\n+                                                cm.gainItem(1002798, 20);\n+                                                cm.sendNext(\"Here it is. Enjoy!\");\n+                                        }\n+                                } else {\n+                                        cm.sendNext(\"You don't have enough #t4001129# to buy it yet!\");\n+                                }\n+                                \n                                 cm.dispose();\n                         }\n-                }\n-        }\n-}\n-\n-/*\n-var status = 0;\n-var chosen = 0;\n-var min = 3;\n-var minLevel = 10;\n-\n-\n-function start() {\n-    status = -1;\n-    action(1, 0, 0);\n-}\n-\n-function action(mode, type, selection) {\n-    if (mode == -1) {\n-        cm.dispose();\n-    } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n-        if (mode == 1) {\n-            status++;\n-        } else {\n-            status--;\n-        }\n-        if (cm.getPlayer().getMapId() == 100000200) {\n-            if (cm.getParty() == null || !cm.isLeader()) {\n-                if (status == 0) {\n-                    cm.sendNext(\"Hi there! I'm Tory. This place is covered with mysterious aura of the full moon, and no one person can enter here by him/herself.\");\n-                } else if (status == 1) {\n-                    cm.sendOk(\"If you'd like to enter here, the leader of your party will have to talk to me. Talk to your party leader about this.\");\n-                    cm.dispose();\n-                }\n-            } else {\n-                if (status == 0) {\n-                    cm.sendNext(\"I'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat.\");\n-                } else if (status == 1) {\n-                    cm.sendSimple(\"Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?\\r\\n#b#L0# Yes, I will go.#l\");\n-                } else if (status == 2) {\n-                    var party = cm.getPartyMembers();\n-                    var onmap = 0;\n-                    for (var i = 0; i < party.size(); i++) {\n-                        if (party.get(i).getMap().getId() == 100000200) {\n-                            if (party.get(i).getLevel() < minLevel) {\n-                                cm.sendOk(\"A member of your party does not meet the level requirement.\");\n+                } else if (cm.getMapId() == 910010100) {\n+                        if (status == 0) {\n+                                cm.sendYesNo(\"Thank you for aiding in the effort of feeding the Growlie. As a matter of fact, your team has already been rewarded for reaching this far. With this problem now solved, there is another issue happening right now, if you are interessed check #bTommy#k there for the info. So, are you returning straight to Henesys now?\");\n+                        } else if (status == 1) {\n+                                if(cm.getEventInstance().giveEventReward(cm.getPlayer())) {\n+                                        cm.warp(100000200);\n+                                }\n+                                else {\n+                                        cm.sendOk(\"It seems you are short on space in one of your inventories. Please check that first to get rewarded properly.\");\n+                                }\n                                 cm.dispose();\n-                                return;\n-                            }\n-                            onmap++;\n                         }\n-                    }\n-                    if (onmap < min) {\n-                        cm.sendOk(\"A member of your party is not presently in the map.\");\n-                        cm.dispose();\n-                        return;\n-                    }\n-                    if (cm.getClient().getChannelServer().getMapFactory().getMap(910010000).getAllPlayer().size() > 0) {\n-                        cm.sendOk(\"Someone is already attempting the PQ. Please wait for them to finish, or find another channel.\");\n-                        cm.dispose();\n-                        return;\n-                    }\n-                    var em = cm.getEventManager(\"HenesysPQ\");\n-                    if (em == null) { \n-                        cm.sendOk(\"This PQ is currently broken. Please report it on the forum!\");\n-                        cm.dispose();\n-                        return;\n-                    }\n-\n-                    var prop = em.getProperty(\"state\");\n-                    if (prop == null || prop.equals(\"0\")) { //Start the PQ\n-\t\t\t\t\t    cm.removeHPQItems();\n-                        em.setProperty(\"latestLeader\", cm.getPlayer().getName());\n-                        if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap())) {\n-                            cm.sendOk(\"A party in your name is already registered in this event.\");\n-                            cm.dispose();\n-                            return;\n-                        }\n-                    } else {\n-                        cm.sendOk(\"Someone is already attempting the PQ. Please wait for them to finish, or find another channel.\");\n-                        cm.dispose();\n-                        return;\n-                    }\n-                    cm.dispose();\n-                }\n-            }\n-        } else if (cm.getPlayer().getMap().getId() == 910010100 || cm.getPlayer().getMap().getId() == 910010400) {\n-            if (status == 0) {\n-                cm.sendSimple(\"I appreciate you giving some rice cakes for the hungry Growlie. It looks like you have nothing else to do now. Would you like to leave this place?\\r\\n#L0#I want to give you the rest of my rice cakes.#l\\r\\n#L1#Yes, please get me out of here.#l\");\n-            } else if (status == 1) {\n-                chosen = selection;\n-                if (selection == 0) {\n-                    if (cm.getPlayer().getGivenRiceCakes() >= 20) {\n-                        if (cm.getPlayer().getGottenRiceHat()) {\n-                            cm.sendNext(\"Do you like the hat I gave you? I ate so much of your rice cake that I will have to say no to your offer of rice cake for a little while.\");\n-                            cm.dispose();\n-                        } else {\n-                            cm.sendYesNo(\"I appreciate the thought, but I am okay now. I still have some of the rice cakes you gave me stored at home. To show you my appreciation, I prepared a small gift for you. Would you like to accept it?\");\n+                } else if (cm.getMapId() == 910010400) {\n+                        if (status == 0) {\n+                                cm.sendYesNo(\"So, are you returning to Henesys now?\");\n+                        } else if (status == 1) {\n+                                if(cm.getEventInstance() == null) {\n+                                        cm.warp(100000200);\n+                                } else if(cm.getEventInstance().giveEventReward(cm.getPlayer())) {\n+                                        cm.warp(100000200);\n+                                } else {\n+                                        cm.sendOk(\"It seems you are short on space in one of your inventories. Please check that first to get rewarded properly.\");\n+                                }\n+                                cm.dispose();\n                         }\n-                    }\n-                } else if (selection == 1) {\n-                    cm.warp(100000200);\n-                    cm.dispose();\n                 }\n-                cm.dispose();\n-            } else if (status == 2) {\n-                if (chosen == 1) {\n-                    if (cm.canHold(1002798)) { // we will let them try again if they can't\n-                        cm.gainItem(1002798);\n-                        cm.setGottenRiceHat(true);\n-                        cm.sendNext(\"It will really go well with you. I promise.\");\n-                    } else {\n-                        cm.getPlayer().dropMessage(1, \"EQUIP inventory full.\");\n-                    }\n-                    cm.dispose();\n-                } else if (cm.getPlayer().getGivenRiceCakes() < 20) {\n-                    cm.sendOk(\"Thank you for rice cake number \" + cm.getPlayer().getGivenRiceCakes() + \"!! I really appreciate it!\");\n-                }\n-            }\n         }\n-    }\n-}\n-*/\n\\ No newline at end of file\n+}\n\\ No newline at end of file"}, {"sha": "0b3e42dc69b9bcaa585105052db02050358c0145", "filename": "scripts/npc/world0/1012113.js", "status": "modified", "additions": 41, "deletions": 33, "changes": 74, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012113.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012113.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1012113.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -20,7 +20,7 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /**\n- * @author BubblesDev\n+ * @author BubblesDev, Ronan\n  * @npc Tommy (HPQ)\n  */\n var status = 0;\n@@ -30,37 +30,45 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode < 1) {\n-        cm.dispose();\n-    } else {\n-        status++;\n-        if (cm.getPlayer().getMap().getId() == 910010100) { //Clear map\n-            if (status == 0) {\n-                cm.sendNext(\"Hello, there! I'm Tommy. There's a Pig Town nearby where we're standing. The pigs there are rowdy and uncontrollable to the point where they have stolen numerous weapons from travelers. They were kicked out from their towns, and are currently hiding out at the Pig Town.\");\n-            } else if (status == 1) {\n-                cm.sendYesNo(\"What do you think about making your way there with your party members and teach those rowdy pigs a lesson?\");\n-            } else if (status == 2) {\n-\t\t\t\tcm.warp(910010200);\n-\t\t\t\tcm.dispose();\n-\t\t\t\treturn;\n-            }  \n-        } else if (cm.getPlayer().getMap().getId() == 910010200) { //Bonus map\n-        \tif (status == 0) {\n-\t\t\t\tcm.sendYesNo(\"Would you like to exit the bonus now?\");\n-        \t} else {    \t\t\t\t\n-\t        \tcm.warp(910010400);  \n-\t\t\t\tcm.dispose();\n-\t\t\t\treturn;\n-\t\t\t}\n-        } else if (cm.getPlayer().getMap().getId() == 910010300) { //Exit map\n-        \t\tif (status == 0) {\n-        \t\t\tcm.sendOk(\"You will now be warped out, thank you for helping us!\");\n-        \t\t} else {\n-\t        \t\tcm.warp(100000200);  \n-\t    \t\t\tcm.dispose();\n-\t\t\t\t\treturn;\n-    \t\t\t}\n-        \t}\n+        if (mode < 1) {\n+                cm.dispose();\n+        } else {\n+                status++;\n+                if (cm.getPlayer().getMap().getId() == 910010100) { //Clear map\n+                        if (status == 0) {\n+                                cm.sendNext(\"Hello, there! I'm Tommy. There's a Pig Town nearby where we're standing. The pigs there are rowdy and uncontrollable to the point where they have stolen numerous weapons from travelers. They were kicked out from their towns, and are currently hiding out at the Pig Town.\");\n+                        } else if (status == 1) {\n+                                if(cm.isLeader()) {\n+                                        cm.sendYesNo(\"What do you think about making your way there with your party members and teach those rowdy pigs a lesson?\");\n+                                }\n+                                else {\n+                                        cm.sendOk(\"Interessed? Tell your party leader to talk to me to head there!\");\n+                                        cm.dispose();\n+                                        return;\n+                                }\n+                        } else if (status == 2) {\n+                                cm.getEventInstance().startEventTimer(5 * 60000);                \n+                                cm.getEventInstance().warpEventTeam(910010200);\n+                                \n+                                cm.dispose();\n+                                return;\n+                        }\n+                } else if (cm.getPlayer().getMap().getId() == 910010200) { //Bonus map\n+                        if (status == 0) {\n+                                cm.sendYesNo(\"Would you like to exit the bonus now?\");\n+                        } else {\n+                                cm.warp(910010400);\n+                                cm.dispose();\n+                                return;\n+                        }\n+                } else if (cm.getPlayer().getMap().getId() == 910010300) { //Exit map\n+                        if (status == 0) {\n+                                cm.sendOk(\"You will now be warped out, thank you for helping us!\");\n+                        } else {\n+                                cm.warp(100000200);\n+                                cm.dispose();\n+                                return;\n+                        }\n+                }\n         }\n }\n-\t\n\\ No newline at end of file"}, {"sha": "357cb62893c769127d2cd9c291c921378497191c", "filename": "scripts/npc/world0/1012114.js", "status": "modified", "additions": 82, "deletions": 90, "changes": 172, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012114.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/1012114.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1012114.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,104 +1,96 @@\n /*\n   Growlie (that fatass uhh.. hungry lion or whatever)\n   FightDesign @RageZONE\n+\n+  Ronan\n   */\n-importPackage(Packages.net.world);\n-importPackage(Packages.tools);\n-importPackage(java.awt);\n \n var status = 0;\n var chosen = -1;\n \n+function clearStage(stage, eim) {\n+        eim.setProperty(stage + \"stageclear\", \"true\");\n+        eim.showClearEffect(true);\n+\n+        eim.giveEventPlayersStageReward(stage);\n+}\n+\n function start() {\n-    if (cm.isLeader()) {\n-\t\tvar eim = cm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + cm.getParty().getLeader().getName());\n-\t    if (eim.getProperty(\"clear\").equals(\"true\")) {\n-\t\t    status = 50;\n-\t\t    cm.sendNext(\"Mmmm ... this is delicious. Please come see me next time for more #b#t4001101##k. Have a safe trip home!\");\n-\t\t} else\n-        cm.sendSimple(\"Growl! I am Growlie, always ready to protect this place. What brought you here?\\r\\n#b#L0# Please tell me what this place is all about.#l\\r\\n#L1# I have brought #t4001101#.#l\\r\\n#L2# I would like to leave this place.#l\");\n-    } else {\n-        cm.sendSimple(\"Growl! I am Growlie, always ready to protect this place. What brought you here?\\r\\n#b#L0# Please tell me what this place is all about.#l\\r\\n#L2# I would like to leave this place.#l\");\n-    }\n+        status = -1;\n+        action(1, 0, 0);\n }\n \n function action(mode, type, selection) {\n-    if (mode < 0) {\n-        cm.dispose();\n-\t\treturn;\n-    } else {\n-\t    if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n-        if (mode == 0)\n-            status += chosen == 2 ? 1 : -1;\n-        else\n-            status++;\n-\t\tif (status == 51) {\n-\t\t    var eim = cm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + cm.getParty().getLeader().getName());\n-\t\t\teim.clearPQ();\n-            cm.dispose();\n-\t\t\treturn;\n-\t\t}\n-        if (status == 1) {\n-\t\t    if (chosen == -1)\n-\t\t\t    chosen = selection;\n-            if (chosen == 0) {\n-                cm.sendNext(\"This place can be best described as the prime spot where you can taste the delicious rice cakes made by Moon Bunny every full moon.\");\n-            } else if (chosen == 1) {\n-                if (cm.haveItem(4001101, 10)) {\n-                    cm.sendNext(\"Oh... isn't this rice cake made by Moon Bunny? Please hand me the rice cake.\");\n-                } else {\n-                    cm.sendOk(\"I advise you to check and make sure that you have indeed gathered up #b10 #t4001101#s#k.\");\n-                    cm.dispose();\n-                }\n-            } else if (chosen == 2) {\n-                cm.sendYesNo(\"Are you sure you want to leave?\");\n-            }\n-\t\t\telse {\n-\t\t\t    cm.dispose();\n-\t\t\t\treturn;\n-\t\t\t}\n-        } else if (status == 2) {\n-            if (chosen == 0) {\n-                cm.sendNextPrev(\"Gather up the primrose seeds from the primrose leaves all over this area, and plant the seeds at the footing near the crescent moon to see the primrose bloom. There are 6 types of primroses, and all of them require different footings. It is imperative that the footing fits the seed of the flower.\");\n-            } else if (chosen == 1) {\n-                cm.sendNext(\"Mmmm ... this is delicious. Please come see me next time for more #b#t4001101##k. Have a safe trip home!\");\n-                cm.gainItem(4001101, -10);\n-                cm.givePartyExp(\"HenesysPQ\");\n-                var eim = cm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + cm.getParty().getLeader().getName());\n-\t\t\t\teim.setProperty(\"clear\", \"true\");\n-\t\t\t\tvar map = eim.getMapInstance(cm.getPlayer().getMapId());\n-\t\t\t\tmap.allowSummonState(false);\n-\t\t\t\tmap.killAllMonstersNotFriendly();\n-\t\t\t\tmap.broadcastMessage(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n-\t\t\t\tmap.broadcastMessage(MaplePacketCreator.playSound(\"Party1/Clear\"));\n-\t\t\t\tcm.dispose();\n-            } else {\n-\t\t\t     if (mode == 1) {\n-\t\t\t     \tvar eim = cm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + cm.getParty().getLeader().getName());\n-\t\t\t\t \teim.disbandParty();\n-\t\t\t\t } else {\n-\t\t\t\t \tcm.sendOk(\"You better collect some delicious rice cakes for me then, because time is running out, Growl !\");\n-\t\t\t\t }\n-\t\t\t\t cm.dispose();\n-\t\t\t}\n-        } else if (status == 3) {\n-            if (chosen == 0) {\n-                cm.sendNextPrev(\"When the flowers of primrose blooms, the full moon will rise, and that's when the Moon Bunnies will appear and start pounding the mill. Your task is to fight off the monsters to make sure that Moon Bunny can concentrate on making the best rice cake possible.\");\n-            } else if (chosen == 1) {\n-\t\t\t\tvar eim = cm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + cm.getParty().getLeader().getName());\n-\t\t\t\teim.clearPQ();\n+        if (mode < 0) {\n                 cm.dispose();\n-            }\n-        } else if (status == 4) {\n-            if (chosen == 0) {\n-                cm.sendNextPrev(\"I would like for you and your party members to cooperate and get me 10 rice cakes. I strongly advise you to get me the rice cakes within the allotted time.\");\n-            }\n+                return;\n         } else {\n-\t\t    cm.dispose();\n-\t\t}\n-    \n-    }\n-}\t\n\\ No newline at end of file\n+                if (mode == 0 && status == 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 0)\n+                        status += ((chosen == 2) ? 1 : -1);\n+                else\n+                        status++;\n+                    \n+                if (status == 0) {\n+                        if (cm.isLeader()) {\n+                                cm.sendSimple(\"Growl! I am Growlie, always ready to protect this place. What brought you here?\\r\\n#b#L0# Please tell me what this place is all about.#l\\r\\n#L1# I have brought #t4001101#.#l\\r\\n#L2# I would like to leave this place.#l\");\n+                        } else {\n+                                cm.sendSimple(\"Growl! I am Growlie, always ready to protect this place. What brought you here?\\r\\n#b#L0# Please tell me what this place is all about.#l\\r\\n#L2# I would like to leave this place.#l\");\n+                        }\n+                } else if (status == 1) {\n+                        if (chosen == -1)\n+                                chosen = selection;\n+                        if (chosen == 0) {\n+                                cm.sendNext(\"This place can be best described as the prime spot where you can taste the delicious rice cakes made by Moon Bunny every full moon.\");\n+                        } else if (chosen == 1) {\n+                                if (cm.haveItem(4001101, 10)) {\n+                                        cm.sendNext(\"Oh... isn't this rice cake made by Moon Bunny? Please hand me the rice cake. Mmmm ... these seems delicious. Please come see me next time for more #b#t4001101##k. Have a safe trip home!\");\n+                                } else {\n+                                        cm.sendOk(\"I advise you to check and make sure that you have indeed gathered up #b10 #t4001101#s#k.\");\n+                                        cm.dispose();\n+                                }\n+                        } else if (chosen == 2) {\n+                                cm.sendYesNo(\"Are you sure you want to leave?\");\n+                        }\n+                        else {\n+                                cm.dispose();\n+                                return;\n+                        }\n+                } else if (status == 2) {\n+                        if (chosen == 0) {\n+                                cm.sendNextPrev(\"Gather up the primrose seeds from the primrose leaves all over this area, and plant the seeds at the footing near the crescent moon to see the primrose bloom. There are 6 types of primroses, and all of them require different footings. It is imperative that the footing fits the seed of the flower.\");\n+                        } else if (chosen == 1) {\n+                                cm.gainItem(4001101, -10);\n+\n+                                var eim = cm.getEventInstance();\n+                                clearStage(1, eim);\n+\n+                                var map = eim.getMapInstance(cm.getPlayer().getMapId());\n+                                map.killAllMonstersNotFriendly();\n+\n+                                eim.clearPQ();\n+                                cm.dispose();\n+                        } else {\n+                                if (mode == 1) {\n+                                        cm.warp(910010300);\n+                                } else {\n+                                        cm.sendOk(\"You better collect some delicious rice cakes for me then, because time is running out, Growl!\");\n+                                }\n+                                cm.dispose();\n+                        }\n+                } else if (status == 3) {\n+                        if (chosen == 0) {\n+                                cm.sendNextPrev(\"When the flowers of primrose blooms, the full moon will rise, and that's when the Moon Bunnies will appear and start pounding the mill. Your task is to fight off the monsters to make sure that Moon Bunny can concentrate on making the best rice cake possible.\");\n+                        }\n+                } else if (status == 4) {\n+                        if (chosen == 0) {\n+                                cm.sendNextPrev(\"I would like for you and your party members to cooperate and get me 10 rice cakes. I strongly advise you to get me the rice cakes within the allotted time.\");\n+                        }\n+                } else {\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "badae533b7d387c0850c620cac35896aec76ce89", "filename": "scripts/npc/world0/2133000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/2133000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/npc/world0/2133000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -27,7 +27,7 @@ function action(mode, type, selection) {\n                         status--;\n \n                 if (status == 0) {\n-                        em = cm.getEventManager(\"Ellin\");\n+                        em = cm.getEventManager(\"EllinPQ\");\n                         if(em == null) {\n                                 cm.sendOk(\"The Ellin PQ has encountered an error.\");\n                                 cm.dispose();"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108000.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108000.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108001.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108001.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108002.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108002.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108003.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108003.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108004.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108004.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "cd257a80acfc21ad46b481dffe28b843cb587cf5", "filename": "scripts/reactor/9108005.js", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/scripts/reactor/9108005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9108005.js?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -1,15 +1,15 @@\n \n function act() {\n-\tvar em = rm.getEventManager(\"HenesysPQ\").getInstance(\"HenesysPQ_\" + rm.getParty().getLeader().getName());\n-\tif (em != null) {\n+\tvar eim = rm.getEventInstance();\n+\tif (eim != null) {\n \t\tvar react = rm.getReactor().getMap().getReactorByName(\"fullmoon\");\n-\t\tvar stage = parseInt(em.getProperty(\"stage\")) + 1;\n+\t\tvar stage = parseInt(eim.getProperty(\"stage\")) + 1;\n \t\tvar newStage = stage.toString();\n-\t\tem.setProperty(\"stage\", newStage);\n+\t\teim.setProperty(\"stage\", newStage);\n \t\treact.forceHitReactor(react.getState() + 1);\n-\t\tif (em.getProperty(\"stage\").equals(\"6\")) {\n+\t\tif (eim.getProperty(\"stage\").equals(\"6\")) {\n \t\t\trm.mapMessage(6, \"Protect the Moon Bunny!!!\");\n-\t\t\tvar map = em.getMapInstance(rm.getReactor().getMap().getId());\n+\t\t\tvar map = eim.getMapInstance(rm.getReactor().getMap().getId());\n \t\t\tmap.allowSummonState(true);\n \t\t\tmap.spawnMonsterOnGroundBelow(9300061, -183, -433);\n \t\t}"}, {"sha": "bf26ebb2d87f370db6605e4fe5c9f294400d95e2", "filename": "sql/db_database.sql", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -17098,16 +17098,6 @@ INSERT INTO `reactordrops` (`reactordropid`, `reactorid`, `itemid`, `chance`, `q\n (701, 2612001, 4001135, 1, -1),\n (754, 200002, 4010001, 1, -1),\n (753, 200001, 4020001, 1, -1),\n-(704, 9102003, 4001095, 3, -1),\n-(705, 9102003, 4001096, 3, -1),\n-(706, 9102004, 4001096, 3, -1),\n-(707, 9102004, 4001097, 3, -1),\n-(708, 9102005, 4001097, 3, -1),\n-(709, 9102005, 4001098, 3, -1),\n-(710, 9102006, 4001098, 3, -1),\n-(711, 9102006, 4001099, 3, -1),\n-(712, 9102007, 4001099, 3, -1),\n-(713, 9102007, 4001100, 3, -1),\n (714, 2002001, 4001063, 1, -1),\n (715, 2002002, 4001052, 1, -1),\n (716, 2002003, 4001055, 1, -1),\n@@ -17142,7 +17132,6 @@ INSERT INTO `reactordrops` (`reactordropid`, `reactorid`, `itemid`, `chance`, `q\n (752, 200001, 4010005, 1, -1),\n (751, 200000, 4020004, 1, -1),\n (750, 200000, 4010004, 1, -1),\n-(749, 9102002, 4001453, 1, -1),\n (755, 200002, 4020005, 1, -1),\n (756, 200003, 4010000, 1, -1),\n (757, 200003, 4010003, 1, -1),"}, {"sha": "c643c4463fab1c129722ba0e58e0666dcf522ecb", "filename": "sql/db_drops.sql", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -19104,13 +19104,17 @@\n   DELETE FROM drop_data WHERE itemid=1302056 AND dropperid < 8000000;\n \n   # remove belts dropping from mobs\n-  DELETE FROM drop_data where itemid>=1132000 and itemid<=1132004;\n+  DELETE FROM drop_data WHERE itemid>=1132000 AND itemid<=1132004;\n+\n+  # remove items being dropped from mobs in HPQ\n+  DELETE FROM drop_data WHERE dropperid >= 9300061 AND dropperid <= 9300064;\n+  DELETE FROM drop_data WHERE dropperid >= 9300081 AND dropperid <= 9300083;\n \n   # remove key of dimension dropping outside PQ\n-  DELETE FROM drop_data where itemid=4001023 and dropperid!=9300012;\n+  DELETE FROM drop_data WHERE itemid=4001023 AND dropperid!=9300012;\n \n   # make Sword Earrings not drop by normal means, just like Shield Earrings\n-  DELETE FROM drop_data where itemid=1032030;\n+  DELETE FROM drop_data WHERE itemid=1032030;\n \n   # remove every not-card drop from bosses out of their natural habitat\n   DELETE FROM drop_data WHERE dropperid >= 9300184 AND dropperid < 9300215 AND (itemid < 2380000 OR itemid >= 2390000);\n@@ -19192,6 +19196,12 @@\n     (2202004, 2020009, 10, -1),\n     (2202004, 2020011, 15, -1),\n     (2202004, 2020012, 15, -1),\n-    (2202004, 2020013, 15, -1);\n+    (2202004, 2020013, 15, -1),\n+    (9102002, 4001095, 3, -1),\n+    (9102003, 4001096, 3, -1),\n+    (9102004, 4001097, 3, -1),\n+    (9102005, 4001098, 3, -1),\n+    (9102006, 4001099, 3, -1),\n+    (9102007, 4001100, 3, -1);\n \n   #global data already updated\n\\ No newline at end of file"}, {"sha": "e0a9c76cc0586d83bcfc0f74cd6c7be90622bd11", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -5054,6 +5054,10 @@ public boolean skillIsCooling(int skillId) {\n     }\n \n     public void startFullnessSchedule(final int decrease, final MaplePet pet, int petSlot) {\n+        if(isGM() && ServerConstants.GM_PETS_NEVER_HUNGRY || ServerConstants.PETS_NEVER_HUNGRY) {\n+            return;\n+        }\n+        \n         ScheduledFuture<?> schedule;\n         schedule = TimerManager.getInstance().register(new Runnable() {\n             @Override"}, {"sha": "402b344bfc538824d7426c13c6d4de1595ba2b0e", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -86,17 +86,17 @@\n         try {\n             p.load(new FileInputStream(\"configuration.ini\"));\n \n-    //Server Host\n-    ServerConstants.HOST = p.getProperty(\"HOST\");\n+            //Server Host\n+            ServerConstants.HOST = p.getProperty(\"HOST\");\n \n-    //Sql Database\n-    ServerConstants.DB_URL = p.getProperty(\"URL\");\n-    ServerConstants.DB_USER = p.getProperty(\"DB_USER\");\n-    ServerConstants.DB_PASS = p.getProperty(\"DB_PASS\");\n+            //Sql Database\n+            ServerConstants.DB_URL = p.getProperty(\"URL\");\n+            ServerConstants.DB_USER = p.getProperty(\"DB_USER\");\n+            ServerConstants.DB_PASS = p.getProperty(\"DB_PASS\");\n \n-    //java8 And Shutdownhook\n-    ServerConstants.JAVA_8 = p.getProperty(\"JAVA8\").equalsIgnoreCase(\"TRUE\");\n-    ServerConstants.SHUTDOWNHOOK = p.getProperty(\"SHUTDOWNHOOK\").equalsIgnoreCase(\"true\");\n+            //java8 And Shutdownhook\n+            ServerConstants.JAVA_8 = p.getProperty(\"JAVA8\").equalsIgnoreCase(\"TRUE\");\n+            ServerConstants.SHUTDOWNHOOK = p.getProperty(\"SHUTDOWNHOOK\").equalsIgnoreCase(\"true\");\n \n         } catch (Exception e) {\n             e.printStackTrace();"}, {"sha": "6ec92858eaa4509e1bdb3ed8d957787d30b7b9ae", "filename": "src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -48,12 +48,22 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\tint damage = Randomizer.nextInt(((monster.getMaxHp() / 13 + monster.getPADamage() * 10)) * 2 + 500) / 10; //Beng's formula.\n \t\t//  int damage = monster.getStats().getPADamage() + monster.getStats().getPDDamage() - 1;\n \n+                if (monster.getHp() - damage < 1) {     // friendly dies\n+                        if(monster.getId() == 9300102) {\n+                                monster.getMap().broadcastMessage(MaplePacketCreator.serverNotice(6, \"The Watch Hog has been injured by the aliens. Better luck next time...\"));\n+                        }\n+                        else if (monster.getId() == 9300061) {  //moon bunny\n+                                monster.getMap().broadcastMessage(MaplePacketCreator.serverNotice(6, \"The Moon Bunny went home because he was sick.\"));\n+                        }\n+                        else if(monster.getId() == 9300093) {   //tylus\n+                                monster.getMap().broadcastMessage(MaplePacketCreator.serverNotice(6, \"Tylus has fallen by the overwhelming forces of this ambush.\"));\n+                        }\n+                        \n+                        c.getPlayer().getMap().killFriendlies(monster);\n+                }\n+                \n \t\tif (monster.getId() == 9300061) {\n-\t\t\tif (monster.getHp() - damage < 1) {\n-\t\t\t\tmonster.getMap().broadcastMessage(MaplePacketCreator.serverNotice(6, \"The Moon Bunny went home because he was sick.\"));\n-\t\t\t\tc.getPlayer().getEventInstance().getMapInstance(monster.getMap().getId()).killFriendlies(monster);\n-\t\t\t}\n-\t\t\tMapleMap map = c.getPlayer().getEventInstance().getMapInstance(monster.getMap().getId());\n+                        MapleMap map = c.getPlayer().getEventInstance().getMapInstance(monster.getMap().getId());\n \t\t\tmap.addBunnyHit();\n \t\t}\n "}, {"sha": "9b5aa775aea9b3160e3d4fdb0abd531b993f8f36", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -230,15 +230,15 @@ public void run() {\n         \n         public void stopEventTimer() {\n                 if(event_schedule != null) {\n-                    event_schedule.cancel(false);\n-                    event_schedule = null;\n+                        event_schedule.cancel(false);\n+                        event_schedule = null;\n                 }\n                 dismissEventTimer();\n         }\n         \n         private void dismissEventTimer() {\n                 for(MapleCharacter chr: getPlayers()) {\n-                    chr.getClient().getSession().write(MaplePacketCreator.removeClock());\n+                        chr.getClient().getSession().write(MaplePacketCreator.removeClock());\n                 }\n                 \n                 event_schedule = null;\n@@ -302,7 +302,7 @@ public int getPlayerCount() {\n         private List<MapleCharacter> getPlayerList() {\n                 rL.lock();\n                 try {\n-                    return new LinkedList<>(chars);\n+                        return new LinkedList<>(chars);\n                 } finally {\n                         rL.unlock();\n                 }\n@@ -412,8 +412,8 @@ public int getKillCount(MapleCharacter chr) {\n         \n         public void cancelSchedule() {\n             if(event_schedule != null) {\n-                event_schedule.cancel(false);\n-                event_schedule = null;\n+                    event_schedule.cancel(false);\n+                    event_schedule = null;\n             }\n         }\n \n@@ -860,11 +860,14 @@ public final void recoverOpenedGate(MapleCharacter chr, int thisMapId) {\n                 }\n         }\n         \n-        public final void linkToNextStage(int thisStage, String eventFamily, int thisMapId) {\n+        public final void giveEventPlayersStageReward(int thisStage) {\n                 List<Integer> list = getClearStageBonus(thisStage);     // will give bonus exp & mesos to everyone in the event\n                 giveEventPlayersExp(list.get(0));\n                 giveEventPlayersMeso(list.get(1));\n-            \n+        }\n+        \n+        public final void linkToNextStage(int thisStage, String eventFamily, int thisMapId) {\n+                giveEventPlayersStageReward(thisStage);\n                 thisStage--;    //stages counts from ONE, scripts from ZERO\n             \n                 MapleMap nextStage = getMapInstance(thisMapId);"}, {"sha": "55a9b1f9455c2d0999a7b120f9d46e65ac911480", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 16, "deletions": 17, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/3fc338467ba0646c4609aba17d1ed2082c64fbad/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=3fc338467ba0646c4609aba17d1ed2082c64fbad", "patch": "@@ -754,7 +754,9 @@ public void monsterCloakingDevice() {\n     }\n \n     public void softKillAllMonsters() {\n-        \n+        for (SpawnPoint spawnPoint : monsterSpawn) {\n+            spawnPoint.setDenySpawn(true);\n+        }\n         \n         for (MapleMapObject monstermo : getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER))) {\n             MapleMonster monster = (MapleMonster) monstermo;\n@@ -768,6 +770,10 @@ public void softKillAllMonsters() {\n     }\n \n     public void killAllMonstersNotFriendly() {\n+        for (SpawnPoint spawnPoint : monsterSpawn) {\n+            spawnPoint.setDenySpawn(true);\n+        }\n+        \n         for (MapleMapObject monstermo : getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER))) {\n             MapleMonster monster = (MapleMonster) monstermo;\n             if (monster.getStats().isFriendly()) {\n@@ -1453,17 +1459,6 @@ public void addPlayer(final MapleCharacter chr) {\n         }\n         if (mapid == 923010000 && getMonsterById(9300102) == null) { // Kenta's Mount Quest\n             spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(9300102), new Point(77, 426));\n-        } else if (mapid == 910010200) {  // Henesys Party Quest Bonus\n-            chr.announce(MaplePacketCreator.getClock(60 * 5));\n-            TimerManager.getInstance().schedule(new Runnable() {\n-\n-                @Override\n-                public void run() {\n-                    if (chr.getMapId() == 910010200) {\n-                        chr.changeMap(910010400);\n-                    }\n-                }\n-            }, 5 * 60 * 1000);\n         } else if (mapid == 200090060) { // To Rien\n             chr.announce(MaplePacketCreator.getClock(60));\n             TimerManager.getInstance().schedule(new Runnable() {\n@@ -2216,6 +2211,8 @@ public void instanceMapFirstSpawn(int difficulty, boolean isPq) {\n     }\n \n     public void instanceMapRespawn() {\n+        if(!allowSummons) return;\n+        \n         final int numShouldSpawn = (short) ((monsterSpawn.size() - spawnedMonstersOnMap.get()));//Fking lol'd\n         if (numShouldSpawn > 0) {\n             List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n@@ -2256,9 +2253,11 @@ public void setAllowSpawnPointInRange(boolean allow, Point from, double rangeSq)\n     }\n \n     public void respawn() {\n+        if(!allowSummons) return;\n+        \n         chrRLock.lock();\n         try {\n-            if (characters.isEmpty()) {\n+            if(characters.isEmpty()) {\n                 return;\n             }\n         }\n@@ -2276,16 +2275,16 @@ public void respawn() {\n         */\n         \n         short numShouldSpawn = (short) ((monsterSpawn.size() - spawnedMonstersOnMap.get()));//Fking lol'd\n-        if (numShouldSpawn > 0) {\n+        if(numShouldSpawn > 0) {\n             List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n             Collections.shuffle(randomSpawn);\n             short spawned = 0;\n-            for (SpawnPoint spawnPoint : randomSpawn) {\n-                if (spawnPoint.shouldSpawn()) {\n+            for(SpawnPoint spawnPoint : randomSpawn) {\n+                if(spawnPoint.shouldSpawn()) {\n                     spawnMonster(spawnPoint.getMonster());\n                     spawned++;\n                     \n-                    if (spawned >= numShouldSpawn) {\n+                    if(spawned >= numShouldSpawn) {\n                         break;\n                     }\n                 }"}]}]},
