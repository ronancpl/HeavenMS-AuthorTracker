{"fetchDate": "2019-12-19", "content": [{"sha": "f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6Zjc0ZGZiYjQ2YTFmYTEwZGNmYjdlMmQwYTVmNzFhN2QxYzI4YWU2MQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-01-16T17:34:52Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-01-16T17:34:52Z"}, "message": "Alliances & Pet autopot improvement + Crafters patch\n\nImproved Alliance invitations now using \"invite popups\" just like buddy, party and guild invites.\nPet autopot now properly uses up pots from the inventory, fetching from other inventory slots when one place has been completely used up but the \"stop criteria\" hasn't been fulfilled yet.\nPet autopot now properly detects pots with healing factor defined by the character's pool.\nFixed old exploit with mineral/jewel crafters.\nPatched Doorway's questlines.", "tree": {"sha": "3ec53166df7c0ccb265bcfbd0c195b426d9a4b3b", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/3ec53166df7c0ccb265bcfbd0c195b426d9a4b3b"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "html_url": "https://github.com/ronancpl/HeavenMS/commit/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "346d39c03af00bd49243c5b68b16f936911e1c81", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/346d39c03af00bd49243c5b68b16f936911e1c81", "html_url": "https://github.com/ronancpl/HeavenMS/commit/346d39c03af00bd49243c5b68b16f936911e1c81"}], "stats": {"total": 826, "additions": 619, "deletions": 207}, "files": [{"sha": "bb14bc4e372c76938cb9ceb713c0be273d7d6635", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -757,4 +757,13 @@ Corrigido item megafone permitindo o display de equipamentos n\n Incrementado portal de MK Castle agora permitindo uso dos 2 itens poss\ufffdveis.\n Resolvido alguns logs de erros disparados por mapas nulos no c\ufffddigo-fonte.\n Resolvido pequenos problemas de volatidade (nulos) nas referencias ao jogador em alguns handlers.\n-Corrigido alguns problemas com copyright em alguns arquivos.\n\\ No newline at end of file\n+Corrigido alguns problemas com copyright em alguns arquivos.\n+Corrigido exploit com refinadores de minerais permitindo n\ufffdmeros iguais ou menores que zero como entrada.\n+\n+14 - 15 Janeiro 2018,\n+Melhorado pet autopot, agora utilizando os outros slots do mesmo item caso o slot alvo tenha sido completamente usado.\n+Pet autopot agora considera o reuso de pots que fornecem ganho de porcentagem de HP ou MP.\n+Diminu\ufffddas levemente as chances de dropar os itens Moon Rock e Star Rock.\n+Fun\ufffd\ufffdo de listagem de itens no invent\ufffdrio agora ordena os itens de acordo com posi\ufffd\ufffdo dos mesmos.\n+Incrementado diversos aspectos das questlines das doorways em Victoria Island.\n+Melhorado mec\ufffdnica de convite para Alliances agora utilizando o bal\ufffdo apropriado, similar aos utilizados para Party e Guild.\n\\ No newline at end of file"}, {"sha": "83e0ef55122e4d9f3f86f57c292771de7654c07d", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -2,6 +2,8 @@\n <project-private xmlns=\"http://www.netbeans.org/ns/project-private/1\">\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"2\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n-        <group/>\n+        <group>\n+            <file>file:/C:/Nexon/MapleSolaxia/HeavenMS/scripts/portal/obstacle.js</file>\n+        </group>\n     </open-files>\n </project-private>"}, {"sha": "4e04309277cab8c4356d1b73761f37c5f0eeb5b0", "filename": "scripts/map/onUserEnter/677000001.js", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/677000001.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -1,15 +1,17 @@\n importPackage(Packages.server.life);\n \n function start(ms) {\n-\n+        var pos = new java.awt.Point(461, 61);\n \tvar mobId = 9400612;\n+        var mobName = \"Marbas\";\n+        \n \tvar player = ms.getPlayer();\n \tvar map = player.getMap();\n \n \tif(map.getMonsterById(mobId) != null){\n \t\treturn;   \t       \n \t}\n \n-\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), new java.awt.Point(461, 61));\n-\tplayer.message(\"Marbas has appeared!\");\n+\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), pos);\n+\tplayer.message(mobName + \" has appeared!\");\n }\n\\ No newline at end of file"}, {"sha": "f4f036aecec3b98306dbaac0886f9a02731d2aa4", "filename": "scripts/map/onUserEnter/677000003.js", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/677000003.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,17 @@\n+importPackage(Packages.server.life);\n+\n+function start(ms) {\n+        var pos = new java.awt.Point(467, 0);\n+\tvar mobId = 9400610;\n+        var mobName = \"Amdusias\";\n+        \n+\tvar player = ms.getPlayer();\n+\tvar map = player.getMap();\n+\n+\tif(map.getMonsterById(mobId) != null){\n+\t\treturn;   \t       \n+\t}\n+\n+\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), pos);\n+\tplayer.message(mobName + \" has appeared!\");\n+}\n\\ No newline at end of file"}, {"sha": "81ce286bb847c1d67ccce452de267433285da8d1", "filename": "scripts/map/onUserEnter/677000005.js", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/677000005.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,17 @@\n+importPackage(Packages.server.life);\n+\n+function start(ms) {\n+        var pos = new java.awt.Point(201, 80);\n+\tvar mobId = 9400609;\n+        var mobName = \"Andras\";\n+        \n+\tvar player = ms.getPlayer();\n+\tvar map = player.getMap();\n+\n+\tif(map.getMonsterById(mobId) != null){\n+\t\treturn;   \t       \n+\t}\n+\n+\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), pos);\n+\tplayer.message(mobName + \" has appeared!\");\n+}\n\\ No newline at end of file"}, {"sha": "d52195b309b56a464de157298389526fc74083eb", "filename": "scripts/map/onUserEnter/677000007.js", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/677000007.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,17 @@\n+importPackage(Packages.server.life);\n+\n+function start(ms) {\n+        var pos = new java.awt.Point(171, 50);\n+\tvar mobId = 9400611;\n+        var mobName = \"Crocell\";\n+        \n+\tvar player = ms.getPlayer();\n+\tvar map = player.getMap();\n+\n+\tif(map.getMonsterById(mobId) != null){\n+\t\treturn;   \t       \n+\t}\n+\n+\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), pos);\n+\tplayer.message(mobName + \" has appeared!\");\n+}\n\\ No newline at end of file"}, {"sha": "23969e4b4b7d68856c5dbd129c9bfcbd7e28855e", "filename": "scripts/map/onUserEnter/677000009.js", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/map/onUserEnter/677000009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/677000009.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -1,13 +1,17 @@\n importPackage(Packages.server.life);\n \n-function start(ms) {   \t       \n-\tspawnMob(251, -841, 9400613, ms.getPlayer().getMap());\n-}\n+function start(ms) {\n+        var pos = new java.awt.Point(251, -841);\n+\tvar mobId = 9400613;\n+        var mobName = \"Valefor\";\n+        \n+\tvar player = ms.getPlayer();\n+\tvar map = player.getMap();\n \n-function spawnMob(x, y, id, map) {\n-\tif(map.getMonsterById(id) != null)\n-\t\treturn;\n-\t\t\n-\tvar mob = MapleLifeFactory.getMonster(id);\n-\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(x, y));\n+\tif(map.getMonsterById(mobId) != null){\n+\t\treturn;   \t       \n+\t}\n+\n+\tmap.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(mobId), pos);\n+\tplayer.message(mobName + \" has appeared!\");\n }\n\\ No newline at end of file"}, {"sha": "ab5b6d7ae443fc40f655b7899e996e21c7b6c7ed", "filename": "scripts/npc/1012002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1012002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1012002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012002.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -106,7 +106,7 @@ function action(mode, type, selection) {\n         if (selectedType != 4)\n             selectedItem = selection;\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n         if (selectedType == 0) { //bow refine\n             var matSet = [[4003001,4000000],[4011001,4003000],[4003001,4000016],[4011001,4021006,4003000],[4011001,4011006,4021003,4021006,4003000],[4011004,4021000,4021004,4003000],[4021008,4011001,4011006,4003000,4000014]];\n             var matQtySet = [[5,30],[1,3],[30,50],[2,2,8],[5,5,3,3,30],[7,6,3,35],[1,10,3,40,50]];"}, {"sha": "735ae2179bf9c7763384b88041741d4650b70174", "filename": "scripts/npc/1022003.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1022003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1022003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1022003.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -136,7 +136,7 @@ function action(mode, type, selection) {\n             qty = 1;\n         }\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n         if (selectedType == 2){ //helmet refine\n             var itemSet = new Array(1002042,1002041,1002002,1002044,1002003,1002040,1002007,1002052,1002011,1002058,1002009,1002056,1002087,1002088,1002050,1002049,1002047,1002048,1002099,1002098,1002085,1002028,1002022,1002101);"}, {"sha": "c27b169d21a55a0f2a3535955915181278c8f3cc", "filename": "scripts/npc/1022004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1022004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1022004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1022004.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -116,7 +116,7 @@ function action(mode, type, selection) {\n             qty = 1;\n         }\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n         if (selectedType == 0){ //glove refine\n             var itemSet = new Array(1082003,1082000,1082004,1082001,1082007,1082008,1082023,1082009,1082059);"}, {"sha": "5e3b244b5a00caa2c3342565142d8434a399b0e4", "filename": "scripts/npc/1040000.js", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1040000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1040000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1040000.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,56 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(28177) && !cm.haveItem(4032479)) {\n+                                if(cm.canHold(4032479)) {\n+                                        cm.gainItem(4032479, 1);\n+                                        cm.sendOk(\"Huh, are you looking for me? Chief Stan sent you here, right? But hey, I am not the suspect you seek. If I have some proof? Here, take this and return it to #b#p1012003##k.\");\n+                                } else {\n+                                        cm.sendOk(\"Hey, make a slot available before talking to me.\");\n+                                }\n+                        } else {\n+                                cm.sendOk(\"Zzzzzz...\");\n+                        }\n+                    \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "781c7ad7859be4cfae8738a8ef80d6c0e515f084", "filename": "scripts/npc/1052002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1052002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1052002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052002.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -138,7 +138,7 @@ function action(mode, type, selection) {\n             qty = 1;\n         }\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n         if (selectedType == 0){ //glove refine\n             var itemSet = new Array(1082002,1082029,1082030,1082031,1082032,1082037,1082042,1082046,1082075,1082065,1082092);"}, {"sha": "96e967b04d10c601b34021aaa6acbb7064df6c26", "filename": "scripts/npc/1052003.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1052003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1052003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052003.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -129,7 +129,7 @@ function action(mode, type, selection) {\n                 qty = 1;\n             }\n             else\n-                qty = selection;\n+                qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n             last_use = false;\n "}, {"sha": "d887568ca7e7d2b2a3ba6824aca7600cb7a57983", "filename": "scripts/npc/1091003.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1091003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1091003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1091003.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -66,7 +66,7 @@ function action(mode, type, selection) {\n \t\t\tqty = 1;\n \t\t}\n \t\telse\n-\t\t\tqty = selection;\n+\t\t\tqty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n \t\tif (selectedType == 0){ //Making a Knuckler\n \t\t\tvar itemSet = new Array(1482001, 1482002, 1482003, 1482004, 1482005, 1482006, 1482007);"}, {"sha": "df6d2a287556be1cddb3ceb0fb088aa49a666db6", "filename": "scripts/npc/1092010.js", "status": "modified", "additions": 29, "deletions": 2, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1092010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/1092010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092010.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -30,6 +30,33 @@ No specific function, useless text.\n */\n \n function start() {\n-    cm.sendOk(\"(Scratch scratch...)\");\n-    cm.dispose();\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(!cm.haveItem(4220153)) {\n+                                cm.sendOk(\"(Scratch scratch...)\");\n+                                cm.dispose();\n+                        } else {\n+                                cm.sendYesNo(\"Hey, nice #bTreasure Map#k you have there? #rCan I keep it#k for the Nautilus crew, if you don't need it any longer?\");\n+                        }\n+                } else if(status == 1) {\n+                        cm.gainItem(4220153, -1);\n+                        cm.dispose();\n+                }\n+        }\n }"}, {"sha": "18a6a38ccc0a72c5afc10b79500f49b5353c8c9a", "filename": "scripts/npc/2020000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2020000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2020000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020000.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -182,7 +182,7 @@ function action(mode, type, selection) {\n             qty = 1;\n         }\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \t\t\n         if (selectedType == 5){ //arrow refine\n             var itemSet = new Array(2060000,2061000,2060001,2061001,2060002,2061002);"}, {"sha": "ea08cad408b36f7ded374390e74c69cdf73496ef", "filename": "scripts/npc/2040016.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2040016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2040016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2040016.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -196,7 +196,7 @@ function action(mode, type, selection) {\n             qty = 1;\n         }\n         else\n-            qty = selection;\n+            qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \t\t\n         var prompt = \"You want me to make \";\n         if (qty == 1)"}, {"sha": "632533d0e749360ece33ae0cea096ebe0bc0e338", "filename": "scripts/npc/2100001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2100001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2100001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100001.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -120,7 +120,7 @@ function action(mode, type, selection) {\n                 qty = 1;\n             }\n             else\n-                qty = selection;\n+                qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n \n             var prompt = \"You want me to make \";\n             if (qty == 1)"}, {"sha": "ac180ce8874456376831e388ecfd71600972e47d", "filename": "scripts/npc/2141002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2141002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/2141002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2141002.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -43,7 +43,7 @@ function action(mode, type, selection) {\n                     cm.warp(270050000);\n                 }\n                 else {\n-                    cm.sendOk(\"You cannot receive an event prize without having an empty room in your EQUIP, USE, SET-UP or ETC inventory.\");\n+                    cm.sendOk(\"You cannot receive an event prize without having an empty room in your EQUIP, USE, SET-UP and ETC inventory.\");\n                 }\n                 \n                 cm.dispose();"}, {"sha": "da34be4d2b90c7b32a19ea8e0950623b7390b40d", "filename": "scripts/npc/9000017.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9000017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9000017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9000017.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -58,7 +58,7 @@ function action(mode, type, selection) {\n     }\n         \n     else if (status == 3) {\n-        qty = selection;\n+        qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n         last_use = false;\n                 \n         var prompt = \"You want us to make \";"}, {"sha": "487c93a2966ceda95ebd52066b85de358b6b5107", "filename": "scripts/npc/9201096.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201096.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201096.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201096.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -58,7 +58,7 @@ function action(mode, type, selection) {\n     }\n         \n     else if (status == 3) {\n-        qty = selection;\n+        qty = (selection > 0) ? selection : (-selection <= 0 ? 1 : -selection);\n         last_use = false;\n                 \n         var prompt = \"So, you want me to make \";"}, {"sha": "64b0c24817923caef05858dfd6ca27adccb63f2f", "filename": "scripts/npc/9201128.js", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201128.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201128.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201128.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,30 @@\n+var map = 677000004;\n+var quest = 28179;\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tcm.dispose();\n+\treturn;\n+    }\n+    if (status == 0) {\n+        if (cm.isQuestStarted(quest)) {\n+            cm.sendYesNo(\"Would you like to move to #b#m\" + map + \"##k?\");\n+        } else {\n+            cm.sendOk(\"The entrance is blocked by a strange force.\");\n+            cm.dispose();\n+        }\n+    } else {\n+\tif(cm.haveItem(4001341, 1)) cm.gainItem(4001341, -1);\n+        if(cm.haveItem(4032478, 1)) cm.gainItem(4032478, -1);\n+\t\n+\tcm.warp(map, 0);\n+\tcm.dispose();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "58d4230c2f955546b24088a76adac2b3acd3d871", "filename": "scripts/npc/9201129.js", "status": "modified", "additions": 22, "deletions": 56, "changes": 78, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201129.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201129.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201129.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -1,61 +1,27 @@\n-/*\n-\tDemon's Doorway\n-\tMarbas the Demon! Quest\n-\tVictoria Road: The Tree That Grew III\n-*/\n+var map = 677000000;\n+var quest = 28198;\n+var status = -1;\n \n-var status;\n-\n-function start(){\n-\tstatus = -1;\n+function start(mode, type, selection) {\n \taction(1, 0, 0);\n }\n \n-function action(mode, type, selection){\n-\tif (mode == -1){\n-\t\tcm.dispose();\n-\t}\n-\telse{\n-\t\tif (mode == 0 && status ==0){\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n-\t\t\n-\t\tif (mode == 1)\n-\t\t\tstatus++;\n-\t\telse\n-\t\t\tstatus--;\n-\n-\t\tif (status == 0){\n-\t\t\tcm.sendNext(\"#r\\t[Requirements to Enter]\\r\\n\\r\\n\\t\\t1.#k Job must be Magician or Blaze Wizard.\\r\\n\\t\\t#r2.#k Must be under level 40.\\r\\n\\t\\t#r3.#k Must have #b#t4032495##k.\");\n-\t\t}\n-\t\telse if (status == 1){\n-\t\t\tvar jobId = cm.getJobId();\n-\n-\t\t\tif ((jobId >= 200 && jobId <= 232) || (jobId >= 1100 && jobId <= 1112)){\n-\t\t\t\tif (cm.getLevel() < 40){\n-\t\t\t\t\tif (cm.hasItem(4032495)){\n-\t\t\t\t\t\tcm.sendYesNo(\"#kAll conditions have been satisfied. Do you wish to enter?\");\n-\t\t\t\t\t}\n-\t\t\t\t\telse{\n-\t\t\t\t\t\tcm.sendOk(\"\\t\\tYou do not have #b#t4032495# #i4032495#\");\n-\t\t\t\t\t\tcm.dispose();\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t\telse{\n-\t\t\t\t\tcm.sendOk(\"\\tYour #blevel#k is too high.\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\telse{\n-\t\t\t\tcm.sendOk(\"\\tThis is not for you! #rBegone#k you fool!\");\n-\t\t\t\tcm.dispose();\n-\t\t\t}\n-\t\t}\n-\t\telse if (status == 2){\n-\t\t\tcm.warp(677000000, 2);\n-\n-\t\t\tcm.dispose();\n-\t\t}\n-\t}\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tcm.dispose();\n+\treturn;\n+    }\n+    if (status == 0) {\n+        if (cm.isQuestStarted(quest)) {\n+            cm.sendYesNo(\"Would you like to move to #b#m\" + map + \"##k?\");\n+        } else {\n+            cm.sendOk(\"The entrance is blocked by a strange force.\");\n+            cm.dispose();\n+        }\n+    } else {\n+\tcm.warp(map, 0);\n+\tcm.dispose();\n+    }\n }\n\\ No newline at end of file"}, {"sha": "797499a0c864336c9179ddd56246ec8b9cc4e85e", "filename": "scripts/npc/9201130.js", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201130.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201130.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201130.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -1,3 +1,5 @@\n+var map = 677000008;\n+var quest = 28219;\n var status = -1;\n \n function start(mode, type, selection) {\n@@ -12,16 +14,17 @@ function action(mode, type, selection) {\n \treturn;\n     }\n     if (status == 0) {\n-\t\tif (cm.isQuestStarted(28219)) {\n-\t\t\tcm.sendYesNo(\"Would you like to move to Valefor's Strolling Place?\");\n-\t\t} else {\n-\t\t\tcm.sendOk(\"The entrance is blocked by a strange force.\");\n-\t\t\tcm.dispose();\n-\t\t}\n+        if (cm.isQuestStarted(quest)) {\n+            cm.sendYesNo(\"Would you like to move to #b#m\" + map + \"##k?\");\n+        } else {\n+            cm.sendOk(\"The entrance is blocked by a strange force.\");\n+            cm.dispose();\n+        }\n     } else {\n \tif(cm.haveItem(4032485, 1)) cm.gainItem(4032485, -1);\n \tif(cm.haveItem(4001355, 1)) cm.gainItem(4001355, -1);\n-\tcm.warp(677000008,0);\n+        \n+\tcm.warp(map, 0);\n \tcm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "1a1b8efb69d2f97213e721eee1f2c5c3700448b2", "filename": "scripts/npc/9201131.js", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201131.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201131.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201131.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,31 @@\n+var map = 677000002;\n+var quest = 28238;\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tcm.dispose();\n+\treturn;\n+    }\n+    if (status == 0) {\n+        if (cm.isQuestStarted(quest)) {\n+            cm.sendYesNo(\"Would you like to move to #b#m\" + map + \"##k?\");\n+        } else {\n+            cm.sendOk(\"The entrance is blocked by a strange force.\");\n+            cm.dispose();\n+        }\n+    } else {\n+        if(cm.haveItem(4032481, 1)) cm.gainItem(4032481, -1);\n+\tif(cm.haveItem(4032482, 1)) cm.gainItem(4032482, -1);\n+        if(cm.haveItem(4032483, 1)) cm.gainItem(4032483, -1);\n+\t\n+\tcm.warp(map, 0);\n+\tcm.dispose();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "4b69ee3774d5861e5f89a553686f80e7d4fbf158", "filename": "scripts/npc/9201132.js", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201132.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/npc/9201132.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201132.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,34 @@\n+var map = 677000006;\n+var quest = 28256;\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tcm.dispose();\n+\treturn;\n+    }\n+    if (status == 0) {\n+        if (cm.isQuestStarted(quest)) {\n+            cm.sendYesNo(\"Would you like to move to #b#m\" + map + \"##k?\");\n+        } else {\n+            cm.sendOk(\"The entrance is blocked by a strange force.\");\n+            cm.dispose();\n+        }\n+    } else {\n+\tif(cm.haveItem(4001362, 1)) cm.gainItem(4001362, -cm.getItemQuantity(4001362));\n+        if(cm.haveItem(4001363, 1)) cm.gainItem(4001363, -cm.getItemQuantity(4001363));\n+        if(cm.haveItem(4032486, 1)) cm.gainItem(4032486, -1);\n+        if(cm.haveItem(4032488, 1)) cm.gainItem(4032488, -1);\n+        if(cm.haveItem(4032489, 1)) cm.gainItem(4032489, -1);\n+        if(cm.haveItem(4220153, 1)) cm.gainItem(4220153, -1);\n+        \n+\tcm.warp(map, 0);\n+\tcm.dispose();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "3ed68a42131d989d5e8e43b167dc27f78e46855d", "filename": "scripts/portal/raid_rest.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/portal/raid_rest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/portal/raid_rest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/raid_rest.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -32,12 +32,12 @@ function enter(pi) {\n                 return false;\n         }\n         \n-        if(pi.getPlayer().getEventInstance().giveEventReward(pi.getPlayer(), evLevel)) {\n+        if(!pi.getPlayer().getEventInstance().giveEventReward(pi.getPlayer(), evLevel)) {\n                 pi.warp(970030000);\n                 return true;\n         }\n         else {\n-                pi.message(\"You cannot receive an event prize without having an empty room in your EQUIP, USE, SET-UP or ETC inventory.\");\n+                pi.message(\"Make a room available on all EQUIP, USE, SET-UP and ETC inventory to claim an event prize.\");\n                 return false;\n         }\n }\n\\ No newline at end of file"}, {"sha": "bbad6f2f1e4e7c53d66e1e391a2abdfd4ff3a400", "filename": "scripts/reactor/1202003.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/reactor/1202003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/reactor/1202003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1202003.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,3 @@\n+function act() {\n+\trm.dropItems();\n+}"}, {"sha": "bbad6f2f1e4e7c53d66e1e391a2abdfd4ff3a400", "filename": "scripts/reactor/1202004.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/reactor/1202004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/scripts/reactor/1202004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1202004.js?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -0,0 +1,3 @@\n+function act() {\n+\trm.dropItems();\n+}"}, {"sha": "fbf92e00c309670897fa02408ec2bf1ed3f015cb", "filename": "sql/db_database.sql", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -3748,7 +3748,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (3530, 4240000, 4004003, 1, 1, 0, 10000),\n (3531, 4240000, 2043801, 1, 1, 0, 300),\n (3532, 4240000, 4006001, 1, 1, 0, 10000),\n-(3533, 4240000, 4021009, 1, 1, 0, 9000),\n+(3533, 4240000, 4021009, 1, 1, 0, 7000),\n (3534, 4240000, 1322016, 1, 1, 0, 700),\n (3535, 4240000, 1041074, 1, 1, 0, 800),\n (3536, 4240000, 1061069, 1, 1, 0, 800),\n@@ -4123,7 +4123,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (3904, 5120100, 4020001, 1, 1, 0, 90000),\n (3905, 5120100, 4010006, 1, 1, 0, 90000),\n (3906, 5120100, 4020007, 1, 1, 0, 90000),\n-(3907, 5120100, 4011007, 1, 1, 0, 30000),\n+(3907, 5120100, 4011007, 1, 1, 0, 7000),\n (3908, 5120100, 2044602, 1, 1, 0, 3000),\n (3909, 5120100, 1041082, 1, 1, 0, 8000),\n (3910, 5120100, 1061081, 1, 1, 0, 8000),\n@@ -16675,8 +16675,8 @@ INSERT INTO `reactordrops` (`reactordropid`, `reactorid`, `itemid`, `chance`, `q\n (125, 1022001, 4032319, 7, -1),\n (126, 1022002, 4001340, 1, 28167),\n (127, 1202000, 4001366, 1, 28194),\n-(128, 1202003, 4001346, 1, 28225),\n-(129, 1202004, 4001346, 1, 28225),\n+(128, 1202003, 4001346, 3, 28225),\n+(129, 1202004, 4001346, 3, 28225),\n (130, 1032000, 4032362, 1, 28252),\n (131, 1032000, 4032363, 1, 28252),\n (132, 1202004, 4032494, 1, 28255),"}, {"sha": "f476485896e81651705aacb09e5dd21734ecbf78", "filename": "sql/db_drops.sql", "status": "modified", "additions": 80, "deletions": 32, "changes": 112, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -96,8 +96,8 @@ USE `heavenms`;\n (9300219, 4000003, 1, 1, 0, 200000), \n (130100, 4030009, 1, 1, 0, 10000), \n (9300219, 4030009, 1, 1, 0, 10000), \n-(130100, 4001358, 1, 1, 0, 7000),\n-(9300219, 4001358, 1, 1, 0, 7000), \n+(130100, 4001358, 1, 1, 0, 20000),\n+(9300219, 4001358, 1, 1, 0, 20000), \n (130100, 2000000, 1, 1, 0, 40000), \n (9300219, 2000000, 1, 1, 0, 40000), \n (130100, 2040402, 1, 1, 0, 750), \n@@ -130,8 +130,8 @@ USE `heavenms`;\n (9300219, 1482001, 1, 1, 0, 700), \n (130101, 4000016, 1, 1, 0, 200000), \n (9300218, 4000016, 1, 1, 0, 200000), \n-(130101, 4001359, 1, 1, 0, 7000), \n-(9300218, 4001359, 1, 1, 0, 7000), \n+(130101, 4001359, 1, 1, 0, 24000), \n+(9300218, 4001359, 1, 1, 0, 24000), \n (130101, 2000000, 1, 1, 0, 40000), \n (9300218, 2000000, 1, 1, 0, 40000), \n (130101, 2040502, 1, 1, 0, 750), \n@@ -568,7 +568,7 @@ USE `heavenms`;\n (1110101, 4030009, 1, 1, 0, 10000), \n (1110101, 4001344, 1, 1, 0, 7000), \n (1110101, 4001356, 1, 1, 0, 7000), \n-(1110101, 4001360, 1, 1, 0, 7000), \n+(1110101, 4001360, 1, 1, 0, 12000), \n (1110101, 2000000, 1, 1, 0, 40000), \n (1110101, 2040802, 1, 1, 0, 750), \n (1110101, 2380008, 1, 1, 0, 0), \n@@ -2064,26 +2064,8 @@ USE `heavenms`;\n (9300221, 1061054, 1, 1, 0, 700), \n (2100103, 1072291, 1, 1, 0, 700), \n (9300221, 1072291, 1, 1, 0, 700), \n-(9400609, 2000003, 1, 4, 0, 40000), \n-(9400609, 2000002, 1, 4, 0, 40000), \n-(9400609, 2002004, 1, 4, 0, 10000), \n-(9400609, 4010000, 1, 1, 0, 7000), \n-(9400609, 4010004, 1, 1, 0, 7000), \n-(9400609, 4010002, 1, 1, 0, 7000), \n-(9400609, 4010001, 1, 1, 0, 7000), \n-(9400610, 2000002, 1, 4, 0, 40000), \n (9400623, 2000002, 1, 4, 0, 40000), \n-(9400610, 4010002, 1, 1, 0, 7000), \n (9400623, 4010002, 1, 1, 0, 7000), \n-(9400612, 4020000, 1, 1, 0, 7000),\n-(9400612, 4010001, 1, 1, 0, 7000), \n-(9400612, 4010002, 1, 1, 0, 7000), \n-(9400612, 2000003, 1, 4, 0, 40000), \n-(9400612, 2000002, 1, 4, 0, 40000), \n-(9400612, 4010000, 1, 1, 0, 7000), \n-(9400612, 1082257, 1, 1, 0, 40000), \n-(9400612, 1003032, 1, 1, 0, 40000), \n-(9400612, 1072420, 1, 1, 0, 40000), \n (2230112, 4000020, 1, 1, 0, 200000), \n (2230112, 4003004, 1, 1, 0, 7000), \n (2230112, 4000021, 1, 1, 0, 200000),\n@@ -7679,10 +7661,10 @@ USE `heavenms`;\n (9400502, 1072303, 1, 1, 0, 40000), \n (9500121, 1072303, 1, 1, 0, 700), \n (9500156, 1072303, 1, 1, 0, 700), \n-(4240000, 4021009, 1, 1, 0, 7000), \n-(9300334, 4021009, 1, 1, 0, 7000), \n-(9500122, 4021009, 1, 1, 0, 7000), \n-(9500369, 4021009, 1, 1, 0, 7000), \n+(4240000, 4021009, 1, 1, 0, 5000), \n+(9300334, 4021009, 1, 1, 0, 5000), \n+(9500122, 4021009, 1, 1, 0, 5000), \n+(9500369, 4021009, 1, 1, 0, 5000), \n (4240000, 4130015, 1, 1, 0, 3000), \n (9300334, 4130015, 1, 1, 0, 3000), \n (9500122, 4130015, 1, 1, 0, 3000), \n@@ -8453,7 +8435,7 @@ USE `heavenms`;\n (9420505, 1041014, 1, 1, 0, 700), \n (9420505, 1041065, 1, 1, 0, 700), \n (9420505, 1061070, 1, 1, 0, 700), \n-(5120100, 4011007, 1, 1, 0, 7000), \n+(5120100, 4011007, 1, 1, 0, 5000), \n (5120100, 2000002, 1, 4, 0, 40000), \n (5120100, 2000004, 1, 4, 0, 40000), \n (5120100, 2002010, 1, 4, 0, 10000), \n@@ -19962,7 +19944,71 @@ USE `heavenms`;\n (1110100, 4032317, 1, 1, 21717, 20000),\n (1110130, 4032317, 1, 1, 21717, 20000),\n (1110100, 4032318, 1, 1, 21718, 20000),\n-(1110130, 4032318, 1, 1, 21718, 20000);\n+(1110130, 4032318, 1, 1, 21718, 20000),\n+(9400204, 4130020, 1, 1, 0, 3000),\n+(9400614, 4001341, 1, 1, 28172, 15000),\n+(9400615, 4001341, 1, 1, 28172, 15000),\n+(9400616, 4001341, 1, 1, 28172, 15000),\n+(1110101, 4001347, 1, 1, 28229, 80000),\n+(1110100, 4001348, 1, 1, 28231, 400000),\n+(1120100, 4001349, 1, 1, 28235, 100000),\n+(1210101, 4001350, 1, 1, 28235, 100000),\n+(2220100, 4001351, 1, 1, 28237, 100000),\n+(9400614, 4001352, 1, 1, 28205, 40000),\n+(9400615, 4001352, 1, 1, 28205, 40000),\n+(9400616, 4001352, 1, 1, 28205, 40000),\n+(9400617, 4001352, 1, 1, 28205, 40000),\n+(9400617, 4001362, 1, 1, 28252, 40000),\n+(9400655, 4001362, 1, 1, 28252, 40000),\n+(9400656, 4001362, 1, 1, 28252, 40000),\n+(9400617, 4001363, 1, 1, 28252, 40000),\n+(9400655, 4001363, 1, 1, 28252, 40000),\n+(9400656, 4001363, 1, 1, 28252, 40000),\n+(9400609, 2000002, 1, 1, 0, 40000),\n+(9400609, 2000003, 1, 1, 0, 40000),\n+(9400609, 2000004, 1, 1, 0, 10000),\n+(9400609, 4010000, 1, 1, 0, 7000),\n+(9400609, 4010001, 1, 1, 0, 7000),\n+(9400609, 4010004, 1, 1, 0, 7000),\n+(9400609, 4020006, 1, 1, 0, 7000),\n+(9400609, 1082256, 1, 1, 0, 5000),\n+(9400609, 1072419, 1, 1, 0, 5000),\n+(9400610, 2000002, 1, 1, 0, 40000),\n+(9400610, 2000003, 1, 1, 0, 40000),\n+(9400610, 2000004, 1, 1, 0, 10000),\n+(9400610, 4010000, 1, 1, 0, 7000),\n+(9400610, 4010006, 1, 1, 0, 7000),\n+(9400610, 4020004, 1, 1, 0, 7000),\n+(9400610, 4020008, 1, 1, 0, 7000),\n+(9400610, 1082259, 1, 1, 0, 5000),\n+(9400610, 1072422, 1, 1, 0, 5000),\n+(9400611, 2000002, 1, 1, 0, 40000),\n+(9400611, 2000003, 1, 1, 0, 40000),\n+(9400611, 2000004, 1, 1, 0, 10000),\n+(9400611, 4010003, 1, 1, 0, 7000),\n+(9400611, 4020003, 1, 1, 0, 7000),\n+(9400611, 4020005, 1, 1, 0, 7000),\n+(9400611, 4020007, 1, 1, 0, 7000),\n+(9400611, 1082260, 1, 1, 0, 5000),\n+(9400611, 1072423, 1, 1, 0, 5000),\n+(9400612, 2000002, 1, 1, 0, 40000),\n+(9400612, 2000003, 1, 1, 0, 40000),\n+(9400612, 2000004, 1, 1, 0, 10000),\n+(9400612, 4010001, 1, 1, 0, 7000),\n+(9400612, 4010003, 1, 1, 0, 7000),\n+(9400612, 4020000, 1, 1, 0, 7000),\n+(9400612, 4020001, 1, 1, 0, 7000),\n+(9400612, 1082257, 1, 1, 0, 5000),\n+(9400612, 1072420, 1, 1, 0, 5000),\n+(9400613, 2000002, 1, 1, 0, 40000),\n+(9400613, 2000003, 1, 1, 0, 40000),\n+(9400613, 2000004, 1, 1, 0, 10000),\n+(9400613, 4010000, 1, 1, 0, 7000),\n+(9400613, 4010002, 1, 1, 0, 7000),\n+(9400613, 4010006, 1, 1, 0, 7000),\n+(9400613, 4020002, 1, 1, 0, 7000),\n+(9400613, 1082258, 1, 1, 0, 5000),\n+(9400613, 1072421, 1, 1, 0, 5000);\n \n # (dropperid, itemid, minqty, maxqty, questid, chance)\n \n@@ -20101,8 +20147,8 @@ USE `heavenms`;\n \n   UPDATE drop_data SET questid=28248 WHERE itemid=4001358;\n   UPDATE drop_data SET questid=28248 WHERE itemid=4001359;\n-  UPDATE drop_data SET questid=7777 WHERE itemid=4001342;\t#id 7777 for ALL \"quest items\" with no v83 quest.\n-  UPDATE drop_data SET questid=7777 WHERE itemid=4031906;\n+  UPDATE drop_data SET questid=28175 WHERE itemid=4001342;\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4031906;\t#id 7777 for ALL \"quest items\" with no v83 quest.\n   UPDATE drop_data SET chance=0 WHERE itemid=2050099;\n   UPDATE drop_data SET chance=40000 WHERE itemid=4031991;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4031477;\n@@ -21359,7 +21405,6 @@ USE `heavenms`;\n     (9102001, 2020002, 2, -1),\n     (2002018, 4161014, 1, 3099),\n     (1012000, 4032143, 6, 20717),\n-    (1202000, 4001366, 1, 28194),\n     (2402008, 4032512, 5, 3720),\n     (2602000, 4031574, 1, 3935),\n     (2619000, 4031709, 1, 3310),\n@@ -21826,7 +21871,10 @@ USE `heavenms`;\n (9400581, 0, 418, 617, 0, 400000),\n (9400582, 0, 1127, 1583, 0, 400000),\n (9400609, 0, 204, 1010, 0, 400000),\n+(9400610, 0, 204, 1010, 0, 400000),\n+(9400611, 0, 204, 1010, 0, 400000),\n (9400612, 0, 204, 1010, 0, 400000),\n+(9400613, 0, 204, 1010, 0, 400000),\n (9400633, 0, 258, 1270, 0, 400000),\n (9400644, 0, 42, 61, 0, 400000),\n (9410014, 0, 493, 728, 0, 400000),"}, {"sha": "579224701ac5600338186a19b320df09abcdf421", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -345,7 +345,7 @@ private static void hardsetItemStats(Equip equip, short stat) {\n         public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, MapleClient c, String[] sub) { //Player\n                 MapleCharacter player = c.getPlayer();\n             \n-                switch(sub[0]) {    \n+                switch(sub[0]) {\n                 case \"help\":\n \t\tcase \"commands\":\n                 case \"playercommands\":"}, {"sha": "84614c26967b1062cd8b8f3c3320d6505a01808d", "filename": "src/client/inventory/Item.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/inventory/Item.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/inventory/Item.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Item.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -121,13 +121,14 @@ public void setPetId(int id) {\n         this.petid = id;\n     }\n  \n+    @Override\n     public int compareTo(Item other) {\n         if (this.id < other.getItemId()) {\n             return -1;\n         } else if (this.id > other.getItemId()) {\n             return 1;\n         }\n-         return 0;\n+        return 0;\n     }\n     \n     @Override"}, {"sha": "f7eb7bfcab24c90ae7f179cfb897efab5cf540e7", "filename": "src/client/inventory/MapleInventory.java", "status": "modified", "additions": 30, "deletions": 1, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/inventory/MapleInventory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/client/inventory/MapleInventory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MapleInventory.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -24,8 +24,10 @@\n import java.util.ArrayList;\n import java.util.Collection;\n import java.util.Collections;\n+import java.util.Comparator;\n import java.util.Iterator;\n import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n import java.util.List;\n import java.util.Map.Entry;\n import java.util.Map;\n@@ -178,9 +180,36 @@ public int freeSlotCountById(int itemId, int required) {\n                 ret.add(item);\n             }\n         }\n+        \n+        if (ret.size() > 1) {\n+            Collections.sort(ret, new Comparator<Item>() {\n+                @Override\n+                public int compare(Item i1, Item i2) {\n+                    return i1.getPosition() - i2.getPosition();\n+                }\n+            });\n+        }\n+        \n+        return ret;\n+    }\n+    \n+    public List<Item> linkedListById(int itemId) {\n+        List<Item> ret = new LinkedList<>();\n+        for (Item item : list()) {\n+            if (item.getItemId() == itemId) {\n+                ret.add(item);\n+            }\n+        }\n+        \n         if (ret.size() > 1) {\n-            Collections.sort(ret);\n+            Collections.sort(ret, new Comparator<Item>() {\n+                @Override\n+                public int compare(Item i1, Item i2) {\n+                    return i1.getPosition() - i2.getPosition();\n+                }\n+            });\n         }\n+        \n         return ret;\n     }\n "}, {"sha": "d884d3d237933d9a5a34cd22b83977d687104c93", "filename": "src/net/server/channel/handlers/AllianceOperationHandler.java", "status": "modified", "additions": 69, "deletions": 44, "changes": 113, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/channel/handlers/AllianceOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/channel/handlers/AllianceOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AllianceOperationHandler.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -35,89 +35,111 @@\n \n /**\n  *\n- * @author XoticStory\n+ * @author XoticStory, Ronan\n  */\n public final class AllianceOperationHandler extends AbstractMaplePacketHandler {\n \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleAlliance alliance = null;\n-        if (c.getPlayer().getGuild() != null && c.getPlayer().getGuild().getAllianceId() > 0) {\n-            alliance = c.getPlayer().getAlliance();\n-        }\n-        if (alliance == null) {\n-            c.announce(MaplePacketCreator.enableActions());\n-            return;\n-        } else if (c.getPlayer().getMGC().getAllianceRank() > 2 || !alliance.getGuilds().contains(c.getPlayer().getGuildId())) {\n+        MapleCharacter chr = c.getPlayer();\n+        \n+        if (chr.getGuild() == null) {\n             c.announce(MaplePacketCreator.enableActions());\n             return;\n         }\n         \n+        if (chr.getGuild().getAllianceId() > 0) {\n+            alliance = chr.getAlliance();\n+        }\n+        \n         byte b = slea.readByte();\n+        if (alliance == null) {\n+            if (b != 4) {\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+        } else {\n+            if (b == 4) {\n+                chr.dropMessage(\"Your guild is already registered on a Guild Alliance.\");\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+            \n+            if (chr.getMGC().getAllianceRank() > 2 || !alliance.getGuilds().contains(chr.getGuildId())) {\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+        }\n+        \n+        // \"alliance\" is only null at case 0x04\n         switch (b) {\n             case 0x01:\n-                Server.getInstance().allianceMessage(alliance.getId(), sendShowInfo(c.getPlayer().getGuild().getAllianceId(), c.getPlayer().getId()), -1, -1);\n+                Server.getInstance().allianceMessage(alliance.getId(), sendShowInfo(chr.getGuild().getAllianceId(), chr.getId()), -1, -1);\n                 break;\n             case 0x02: { // Leave Alliance\n-                if (c.getPlayer().getGuild().getAllianceId() == 0 || c.getPlayer().getGuildId() < 1 || c.getPlayer().getGuildRank() != 1) {\n+                if (chr.getGuild().getAllianceId() == 0 || chr.getGuildId() < 1 || chr.getGuildRank() != 1) {\n                     return;\n                 }\n                 \n-                MapleAlliance.removeGuildFromAlliance(c.getPlayer().getGuild().getAllianceId(), c.getPlayer().getGuildId(), c.getPlayer().getWorld());\n+                MapleAlliance.removeGuildFromAlliance(chr.getGuild().getAllianceId(), chr.getGuildId(), chr.getWorld());\n                 break;\n             }\n-            case 0x03: // send alliance invite... or at least it would be this way if i could find the right way to call it!\n+            case 0x03: // Send Invite\n                 String guildName = slea.readMapleAsciiString();\n                 \n                 if(alliance.getGuilds().size() == alliance.getCapacity()) {\n-                    c.getPlayer().dropMessage(\"Your alliance can not comport any more guild at the moment.\");\n+                    chr.dropMessage(\"Your alliance cannot comport any more guilds at the moment.\");\n                 } else {\n                     MapleGuild mg = Server.getInstance().getGuildByName(guildName);\n                     if(mg == null) {\n-                        c.getPlayer().dropMessage(\"The entered guild does not exist.\");\n+                        chr.dropMessage(\"The entered guild does not exist.\");\n                     }\n                     else {\n                         MapleCharacter victim = mg.getMGC(mg.getLeaderId()).getCharacter();\n                         \n                         if (victim == null) {\n-                            c.getPlayer().dropMessage(\"The master of the guild that you offered an invitation is currently not online.\");\n+                            chr.dropMessage(\"The master of the guild that you offered an invitation is currently not online.\");\n                         } else {\n-                            // this doesn't seem to work...\n-                            //Server.getInstance().allianceMessage(alliance.getId(), sendInvitation(c.getPlayer().getGuild().getAllianceId(), victim.getId(), guildName), -1, -1);\n-                            //victim.getClient().announce(sendInvitation(c.getPlayer().getGuild().getAllianceId(), c.getPlayer().getId(), guildName));\n-                            \n-                            if(!c.getPlayer().isPartyMember(victim)) {\n-                                c.getPlayer().dropMessage(\"The master of the guild that you offered a invitation must be in the same party as yours.\");\n-                            }\n-                            else {\n-                                int guildid = victim.getGuildId();\n-\n-                                Server.getInstance().addGuildtoAlliance(alliance.getId(), guildid);\n-                                Server.getInstance().resetAllianceGuildPlayersRank(guildid);\n-\n-                                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.addGuildToAlliance(alliance, guildid, c), -1, -1);\n-                                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.updateAllianceInfo(alliance, c), -1, -1);\n-                                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.allianceNotice(alliance.getId(), alliance.getNotice()), -1, -1);\n-                                victim.getGuild().dropMessage(\"Your guild has joined the [\" + alliance.getName() + \"] union.\");\n-                            }\n+                            victim.getClient().announce(MaplePacketCreator.sendAllianceInvitation(alliance.getId(), chr));\n                         }\n                     }\n                 }\n                 \n                 break;\n-            case 0x04: {\n-                int guildid = slea.readInt();\n-//                    slea.readMapleAsciiString();//guild name\n-                if (c.getPlayer().getGuild().getAllianceId() != 0 || c.getPlayer().getGuildRank() != 1 || c.getPlayer().getGuildId() < 1) {\n+            case 0x04: { // Accept Invite\n+                if (chr.getGuild().getAllianceId() != 0 || chr.getGuildRank() != 1 || chr.getGuildId() < 1) {\n+                    return;\n+                }\n+                \n+                int allianceid = slea.readInt();\n+                //slea.readMapleAsciiString();  //recruiter's guild name\n+                \n+                alliance = Server.getInstance().getAlliance(allianceid);\n+                if (alliance == null) {\n                     return;\n                 }\n-                Server.getInstance().allianceMessage(alliance.getId(), sendChangeGuild(guildid, c.getPlayer().getId(), c.getPlayer().getGuildId(), 0), -1, -1);\n+                \n+                int guildid = chr.getGuildId();\n+\n+                Server.getInstance().addGuildtoAlliance(alliance.getId(), guildid);\n+                Server.getInstance().resetAllianceGuildPlayersRank(guildid);\n+                \n+                chr.getMGC().setAllianceRank(2);\n+                Server.getInstance().getGuild(chr.getGuildId()).getMGC(chr.getId()).setAllianceRank(2);\n+                chr.saveGuildStatus();\n+\n+                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.addGuildToAlliance(alliance, guildid, c), -1, -1);\n+                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.updateAllianceInfo(alliance, c), -1, -1);\n+                Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.allianceNotice(alliance.getId(), alliance.getNotice()), -1, -1);\n+                chr.getGuild().dropMessage(\"Your guild has joined the [\" + alliance.getName() + \"] union.\");\n+               \n                 break;\n             }\n             case 0x06: { // Expel Guild\n                 int guildid = slea.readInt();\n                 int allianceid = slea.readInt();\n-                if (c.getPlayer().getGuild().getAllianceId() == 0 || c.getPlayer().getGuild().getAllianceId() != allianceid) {\n+                if (chr.getGuild().getAllianceId() == 0 || chr.getGuild().getAllianceId() != allianceid) {\n                     return;\n                 }\n                 \n@@ -132,13 +154,16 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 break;\n             }\n             case 0x07: { // Change Alliance Leader\n-                if (c.getPlayer().getGuild().getAllianceId() == 0 || c.getPlayer().getGuildId() < 1) {\n+                if (chr.getGuild().getAllianceId() == 0 || chr.getGuildId() < 1) {\n                     return;\n                 }\n                 int victimid = slea.readInt();\n                 MapleCharacter player = Server.getInstance().getWorld(c.getWorld()).getPlayerStorage().getCharacterById(victimid);\n+                if (player.getAllianceRank() != 2) {\n+                    return;\n+                }\n                 \n-                //Server.getInstance().allianceMessage(alliance.getId(), sendChangeLeader(c.getPlayer().getGuild().getAllianceId(), c.getPlayer().getId(), slea.readInt()), -1, -1);\n+                //Server.getInstance().allianceMessage(alliance.getId(), sendChangeLeader(chr.getGuild().getAllianceId(), chr.getId(), slea.readInt()), -1, -1);\n                 changeLeaderAllianceRank(alliance, player);\n                 break;\n             }\n@@ -154,7 +179,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 int int1 = slea.readInt();\n                 byte byte1 = slea.readByte();\n                 \n-                //Server.getInstance().allianceMessage(alliance.getId(), sendChangeRank(c.getPlayer().getGuild().getAllianceId(), c.getPlayer().getId(), int1, byte1), -1, -1);\n+                //Server.getInstance().allianceMessage(alliance.getId(), sendChangeRank(chr.getGuild().getAllianceId(), chr.getId(), int1, byte1), -1, -1);\n                 MapleCharacter player = Server.getInstance().getWorld(c.getWorld()).getPlayerStorage().getCharacterById(int1);\n                 changePlayerAllianceRank(alliance, player, (byte1 > 0));\n                 \n@@ -168,7 +193,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 alliance.dropMessage(5, \"* Alliance Notice : \" + notice);\n                 break;\n             default:\n-                c.getPlayer().dropMessage(\"Feature not available\");\n+                chr.dropMessage(\"Feature not available\");\n         }\n         \n         alliance.saveToDB();\n@@ -195,7 +220,7 @@ private void changePlayerAllianceRank(MapleAlliance alliance, MapleCharacter chr\n         chr.saveGuildStatus();\n         \n         Server.getInstance().allianceMessage(alliance.getId(), MaplePacketCreator.getGuildAlliances(alliance, chr.getWorld()), -1, -1);\n-        alliance.dropMessage(\"'\" + chr.getName() + \"' has been reassigned as '\" + alliance.getRankTitle(newRank) + \"' in this Alliance.\");\n+        alliance.dropMessage(\"'\" + chr.getName() + \"' has been reassigned to '\" + alliance.getRankTitle(newRank) + \"' in this Alliance.\");\n     }\n \n     private static byte[] sendShowInfo(int allianceid, int playerid) {"}, {"sha": "4da5a08956d307cab1a84c302a5ab230b9312300", "filename": "src/net/server/channel/handlers/PetAutoPotHandler.java", "status": "modified", "additions": 99, "deletions": 29, "changes": 128, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/channel/handlers/PetAutoPotHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/channel/handlers/PetAutoPotHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetAutoPotHandler.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -29,61 +29,131 @@\n import server.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n import server.MapleStatEffect;\n+import tools.Pair;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n import constants.ServerConstants;\n+import java.util.List;\n \n /**\n  *\n  * @author Ronan (multi-pot consumption feature)\n  */\n public final class PetAutoPotHandler extends AbstractMaplePacketHandler {\n+    short slot;\n+    int itemId;\n+    Item toUse;\n+    List<Item> toUseList;\n+    \n+    boolean hasHpGain;\n+    boolean hasMpGain;\n+    short maxHp;\n+    short maxMp;\n+    \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         if (!c.getPlayer().isAlive()) {\n             c.announce(MaplePacketCreator.enableActions());\n             return;\n         }\n         \n-        MapleCharacter chr = c.getPlayer();\n-        short maxHp = 0, maxMp = 0;\n-        \n-        if(ServerConstants.USE_EQUIPS_ON_AUTOPOT) {\n-            for(Item i : c.getPlayer().getInventory(MapleInventoryType.EQUIPPED).list()) {\n-                Equip e = (Equip) i;\n-\n-                maxHp += e.getHp();\n-                maxMp += e.getMp();\n-            }\n-        }\n-                \n-        maxHp = (short) Math.min(chr.getMaxHp() + maxHp, 30000);\n-        maxMp = (short) Math.min(chr.getMaxMp() + maxMp, 30000);\n-        \n         slea.readByte();\n         slea.readLong();\n         slea.readInt();\n-        short slot = slea.readShort();\n-        int itemId = slea.readInt();\n-        Item toUse = chr.getInventory(MapleInventoryType.USE).getItem(slot);\n+        slot = slea.readShort();\n+        itemId = slea.readInt();\n+        \n+        MapleCharacter chr = c.getPlayer();\n+        toUse = chr.getInventory(MapleInventoryType.USE).getItem(slot);\n         \n         if(toUse != null) {\n-            MapleStatEffect stat = MapleItemInformationProvider.getInstance().getItemEffect(toUse.getItemId());\n-            \n-            if (toUse.getQuantity() <= 0 || toUse.getItemId() != itemId) {\n+            if (toUse.getItemId() != itemId) {\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n             \n-            do {\n-                MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n-                stat.applyTo(chr);\n+            toUseList = null;\n+            \n+            // from now on, toUse becomes the \"cursor\" for the current pot being used\n+            if(toUse.getQuantity() <= 0) {\n+                if(!cursorOnNextAvailablePot(chr)) {\n+                    c.announce(MaplePacketCreator.enableActions());\n+                    return;\n+                }\n+            }\n+            \n+            MapleStatEffect stat = MapleItemInformationProvider.getInstance().getItemEffect(toUse.getItemId());\n+            hasHpGain = stat.getHp() > 0 || stat.getHpRate() > 0.0;\n+            hasMpGain = stat.getMp() > 0 || stat.getMpRate() > 0.0;\n+            \n+            // contabilize the HP and MP gains from equipments on one's effective MaxHP/MaxMP\n+            Pair<Short, Short> maxHpMp = calcEffectivePool(chr);\n+            maxHp = maxHpMp.left;\n+            maxMp = maxHpMp.right;\n+            \n+            while(true) {\n+                do {\n+                    MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n+                    stat.applyTo(chr);\n+\n+                    //System.out.println();\n+                    //System.out.println(\"hp: \" + hasHpGain + \" player hp \" + chr.getHp() + \" maxhp \" + maxHp);\n+                    //System.out.println(\"mp: \" + hasMpGain + \" player mp \" + chr.getMp() + \" maxmp \" + maxMp);\n+                    //System.out.println(\"redo? \" + (shouldReusePot(chr) && toUse.getQuantity() > 0));\n+                } while(shouldReusePot(chr) && toUse.getQuantity() > 0);\n \n-                //System.out.println();\n-                //System.out.println(\"hp: \" + stat.getHp() + \" player hp \" + c.getPlayer().getHp() + \" maxhp \" + maxHp);\n-                //System.out.println(\"mp: \" + stat.getMp() + \" player mp \" + c.getPlayer().getMp() + \" maxmp \" + maxMp);\n-                //System.out.println(\"redo? \" + (((stat.getHp() > 0 && c.getPlayer().getHp() < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (stat.getMp() > 0 && c.getPlayer().getMp() < ServerConstants.PET_AUTOMP_RATIO * maxMp)) && toUse.getQuantity() > 0));\n-            } while(((stat.getHp() > 0 && chr.getHp() < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (stat.getMp() > 0 && chr.getMp() < ServerConstants.PET_AUTOMP_RATIO * maxMp)) && toUse.getQuantity() > 0);\n+                if(toUse.getQuantity() == 0 && shouldReusePot(chr)) {\n+                    // depleted out the current slot, fetch for more\n+\n+                    if(!cursorOnNextAvailablePot(chr)) {\n+                        break;    // no more pots available\n+                    }\n+                } else {\n+                    break;    // gracefully finished it's job, quit the loop\n+                }\n+            }\n+        }\n+    }\n+    \n+    private boolean cursorOnNextAvailablePot(MapleCharacter chr) {\n+        if(toUseList == null) {\n+            toUseList = chr.getInventory(MapleInventoryType.USE).linkedListById(itemId);\n+        }\n+\n+        toUse = null;\n+        while(!toUseList.isEmpty()) {\n+            Item it = toUseList.remove(0);\n+\n+            if(it.getQuantity() > 0) {\n+                toUse = it;\n+                slot = it.getPosition();\n+\n+                return true;\n+            }\n         }\n+        \n+        return false;\n+    }\n+    \n+    private Pair<Short, Short> calcEffectivePool(MapleCharacter chr) {\n+        short hp = 0, mp = 0;\n+        \n+        if(ServerConstants.USE_EQUIPS_ON_AUTOPOT) {\n+            for(Item i : chr.getInventory(MapleInventoryType.EQUIPPED).list()) {\n+                Equip e = (Equip) i;\n+\n+                hp += e.getHp();\n+                mp += e.getMp();\n+            }\n+        }\n+\n+        hp = (short) Math.min(chr.getMaxHp() + hp, 30000);\n+        mp = (short) Math.min(chr.getMaxMp() + mp, 30000);\n+        \n+        return new Pair<>(hp, mp);\n     }\n+    \n+    private boolean shouldReusePot(MapleCharacter chr) {\n+        return (hasHpGain && chr.getHp() < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (hasMpGain && chr.getMp() < ServerConstants.PET_AUTOMP_RATIO * maxMp);\n+    } \n }"}, {"sha": "863150e60f2abc88462ff4a97b9d5b74e1a96d81", "filename": "src/net/server/guild/MapleAlliance.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/guild/MapleAlliance.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/net/server/guild/MapleAlliance.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleAlliance.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -130,7 +130,6 @@ public static MapleAlliance createAlliance(MapleParty party, String name) {\n \n                 Server.getInstance().addAlliance(id, alliance);\n                 \n-                System.out.println(\"\\n\\n\\n\\n----\");\n                 Server.getInstance().allianceMessage(id, MaplePacketCreator.updateAllianceInfo(alliance, guildMasters.get(0).getClient()), -1, -1);\n             } catch (Exception e) {\n                 e.printStackTrace();"}, {"sha": "6b9e42a8af852df52f12dc9937e41ab7ae8a5fa3", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -1593,6 +1593,14 @@ public short getMp() {\n         return mp;\n     }\n     \n+    public double getHpRate() {\n+        return hpR;\n+    }\n+\n+    public double getMpRate() {\n+        return mpR;\n+    }\n+    \n     public byte getHpR() {\n         return mhpR;\n     }"}, {"sha": "a59a972cb717beb2e3ee491fc13c7169b8f23098", "filename": "src/server/maps/MapleFoothold.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/server/maps/MapleFoothold.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/server/maps/MapleFoothold.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleFoothold.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -69,6 +69,7 @@ public int calculateFooting(int x) {\n         return (slope * x) + intercept;\n     }\n \n+    @Override\n     public int compareTo(MapleFoothold o) {\n         MapleFoothold other = o;\n         if (p2.y < other.getY1()) {"}, {"sha": "1684d7d4b8e6d11dbbd674a87a2458240a047ad8", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=f74dfbb46a1fa10dcfb7e2d0a5f71a7d1c28ae61", "patch": "@@ -6343,7 +6343,17 @@ private static void getGuildInfo(final MaplePacketLittleEndianWriter mplew, Mapl\n                 mplew.writeInt(alliance);\n                 return mplew.getPacket();\n         }\n-\n+        \n+        public static byte[] sendAllianceInvitation(int allianceid, MapleCharacter chr) {\n+                final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n+                mplew.writeShort(SendOpcode.ALLIANCE_OPERATION.getValue());\n+                mplew.write(0x03);\n+                mplew.writeInt(allianceid);\n+                mplew.writeMapleAsciiString(chr.getName());\n+                mplew.writeShort(0);\n+                return mplew.getPacket();\n+        }\n+        \n         public static byte[] sendMesoLimit() {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.TRADE_MONEY_LIMIT.getValue()); //Players under level 15 can only trade 1m per day"}]}]},
