{"fetchDate": "2019-12-19", "content": [{"sha": "661dcf0a9614b09571ed01ab543dfc29cc877a9e", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6NjYxZGNmMGE5NjE0YjA5NTcxZWQwMWFiNTQzZGZjMjljYzg3N2E5ZQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-11-19T04:15:52Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-11-19T04:15:52Z"}, "message": "Quickslot Bindings\n\nAdded quickslot bindings, courtesy of @shavitush.", "tree": {"sha": "61213c1d87b042354d6b2e205a182f723d4e2d83", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/61213c1d87b042354d6b2e205a182f723d4e2d83"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/661dcf0a9614b09571ed01ab543dfc29cc877a9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/661dcf0a9614b09571ed01ab543dfc29cc877a9e", "html_url": "https://github.com/ronancpl/HeavenMS/commit/661dcf0a9614b09571ed01ab543dfc29cc877a9e", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/661dcf0a9614b09571ed01ab543dfc29cc877a9e/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d57eb1033aeeed02605eb4cb930b8fc3b15f692", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/6d57eb1033aeeed02605eb4cb930b8fc3b15f692", "html_url": "https://github.com/ronancpl/HeavenMS/commit/6d57eb1033aeeed02605eb4cb930b8fc3b15f692"}], "stats": {"total": 218, "additions": 213, "deletions": 5}, "files": [{"sha": "393df40625d9b84130e8662823846742a4389b32", "filename": "sql/db_database.sql", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -16590,6 +16590,16 @@ CREATE TABLE IF NOT EXISTS `queststatus` (\n   PRIMARY KEY (`queststatusid`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n+# quickslot table, by Shavit\n+CREATE TABLE `quickslotkeymapped` (\n+  `accountid` INT NOT NULL,\n+  `keymap` BIGINT NOT NULL DEFAULT 0,\n+  PRIMARY KEY (`accountid`)\n+);\n+\n+ALTER TABLE `quickslotkeymapped`\n+  ADD CONSTRAINT `quickslotkeymapped_accountid_fk` FOREIGN KEY (`accountid`) REFERENCES `accounts` (`id`) ON DELETE CASCADE;\n+\n CREATE TABLE IF NOT EXISTS `reactordrops` (\n   `reactordropid` int(10) unsigned NOT NULL AUTO_INCREMENT,\n   `reactorid` int(11) NOT NULL,"}, {"sha": "f8f09d86ab62b3cd31bc1b6dbff3133b3cb5ad29", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 53, "deletions": 1, "changes": 54, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -123,6 +123,8 @@\n import tools.packets.Wedding;\n import client.autoban.AutobanManager;\n import client.creator.CharacterFactoryRecipe;\n+import client.keybind.MapleKeyBinding;\n+import client.keybind.MapleQuickslotBinding;\n import client.inventory.Equip;\n import client.inventory.Equip.StatUpgrade;\n import client.inventory.Item;\n@@ -175,8 +177,8 @@\n import net.server.services.task.channel.FaceExpressionService;\n import net.server.services.task.world.CharacterSaveService;\n import net.server.services.type.WorldServices;\n-import org.apache.mina.core.session.IoSession;\n import org.apache.mina.util.ConcurrentHashSet;\n+import tools.LongTool;\n \n public class MapleCharacter extends AbstractMapleCharacterObject {\n     private static final MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n@@ -277,6 +279,8 @@\n     private Map<Integer, MapleSummon> summons = new LinkedHashMap<>();\n     private Map<Integer, MapleCoolDownValueHolder> coolDowns = new LinkedHashMap<>();\n     private EnumMap<MapleDisease, Pair<MapleDiseaseValueHolder, MobSkill>> diseases = new EnumMap<>(MapleDisease.class);\n+    public byte[] m_aQuickslotLoaded;\n+    public MapleQuickslotBinding m_pQuickslotKeyMapped;\n     private MapleDoor pdoor = null;\n     private Map<MapleQuest, Long> questExpirations = new LinkedHashMap<>();\n     private ScheduledFuture<?> dragonBloodSchedule;\n@@ -7496,6 +7500,17 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n             ret.maplemount.setTiredness(mounttiredness);\n             ret.maplemount.setActive(false);\n             \n+            try (final PreparedStatement pSelectQuickslotKeyMapped = con.prepareStatement(\"SELECT keymap FROM quickslotkeymapped WHERE accountid = ?;\")) {\n+                pSelectQuickslotKeyMapped.setInt(1, ret.getAccountID());\n+\n+                try (final ResultSet pResultSet = pSelectQuickslotKeyMapped.executeQuery()) {\n+                    if (pResultSet.next()) {\n+                        ret.m_aQuickslotLoaded = LongTool.LongToBytes(pResultSet.getLong(1));\n+                        ret.m_pQuickslotKeyMapped = new MapleQuickslotBinding(ret.m_aQuickslotLoaded);\n+                    }\n+                }\n+            }\n+            \n             con.close();\n             return ret;\n         } catch (SQLException | RuntimeException e) {\n@@ -8334,6 +8349,19 @@ public final boolean insertNewChar(CharacterFactoryRecipe recipe) {\n                 ps.execute();\n             }\n             ps.close();\n+            \n+            // No quickslots, or no change.\n+            boolean bQuickslotEquals = this.m_pQuickslotKeyMapped == null || (this.m_aQuickslotLoaded != null && Arrays.equals(this.m_pQuickslotKeyMapped.m_aQuickslotKeyMapped, this.m_aQuickslotLoaded));\n+            if (!bQuickslotEquals) {\n+                long nQuickslotKeymapped = LongTool.BytesToLong(this.m_pQuickslotKeyMapped.m_aQuickslotKeyMapped);\n+                \n+                try (final PreparedStatement pInsertStatement = con.prepareStatement(\"INSERT INTO quickslotkeymapped (accountid, keymap) VALUES (?, ?) ON DUPLICATE KEY UPDATE keymap = ?;\")) {\n+                    pInsertStatement.setInt(1, this.getAccountID());\n+                    pInsertStatement.setLong(2, nQuickslotKeymapped);\n+                    pInsertStatement.setLong(3, nQuickslotKeymapped);\n+                    pInsertStatement.executeUpdate();\n+                }\n+            }\n \n             itemsWithType = new ArrayList<>();\n             for (MapleInventory iv : inventory) {\n@@ -8587,6 +8615,19 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             ps.executeBatch();\n             ps.close();\n             \n+            // No quickslots, or no change.\n+            boolean bQuickslotEquals = this.m_pQuickslotKeyMapped == null || (this.m_aQuickslotLoaded != null && Arrays.equals(this.m_pQuickslotKeyMapped.m_aQuickslotKeyMapped, this.m_aQuickslotLoaded));\n+            if (!bQuickslotEquals) {\n+                long nQuickslotKeymapped = LongTool.BytesToLong(this.m_pQuickslotKeyMapped.m_aQuickslotKeyMapped);\n+                \n+                try (final PreparedStatement pInsertStatement = con.prepareStatement(\"INSERT INTO quickslotkeymapped (accountid, keymap) VALUES (?, ?) ON DUPLICATE KEY UPDATE keymap = ?;\")) {\n+                    pInsertStatement.setInt(1, this.getAccountID());\n+                    pInsertStatement.setLong(2, nQuickslotKeymapped);\n+                    pInsertStatement.setLong(3, nQuickslotKeymapped);\n+                    pInsertStatement.executeUpdate();\n+                }\n+            }\n+            \n             deleteWhereCharacterId(con, \"DELETE FROM skillmacros WHERE characterid = ?\");\n             ps = con.prepareStatement(\"INSERT INTO skillmacros (characterid, skill1, skill2, skill3, name, shout, position) VALUES (?, ?, ?, ?, ?, ?, ?)\");\n             ps.setInt(1, getId());\n@@ -8824,6 +8865,17 @@ public void sendPolice(String text) {\n     public void sendKeymap() {\n         client.announce(MaplePacketCreator.getKeymap(keymap));\n     }\n+    \n+    public void sendQuickmap() {\n+        // send quickslots to user\n+        MapleQuickslotBinding pQuickslotKeyMapped = this.m_pQuickslotKeyMapped;\n+\n+        if (pQuickslotKeyMapped == null) {\n+            pQuickslotKeyMapped = new MapleQuickslotBinding(MapleQuickslotBinding.DEFAULT_QUICKSLOTS);\n+        }\n+\n+        this.announce(MaplePacketCreator.QuickslotMappedInit(pQuickslotKeyMapped));\n+    }\n \n     public void sendMacros() {\n         // Always send the macro packet to fix a client side bug when switching characters."}, {"sha": "a2b3f23a4431fb81d5657ae30d895f8fefb6e748", "filename": "src/client/keybind/MapleKeyBinding.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/keybind/MapleKeyBinding.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/keybind/MapleKeyBinding.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/keybind/MapleKeyBinding.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -19,7 +19,7 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-package client;\n+package client.keybind;\n \n public class MapleKeyBinding {\n     private int type, action;", "previous_filename": "src/client/MapleKeyBinding.java"}, {"sha": "5dc6aad345cb25f1306f427a13fa29315ff42f55", "filename": "src/client/keybind/MapleQuickslotBinding.java", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/keybind/MapleQuickslotBinding.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/client/keybind/MapleQuickslotBinding.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/keybind/MapleQuickslotBinding.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -0,0 +1,55 @@\n+package client.keybind;\n+\n+import tools.data.output.MaplePacketLittleEndianWriter;\n+\n+import java.util.Arrays;\n+\n+/**\n+ *\n+ * @author Shavit\n+ */\n+public class MapleQuickslotBinding\n+{\n+    public static final int QUICKSLOT_SIZE = 8;\n+\n+    public static final byte[] DEFAULT_QUICKSLOTS =\n+    {\n+            0x2A, 0x52, 0x47, 0x49, 0x1D, 0x53, 0x4F, 0x51\n+    };\n+\n+    public byte[] m_aQuickslotKeyMapped;\n+\n+    // Initializes quickslot object for the user.\n+    // aKeys' length has to be 8.\n+    public MapleQuickslotBinding(byte[] aKeys)\n+    {\n+        if(aKeys.length != QUICKSLOT_SIZE)\n+        {\n+            throw new IllegalArgumentException(String.format(\"aKeys' size should be %d\", QUICKSLOT_SIZE));\n+        }\n+\n+        this.m_aQuickslotKeyMapped = aKeys.clone();\n+    }\n+\n+    public void Encode(MaplePacketLittleEndianWriter oPacket)\n+    {\n+        // Quickslots are default.\n+        // The client will skip them and call CQuickslotKeyMappedMan::DefaultQuickslotKeyMap.\n+        if(Arrays.equals(this.m_aQuickslotKeyMapped, DEFAULT_QUICKSLOTS))\n+        {\n+            oPacket.writeBool(false);\n+\n+            return;\n+        }\n+\n+        oPacket.writeBool(true);\n+\n+        for(byte nKey : this.m_aQuickslotKeyMapped)\n+        {\n+            // For some reason Nexon sends these as integers, similar to CFuncKeyMappedMan.\n+            // However there's no evidence any key can be above 0xFF anyhow.\n+            // Regardless, we need to encode an integer to avoid an error 38 crash; as CFuncKeyMapped::m_aQuickslotKeyMapped is int[8].\n+            oPacket.writeInt(nKey);\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "94e07b54410695670b2c8dce6e7df3cdc81df87a", "filename": "src/net/PacketProcessor.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/PacketProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/PacketProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/PacketProcessor.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -273,6 +273,7 @@ public void reset(int channel) {\n             registerHandler(RecvOpcode.MOVE_DRAGON, new MoveDragonHandler());\n             registerHandler(RecvOpcode.OPEN_ITEMUI, new RaiseUIStateHandler());\n             registerHandler(RecvOpcode.USE_ITEMUI, new RaiseIncExpHandler());\n+            registerHandler(RecvOpcode.CHANGE_QUICKSLOT, new QuickslotKeyMappedModifiedHandler());\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "9fc6ae8226b6e1b85e930a1ee74ba9d405fe54cb", "filename": "src/net/opcodes/RecvOpcode.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/opcodes/RecvOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/opcodes/RecvOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/RecvOpcode.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -173,6 +173,7 @@\n     DAMAGE_SUMMON(0xB1),\n     BEHOLDER(0xB2),\n     MOVE_DRAGON(0xB5),\n+    CHANGE_QUICKSLOT(0xB7),//CP_QuickslotKeyMappedModified\n     MOVE_LIFE(0xBC),\n     AUTO_AGGRO(0xBD),\n     FIELD_DAMAGE_MOB(0xBF),\n@@ -202,6 +203,7 @@\n     MTS_OPERATION(0xFD),\n     USE_MAPLELIFE(0x100),\n     USE_HAMMER(0x104);\n+    \n     private int code = -2;\n \n     private RecvOpcode(int code) {"}, {"sha": "efdc46da239cc40f4a66ea7afd5cbd0c2e5a2703", "filename": "src/net/opcodes/SendOpcode.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/opcodes/SendOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/opcodes/SendOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/SendOpcode.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -188,6 +188,7 @@\n     ARIANT_ARENA_SHOW_RESULT(0x9B),\n     PYRAMID_GAUGE(0x9D),\n     PYRAMID_SCORE(0x9E),\n+    QUICKSLOT_INIT(0x9F),//LP_QuickslotMappedInit\n     SPAWN_PLAYER(0xA0),\n     REMOVE_PLAYER_FROM_MAP(0xA1),\n     CHATTEXT(0xA2), //0"}, {"sha": "d4d4ac8aa7f67825380e6d54d3c9e5dcd3484ec5", "filename": "src/net/server/channel/handlers/KeymapChangeHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/KeymapChangeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/KeymapChangeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/KeymapChangeHandler.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -23,7 +23,7 @@\n \n import constants.game.GameConstants;\n import client.MapleClient;\n-import client.MapleKeyBinding;\n+import client.keybind.MapleKeyBinding;\n import client.Skill;\n import client.SkillFactory;\n import client.autoban.AutobanFactory;"}, {"sha": "4a25fd4f1c4923282e668da05604d3b454774b74", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -53,7 +53,7 @@\n import client.MapleDisease;\n import client.MapleFamily;\n import client.MapleFamilyEntry;\n-import client.MapleKeyBinding;\n+import client.keybind.MapleKeyBinding;\n import client.MapleMount;\n import client.SkillFactory;\n import client.inventory.Equip;\n@@ -239,6 +239,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     }\n                 }\n                 player.sendKeymap();\n+                player.sendQuickmap();\n                 player.sendMacros();\n \n                 // pot bindings being passed through other characters on the account detected thanks to Croosade dev team"}, {"sha": "2e1881c0bb1f076efb09c87fc8bce5b18df6fc76", "filename": "src/net/server/channel/handlers/QuickslotKeyMappedModifiedHandler.java", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/QuickslotKeyMappedModifiedHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/net/server/channel/handlers/QuickslotKeyMappedModifiedHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/QuickslotKeyMappedModifiedHandler.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -0,0 +1,34 @@\n+package net.server.channel.handlers;\n+\n+import client.MapleClient;\n+import client.keybind.MapleQuickslotBinding;\n+import net.AbstractMaplePacketHandler;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+/**\n+ *\n+ * @author Shavit\n+ */\n+public class QuickslotKeyMappedModifiedHandler extends AbstractMaplePacketHandler\n+{\n+    @Override\n+    public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n+    {\n+        // Invalid size for the packet.\n+        if(slea.available() != MapleQuickslotBinding.QUICKSLOT_SIZE * Integer.BYTES ||\n+        // not logged in-game\n+            c.getPlayer() == null)\n+        {\n+            return;\n+        }\n+\n+        byte[] aQuickslotKeyMapped = new byte[MapleQuickslotBinding.QUICKSLOT_SIZE];\n+\n+        for(int i = 0; i < MapleQuickslotBinding.QUICKSLOT_SIZE; i++)\n+        {\n+            aQuickslotKeyMapped[i] = (byte) slea.readInt();\n+        }\n+\n+        c.getPlayer().m_pQuickslotKeyMapped = new MapleQuickslotBinding(aQuickslotKeyMapped);\n+    }\n+}"}, {"sha": "71eb5ba739b5b76ddecf1bec7194106b3e276cdc", "filename": "src/tools/LongTool.java", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/tools/LongTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/tools/LongTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/LongTool.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -0,0 +1,41 @@\n+package tools;\n+\n+/**\n+ *\n+ * @author Shavit\n+ */\n+public class LongTool {\n+    \n+    // Converts 8 bytes to a long.\n+    public static long BytesToLong(byte[] aToConvert)\n+    {\n+        if(aToConvert.length != Long.BYTES)\n+        {\n+            throw new IllegalArgumentException(String.format(\"Size of input should be %d\", (Long.SIZE / 8)));\n+        }\n+\n+        long nResult = 0;\n+\n+        for(int i = 0; i < Long.BYTES; i++)\n+        {\n+            nResult <<= Byte.SIZE;\n+            nResult |= (aToConvert[i] & 0xFF);\n+        }\n+\n+        return nResult;\n+    }\n+\n+    // Converts a long to 8 bytes.\n+    public static byte[] LongToBytes(long nToConvert)\n+    {\n+        byte[] aBytes = new byte[Long.BYTES];\n+\n+        for(int i = aBytes.length - 1; i >= 0; i--)\n+        {\n+            aBytes[i] = (byte) (nToConvert & 0xFF);\n+            nToConvert >>= Byte.SIZE;\n+        }\n+\n+        return aBytes;\n+    }\n+}"}, {"sha": "ee0e25d53bceb082dbb7f74c7830a046e9457ea7", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/661dcf0a9614b09571ed01ab543dfc29cc877a9e/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=661dcf0a9614b09571ed01ab543dfc29cc877a9e", "patch": "@@ -43,7 +43,8 @@\n import client.MapleDisease;\n import client.MapleFamilyEntitlement;\n import client.MapleFamilyEntry;\n-import client.MapleKeyBinding;\n+import client.keybind.MapleKeyBinding;\n+import client.keybind.MapleQuickslotBinding;\n import client.MapleMount;\n import client.MapleQuestStatus;\n import client.MapleRing;\n@@ -3614,6 +3615,16 @@ private static void writeLongMaskChair(final MaplePacketLittleEndianWriter mplew\n                 }\n                 return mplew.getPacket();\n         }\n+        \n+        public static byte[] QuickslotMappedInit(MapleQuickslotBinding pQuickslot)\n+        {\n+                final MaplePacketLittleEndianWriter pOutPacket = new MaplePacketLittleEndianWriter();\n+\n+                pOutPacket.writeShort(SendOpcode.QUICKSLOT_INIT.getValue());\n+                pQuickslot.Encode(pOutPacket);\n+\n+                return pOutPacket.getPacket();\n+        }\n \n         public static byte[] getWhisper(String sender, int channel, String text) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();"}]}]},
