{"fetchDate": "2019-12-19", "content": [{"sha": "7d448cce4f9360ed92decc4f5de78b7372f86bfb", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6N2Q0NDhjY2U0ZjkzNjBlZDkyZGVjYzRmNWRlNzhiNzM3MmY4NmJmYg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-25T15:01:24Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-25T15:01:24Z"}, "message": "Lower-bracket equip levelup & Channel/World capacity patch\n\nRebalanced the low level section of the equipment level up system.\nFixed EQUIP_EXP_RATE not acting as expected to be.\nChanged chscroll system, now using a new flag instead of the SCROLL_CHANCE_RATE.\nOptimized PlayerStorage, now using a proper name map when searching for a character name.\nTweaked some aspects of the BalrogPQ.\nImproved the channel capacity bar and world server capacity checks throughout the source.", "tree": {"sha": "3784e7efe54a162a63c051ec5a7c8135c9b51afb", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/3784e7efe54a162a63c051ec5a7c8135c9b51afb"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/7d448cce4f9360ed92decc4f5de78b7372f86bfb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7d448cce4f9360ed92decc4f5de78b7372f86bfb", "html_url": "https://github.com/ronancpl/HeavenMS/commit/7d448cce4f9360ed92decc4f5de78b7372f86bfb", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7d448cce4f9360ed92decc4f5de78b7372f86bfb/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7a259e2c45d0f2f6abb33c5698010f20da6b232", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b7a259e2c45d0f2f6abb33c5698010f20da6b232", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b7a259e2c45d0f2f6abb33c5698010f20da6b232"}], "stats": {"total": 536, "additions": 446, "deletions": 90}, "files": [{"sha": "1036c76570e984e382d48edaddcfe0b7275975c2", "filename": "README.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -20,6 +20,8 @@ Server files: https://github.com/ronancpl/HeavenMS\n \n Client files & general tools: https://drive.google.com/drive/folders/0BzDsHSr-0V4MYVJ0TWIxd05hYUk\n \n+**Important note about localhosts**: these executables are red-flagged by antivirus tools as __potentially malicious softwares__, this happens due to the reverse engineering methods that were applied onto these software artifacts. Those depicted here have been put to use for years already and posed no harm so far, so they are soundly assumed to be safe.\n+\n Recommended localhost: https://hostr.co/fuzm4X9j7TWh\n \n * Current revision: 'n' problem fixed and removed caps for WATK, WDEF, MDEF, ACC, AVOID."}, {"sha": "2d008af778c09b98eb1c0bf27553d98a67c9dba2", "filename": "docs/feature_list.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -100,6 +100,7 @@ Server potentials:\n * Enhanced auto-pot system: pet uses as many potions as necessary to reach the desired threshold.\n * Enhanced buff system: smartly checks for the best available buff effects to be active on the player.\n * Enhanced AP auto-assigner: exactly matches AP with the needed for the player's current level, surplus assigned to the primary attribute.\n+* Channel capacity bar functional and world servers with max capacity checks.\n * Mastery book announcer displays droppers of needed books of a player, by reading underlying DB.\n * Custom jail system (needs provided custom wz).\n * Delete Character (requires ENABLE_PIC activated)."}, {"sha": "2b919ee0d89810f8dbd94e22752002eaca1aad05", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -876,4 +876,13 @@ Adicionado feature de AutoJCE (cr\u00e9ditos aos Acernis devs).\n \n 20 - 22 Mar\u00e7o 2018,\n Resolvido exploit com login, onde qualquer um (via packet editing) podia logar livremente com personagem de outras contas.\n-Nova ferramenta: MapleQuestlineFetcher. Busca nos XMLs e registra questids que ainda n\u00e3o possuem quest scripts.\n\\ No newline at end of file\n+Nova ferramenta: MapleQuestlineFetcher. Busca nos XMLs e registra questids que ainda n\u00e3o possuem quest scripts.\n+\n+24 - 25 Mar\u00e7o 2018,\n+Corrigido sistema de levelup de equips desbalanceado para o cen\u00e1rio low-level, distribuindo uma quantidade de EXP extremamente baixa.\n+Corrigido flag EQUIP_EXP_RATE atuando de forma err\u00f4nea.\n+Modificado sistema do chaos scroll, agora utilizando uma flag nova ao inv\u00e9s de reusar flag SCROLL_CHANCE_RATE.\n+Otimizado PlayerStorage, agora utilizando um mapa pr\u00f3prio de nomes, ao inv\u00e9s de realizar busca exaustiva no mapa de inteiros.\n+Corrigido alguns aspectos do BalrogPQ, tais como a cabe\u00e7a sendo ating\u00edvel antes das m\u00e3os serem derrotadas e contador de kills do boss n\u00e3o subindo ao derrotr o chefe.\n+Corrigido barras da tela de sele\u00e7\u00e3o de canais na etapa de login n\u00e3o atuando corretamente.\n+Adicionado checks de world server lotado de diversos pontos das etapas de login.\n\\ No newline at end of file"}, {"sha": "3810a0f503ce3dfa762df42483f5b89be67f24d8", "filename": "scripts/event/BalrogBattle.js", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogBattle.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -117,13 +117,13 @@ function releaseLeftClaw(eim) {\n function spawnBalrog(eim) {\n         var mapObj = eim.getInstanceMap(entryMap);\n     \n-        mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830000), new Packages.java.awt.Point(412, 258));\n+        mapObj.spawnFakeMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830000), new Packages.java.awt.Point(412, 258));\n         mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830002), new Packages.java.awt.Point(412, 258));\n         mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830006), new Packages.java.awt.Point(412, 258));\n }\n \n function spawnSealedBalrog(eim) {\n-        eim.getInstanceMap(entryMap).spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830003), new Packages.java.awt.Point(412, 258));\n+        eim.getInstanceMap(entryMap).spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(bossMobId), new Packages.java.awt.Point(412, 258));\n }\n \n function playerEntry(eim, player) {\n@@ -239,8 +239,14 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.clearPQ();\n \n+                        eim.dispatchUpdateQuestMobCount(bossMobId, entryMap);\n                         mob.getMap().broadcastBalrogVictory(eim.getLeader().getName());\n                 } else {\n+                        if(count == 1) {\n+                                var mapobj = eim.getInstanceMap(entryMap);\n+                                mapobj.makeMonsterReal(mapobj.getMonsterById(8830000));\n+                        }\n+                    \n                         eim.setIntProperty(\"boss\", count + 1);\n                 }\n                 "}, {"sha": "178d9a2f120ab82e1a5b14e1a82cd71e2f893acc", "filename": "scripts/event/BalrogBattle_Easy.js", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogBattle_Easy.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogBattle_Easy.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogBattle_Easy.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -117,13 +117,13 @@ function releaseLeftClaw(eim) {\n function spawnBalrog(eim) {\n         var mapObj = eim.getInstanceMap(entryMap);\n     \n-        mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830007), new Packages.java.awt.Point(412, 258));\n+        mapObj.spawnFakeMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830007), new Packages.java.awt.Point(412, 258));\n         mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830009), new Packages.java.awt.Point(412, 258));\n         mapObj.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830013), new Packages.java.awt.Point(412, 258));\n }\n \n function spawnSealedBalrog(eim) {\n-        eim.getInstanceMap(entryMap).spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8830010), new Packages.java.awt.Point(412, 258));\n+        eim.getInstanceMap(entryMap).spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(bossMobId), new Packages.java.awt.Point(412, 258));\n }\n \n function playerEntry(eim, player) {\n@@ -239,8 +239,13 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.clearPQ();\n \n+                        eim.dispatchUpdateQuestMobCount(bossMobId, entryMap);\n                         mob.getMap().broadcastBalrogVictory(eim.getLeader().getName());\n                 } else {\n+                        if(count == 1) {\n+                                var mapobj = eim.getInstanceMap(entryMap);\n+                                mapobj.makeMonsterReal(mapobj.getMonsterById(8830007));\n+                        }\n                         eim.setIntProperty(\"boss\", count + 1);\n                 }\n                 "}, {"sha": "d9fc353c5ba63abae1690994a05015fa0ac89863", "filename": "scripts/event/BalrogQuest.js", "status": "added", "additions": 102, "deletions": 0, "changes": 102, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/event/BalrogQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogQuest.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -0,0 +1,102 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+ * @Author Ronan\n+ * Event - Balrog Quest\n+**/\n+importPackage(Packages.tools);\n+\n+var entryMap = 910520000;\n+var exitMap = 105100100;\n+\n+var minMapId = 910520000;\n+var maxMapId = 910520000;\n+\n+var eventTime = 10; //10 minutes\n+\n+var lobbyRange = [0, 0];\n+\n+function setLobbyRange() {\n+    return lobbyRange;\n+}\n+\n+function init() {\n+    em.setProperty(\"noEntry\",\"false\");\n+}\n+\n+function respawnStages(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function playerEntry(eim, player) {\n+    var mapObj = eim.getInstanceMap(entryMap);\n+    \n+    mapObj.resetPQ(1);\n+    mapObj.instanceMapForceRespawn();\n+    mapObj.closeMapSpawnPoints();\n+    respawnStages(eim);\n+    \n+    player.changeMap(entryMap, 1);\n+    em.setProperty(\"noEntry\",\"true\");\n+    \n+    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    eim.startEventTimer(eventTime * 60000);\n+}\n+\n+function playerUnregistered(eim, player) {}\n+\n+function playerExit(eim, player) {\n+    eim.unregisterPlayer(player);\n+    eim.dispose();\n+    em.setProperty(\"noEntry\",\"false\");\n+}\n+\n+function scheduledTimeout(eim) {\n+    var player = eim.getPlayers().get(0);\n+    playerExit(eim, player);\n+    player.changeMap(exitMap);\n+}\n+\n+function playerDisconnected(eim, player) {\n+    playerExit(eim, player);\n+}\n+\n+function changedMap(eim, chr, mapid) {\n+    if(mapid < minMapId || mapid > maxMapId) playerExit(eim, chr);\n+}\n+\n+function isBalrog(mob) {\n+        return mob.getId() == 9300326;\n+}\n+\n+function monsterKilled(mob, eim) {\n+    if(isBalrog(mob)) {\n+        eim.spawnNpc(1061015, new java.awt.Point(0, 115), mob.getMap());\n+    }\n+}\n+function monsterValue(eim, mobId) {\n+        return 1;\n+}\n+\n+function allMonstersDead(eim) {}\n+\n+function cancelSchedule() {}\n+\n+function dispose() {}"}, {"sha": "93cd66818ca17633d39173878866297c15ade8b4", "filename": "scripts/portal/curseforest.js", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/portal/curseforest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/portal/curseforest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/curseforest.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -0,0 +1,17 @@\n+importPackage(java.util);\n+\n+function enter(pi) {\n+    if(pi.isQuestStarted(2224) || pi.isQuestStarted(2226) || pi.isQuestCompleted(2227)) {\n+        var hourDay = pi.getHourOfDay();\n+        if(!((hourDay >= 0 && hourDay < 7) || hourDay >= 17)) {\n+            pi.getPlayer().dropMessage(5, \"You cannot access this area right now.\");\n+            return false;\n+        } else {\n+            pi.playPortalSound(); pi.warp(pi.isQuestCompleted(2227) ? 910100001 : 910100000,\"out00\");\n+            return true;\n+        }\n+    }\n+    \n+    pi.getPlayer().dropMessage(5, \"You cannot access this area.\");\n+    return false;\n+}\n\\ No newline at end of file"}, {"sha": "7261d9cc31b0a20645bf992353906a603a7c9536", "filename": "scripts/quest/2214.js", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2214.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2214.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2214.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -25,8 +25,6 @@\n \tQuest ID: \t\t2214\n */\n \n-importPackage(java.util);\n-\n var status = -1;\n \n function end(mode, type, selection) {\n@@ -44,7 +42,7 @@ function end(mode, type, selection) {\n             status--;\n         \n         if (status == 0) {\n-            var hourDay = Calendar.getInstance().get(Calendar.HOUR_OF_DAY);\n+            var hourDay = qm.getHourOfDay();\n             if(!(hourDay >= 17 && hourDay < 20)) {\n                 qm.sendNext(\"(Hmm, I'm searching the trash can but can't find the #t4031894# JM was talking about, maybe it's not time yet...)\");\n                 qm.dispose();"}, {"sha": "6e0f60bc38ab72d6dc4f3feef46607339dcb14eb", "filename": "scripts/quest/2215.js", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2215.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2215.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2215.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -25,8 +25,6 @@\n \tQuest ID: \t\t2215\n */\n \n-importPackage(java.util);\n-\n var status = -1;\n \n function end(mode, type, selection) {\n@@ -44,7 +42,7 @@ function end(mode, type, selection) {\n             status--;\n         \n         if (status == 0) {\n-            var hourDay = Calendar.getInstance().get(Calendar.HOUR_OF_DAY);\n+            var hourDay = qm.getHourOfDay();\n             if(!(hourDay >= 17 && hourDay < 20)) {\n                 qm.sendNext(\"(Hmm, I'm searching the trash can but can't find the #t4031894# JM was talking about, maybe it's not time yet...)\");\n                 qm.dispose();"}, {"sha": "b5d23cdd161b23c0d2a114422e1042759c9034e7", "filename": "scripts/quest/2228.js", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2228.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2228.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2228.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -0,0 +1,46 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"Thank you for defeating #rFaust#k. That will finally settle my spirit to rest.\");\n+        } else {\n+            qm.gainFame(8);\n+            \n+            qm.forceCompleteQuest();\n+            qm.dispose();\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "8288c8ec5b4a9b409e01e157be58b7ad4aa6032d", "filename": "scripts/quest/2238.js", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2238.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/scripts/quest/2238.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2238.js?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -0,0 +1,59 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            em = qm.getEventManager(\"BalrogQuest\");\n+            if (em == null) {\n+                qm.sendOk(\"Sorry, but the BalrogQuest is closed.\");\n+                qm.dispose();\n+                return;\n+            }\n+            \n+            if (em.getProperty(\"noEntry\") == \"false\") {\n+                var eim = em.newInstance(\"BalrogQuest\");\n+                eim.registerPlayer(qm.getPlayer());\n+                eim.startEvent();\n+\n+                qm.forceStartQuest();\n+                qm.dispose();\n+            }\n+            else {\n+                qm.sendOk(\"There is currently someone in this map, come back later.\");\n+                qm.dispose();\n+            }\n+        }\n+    }\n+}"}, {"sha": "162322500c2ec0c6ce378a3121d82f0efa0989d6", "filename": "sql/db_drops.sql", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -22265,6 +22265,7 @@ USE `heavenms`;\n (8220007, 0, 1704, 8530, 0, 400000),\n (8220009, 0, 1479, 7280, 0, 400000),\n (8830000, 0, 2400, 11620, 0, 400000),\n+(8830007, 0, 2400, 11620, 0, 400000),\n (9001009, 0, 1254, 6170, 0, 400000),\n (9001011, 0, 95, 140, 0, 400000),\n (9200016, 0, 81, 119, 0, 400000),"}, {"sha": "f0add8452bcf0cc54a2d0741c0c9486c16fa298f", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -161,9 +161,9 @@\n     private static NumberFormat nf = new DecimalFormat(\"#,###,###,###\");\n     private static MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n     private static final String LEVEL_200 = \"[Congrats] %s has reached Level 200! Congratulate %s on such an amazing achievement!\";\n-    private static final String[] BLOCKED_NAMES = {\"admin\", \"owner\", \"moderator\", \"intern\", \"donor\", \"administrator\", \"help\", \"helper\", \"alert\", \"notice\", \"maplestory\", \"Solaxia\", \"fuck\", \"wizet\", \"fucking\", \"negro\", \"fuk\", \"fuc\", \"penis\", \"pussy\", \"asshole\", \"gay\",\n+    private static final String[] BLOCKED_NAMES = {\"admin\", \"owner\", \"moderator\", \"intern\", \"donor\", \"administrator\", \"help\", \"helper\", \"alert\", \"notice\", \"maplestory\", \"fuck\", \"wizet\", \"fucking\", \"negro\", \"fuk\", \"fuc\", \"penis\", \"pussy\", \"asshole\", \"gay\",\n         \"nigger\", \"homo\", \"suck\", \"cum\", \"shit\", \"shitty\", \"condom\", \"security\", \"official\", \"rape\", \"nigga\", \"sex\", \"tit\", \"boner\", \"orgy\", \"clit\", \"asshole\", \"fatass\", \"bitch\", \"support\", \"gamemaster\", \"cock\", \"gaay\", \"gm\",\n-        \"operate\", \"master\", \"sysop\", \"party\", \"GameMaster\", \"community\", \"message\", \"event\", \"test\", \"meso\", \"Scania\", \"renewal\", \"yata\", \"AsiaSoft\", \"henesys\"};\n+        \"operate\", \"master\", \"sysop\", \"party\", \"GameMaster\", \"community\", \"message\", \"event\", \"test\", \"meso\", \"Scania\", \"yata\", \"AsiaSoft\", \"henesys\"};\n     \n     private int world;\n     private int accountid, id;\n@@ -5766,17 +5766,18 @@ public void yellowMessage(String m) {\n         announce(MaplePacketCreator.sendYellowTip(m));\n     }\n \n-    public void mobKilled(int id) {\n+    public void updateQuestMobCount(int id) {\n         // It seems nexon uses monsters that don't exist in the WZ (except string) to merge multiple mobs together for these 3 monsters.\n         // We also want to run mobKilled for both since there are some quest that don't use the updated ID...\n         if (id == 1110100 || id == 1110130) {\n-            mobKilled(9101000);\n+            updateQuestMobCount(9101000);\n         } else if (id == 2230101 || id == 2230131) {\n-            mobKilled(9101001);\n+            updateQuestMobCount(9101001);\n         } else if (id == 1140100 || id == 1140130) {\n-            mobKilled(9101002);\n+            updateQuestMobCount(9101002);\n         }\n-\t\tint lastQuestProcessed = 0;\n+        \n+        int lastQuestProcessed = 0;\n         try {\n             synchronized (quests) {\n                 for (MapleQuestStatus q : quests.values()) {"}, {"sha": "c208d2afd8a5e8f0f54e08f8484fcbf969d270b2", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -294,6 +294,7 @@\n \t\tgotomaps.put(\"herb\", 251000000);\n \t\tgotomaps.put(\"omega\", 221000000);\n \t\tgotomaps.put(\"korean\", 222000000);\n+                gotomaps.put(\"ellin\", 300000000);\n \t\tgotomaps.put(\"nlc\", 600000000);\n \t\tgotomaps.put(\"excavation\", 990000000);\n \t\tgotomaps.put(\"pianus\", 230040420);"}, {"sha": "58bb1b7a279fc836011a2e4e7907b27e02d0fcbc", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -273,7 +273,7 @@ public void setLevel(byte level) {\n         this.level = level;\n     }\n \n-    private int getStatModifier(boolean isAttribute) {\n+    private static int getStatModifier(boolean isAttribute) {\n         // each set of stat points grants a chance for a bonus stat point upgrade at equip level up.\n         \n         if(ServerConstants.USE_EQUIPMNT_LVLUP_POWER) {\n@@ -286,7 +286,7 @@ private int getStatModifier(boolean isAttribute) {\n         }\n     }\n     \n-    private int randomizeStatUpgrade(int top) {\n+    private static int randomizeStatUpgrade(int top) {\n         int limit = Math.min(top, ServerConstants.MAX_EQUIPMNT_LVLUP_STAT_UP);\n         \n         int poolCount = (limit * (limit + 1) / 2) + limit;\n@@ -310,7 +310,7 @@ private void getUnitStatUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgr\n         stats.add(new Pair<>(name, maxUpgrade));\n     }\n     \n-    private void getUnitSlotUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgrade name) {\n+    private static void getUnitSlotUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgrade name) {\n         if(Math.random() < 0.1) {\n             stats.add(new Pair<>(name, 1));  // 10% success on getting a slot upgrade.\n         }\n@@ -482,16 +482,18 @@ public int getItemExp() {\n         return (int) itemExp;\n     }\n     \n-    private double normalizedMasteryExp(int reqLevel) {\n+    private static double normalizedMasteryExp(int reqLevel) {\n         // Conversion factor between mob exp and equip exp gain. Through many calculations, the expected for equipment levelup\n         // from level 1 to 2 is killing about 100~200 mobs of the same level range, on a 1x EXP rate scenario.\n         \n         if(reqLevel >= 78) {\n-            return Math.max(ServerConstants.EQUIP_EXP_RATE * (10413.648 * Math.exp(reqLevel * 0.03275)), 15);\n+            return Math.max((10413.648 * Math.exp(reqLevel * 0.03275)), 15);\n         } else if(reqLevel >= 38) {\n-            return Math.max(ServerConstants.EQUIP_EXP_RATE * ( 4985.818 * Math.exp(reqLevel * 0.02007)), 15);\n+            return Math.max(( 4985.818 * Math.exp(reqLevel * 0.02007)), 15);\n+        } else if(reqLevel >= 18) {\n+            return Math.max((  248.219 * Math.exp(reqLevel * 0.11093)), 15);\n         } else {\n-            return Math.max(ServerConstants.EQUIP_EXP_RATE * (  248.219 * Math.exp(reqLevel * 0.11093)), 15);\n+            return Math.max(((1334.564 * Math.log(reqLevel)) - 1731.976), 15);\n         }\n     }\n     \n@@ -501,7 +503,7 @@ public void gainItemExp(MapleClient c, int gain) {  // Ronan's Equip Exp gain me\n         \n         int reqLevel = ii.getEquipStats(this.getItemId()).get(\"reqLevel\");\n         \n-        float masteryModifier = (float)ExpTable.getExpNeededForLevel(1) / (float)normalizedMasteryExp(reqLevel);\n+        float masteryModifier = (float)(ServerConstants.EQUIP_EXP_RATE * ExpTable.getExpNeededForLevel(1)) / (float)normalizedMasteryExp(reqLevel);\n         float elementModifier = (isElemental) ? 0.85f : 0.6f;\n         \n         float baseExpGain = gain * elementModifier * masteryModifier;\n@@ -552,7 +554,7 @@ public String showEquipFeatures(MapleClient c) {\n         return \"'\" + eqpName + \"' -> LV: #e#b\" + itemLevel + \"#k#n    \" + eqpInfo + \"\\r\\n\";\n     }\n \n-    public final void showLevelupMessage(String msg, MapleClient c) {\n+    private static void showLevelupMessage(String msg, MapleClient c) {\n         c.getPlayer().showHint(msg, 300);\n     }\n     "}, {"sha": "b04fbee4381eca48b1b4f73f2b4b91b5eb0e1d85", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -19,7 +19,7 @@\n     public static String[] WORLD_NAMES = {\"Scania\", \"Bera\", \"Broa\", \"Windia\", \"Khaini\", \"Bellocan\", \"Mardia\", \"Kradia\", \"Yellonde\", \"Demethos\", \"Galicia\", \"El Nido\", \"Zenith\", \"Arcenia\", \"Kastia\", \"Judis\", \"Plana\", \"Kalluna\", \"Stius\", \"Croa\", \"Medere\"};\n \n     //Login Configuration\n-    public static final int CHANNEL_LOAD = 100;                 //Max players per channel.\n+    public static final int CHANNEL_LOAD = 100;                 //Max players per channel (limit actually used to calculate the World server capacity).\n     \n     public static final long RESPAWN_INTERVAL = 10 * 1000;\t//10 seconds, 10000.\n     public static final long PURGING_INTERVAL = 5 * 60 * 1000;\n@@ -82,7 +82,7 @@\n     public static final int MESO_RATE = 10;\n     public static final int DROP_RATE = 10;\n     public static final int QUEST_RATE = 5;                         //Multiplier for Exp & Meso gains when completing a quest. Only available when USE_QUEST_RATE is true. Stacks with server Exp & Meso rates.\n-    public static final double EQUIP_EXP_RATE = 10.0;               //Rate for equipment exp gain, grows linearly. Set 1.0 for default (about 100~200 same-level range mobs killed to pass equip from level 1 to 2).\n+    public static final double EQUIP_EXP_RATE = 1.0;               //Rate for equipment exp gain, grows linearly. Set 1.0 for default (about 100~200 same-level range mobs killed to pass equip from level 1 to 2).\n     \n     public static final double PARTY_BONUS_EXP_RATE = 1.0;          //Rate for the party exp reward.\n     public static final double PQ_BONUS_EXP_RATE = 0.5;             //Rate for the PQ exp reward.\n@@ -114,6 +114,7 @@\n     public static final boolean USE_ENHANCED_CHSCROLL = true;   //Equips even more powerful with chaos upgrade.\n     public static final boolean USE_ENHANCED_CRAFTING = true;   //Apply chaos scroll on every equip crafted.\n     public static final int SCROLL_CHANCE_RATE = 0;             //Number of rolls for success on a scroll, set 0 for default.\n+    public static final int CHSCROLL_STAT_RATE = 1;             //Number of rolls of stat upgrade on a successfully applied chaos scroll, set 1 for default.\n     public static final int CHSCROLL_STAT_RANGE = 6;            //Stat upgrade range (-N, N) on chaos scrolls.\n     \n     //Beginner Skills Configuration"}, {"sha": "852fa99878e3e85e0ebad163a5f23d70525ee26b", "filename": "src/net/server/PlayerStorage.java", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/PlayerStorage.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/PlayerStorage.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/PlayerStorage.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -37,11 +37,13 @@\n     private final ReadLock rlock = locks.readLock();\n     private final WriteLock wlock = locks.writeLock();\n     private final Map<Integer, MapleCharacter> storage = new LinkedHashMap<>();\n+    private final Map<String, MapleCharacter> nameStorage = new LinkedHashMap<>();\n \n     public void addPlayer(MapleCharacter chr) {\n         wlock.lock();\n         try {\n             storage.put(chr.getId(), chr);\n+            nameStorage.put(chr.getName().toLowerCase(), chr);\n         } finally {\n \t    wlock.unlock();\n \t}\n@@ -50,7 +52,10 @@ public void addPlayer(MapleCharacter chr) {\n     public MapleCharacter removePlayer(int chr) {\n         wlock.lock();\n         try {\n-            return storage.remove(chr);\n+            MapleCharacter mc = storage.remove(chr);\n+            if(mc != null) nameStorage.remove(mc.getName().toLowerCase());\n+            \n+            return mc;\n         } finally {\n             wlock.unlock();\n         }\n@@ -59,11 +64,7 @@ public MapleCharacter removePlayer(int chr) {\n     public MapleCharacter getCharacterByName(String name) {\n         rlock.lock();    \n         try {\n-            for (MapleCharacter chr : storage.values()) {\n-                if (chr.getName().toLowerCase().equals(name.toLowerCase()))\n-                    return chr;\n-            }\n-            return null;\n+            return nameStorage.get(name.toLowerCase());\n         } finally {\n             rlock.unlock();\n         }"}, {"sha": "ff79569a48dc63e130f78dbe6aca1c406e367ee6", "filename": "src/net/server/Server.java", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -77,7 +77,7 @@\n import tools.locks.MonitoredLockType;\n import tools.AutoJCE;\n \n-public class Server implements Runnable {\n+public class Server {\n     private static final Set<Integer> activeFly = new HashSet<>();\n     private static final Map<Integer, Integer> couponRates = new HashMap<>(30);\n     private static final List<Integer> activeCoupons = new LinkedList<>();\n@@ -262,8 +262,7 @@ public void updateActiveCoupons() throws SQLException {\n         }\n     }\n \n-    @Override\n-    public void run() {\n+    public void init() {\n         Properties p = new Properties();\n         try {\n             p.load(new FileInputStream(\"world.ini\"));\n@@ -388,7 +387,7 @@ public static void main(String args[]) {\n         System.setProperty(\"wzpath\", \"wz\");\n         Security.setProperty(\"crypto.policy\", \"unlimited\");\n         AutoJCE.removeCryptographyRestrictions();\n-        Server.getInstance().run();\n+        Server.getInstance().init();\n     }\n \n     public Properties getSubnetInfo() {\n@@ -973,7 +972,7 @@ public void run() {\n                         }\n                         instance = null;\n                         System.gc();\n-                        getInstance().run();//DID I DO EVERYTHING?! D:\n+                        getInstance().init();//DID I DO EVERYTHING?! D:\n                     }\n                 } finally {\n                     srvLock.unlock();"}, {"sha": "706eb1493fdbbd39eae0c052288fa8efd7efb3b6", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -194,9 +194,9 @@ public PlayerStorage getPlayerStorage() {\n     public void removePlayer(MapleCharacter chr) {\n         players.removePlayer(chr.getId());\n     }\n-\n-    public int getConnectedClients() {\n-        return players.getAllCharacters().size();\n+    \n+    public int getChannelCapacity() {\n+        return (int)(Math.ceil(((float) players.getAllCharacters().size() / ServerConstants.CHANNEL_LOAD) * 800));\n     }\n \n     public void broadcastPacket(final byte[] data) {"}, {"sha": "771678bd5b24a775976e4b833f18673b712e5fae", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -98,16 +98,22 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         boolean allowLogin = true;\n         Channel cserv = c.getChannelServer();\n \n+        /*  is this check really necessary?\n         if (state == MapleClient.LOGIN_SERVER_TRANSITION || state == MapleClient.LOGIN_NOTLOGGEDIN) {\n-            for (String charName : c.loadCharacterNames(c.getWorld())) {\n-                for (Channel ch : c.getWorldServer().getChannels()) {\n-                    if (ch.isConnected(charName)) {\n-                        allowLogin = false;\n-                    }\n+            List<String> charNames = c.loadCharacterNames(c.getWorld());\n+            if(!newcomer) {\n+                charNames.remove(player.getName());\n+            }\n+            \n+            for (String charName : charNames) {\n+                if(c.getWorldServer().getPlayerStorage().getCharacterByName(charName) != null) {\n+                    allowLogin = false;\n+                    break;\n                 }\n-                break;\n             }\n         }\n+        */\n+        \n         if (state != MapleClient.LOGIN_SERVER_TRANSITION || !allowLogin) {\n             c.setPlayer(null);\n             c.announce(MaplePacketCreator.getAfterLoginError(7));"}, {"sha": "9a26d1c2a0c35d418fb0ce1285dfe27defa550f1", "filename": "src/net/server/handlers/login/CharSelectedHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharSelectedHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharSelectedHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharSelectedHandler.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -51,6 +51,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             return;\n         }\n         \n+        if(c.getWorldServer().isWorldCapacityFull()) {\n+            c.announce(MaplePacketCreator.getAfterLoginError(10));\n+            return;\n+        }\n+        \n         server.unregisterLoginState(c);\n         c.updateLoginState(MapleClient.LOGIN_SERVER_TRANSITION);\n         server.setCharacteridInTransition((InetSocketAddress) c.getSession().getRemoteAddress(), charId);"}, {"sha": "2bff49ba1867df9c044c898b9740f7ff38cd5ac9", "filename": "src/net/server/handlers/login/CharSelectedWithPicHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharSelectedWithPicHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharSelectedWithPicHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharSelectedWithPicHandler.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -33,6 +33,11 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         }\n         \n         if (c.checkPic(pic)) {\n+            if(c.getWorldServer().isWorldCapacityFull()) {\n+                c.announce(MaplePacketCreator.getAfterLoginError(10));\n+                return;\n+            }\n+            \n             server.unregisterLoginState(c);\n             c.updateLoginState(MapleClient.LOGIN_SERVER_TRANSITION);\n             server.setCharacteridInTransition((InetSocketAddress) c.getSession().getRemoteAddress(), charId);"}, {"sha": "2d70c42443c2a5043a2f012e4cace4db6f0e7370", "filename": "src/net/server/handlers/login/CharlistRequestHandler.java", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharlistRequestHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/CharlistRequestHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharlistRequestHandler.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -23,6 +23,8 @@\n \n import client.MapleClient;\n import net.AbstractMaplePacketHandler;\n+import net.server.Server;\n+import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class CharlistRequestHandler extends AbstractMaplePacketHandler {\n@@ -32,6 +34,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         slea.readByte();\n         int world = slea.readByte();\n         c.setWorld(world);\n+        \n+        if(Server.getInstance().getWorld(world).isWorldCapacityFull()) {\n+            c.announce(MaplePacketCreator.getServerStatus(2));\n+            return;\n+        }\n+        \n         c.setChannel(slea.readByte() + 1);\n         c.sendCharList(world);\n     }"}, {"sha": "91dd1a2c314e2453f6917da9eb40f106c672c944", "filename": "src/net/server/handlers/login/ServerStatusRequestHandler.java", "status": "modified", "additions": 4, "deletions": 14, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/ServerStatusRequestHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/handlers/login/ServerStatusRequestHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/ServerStatusRequestHandler.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -22,10 +22,9 @@\n package net.server.handlers.login;\n \n import client.MapleClient;\n-import constants.ServerConstants;\n import net.AbstractMaplePacketHandler;\n+import net.server.world.World;\n import net.server.Server;\n-import net.server.channel.Channel;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -34,18 +33,9 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         byte world = (byte) slea.readShort();//Wuuu? ):\n-        int status;\n-        int num = 0;\n-        for (Channel ch : Server.getInstance().getWorld(world).getChannels()) {\n-            num += ch.getConnectedClients();\n-        }\n-        if (num >= ServerConstants.CHANNEL_LOAD) {\n-            status = 2;\n-        } else if (num >= ServerConstants.CHANNEL_LOAD * .8) { // More than 80 percent o___o\n-            status = 1;\n-        } else {\n-            status = 0;\n-        }\n+        World wserv = Server.getInstance().getWorld(world);\n+        int status = wserv.getWorldCapacityStatus();\n+        \n         c.announce(MaplePacketCreator.getServerStatus(status));\n     }\n }"}, {"sha": "bb0fd5f4866b82759afcdb7d8b1fe8dc0bd7318a", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -264,6 +264,26 @@ public MapleGuild getGuild(MapleGuildCharacter mgc) {\n         return g;\n     }\n \n+    public boolean isWorldCapacityFull() {\n+        return getWorldCapacityStatus() == 2;\n+    }\n+    \n+    public int getWorldCapacityStatus() {\n+        int worldCap = channels.size() * ServerConstants.CHANNEL_LOAD;\n+        int num = players.getSize();\n+        \n+        int status;\n+        if (num >= worldCap) {\n+            status = 2;\n+        } else if (num >= worldCap * .8) { // More than 80 percent o___o\n+            status = 1;\n+        } else {\n+            status = 0;\n+        }\n+        \n+        return status;\n+    }\n+    \n     public MapleGuildSummary getGuildSummary(int gid, int wid) {\n         if (gsStore.containsKey(gid)) {\n             return gsStore.get(gid);"}, {"sha": "873a21e9588c3f69412223751d9d184f1bef5081", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 15, "deletions": 10, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -23,6 +23,7 @@\n \n import java.awt.Point;\n import java.util.Arrays;\n+import java.util.Calendar;\n import java.util.Collections;\n import java.util.LinkedList;\n import java.util.List;\n@@ -89,11 +90,15 @@ public MapleMap getMap() {\n                 return c.getPlayer().getMap();\n         }\n         \n+        public static int getHourOfDay() {\n+                return Calendar.getInstance().get(Calendar.HOUR_OF_DAY);\n+        }\n+        \n         public int getMarketPortalId(int mapId) {\n             return getMarketPortalId(getWarpMap(mapId));\n         }\n         \n-        private int getMarketPortalId(MapleMap map) {\n+        private static int getMarketPortalId(MapleMap map) {\n             return (map.findMarketPortal() != null) ? map.findMarketPortal().getId() : map.getRandomPlayerSpawnpoint().getId();\n         }\n         \n@@ -221,7 +226,7 @@ public boolean canHold(int itemid, int quantity) {\n                 return getPlayer().canHold(itemid, quantity);\n         }\n         \n-        private List<Integer> convertToIntegerArray(List<Double> list) {\n+        private static List<Integer> convertToIntegerArray(List<Double> list) {\n                 List<Integer> intList = new LinkedList<>();\n                 for(Double d: list) intList.add(d.intValue());\n \n@@ -507,8 +512,8 @@ public Item gainItem(int id, short quantity, boolean randomStats, boolean showMe\n \t}\n         \n         public void gainFame(int delta) {\n-            c.getPlayer().addFame(delta);\n-            c.announce(MaplePacketCreator.getShowFameGain(delta));\n+                c.getPlayer().addFame(delta);\n+                c.announce(MaplePacketCreator.getShowFameGain(delta));\n         }\n \n \tpublic void changeMusic(String songName) {\n@@ -783,7 +788,7 @@ public void gainAndEquip(int itemid, short slot) {\n \t\tc.announce(MaplePacketCreator.modifyInventory(false, Collections.singletonList(new ModifyInventory(0, newItem))));\n \t}\n         \n-        public void spawnNpc(int npcId, Point pos, MapleMap map) {\n+        public static void spawnNpc(int npcId, Point pos, MapleMap map) {\n                 MapleNPC npc = MapleLifeFactory.getNPC(npcId);\n                 if (npc != null) {\n                         npc.setPosition(pos);\n@@ -802,9 +807,13 @@ public void spawnMonster(int id, int x, int y) {\n \t\tgetPlayer().getMap().spawnMonster(monster);\n \t}\n         \n-\tpublic MapleMonster getMonsterLifeFactory(int mid) {\n+\tpublic static MapleMonster getMonsterLifeFactory(int mid) {\n \t\treturn MapleLifeFactory.getMonster(mid);\n \t}\n+        \n+        public static MobSkill getMobSkill(int skill, int level) {\n+\t\treturn MobSkillFactory.getMobSkill(skill, level);\n+\t}\n \n \tpublic void spawnGuide() {\n \t\tc.announce(MaplePacketCreator.spawnGuide(true));\n@@ -861,10 +870,6 @@ public boolean containsAreaInfo(short area, String info) {\n \t\treturn c.getPlayer().containsAreaInfo(area, info);\n \t}\n \n-\tpublic MobSkill getMobSkill(int skill, int level) {\n-\t\treturn MobSkillFactory.getMobSkill(skill, level);\n-\t}\n-\n \tpublic void earnTitle(String msg) {\n \t\tc.announce(MaplePacketCreator.earnTitleMessage(msg));\n \t}"}, {"sha": "43d576f9fd6faa266479036ef4893283eff5bd5c", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -913,6 +913,21 @@ public void spawnNpc(int npcId, Point pos, MapleMap map) {\n                 }\n         }\n         \n+        public void dispatchUpdateQuestMobCount(int mobid, int mapid) {\n+            Map<Integer, MapleCharacter> mapChars = getInstanceMap(mapid).getMapPlayers();\n+            if(!mapChars.isEmpty()) {\n+                List<MapleCharacter> eventMembers = getPlayers();\n+                \n+                for (MapleCharacter evChr : eventMembers) {\n+                    MapleCharacter chr = mapChars.get(evChr.getId());\n+\n+                    if(chr != null && chr.isLoggedin() && !chr.isAwayFromWorld()) {\n+                        chr.updateQuestMobCount(mobid);\n+                    }\n+                }\n+            }\n+        }\n+        \n         public MapleMonster getMonster(int mid) {\n                 return(MapleLifeFactory.getMonster(mid));\n         }"}, {"sha": "ada03973f9b34d7a553677c56e86219b4064cba0", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -651,7 +651,7 @@ public void scrollOptionEquipWithChaos(Equip nEquip, int range, boolean option)\n     }\n     \n     private void scrollEquipWithChaos(Equip nEquip, int range) {\n-        if(ServerConstants.SCROLL_CHANCE_RATE > 0) {\n+        if(ServerConstants.CHSCROLL_STAT_RATE > 0) {\n             int temp;\n             short curStr, curDex, curInt, curLuk, curWatk, curWdef, curMatk, curMdef, curAcc, curAvoid, curSpeed, curJump, curHp, curMp;\n             \n@@ -687,7 +687,7 @@ private void scrollEquipWithChaos(Equip nEquip, int range) {\n                 curMp = Short.MIN_VALUE;\n             }\n             \n-            for(int i = 0; i < ServerConstants.SCROLL_CHANCE_RATE; i++) {\n+            for(int i = 0; i < ServerConstants.CHSCROLL_STAT_RATE; i++) {\n                 if (nEquip.getStr() > 0) {\n                     if(ServerConstants.USE_ENHANCED_CHSCROLL) temp = curStr + chscrollRandomizedStat(range);\n                     else temp = nEquip.getStr() + chscrollRandomizedStat(range);"}, {"sha": "ae7a1c72c626639470438c610fd45de75e7b5abc", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 26, "deletions": 6, "changes": 32, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -35,7 +35,6 @@\n import constants.skills.NightLord;\n import constants.skills.NightWalker;\n import constants.skills.Shadower;\n-import constants.skills.SuperGM;\n import java.awt.Point;\n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n@@ -47,7 +46,7 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n-import java.util.LinkedHashSet;\n+import java.util.HashSet;\n import java.util.Set;\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.concurrent.atomic.AtomicLong;\n@@ -384,7 +383,7 @@ public void distributeExperience(int killerId) {\n         }\n         \n         Collection<MapleCharacter> chrs = map.getCharacters();\n-        Set<MapleCharacter> underleveled = new LinkedHashSet<>();\n+        Set<MapleCharacter> underleveled = new HashSet<>();\n         for (MapleCharacter mc : chrs) {\n             if (expDist.containsKey(mc.getId())) {\n                 boolean isKiller = (mc.getId() == killerId);\n@@ -452,7 +451,7 @@ public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKille\n             \n             attacker.gainExp(personalExp, partyExp, true, false, isKiller);\n             attacker.increaseEquipExp(personalExp);\n-            attacker.mobKilled(getId());\n+            attacker.updateQuestMobCount(getId());\n         }\n     }\n \n@@ -543,7 +542,29 @@ public void run() {\n         return looter != null ? looter : killer;\n     }\n     \n+    private void dispatchUpdateQuestMobCount() {\n+        Set<Integer> attackerChrids = takenDamage.keySet();\n+        if(!attackerChrids.isEmpty()) {\n+            Map<Integer, MapleCharacter> mapChars = map.getMapPlayers();\n+            if(!mapChars.isEmpty()) {\n+                int mobid = getId();\n+                \n+                for (Integer chrid : attackerChrids) {\n+                    MapleCharacter chr = mapChars.get(chrid);\n+\n+                    if(chr != null && chr.isLoggedin() && !chr.isAwayFromWorld()) {\n+                        chr.updateQuestMobCount(mobid);\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    \n     public void dispatchMonsterKilled(boolean hasKiller) {\n+        if(!hasKiller) {\n+            dispatchUpdateQuestMobCount();\n+        }\n+        \n         if (getMap().getEventInstance() != null) {\n             if (!this.getStats().isFriendly()) {\n                 getMap().getEventInstance().monsterKilled(this, hasKiller);\n@@ -569,8 +590,7 @@ private void dispatchMonsterHealed(int trueHeal) {\n         }\n     }\n \n-    // should only really be used to determine drop owner\n-    private int getHighestDamagerId() {\n+    public int getHighestDamagerId() {\n         int curId = 0;\n         int curDmg = 0;\n "}, {"sha": "fafa9d740190d18f9e90222d01e5ff2599f8da8d", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 40, "deletions": 7, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -1077,7 +1077,7 @@ public void broadcastPinkBeanVictory(int channel) {\n             }\n         }\n     }\n-\n+    \n     public void killMonster(final MapleMonster monster, final MapleCharacter chr, final boolean withDrops) {\n         killMonster(monster, chr, withDrops, 1);\n     }\n@@ -1180,17 +1180,34 @@ public void killFriendlies(MapleMonster mob) {\n     }\n \n     public void killMonster(int mobId) {\n-        List<MapleMapObject> mmoL = new LinkedList(getMapObjects());\n+        MapleCharacter chr = (MapleCharacter) getPlayers().get(0);\n+        List<MapleMonster> mobList = getMonsters();\n         \n-        for (MapleMapObject mmo : mmoL) {\n-            if (mmo instanceof MapleMonster) {\n-                if (((MapleMonster) mmo).getId() == mobId) {\n-                    this.killMonster((MapleMonster) mmo, (MapleCharacter) getPlayers().get(0), false);\n+        for (MapleMonster mob : mobList) {    \n+            if (mob.getId() == mobId) {\n+                this.killMonster(mob, chr, false);\n+            }\n+        }\n+    }\n+    \n+    public void killMonsterWithDrops(int mobId) {\n+        Map<Integer, MapleCharacter> mapChars = this.getMapPlayers();\n+        \n+        if(!mapChars.isEmpty()) {\n+            MapleCharacter defaultChr = mapChars.entrySet().iterator().next().getValue();\n+            List<MapleMonster> mobList = getMonsters();\n+            \n+            for (MapleMonster mob : mobList) {\n+                if (mob.getId() == mobId) {\n+                    MapleCharacter chr = mapChars.get(mob.getHighestDamagerId());\n+                    if(chr == null) chr = defaultChr;\n+                    \n+                    this.killMonster(mob, chr, true);\n                 }\n             }\n         }\n     }\n-\n+    \n     public void monsterCloakingDevice() {\n         for (MapleMapObject monstermo : getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER))) {\n             MapleMonster monster = (MapleMonster) monstermo;\n@@ -2678,6 +2695,22 @@ public void reportMonsterSpawnPoints(MapleCharacter chr) {\n         }\n     }\n \n+    public Map<Integer, MapleCharacter> getMapPlayers() {\n+        chrRLock.lock();\n+        try {\n+            Map<Integer, MapleCharacter> mapChars = new HashMap<>(characters.size());\n+            \n+            for(MapleCharacter chr : characters) {\n+                mapChars.put(chr.getId(), chr);\n+            }\n+            \n+            return mapChars;\n+        }\n+        finally {\n+            chrRLock.unlock();\n+        }\n+    }\n+    \n     public Collection<MapleCharacter> getCharacters() {\n         chrRLock.lock();\n         try {"}, {"sha": "4c609459b24be922a84505750ce49abdae863c33", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d448cce4f9360ed92decc4f5de78b7372f86bfb/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=7d448cce4f9360ed92decc4f5de78b7372f86bfb", "patch": "@@ -773,7 +773,7 @@ private static void addMonsterBookInfo(final MaplePacketLittleEndianWriter mplew\n                 mplew.write(channelLoad.size());\n                 for (Channel ch : channelLoad) {\n                         mplew.writeMapleAsciiString(serverName + \"-\" + ch.getId());\n-                        mplew.writeInt((ch.getConnectedClients() * 1200) / ServerConstants.CHANNEL_LOAD);\n+                        mplew.writeInt(ch.getChannelCapacity());\n                         mplew.write(1);\n                         mplew.writeShort(ch.getId() - 1);\n                 }\n@@ -2582,7 +2582,7 @@ private static int doubleToShortBits(double d) {\n         }\n \n         /**\n-         * It is important that statups is in the correct order (see decleration\n+         * It is important that statups is in the correct order (see declaration\n          * order in MapleBuffStat) since this method doesn't do automagical\n          * reordering.\n          *"}]}]},
