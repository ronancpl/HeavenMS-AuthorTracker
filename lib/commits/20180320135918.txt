{"fetchDate": "2019-12-19", "content": [{"sha": "97da2e2b5a505c74b4deb063ba891e546cdc051f", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6OTdkYTJlMmI1YTUwNWM3NGI0ZGViMDYzYmE4OTFlNTQ2Y2RjMDUxZg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-20T13:59:18Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-20T13:59:18Z"}, "message": "Improved Mushroom Castle + Body Pressure patch\n\nImproved the gameplay around the Mushroom Castle region.\nSolved an issue with HP threshold on MoveLifeHandler.\nFixed Body Pressure being refreshed every time it hits a mob.", "tree": {"sha": "fbf8e884f5110ad8233f547039d4e99ac49ccae4", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/fbf8e884f5110ad8233f547039d4e99ac49ccae4"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/97da2e2b5a505c74b4deb063ba891e546cdc051f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/97da2e2b5a505c74b4deb063ba891e546cdc051f", "html_url": "https://github.com/ronancpl/HeavenMS/commit/97da2e2b5a505c74b4deb063ba891e546cdc051f", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/97da2e2b5a505c74b4deb063ba891e546cdc051f/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae147a5a9f28513322509b7c9f67ba885b780a40", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ae147a5a9f28513322509b7c9f67ba885b780a40", "html_url": "https://github.com/ronancpl/HeavenMS/commit/ae147a5a9f28513322509b7c9f67ba885b780a40"}], "stats": {"total": 569, "additions": 530, "deletions": 39}, "files": [{"sha": "b899b3e4ea612309ffb4db324ec3112cf9be8c56", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -829,4 +829,9 @@ Aprimorado comando de item/drop agora permitindo gerar pets.\n \n 14 Mar\u00e7o 2018,\n Modificado spawn do Horntail, utilizando efeitos de mob ao inv\u00e9s de schedules. Cortesia de Arnah e Zenns.\n-Modificado \"hint\" banners para usar menor espa\u00e7o visual.\n\\ No newline at end of file\n+Modificado \"hint\" banners para usar menor espa\u00e7o visual.\n+\n+16 - 17 Mar\u00e7o 2018,\n+Resolvido problema com HP threshold em MoveLifeHandler.\n+Aprimorado quests e eventos de bosses da regi\u00e3o de Mushroom Castle, agora sendo repet\u00edveis.\n+Corrigido tempo de dura\u00e7\u00e3o do Body Pressure sendo resetado sempre que acerta um mob.\n\\ No newline at end of file"}, {"sha": "33d44734aa55a6e464f2804c0c52d2a203702f2d", "filename": "scripts/event/MK_PrimeMinister.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/event/MK_PrimeMinister.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/event/MK_PrimeMinister.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -2,6 +2,9 @@ var minPlayers = 1;\n var entryMap = 106021402;\n var exitMap = 106021600;\n \n+var minMapId = 106021601;\n+var maxMapId = 106021601;\n+\n function init(){}\n \n function setup(difficulty, lobbyId){\n@@ -84,11 +87,8 @@ function playerExit(eim, player){\n \tplayer.changeMap(entryMap, 2);\n }\n \n-function moveMap(eim, player){\n-\tif(player.getMap().getId() == exitMap || player.getMap().getId() == entryMap){\n-\t\tremovePlayer(eim, player);\n-\t\teim.dispose();\n-\t}\n+function changedMap(eim, chr, mapid) {\n+        if(mapid < minMapId || mapid > maxMapId) playerExit(eim, chr);\n }\n \n function removePlayer(eim, player){"}, {"sha": "746ee1f39db21fb9448fbd29396b4d82d643abff", "filename": "scripts/event/MK_PrimeMinister2.js", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/event/MK_PrimeMinister2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/event/MK_PrimeMinister2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister2.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,119 @@\n+importPackage(Packages.tools);\n+importPackage(Packages.server.life);\n+\n+var minPlayers = 1;\n+var eventTime = 10;\n+var entryMap = 106021402;\n+var exitMap = 106021600;\n+\n+var minMapId = 106021601;\n+var maxMapId = 106021601;\n+\n+function init(){}\n+\n+function setup(difficulty, lobbyId){\n+\tvar eim = em.newInstance(\"MK_PrimeMinister2_\" +lobbyId);\n+\teim.getInstanceMap(106021601).resetFully();\n+\teim.getInstanceMap(106021601).allowSummonState(false);\n+\trespawn(eim);\n+        \n+\treturn eim;\n+}\n+\n+function afterSetup(eim){}\n+\n+function respawn(eim){\n+\tvar map = eim.getMapInstance(entryMap);\n+\tmap.allowSummonState(true);\n+\tmap.instanceMapRespawn();\n+\teim.schedule(\"respawn\", 10000);\n+}\n+\n+function playerEntry(eim, player){\n+\tvar weddinghall = eim.getMapInstance(106021601);\n+\tplayer.changeMap(weddinghall, weddinghall.getPortal(1));\n+        \n+        var pm = MapleLifeFactory.getMonster(3300008);\n+        weddinghall.spawnMonsterOnGroundBelow(pm, new Packages.java.awt.Point(472, 27));\n+        \n+        player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+        eim.startEventTimer(eventTime * 60000);\n+}\n+\n+function scheduledTimeout(eim){\n+\tvar party = eim.getPlayers();\n+\n+\tfor(var i = 0; i < party.size(); i++)\n+\t\tplayerExit(eim, party.get(i));\n+\n+\teim.dispose();\n+}\n+\n+function playerRevive(eim, player){\n+\tplayer.setHp(50);\n+\tplayer.setStance(0);\n+\teim.unregisterPlayer(player);\n+\tplayer.changeMap(entryMap);\n+\treturn false;\n+}\n+\n+function playerDead(eim, player){}\n+\n+function playerDisconnected(eim, player){\n+\tvar party = eim.getPlayers();\n+\n+\tfor(var i = 0; i < party.size(); i++){\n+\t\tif(party.get(i).equals(player))\n+\t\t\tremovePlayer(eim, player);\n+\t\telse\n+\t\t\tplayerExit(eim, party.get(i));\n+\t}\n+\teim.dispose();\n+}\n+\n+function monsterValue(eim, mobId){\n+\treturn -1;\n+}\n+\n+function leftParty(eim, player){\n+\tvar party = eim.getPlayers();\n+\n+\tif(party.size() < minPlayers){\n+\t\tfor(var i = 0; i < party.size(); i++){\n+\t\t\tplayerExit(eim, party.get(i));\n+\t\t}\n+\t\teim.dispose();\n+\t}\n+\telse{\n+\t\tplayerExit(eim, player);\n+\t}\n+}\n+\n+function disbandParty(eim){}\n+\n+function playerUnregistered(eim, player){}\n+\n+function playerExit(eim, player){\n+\teim.unregisterPlayer(player);\n+\tplayer.changeMap(entryMap, 2);\n+}\n+\n+function changedMap(eim, chr, mapid) {\n+        if(mapid < minMapId || mapid > maxMapId) playerExit(eim, chr);\n+}\n+\n+function removePlayer(eim, player){\n+\teim.unregisterPlayer(player);\n+\tplayer.getMap().removePlayer(player);\n+\tplayer.setMap(entryMap);\n+}\n+\n+function cancelSchedule(){}\n+\n+function dispose(){}\n+\n+function clearPQ(eim){}\n+\n+function monsterKilled(mob, eim){}\n+\n+function allMonstersDead(eim){}\n\\ No newline at end of file"}, {"sha": "c85bed6f612333e8c34a1a58be8377ee7a3c99ec", "filename": "scripts/npc/1300001.js", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300001.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,50 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* NPC Base\n+\tMap Name (Map ID)\n+\tExtra NPC info.\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.sendOk(\"Let the ceremony begins, we cannot let the masses waiting! Hem~hem~heeh~~\");\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "07faf284dce7cd6f16325f61921d21290c643245", "filename": "scripts/npc/1300006.js", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300006.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,50 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* NPC Base\n+\tMap Name (Map ID)\n+\tExtra NPC info.\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.sendOk(\"Hey guys, what's going on? I'm already getting married at this age? But I'm only a child!!! How comes?\");\n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "bca7fc824825e660304065724da8404b3fd163bb", "filename": "scripts/npc/1300012.js", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300012.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,49 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* NPC Base\n+\tMap Name (Map ID)\n+\tExtra NPC info.\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "33309b3089b61bff0e2566f30ee140adaf86fd47", "filename": "scripts/npc/1300013.js", "status": "modified", "additions": 37, "deletions": 12, "changes": 49, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300013.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -2,6 +2,7 @@\n \tNPC: Blocked Entrance (portal?)\n \tMAP: Mushroom Castle - East Castle Tower (106021400)\n */\n+importPackage(Packages.tools);\n \n var status;\n \n@@ -25,16 +26,40 @@ function action(mode, type, selection){\n \t\tstatus++;\n \n \n-\tif(status == 0){\n-\t\tcm.sendSimple(\"#L1#Enter to fight #bKing Pepe#k and #bYeti Brothers#k.#l\");\n-\t}\n-\telse if(status == 1){\n-\t\tif(selection == 1){\n-\t\t\tvar pepe = cm.getEventManager(\"KingPepeAndYetis\");\n-\t\t\tpepe.setProperty(\"player\", cm.getPlayer().getName());\n-\t\t\tpepe.startInstance(cm.getPlayer());\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n-\t}\n+        if(cm.getMapId() == 106021402) {\n+                if(status == 0){\n+                        cm.sendSimple(\"#L0#Enter to fight #bKing Pepe#k and #bYeti Brothers#k.#l\\r\\n#L1#Enter to fight #bPrime Minister#k.#l\");\n+                }\n+                else if(status == 1){\n+                        if(selection == 0){\n+                                var pepe = cm.getEventManager(\"KingPepeAndYetis\");\n+                                pepe.setProperty(\"player\", cm.getPlayer().getName());\n+                                pepe.startInstance(cm.getPlayer());\n+                                cm.dispose();\n+                                return;\n+                        }\n+                    \n+                        else if(selection == 1){\n+                                var pm = cm.getEventManager(\"MK_PrimeMinister2\");\n+                                pm.setProperty(\"player\", cm.getPlayer().getName());\n+                                pm.startInstance(cm.getPlayer());\n+                                \n+                                cm.dispose();\n+                                return;\n+                        }\n+                }\n+        } else {\n+                if(status == 0){\n+                        cm.sendSimple(\"#L1#Enter to fight #bKing Pepe#k and #bYeti Brothers#k.#l\");\n+                }\n+                else if(status == 1){\n+                        if(selection == 1){\n+                                var pepe = cm.getEventManager(\"KingPepeAndYetis\");\n+                                pepe.setProperty(\"player\", cm.getPlayer().getName());\n+                                pepe.startInstance(cm.getPlayer());\n+                                cm.dispose();\n+                                return;\n+                        }\n+                }\n+        }\n }\n\\ No newline at end of file"}, {"sha": "17bdafe7f4ac278a28f84dd078900ee853bdcbb7", "filename": "scripts/npc/1300014.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300014.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/npc/1300014.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300014.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,3 @@\n+function start() {\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "0e8147e6a6e2f633f7cdd978092ed9411845f6e6", "filename": "scripts/portal/TD_MC_enterboss2.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/portal/TD_MC_enterboss2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/portal/TD_MC_enterboss2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_MC_enterboss2.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -1,4 +1,9 @@\n function enter(pi) {\n+    if(pi.isQuestCompleted(2331)) {\n+        pi.openNpc(1300013);\n+        return false;\n+    }\n+    \n     if(pi.isQuestCompleted(2333) && pi.isQuestStarted(2331) && !pi.hasItem(4001318)){\n         pi.getPlayer().message(\"Lost the Royal Seal, eh? Worry not! Kevin's code here to save your hide.\");\n         if(pi.canHold(4001318)){\n@@ -32,7 +37,7 @@ function enter(pi) {\n         }\n     }\n     else if(pi.isQuestStarted(2333) || (pi.isQuestCompleted(2332) && !pi.isQuestStarted(2333))){\n-        if(pi.getPlayer.getParty() != null){\n+        if(pi.getPlayer().getParty() != null){\n             pi.getPlayer().showHint(\"The next part of the quest is solo only! Must leave party.\");\n             return false;\n         }"}, {"sha": "c705ef85a4d3cab2e021d55c4e92ac1dac3d40ae", "filename": "scripts/portal/gotocastle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/portal/gotocastle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/portal/gotocastle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/gotocastle.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -5,7 +5,7 @@ function enter(pi) {\n             \n \t    pi.forceCompleteQuest(2324);\n \t    pi.removeAll(2430015);\n-\t    pi.playerMessage(5, \"Quest complete.\");\n+\t    pi.playerMessage(5, \"You have used the Thorn Remover to clear the path.\");\n \t}\n \tpi.playPortalSound(); pi.warp(106020501,0);\n \treturn true;"}, {"sha": "d89202d78bf1256ad3fe7d9a179378fd67447c26", "filename": "scripts/quest/2300.js", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2300.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2300.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2300.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,64 @@\n+/* ===========================================================\n+\t\t\tResonance\n+\tNPC Name: \t\tMaple Administrator\n+\tDescription: \tQuest -  Kingdom of Mushroom in Danger\n+=============================================================\n+Version 1.0 - Script Done.(17/7/2010)\n+=============================================================\n+*/\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t    if(type == 1 && mode == 0)\n+\t\t    status -= 2;\n+\t\telse{\n+\t\t\tif(status == 0){\n+\t\t\t\tqm.sendOk(\"Really? It's an urgent matter, so if you have some time, please see me.\");\n+\t\t\t\tqm.dispose();\n+\t\t\t\treturn;\n+\t\t\t} else if(status == 3){\n+\t\t\t\tqm.sendNext(\"Okay. In that case, I'll just give you the routes to the Kingdom of Mushroom. #bNear the west entrance of Henesys,#k you'll find an #bempty house#k. Enter the house, and turn left to enter#b<Themed Dungeon : Mushroom Castle>#k. That's the entrance to the Kingdom of Mushroom. There's not much time!\");\n+\t\t\t\tqm.forceStartQuest();\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t}\n+\t}\n+\tif(status == 0) \n+\t\tqm.sendAcceptDecline(\"Now that you have made the job advancement, you look like you're ready for this. I have something I'd like to ask you for help. Are you willing to listen?\");\n+\tif(status == 1)\n+\t\tqm.sendNext(\"What happened is that the #bKingdom of Mushroom#k is currently in disarray. Kingdom of Mushroom is located near Henesys, featuring the peace-loving, intelligent King Mush. Recently, he began to feel ill, so he decided to appoint his only daughter #bPrincess Violetta#k. Something must have happened since then for the kingdom to be in its current state.\");\n+\tif(status == 2)\n+\t\tqm.sendNext(\"I am not aware of the exact details, but it's obvious something terrible had taken place, so I think it'll be better if you go there and assess the damage yourself. An explorer like you seem more than capable of saving Kingdom of Mushroom. I have just written you a #brecommendation letter#k, so I suggest you head over to Kingdom of Mushroom immediately and look for the #bHead Patrol Officer#k.\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n#v4032375# #t4032375#\");\n+\tif(status == 3)\n+\t\tqm.sendYesNo(\"By the way, do you know where Kingdom of Mushroom is located? It'll be okay if you can find your way there, but if you don't mind, I can take you straight to the entrance.\");\n+\tif(status == 4){\n+\t\tqm.gainItem(4032375, 1);\n+\t\tqm.forceStartQuest();\n+\t\tqm.dispose();\n+\t}\n+}\n+\n+function end(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t    if(type == 1 && mode == 0)\n+\t\t    status -= 2;\n+\t\telse{\n+\t\t    qm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\tif(status == 0)\n+\t\tqm.sendNext(\"Hmmm? Is that a #brecommendation letter from the job instructor#k??! What is this, are you the one that came to save us, the Kingdom of Mushroom?\");\n+\tif(status == 1)\n+\t\tqm.sendNextPrev(\"Hmmm... okay. Since the letter is from the job instructor, I suppose you are really the one. I apologize for not introducing myself to you earlier. I'm the #bHead Security Officer#k in charge of protecting King Mush. As you can see, this temporary hideout is protected by the team of security and soldiers. Our situation may be dire, but nevertheless, welcome to Kingdom of Mushroom.\");\n+\tif(status == 2){\n+\t\tqm.gainItem(4032375, -1);\n+\t\tqm.forceCompleteQuest();\n+\t\tqm.forceStartQuest(2312);\n+\t\tqm.dispose();\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "2d6f7edc48150a9fea59e0d2ccd35218aab5aa4f", "filename": "scripts/quest/2312.js", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2312.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2312.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2312.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,55 @@\n+/* ===========================================================\n+\t\t\tResonance\n+\tNPC Name: \t\tHead Patrol Officer\n+\tMap(s): \t\tMushroom Castle: Corner of Mushroom Forest(106020000)\n+\tDescription: \tQuest -  The Test\n+=============================================================\n+Version 1.0 - Script Done.(18/7/2010)\n+=============================================================\n+*/\n+\n+importPackage(Packages.client);\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t    if(type == 1 && mode == 0)\n+\t\t    status -= 2;\n+\t\telse{\n+\t\t\tqm.sendOk(\"Hmmm... you must be unsure of your combat skills. We'll be here waiting for you, so come see us when you're ready.\");\n+\t\t    qm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\tif (status == 0)\n+\t\tqm.sendAcceptDecline(\"We need your help, noble explorer. Our kingdom is currently facing a big threat, and we are in desperate need of a courageous explorer willing to fight for us, and that's how you ended up here. Please understand, though, that since we need place our faith in you, we'll have to test your skills first before we can stand firmly behind you. Will it be okay for you to do this for us?\");\n+\tif (status == 1){\n+\t\tqm.forceStartQuest();\n+\t\tqm.sendOk(\"Keep moving forward, and you'll see #bRenegade Spores#k, the Spores that turned their backs on the Kingdom of Mushroom. We'd appreciate it if you can teach them a lesson or two, and bring back #b50 Mutated Spores#k in return.\");\n+\t\tqm.dispose();\n+\t}\n+}\n+\n+function end(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t    if(type == 1 && mode == 0)\n+\t\t    status -= 2;\n+\t\telse{\n+\t\t\tqm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\tif (status == 0)\n+\t\tqm.sendOk(\"Did you teach those Renegade Spores a lesson?\");\n+\tif (status == 1){\n+\t\tqm.forceCompleteQuest();\n+\t\tqm.gainExp(11500 * qm.getPlayer().getExpRate());\n+\t\tqm.gainItem(4000499, -50);\n+\t\tqm.sendOk(\"That was amazing. I apologize for doubting your abilities. Please save our Kingdom of Mushroom from this crisis!\");\n+\t\tqm.dispose();\n+\t}\n+}\n+\t\n\\ No newline at end of file"}, {"sha": "6f8fb102adbda0aaf5fe91067cee96799e52cc83", "filename": "scripts/quest/2313.js", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2313.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/scripts/quest/2313.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2313.js?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -0,0 +1,50 @@\n+/* ===========================================================\n+\t\t\tResonance\n+\tNPC Name: \t\tHead Patrol Officer\n+\tMap(s): \t\tMushroom Castle: Corner of Mushroom Forest(106020000)\n+\tDescription: \tQuest -  The Story Behind the Case\n+=============================================================\n+Version 1.0 - Script Done.(18/7/2010)\n+=============================================================\n+*/\n+\n+importPackage(Packages.client);\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t    if(type == 1 && mode == 0)\n+\t\t    status -= 2;\n+\t\telse{\n+\t\t\tqm.sendOk(\"There's not much time. Please hurry.\");\n+\t\t\tqm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\tif (status == 0)\n+\t\tqm.sendAcceptDecline(\"I have told our #bMinister of Home Affairs#k of your abilities. Please go pay a visit to him immediately.\");\n+\tif (status == 1){\n+\t\tqm.forceStartQuest();\n+\t\tqm.sendOk(\"Save our kingdom! We believe in you!\");\n+\t\tqm.dispose();\n+\t}\n+}\n+\n+function end(mode, type, selection) {\n+    status++;\n+\tif (mode != 1) {\n+\t\tif(type == 1 && mode == 0)\n+\t\t\tstatus -= 2;\n+\t\telse {\n+\t\t\tqm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\tif (status == 0) {\n+\t\tqm.forceCompleteQuest(); \n+\t\tqm.gainExp(4000 * qm.getPlayer().getExpRate());\n+\t\tqm.dispose();\n+\t}\n+}"}, {"sha": "8464a822eb5f5ea2a01d97560d8755abeae50605", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -1881,13 +1881,15 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\tMapleMap map = player.getMap();\n                         List<MapleMapObject> monsters = map.getMapObjectsInRange(player.getPosition(), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER));\n                         \n+                        int count = 0;\n \t\t\tfor (MapleMapObject monstermo : monsters) {\n \t\t\t\tmonster = (MapleMonster) monstermo;\n-\t\t\t\tif (!monster.getStats().isFriendly()) {\n+\t\t\t\tif (!monster.getStats().isFriendly() && !(monster.getId() >= 8810010 && monster.getId() <= 8810018)) {\n                                         map.damageMonster(player, monster, Integer.MAX_VALUE);\n+                                        count++;\n                                 }\n \t\t\t}\n-\t\t\tplayer.dropMessage(5, \"Killed \" + monsters.size() + \" monsters.\");\n+\t\t\tplayer.dropMessage(5, \"Killed \" + count + \" monsters.\");\n                     break;\n            \n \t\tcase \"notice\":"}, {"sha": "9ca3b76bd1c3f212012969ea30eb08c5759688a2", "filename": "src/net/mina/MapleCodecFactory.java", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/mina/MapleCodecFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/mina/MapleCodecFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/mina/MapleCodecFactory.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -35,14 +35,6 @@ public MapleCodecFactory() {\n         decoder = new MaplePacketDecoder();\n     }\n \n-    public ProtocolEncoder getEncoder() throws Exception {\n-        return encoder;\n-    }\n-\n-    public ProtocolDecoder getDecoder() throws Exception {\n-        return decoder;\n-    }\n-\n     @Override\n     public ProtocolEncoder getEncoder(IoSession session) throws Exception {\n         return encoder;"}, {"sha": "ac8f2f8d42ce375a0632ea17acff7189100d9335", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -162,7 +162,7 @@ protected synchronized void applyAttack(AttackInfo attack, final MapleCharacter\n                     if (player.isAlive()) {\n                         if(attack.skill == NightWalker.POISON_BOMB) // Poison Bomb\n                             attackEffect.applyTo(player, new Point(attack.position.x, attack.position.y));\n-                        else\n+                        else if(attack.skill != Aran.BODY_PRESSURE) // prevent BP refreshing\n                             attackEffect.applyTo(player);\n                     } else {\n                         player.getClient().announce(MaplePacketCreator.enableActions());"}, {"sha": "c9b70d859814ae20ea9f66867006749c4cf2c6e7", "filename": "src/net/server/channel/handlers/MoveLifeHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/channel/handlers/MoveLifeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/channel/handlers/MoveLifeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveLifeHandler.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -78,8 +78,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\n \t\tMobSkill toUse = null;\n \t\t\n-\t\tint percHpLeft = (int) ((monster.getHp() / monster.getMaxHp()) * 100);\n-\n+\t\tint percHpLeft = (int) (((float) monster.getHp() / monster.getMaxHp()) * 100);\n+                \n \t\tif (nextMovementCouldBeSkill && monster.getNoSkills() > 0) {\n \t\t\tint Random = Randomizer.nextInt(monster.getNoSkills());\n \t\t\tPair<Integer, Integer> skillToUse = monster.getSkills().get(Random);"}, {"sha": "9447960ad5c7caded04ec821376850ccbc2435cb", "filename": "src/net/server/handlers/login/LoginPasswordHandler.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/handlers/login/LoginPasswordHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/net/server/handlers/login/LoginPasswordHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/LoginPasswordHandler.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -48,7 +48,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \n         String login = slea.readMapleAsciiString();\n         String pwd = slea.readMapleAsciiString();\n-        String bcryptedpass = BCrypt.hashpw(pwd, BCrypt.gensalt(12));\n         c.setAccountName(login);\n \n         int loginok = c.login(login, pwd);"}, {"sha": "8ed88997a8a31870e2cd95f73a01917b91a913e4", "filename": "src/scripting/portal/PortalPlayerInteraction.java", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/scripting/portal/PortalPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/scripting/portal/PortalPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/portal/PortalPlayerInteraction.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -28,6 +28,7 @@\n import java.sql.SQLException;\n import scripting.AbstractPlayerInteraction;\n import server.MaplePortal;\n+import server.quest.MapleQuest;\n import tools.DatabaseConnection;\n import tools.MaplePacketCreator;\n \n@@ -80,7 +81,23 @@ public boolean hasLevel30Character() {\n         \n         return getPlayer().getLevel() >= 30;\n     }\n+    \n+    public boolean forceStartQuest(int id) {\n+            return forceStartQuest(id, 9010000);\n+    }\n \n+    public boolean forceStartQuest(int id, int npc) {\n+            return MapleQuest.getInstance(id).forceStart(getPlayer(), npc);\n+    }\n+    \n+    public boolean forceCompleteQuest(int id) {\n+            return forceCompleteQuest(id, 9010000);\n+    }\n+\n+    public boolean forceCompleteQuest(int id, int npc) {\n+            return MapleQuest.getInstance(id).forceComplete(getPlayer(), npc);\n+    }\n+    \n     public void blockPortal() {\n         c.getPlayer().blockPortal(getPortal().getScriptName());\n     }"}, {"sha": "22782c71d0b8b10febcbb4147cd7d6ca36e7ac3a", "filename": "src/scripting/quest/QuestScriptManager.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/scripting/quest/QuestScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/scripting/quest/QuestScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/quest/QuestScriptManager.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -162,4 +162,9 @@ public void dispose(MapleClient c) {\n \tpublic QuestActionManager getQM(MapleClient c) {\n \t\treturn qms.get(c);\n \t}\n+        \n+        public void reloadQuestScripts() {\n+                scripts.clear();\n+                qms.clear();\n+        }\n }"}, {"sha": "005cf44ace841d36da681be2f952f3998c0fc9b1", "filename": "src/server/MapleShopFactory.java", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/server/MapleShopFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/server/MapleShopFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleShopFactory.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -37,10 +37,6 @@ public static MapleShopFactory getInstance() {\n         return instance;\n     }\n \n-    public void reloadShops() {\n-        shops.clear();\n-    }\n-    \n     private MapleShop loadShop(int id, boolean isShopId) {\n         MapleShop ret = MapleShop.createFromDB(id, isShopId);\n         if (ret != null) {\n@@ -67,4 +63,9 @@ public MapleShop getShopForNPC(int npcId) {\n         }\n         return loadShop(npcId, false);\n     }\n+    \n+    public void reloadShops() {\n+        shops.clear();\n+        npcShops.clear();\n+    }\n }"}, {"sha": "9ea11cd784618e3ce1c0ce8f0b861b2ea03d02db", "filename": "src/server/life/MobSkill.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/server/life/MobSkill.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/97da2e2b5a505c74b4deb063ba891e546cdc051f/src/server/life/MobSkill.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MobSkill.java?ref=97da2e2b5a505c74b4deb063ba891e546cdc051f", "patch": "@@ -221,7 +221,7 @@ public void applyEffect(MapleCharacter player, MapleMonster monster, boolean ski\n             case 155: // avoid up\n             case 156: // speed up\n                 break;\n-            case 200:\n+            case 200: // summon\n                 if (monster.getMap().getSpawnedMonstersOnMap() < 80) {\n                     for (Integer mobId : getSummons()) {\n                         MapleMonster toSpawn = MapleLifeFactory.getMonster(mobId);"}]}]},
