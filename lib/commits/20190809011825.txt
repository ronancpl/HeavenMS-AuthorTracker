{"fetchDate": "2019-12-19", "content": [{"sha": "b6ec7164d59cbd2da91c07d26ac3c475d7017a73", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YjZlYzcxNjRkNTljYmQyZGE5MWMwN2QyNmFjM2M0NzVkNzAxN2E3Mw==", "commit": {"author": {"name": "Periwinks", "email": "blossomdms@gmail.com", "date": "2019-08-09T01:18:25Z"}, "committer": {"name": "Ronan Lana", "email": "rcpl2010@gmail.com", "date": "2019-08-09T01:18:25Z"}, "message": "Fix mob DR skills (#509)\n\nIn Maplestory, there are three reflection buffs:\r\n- Physical Reflect\r\n- Magical Reflect\r\n- Mixed Reflect (both combined)\r\n\r\nPhysical reflect would only reflect damage to physical users, Magical would only reflect to magical users.\r\n\r\nIn HeavenMS, the reflects are treated as an HP reflect and MP reflect, so the vanilla reflection mechanic was implemented here", "tree": {"sha": "be582276742760f2563221fc2b5ec49506a0677a", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/be582276742760f2563221fc2b5ec49506a0677a"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/b6ec7164d59cbd2da91c07d26ac3c475d7017a73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b6ec7164d59cbd2da91c07d26ac3c475d7017a73", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b6ec7164d59cbd2da91c07d26ac3c475d7017a73", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b6ec7164d59cbd2da91c07d26ac3c475d7017a73/comments", "author": {"login": "Periwinks", "id": 45158867, "node_id": "MDQ6VXNlcjQ1MTU4ODY3", "avatar_url": "https://avatars3.githubusercontent.com/u/45158867?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Periwinks", "html_url": "https://github.com/Periwinks", "followers_url": "https://api.github.com/users/Periwinks/followers", "following_url": "https://api.github.com/users/Periwinks/following{/other_user}", "gists_url": "https://api.github.com/users/Periwinks/gists{/gist_id}", "starred_url": "https://api.github.com/users/Periwinks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Periwinks/subscriptions", "organizations_url": "https://api.github.com/users/Periwinks/orgs", "repos_url": "https://api.github.com/users/Periwinks/repos", "events_url": "https://api.github.com/users/Periwinks/events{/privacy}", "received_events_url": "https://api.github.com/users/Periwinks/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4279dc3096be103159f5d33c70f022d1e68ec18", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/d4279dc3096be103159f5d33c70f022d1e68ec18", "html_url": "https://github.com/ronancpl/HeavenMS/commit/d4279dc3096be103159f5d33c70f022d1e68ec18"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "576bf33f2363e6c38f2c3c7c407f173bb247f66c", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b6ec7164d59cbd2da91c07d26ac3c475d7017a73/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b6ec7164d59cbd2da91c07d26ac3c475d7017a73/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=b6ec7164d59cbd2da91c07d26ac3c475d7017a73", "patch": "@@ -521,7 +521,7 @@ public void run() {\n                         \n                         map.damageMonster(player, monster, totDamageToOneMonster);\n                     }\n-                    if (monster.isBuffed(MonsterStatus.WEAPON_REFLECT)) {\n+                    if (monster.isBuffed(MonsterStatus.WEAPON_REFLECT) && !attack.magic) {\n                         List<Pair<Integer, Integer>> mobSkills = monster.getSkills();\n                         \n                         for (Pair<Integer, Integer> ms : mobSkills) {\n@@ -532,13 +532,14 @@ public void run() {\n                             }\n                         }\n                     }                \n-                    if (monster.isBuffed(MonsterStatus.MAGIC_REFLECT)) {\n+                    if (monster.isBuffed(MonsterStatus.MAGIC_REFLECT) && attack.magic) {\n                         List<Pair<Integer, Integer>> mobSkills = monster.getSkills();\n                         \n                         for (Pair<Integer, Integer> ms : mobSkills) {\n                             if (ms.left == 145) {\n                                 MobSkill toUse = MobSkillFactory.getMobSkill(ms.left, ms.right);\n-                                player.addMP(-toUse.getY());\n+                                player.addHP(-toUse.getY());\n+                                map.broadcastMessage(player, MaplePacketCreator.damagePlayer(0, monster.getId(), player.getId(), toUse.getY(), 0, 0, false, 0, true, monster.getObjectId(), 0, 0), true);\n                             }\n                         }\n                     }"}]}]},
