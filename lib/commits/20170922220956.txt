{"fetchDate": "2019-12-19", "content": [{"sha": "9c72ce1e3a5fec23dca16ef85b62eb250254415d", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6OWM3MmNlMWUzYTVmZWMyM2RjYTE2ZWY4NWI2MmViMjUwMjU0NDE1ZA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-09-22T22:09:56Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-09-22T22:09:56Z"}, "message": "Revamped buff system + skill cd/buff schedule rework\n\nCompletely rearranged buff system (system can smartly check for the best\nstatup to take effect for it's duration, or the server can be flagged to\nact as usual). Refactored scheduling system for buffs expiration and\ncooldowns to use one single thread per player rather than one per\ninstance.", "tree": {"sha": "ef55b67910a0f25d7196e7a938b7fcad641f0447", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/ef55b67910a0f25d7196e7a938b7fcad641f0447"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/9c72ce1e3a5fec23dca16ef85b62eb250254415d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/9c72ce1e3a5fec23dca16ef85b62eb250254415d", "html_url": "https://github.com/ronancpl/HeavenMS/commit/9c72ce1e3a5fec23dca16ef85b62eb250254415d", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/9c72ce1e3a5fec23dca16ef85b62eb250254415d/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ffcf47f797554e7571daf965be7bcea9aee2f8e", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/1ffcf47f797554e7571daf965be7bcea9aee2f8e", "html_url": "https://github.com/ronancpl/HeavenMS/commit/1ffcf47f797554e7571daf965be7bcea9aee2f8e"}], "stats": {"total": 2020, "additions": 1379, "deletions": 641}, "files": [{"sha": "6b3f49c015fd92a5701392e4d7d9571675c1c1c4", "filename": "README.md", "status": "renamed", "additions": 44, "deletions": 36, "changes": 80, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -1,6 +1,7 @@\n-MapleSolaxiaV2\n+# MapleSolaxiaV2\n+---\n \n-Freelance developer: Ronan C. P. Lana\n+## Freelancer developer: Ronan C. P. Lana\n \n Credits are to be given too to Nexon(Duh!), the original MapleSolaxia staff and other colaborators, as just some changes/patches on the game were applied by myself, in which some of them diverged from the original v83 patch contents.\n \n@@ -12,25 +13,28 @@ In this project, many gameplay-wise issues generated from either the original WZ\n \n The main objective of this project is to try as best as possible to recreate what once was the original MapleStory v83, while adding up some flavors that spices up the gameplay. In other words, to aim to get the best of the MapleStory of that era.\n \n----- Download items ----\n+---\n+### Download items \n \n Server files: https://github.com/ronancpl/MapleSolaxiaV2\n+\n Client files & general tools: https://drive.google.com/drive/folders/0BzDsHSr-0V4MYVJ0TWIxd05hYUk\n \n----- Preparing the ambient ----\n+---\n+### Preparing the ambient \n \n The following link teaches on how to install a MapleStory v83 private server, however IT DIFFERS on what is used here: http://forum.ragezone.com/f428/maplestory-private-server-v83-741739/\n \n Use that link ONLY AS AN ORIENTATION on where here things start to become ambiguous.\n \n Firstly, install all the general tools required to run the server:\n-\t- WampServer2.0i.exe -> recipient of the server.\n-\t- hamachi.msi -> used for establishing a tunnelling route for the server/client communication.\n-\t- mysql-workbench-gpl-5.2.39-win32 -> MySQL server component, will store the server's DB.\n+* WampServer2.0i.exe -> recipient of the server.\n+* hamachi.msi -> used for establishing a tunnelling route for the server/client communication.\n+* mysql-workbench-gpl-5.2.39-win32 -> MySQL server component, will store the server's DB.\n \n Now install the Java 7 Development Kit:\n-\t- jdk-7u79-windows-x64.exe\n-\t- netbeans-8.0.2-javase-windows.exe -> It's a NetBeans project, use other IDE at your own risk.\n+* jdk-7u79-windows-x64.exe\n+* netbeans-8.0.2-javase-windows.exe -> It's a NetBeans project, use other IDE at your own risk.\n \n Overwrite whenever prompted with the JAR files under \"jce_policy-7/UnlimitedJCEPolicy\" in these Java folders:\n C:\\Program Files\\Java\\jre7\\lib\n@@ -54,19 +58,20 @@ For Hamachi:\n Try opening it. It's that simple.\n Hamachi is optional, though. You don't have to install Hamachi if you want to make the server just for use on your own machine. However, if you want to let other players access your server, consider alternatively using port-forwarding methods.\n \n----- Installing the SERVER ----\n+---\n+### Installing the SERVER \n \n Set the \"MapleSolaxia\" folder on a place of your preference. It is recommended for use \"C:\\Nexon\\MapleSolaxia\".\n \n Setting up the SQL: open MySQL Query Browser, and define these parameters at startup and click OK:\n Server Host: localhost\t\tPort: 3306\t\tUsername: root\n \n Now it must be done CAREFULLY:\n-\t- File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_database.sql, and execute it.\n-\t- File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_drops.sql, and execute it.\n+1. File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_database.sql, and execute it.\n+2. File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_drops.sql, and execute it.\n \n Now it is OPTIONAL, you don't need to run it if you don't want, as it will simply change some NPC shops to set some new goods, not present in the original MapleStory, to sell:\n-\t- File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_shopupdate.sql, and execute it.\n+3. File -> Open Script... -> Browse for \"C:\\MapleSolaxia\\sql\" -> db_shopupdate.sql, and execute it.\n \n At the end of the execution of these SQLs, you should have installed a database schema named \"maplesolaxia\". REGISTER YOUR FIRST ACCOUNT to be used in-game by creating manually a entry on the table \"accounts\" at that database with a login and a password.\n \n@@ -78,53 +83,56 @@ Inside the project, you may encounter some code errors. These happens because yo\n \n Finally, select \"Clean and Build project\" to build the JAR file for the MapleStory server. Once done, make sure both WampServer and Hamachi are on and functioning, and then execute \"launch.bat\" on the root of the project. If no errors were raised from this action, your MapleStory server is now online.\n \n----- Installing the CLIENT ----\n+---\n+### Installing the CLIENT \n \n The client's set-up is quite straightforward:\n-\t- From \"ManagerMsv83.exe\", install MapleStory on your folder of preference (e.g. \"C:\\Nexon\\MapleStory\") and follow their instructions.\n-\t- Once done, erase these files: \"HShield\" (folder), \"ASPLauncher.exe\", \"MapleStory.exe\" and \"patcher.exe\".\n-\t- Extract into the client folder the \"localhost.exe\" from Localhostv83.\n-\t- Overwrite the original WZ files with the ones provided from \"client_wz\" folder on the Google Drive.\n+1. From \"ManagerMsv83.exe\", install MapleStory on your folder of preference (e.g. \"C:\\Nexon\\MapleStory\") and follow their instructions.\n+2. Once done, erase these files: \"HShield\" (folder), \"ASPLauncher.exe\", \"MapleStory.exe\" and \"patcher.exe\".\n+3. Extract into the client folder the \"localhost.exe\" from Localhostv83.\n+4. Overwrite the original WZ files with the ones provided from \"client_wz\" folder on the Google Drive.\n \n If you are not using \"localhost\" as the target IP on the server's config file, you will need to HEX-EDIT \"localhost.exe\" to fetch your IP. Track down all IP locations by searching for \"Text String\" \"127.0.0.1\", and applying the changes wherever it fits.\n \n To hex-edit, install the Neo Hex Editor from \"free-hex-editor-neo.exe\" and follow their instructions. Once done, open \"localhost.exe\" for editing and overwrite the IP values under the 3 addresses. Save the changes and exit the editor.\n \n Open the \"localhost.exe\" client. If by any means the program did not open, and checking que server log your ping has been listened and you are using Windows 8 or 10, it probably might be some compatibility issue. Extract \"lolwut.exe\" from \"lolwut-v0.01.rar\" and place it on the MapleStory client folder (\"C:\\Nexon\\MapleStory\"). Your \"localhost.exe\" property settings must follow these:\n-\t- Run in compatibility mode: Windows 7;\n-\t- Unchecked reduced color mode;\n-\t- 640 x 480 resolution;\n-\t- Unchecked disable display on high DPI settings;\n-\t- Run as an administrator;\n-\t- Opening \"lolwut.exe\", use Fraysa's method.\n+* Run in compatibility mode: Windows 7;\n+* Unchecked reduced color mode;\n+* 640 x 480 resolution;\n+* Unchecked disable display on high DPI settings;\n+* Run as an administrator;\n+* Opening \"lolwut.exe\", use Fraysa's method.\n \n Important: should the client being refused to connect to the game server, it may be because firewall issues. Head to the end of this file to proceed to enabling this connection with the computer's firewall. Alternatively, one can deactivate the firewall and try opening the client again.\n \n----- Important note about CLIENT EDITING ----\n+---\n+### Important note about CLIENT EDITING \n \n DO NOT USE the server's XMLs for reimporting into the client's WZ, it WILL generate some kind of bugs afterwards.\n-\t- Use instead the HaRepacker 4.2.4, encryption \"GMS (old)\".\n-\t- Open the desired WZ for editing and, USING THE UI, make the desired changes.\n-\t- Save the changed WZ, overwriting the original content at the client folder.\n-\t- Finally, RE-EXPORT (\"Private Server...\" exporting option) the changed XMLs into the server's WZ.XML files, overwriting the old contents.\n+* Use instead the HaRepacker 4.2.4, encryption \"GMS (old)\".\n+* Open the desired WZ for editing and, USING THE UI, make the desired changes.\n+* Save the changed WZ, overwriting the original content at the client folder.\n+* Finally, RE-EXPORT (\"Private Server...\" exporting option) the changed XMLs into the server's WZ.XML files, overwriting the old contents.\n \n These steps are IMPORTANT to maintain synchronization between the server and client modules.\n \n As an example of client WZ editing, consider the MobBookUpdate project I developed, for updating all reported drop data of the mobs in the game based on the current drop data on the database:\n-\t- Open the MobBookUpdate project on NetBeans, located at \"C:\\Nexon\\MapleSolaxia\\MobBookUpdate\", and build it.\n-\t- At the subfolder \"lib\", copy the file \"MonsterBook.img.xml\". This is from the original WZ v83.\n-\t- Paste it on the \"dist\" subfolder.\n-\t- Inside \"dist\", open the command prompt by alt+right clicking there.\n-\t- Execute \"java -jar MobBookUpdate.jar\". It will generate a \"MonsterBook_updated.img.xml\" file.\n-\t- At last, overwrite the \"MonsterBook.img.xml\" on \"C:\\Nexon\\MapleSolaxia\\wz\\String.wz\" with this file, renaming it back to \"MonsterBook.img.xml\".\n+* Open the MobBookUpdate project on NetBeans, located at \"C:\\Nexon\\MapleSolaxia\\MobBookUpdate\", and build it.\n+* At the subfolder \"lib\", copy the file \"MonsterBook.img.xml\". This is from the original WZ v83.\n+* Paste it on the \"dist\" subfolder.\n+* Inside \"dist\", open the command prompt by alt+right clicking there.\n+* Execute \"java -jar MobBookUpdate.jar\". It will generate a \"MonsterBook_updated.img.xml\" file.\n+* At last, overwrite the \"MonsterBook.img.xml\" on \"C:\\Nexon\\MapleSolaxia\\wz\\String.wz\" with this file, renaming it back to \"MonsterBook.img.xml\".\n \n At this point, the server-side Monster Book has been updated with the current state of the database's drop data. Then, open HaRepacker 4.2.2 and load \"String.wz\" from \"C:\\Nexon\\MapleStory\". Drop the \"MonsterBook.img\" node by removing it from the hierarchy tree, then (CONTRARY TO WHAT SHOULD BE DONE NORMALLY!) import the server's \"MonsterBook.img.xml\".\n \n Take note that this is absolutely dangerous if done unwary. Once the MonsterBook.img does not hold client specific data in it's node contents, importing the XML causes no harm at all. However, try not to remove/reimport nodes from WZ files, as it may cause data losses. Use the HaRepacker's UI instead to make the changes.\n \n Save the changes and overwrite the older WZ on the MapleStory client folder.\n \n----- Portforwarding the SERVER ----\n+---\n+### Portforwarding the SERVER\n \n To use portforward, you will need to have permission to change things on the LAN router. Access yor router using the Internet browser. URLs vary accordingly with the manufacturer. To discover it, open the command prompt and type \"ipconfig\" and search for the \"default gateway\" field. The IP shown there is the URL needed to access the router. Also, look for the IP given to your machine (aka \"IPv4 address\" field), which will be the server one. \n ", "previous_filename": "README.txt"}, {"sha": "77d5c4fb19ed3d89dda72c5d23cc331bbd36e750", "filename": "build/built-jar.properties", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/built-jar.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/built-jar.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/built-jar.properties?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -1,4 +1,4 @@\n-#Fri, 15 Sep 2017 16:29:27 -0300\n+#Fri, 22 Sep 2017 18:20:17 -0300\n \n \n C\\:\\\\Nexon\\\\MapleSolaxia\\\\MapleSolaxiaV2="}, {"sha": "a361b3bdf90508d6266817f5f6ca5ffa8f6c192d", "filename": "build/classes/client/MapleCharacter$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "ee6100e0ef4fc967588a6d82fba12335bfe473a3", "filename": "build/classes/client/MapleCharacter$10.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$10.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$10.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$10.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "d99275b03c128f19c4c9d48b0a4a42e33f3100a3", "filename": "build/classes/client/MapleCharacter$11.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$11.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$11.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$11.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "7a727bbf6e31f46c4f0f342ac475a20edab3ef31", "filename": "build/classes/client/MapleCharacter$12.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$12.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$12.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$12.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "f4c48c73adc387a788333f631ee8db7eabab8a4d", "filename": "build/classes/client/MapleCharacter$13.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$13.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$13.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$13.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "016ea1c511f2ab128007f3ed4617bd08871ff165", "filename": "build/classes/client/MapleCharacter$14.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$14.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$14.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$14.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "03162d5e8592208b28f0d5bcc9308e00572524ec", "filename": "build/classes/client/MapleCharacter$15.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$15.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$15.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$15.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "b2d8b49392c5e185f5503cb2e0688c9596a198bc", "filename": "build/classes/client/MapleCharacter$16.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$16.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$16.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$16.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "7c0a5e73ab3102d3f8223f636f09da6cceeeeb1a", "filename": "build/classes/client/MapleCharacter$17.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$17.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$17.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$17.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "954814eb6e0c8ab55500b42a98aa45c96f8dc02a", "filename": "build/classes/client/MapleCharacter$18.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$18.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$18.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$18.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "0003e3b34a76b1cc987940873f0f6da812b65b3d", "filename": "build/classes/client/MapleCharacter$19.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$19.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$19.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$19.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "576c9b7de23bc2fc32a908351fba548da5237ae7", "filename": "build/classes/client/MapleCharacter$2.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$2.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$2.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$2.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "110946bc58cdba03fa58a4022720ad6b2d147dff", "filename": "build/classes/client/MapleCharacter$3.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$3.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$3.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$3.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "2552774c5baf1fb58f8ea914bf21bf4f5cc90c61", "filename": "build/classes/client/MapleCharacter$4.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$4.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$4.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$4.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "54a45b8fcfa108554dd64c387471d248b8337066", "filename": "build/classes/client/MapleCharacter$5.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$5.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$5.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$5.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "492b11ddb55249b96ea90c0a9a24b8b50b64b3a8", "filename": "build/classes/client/MapleCharacter$6.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$6.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$6.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$6.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "22443c05cf6d26de0ffb7451f6fd51ae9eda584b", "filename": "build/classes/client/MapleCharacter$7.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$7.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$7.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$7.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "26802da3691408b430108a5b135d0d944c62729c", "filename": "build/classes/client/MapleCharacter$8.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$8.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$8.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$8.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "6696ed12c1272112f597d8954934fa4173c9278c", "filename": "build/classes/client/MapleCharacter$9.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$9.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$9.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$9.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "4c50e4828dd9af35902e25f5ec6645fddde4300e", "filename": "build/classes/client/MapleCharacter$CancelCooldownAction.class", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/client/MapleCharacter$CancelCooldownAction.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/client/MapleCharacter$CancelCooldownAction.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$CancelCooldownAction.class?ref=1ffcf47f797554e7571daf965be7bcea9aee2f8e"}, {"sha": "a01230969c0a7bba7e60590cf8f61095cc3811f9", "filename": "build/classes/client/MapleCharacter$FameStatus.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$FameStatus.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$FameStatus.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$FameStatus.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "90cafdd6210e14ff88de4dacca4fd4fc847ccb44", "filename": "build/classes/client/MapleCharacter$MapleBuffStatValueHolder.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$MapleBuffStatValueHolder.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$MapleBuffStatValueHolder.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$MapleBuffStatValueHolder.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "43d7af5ada228e652aa6aab3dddbdfe7d37854ea", "filename": "build/classes/client/MapleCharacter$MapleCoolDownValueHolder.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$MapleCoolDownValueHolder.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$MapleCoolDownValueHolder.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$MapleCoolDownValueHolder.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "df0d9045a648a7136b83f95b4aaaacd585ee3534", "filename": "build/classes/client/MapleCharacter$SkillEntry.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$SkillEntry.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter$SkillEntry.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter$SkillEntry.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "95c5514978edfca97910223119ff299e697e8ee4", "filename": "build/classes/client/MapleCharacter.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleCharacter.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleCharacter.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "02b85613d66ad8a9be6c312bdca7d6605e4cdace", "filename": "build/classes/client/MapleClient.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleClient.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/MapleClient.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/MapleClient.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "351ebdf676c7167ad81b8aad6a6c1c629db0de2d", "filename": "build/classes/client/command/Commands$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/command/Commands$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/command/Commands$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/command/Commands$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "f30be0f8bd9e6ec8c3b4b7522f64aaceb04b911e", "filename": "build/classes/client/command/Commands.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/command/Commands.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/client/command/Commands.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/client/command/Commands.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "53fb5d78668106888480a93b13e4f6944424de22", "filename": "build/classes/constants/ItemConstants.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/constants/ItemConstants.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/constants/ItemConstants.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/constants/ItemConstants.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "b695a8ccb47d0be82a6694ef20933e670d195470", "filename": "build/classes/constants/ServerConstants.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/constants/ServerConstants.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/constants/ServerConstants.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/constants/ServerConstants.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "79498e6aa77f39fbfd806411c008d546ff5f4931", "filename": "build/classes/net/server/CouponWorker.class", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/net/server/CouponWorker.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/net/server/CouponWorker.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/CouponWorker.class?ref=1ffcf47f797554e7571daf965be7bcea9aee2f8e"}, {"sha": "e0745771b834ccc1222688569809103a4986c3ec", "filename": "build/classes/net/server/RankingWorker.class", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/net/server/RankingWorker.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/net/server/RankingWorker.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/RankingWorker.class?ref=1ffcf47f797554e7571daf965be7bcea9aee2f8e"}, {"sha": "06eb077f6a07068246ca2cb5ef66a1fbfe65b110", "filename": "build/classes/net/server/Server$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/Server$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/Server$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/Server$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "4bef61ba52468a3b0a73759891e243445c08caa9", "filename": "build/classes/net/server/Server.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/Server.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/Server.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/Server.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "2fe33a80efa89cd290f5ffeb6428e027f7b5e8c7", "filename": "build/classes/net/server/channel/handlers/CancelBuffHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/CancelBuffHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/CancelBuffHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/CancelBuffHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "55ecccc809dacb9b834c7c927396240ebc485ad0", "filename": "build/classes/net/server/channel/handlers/CloseRangeDamageHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/CloseRangeDamageHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/CloseRangeDamageHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/CloseRangeDamageHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "4596d166cc39f64ce0678dcd50cd57ce10d0de51", "filename": "build/classes/net/server/channel/handlers/EnterCashShopHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/EnterCashShopHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/EnterCashShopHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/EnterCashShopHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "a36be5dc2c011609528952cf7a94ce48cd58d8f6", "filename": "build/classes/net/server/channel/handlers/EnterMTSHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/EnterMTSHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/EnterMTSHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/EnterMTSHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "024a19bc551116e7439f7000e2953ac31e4bdcf8", "filename": "build/classes/net/server/channel/handlers/MagicDamageHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/MagicDamageHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/MagicDamageHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/MagicDamageHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "651f198286a84edf9bcf2836da4af32a9b0bf5dc", "filename": "build/classes/net/server/channel/handlers/PlayerInteractionHandler$Action.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerInteractionHandler$Action.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerInteractionHandler$Action.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/PlayerInteractionHandler$Action.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "a043aa9590344c43efccceffd21f7eb10474d12c", "filename": "build/classes/net/server/channel/handlers/PlayerInteractionHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerInteractionHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerInteractionHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/PlayerInteractionHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "98843c7969833beb2abdb4430d61552dbef93108", "filename": "build/classes/net/server/channel/handlers/PlayerLoggedinHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerLoggedinHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/PlayerLoggedinHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/PlayerLoggedinHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "2a33769d850800f7e4264c2344879f2aa1d2f6e3", "filename": "build/classes/net/server/channel/handlers/RangedAttackHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/RangedAttackHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/RangedAttackHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/RangedAttackHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "bd888d1b041e848c92d9d3a6dd85d030fd3795c5", "filename": "build/classes/net/server/channel/handlers/SpecialMoveHandler.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/SpecialMoveHandler.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/channel/handlers/SpecialMoveHandler.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/channel/handlers/SpecialMoveHandler.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "af99445edf9f8daf7bf0fe0a0f5e72e0033497bf", "filename": "build/classes/net/server/world/World$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/world/World$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/world/World$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/world/World$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "e2e7aa686134dd85eb80c44975a6f352dd9729a6", "filename": "build/classes/net/server/world/World.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/world/World.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/net/server/world/World.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/net/server/world/World.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "53c6d95c1fb7e1b8bc30582779c5b021ef8f73c3", "filename": "build/classes/server/MapleInventoryManipulator.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleInventoryManipulator.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleInventoryManipulator.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleInventoryManipulator.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "d0fbe4a32f7b693f09447de4e526f3d2ece9ec83", "filename": "build/classes/server/MapleItemInformationProvider$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleItemInformationProvider$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "b9223961de21cf2115fad7d19fd5630fd3c882bb", "filename": "build/classes/server/MapleItemInformationProvider$RewardItem.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$RewardItem.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$RewardItem.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleItemInformationProvider$RewardItem.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "d5ca87bc1457a77f328b8100482b3b590db6170e", "filename": "build/classes/server/MapleItemInformationProvider$scriptedItem.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$scriptedItem.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider$scriptedItem.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleItemInformationProvider$scriptedItem.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "cff13cffe9ac399f3b21298f8ada2d55eb6945dd", "filename": "build/classes/server/MapleItemInformationProvider.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleItemInformationProvider.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleItemInformationProvider.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "07c1f37285bf28b42c206cdf07fc94666b12a2b8", "filename": "build/classes/server/MapleShop.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleShop.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleShop.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleShop.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "c2ddbee840e0b1efde7f80a4e17e915f4026c9aa", "filename": "build/classes/server/MapleStatEffect$CancelEffectAction.class", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/server/MapleStatEffect$CancelEffectAction.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/server/MapleStatEffect$CancelEffectAction.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleStatEffect$CancelEffectAction.class?ref=1ffcf47f797554e7571daf965be7bcea9aee2f8e"}, {"sha": "7ddf2b440114b75cdc3d31c9cb95dee717291a22", "filename": "build/classes/server/MapleStatEffect.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleStatEffect.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/MapleStatEffect.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/MapleStatEffect.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "7674d57d272754b28a791707348048e222b3b11e", "filename": "build/classes/server/maps/HiredMerchant$1.class", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/server/maps/HiredMerchant$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/1ffcf47f797554e7571daf965be7bcea9aee2f8e/build/classes/server/maps/HiredMerchant$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/maps/HiredMerchant$1.class?ref=1ffcf47f797554e7571daf965be7bcea9aee2f8e"}, {"sha": "ec0540adc61808f3c5e65a40dcd7016d86b2fc15", "filename": "build/classes/server/maps/HiredMerchant$SoldItem.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/maps/HiredMerchant$SoldItem.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/maps/HiredMerchant$SoldItem.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/maps/HiredMerchant$SoldItem.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "d515db09514150ad6a0ba9f9c4c5869a45061b36", "filename": "build/classes/server/maps/HiredMerchant.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/maps/HiredMerchant.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/server/maps/HiredMerchant.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/server/maps/HiredMerchant.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "bf10881eaf65a622fdc2bf43dcee8cbb36c1ba73", "filename": "build/classes/tools/MaplePacketCreator$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator$1.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator$1.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/tools/MaplePacketCreator$1.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "92a5a204597a3b473f14e58149b69f584f6ce7fa", "filename": "build/classes/tools/MaplePacketCreator$2.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator$2.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator$2.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/tools/MaplePacketCreator$2.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "793fdd2e25b25de3fa2bdf68254cbd564bad9fd5", "filename": "build/classes/tools/MaplePacketCreator.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator.class", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/build/classes/tools/MaplePacketCreator.class", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/build/classes/tools/MaplePacketCreator.class?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "9a07659f5a2b5573ed4769d23e9f648a1bd71441", "filename": "dist/MapleSolaxia.jar", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/dist/MapleSolaxia.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/dist/MapleSolaxia.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/dist/MapleSolaxia.jar?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d"}, {"sha": "44e270d5a3fc6824843bc2ce4fdaf96c7774a6d8", "filename": "docs/feature_list.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/docs/feature_list.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/docs/feature_list.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.txt?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -22,7 +22,7 @@ PQs:\n * CWKPQ as Expedition-based event 100%.\n * Expeditions: Scarga/Horntail/Showa/Zakum/Pinkbean 100%.\n * GuildPQ 100% + Guild queue with multi-lobby systems available.\n-* Brand-new PQ: Boss Rush PQ 100%.\n+* Brand-new PQs: BossRushPQ, CafePQ 100%.\n * Mu Lung Dojo 100%.\n * BalrogPQ semi-functional.\n * Capt. Latanica remade as an event (parties can now fight the boss).\n@@ -41,7 +41,7 @@ Cash & Items:\n * EXP/DROP/Cosmetic Coupons 100%.\n * EXP/DROP coupons now appears as a buff effect when on active time.\n * Great deal of cash items functional.\n-* New scroll: antibanish. Used only in cases where bosses send a player back to town.\n+* New scroll: antibanish. For use only in cases where bosses send a player back to town.\n \n PQ potentials:\n * Lobby system - Multiple PQ instances on same channel."}, {"sha": "fe419a26d9923c50b2541918787f550f763b7893", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -534,4 +534,14 @@ Explorer mount quest como evento, com timeout e expulsa o player se o hog morre.\n \n 14 - 15 Setembro 2017,\n Adicionado AmoriaPQ.\n-Consertado um problema em Inventory Sort que lan\ufffdava exce\ufffd\ufffdo caso tivesse que ordenar vetores vazios.\n\\ No newline at end of file\n+Consertado um problema em Inventory Sort que lan\ufffdava exce\ufffd\ufffdo caso tivesse que ordenar vetores vazios.\n+\n+16 Setembro 2017,\n+Refatorado sistema de schedules para hired merchants. Agora o server passa a instanciar as chamadas \ufffds fun\ufffd\ufffdes que fecham as hired merchants, ao inv\ufffds de instanciar uma task para cada.\n+\n+18 - 21 Setembro 2017,\n+Refatorado sistema de schedules para skill cooldowns e buff expiretimes.\n+Completamente reestruturado sistema de buffs. Nova flag permite perman\ufffdncia de buffs mais fortes mesmo que novos buffs surjam.\n+\n+22 Setembro 2017,\n+Adicionado buffs para GPQ.\n\\ No newline at end of file"}, {"sha": "da05b2f5ec864f1aaea627269ebd9cecfabddba1", "filename": "handbook/Use.txt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/handbook/Use.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/handbook/Use.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/handbook/Use.txt?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -365,6 +365,10 @@\n 2022453 - Fireworks - The fireworks for celebrating MV's defeat. Speed +5, Physical & Magic Attack +5 for 20 min.\n 2022454 - Cygnus's Blessing - Once I completed Cygnus' Book, the spirit's power covered me and blessed me.  It increased my Attack Rate by 10, Physical Defense Rate by 80 and  Speed by 5 for 10 minutes.\n 2022538 - Red Easter Egg - A freshly boiled egg colored in red. Recovers 400 HP and MP.\n+2023000 - Sharenian Grounds : Fortitude - From the ancient remains, an unknown blessing grants you fortitude. Increases Weapon Attack & Weapon Defense.\n+2023001 - Sharenian Grounds : Intellect - From the ancient remains, an unknown blessing grants you intellect. Increases Magic Attack & Magic Defense.\n+2023002 - Sharenian Grounds : Endurance - From the ancient remains, an unknown blessing grants you endurance. Increases Weapon Defense & Magic Defense.\n+2023003 - Sharenian Grounds : Swiftness - From the ancient remains, an unknown blessing grants you swiftness. Increases Accuracy & Avoidability.\n 2030000 - Return Scroll - Nearest Town - Returns you to the nearest town.\n 2030001 - Return Scroll to Lith Harbor - Returns you to Lith Harbor.\n 2030002 - Return Scroll to Ellinia - Returns you to Ellinia."}, {"sha": "157fc3986f3e6773ebd9985f3a3af1b2b49aecb6", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -166,19 +166,23 @@ function setup(level, lobbyid) {\n         return eim;\n }\n \n-/*\n function isTeamAllJobs(eim) {\n         var eventJobs = eim.getEventPlayersJobs();\n         var rangeJobs = parseInt('111110', 2);\n         \n         return ((eventJobs & rangeJobs) == rangeJobs);\n }\n-*/\n \n function afterSetup(eim) {\n         var leader = em.getChannelServer().getPlayerStorage().getCharacterById(eim.getLeaderId());\n-        if(leader != null)\n+        if(leader != null) {\n                 eim.setProperty(\"guild\", \"\" + leader.getGuildId());\n+        }\n+        \n+        if(isTeamAllJobs(eim)) {\n+                var rnd = Math.floor(Math.random() * 4);\n+                eim.applyEventPlayersItemBuff(2023000 + rnd);\n+        }\n }\n \n function respawnStages(eim) {}\n@@ -209,7 +213,12 @@ function scheduledTimeout(eim) {\n         }\n }\n \n-function playerUnregistered(eim, player) {}\n+function playerUnregistered(eim, player) {\n+        player.cancelEffect(2023000);\n+        player.cancelEffect(2023001);\n+        player.cancelEffect(2023002);\n+        player.cancelEffect(2023003);\n+}\n \n function playerExit(eim, player) {\n         eim.unregisterPlayer(player);"}, {"sha": "a2d88c8a31c5f58501ab062323b3f03cf0947afd", "filename": "scripts/npc/1012117.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/npc/1012117.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/npc/1012117.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012117.js?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -26,8 +26,8 @@\n */\n \n var status = 0;\n-var mhair = Array(30040, 30050, 30100, 30130, 30180, 30220, 30260, 30330, 30350, 30580);\n-var fhair = Array(31020, 31160, 31180, 31220, 31290, 31330, 31420, 31440, 31480, 31590);\n+var mhair = Array(30100, 30850, 30890);\n+var fhair = Array(31180, 31420, 31870, 31400, 31880, 31820, 31860, 31420, 31940, 34000, 31890);\n var hairnew = Array();\n \n function start() {"}, {"sha": "7b5376f36dac18a5f425cb8dbc29b8d30aac16a1", "filename": "scripts/npc/commands.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/npc/commands.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/scripts/npc/commands.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/commands.js?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -92,7 +92,7 @@ function writeSolaxiaCommandsLv4() {    //SuperGM\n         addCommand(\"pap\", \"\");\n         addCommand(\"pianus\", \"\");\n         addCommand(\"cake\", \"\");\n-        addCommand(\"playernpc\", \"\");\n+        //addCommand(\"playernpc\", \"\");\n }\n \n function writeSolaxiaCommandsLv3() {    //GM"}, {"sha": "90a1157b744f9eaa50211f0209057787cef8559b", "filename": "sql/db_drops.sql", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -17893,10 +17893,14 @@ USE `maplesolaxia`;\n (9400121, 1332022, 1, 1, 0, 40000), \n (9400121, 1332027, 1, 1, 0, 40000), \n (9400121, 1472033, 1, 1, 0, 40000), \n-(9400590, 1122059, 1, 1, 0, 40000), \n-(9400591, 1122059, 1, 1, 0, 40000), \n-(9400592, 1122059, 1, 1, 0, 40000), \n-(9400593, 1122059, 1, 1, 0, 40000), \n+(9400590, 1122059, 1, 1, 0, 8000), \n+(9400590, 1012076, 1, 1, 0, 20000), \n+(9400591, 1122059, 1, 1, 0, 8000), \n+(9400591, 1412040, 1, 1, 0, 20000), \n+(9400592, 1122059, 1, 1, 0, 8000), \n+(9400592, 1022082, 1, 1, 0, 20000), \n+(9400593, 1122059, 1, 1, 0, 8000), \n+(9400593, 1122015, 1, 1, 0, 20000), \n (8200012, 4000458, 1, 1, 0, 200000), \n (8200012, 4000459, 1, 1, 0, 200000), \n (8200012, 4130012, 1, 1, 0, 3000), \n@@ -21121,6 +21125,7 @@ USE `maplesolaxia`;\n   DELETE FROM `drop_data` WHERE itemid=4000435;\n   DELETE FROM `drop_data` WHERE itemid=4032192;\n   DELETE FROM `drop_data` WHERE itemid=8143000;\n+  DELETE FROM `drop_data` WHERE itemid=2094101;\n \n   # delete all unused content on reactor drop data\n   DELETE FROM `reactordrops` WHERE itemid=1102260;"}, {"sha": "a616b7b8f0d4ab0f9732506169062933f5761e1f", "filename": "sql/db_shopupdate.sql", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/sql/db_shopupdate.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/sql/db_shopupdate.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_shopupdate.sql?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -221,4 +221,5 @@ INSERT INTO `shopitems` ( `shopid`, `itemid`, `price`, `position`) VALUES\n (1337, 2044025, 1, 80),\n (1337, 2043712, 1, 81),\n (1337, 2340000, 1, 82),\n-(1337, 2040807, 1, 83);\n\\ No newline at end of file\n+(1337, 2040807, 1, 83),\n+(1337, 2210032, 1, 84);\n\\ No newline at end of file"}, {"sha": "fefdb8f39dd8623465e376213a4e8a3c7aa1fdda", "filename": "src/client/MapleBuffStat.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleBuffStat.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleBuffStat.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleBuffStat.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -48,7 +48,7 @@\n     AURA(0x40000L),\n     CONFUSE(0x80000L),\n     \n-    // ---- COUPON feature (was unused anyway) ----\n+    // ------ COUPON feature ------\n     \n     COUPON_EXP1(0x100000L),\n     COUPON_EXP2(0x200000L),"}, {"sha": "af63e2890e909e65306c9a66ed8a243b7aa01046", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 966, "deletions": 500, "changes": 1466, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -22,7 +22,6 @@\n package client;\n \n import java.awt.Point;\n-import java.lang.ref.WeakReference;\n import java.sql.Connection;\n import java.sql.PreparedStatement;\n import java.sql.ResultSet;\n@@ -45,7 +44,7 @@\n import java.util.Map;\n import java.util.Map.Entry;\n import java.util.Set;\n-//import java.util.TimeZone;\n+import java.util.Comparator;\n import java.util.concurrent.locks.ReentrantLock;\n import java.util.concurrent.locks.Lock;\n import java.util.concurrent.ScheduledFuture;\n@@ -239,21 +238,27 @@\n     private Map<Integer, Integer> activeCoupons = new LinkedHashMap<>();\n     private Map<Integer, Integer> activeCouponRates = new LinkedHashMap<>();\n     private EnumMap<MapleBuffStat, MapleBuffStatValueHolder> effects = new EnumMap<>(MapleBuffStat.class);\n+    private Map<MapleBuffStat, Byte> buffEffectsCount = new LinkedHashMap<>();\n+    private Map<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> buffEffects = new LinkedHashMap<>();\n+    private Map<Integer, Long> buffExpires = new LinkedHashMap<>();\n     private Map<Integer, MapleKeyBinding> keymap = new LinkedHashMap<>();\n     private Map<Integer, MapleSummon> summons = new LinkedHashMap<>();\n-    private Map<Integer, MapleCoolDownValueHolder> coolDowns = new LinkedHashMap<>(50);\n+    private Map<Integer, MapleCoolDownValueHolder> coolDowns = new LinkedHashMap<>();\n     private EnumMap<MapleDisease, MapleDiseaseValueHolder> diseases = new EnumMap<>(MapleDisease.class);\n     private Map<Integer, MapleDoor> doors = new LinkedHashMap<>();\n     private ScheduledFuture<?> dragonBloodSchedule;\n     private ScheduledFuture<?> hpDecreaseTask;\n     private ScheduledFuture<?> beholderHealingSchedule, beholderBuffSchedule, BerserkSchedule;\n-    private ScheduledFuture<?> expiretask;\n+    private ScheduledFuture<?> skillCooldownTask = null;\n+    private ScheduledFuture<?> buffExpireTask = null;\n+    private ScheduledFuture<?> itemExpireTask = null;\n     private ScheduledFuture<?> recoveryTask = null;\n     private ScheduledFuture<?> extraRecoveryTask = null;\n     private ScheduledFuture<?> chairRecoveryTask = null;\n     private ScheduledFuture<?> pendantOfSpirit = null; //1122017\n     private List<ScheduledFuture<?>> timers = new ArrayList<>();\n     private Lock chrLock = new ReentrantLock();\n+    private Lock effLock = new ReentrantLock();\n     private Lock petLock = new ReentrantLock();\n     private NumberFormat nf = new DecimalFormat(\"#,###,###,###\");\n     private Map<Integer, Set<Integer>> excluded = new LinkedHashMap<>();\n@@ -423,11 +428,18 @@ public void setNpcCooldown(long d) {\n         npcCd = d;\n     }\n \n-    public void addCooldown(int skillId, long startTime, long length, ScheduledFuture<?> timer) {\n-        if (this.coolDowns.containsKey(Integer.valueOf(skillId))) {\n-            this.coolDowns.remove(skillId);\n+    public void addCooldown(int skillId, long startTime, long length) {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            if (this.coolDowns.containsKey(Integer.valueOf(skillId))) {\n+                this.coolDowns.remove(Integer.valueOf(skillId));\n+            }\n+            this.coolDowns.put(Integer.valueOf(skillId), new MapleCoolDownValueHolder(skillId, startTime, length));\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n         }\n-        this.coolDowns.put(Integer.valueOf(skillId), new MapleCoolDownValueHolder(skillId, startTime, length, timer));\n     }\n \n     public void addCrushRing(MapleRing r) {\n@@ -720,36 +732,6 @@ public int calculateMaxBaseDamage(int watk) {\n         return maxbasedamage;\n     }\n \n-    public void cancelAllBuffs(boolean disconnect) {\n-        if (disconnect) {\n-            chrLock.lock();\n-            try {\n-                effects.clear();\n-            } finally {\n-                chrLock.unlock();\n-            }\n-        } else {\n-            List<MapleBuffStatValueHolder> mbsvhList;\n-            \n-            chrLock.lock();\n-            try {\n-                mbsvhList = new ArrayList<>(effects.values());\n-            } finally {\n-                chrLock.unlock();\n-            }\n-            \n-            for (MapleBuffStatValueHolder mbsvh : mbsvhList) {\n-                cancelEffect(mbsvh.effect, false, mbsvh.startTime);\n-            }\n-        }\n-    }\n-\n-    public synchronized void cancelBuffStats(MapleBuffStat stat) {\n-        List<MapleBuffStat> buffStatList = Arrays.asList(stat);\n-        dropBuffStats(deregisterBuffStats(buffStatList));\n-        cancelPlayerBuffs(buffStatList);\n-    }\n-\n     public void setCombo(short count) {\n         if (count < combocounter) {\n             cancelEffectFromBuffStat(MapleBuffStat.ARAN_COMBO);\n@@ -801,18 +783,6 @@ public void newClient(MapleClient c) {\n         this.map = c.getChannelServer().getMapFactory().getMap(getMapId());\n     }\n \n-    public void cancelBuffEffects() {\n-        chrLock.lock();\n-        try {\n-            for (MapleBuffStatValueHolder mbsvh : effects.values()) {\n-                mbsvh.schedule.cancel(false);\n-            }\n-            this.effects.clear();\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-\n     public String getMedalText() {\n         String medal = \"\";\n         final Item medalItem = getInventory(MapleInventoryType.EQUIPPED).getItem((short) -49);\n@@ -822,116 +792,6 @@ public String getMedalText() {\n         return medal;\n     }\n \n-    public static class CancelCooldownAction implements Runnable {\n-\n-        private int skillId;\n-        private WeakReference<MapleCharacter> target;\n-\n-        public CancelCooldownAction(MapleCharacter target, int skillId) {\n-            this.target = new WeakReference<>(target);\n-            this.skillId = skillId;\n-        }\n-\n-        @Override\n-        public void run() {\n-            MapleCharacter realTarget = target.get();\n-            if (realTarget != null) {\n-                realTarget.removeCooldown(skillId);\n-                realTarget.client.announce(MaplePacketCreator.skillCooldown(skillId, 0));\n-            }\n-        }\n-    }\n-\n-    public void cancelEffect(int itemId) {\n-        cancelEffect(MapleItemInformationProvider.getInstance().getItemEffect(itemId), false, -1);\n-    }\n-\n-    public synchronized void cancelEffect(MapleStatEffect effect, boolean overwrite, long startTime) {\n-        cancelEffect(effect, overwrite, startTime, true);\n-    }\n-    \n-    private void cancelEffect(MapleStatEffect effect, boolean overwrite, long startTime, boolean firstCancel) {\n-        dropBuffStats(cancelEffectInternal(effect, overwrite, startTime));\n-    }\n-    \n-    private List<MapleBuffStatValueHolder> cancelEffectInternal(MapleStatEffect effect, boolean overwrite, long startTime) {\n-        List<MapleBuffStat> buffstats;\n-        if (!overwrite) {\n-            buffstats = getBuffStats(effect, startTime);\n-        } else {\n-            List<Pair<MapleBuffStat, Integer>> statups = effect.getStatups();\n-            buffstats = new ArrayList<>(statups.size());\n-            for (Pair<MapleBuffStat, Integer> statup : statups) {\n-                buffstats.add(statup.getLeft());\n-            }\n-        }\n-        if (effect.isMagicDoor()) {\n-            MapleDoor destroyDoor;\n-                    \n-            chrLock.lock();\n-            try {\n-                destroyDoor = doors.remove(this.getId());\n-            } finally {\n-                chrLock.unlock();\n-            }\n-            \n-            if (destroyDoor != null) {\n-                destroyDoor.getTarget().removeMapObject(destroyDoor.getAreaDoor());\n-                destroyDoor.getTown().removeMapObject(destroyDoor.getTownDoor());\n-                \n-                for (MapleCharacter chr : destroyDoor.getTarget().getCharacters()) {\n-                    destroyDoor.getAreaDoor().sendDestroyData(chr.getClient());\n-                }\n-                for (MapleCharacter chr : destroyDoor.getTown().getCharacters()) {\n-                    destroyDoor.getTownDoor().sendDestroyData(chr.getClient());\n-                }\n-\n-                if (party != null) {\n-                    for (MaplePartyCharacter partyMembers : getParty().getMembers()) {\n-                        partyMembers.getPlayer().removeDoor(this.getId());\n-                        partyMembers.removeDoor(this.getId());\n-                    }\n-                    silentPartyUpdate();\n-                }\n-            }\n-        }\n-        \n-        List<MapleBuffStatValueHolder> toCancel = deregisterBuffStats(buffstats);\n-        if (effect.getSourceId() == Spearman.HYPER_BODY || effect.getSourceId() == GM.HYPER_BODY || effect.getSourceId() == SuperGM.HYPER_BODY) {\n-            List<Pair<MapleStat, Integer>> statup = new ArrayList<>(4);\n-            statup.add(new Pair<>(MapleStat.HP, Math.min(hp, maxhp)));\n-            statup.add(new Pair<>(MapleStat.MP, Math.min(mp, maxmp)));\n-            statup.add(new Pair<>(MapleStat.MAXHP, maxhp));\n-            statup.add(new Pair<>(MapleStat.MAXMP, maxmp));\n-            client.announce(MaplePacketCreator.updatePlayerStats(statup, this));\n-        }\n-        if (effect.isMonsterRiding()) {\n-            if (effect.getSourceId() != Corsair.BATTLE_SHIP) {\n-                this.getClient().getWorldServer().unregisterMountHunger(this);\n-                this.getMount().setActive(false);\n-            }\n-        }\n-        if (!overwrite) {\n-            cancelPlayerBuffs(buffstats);\n-        }\n-        \n-        return toCancel;\n-    }\n-\n-    public void cancelEffectFromBuffStat(MapleBuffStat stat) {\n-        MapleBuffStatValueHolder effect;\n-        \n-        chrLock.lock();\n-        try {\n-            effect = effects.get(stat);\n-        } finally {\n-            chrLock.unlock();\n-        }\n-        if (effect != null) {\n-            cancelEffect(effect.effect, false, -1);\n-        }\n-    }\n-\n     public void Hide(boolean hide, boolean login) {\n         if (isGM() && hide != this.hidden) {\n             if (!hide) {\n@@ -965,7 +825,7 @@ public void Hide(boolean hide, boolean login) {\n             announce(MaplePacketCreator.enableActions());\n         }\n     }\n-\n+    \n     public void Hide(boolean hide) {\n         Hide(hide, false);\n     }\n@@ -975,18 +835,11 @@ public void toggleHide(boolean login) {\n     }\n \n     public void cancelMagicDoor() {\n-        List<MapleBuffStatValueHolder> mbsvhList;\n-                \n-        chrLock.lock();\n-        try {\n-            mbsvhList = new ArrayList<>(effects.values());\n-        } finally {\n-            chrLock.unlock();\n-        }\n-        \n+        List<MapleBuffStatValueHolder> mbsvhList = getAllStatups();\n         for (MapleBuffStatValueHolder mbsvh : mbsvhList) {\n             if (mbsvh.effect.isMagicDoor()) {\n                 cancelEffect(mbsvh.effect, false, mbsvh.startTime);\n+                break;\n             }\n         }\n     }\n@@ -1321,6 +1174,7 @@ public void changeMap(final MapleMap target, final Point pos) {\n     }\n     \n     private boolean buffMapProtection() {\n+        effLock.lock();\n         chrLock.lock();\n         try {\n             MapleMap thisMap = client.getChannelServer().getMapFactory().getMap(mapid);\n@@ -1336,6 +1190,7 @@ private boolean buffMapProtection() {\n             }    \n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n         \n         for(Item it: this.getInventory(MapleInventoryType.EQUIPPED).list()) {\n@@ -1664,15 +1519,15 @@ public void decreaseBattleshipHp(int decrease) {\n             Skill battleship = SkillFactory.getSkill(Corsair.BATTLE_SHIP);\n             int cooldown = battleship.getEffect(getSkillLevel(battleship)).getCooldown();\n             announce(MaplePacketCreator.skillCooldown(Corsair.BATTLE_SHIP, cooldown));\n-            addCooldown(Corsair.BATTLE_SHIP, System.currentTimeMillis(), cooldown, TimerManager.getInstance().schedule(new CancelCooldownAction(this, Corsair.BATTLE_SHIP), cooldown * 1000));\n+            addCooldown(Corsair.BATTLE_SHIP, System.currentTimeMillis(), (long)(cooldown * 1000));\n             removeCooldown(5221999);\n             cancelEffectFromBuffStat(MapleBuffStat.MONSTER_RIDING);\n         } else {\n             announce(MaplePacketCreator.skillCooldown(5221999, battleshipHp / 10));   //:D\n-            addCooldown(5221999, 0, battleshipHp, null);\n+            addCooldown(5221999, 0, Long.MAX_VALUE);\n         }\n     }\n-\n+    \n     public void decreaseReports() {\n         this.possibleReports--;\n     }\n@@ -1918,86 +1773,6 @@ public static void deleteWhereCharacterId(Connection con, String sql, int cid) t\n         }\n     }\n \n-    private void dropBuffStats(List<MapleBuffStatValueHolder> effectsToCancel) {\n-        for (MapleBuffStatValueHolder cancelEffectCancelTasks : effectsToCancel) {\n-            if (cancelEffectCancelTasks.schedule != null) {\n-                cancelEffectCancelTasks.schedule.cancel(false);\n-                this.cancelEffect(cancelEffectCancelTasks.effect, false, -1, false);\n-            }\n-        }\n-    }\n-    \n-    private List<MapleBuffStatValueHolder> deregisterBuffStats(List<MapleBuffStat> stats) {\n-        chrLock.lock();\n-        try {\n-            List<MapleBuffStatValueHolder> effectsToCancel = new ArrayList<>(stats.size());\n-            for (MapleBuffStat stat : stats) {\n-                MapleBuffStatValueHolder mbsvh = effects.get(stat);\n-                if (mbsvh != null) {\n-                    effects.remove(stat);\n-                    boolean addMbsvh = true;\n-                    for (MapleBuffStatValueHolder contained : effectsToCancel) {\n-                        if (mbsvh.startTime == contained.startTime && contained.effect == mbsvh.effect) {\n-                            addMbsvh = false;\n-                        }\n-                    }\n-                    if (addMbsvh) {\n-                        effectsToCancel.add(mbsvh);\n-                    }\n-                    if (stat == MapleBuffStat.RECOVERY) {\n-                        if (recoveryTask != null) {\n-                            recoveryTask.cancel(false);\n-                            recoveryTask = null;\n-                        }\n-                    } else if (stat == MapleBuffStat.SUMMON || stat == MapleBuffStat.PUPPET) {\n-                        int summonId = mbsvh.effect.getSourceId();\n-\n-                        MapleSummon summon = summons.get(summonId);\n-                        if (summon != null) {\n-                            getMap().broadcastMessage(MaplePacketCreator.removeSummon(summon, true), summon.getPosition());\n-                            getMap().removeMapObject(summon);\n-                            removeVisibleMapObject(summon);\n-                            summons.remove(summonId);\n-\n-                            if (summon.getSkill() == DarkKnight.BEHOLDER) {\n-                                if (beholderHealingSchedule != null) {\n-                                    beholderHealingSchedule.cancel(false);\n-                                    beholderHealingSchedule = null;\n-                                }\n-                                if (beholderBuffSchedule != null) {\n-                                    beholderBuffSchedule.cancel(false);\n-                                    beholderBuffSchedule = null;\n-                                }\n-                            }\n-                        }\n-                    } else if (stat == MapleBuffStat.DRAGONBLOOD) {\n-                        dragonBloodSchedule.cancel(false);\n-                        dragonBloodSchedule = null;\n-                    } else if (stat == MapleBuffStat.HPREC || stat == MapleBuffStat.MPREC) {\n-                        if(stat == MapleBuffStat.HPREC) {\n-                            extraHpRec = 0;\n-                        } else {\n-                            extraMpRec = 0;\n-                        }\n-                        \n-                        if (extraRecoveryTask != null) {\n-                            extraRecoveryTask.cancel(false);\n-                            extraRecoveryTask = null;\n-                        }\n-                        \n-                        if(extraHpRec != 0 || extraMpRec != 0) {\n-                            startExtraTaskInternal(extraHpRec, extraMpRec, extraRecInterval);\n-                        }\n-                    }\n-                }\n-            }\n-\n-            return effectsToCancel;\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-    \n     public void stopChairTask() {\n         chrLock.lock();\n         try {\n@@ -2103,15 +1878,7 @@ public void disbandGuild() {\n     }\n \n     public void dispel() {\n-        List<MapleBuffStatValueHolder> mbsvhList;\n-        \n-        chrLock.lock();\n-        try {\n-            mbsvhList = new ArrayList<>(effects.values());\n-        } finally {\n-            chrLock.unlock();\n-        }\n-        \n+        List<MapleBuffStatValueHolder> mbsvhList = getAllStatups();\n         for (MapleBuffStatValueHolder mbsvh : mbsvhList) {\n             if (mbsvh.effect.isSkill()) {\n                 cancelEffect(mbsvh.effect, false, mbsvh.startTime);\n@@ -2199,14 +1966,7 @@ public void cancelAllDebuffs() {\n     }\n     \n     public void dispelSkill(int skillid) {\n-        LinkedList<MapleBuffStatValueHolder> allBuffs;\n-        chrLock.lock();\n-        try {\n-            allBuffs = new LinkedList<>(effects.values());\n-        } finally {\n-            chrLock.unlock();\n-        }\n-        \n+        List<MapleBuffStatValueHolder> allBuffs = getAllStatups();\n         for (MapleBuffStatValueHolder mbsvh : allBuffs) {\n             if (skillid == 0) {\n                 if (mbsvh.effect.isSkill() && (mbsvh.effect.getSourceId() % 10000000 == 1004 || dispelSkills(mbsvh.effect.getSourceId()))) {\n@@ -2313,17 +2073,88 @@ public void equipChanged() {\n             Server.getInstance().getWorld(world).updateMessenger(getMessenger(), getName(), getWorld(), client.getChannel());\n         }\n     }\n+    \n+    public void cancelBuffExpireTask() {\n+        if (buffExpireTask != null) {\n+            buffExpireTask.cancel(false);\n+            buffExpireTask = null;\n+        }\n+    }\n+\n+    public void buffExpireTask() {\n+        if (buffExpireTask == null) {\n+            buffExpireTask = TimerManager.getInstance().register(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Set<Entry<Integer, Long>> es;\n+                    \n+                    effLock.lock();\n+                    chrLock.lock();\n+                    try {\n+                        es = new LinkedHashSet<>(buffExpires.entrySet());\n+                    } finally {\n+                        chrLock.unlock();\n+                        effLock.unlock();\n+                    }\n+                    \n+                    long curTime = System.currentTimeMillis();\n+                    for(Entry<Integer, Long> bel : es) {\n+                        if(curTime >= bel.getValue()) {\n+                            MapleBuffStatValueHolder mbsvh = buffEffects.get(bel.getKey()).entrySet().iterator().next().getValue(); // rofl\n+                            cancelEffect(mbsvh.effect, false, mbsvh.startTime);\n+                        }\n+                    }\n+                }\n+            }, 1500);\n+        }\n+    }\n+    \n+    public void cancelSkillCooldownTask() {\n+        if (skillCooldownTask != null) {\n+            skillCooldownTask.cancel(false);\n+            skillCooldownTask = null;\n+        }\n+    }\n \n+    public void skillCooldownTask() {\n+        if (skillCooldownTask == null) {\n+            skillCooldownTask = TimerManager.getInstance().register(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Set<Entry<Integer, MapleCoolDownValueHolder>> es;\n+                    \n+                    effLock.lock();\n+                    chrLock.lock();\n+                    try {\n+                        es = new LinkedHashSet<>(coolDowns.entrySet());\n+                    } finally {\n+                        chrLock.unlock();\n+                        effLock.unlock();\n+                    }\n+                    \n+                    long curTime = System.currentTimeMillis();\n+                    for(Entry<Integer, MapleCoolDownValueHolder> bel : es) {\n+                        MapleCoolDownValueHolder mcdvh = bel.getValue();\n+                        if(curTime >= mcdvh.startTime + mcdvh.length) {\n+                            removeCooldown(mcdvh.skillId);\n+                            client.announce(MaplePacketCreator.skillCooldown(mcdvh.skillId, 0));\n+                        }\n+                    }\n+                }\n+            }, 1500);\n+        }\n+    }\n+    \n     public void cancelExpirationTask() {\n-        if (expiretask != null) {\n-            expiretask.cancel(false);\n-            expiretask = null;\n+        if (itemExpireTask != null) {\n+            itemExpireTask.cancel(false);\n+            itemExpireTask = null;\n         }\n     }\n \n     public void expirationTask() {\n-        if (expiretask == null) {\n-            expiretask = TimerManager.getInstance().register(new Runnable() {\n+        if (itemExpireTask == null) {\n+            itemExpireTask = TimerManager.getInstance().register(new Runnable() {\n                 @Override\n                 public void run() {\n                     boolean deletedCoupon = false;\n@@ -2498,39 +2329,21 @@ public int getAccountID() {\n         return accountid;\n     }\n \n-    public List<PlayerBuffValueHolder> getAllBuffs() {\n+    public List<PlayerCoolDownValueHolder> getAllCooldowns() {\n+        List<PlayerCoolDownValueHolder> ret = new ArrayList<>();\n+        \n+        effLock.lock();\n         chrLock.lock();\n         try {\n-            List<PlayerBuffValueHolder> ret = new ArrayList<>();\n-            for (MapleBuffStatValueHolder mbsvh : effects.values()) {\n-                ret.add(new PlayerBuffValueHolder(mbsvh.startTime, mbsvh.effect));\n+            for (MapleCoolDownValueHolder mcdvh : coolDowns.values()) {\n+                ret.add(new PlayerCoolDownValueHolder(mcdvh.skillId, mcdvh.startTime, mcdvh.length));\n             }\n-            return ret;\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n-    }\n-\n-    public List<Pair<MapleBuffStat, Integer>> getAllStatups() {\n-        chrLock.lock();\n-        try {\n-            List<Pair<MapleBuffStat, Integer>> ret = new ArrayList<>();\n-            for (MapleBuffStat mbs : effects.keySet()) {\n-                MapleBuffStatValueHolder mbsvh = effects.get(mbs);\n-                ret.add(new Pair<>(mbs, mbsvh.value));\n-            }\n-            return ret;\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-\n-    public List<PlayerCoolDownValueHolder> getAllCooldowns() {\n-        List<PlayerCoolDownValueHolder> ret = new ArrayList<>();\n-        for (MapleCoolDownValueHolder mcdvh : coolDowns.values()) {\n-            ret.add(new PlayerCoolDownValueHolder(mcdvh.skillId, mcdvh.startTime, mcdvh.length));\n-        }\n-        return ret;\n+        \n+        return ret;\n     }\n \n     public int getAllianceRank() {\n@@ -2572,88 +2385,821 @@ public BuddyList getBuddylist() {\n                         return null;\n                     }\n \n-                    for (int i = 1; i <= rs.getMetaData().getColumnCount(); i++) {\n-                        character.put(rs.getMetaData().getColumnLabel(i), rs.getString(i));\n+                    for (int i = 1; i <= rs.getMetaData().getColumnCount(); i++) {\n+                        character.put(rs.getMetaData().getColumnLabel(i), rs.getString(i));\n+                    }\n+                }\n+            } finally {\n+                con.close();\n+            }\n+        } catch (SQLException sqle) {\n+            sqle.printStackTrace();\n+        }\n+\n+        return character;\n+    }\n+\n+    public Long getBuffedStarttime(MapleBuffStat effect) {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            MapleBuffStatValueHolder mbsvh = effects.get(effect);\n+            if (mbsvh == null) {\n+                return null;\n+            }\n+            return Long.valueOf(mbsvh.startTime);\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public Integer getBuffedValue(MapleBuffStat effect) {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            MapleBuffStatValueHolder mbsvh = effects.get(effect);\n+            if (mbsvh == null) {\n+                return null;\n+            }\n+            return Integer.valueOf(mbsvh.value);\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public int getBuffSource(MapleBuffStat stat) {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            MapleBuffStatValueHolder mbsvh = effects.get(stat);\n+            if (mbsvh == null) {\n+                return -1;\n+            }\n+            return mbsvh.effect.getSourceId();\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public MapleStatEffect getBuffEffect(MapleBuffStat stat) {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            MapleBuffStatValueHolder mbsvh = effects.get(stat);\n+            if (mbsvh == null) {\n+                return null;\n+            } else {\n+                return mbsvh.effect;\n+            }\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public Set<Integer> getAvailableBuffs() {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            return buffEffects.keySet();\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private List<MapleBuffStatValueHolder> getAllStatups() {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            List<MapleBuffStatValueHolder> ret = new ArrayList<>();\n+            for(Map<MapleBuffStat, MapleBuffStatValueHolder> bel : buffEffects.values()) {\n+                for(MapleBuffStatValueHolder mbsvh : bel.values()) {\n+                    ret.add(mbsvh);\n+                }\n+            }\n+            return ret;\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public List<PlayerBuffValueHolder> getAllBuffs() {  // buff values will be stored in an arbitrary order\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            Map<Integer, PlayerBuffValueHolder> ret = new LinkedHashMap<>();\n+            for(Map<MapleBuffStat, MapleBuffStatValueHolder> bel : buffEffects.values()) {\n+                for(MapleBuffStatValueHolder mbsvh : bel.values()) {\n+                    int srcid = mbsvh.effect.getBuffSourceId();\n+                    if(!ret.containsKey(srcid)) {\n+                        ret.put(srcid, new PlayerBuffValueHolder(mbsvh.startTime, mbsvh.effect));\n+                    }\n+                }\n+            }\n+            return new ArrayList<>(ret.values());\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+\n+    public List<Pair<MapleBuffStat, Integer>> getAllActiveStatups() {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            List<Pair<MapleBuffStat, Integer>> ret = new ArrayList<>();\n+            for (MapleBuffStat mbs : effects.keySet()) {\n+                MapleBuffStatValueHolder mbsvh = effects.get(mbs);\n+                ret.add(new Pair<>(mbs, mbsvh.value));\n+            }\n+            return ret;\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private List<Pair<MapleBuffStat, Integer>> getActiveStatupsFromSourceid(int sourceid) { // already under effLock & chrLock\n+        List<Pair<MapleBuffStat, Integer>> ret = new ArrayList<>();\n+        \n+        for(Entry<MapleBuffStat, MapleBuffStatValueHolder> bel : buffEffects.get(sourceid).entrySet()) {\n+            Integer bsrcid = bel.getValue().effect.getBuffSourceId();\n+            MapleBuffStat mbs = bel.getKey();\n+            \n+            MapleBuffStatValueHolder mbsvh = effects.get(bel.getKey());\n+            if(mbsvh != null && mbsvh.effect.getBuffSourceId() == bsrcid) {\n+                ret.add(new Pair<>(mbs, mbsvh.value));\n+            } else {\n+                ret.add(new Pair<>(mbs, 0));\n+            }\n+        }\n+        \n+        Collections.sort(ret, new Comparator<Pair<MapleBuffStat, Integer>>() {\n+            @Override\n+            public int compare(Pair<MapleBuffStat, Integer> p1, Pair<MapleBuffStat, Integer> p2) {\n+                return p1.getLeft().compareTo(p2.getLeft());\n+            }\n+        });\n+        \n+        return ret;\n+    }\n+    \n+    private void addItemEffectHolder(Integer sourceid, long expirationtime, Map<MapleBuffStat, MapleBuffStatValueHolder> statups) {\n+        buffEffects.put(sourceid, statups);\n+        buffExpires.put(sourceid, expirationtime);\n+    }\n+    \n+    private void removeEffectFromItemEffectHolder(Integer sourceid, MapleBuffStat buffStat) {\n+        Map<MapleBuffStat, MapleBuffStatValueHolder> lbe = buffEffects.get(sourceid);\n+        \n+        if(lbe.remove(buffStat) != null) {        \n+            buffEffectsCount.put(buffStat, (byte)(buffEffectsCount.get(buffStat) - 1));\n+            \n+            if(lbe.isEmpty()) {\n+                buffEffects.remove(sourceid);\n+                buffExpires.remove(sourceid);\n+            }\n+        }\n+    }\n+    \n+    private void removeItemEffectHolder(Integer sourceid) {\n+        Map<MapleBuffStat, MapleBuffStatValueHolder> be = buffEffects.remove(sourceid);\n+        if(be != null) {\n+            for(Entry<MapleBuffStat, MapleBuffStatValueHolder> bei : be.entrySet()) {\n+                buffEffectsCount.put(bei.getKey(), (byte)(buffEffectsCount.get(bei.getKey()) - 1));\n+            }\n+        }\n+        \n+        buffExpires.remove(sourceid);\n+    }\n+    \n+    private void dropWorstEffectFromItemEffectHolder(MapleBuffStat mbs) {\n+        Integer min = Integer.MAX_VALUE;\n+        Integer srcid = -1;\n+        for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl: buffEffects.entrySet()) {\n+            MapleBuffStatValueHolder mbsvh = bpl.getValue().get(mbs);\n+            if(mbsvh != null) {\n+                if(mbsvh.value < min) {\n+                    min = mbsvh.value;\n+                    srcid = bpl.getKey();\n+                }\n+            }\n+        }\n+        \n+        removeEffectFromItemEffectHolder(srcid, mbs);\n+    }\n+    \n+    private MapleBuffStatValueHolder fetchBestEffectFromItemEffectHolder(MapleBuffStat mbs) {\n+        Integer max = Integer.MIN_VALUE;\n+        MapleBuffStatValueHolder mbsvh = null;\n+        for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl: buffEffects.entrySet()) {\n+            MapleBuffStatValueHolder mbsvhi = bpl.getValue().get(mbs);\n+            if(mbsvhi != null) {\n+                if(mbsvhi.value > max) {\n+                    max = mbsvhi.value;\n+                    mbsvh = mbsvhi;\n+                }    \n+            }\n+        }\n+        \n+        if(mbsvh != null) effects.put(mbs, mbsvh);\n+        return mbsvh;\n+    }\n+    \n+    private void extractBuffValue(int sourceid, MapleBuffStat stat) {\n+        chrLock.lock();\n+        try {\n+            if(buffEffects.get(sourceid).remove(stat) != null) {\n+                buffEffectsCount.put(stat, (byte)(buffEffectsCount.get(stat) - 1));\n+            }\n+        } finally {\n+            chrLock.unlock();\n+        }\n+    }\n+    \n+    private void debugListAllBuffs() {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            System.out.println(\"-------------------\");\n+            System.out.println(\"CACHED BUFFS: \");\n+            for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl : buffEffects.entrySet()) {\n+                System.out.print(bpl.getKey() + \": \");\n+                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> pble : bpl.getValue().entrySet()) {\n+                    System.out.print(pble.getKey().name() + pble.getValue().value + \", \");\n+                }\n+                System.out.println();\n+            }\n+            System.out.println(\"-------------------\");\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private void debugListAllBuffsCount() {\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            for(Entry<MapleBuffStat, Byte> mbsl : buffEffectsCount.entrySet()) {\n+                System.out.println(mbsl.getKey().name() + \" -> \" + mbsl.getValue());\n+            }\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    public void cancelAllBuffs(boolean disconnect) {\n+        if (disconnect) {\n+            effLock.lock();\n+            chrLock.lock();\n+            try {\n+                effects.clear();\n+                \n+                for(Integer srcid : new ArrayList<>(buffEffects.keySet())) {\n+                    removeItemEffectHolder(srcid);\n+                }\n+            } finally {\n+                chrLock.unlock();\n+                effLock.unlock();\n+            }\n+        } else {\n+            List<MapleBuffStatValueHolder> mbsvhList;\n+            \n+            effLock.lock();\n+            chrLock.lock();\n+            try {\n+                List<Pair<Integer, MapleBuffStat>> mbls = new LinkedList<>();\n+                \n+                for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bpl : buffEffects.entrySet()) {\n+                    for(Entry<MapleBuffStat, MapleBuffStatValueHolder> mbse : bpl.getValue().entrySet()) {\n+                        if(effects.get(mbse.getKey()) != mbse.getValue()) {\n+                            mbls.add(new Pair<>(bpl.getKey(), mbse.getKey()));\n+                        }\n+                    }\n+                }\n+                \n+                for(Pair<Integer, MapleBuffStat> pmbs : mbls) {\n+                    removeEffectFromItemEffectHolder(pmbs.getLeft(), pmbs.getRight());\n+                }\n+                \n+                mbsvhList = new ArrayList<>(effects.values());\n+            } finally {\n+                chrLock.unlock();\n+                effLock.unlock();\n+            }\n+            \n+            for (MapleBuffStatValueHolder mbsvh : mbsvhList) {\n+                cancelEffect(mbsvh.effect, false, mbsvh.startTime);\n+            }\n+        }\n+    }\n+\n+    private void dropBuffStats(List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> effectsToCancel) {\n+        for (Pair<MapleBuffStat, MapleBuffStatValueHolder> cancelEffectCancelTasks : effectsToCancel) {\n+            //boolean nestedCancel = false;\n+            \n+            chrLock.lock();\n+            try {\n+                /*\n+                if (buffExpires.get(cancelEffectCancelTasks.getRight().effect.getBuffSourceId()) != null) {\n+                    nestedCancel = true;\n+                }*/\n+            \n+                if(cancelEffectCancelTasks.getRight().bestApplied) {\n+                    fetchBestEffectFromItemEffectHolder(cancelEffectCancelTasks.getLeft());\n+                }\n+            } finally {\n+                chrLock.unlock();\n+            }\n+\n+            recalcLocalStats();\n+            \n+            /*\n+            if (nestedCancel) {\n+                this.cancelEffect(cancelEffectCancelTasks.getRight().effect, false, -1, false);\n+            }*/\n+        }\n+    }\n+    \n+    private List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> deregisterBuffStats(Map<MapleBuffStat, MapleBuffStatValueHolder> stats) {\n+        chrLock.lock();\n+        try {\n+            List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> effectsToCancel = new ArrayList<>(stats.size());\n+            for (Entry<MapleBuffStat, MapleBuffStatValueHolder> stat : stats.entrySet()) {\n+                int sourceid = stat.getValue().effect.getBuffSourceId();\n+                \n+                if(buffEffects.get(sourceid) == null) {\n+                    buffExpires.remove(sourceid);\n+                }\n+                \n+                MapleBuffStat mbs = stat.getKey();\n+                effectsToCancel.add(new Pair<>(mbs, stat.getValue()));\n+                \n+                MapleBuffStatValueHolder mbsvh = effects.get(mbs);\n+                if (mbsvh != null && mbsvh.effect.getBuffSourceId() == sourceid) {\n+                    mbsvh.bestApplied = true;\n+                    effects.remove(mbs);\n+                    \n+                    if (mbs == MapleBuffStat.RECOVERY) {\n+                        if (recoveryTask != null) {\n+                            recoveryTask.cancel(false);\n+                            recoveryTask = null;\n+                        }\n+                    } else if (mbs == MapleBuffStat.SUMMON || mbs == MapleBuffStat.PUPPET) {\n+                        int summonId = mbsvh.effect.getSourceId();\n+\n+                        MapleSummon summon = summons.get(summonId);\n+                        if (summon != null) {\n+                            getMap().broadcastMessage(MaplePacketCreator.removeSummon(summon, true), summon.getPosition());\n+                            getMap().removeMapObject(summon);\n+                            removeVisibleMapObject(summon);\n+                            summons.remove(summonId);\n+\n+                            if (summon.getSkill() == DarkKnight.BEHOLDER) {\n+                                if (beholderHealingSchedule != null) {\n+                                    beholderHealingSchedule.cancel(false);\n+                                    beholderHealingSchedule = null;\n+                                }\n+                                if (beholderBuffSchedule != null) {\n+                                    beholderBuffSchedule.cancel(false);\n+                                    beholderBuffSchedule = null;\n+                                }\n+                            }\n+                        }\n+                    } else if (mbs == MapleBuffStat.DRAGONBLOOD) {\n+                        dragonBloodSchedule.cancel(false);\n+                        dragonBloodSchedule = null;\n+                    } else if (mbs == MapleBuffStat.HPREC || mbs == MapleBuffStat.MPREC) {\n+                        if(mbs == MapleBuffStat.HPREC) {\n+                            extraHpRec = 0;\n+                        } else {\n+                            extraMpRec = 0;\n+                        }\n+                        \n+                        if (extraRecoveryTask != null) {\n+                            extraRecoveryTask.cancel(false);\n+                            extraRecoveryTask = null;\n+                        }\n+                        \n+                        if(extraHpRec != 0 || extraMpRec != 0) {\n+                            startExtraTaskInternal(extraHpRec, extraMpRec, extraRecInterval);\n+                        }\n+                    }\n+                }\n+            }\n+\n+            return effectsToCancel;\n+        } finally {\n+            chrLock.unlock();\n+        }\n+    }\n+    \n+    public void cancelEffect(int itemId) {\n+        cancelEffect(MapleItemInformationProvider.getInstance().getItemEffect(itemId), false, -1);\n+    }\n+\n+    public void cancelEffect(MapleStatEffect effect, boolean overwrite, long startTime) {\n+        effLock.lock();\n+        try {\n+            cancelEffect(effect, overwrite, startTime, true);\n+        } finally {\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private void updateEffects(Set<MapleBuffStat> removedStats) {\n+        chrLock.lock();\n+        try {\n+            Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects = new LinkedHashMap<>();\n+            \n+            for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bel : buffEffects.entrySet()) {\n+                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> belv : bel.getValue().entrySet()) {\n+                    if(removedStats.contains(belv.getKey())) {\n+                        retrievedEffects.put(bel.getKey(), new Pair<>(belv.getValue().effect, belv.getValue().startTime));\n+                    }\n+                }\n+            }\n+            \n+            for(Entry<Integer, Pair<MapleStatEffect, Long>> lmse: retrievedEffects.entrySet()) {\n+                lmse.getValue().getLeft().updateBuffEffect(this, getActiveStatupsFromSourceid(lmse.getKey()), lmse.getValue().getRight());\n+            }\n+        } finally {\n+            chrLock.unlock();\n+        }\n+    }\n+    \n+    private void cancelEffect(MapleStatEffect effect, boolean overwrite, long startTime, boolean firstCancel) {\n+        Set<MapleBuffStat> removedStats = new LinkedHashSet<>();\n+        dropBuffStats(cancelEffectInternal(effect, overwrite, startTime, removedStats));\n+        updateEffects(removedStats);\n+    }\n+    \n+    private List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> cancelEffectInternal(MapleStatEffect effect, boolean overwrite, long startTime, Set<MapleBuffStat> removedStats) {\n+        Map<MapleBuffStat, MapleBuffStatValueHolder> buffstats;\n+        if (!overwrite) {   // is removing the source effect, meaning every effect from this srcid is being purged\n+            buffstats = extractCurrentBuffStats(effect);\n+        } else {            // is dropping ALL current statups that uses same stats as the given effect\n+            buffstats = extractLeastRelevantStatEffectsIfFull(effect);\n+        }\n+        \n+        if (effect.isMagicDoor()) {\n+            MapleDoor destroyDoor;\n+                    \n+            chrLock.lock();\n+            try {\n+                destroyDoor = doors.remove(this.getId());\n+            } finally {\n+                chrLock.unlock();\n+            }\n+            \n+            if (destroyDoor != null) {\n+                destroyDoor.getTarget().removeMapObject(destroyDoor.getAreaDoor());\n+                destroyDoor.getTown().removeMapObject(destroyDoor.getTownDoor());\n+                \n+                for (MapleCharacter chr : destroyDoor.getTarget().getCharacters()) {\n+                    destroyDoor.getAreaDoor().sendDestroyData(chr.getClient());\n+                }\n+                for (MapleCharacter chr : destroyDoor.getTown().getCharacters()) {\n+                    destroyDoor.getTownDoor().sendDestroyData(chr.getClient());\n+                }\n+\n+                if (party != null) {\n+                    for (MaplePartyCharacter partyMembers : getParty().getMembers()) {\n+                        partyMembers.getPlayer().removeDoor(this.getId());\n+                        partyMembers.removeDoor(this.getId());\n+                    }\n+                    silentPartyUpdate();\n+                }\n+            }\n+        }\n+        \n+        List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> toCancel = deregisterBuffStats(buffstats);\n+        if (effect.getSourceId() == Spearman.HYPER_BODY || effect.getSourceId() == GM.HYPER_BODY || effect.getSourceId() == SuperGM.HYPER_BODY) {\n+            List<Pair<MapleStat, Integer>> statup = new ArrayList<>(4);\n+            statup.add(new Pair<>(MapleStat.HP, Math.min(hp, maxhp)));\n+            statup.add(new Pair<>(MapleStat.MP, Math.min(mp, maxmp)));\n+            statup.add(new Pair<>(MapleStat.MAXHP, maxhp));\n+            statup.add(new Pair<>(MapleStat.MAXMP, maxmp));\n+            client.announce(MaplePacketCreator.updatePlayerStats(statup, this));\n+        }\n+        if (effect.isMonsterRiding()) {\n+            if (effect.getSourceId() != Corsair.BATTLE_SHIP) {\n+                this.getClient().getWorldServer().unregisterMountHunger(this);\n+                this.getMount().setActive(false);\n+            }\n+        }\n+        \n+        if (!overwrite) {\n+            List<MapleBuffStat> cancelStats = new LinkedList<>();\n+            \n+            chrLock.lock();\n+            try {\n+                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> mbsl : buffstats.entrySet()) {\n+                    cancelStats.add(mbsl.getKey());\n+                }\n+            } finally {\n+                chrLock.unlock();\n+            }\n+            \n+            for(MapleBuffStat mbs : cancelStats) removedStats.add(mbs);\n+            cancelPlayerBuffs(cancelStats);\n+        }\n+        \n+        return toCancel;\n+    }\n+\n+    public void cancelEffectFromBuffStat(MapleBuffStat stat) {\n+        MapleBuffStatValueHolder effect;\n+        \n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            effect = effects.get(stat);\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+        if (effect != null) {\n+            cancelEffect(effect.effect, false, -1);\n+        }\n+    }\n+    \n+    public void cancelBuffStats(MapleBuffStat stat) {\n+        effLock.lock();\n+        try {\n+            List<Pair<Integer, MapleBuffStatValueHolder>> cancelList = new LinkedList<>();\n+            \n+            chrLock.lock();\n+            try {\n+                for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> bel : this.buffEffects.entrySet()) {\n+                    MapleBuffStatValueHolder beli = bel.getValue().get(stat);\n+                    if(beli != null) {\n+                        cancelList.add(new Pair<>(bel.getKey(), beli));\n+                    }\n+                }\n+            } finally {\n+                chrLock.unlock();\n+            }\n+\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> buffStatList = new LinkedHashMap<>();\n+            for(Pair<Integer, MapleBuffStatValueHolder> p : cancelList) {\n+                buffStatList.put(stat, p.getRight());\n+                extractBuffValue(p.getLeft(), stat);\n+                dropBuffStats(deregisterBuffStats(buffStatList));\n+            }\n+        } finally {\n+            effLock.unlock();\n+        }\n+        \n+        cancelPlayerBuffs(Arrays.asList(stat));\n+    }\n+    \n+    private Map<MapleBuffStat, MapleBuffStatValueHolder> extractCurrentBuffStats(MapleStatEffect effect) {\n+        chrLock.lock();\n+        try {\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> stats = new LinkedHashMap<>();\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> buffList = buffEffects.remove(effect.getBuffSourceId());\n+            for (Entry<MapleBuffStat, MapleBuffStatValueHolder> stateffect : buffList.entrySet()) {\n+                stats.put(stateffect.getKey(), stateffect.getValue());\n+                buffEffectsCount.put(stateffect.getKey(), (byte)(buffEffectsCount.get(stateffect.getKey()) - 1));\n+            }\n+            \n+            return stats;\n+        } finally {\n+            chrLock.unlock();\n+        }\n+    }\n+    \n+    private Map<MapleBuffStat, MapleBuffStatValueHolder> extractLeastRelevantStatEffectsIfFull(MapleStatEffect effect) {\n+        Map<MapleBuffStat, MapleBuffStatValueHolder> extractedStatBuffs = new LinkedHashMap<>();\n+        \n+        chrLock.lock();\n+        try {\n+            Map<MapleBuffStat, Byte> stats = new LinkedHashMap<>();\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> minStatBuffs = new LinkedHashMap<>();\n+            \n+            for(Entry<Integer, Map<MapleBuffStat, MapleBuffStatValueHolder>> mbsvhi : buffEffects.entrySet()) {\n+                for(Entry<MapleBuffStat, MapleBuffStatValueHolder> mbsvh : mbsvhi.getValue().entrySet()) {\n+                    MapleBuffStat mbs = mbsvh.getKey();\n+                    Byte it = stats.get(mbs);\n+                    \n+                    if(it != null) {\n+                        stats.put(mbs, (byte) (it + 1));\n+                        if(mbsvh.getValue().value < minStatBuffs.get(mbs).value) minStatBuffs.put(mbs, mbsvh.getValue());\n+                    } else {\n+                        stats.put(mbs, (byte) 1);\n+                        minStatBuffs.put(mbs, mbsvh.getValue());\n+                    }\n+                }\n+            }\n+            \n+            Set<MapleBuffStat> effectStatups = new LinkedHashSet<>();\n+            for(Pair<MapleBuffStat, Integer> efstat : effect.getStatups()) {\n+                effectStatups.add(efstat.getLeft());\n+            }\n+            \n+            for(Entry<MapleBuffStat, Byte> it : stats.entrySet()) {\n+                boolean uniqueBuff = isSingletonStatup(it.getKey());\n+                \n+                if(it.getValue() >= (!uniqueBuff ? ServerConstants.MAX_MONITORED_BUFFSTATS : 1) && effectStatups.contains(it.getKey())) {\n+                    MapleBuffStatValueHolder mbsvh = minStatBuffs.get(it.getKey());\n+                    \n+                    Map<MapleBuffStat, MapleBuffStatValueHolder> lpbe = buffEffects.get(mbsvh.effect.getBuffSourceId());\n+                    lpbe.remove(it.getKey());\n+                    buffEffectsCount.put(it.getKey(), (byte)(buffEffectsCount.get(it.getKey()) - 1));\n+                    \n+                    if(lpbe.isEmpty()) buffEffects.remove(mbsvh.effect.getBuffSourceId());\n+                    extractedStatBuffs.put(it.getKey(), mbsvh);\n+                }\n+            }\n+        } finally {\n+            chrLock.unlock();\n+        }\n+        \n+        return extractedStatBuffs;\n+    }\n+    \n+    private boolean isSingletonStatup(MapleBuffStat mbs) {\n+        switch(mbs) {\n+            case RECOVERY:\n+            case HPREC:\n+            case MPREC:\n+            case SUMMON:\n+            case PUPPET:\n+            case DRAGONBLOOD:\n+            case MONSTER_RIDING:\n+            case MORPH:\n+            case HYPERBODYHP:\n+            case HYPERBODYMP:\n+                return true;\n+                \n+            default:\n+                return false;\n+        }\n+    }\n+    \n+    public void registerEffect(MapleStatEffect effect, long starttime, long expirationtime, boolean isSilent) {\n+        if (effect.isDragonBlood()) {\n+            prepareDragonBlood(effect);\n+        } else if (effect.isBerserk()) {\n+            checkBerserk(isHidden());\n+        } else if (effect.isBeholder()) {\n+            final int beholder = DarkKnight.BEHOLDER;\n+            if (beholderHealingSchedule != null) {\n+                beholderHealingSchedule.cancel(false);\n+            }\n+            if (beholderBuffSchedule != null) {\n+                beholderBuffSchedule.cancel(false);\n+            }\n+            Skill bHealing = SkillFactory.getSkill(DarkKnight.AURA_OF_BEHOLDER);\n+            int bHealingLvl = getSkillLevel(bHealing);\n+            if (bHealingLvl > 0) {\n+                final MapleStatEffect healEffect = bHealing.getEffect(bHealingLvl);\n+                int healInterval = healEffect.getX() * 1000;\n+                beholderHealingSchedule = TimerManager.getInstance().register(new Runnable() {\n+                    @Override\n+                    public void run() {\n+                        addHP(healEffect.getHp());\n+                        client.announce(MaplePacketCreator.showOwnBuffEffect(beholder, 2));\n+                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.summonSkill(getId(), beholder, 5), true);\n+                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showOwnBuffEffect(beholder, 2), false);\n+                    }\n+                }, healInterval, healInterval);\n+            }\n+            Skill bBuff = SkillFactory.getSkill(DarkKnight.HEX_OF_BEHOLDER);\n+            if (getSkillLevel(bBuff) > 0) {\n+                final MapleStatEffect buffEffect = bBuff.getEffect(getSkillLevel(bBuff));\n+                int buffInterval = buffEffect.getX() * 1000;\n+                beholderBuffSchedule = TimerManager.getInstance().register(new Runnable() {\n+                    @Override\n+                    public void run() {\n+                        buffEffect.applyTo(MapleCharacter.this);\n+                        client.announce(MaplePacketCreator.showOwnBuffEffect(beholder, 2));\n+                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.summonSkill(getId(), beholder, (int) (Math.random() * 3) + 6), true);\n+                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showBuffeffect(getId(), beholder, 2), false);\n+                    }\n+                }, buffInterval, buffInterval);\n+            }\n+        } else if (effect.isRecovery()) {\n+            int healInterval = (ServerConstants.USE_ULTRA_RECOVERY) ? 2000 : 5000;\n+            final byte heal = (byte) effect.getX();\n+            \n+            chrLock.lock();\n+            try {\n+                if(recoveryTask != null) {\n+                    recoveryTask.cancel(false);\n+                }\n+                \n+                recoveryTask = TimerManager.getInstance().register(new Runnable() {\n+                    @Override\n+                    public void run() {\n+                        if (getBuffSource(MapleBuffStat.RECOVERY) == -1) {\n+                            chrLock.lock();\n+                            try {\n+                                if (recoveryTask != null) {\n+                                    recoveryTask.cancel(false);\n+                                    recoveryTask = null;\n+                                }\n+                            } finally {\n+                                chrLock.unlock();\n+                            }\n+\n+                            return;\n+                        }\n+\n+                        addHP(heal);\n+                        client.announce(MaplePacketCreator.showOwnRecovery(heal));\n+                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showRecovery(id, heal), false);\n                     }\n-                }\n+                }, healInterval, healInterval);\n             } finally {\n-                con.close();\n+                chrLock.unlock();\n             }\n-        } catch (SQLException sqle) {\n-            sqle.printStackTrace();\n-        }\n-\n-        return character;\n-    }\n-\n-    public Long getBuffedStarttime(MapleBuffStat effect) {\n-        chrLock.lock();\n-        try {\n-            MapleBuffStatValueHolder mbsvh = effects.get(effect);\n-            if (mbsvh == null) {\n-                return null;\n+        } else if (effect.isDojoBuff() || effect.getSourceId() == 2022337) {\n+            boolean isRecoveryBuff = false;\n+            if(effect.getHpRRate() > 0) {\n+                extraHpRec = effect.getHpR();\n+                extraRecInterval = effect.getHpRRate();\n+                isRecoveryBuff = true;\n             }\n-            return Long.valueOf(mbsvh.startTime);\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-\n-    public Integer getBuffedValue(MapleBuffStat effect) {\n-        chrLock.lock();\n-        try {\n-            MapleBuffStatValueHolder mbsvh = effects.get(effect);\n-            if (mbsvh == null) {\n-                return null;\n+            \n+            if(effect.getMpRRate() > 0) {\n+                extraMpRec = effect.getMpR();\n+                extraRecInterval = effect.getMpRRate();\n+                isRecoveryBuff = true;\n             }\n-            return Integer.valueOf(mbsvh.value);\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-\n-    public int getBuffSource(MapleBuffStat stat) {\n-        chrLock.lock();\n-        try {\n-            MapleBuffStatValueHolder mbsvh = effects.get(stat);\n-            if (mbsvh == null) {\n-                return -1;\n+            \n+            if(isRecoveryBuff) {\n+                stopExtraTask();\n+                startExtraTask(extraHpRec, extraMpRec, extraRecInterval);   // HP & MP sharing the same task holder\n             }\n-            return mbsvh.effect.getSourceId();\n-        } finally {\n-            chrLock.unlock();\n         }\n-    }\n-\n-    public MapleStatEffect getBuffEffect(MapleBuffStat stat) {\n+        \n+        effLock.lock();\n         chrLock.lock();\n         try {\n-            MapleBuffStatValueHolder mbsvh = effects.get(stat);\n-            if (mbsvh == null) {\n-                return null;\n-            } else {\n-                return mbsvh.effect;\n+            Integer sourceid = effect.getBuffSourceId();\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> toDeploy;\n+            Map<MapleBuffStat, MapleBuffStatValueHolder> appliedStatups = new LinkedHashMap<>();\n+            \n+            for(Pair<MapleBuffStat, Integer> ps : effect.getStatups()) {\n+                appliedStatups.put(ps.getLeft(), new MapleBuffStatValueHolder(effect, starttime, ps.getRight()));\n             }\n-        } finally {\n-            chrLock.unlock();\n-        }\n-    }\n-\n-    private List<MapleBuffStat> getBuffStats(MapleStatEffect effect, long startTime) {\n-        chrLock.lock();\n-        try {\n-            List<MapleBuffStat> stats = new ArrayList<>();\n-            for (Entry<MapleBuffStat, MapleBuffStatValueHolder> stateffect : effects.entrySet()) {\n-                if(stateffect.getValue() == null) continue;\n-\n-                if (stateffect.getValue().effect.sameSource(effect) && (startTime == -1 || startTime == stateffect.getValue().startTime)) {\n-                    stats.add(stateffect.getKey());\n+            \n+            if(ServerConstants.USE_BUFF_MOST_SIGNIFICANT) {\n+                toDeploy = new LinkedHashMap<>();\n+                Map<Integer, Pair<MapleStatEffect, Long>> retrievedEffects = new LinkedHashMap<>();\n+                \n+                for (Entry<MapleBuffStat, MapleBuffStatValueHolder> statup : appliedStatups.entrySet()) {\n+                    MapleBuffStatValueHolder mbsvh = effects.get(statup.getKey());\n+                    if(mbsvh == null || mbsvh.value <= statup.getValue().value) {\n+                        toDeploy.put(statup.getKey(), statup.getValue());\n+                    } else {\n+                        retrievedEffects.put(mbsvh.effect.getBuffSourceId(), new Pair<>(mbsvh.effect, mbsvh.startTime));\n+                    }\n+                    \n+                    Byte val = buffEffectsCount.get(statup.getKey());\n+                    if(val != null) val = (byte)(val + 1);\n+                    else val = (byte) 1;\n+                    \n+                    buffEffectsCount.put(statup.getKey(), val);\n+                }\n+                \n+                if(!isSilent) {\n+                    for(Entry<Integer, Pair<MapleStatEffect, Long>> lmse: retrievedEffects.entrySet()) {\n+                        lmse.getValue().getLeft().updateBuffEffect(this, getActiveStatupsFromSourceid(lmse.getKey()), lmse.getValue().getRight());\n+                    }\n                 }\n+            } else {\n+                for (Entry<MapleBuffStat, MapleBuffStatValueHolder> statup : appliedStatups.entrySet()) {\n+                    Byte val = buffEffectsCount.get(statup.getKey());\n+                    if(val != null) val = (byte)(val + 1);\n+                    else val = (byte) 1;\n+                    \n+                    buffEffectsCount.put(statup.getKey(), val);\n+                }\n+                \n+                toDeploy = appliedStatups;\n+            }\n+            \n+            addItemEffectHolder(sourceid, expirationtime, appliedStatups);\n+            \n+            for (Entry<MapleBuffStat, MapleBuffStatValueHolder> statup : toDeploy.entrySet()) {\n+                if(statup.getValue().value != 0) effects.put(statup.getKey(), statup.getValue());\n             }\n-            return stats;\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n+        \n+        recalcLocalStats();\n     }\n \n     public int getChair() {\n@@ -3691,6 +4237,7 @@ public final int getStartedQuestsSize() {\n     }\n \n     public MapleStatEffect getStatForBuff(MapleBuffStat effect) {\n+        effLock.lock();\n         chrLock.lock();\n         try {\n             MapleBuffStatValueHolder mbsvh = effects.get(effect);\n@@ -3700,6 +4247,7 @@ public MapleStatEffect getStatForBuff(MapleBuffStat effect) {\n             return mbsvh.effect;\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n     }\n \n@@ -3778,13 +4326,13 @@ public int getWorld() {\n     public void giveCoolDowns(final int skillid, long starttime, long length) {\n         if (skillid == 5221999) {\n             this.battleshipHp = (int) length;\n-            addCooldown(skillid, 0, length, null);\n+            addCooldown(skillid, 0, length);\n         } else {\n             int time = (int) ((length + starttime) - System.currentTimeMillis());\n-            addCooldown(skillid, System.currentTimeMillis(), time, TimerManager.getInstance().schedule(new CancelCooldownAction(this, skillid), time));\n+            addCooldown(skillid, System.currentTimeMillis(), time);\n         }\n     }\n-\n+    \n     public int gmLevel() {\n         return gmLevel;\n     }\n@@ -3919,11 +4467,13 @@ public void increaseGuildCapacity() { //hopefully nothing is null\n     public boolean isActiveBuffedValue(int skillid) {\n         LinkedList<MapleBuffStatValueHolder> allBuffs;\n         \n+        effLock.lock();\n         chrLock.lock();\n         try {\n             allBuffs = new LinkedList<>(effects.values());\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n         \n         for (MapleBuffStatValueHolder mbsvh : allBuffs) {\n@@ -3939,6 +4489,7 @@ public boolean isAlive() {\n     }\n \n     public boolean isBuffFrom(MapleBuffStat stat, Skill skill) {\n+        effLock.lock();\n         chrLock.lock();\n         try {\n             MapleBuffStatValueHolder mbsvh = effects.get(stat);\n@@ -3948,6 +4499,7 @@ public boolean isBuffFrom(MapleBuffStat stat, Skill skill) {\n             return mbsvh.effect.isSkill() && mbsvh.effect.getSourceId() == skill.getId();\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n     }\n \n@@ -4395,14 +4947,7 @@ private void commitBuffCoupon(int couponid) {\n     }\n     \n     public void dispelBuffCoupons() {\n-        LinkedList<MapleBuffStatValueHolder> allBuffs;\n-        \n-        chrLock.lock();\n-        try {\n-            allBuffs = new LinkedList<>(effects.values());\n-        } finally {\n-            chrLock.unlock();\n-        }\n+        List<MapleBuffStatValueHolder> allBuffs = getAllStatups();\n         \n         for (MapleBuffStatValueHolder mbsvh : allBuffs) {\n             if (ItemConstants.isRateCoupon(mbsvh.effect.getSourceId())) {\n@@ -4806,29 +5351,26 @@ public static String makeMapleReadable(String in) {\n         public MapleStatEffect effect;\n         public long startTime;\n         public int value;\n-        public ScheduledFuture<?> schedule;\n+        public boolean bestApplied;\n \n-        public MapleBuffStatValueHolder(MapleStatEffect effect, long startTime, ScheduledFuture<?> schedule, int value) {\n+        public MapleBuffStatValueHolder(MapleStatEffect effect, long startTime, int value) {\n             super();\n             this.effect = effect;\n             this.startTime = startTime;\n-            this.schedule = schedule;\n             this.value = value;\n+            this.bestApplied = false;\n         }\n     }\n \n     public static class MapleCoolDownValueHolder {\n-\n         public int skillId;\n         public long startTime, length;\n-        public ScheduledFuture<?> timer;\n \n-        public MapleCoolDownValueHolder(int skillId, long startTime, long length, ScheduledFuture<?> timer) {\n+        public MapleCoolDownValueHolder(int skillId, long startTime, long length) {\n             super();\n             this.skillId = skillId;\n             this.startTime = startTime;\n             this.length = length;\n-            this.timer = timer;\n         }\n     }\n \n@@ -5147,119 +5689,22 @@ public void receivePartyMemberHP() {\n         }\n     }\n \n-    public void registerEffect(MapleStatEffect effect, long starttime, ScheduledFuture<?> schedule) {\n-        if (effect.isDragonBlood()) {\n-            prepareDragonBlood(effect);\n-        } else if (effect.isBerserk()) {\n-            checkBerserk(isHidden());\n-        } else if (effect.isBeholder()) {\n-            final int beholder = DarkKnight.BEHOLDER;\n-            if (beholderHealingSchedule != null) {\n-                beholderHealingSchedule.cancel(false);\n-            }\n-            if (beholderBuffSchedule != null) {\n-                beholderBuffSchedule.cancel(false);\n-            }\n-            Skill bHealing = SkillFactory.getSkill(DarkKnight.AURA_OF_BEHOLDER);\n-            int bHealingLvl = getSkillLevel(bHealing);\n-            if (bHealingLvl > 0) {\n-                final MapleStatEffect healEffect = bHealing.getEffect(bHealingLvl);\n-                int healInterval = healEffect.getX() * 1000;\n-                beholderHealingSchedule = TimerManager.getInstance().register(new Runnable() {\n-                    @Override\n-                    public void run() {\n-                        addHP(healEffect.getHp());\n-                        client.announce(MaplePacketCreator.showOwnBuffEffect(beholder, 2));\n-                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.summonSkill(getId(), beholder, 5), true);\n-                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showOwnBuffEffect(beholder, 2), false);\n-                    }\n-                }, healInterval, healInterval);\n-            }\n-            Skill bBuff = SkillFactory.getSkill(DarkKnight.HEX_OF_BEHOLDER);\n-            if (getSkillLevel(bBuff) > 0) {\n-                final MapleStatEffect buffEffect = bBuff.getEffect(getSkillLevel(bBuff));\n-                int buffInterval = buffEffect.getX() * 1000;\n-                beholderBuffSchedule = TimerManager.getInstance().register(new Runnable() {\n-                    @Override\n-                    public void run() {\n-                        buffEffect.applyTo(MapleCharacter.this);\n-                        client.announce(MaplePacketCreator.showOwnBuffEffect(beholder, 2));\n-                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.summonSkill(getId(), beholder, (int) (Math.random() * 3) + 6), true);\n-                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showBuffeffect(getId(), beholder, 2), false);\n-                    }\n-                }, buffInterval, buffInterval);\n-            }\n-        } else if (effect.isRecovery()) {\n-            int healInterval = (ServerConstants.USE_ULTRA_RECOVERY) ? 2000 : 5000;\n-            final byte heal = (byte) effect.getX();\n-            \n-            chrLock.lock();\n-            try {\n-                recoveryTask = TimerManager.getInstance().register(new Runnable() {\n-                    @Override\n-                    public void run() {\n-                        if (getBuffSource(MapleBuffStat.RECOVERY) == -1) {\n-                            chrLock.lock();\n-                            try {\n-                                if (recoveryTask != null) {\n-                                    recoveryTask.cancel(false);\n-                                    recoveryTask = null;\n-                                }\n-                            } finally {\n-                                chrLock.unlock();\n-                            }\n-\n-                            return;\n-                        }\n-\n-                        addHP(heal);\n-                        client.announce(MaplePacketCreator.showOwnRecovery(heal));\n-                        getMap().broadcastMessage(MapleCharacter.this, MaplePacketCreator.showRecovery(id, heal), false);\n-                    }\n-                }, healInterval, healInterval);\n-            } finally {\n-                chrLock.unlock();\n-            }\n-        } else if (effect.isDojoBuff() || effect.getSourceId() == 2022337) {\n-            boolean isRecoveryBuff = false;\n-            if(effect.getHpRRate() > 0) {\n-                extraHpRec = effect.getHpR();\n-                extraRecInterval = effect.getHpRRate();\n-                isRecoveryBuff = true;\n-            }\n-            \n-            if(effect.getMpRRate() > 0) {\n-                extraMpRec = effect.getMpR();\n-                extraRecInterval = effect.getMpRRate();\n-                isRecoveryBuff = true;\n-            }\n-            \n-            if(isRecoveryBuff) {\n-                stopExtraTask();\n-                startExtraTask(extraHpRec, extraMpRec, extraRecInterval);   // HP & MP sharing the same task holder\n-            }\n-        }\n-        \n+    public void removeAllCooldownsExcept(int id, boolean packet) {\n+        effLock.lock();\n         chrLock.lock();\n         try {\n-            for (Pair<MapleBuffStat, Integer> statup : effect.getStatups()) {\n-                effects.put(statup.getLeft(), new MapleBuffStatValueHolder(effect, starttime, schedule, statup.getRight()));\n+            ArrayList<MapleCoolDownValueHolder> list = new ArrayList<>(coolDowns.values());\n+            for (MapleCoolDownValueHolder mcvh : list) {\n+                if (mcvh.skillId != id) {\n+                    coolDowns.remove(mcvh.skillId);\n+                    if (packet) {\n+                        client.announce(MaplePacketCreator.skillCooldown(mcvh.skillId, 0));\n+                    }\n+                }\n             }\n         } finally {\n             chrLock.unlock();\n-        }\n-        \n-        recalcLocalStats();\n-    }\n-\n-    public void removeAllCooldownsExcept(int id, boolean packet) {\n-        for (MapleCoolDownValueHolder mcvh : Collections.unmodifiableCollection(coolDowns.values())) {\n-            if (mcvh.skillId != id) {\n-                coolDowns.remove(mcvh.skillId);\n-                if (packet) {\n-                    client.announce(MaplePacketCreator.skillCooldown(mcvh.skillId, 0));\n-                }\n-            }\n+            effLock.unlock();\n         }\n     }\n \n@@ -5269,8 +5714,15 @@ public static void removeAriantRoom(int room) {\n     }\n \n     public void removeCooldown(int skillId) {\n-        if (this.coolDowns.containsKey(skillId)) {\n-            this.coolDowns.remove(skillId);\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            if (this.coolDowns.containsKey(skillId)) {\n+                this.coolDowns.remove(skillId);\n+            }\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n         }\n     }\n \n@@ -5381,13 +5833,15 @@ public void resetEnteredScript(String script) {\n     }\n \n     public synchronized void saveCooldowns() {\n-        if (getAllCooldowns().size() > 0) {\n+        List<PlayerCoolDownValueHolder> listcd = getAllCooldowns();\n+                \n+        if (listcd.size() > 0) {\n             try {\n                 Connection con = DatabaseConnection.getConnection();\n                 deleteWhereCharacterId(con, \"DELETE FROM cooldowns WHERE charid = ?\");\n                 try (PreparedStatement ps = con.prepareStatement(\"INSERT INTO cooldowns (charid, SkillID, StartTime, length) VALUES (?, ?, ?, ?)\")) {\n                     ps.setInt(1, getId());\n-                    for (PlayerCoolDownValueHolder cooling : getAllCooldowns()) {\n+                    for (PlayerCoolDownValueHolder cooling : listcd) {\n                         ps.setInt(2, cooling.skillId);\n                         ps.setLong(3, cooling.startTime);\n                         ps.setLong(4, cooling.length);\n@@ -5931,6 +6385,7 @@ public void setBuddyCapacity(int capacity) {\n     }\n \n     public void setBuffedValue(MapleBuffStat effect, int value) {\n+        effLock.lock();\n         chrLock.lock();\n         try {\n             MapleBuffStatValueHolder mbsvh = effects.get(effect);\n@@ -5940,6 +6395,7 @@ public void setBuffedValue(MapleBuffStat effect, int value) {\n             mbsvh.value = value;\n         } finally {\n             chrLock.unlock();\n+            effLock.unlock();\n         }\n     }\n \n@@ -6497,7 +6953,14 @@ public String toString() {\n     }\n \n     public boolean skillIsCooling(int skillId) {\n-        return coolDowns.containsKey(Integer.valueOf(skillId));\n+        effLock.lock();\n+        chrLock.lock();\n+        try {\n+            return coolDowns.containsKey(Integer.valueOf(skillId));\n+        } finally {\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n     }\n \n     public void runFullnessSchedule(int petSlot) {\n@@ -7096,6 +7559,9 @@ public final void empty(final boolean remove) {\n         if (extraRecoveryTask != null) {\n             extraRecoveryTask.cancel(false);\n         }\n+        \n+        cancelBuffExpireTask();\n+        cancelSkillCooldownTask();\n         cancelExpirationTask();\n         for (ScheduledFuture<?> sf : timers) {\n             sf.cancel(false);"}, {"sha": "be571003a5bb25602bf17955a387c5535630d78b", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -1307,7 +1307,9 @@ public void changeChannel(int channel) {\n \t\t\t}\n \t\t}\n \t\tserver.getPlayerBuffStorage().addBuffsToStorage(player.getId(), player.getAllBuffs());\n-\t\tplayer.cancelBuffEffects();\n+\t\tplayer.cancelAllBuffs(true);\n+                player.cancelBuffExpireTask();\n+                player.cancelSkillCooldownTask();\n \t\t//Cancelling magicdoor? Nope\n \t\t//Cancelling mounts? Noty\n \t\tif (player.getBuffedValue(MapleBuffStat.PUPPET) != null) {"}, {"sha": "b61d27fd98d9d947d019154a06b803d17b4e5b26", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -1252,9 +1252,12 @@ else if (type.equals(\"cash\")) {\n \t\t\t\t}\n \t\t\t}\n                         \n-                        if(player.getJob().isA(MapleJob.ARAN1)) {\n+                        if(player.getJob().isA(MapleJob.ARAN1) || player.getJob().isA(MapleJob.LEGEND)) {\n                                 skill = SkillFactory.getSkill(5001005);\n                                 player.changeSkillLevel(skill, (byte) -1, -1, -1);\n+                        } else {\n+                                skill = SkillFactory.getSkill(21001001);\n+                                player.changeSkillLevel(skill, (byte) -1, -1, -1);\n                         }\n                         \n                         player.yellowMessage(\"Skills maxed out.\");\n@@ -1664,7 +1667,7 @@ public static boolean executeSolaxiaCommandLv3(Channel cserv, Server srv, MapleC\n                 \n                 case \"givems\":\n                         if (sub.length < 3){\n-\t\t\t\tplayer.yellowMessage(\"Syntax: !givems <playername> <gainmx>\");\n+\t\t\t\tplayer.yellowMessage(\"Syntax: !givems <playername> <gainms>\");\n \t\t\t\tbreak;\n \t\t\t}\n                         \n@@ -2051,7 +2054,7 @@ public void run() {\n                         try {\n                                 if (sub.length == 2) {\n                                         int itemId = Integer.parseInt(sub[1]);\n-                                        if(!(itemId >= 30000 && itemId < 32000) || MapleItemInformationProvider.getInstance().getName(itemId) == null) {\n+                                        if(!(itemId >= 30000 && itemId < 35000) || MapleItemInformationProvider.getInstance().getName(itemId) == null) {\n                                                 player.yellowMessage(\"Hair id '\" + sub[1] + \"' does not exist.\");\n                                                 break;\n                                         }\n@@ -2061,7 +2064,7 @@ public void run() {\n                                         player.equipChanged();\n                                 } else {\n                                         int itemId = Integer.parseInt(sub[2]);\n-                                        if(!(itemId >= 30000 && itemId < 32000) || MapleItemInformationProvider.getInstance().getName(itemId) == null) {\n+                                        if(!(itemId >= 30000 && itemId < 35000) || MapleItemInformationProvider.getInstance().getName(itemId) == null) {\n                                                 player.yellowMessage(\"Hair id '\" + sub[2] + \"' does not exist.\");\n                                                 break;\n                                         }\n@@ -2278,13 +2281,15 @@ public static boolean executeSolaxiaCommandLv4(Channel cserv, Server srv, MapleC\n                         player.getMap().spawnMonsterOnGroundBelow(monster, player.getPosition());\n                         break;\n                             \n+                    /*\n                     case \"playernpc\":\n                         if (sub.length < 3){\n                             player.yellowMessage(\"Syntax: !playernpc <playername> <npcid>\");\n                             break;\n                         }\n                         player.playerNPC(c.getChannelServer().getPlayerStorage().getCharacterByName(sub[1]), Integer.parseInt(sub[2]));\n \t\t\tbreak;\n+                    */\n                         \n                     default:\n                         return false;"}, {"sha": "c1027d514a434fe9bd8042987bab36e9c178d8fb", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -487,11 +487,11 @@ private double normalizedMasteryExp(int reqLevel) {\n         // from level 1 to 2 is killing about 100~200 mobs of the same level range, on a 1x EXP rate scenario.\n         \n         if(reqLevel >= 78) {\n-            return Math.max(ServerConstants.EQUIP_EXPERIENCE_MOD * (10413.648 * Math.exp(reqLevel * 0.03275)), 15);\n+            return Math.max(ServerConstants.EQUIP_EXP_RATE * (10413.648 * Math.exp(reqLevel * 0.03275)), 15);\n         } else if(reqLevel >= 38) {\n-            return Math.max(ServerConstants.EQUIP_EXPERIENCE_MOD * ( 4985.818 * Math.exp(reqLevel * 0.02007)), 15);\n+            return Math.max(ServerConstants.EQUIP_EXP_RATE * ( 4985.818 * Math.exp(reqLevel * 0.02007)), 15);\n         } else {\n-            return Math.max(ServerConstants.EQUIP_EXPERIENCE_MOD * (  248.219 * Math.exp(reqLevel * 0.11093)), 15);\n+            return Math.max(ServerConstants.EQUIP_EXP_RATE * (  248.219 * Math.exp(reqLevel * 0.11093)), 15);\n         }\n     }\n     "}, {"sha": "80347f53cf070f5ea14858b4525bfbd4479192db", "filename": "src/constants/ItemConstants.java", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/constants/ItemConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/constants/ItemConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ItemConstants.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -36,8 +36,6 @@\n     public final static int KARMA = 0x10;\n     public final static int PET_COME = 0x80;\n     public final static int ACCOUNT_SHARING = 0x100;\n-    public final static float ITEM_ARMOR_EXP = 1 / 350000;\n-    public static final float ITEM_WEAPON_EXP = 1 / 700000;\n \n     public final static boolean EXPIRING_ITEMS = true;\n "}, {"sha": "bd24572cbf115e57593004f49d05c93a822656ff", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -33,7 +33,7 @@\n     //Server Flags\n     public static final boolean USE_CUSTOM_KEYSET = true;           //Enables auto-setup of the MapleSolaxiaV2's custom keybindings when creating characters.\n     public static final boolean USE_MAXRANGE_ECHO_OF_HERO = true;\n-    public static final boolean USE_MAXRANGE = true;                //Will send and receive packets from all events of a map, rather than those of only view range.\n+    public static final boolean USE_MAXRANGE = true;                //Will send and receive packets from all events on a map, rather than those of only view range.\n     public static final boolean USE_DEBUG = false;                  //Will enable some text prints on the client, oriented for debugging purposes.\n     public static final boolean USE_DEBUG_SHOW_RCVD_PACKET = false; //Prints on the cmd all received packet ids.\n     public static final boolean USE_DEBUG_SHOW_INFO_EQPEXP = false; //Prints on the cmd all equip exp gain info.\n@@ -45,20 +45,23 @@\n     public static final boolean USE_PARTY_SEARCH = false;\n     public static final boolean USE_AUTOBAN = false;                //Commands the server to detect infractors automatically.\n     public static final boolean USE_AUTOSAVE = true;                //Enables server autosaving feature (saves characters to DB each 1 hour).\n-    public static final boolean USE_SERVER_AUTOASSIGNER = true;     //Server-builtin autoassigner, uses algorithm based on distributing AP accordingly to required secondary stat on equipments.\n+    public static final boolean USE_SERVER_AUTOASSIGNER = true;     //Server-builtin autoassigner, uses algorithm based on distributing AP accordingly with required secondary stat on equipments.\n     public static final boolean USE_REFRESH_RANK_MOVE = true;\n     public static final boolean USE_ENFORCE_MDOOR_POSITION = true;  //Forces mystic door to be spawned near spawnpoints. (since things bugs out other way, and this helps players to locate the door faster)\n     public static final boolean USE_ERASE_UNTRADEABLE_DROP = true;  //Forces flagged untradeable items to disappear when dropped.\n+    public static final boolean USE_BUFF_MOST_SIGNIFICANT = true;   //When applying buffs, the player will stick with the highest stat boost among the listed, rather than overwriting stats.\n     \n     //Server Rates And Experience\n     public static final int EXP_RATE = 10;\n     public static final int MESO_RATE = 10;\n     public static final int DROP_RATE = 10;\n     public static final int BOSS_DROP_RATE = 20;\n-    public static final int PARTY_EXPERIENCE_MOD = 1;           //Change for event stuff.\n-    public static final double EQUIP_EXPERIENCE_MOD = 10.0;     //Rate for equipment exp needed, grows linearly. Set 1.0 for default (about 100~200 same-level range mobs killed to pass equip from level 1 to 2).\n+    public static final double EQUIP_EXP_RATE = 10.0;               //Rate for equipment exp gain, grows linearly. Set 1.0 for default (about 100~200 same-level range mobs killed to pass equip from level 1 to 2).\n+    \n+    public static final int PARTY_EXPERIENCE_MOD = 1;               //Change for event stuff.\n     public static final double PQ_BONUS_EXP_MOD = 0.5;\n     \n+    public static final byte MAX_MONITORED_BUFFSTATS = 5;       //Limits accounting for \"dormant\" buff effects, that should take place when stronger stat buffs expires.\n     public static final int MAX_AP = 32767;                     //Max AP allotted on the auto-assigner.\n     public static final int MAX_EVENT_LEVELS = 8;               //Event has different levels of rewarding system.\n     public static final long BLOCK_NPC_RACE_CONDT = (long)(0.5 * 1000); //Time the player client must wait before reopening a conversation with an NPC.\n@@ -91,7 +94,7 @@\n     \n     //Equipment Configuration\n     public static final boolean USE_EQUIPMNT_LVLUP_SLOTS = true;//Equips can upgrade slots at level up.\n-    public static final boolean USE_EQUIPMNT_LVLUP_POWER = true;//Enable more powerful stats upgrades at equip level up.\n+    public static final boolean USE_EQUIPMNT_LVLUP_POWER = true;//Enable more powerful stat upgrades at equip level up.\n     public static final boolean USE_SPIKES_AVOID_BANISH = true; //Shoes equipped with spikes prevents mobs from banishing wearer.\n     public static final boolean USE_CHAIR_EXTRAHEAL = true;     //Enable map chairs to further recover player's HP and MP.\n     public static final int MAX_EQUIPMNT_LVLUP_STAT_UP = 10000; //Max stat upgrade an equipment can have on a levelup."}, {"sha": "2653260ef0635ec15441648d6606654bf0e63936", "filename": "src/net/server/Server.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -21,6 +21,8 @@\n  */\n package net.server;\n \n+import net.server.worker.CouponWorker;\n+import net.server.worker.RankingWorker;\n import java.io.FileInputStream;\n import java.io.IOException;\n import java.net.InetSocketAddress;"}, {"sha": "9671895cf7ca162d7f69569ee59222ab941bd769", "filename": "src/net/server/channel/handlers/CancelBuffHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/CancelBuffHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/CancelBuffHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CancelBuffHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -41,6 +41,8 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         int sourceid = slea.readInt();\n+        if(sourceid < 0) sourceid = -sourceid;  //oh my...\n+        \n         switch (sourceid) {\n             case FPArchMage.BIG_BANG:\n             case ILArchMage.BIG_BANG:"}, {"sha": "37bd7929d9ee1a1f6d8c1ddc8fa3056a1cdd8b95", "filename": "src/net/server/channel/handlers/CloseRangeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CloseRangeDamageHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -32,7 +32,6 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n import client.MapleBuffStat;\n import client.MapleCharacter;\n-import client.MapleCharacter.CancelCooldownAction;\n import client.MapleClient;\n import client.MapleJob;\n import client.MapleStat;\n@@ -175,7 +174,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     return;\n                 } else {\n                     c.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));\n-                    player.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000, TimerManager.getInstance().schedule(new CancelCooldownAction(player, attack.skill), effect_.getCooldown() * 1000));\n+                    player.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000);\n                 }\n             }\n         }"}, {"sha": "5af0f742a3d67e8fa1e7a07ff4f5061d933b6918", "filename": "src/net/server/channel/handlers/EnterCashShopHandler.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/EnterCashShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/EnterCashShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterCashShopHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -50,7 +50,9 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             mc.closePlayerInteractions();\n \n             Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(mc.getId(), mc.getAllBuffs());\n-            mc.cancelBuffEffects();\n+            mc.cancelAllBuffs(true);\n+            mc.cancelBuffExpireTask();\n+            mc.cancelSkillCooldownTask();\n             mc.cancelExpirationTask();\n \n             c.announce(MaplePacketCreator.openCashShop(c, false));"}, {"sha": "ef2767e56ec03abda42af0f5c68ec99e7b48310d", "filename": "src/net/server/channel/handlers/EnterMTSHandler.java", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/EnterMTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/EnterMTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterMTSHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -59,6 +59,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n         \n         Server.getInstance().getPlayerBuffStorage().addBuffsToStorage(chr.getId(), chr.getAllBuffs());\n+        chr.cancelAllBuffs(true);\n+        chr.cancelBuffExpireTask();\n+        chr.cancelSkillCooldownTask();\n         chr.cancelExpirationTask();\n         chr.saveToDB();\n         chr.getMap().removePlayer(c.getPlayer());"}, {"sha": "fb73ac7eca4646a43e12c66200a0f4c1568394c1", "filename": "src/net/server/channel/handlers/MagicDamageHandler.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/MagicDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/MagicDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MagicDamageHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -27,7 +27,6 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n import client.MapleBuffStat;\n import client.MapleCharacter;\n-import client.MapleCharacter.CancelCooldownAction;\n import client.MapleClient;\n import client.Skill;\n import client.SkillFactory;\n@@ -76,7 +75,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\treturn;\n \t\t\t} else {\n \t\t\t\tc.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));\n-\t\t\t\tplayer.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000, TimerManager.getInstance().schedule(new CancelCooldownAction(player, attack.skill), effect_.getCooldown() * 1000));\n+\t\t\t\tplayer.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000);\n \t\t\t}\n \t\t}\n \t\tapplyAttack(attack, player, effect.getAttackCount());"}, {"sha": "8d60569f9b0baa2e75a9ad75a8192cf7aa0d8c8f", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -32,6 +32,7 @@\n import java.util.Arrays;\n \n import net.AbstractMaplePacketHandler;\n+import net.server.Server;\n import server.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n import server.MapleMiniGame;\n@@ -172,6 +173,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     } else {\n                         HiredMerchant merchant = new HiredMerchant(chr, itemId, desc);\n                         chr.setHiredMerchant(merchant);\n+                        c.getWorldServer().registerHiredMerchant(merchant);\n                         chr.getClient().getChannelServer().addHiredMerchant(chr.getId(), merchant);\n                         chr.announce(MaplePacketCreator.getHiredMerchant(chr, merchant, true));\n                     }"}, {"sha": "b82e96612dc0e6449990ae939400d6eca985aa31", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -256,6 +256,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         c.announce(MaplePacketCreator.enableReport());\n         player.changeSkillLevel(SkillFactory.getSkill(10000000 * player.getJobType() + 12), (byte) (player.getLinkedLevel() / 10), 20, -1);\n         player.checkBerserk(player.isHidden());\n+        player.buffExpireTask();\n+        player.skillCooldownTask();\n         player.expirationTask();\n         if (GameConstants.hasSPTable(player.getJob()) && player.getJob().getId() != 2001) {\n                 player.createDragon();"}, {"sha": "cf255c8327180e7fd97f01639f71e98bd10e9882", "filename": "src/net/server/channel/handlers/RangedAttackHandler.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/RangedAttackHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/RangedAttackHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RangedAttackHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -30,7 +30,6 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n import client.MapleBuffStat;\n import client.MapleCharacter;\n-import client.MapleCharacter.CancelCooldownAction;\n import client.MapleClient;\n import client.Skill;\n import client.SkillFactory;\n@@ -208,7 +207,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             return;\n                         } else {\n                             c.announce(MaplePacketCreator.skillCooldown(attack.skill, effect_.getCooldown()));\n-                            player.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000, TimerManager.getInstance().schedule(new CancelCooldownAction(player, attack.skill), effect_.getCooldown() * 1000));\n+                            player.addCooldown(attack.skill, System.currentTimeMillis(), effect_.getCooldown() * 1000);\n                         }\n                     }\n                 }"}, {"sha": "68f6b8ee7c1c5f0fa873b31afab69e28a5bd049a", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -32,7 +32,6 @@\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n import client.MapleCharacter;\n-import client.MapleCharacter.CancelCooldownAction;\n import client.autoban.AutobanFactory;\n import client.MapleClient;\n import client.MapleStat;\n@@ -84,8 +83,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 return;\n             } else if (skillid != Corsair.BATTLE_SHIP) {\n                 c.announce(MaplePacketCreator.skillCooldown(skillid, effect.getCooldown()));\n-                ScheduledFuture<?> timer = TimerManager.getInstance().schedule(new CancelCooldownAction(c.getPlayer(), skillid), effect.getCooldown() * 1000);\n-                chr.addCooldown(skillid, System.currentTimeMillis(), effect.getCooldown() * 1000, timer);\n+                chr.addCooldown(skillid, System.currentTimeMillis(), effect.getCooldown() * 1000);\n             }\n         }\n         if (skillid == Hero.MONSTER_MAGNET || skillid == Paladin.MONSTER_MAGNET || skillid == DarkKnight.MONSTER_MAGNET) { // Monster Magnet"}, {"sha": "6404f50f7646227aa73195493b19670019eaa0c5", "filename": "src/net/server/worker/BaseWorker.java", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/BaseWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/BaseWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/BaseWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -0,0 +1,39 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+package net.server.worker;\n+\n+import net.server.world.World;\n+\n+/**\n+ * @author Ronan\n+ */\n+public class BaseWorker implements Runnable {\n+    protected World wserv;\n+    \n+    @Override\n+    public void run() {}\n+    \n+    public BaseWorker(World world) {\n+        wserv = world;\n+    }\n+}"}, {"sha": "a871e5c70eec0372ba892f206ccaf3153c88766d", "filename": "src/net/server/worker/CharacterAutosaverWorker.java", "status": "renamed", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/CharacterAutosaverWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/CharacterAutosaverWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/CharacterAutosaverWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -20,17 +20,17 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-package net.server;\n+package net.server.worker;\n \n import net.server.world.World;\n import client.MapleCharacter;\n import constants.ServerConstants;\n+import net.server.PlayerStorage;\n \n /**\n  * @author Ronan\n  */\n-public class CharacterAutosaverWorker implements Runnable {\n-    private World wserv;\n+public class CharacterAutosaverWorker extends BaseWorker implements Runnable {\n     \n     @Override\n     public void run() {\n@@ -45,6 +45,6 @@ public void run() {\n     }\n     \n     public CharacterAutosaverWorker(World world) {\n-        wserv = world;\n+        super(world);\n     }\n }", "previous_filename": "src/net/server/CharacterAutosaverWorker.java"}, {"sha": "568517f708d064edb375b5115e754cfb050a1b45", "filename": "src/net/server/worker/CouponWorker.java", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/CouponWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/CouponWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/CouponWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -20,9 +20,10 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-package net.server;\n+package net.server.worker;\n \n import java.sql.SQLException;\n+import net.server.Server;\n import tools.FilePrinter;\n \n /**", "previous_filename": "src/net/server/CouponWorker.java"}, {"sha": "4d7b3a7bfd694ec31e63a689f876a983c4000ddd", "filename": "src/net/server/worker/HiredMerchantWorker.java", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/HiredMerchantWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/HiredMerchantWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/HiredMerchantWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -0,0 +1,40 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+package net.server.worker;\n+\n+import net.server.world.World;\n+\n+/**\n+ * @author Ronan\n+ */\n+public class HiredMerchantWorker extends BaseWorker implements Runnable {\n+    \n+    @Override\n+    public void run() {\n+        wserv.runHiredMerchantSchedule();\n+    }\n+    \n+    public HiredMerchantWorker(World world) {\n+        super(world);\n+    }\n+}"}, {"sha": "b67889e0a3650f539da36dd49b9fdff06d6aee8c", "filename": "src/net/server/worker/MountTirednessWorker.java", "status": "renamed", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/MountTirednessWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/MountTirednessWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/MountTirednessWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -20,22 +20,21 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-package net.server;\n+package net.server.worker;\n \n import net.server.world.World;\n \n /**\n  * @author Ronan\n  */\n-public class MountTirednessWorker implements Runnable {\n-    private World wserv;\n+public class MountTirednessWorker extends BaseWorker implements Runnable {\n     \n     @Override\n     public void run() {\n         wserv.runMountSchedule();\n     }\n     \n     public MountTirednessWorker(World world) {\n-        wserv = world;\n+        super(world);\n     }\n }", "previous_filename": "src/net/server/MountTirednessWorker.java"}, {"sha": "6830419a8b63a127b6358ca0a3add2bb1238a104", "filename": "src/net/server/worker/PetFullnessWorker.java", "status": "renamed", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/PetFullnessWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/PetFullnessWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/PetFullnessWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -20,22 +20,21 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-package net.server;\n+package net.server.worker;\n \n import net.server.world.World;\n \n /**\n  * @author Ronan\n  */\n-public class PetFullnessWorker implements Runnable {\n-    private World wserv;\n+public class PetFullnessWorker extends BaseWorker implements Runnable {\n     \n     @Override\n     public void run() {\n         wserv.runPetSchedule();\n     }\n     \n     public PetFullnessWorker(World world) {\n-        wserv = world;\n+        super(world);\n     }\n }", "previous_filename": "src/net/server/PetFullnessWorker.java"}, {"sha": "10eed76d7c18a0e28bed091852a8f684f3580a31", "filename": "src/net/server/worker/RankingWorker.java", "status": "renamed", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/RankingWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/worker/RankingWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/RankingWorker.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -19,7 +19,7 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-package net.server;\n+package net.server.worker;\n \n import java.sql.Connection;\n import java.sql.PreparedStatement;\n@@ -28,6 +28,7 @@\n import client.MapleJob;\n import tools.DatabaseConnection;\n import constants.ServerConstants;\n+import net.server.Server;\n \n /**\n  * @author Matze", "previous_filename": "src/net/server/RankingWorker.java"}, {"sha": "565bd9e69be61155710a6d2ff601376cd86b3e70", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 50, "deletions": 3, "changes": 53, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -45,9 +45,10 @@\n import java.util.concurrent.ScheduledFuture;\n \n import server.TimerManager;\n-import net.server.CharacterAutosaverWorker;\n-import net.server.MountTirednessWorker;\n-import net.server.PetFullnessWorker;\n+import server.maps.HiredMerchant;\n+import net.server.worker.CharacterAutosaverWorker;\n+import net.server.worker.MountTirednessWorker;\n+import net.server.worker.PetFullnessWorker;\n import net.server.PlayerStorage;\n import net.server.Server;\n import net.server.channel.Channel;\n@@ -84,6 +85,10 @@\n     private ScheduledFuture<?> mountsSchedule;\n     private long mountUpdate;\n     \n+    private Map<HiredMerchant, Byte> activeMerchants = new LinkedHashMap<>();\n+    private ScheduledFuture<?> MerchantsSchedule;\n+    private long merchantUpdate;\n+    \n     private ScheduledFuture<?> charactersSchedule;\n     \n     public World(int world, int flag, String eventmsg, int exprate, int droprate, int mesorate, int bossdroprate) {\n@@ -773,6 +778,48 @@ public void runMountSchedule() {\n             }\n         }\n     }\n+    \n+    public void registerHiredMerchant(HiredMerchant hm) {\n+        synchronized(activeMerchants) {\n+            byte initProc;\n+            if(System.currentTimeMillis() - merchantUpdate > 5 * 60 * 1000) initProc = 1;\n+            else initProc = 0;\n+            \n+            activeMerchants.put(hm, initProc);\n+        }\n+    }\n+    \n+    public void unregisterHiredMerchant(HiredMerchant hm) {\n+        synchronized(activeMerchants) {\n+            activeMerchants.remove(hm);\n+        }\n+    }\n+    \n+    public void runHiredMerchantSchedule() {\n+        Map<HiredMerchant, Byte> deployedMerchants;\n+        synchronized(activeMerchants) {\n+            merchantUpdate = System.currentTimeMillis();\n+            deployedMerchants = Collections.unmodifiableMap(activeMerchants);\n+        }\n+        \n+        for(Map.Entry<HiredMerchant, Byte> dm: deployedMerchants.entrySet()) {\n+            byte timeOn = dm.getValue();\n+            \n+            if(timeOn <= 144) {   // 1440 minutes == 24hrs\n+                synchronized(activeMerchants) {\n+                    activeMerchants.put(dm.getKey(), (byte)(timeOn + 1));\n+                }\n+            } else {\n+                HiredMerchant hm = dm.getKey();\n+                hm.forceClose();\n+                this.getChannel(hm.getChannel()).removeHiredMerchant(hm.getOwnerId());\n+                \n+                synchronized(activeMerchants) {\n+                    activeMerchants.remove(dm.getKey());\n+                }\n+            }\n+        }\n+    }\n \n     public void setServerMessage(String msg) {\n         for (Channel ch : channels) {"}, {"sha": "27fa978d16c1759a4bdd97ab4f7e8ef92dc7fc4d", "filename": "src/server/MapleInventoryManipulator.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleInventoryManipulator.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -523,7 +523,7 @@ public static void drop(MapleClient c, MapleInventoryType type, short src, short\n         \treturn;\n         }\n         int itemId = source.getItemId();\n-        if (itemId >= 5000000 && itemId <= 5000102) {\n+        if (ItemConstants.isPet(itemId)) {\n             return;\n         }\n         if (type == MapleInventoryType.EQUIPPED && itemId == 1122017) {"}, {"sha": "d93f683f8a8a3323f7cbae5deda3e2e60b2bc187", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -110,6 +110,7 @@\n     protected Map<Integer, Boolean> consumeOnPickupCache = new HashMap<>();\n     protected Map<Integer, Boolean> isQuestItemCache = new HashMap<>();\n     protected Map<Integer, String> equipmentSlotCache = new HashMap<>();\n+    protected Map<Integer, Boolean> noCancelMouseCache = new HashMap<>();\n \n     private MapleItemInformationProvider() {\n         loadCardIdData();\n@@ -246,7 +247,7 @@ private MapleData getStringData(int itemId) {\n         } else if (itemId >= 1080000 && itemId < 1090000) {\n             theData = eqpStringData;\n             cat = \"Eqp/Glove\";\n-        } else if (itemId >= 30000 && itemId < 32000) {\n+        } else if (itemId >= 30000 && itemId < 35000) {\n             theData = eqpStringData;\n             cat = \"Eqp/Hair\";\n         } else if (itemId >= 1050000 && itemId < 1060000) {\n@@ -278,7 +279,7 @@ private MapleData getStringData(int itemId) {\n             cat = \"Etc\";\n         } else if (itemId >= 3000000 && itemId < 4000000) {\n             theData = insStringData;\n-        } else if (itemId >= 5000000 && itemId < 5010000) {\n+        } else if (ItemConstants.isPet(itemId)) {\n             theData = petStringData;\n         } else {\n             return null;\n@@ -291,11 +292,19 @@ private MapleData getStringData(int itemId) {\n     }\n \n     public boolean noCancelMouse(int itemId) {\n+        if (noCancelMouseCache.containsKey(itemId)) {\n+            return noCancelMouseCache.get(itemId);\n+        }\n+        \n         MapleData item = getItemData(itemId);\n         if (item == null) {\n+            noCancelMouseCache.put(itemId, false);\n             return false;\n         }\n-        return MapleDataTool.getIntConvert(\"info/noCancelMouse\", item, 0) == 1;\n+        \n+        boolean blockMouse = MapleDataTool.getIntConvert(\"info/noCancelMouse\", item, 0) == 1;\n+        noCancelMouseCache.put(itemId, blockMouse);\n+        return blockMouse;\n     }\n \n     private MapleData getItemData(int itemId) {"}, {"sha": "df111ce591555a49f851d995ac24b678a16cd651", "filename": "src/server/MapleShop.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleShop.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleShop.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleShop.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -132,7 +132,7 @@ public void buy(MapleClient c, short slot, int itemId, short quantity) {\n                     int cardreduce = value - cost;\n                     int diff = cardreduce + c.getPlayer().getMeso();\n                     if (MapleInventoryManipulator.checkSpace(c, itemId, quantity, \"\")) {\n-                        if (itemId >= 5000000 && itemId <= 5000100) {\n+                        if (ItemConstants.isPet(itemId)) {\n                             int petid = MaplePet.createPet(itemId);\n                             MapleInventoryManipulator.addById(c, itemId, quantity, null, petid, -1);\n                         } else {"}, {"sha": "f1841008956301e76d698dfd52a48c1f652a0411", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 33, "deletions": 12, "changes": 45, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -565,8 +565,8 @@ private static MapleStatEffect loadFromData(MapleData source, int sourceid, bool\n                 case Crusader.ARMOR_CRASH:\n                 case DragonKnight.POWER_CRASH:\n                 case WhiteKnight.MAGIC_CRASH:\n-                \tmonsterStatus.put(MonsterStatus.SEAL_SKILL,  Integer.valueOf(1));\n-                \tbreak;\n+                    monsterStatus.put(MonsterStatus.SEAL_SKILL,  Integer.valueOf(1));\n+                    break;\n                 case Rogue.DISORDER:\n                     monsterStatus.put(MonsterStatus.WATK, Integer.valueOf(ret.x));\n                     monsterStatus.put(MonsterStatus.WDEF, Integer.valueOf(ret.y));\n@@ -842,7 +842,6 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n             } else {\n                 MapleInventoryManipulator.removeById(applyto.getClient(), MapleInventoryType.USE, projectile, 200, false, true);\n             }\n-\n         }\n         SummonMovementType summonMovementType = getSummonMovementType();\n         if (overTime || isCygnusFA() || summonMovementType != null) {\n@@ -983,9 +982,12 @@ private Rectangle calculateBoundingBox(Point posFrom, boolean facingLeft) {\n     public void silentApplyBuff(MapleCharacter chr, long starttime) {\n         int localDuration = duration;\n         localDuration = alchemistModifyVal(chr, localDuration, false);\n-        CancelEffectAction cancelAction = new CancelEffectAction(chr, this, starttime);\n-        ScheduledFuture<?> schedule = TimerManager.getInstance().schedule(cancelAction, ((starttime + localDuration) - System.currentTimeMillis()));\n-        chr.registerEffect(this, starttime, schedule);\n+        //CancelEffectAction cancelAction = new CancelEffectAction(chr, this, starttime);\n+        //ScheduledFuture<?> schedule = TimerManager.getInstance().schedule(cancelAction, ((starttime + localDuration) - System.currentTimeMillis()));\n+        \n+        if(starttime + localDuration <= System.currentTimeMillis()) return;\n+        \n+        chr.registerEffect(this, starttime, (starttime + localDuration), true);\n         SummonMovementType summonMovementType = getSummonMovementType();\n         if (summonMovementType != null) {\n             final MapleSummon tosummon = new MapleSummon(chr, sourceid, chr.getPosition(), summonMovementType);\n@@ -1006,7 +1008,18 @@ public final void applyComboBuff(final MapleCharacter applyto, int combo) {\n         final long starttime = System.currentTimeMillis();\n //\tfinal CancelEffectAction cancelAction = new CancelEffectAction(applyto, this, starttime);\n //\tfinal ScheduledFuture<?> schedule = TimerManager.getInstance().schedule(cancelAction, ((starttime + 99999) - System.currentTimeMillis()));\n-        applyto.registerEffect(this, starttime, null);\n+        applyto.registerEffect(this, starttime, Long.MAX_VALUE, false);\n+    }\n+    \n+    public void updateBuffEffect(MapleCharacter target, List<Pair<MapleBuffStat, Integer>> activeStats, long starttime) {\n+        int localDuration = duration;\n+        localDuration = alchemistModifyVal(target, localDuration, false);\n+        \n+        long leftDuration = (starttime + localDuration) - System.currentTimeMillis();\n+        if(leftDuration > 0) {\n+            byte[] buff = MaplePacketCreator.giveBuff((skill ? sourceid : -sourceid), (int)leftDuration, activeStats);\n+            target.getClient().announce(buff);\n+        }\n     }\n \n     private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, boolean primary) {\n@@ -1107,11 +1120,7 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n                 List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.MORPH, Integer.valueOf(getMorph(applyto))));\n                 mbuff = MaplePacketCreator.giveForeignBuff(applyto.getId(), stat);\n             }\n-            long starttime = System.currentTimeMillis();\n-            CancelEffectAction cancelAction = new CancelEffectAction(applyto, this, starttime);\n-            ScheduledFuture<?> schedule = TimerManager.getInstance().schedule(cancelAction, localDuration);\n-            applyto.registerEffect(this, starttime, schedule);\n-\n+            \n             if (buff != null) {\n             \tif (!hasNoIcon()) { //Thanks flav for such a simple release! :)\n             \t\tapplyto.getClient().announce(buff);\n@@ -1120,6 +1129,12 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n                     System.out.println(\"<Error> NO buff icon for id \" + sourceid);\n                 }\n             }\n+            \n+            long starttime = System.currentTimeMillis();\n+            //CancelEffectAction cancelAction = new CancelEffectAction(applyto, this, starttime);\n+            //ScheduledFuture<?> schedule = TimerManager.getInstance().schedule(cancelAction, localDuration);\n+            applyto.registerEffect(this, starttime, starttime + localDuration, false);\n+\n             if (mbuff != null) {\n                 applyto.getMap().broadcastMessage(applyto, mbuff, false);\n             }\n@@ -1511,11 +1526,16 @@ public boolean isSkill() {\n     public int getSourceId() {\n         return sourceid;\n     }\n+    \n+    public int getBuffSourceId() {\n+        return skill ? sourceid : -sourceid;\n+    }\n \n     public boolean makeChanceResult() {\n         return prop == 1.0 || Math.random() < prop;\n     }\n \n+    /*\n     private static class CancelEffectAction implements Runnable {\n \n         private MapleStatEffect effect;\n@@ -1536,6 +1556,7 @@ public void run() {\n             }\n         }\n     }\n+    */\n \n     public short getHp() {\n         return hp;"}, {"sha": "c5a1fc527ecd533481b81f481f09bcc1fa014096", "filename": "src/server/maps/HiredMerchant.java", "status": "modified", "additions": 4, "deletions": 16, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/maps/HiredMerchant.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/server/maps/HiredMerchant.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/HiredMerchant.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -35,12 +35,10 @@\n import java.util.Collections;\n import java.util.LinkedList;\n import java.util.List;\n-import java.util.concurrent.ScheduledFuture;\n import net.server.Server;\n import server.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n import server.MaplePlayerShopItem;\n-import server.TimerManager;\n import tools.DatabaseConnection;\n import tools.MaplePacketCreator;\n import tools.Pair;\n@@ -61,7 +59,6 @@\n     private List<Pair<String, Byte>> messages = new LinkedList<>();\n     private List<SoldItem> sold = new LinkedList<>();\n     private boolean open;\n-    public ScheduledFuture<?> schedule = null;\n     private MapleMap map;\n \n     public HiredMerchant(final MapleCharacter owner, int itemId, String desc) {\n@@ -74,14 +71,6 @@ public HiredMerchant(final MapleCharacter owner, int itemId, String desc) {\n         this.ownerName = owner.getName();\n         this.description = desc;\n         this.map = owner.getMap();\n-        this.schedule = TimerManager.getInstance().schedule(new Runnable() {\n-\n-            @Override\n-            public void run() {\n-                HiredMerchant.this.forceClose();\n-\t\t\t\tServer.getInstance().getChannel(world, channel).removeHiredMerchant(ownerId);\n-            }\n-        }, 1000 * 60 * 60 * 24);\n     }\n \n     public void broadcastToVisitors(final byte[] packet) {\n@@ -194,9 +183,8 @@ public void buy(MapleClient c, int item, short quantity) {\n     }\n \n     public void forceClose() {\n-        if (schedule != null) {\n-            schedule.cancel(false);\n-        }\n+        Server.getInstance().getWorld(world).unregisterHiredMerchant(this);\n+        \n         try {\n             saveItems(true);\n             items.clear();\n@@ -226,7 +214,6 @@ public void forceClose() {\n         }\n \n         map = null;\n-        schedule = null;\n     }\n \n \tpublic void closeShop(MapleClient c, boolean timeout) {\n@@ -268,7 +255,8 @@ public void closeShop(MapleClient c, boolean timeout) {\n             } catch (Exception e) {\n                 e.printStackTrace();\n             }\n-            schedule.cancel(false);\n+            \n+            Server.getInstance().getWorld(world).unregisterHiredMerchant(this);\n     }\n \n     public String getOwner() {"}, {"sha": "0baa4847560f8ee1ae8e56a67fe00ea87df0618d", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -83,7 +83,6 @@\n import client.MapleClient;\n import client.MapleDisease;\n import client.MapleFamilyEntry;\n-import client.MapleJob;\n import client.MapleKeyBinding;\n import client.MapleMount;\n import client.MapleQuestStatus;"}, {"sha": "7442d425d19c6b1b3ce0fe03d20b1b45d8e3fe9e", "filename": "wz/Item.wz/Consume/0202.img.xml", "status": "modified", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/wz/Item.wz/Consume/0202.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/wz/Item.wz/Consume/0202.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Consume/0202.img.xml?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -18580,4 +18580,64 @@\n       <int name=\"time\" value=\"40000\"/>\n     </imgdir>\n   </imgdir>\n+  <imgdir name=\"02023001\">\n+    <imgdir name=\"info\">\n+      <canvas name=\"icon\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+      <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+    </imgdir>\n+    <imgdir name=\"spec\">\n+      <int name=\"mdd\" value=\"40\"/>\n+      <int name=\"mad\" value=\"35\"/>\n+      <int name=\"time\" value=\"3600000\"/>\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"02023002\">\n+    <imgdir name=\"info\">\n+      <canvas name=\"icon\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+      <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+    </imgdir>\n+    <imgdir name=\"spec\">\n+      <int name=\"pdd\" value=\"55\"/>\n+      <int name=\"mdd\" value=\"55\"/>\n+      <int name=\"time\" value=\"3600000\"/>\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"02023003\">\n+    <imgdir name=\"info\">\n+      <canvas name=\"icon\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+      <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+    </imgdir>\n+    <imgdir name=\"spec\">\n+      <int name=\"eva\" value=\"35\"/>\n+      <int name=\"time\" value=\"3600000\"/>\n+      <int name=\"acc\" value=\"35\"/>\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"02023000\">\n+    <imgdir name=\"info\">\n+      <canvas name=\"icon\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+      <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n+        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n+      </canvas>\n+    </imgdir>\n+    <imgdir name=\"spec\">\n+      <int name=\"pad\" value=\"45\"/>\n+      <int name=\"pdd\" value=\"30\"/>\n+      <int name=\"time\" value=\"3600000\"/>\n+    </imgdir>\n+  </imgdir>\n </imgdir>"}, {"sha": "f2e7a7367e8f8494cbe4f7e6fa9582239a6e8660", "filename": "wz/String.wz/Consume.img.xml", "status": "modified", "additions": 28, "deletions": 12, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/9c72ce1e3a5fec23dca16ef85b62eb250254415d/wz/String.wz/Consume.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/9c72ce1e3a5fec23dca16ef85b62eb250254415d/wz/String.wz/Consume.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Consume.img.xml?ref=9c72ce1e3a5fec23dca16ef85b62eb250254415d", "patch": "@@ -1,20 +1,20 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n <imgdir name=\"Consume.img\">\n-  <imgdir name=\"2000000\">\n-    <string name=\"name\" value=\"Red Potion\"/>\n-    <string name=\"desc\" value=\"A potion made out of red herbs.\\nRecovers 50 HP.\"/>\n+  <imgdir name=\"2023000\">\n+    <string name=\"name\" value=\"Sharenian Grounds : Fortitude\"/>\n+    <string name=\"desc\" value=\"From the ancient remains, an unknown blessing grants you fortitude. Increases Weapon Attack &amp; Weapon Defense.\"/>\n   </imgdir>\n-  <imgdir name=\"2000001\">\n-    <string name=\"name\" value=\"Orange Potion\"/>\n-    <string name=\"desc\" value=\"A concentrated potion made out of red herbs.\\nRecovers 150 HP.\"/>\n+  <imgdir name=\"2023001\">\n+    <string name=\"name\" value=\"Sharenian Grounds : Intellect\"/>\n+    <string name=\"desc\" value=\"From the ancient remains, an unknown blessing grants you intellect. Increases Magic Attack &amp; Magic Defense.\"/>\n   </imgdir>\n-  <imgdir name=\"2000002\">\n-    <string name=\"name\" value=\"White Potion\"/>\n-    <string name=\"desc\" value=\"A highly-concentrated potion made out of red herbs.\\nRecovers 300 HP.\"/>\n+  <imgdir name=\"2023002\">\n+    <string name=\"name\" value=\"Sharenian Grounds : Endurance\"/>\n+    <string name=\"desc\" value=\"From the ancient remains, an unknown blessing grants you endurance. Increases Weapon Defense &amp; Magic Defense.\"/>\n   </imgdir>\n-  <imgdir name=\"2000003\">\n-    <string name=\"name\" value=\"Blue Potion\"/>\n-    <string name=\"desc\" value=\"A potion made out of blue herbs.\\nRecovers 100 MP.\"/>\n+  <imgdir name=\"2023003\">\n+    <string name=\"name\" value=\"Sharenian Grounds : Swiftness\"/>\n+    <string name=\"desc\" value=\"From the ancient remains, an unknown blessing grants you swiftness. Increases Accuracy &amp; Avoidability.\"/>\n   </imgdir>\n   <imgdir name=\"2000004\">\n     <string name=\"name\" value=\"Elixir\"/>\n@@ -9188,4 +9188,20 @@\n     <string name=\"name\" value=\"Return to New Leaf City Scroll\"/>\n     <string name=\"desc\" value=\"Use this scroll to venture back to New Leaf City whenever you want!\"/>\n   </imgdir>\n+  <imgdir name=\"2000000\">\n+    <string name=\"name\" value=\"Red Potion\"/>\n+    <string name=\"desc\" value=\"A potion made out of red herbs.\\nRecovers 50 HP.\"/>\n+  </imgdir>\n+  <imgdir name=\"2000001\">\n+    <string name=\"name\" value=\"Orange Potion\"/>\n+    <string name=\"desc\" value=\"A concentrated potion made out of red herbs.\\nRecovers 150 HP.\"/>\n+  </imgdir>\n+  <imgdir name=\"2000002\">\n+    <string name=\"name\" value=\"White Potion\"/>\n+    <string name=\"desc\" value=\"A highly-concentrated potion made out of red herbs.\\nRecovers 300 HP.\"/>\n+  </imgdir>\n+  <imgdir name=\"2000003\">\n+    <string name=\"name\" value=\"Blue Potion\"/>\n+    <string name=\"desc\" value=\"A potion made out of blue herbs.\\nRecovers 100 MP.\"/>\n+  </imgdir>\n </imgdir>"}]}]},
