{"fetchDate": "2019-12-19", "content": [{"sha": "d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ZDAzOTZlNGMzNjNmMmM2OGUzZjYxMDQyNGMyNTBlOWQyZWMyYTJlMA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-27T02:09:42Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-27T02:09:42Z"}, "message": "Protected Trade/Quest system + Expirable quests\n\nAdded true protection against race conditions on player trades and fixed\nsome situational issues. Character's quest status table also received\nconcurrency treatment. Quests with time limit now expires properly.\nIncreased subtly the performance on the server start-up.", "tree": {"sha": "45df1bc371ccdeed8f6cb03731c1a3be36e564c1", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/45df1bc371ccdeed8f6cb03731c1a3be36e564c1"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "html_url": "https://github.com/ronancpl/HeavenMS/commit/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "702c69897b21de4472b103a183118c7d1ca15645", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/702c69897b21de4472b103a183118c7d1ca15645", "html_url": "https://github.com/ronancpl/HeavenMS/commit/702c69897b21de4472b103a183118c7d1ca15645"}], "stats": {"total": 361, "additions": 229, "deletions": 132}, "files": [{"sha": "6a7722e40cd47c0480cbe8438b0b5b98e5b79d1d", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -250,4 +250,10 @@ Solu\n \n 25 Maio 2017,\n Solu\ufffd\ufffdo final ao problema das Guild Alliances. Todas as funcionalidades implementadas.\n-Registros de objetos MapleGuildCharacter agora esta sincronizado entre MapleCharacter's e MapleGuild's.\n\\ No newline at end of file\n+Registros de objetos MapleGuildCharacter agora esta sincronizado entre MapleCharacter's e MapleGuild's.\n+\n+26 Maio 2017,\n+Corre\ufffd\ufffdo e prote\ufffd\ufffdo a acessos concorrentes em mec\ufffdnicas de comercializa\ufffd\ufffdo entre jogadores.\n+Quests com limite de tempo agora expiram. Tempo restante tamb\ufffdm \ufffd mostrado na aba da quest.\n+Estrutura de dados que lida com status de quests do jogador agora foi protegido para acesso concorrente.\n+Montarias, tanto como pets, n\ufffdo ficam com \"fome\" com o tempo caso os flags PETS_NEVER_HUNGRY estejam setados.\n\\ No newline at end of file"}, {"sha": "83e676f7310eb6fd6eb7cff888ba3ccb630d7404", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 28, "deletions": 2, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -5,12 +5,38 @@\n             <url>src/tools/MaplePacketCreator.java</url>\n             <bookmark id=\"1\">\n                 <name/>\n-                <line>5939</line>\n+                <line>5941</line>\n                 <key/>\n             </bookmark>\n         </file>\n     </editor-bookmarks>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n-        <group/>\n+        <group>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/command/Commands.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleStatEffect.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/provider/MapleDataTool.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PlayerInteractionHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/UseCashItemHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/UseItemHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/MovePetHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/quest/QuestActionManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/guild/MapleAlliance.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/Server.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PlayerLoggedinHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/tools/LogHelper.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2010009.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/tools/MaplePacketCreator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleMount.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/guild/MapleGuild.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/TimerManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleQuestStatus.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/QuestActionHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleTrade.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleInventoryManipulator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/CharInfoRequestHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleClient.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/quest/MapleQuest.java</file>\n+        </group>\n     </open-files>\n </project-private>"}, {"sha": "03f1b62737434f46956f5513839b50eba998bbf0", "filename": "scripts/npc/world0/2010009.js", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/scripts/npc/world0/2010009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/scripts/npc/world0/2010009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2010009.js?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -72,6 +72,12 @@ function action(mode, type, selection) {\n             \n             cm.sendYesNo(\"Oh, are you interested in forming a Guild Union? The current fee for this operation is #b\" + allianceCost + \" mesos#k.\");\n         } else if (selection == 3) {\n+            if(cm.getPlayer().getMGC() == null) {\n+                cm.sendOk(\"You can not expand a Guild Union if you don't own one.\");\n+                cm.dispose();\n+                return;\n+            }\n+            \n             var rank = cm.getPlayer().getMGC().getAllianceRank();\n             if (rank == 1)\n                 cm.sendYesNo(\"Do you want to increase your Alliance by one guild slot? The fee for this procedure is #b\" + increaseCost + \" mesos#k.\");\n@@ -80,6 +86,12 @@ function action(mode, type, selection) {\n                 cm.dispose();\n             }\n         } else if(selection == 4) {\n+            if(cm.getPlayer().getMGC() == null) {\n+                cm.sendOk(\"You can not disband a Guild Union if you don't own one.\");\n+                cm.dispose();\n+                return;\n+            }\n+            \n             var rank = cm.getPlayer().getMGC().getAllianceRank();\n             if (rank == 1)\n                 cm.sendYesNo(\"Are you sure you want to disband your Guild Union?\");"}, {"sha": "6a1ea10a21878b15f8f328b48b67614dc4fecaf5", "filename": "scripts/quest/2230.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/scripts/quest/2230.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/scripts/quest/2230.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2230.js?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -70,7 +70,8 @@ function end(mode, type, selection) {\n         } else if (status == 5) {\n             qm.sendYesNo(\"Now do you understand? Every action comes with consequences, and pets are no exception. The egg of the snail shall hatch soon.\");\n         } else if (status == 6) {\n-            qm.gainItem(5000054, 1); // rune snail * 1\n+            qm.gainItem(5000054, 1, false, true, 5 * 60 * 60 * 1000);  // rune snail (5hrs)\n+            \n             qm.gainItem(4032086, -1); // Mysterious Egg * -1\n             qm.forceCompleteQuest();\n             qm.sendNext(\"This snail will only be alive for #b5 hours#k. Shower it with love. Your love will be reciprocated in the end.\");"}, {"sha": "e450efa4b043636accd9128a929c8dc530ce41c9", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 102, "deletions": 71, "changes": 173, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -239,7 +239,7 @@\n     private SavedLocation savedLocations[];\n     private SkillMacro[] skillMacros = new SkillMacro[5];\n     private List<Integer> lastmonthfameids;\n-    private Map<Short, MapleQuestStatus> quests;\n+    private final Map<Short, MapleQuestStatus> quests;\n     private Set<MapleMonster> controlled = new LinkedHashSet<>();\n     private Map<Integer, String> entered = new LinkedHashMap<>();\n     private Set<MapleMapObject> visibleMapObjects = new LinkedHashSet<>();\n@@ -2067,13 +2067,16 @@ public MapleClient getClient() {\n     }\n \n     public final List<MapleQuestStatus> getCompletedQuests() {\n-        List<MapleQuestStatus> ret = new LinkedList<>();\n-        for (MapleQuestStatus q : quests.values()) {\n-            if (q.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n-                ret.add(q);\n+        synchronized (quests) {\n+            List<MapleQuestStatus> ret = new LinkedList<>();\n+            for (MapleQuestStatus q : quests.values()) {\n+                if (q.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n+                    ret.add(q);\n+                }\n             }\n+            \n+            return Collections.unmodifiableList(ret);\n         }\n-        return Collections.unmodifiableList(ret);\n     }\n \n     public Collection<MapleMonster> getControlledMonsters() {\n@@ -2603,46 +2606,58 @@ public int getPossibleReports() {\n     }\n \n     public final byte getQuestStatus(final int quest) {\n-        for (final MapleQuestStatus q : quests.values()) {\n-            if (q.getQuest().getId() == quest) {\n-                return (byte) q.getStatus().getId();\n+        synchronized (quests) {\n+            for (final MapleQuestStatus q : quests.values()) {\n+                if (q.getQuest().getId() == quest) {\n+                    return (byte) q.getStatus().getId();\n+                }\n             }\n+            return 0;\n         }\n-        return 0;\n     }\n \n     public MapleQuestStatus getQuest(MapleQuest quest) {\n-        if (!quests.containsKey(quest.getId())) {\n-            return new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n+        synchronized (quests) {\n+            if (!quests.containsKey(quest.getId())) {\n+                return new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n+            }\n+            return quests.get(quest.getId());\n         }\n-        return quests.get(quest.getId());\n     }\n     \n     //---- \\/ \\/ \\/ \\/ \\/ \\/ \\/  NOT TESTED  \\/ \\/ \\/ \\/ \\/ \\/ \\/ \\/ \\/ ----\n     \n     public final void setQuestAdd(final MapleQuest quest, final byte status, final String customData) {\n-        if (!quests.containsKey(quest.getId())) {\n-            final MapleQuestStatus stat = new MapleQuestStatus(quest, MapleQuestStatus.Status.getById((int)status));\n-            stat.setCustomData(customData);\n-            quests.put(quest.getId(), stat);\n+        synchronized (quests) {\n+            if (!quests.containsKey(quest.getId())) {\n+                final MapleQuestStatus stat = new MapleQuestStatus(quest, MapleQuestStatus.Status.getById((int)status));\n+                stat.setCustomData(customData);\n+                quests.put(quest.getId(), stat);\n+            }\n         }\n     }\n \n     public final MapleQuestStatus getQuestNAdd(final MapleQuest quest) {\n-        if (!quests.containsKey(quest.getId())) {\n-            final MapleQuestStatus status = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n-            quests.put(quest.getId(), status);\n-            return status;\n+        synchronized (quests) {\n+            if (!quests.containsKey(quest.getId())) {\n+                final MapleQuestStatus status = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n+                quests.put(quest.getId(), status);\n+                return status;\n+            }\n+            return quests.get(quest.getId());\n         }\n-        return quests.get(quest.getId());\n     }\n \n     public final MapleQuestStatus getQuestNoAdd(final MapleQuest quest) {\n-        return quests.get(quest.getId());\n+        synchronized (quests) {\n+            return quests.get(quest.getId());\n+        }\n     }\n \n     public final MapleQuestStatus getQuestRemove(final MapleQuest quest) {\n-        return quests.remove(quest.getId());\n+        synchronized (quests) {\n+            return quests.remove(quest.getId());\n+        }\n     }\n \n     //---- /\\ /\\ /\\ /\\ /\\ /\\ /\\  NOT TESTED  /\\ /\\ /\\ /\\ /\\ /\\ /\\ /\\ /\\ ----\n@@ -2742,26 +2757,30 @@ public int getSlot() {\n     }\n \n     public final List<MapleQuestStatus> getStartedQuests() {\n-        List<MapleQuestStatus> ret = new LinkedList<>();\n-        for (MapleQuestStatus q : quests.values()) {\n-            if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-                ret.add(q);\n+        synchronized (quests) {\n+            List<MapleQuestStatus> ret = new LinkedList<>();\n+            for (MapleQuestStatus q : quests.values()) {\n+                if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                    ret.add(q);\n+                }\n             }\n+            return Collections.unmodifiableList(ret);\n         }\n-        return Collections.unmodifiableList(ret);\n     }\n \n     public final int getStartedQuestsSize() {\n-        int i = 0;\n-        for (MapleQuestStatus q : quests.values()) {\n-            if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-                if (q.getQuest().getInfoNumber() > 0) {\n+        synchronized (quests) {\n+            int i = 0;\n+            for (MapleQuestStatus q : quests.values()) {\n+                if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                    if (q.getQuest().getInfoNumber() > 0) {\n+                        i++;\n+                    }\n                     i++;\n                 }\n-                i++;\n             }\n+            return i;\n         }\n-        return i;\n     }\n \n     public MapleStatEffect getStatForBuff(MapleBuffStat effect) {\n@@ -3698,17 +3717,19 @@ public void mobKilled(int id) {\n         }\n \t\tint lastQuestProcessed = 0;\n         try {\n-            for (MapleQuestStatus q : quests.values()) {\n-                lastQuestProcessed = q.getQuest().getId();\n-                if (q.getStatus() == MapleQuestStatus.Status.COMPLETED || q.getQuest().canComplete(this, null)) {\n-                    continue;\n-                }\n-                String progress = q.getProgress(id);\n-                if (!progress.isEmpty() && Integer.parseInt(progress) >= q.getQuest().getMobAmountNeeded(id)) {\n-                    continue;\n-                }\n-                if (q.progress(id)) {\n-                    client.announce(MaplePacketCreator.updateQuest(q, false));\n+            synchronized (quests) {\n+                for (MapleQuestStatus q : quests.values()) {\n+                    lastQuestProcessed = q.getQuest().getId();\n+                    if (q.getStatus() == MapleQuestStatus.Status.COMPLETED || q.getQuest().canComplete(this, null)) {\n+                        continue;\n+                    }\n+                    String progress = q.getProgress(id);\n+                    if (!progress.isEmpty() && Integer.parseInt(progress) >= q.getQuest().getMobAmountNeeded(id)) {\n+                        continue;\n+                    }\n+                    if (q.progress(id)) {\n+                        client.announce(MaplePacketCreator.updateQuest(q, false));\n+                    }\n                 }\n             }\n         } catch (Exception e) {\n@@ -4536,27 +4557,30 @@ public synchronized void saveToDB() {\n             try (PreparedStatement pse = con.prepareStatement(\"INSERT INTO questprogress VALUES (DEFAULT, ?, ?, ?)\")) {\n                 psf = con.prepareStatement(\"INSERT INTO medalmaps VALUES (DEFAULT, ?, ?)\");\n                 ps.setInt(1, id);\n-                for (MapleQuestStatus q : quests.values()) {\n-                    ps.setInt(2, q.getQuest().getId());\n-                    ps.setInt(3, q.getStatus().getId());\n-                    ps.setInt(4, (int) (q.getCompletionTime() / 1000));\n-                    ps.setInt(5, q.getForfeited());\n-                    ps.executeUpdate();\n-                    try (ResultSet rs = ps.getGeneratedKeys()) {\n-                        rs.next();\n-                        for (int mob : q.getProgress().keySet()) {\n-                            pse.setInt(1, rs.getInt(1));\n-                            pse.setInt(2, mob);\n-                            pse.setString(3, q.getProgress(mob));\n-                            pse.addBatch();\n-                        }\n-                        for (int i = 0; i < q.getMedalMaps().size(); i++) {\n-                            psf.setInt(1, rs.getInt(1));\n-                            psf.setInt(2, q.getMedalMaps().get(i));\n-                            psf.addBatch();\n+                \n+                synchronized (quests) {\n+                    for (MapleQuestStatus q : quests.values()) {\n+                        ps.setInt(2, q.getQuest().getId());\n+                        ps.setInt(3, q.getStatus().getId());\n+                        ps.setInt(4, (int) (q.getCompletionTime() / 1000));\n+                        ps.setInt(5, q.getForfeited());\n+                        ps.executeUpdate();\n+                        try (ResultSet rs = ps.getGeneratedKeys()) {\n+                            rs.next();\n+                            for (int mob : q.getProgress().keySet()) {\n+                                pse.setInt(1, rs.getInt(1));\n+                                pse.setInt(2, mob);\n+                                pse.setString(3, q.getProgress(mob));\n+                                pse.addBatch();\n+                            }\n+                            for (int i = 0; i < q.getMedalMaps().size(); i++) {\n+                                psf.setInt(1, rs.getInt(1));\n+                                psf.setInt(2, q.getMedalMaps().get(i));\n+                                psf.addBatch();\n+                            }\n+                            pse.executeBatch();\n+                            psf.executeBatch();\n                         }\n-                        pse.executeBatch();\n-                        psf.executeBatch();\n                     }\n                 }\n             }\n@@ -5334,7 +5358,9 @@ public void updateQuestInfo(int quest, String info) {\n         MapleQuestStatus qs = getQuest(q);\n         qs.setInfo(info);\n \n-        quests.put(q.getId(), qs);\n+        synchronized (quests) {\n+            quests.put(q.getId(), qs);\n+        }\n \n         announce(MaplePacketCreator.updateQuest(qs, false));\n         if (qs.getQuest().getInfoNumber() > 0) {\n@@ -5354,7 +5380,9 @@ private void fameGainByQuest() {\n     }\n     \n     public void updateQuest(MapleQuestStatus quest) {\n-        quests.put(quest.getQuestID(), quest);\n+        synchronized (quests) {\n+            quests.put(quest.getQuestID(), quest);\n+        }\n         if (quest.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n             announce(MaplePacketCreator.updateQuest(quest, false));\n             if (quest.getQuest().getInfoNumber() > 0) {\n@@ -5375,17 +5403,20 @@ public void updateQuest(MapleQuestStatus quest) {\n         }\n     }\n \n-    public void questTimeLimit(final MapleQuest quest, int time) {\n+    public void questTimeLimit(final MapleQuest quest, int seconds) {\n+        final MapleCharacter chr = this;\n         ScheduledFuture<?> sf = TimerManager.getInstance().schedule(new Runnable() {\n             @Override\n             public void run() {\n+                if(chr.getQuestStatus(quest.getId()) == MapleQuestStatus.Status.COMPLETED.getId()) return;\n+                \n                 announce(MaplePacketCreator.questExpire(quest.getId()));\n                 MapleQuestStatus newStatus = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n                 newStatus.setForfeited(getQuest(quest).getForfeited() + 1);\n                 updateQuest(newStatus);\n             }\n-        }, time * 60 * 1000);\n-        announce(MaplePacketCreator.addQuestTimeLimit(quest.getId(), time * 60 * 1000));\n+        }, seconds * 1000);\n+        announce(MaplePacketCreator.addQuestTimeLimit(quest.getId(), seconds * 1000));\n         timers.add(sf);\n     }\n "}, {"sha": "d8b783f05dcf4e2e202e90560bd8c3484c015855", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -786,7 +786,7 @@ public final void disconnect(boolean shutdown, boolean cashshop) {//once per Map\n \t\t\tfinal MapleGuild guild = player.getGuild();\n \n \t\t\tif (channel == -1 || shutdown) {\n-                                chrg.setCharacter(null);\n+                                if(chrg != null) chrg.setCharacter(null);\n                             \n                                 removePlayer();\n                                 player.saveCooldowns();"}, {"sha": "7038ed53a6a90cd9aa34a37d1330a10f0d312997", "filename": "src/client/MapleMount.java", "status": "modified", "additions": 13, "deletions": 12, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleMount.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/client/MapleMount.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleMount.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -97,18 +97,19 @@ public void setTiredness(int newtiredness) {\n     }\n \n     private void increaseTiredness() {\n-\t\tif(owner != null) {\n-\t\t\tthis.tiredness++;\n-\t\t\towner.getMap().broadcastMessage(MaplePacketCreator.updateMount(owner.getId(), this, false));\n-\t\t\tif (tiredness > 99) {\n-\t\t\t\tthis.tiredness = 99;\n-\t\t\t\towner.dispelSkill(owner.getJobType() * 10000000 + 1004);\n-\t\t\t}\n-\t\t} else {\n-\t\t\tif(this.tirednessSchedule != null) {\n-\t\t\t\tthis.tirednessSchedule.cancel(false);\n-\t\t\t}\n-\t\t}\n+        if(owner != null) {\n+            this.tiredness++;\n+            owner.getMap().broadcastMessage(MaplePacketCreator.updateMount(owner.getId(), this, false));\n+            if (tiredness > 99) {\n+                this.tiredness = 99;\n+                owner.dispelSkill(owner.getJobType() * 10000000 + 1004);\n+                owner.dropMessage(\"Your mount grew tired! Treat it some revitalizer before riding it again!\");\n+            }\n+        } else {\n+            if(this.tirednessSchedule != null) {\n+                this.tirednessSchedule.cancel(false);\n+            }\n+        }\n     }\n \n     public void setExp(int newexp) {"}, {"sha": "005f2656042e787e59dd798c38f9e4c445ab10bf", "filename": "src/net/server/channel/handlers/MovePetHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/channel/handlers/MovePetHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/channel/handlers/MovePetHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MovePetHandler.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -21,7 +21,6 @@\n */\n package net.server.channel.handlers;\n \n-import net.server.channel.handlers.AbstractMovementPacketHandler;\n import java.util.List;\n import client.MapleCharacter;\n import client.MapleClient;\n@@ -30,6 +29,7 @@\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class MovePetHandler extends AbstractMovementPacketHandler {\n+    @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         int petId = slea.readInt();\n         slea.readLong();"}, {"sha": "e5fdaedef7f8ebba02b39376690b740ed6bf5615", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -191,6 +191,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             } else {\n                 playerGuild.getMGC(player.getId()).setCharacter(player);\n                 player.setMGC(playerGuild.getMGC(player.getId()));\n+                \n                 server.setGuildMemberOnline(player, true, c.getChannel());\n                 c.announce(MaplePacketCreator.showGuildInfo(player));\n                 int allianceId = player.getGuild().getAllianceId();\n@@ -204,6 +205,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             player.getGuild().setAllianceId(0);\n                         }\n                     }\n+                    \n                     if (newAlliance != null) {\n                         c.announce(MaplePacketCreator.updateAllianceInfo(newAlliance, c));\n                         c.announce(MaplePacketCreator.allianceNotice(newAlliance.getId(), newAlliance.getNotice()));\n@@ -267,11 +269,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         if (player.getMap().getHPDec() > 0) {\n             final MapleCharacter mc = player;\n             \n-            ScheduledFuture<?> hpDecreaseTask = TimerManager.getInstance().schedule(new Runnable() {\n-            @Override\n-            public void run() {\n-                mc.doHurtHp();\n-            }\n+            TimerManager.getInstance().schedule(new Runnable() {\n+                @Override\n+                public void run() {\n+                    mc.doHurtHp();\n+                }\n             }, 10000);\n         }\n     }"}, {"sha": "b8448ab87d2c68a882706301209957f3dc5c7b9c", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -194,6 +194,8 @@ public MapleFamily getFamily(int id) {\n     }\n \n     public MapleGuild getGuild(MapleGuildCharacter mgc) {\n+        if(mgc == null) return null;\n+        \n         int gid = mgc.getGuildId();\n         MapleGuild g;\n         g = Server.getInstance().getGuild(gid, mgc.getWorld(), mgc.getCharacter());"}, {"sha": "4d5a7b3bbd629369f901f11b6b31c6e5aae40536", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -943,7 +943,10 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n                 if (applyto.getMount() == null) {\n                     applyto.mount(ridingLevel, sourceid);\n                 }\n-                applyto.getMount().startSchedule();\n+                \n+                if(!(ServerConstants.PETS_NEVER_HUNGRY || applyto.isGM() && ServerConstants.GM_PETS_NEVER_HUNGRY)) {\n+                    applyto.getMount().startSchedule();\n+                }\n             }\n             if (sourceid == Corsair.BATTLE_SHIP) {\n                 givemount = new MapleMount(applyto, 1932000, sourceid);"}, {"sha": "e0b14e5a87f2cfe2e9b05e4ae4b7417618f6f89f", "filename": "src/server/MapleTrade.java", "status": "modified", "additions": 27, "deletions": 15, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/MapleTrade.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/MapleTrade.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleTrade.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -26,25 +26,27 @@\n import java.util.LinkedList;\n import java.util.List;\n import java.util.Map;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n import tools.LogHelper;\n import tools.MaplePacketCreator;\n import client.MapleCharacter;\n import client.inventory.Item;\n import client.inventory.MapleInventoryType;\n import constants.ItemConstants;\n+import constants.ServerConstants;\n \n /**\n  *\n- * @author Matze\n+ * @author Matze, Ronan (concurrency safety)\n  */\n public class MapleTrade {\n     private MapleTrade partner = null;\n     private List<Item> items = new ArrayList<>();\n     private List<Item> exchangeItems;\n     private int meso = 0;\n     private int exchangeMeso;\n-    boolean locked = false;\n+    private AtomicBoolean locked = new AtomicBoolean(false);\n     private MapleCharacter chr;\n     private byte number;\n     private boolean fullTrade = false;\n@@ -73,7 +75,7 @@ private static int getFee(int meso) {\n     }\n \n     private void lock() {\n-        locked = true;\n+        locked.set(true);\n         partner.getChr().getClient().announce(MaplePacketCreator.getTradeConfirmation());\n     }\n \n@@ -83,16 +85,18 @@ private void complete1() {\n     }\n \n     private void complete2() {\n+        boolean show = ServerConstants.USE_DEBUG;\n+        \n         items.clear();\n         meso = 0;\n         for (Item item : exchangeItems) {\n             if ((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA) \n                 item.setFlag((byte) (item.getFlag() ^ ItemConstants.KARMA)); //items with scissors of karma used on them are reset once traded\n \n-            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, true);\n+            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, show);\n         }\n         if (exchangeMeso > 0) {\n-            chr.gainMeso(exchangeMeso - getFee(exchangeMeso), true, true, true);\n+            chr.gainMeso(exchangeMeso - getFee(exchangeMeso), show, true, show);\n         }\n         exchangeMeso = 0;\n         if (exchangeItems != null) {\n@@ -102,11 +106,13 @@ private void complete2() {\n     }\n \n     private void cancel() {\n+        boolean show = ServerConstants.USE_DEBUG;\n+        \n         for (Item item : items) {\n-            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, true);\n+            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, show);\n         }\n         if (meso > 0) {\n-            chr.gainMeso(meso, true, true, true);\n+            chr.gainMeso(meso, show, true, show);\n         }\n         meso = 0;\n         if (items != null) {\n@@ -120,15 +126,15 @@ private void cancel() {\n     }\n \n     private boolean isLocked() {\n-        return locked;\n+        return locked.get();\n     }\n \n     private int getMeso() {\n         return meso;\n     }\n \n     public void setMeso(int meso) {\n-        if (locked) {\n+        if (locked.get()) {\n             throw new RuntimeException(\"Trade is locked.\");\n         }\n         if (meso < 0) {\n@@ -166,7 +172,7 @@ public MapleTrade getPartner() {\n     }\n \n     public void setPartner(MapleTrade partner) {\n-        if (locked) {\n+        if (locked.get()) {\n             return;\n         }\n         this.partner = partner;\n@@ -210,9 +216,15 @@ public static void completeTrade(MapleCharacter c) {\n         if (partner.isLocked()) {\n             local.complete1();\n             partner.complete1();\n-            if (!local.fitsInInventory() || !partner.fitsInInventory()) {\n+            if (!local.fitsInInventory()) {\n                 cancelTrade(c);\n                 c.message(\"There is not enough inventory space to complete the trade.\");\n+                partner.getChr().message(\"Partner does not have enough inventory space to complete the trade.\");\n+                return;\n+            }\n+            else if (!partner.fitsInInventory()) {\n+                cancelTrade(c);\n+                c.message(\"Partner does not have enough inventory space to complete the trade.\");\n                 partner.getChr().message(\"There is not enough inventory space to complete the trade.\");\n                 return;\n             }\n@@ -224,13 +236,13 @@ public static void completeTrade(MapleCharacter c) {\n                 } else {\n                     local.getChr().addMesosTraded(local.exchangeMeso);\n                 }\n-            } else if (c.getTrade().getChr().getLevel() < 15) {\n-                if (c.getMesosTraded() + c.getTrade().exchangeMeso > 1000000) {\n+            } else if (partner.getChr().getLevel() < 15) {\n+                if (partner.getChr().getMesosTraded() + partner.exchangeMeso > 1000000) {\n                     cancelTrade(c);\n-                    c.getClient().announce(MaplePacketCreator.serverNotice(1, \"Characters under level 15 may not trade more than 1 million mesos per day.\"));\n+                    partner.getChr().getClient().announce(MaplePacketCreator.serverNotice(1, \"Characters under level 15 may not trade more than 1 million mesos per day.\"));\n                     return;\n                 } else {\n-                    c.addMesosTraded(local.exchangeMeso);\n+                    partner.getChr().addMesosTraded(partner.exchangeMeso);\n                 }\n             }\n             LogHelper.logTrade(local, partner);"}, {"sha": "66ebf72c6d962a2ce5637189f0a9f34547b82c6c", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -46,7 +46,7 @@\n \n     private static Map<Integer, MapleQuest> quests = new HashMap<>();\n     protected short infoNumber, id;\n-    protected int timeLimit, timeLimit2;\n+    protected int timeLimit;\n     protected String infoex;\n     protected Map<MapleQuestRequirementType, MapleQuestRequirement> startReqs = new EnumMap<>(MapleQuestRequirementType.class);\n     protected Map<MapleQuestRequirementType, MapleQuestRequirement> completeReqs = new EnumMap<>(MapleQuestRequirementType.class);\n@@ -57,20 +57,22 @@\n     private boolean autoPreComplete, autoComplete;\n     private boolean repeatable = false;\n     private final static MapleDataProvider questData = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Quest.wz\"));\n-\tprivate static MapleData questInfo;\n-\tprivate static MapleData questAct;\n-\tprivate static MapleData questReq;\n+    private static MapleData questInfo;\n+    private static MapleData questAct;\n+    private static MapleData questReq;\n \t\n     private MapleQuest(int id) {\n         this.id = (short) id;\n \n-\t\tif(questInfo != null) {\n-\t\t\ttimeLimit = MapleDataTool.getInt(\"timeLimit\", questInfo, 0);\n-\t\t\ttimeLimit2 = MapleDataTool.getInt(\"timeLimit2\", questInfo, 0);\n-\t\t\tautoStart = MapleDataTool.getInt(\"autoStart\", questInfo, 0) == 1;\n-\t\t\tautoPreComplete = MapleDataTool.getInt(\"autoPreComplete\", questInfo, 0) == 1;\n-\t\t\tautoComplete = MapleDataTool.getInt(\"autoComplete\", questInfo, 0) == 1;\n-\t\t}\n+        if(questInfo != null) {\n+            MapleData reqData = questInfo.getChildByPath(String.valueOf(id));\n+            \n+            timeLimit = MapleDataTool.getInt(\"timeLimit\", reqData, 0);\n+            timeLimit = Math.max(timeLimit, MapleDataTool.getInt(\"timeLimit2\", reqData, 0));  // alas, nexon made we deal with 2 timeLimits\n+            autoStart = MapleDataTool.getInt(\"autoStart\", reqData, 0) == 1;\n+            autoPreComplete = MapleDataTool.getInt(\"autoPreComplete\", reqData, 0) == 1;\n+            autoComplete = MapleDataTool.getInt(\"autoComplete\", reqData, 0) == 1;\n+        }\n \t\t\n         MapleData reqData = questReq.getChildByPath(String.valueOf(id));\n         if (reqData == null) {//most likely infoEx\n@@ -84,7 +86,7 @@ private MapleQuest(int id) {\n                     repeatable = true;\n                 }\n \t\t\t\t\n-\t\t\t\tif (type.equals(MapleQuestRequirementType.INFO_NUMBER)) {\n+                if (type.equals(MapleQuestRequirementType.INFO_NUMBER)) {\n                     infoNumber = (short) MapleDataTool.getInt(startReq, 0);\n                 }\n \t\t\t\t\n@@ -280,11 +282,9 @@ public boolean forceStart(MapleCharacter c, int npc) {\n         newStatus.setForfeited(c.getQuest(this).getForfeited());\n \n         if (timeLimit > 0) {\n-            c.questTimeLimit(this, 30000);//timeLimit * 1000\n-        }\n-        if (timeLimit2 > 0) {//=\\\n-\n+            c.questTimeLimit(this, timeLimit);\n         }\n+        \n         c.updateQuest(newStatus);\n         return true;\n     }"}, {"sha": "1a08a5fe142ee93a6e83a95fa1cd7cc49ba588a0", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -2337,16 +2337,18 @@ private static int doubleToShortBits(double d) {\n                 mplew.write(chr.getMarriageRing() != null ? 1 : 0);\n                 String guildName = \"\";\n                 String allianceName = \"\";\n-                MapleGuildSummary gs = chr.getClient().getWorldServer().getGuildSummary(chr.getGuildId(), chr.getWorld());\n-                if (chr.getGuildId() > 0 && gs != null) {\n-                        guildName = gs.getName();\n-                        MapleAlliance alliance = Server.getInstance().getAlliance(gs.getAllianceId());\n+                if (chr.getGuildId() > 0) {\n+                        MapleGuild mg = Server.getInstance().getGuild(chr.getGuildId());\n+                        guildName = mg.getName();\n+                        \n+                        MapleAlliance alliance = Server.getInstance().getAlliance(chr.getGuild().getAllianceId());\n                         if (alliance != null) {\n                                 allianceName = alliance.getName();\n                         }\n                 }\n                 mplew.writeMapleAsciiString(guildName);\n-                mplew.writeMapleAsciiString(allianceName);\n+                mplew.writeMapleAsciiString(allianceName);  // does not seems to work\n+                \n                 mplew.write(0);\n                 MaplePet[] pets = chr.getPets();\n                 Item inv = chr.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -114);"}, {"sha": "5a5d29817606ea0fecfb9e09a77b22dc681aae69", "filename": "todo.txt", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/todo.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/d0396e4c363f2c68e3f610424c250e9d2ec2a2e0/todo.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/todo.txt?ref=d0396e4c363f2c68e3f610424c250e9d2ec2a2e0", "patch": "@@ -1,2 +1 @@\n-guild npc\n PQs\n\\ No newline at end of file"}]}]},
