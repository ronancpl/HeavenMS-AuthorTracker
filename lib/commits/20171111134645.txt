{"fetchDate": "2019-12-19", "content": [{"sha": "fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ZmQwMzQ3MWVjMDkxMWE4OGEwY2E3MDE2N2YzZmUzNjJlNzJlYTBmYg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-11-11T13:46:45Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-11-11T13:46:45Z"}, "message": "DB Tables Optimization\n\nReconsidered the use of MyISAM. Due to the old nature of the version of MySQL being used (5.1), the use of MyISAM on ROM-like tables makes it optimal since the table locks occurs only upon write.\nAdded indexes on several tables, thus improving data reading by queries.", "tree": {"sha": "d55e38af72559308f793e271d601f26ed02ed0a9", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/d55e38af72559308f793e271d601f26ed02ed0a9"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "html_url": "https://github.com/ronancpl/HeavenMS/commit/fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c46ff8292965354f33105fa17511dbf7af3cfc7b", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c46ff8292965354f33105fa17511dbf7af3cfc7b", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c46ff8292965354f33105fa17511dbf7af3cfc7b"}], "stats": {"total": 74, "additions": 41, "deletions": 33}, "files": [{"sha": "5e95145299a20237c9709342c81b23b874965bab", "filename": "docs/feature_list.txt", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/docs/feature_list.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/docs/feature_list.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.txt?ref=fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "patch": "@@ -18,17 +18,17 @@ Feature list:\n ---------------------------\n \n PQs:\n-* HPQ/KPQ/LPQ/LMPQ/OPQ/EllinPQ/PiratePQ/MagatiaPQ/HorntailPQ/AmoriaPQ 100%.\n-* CWKPQ as Expedition-based event 100%.\n-* Expeditions: Scarga/Horntail/Showa/Zakum/Pinkbean 100%.\n+* HPQ/KPQ/LPQ/LMPQ/OPQ/EllinPQ/PiratePQ/MagatiaPQ/HorntailPQ/AmoriaPQ.\n+* CWKPQ as Expedition-based event.\n+* Expeditions: Scarga/Horntail/Showa/Zakum/Pinkbean.\n * GuildPQ 100% + Guild queue with multi-lobby systems available.\n-* Brand-new PQs: BossRushPQ, CafePQ 100%.\n-* Mu Lung Dojo 100%.\n+* Brand-new PQs: BossRushPQ, CafePQ.\n+* Mu Lung Dojo.\n * BalrogPQ semi-functional.\n * Capt. Latanica remade as an event (parties can now fight the boss).\n \n Quests:\n-* Doll house quest 100%.\n+* Doll house quest functional.\n * Quests can now reward properly items when matching a reward item with the player's job.\n * Loads of quests have been patched.\n * Quest rewards according to jobs works properly.\n@@ -39,7 +39,7 @@ Player Social Network:\n * Beginners can create and join a \"beginner-only\" party (characters up to level 10).\n \n Cash & Items:\n-* EXP/DROP/Cosmetic Coupons 100%.\n+* EXP/DROP/Cosmetic Coupons.\n * EXP/DROP coupons now appears as a buff effect when on active time.\n * Great deal of cash items functional.\n * New scroll: antibanish. For use only in cases where bosses send a player back to town.\n@@ -66,26 +66,26 @@ PQ potentials:\n * EIM Pool system - After the first instance setup, next event instances are loaded beforehand and set on a pooling queue, optimizing future loadouts.\n \n Player potentials:\n-* Adventurer Mount quests 100%.\n+* Adventurer Mount quests functional.\n * All Equipment levels up.\n * Player level rates.\n * Gain fame by quests.\n \n Server potentials:\n-* Multi-worlds 100%.\n+* Multi-worlds.\n * Inventory auto-gather and auto-sorting feature.\n * Enhanced auto-pot system: pet uses as many potions as necessary to reach the desired threshold.\n * Enhanced buff system: smartly checks for the best available buff effects to be active on the player.\n * Enhanced AP auto-assigner: exactly matches AP with the needed for the player's current level, surplus assigned to the primary attribute.\n * Mastery book announcer displays droppers of needed books of a player, by reading underlying DB.\n * Custom jail system (needs provided custom wz).\n-* Delete Character 100% (requires ENABLE_PIC activated).\n+* Delete Character (requires ENABLE_PIC activated).\n * Autosaver (periodically saves on DB current state of every player in-game).\n * Both fixed and randomized versions of HP/MP growth rate available, regarding player job (enable one at ServerConstants). Placeholder for HP/MP washing feature.\n \n Admin/GM commands:\n * Server commands layered by GM levels.\n-* Spawn Zakum/Horntail/Pinkbean 100%.\n+* Spawn Zakum/Horntail/Pinkbean.\n * New commands.\n \n External tools:"}, {"sha": "f653368439f3cf69025b6d40bd6cc1b12d613638", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "patch": "@@ -656,7 +656,7 @@ Revisto acesso concorrente sobre o componente EM da classe EIM.\n Refatorado esquema de schedules por toda a source, diminuindo drasticamente as chamadas ao TimerManager.\n Refatorado algumas chamadas \ufffd DB, busca somente aquilo que \ufffd necess\ufffdrio.\n \n-08 - 09 Novembro 2017,\n+08 - 10 Novembro 2017,\n Adicionado packet para extra slot pendant.\n Corrigido poss\ufffdvel bug em MapleMapFactory.\n-Modificado todas as DB tables agora utilizando InnoDB (ganhos do MyISAM em contraste se tornou \ufffdnfimo, para casos cr\ufffdticos).\n\\ No newline at end of file\n+Otimizado tabelas do SQL agora utilizando \ufffdndices, promovendo queries mais r\ufffdpidas, e uso do MyISAM somente em casos onde sabe-se que as tabelas s\ufffdo \"somente leitura\".\n\\ No newline at end of file"}, {"sha": "694b48911fed46775ed1eba4c656ac1301c60013", "filename": "sql/db_database.sql", "status": "modified", "additions": 24, "deletions": 17, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "patch": "@@ -45,7 +45,9 @@ CREATE TABLE IF NOT EXISTS `accounts` (\n   `hwid` varchar(12) NOT NULL DEFAULT '',\n   PRIMARY KEY (`id`),\n   UNIQUE KEY `name` (`name`),\n-  KEY `ranking1` (`id`,`banned`,`gm`)\n+  KEY `ranking1` (`id`,`banned`,`gm`),\n+  INDEX (id, name),\n+  INDEX (id, nxCredit, maplePoint, nxPrepaid)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `alliance` (\n@@ -59,15 +61,16 @@ CREATE TABLE IF NOT EXISTS `alliance` (\n   `rank3` varchar(11) NOT NULL DEFAULT '',\n   `rank4` varchar(11) NOT NULL DEFAULT '',\n   `rank5` varchar(11) NOT NULL DEFAULT '',\n-  PRIMARY KEY (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+  PRIMARY KEY (`id`),\n+  INDEX (name)\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `allianceguilds` (\n   `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n   `allianceid` int(10) NOT NULL DEFAULT '-1',\n   `guildid` int(10) NOT NULL DEFAULT '-1',\n   PRIMARY KEY (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `area_info` (\n   `id` int(11) NOT NULL AUTO_INCREMENT,\n@@ -184,7 +187,9 @@ CREATE TABLE IF NOT EXISTS `characters` (\n   KEY `accountid` (`accountid`),\n   KEY `party` (`party`),\n   KEY `ranking1` (`level`,`exp`),\n-  KEY `ranking2` (`gm`,`job`)\n+  KEY `ranking2` (`gm`,`job`),\n+  INDEX (id, accountid, world),\n+  INDEX (id, accountid, name)\n ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 PACK_KEYS=0 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `cooldowns` (\n@@ -206,7 +211,7 @@ CREATE TABLE IF NOT EXISTS `temp_data` (\n   `chance` int(11) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`dropperid`, `itemid`),\n   KEY `mobid` (`dropperid`)\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=0 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=0 ;\n \n INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n (1, 9400121, 4000138, 1, 1, 0, 600000),\n@@ -12787,7 +12792,7 @@ CREATE TABLE IF NOT EXISTS `drop_data_global` (\n   `comments` varchar(45) DEFAULT NULL,\n   PRIMARY KEY (`id`),\n   KEY `mobid` (`continent`) USING BTREE\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC AUTO_INCREMENT=5 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC AUTO_INCREMENT=5 ;\n \n INSERT INTO `drop_data_global` (`id`, `continent`, `dropType`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`, `comments`) VALUES\n (1, 0, 0, 4031865, 1, 1, 0, 35000, 'NX Card 100 PTS'),\n@@ -12860,7 +12865,8 @@ CREATE TABLE IF NOT EXISTS `family_character` (\n   `name` varchar(255) NOT NULL,\n   `juniorsadded` int(11) NOT NULL,\n   `totalreputation` int(11) NOT NULL,\n-  PRIMARY KEY (`cid`)\n+  PRIMARY KEY (`cid`),\n+  INDEX (cid, familyid)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n \n CREATE TABLE IF NOT EXISTS `gifts` (\n@@ -12891,7 +12897,8 @@ CREATE TABLE IF NOT EXISTS `guilds` (\n   `notice` varchar(101) DEFAULT NULL,\n   `signature` int(11) NOT NULL DEFAULT '0',\n   `allianceId` int(11) unsigned NOT NULL DEFAULT '0',\n-  PRIMARY KEY (`guildid`)\n+  PRIMARY KEY (`guildid`),\n+  INDEX (guildid, name)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `hiredmerchant` (\n@@ -13045,7 +13052,7 @@ CREATE TABLE IF NOT EXISTS `makercreatedata` (\n   `quantity` smallint(6) NOT NULL,\n   `tuc` tinyint(3) NOT NULL,\n   PRIMARY KEY (`id`,`itemid`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1;\n \n INSERT INTO `makercreatedata` (`id`, `itemid`, `req_level`, `req_maker_level`, `req_meso`, `req_item`, `req_equip`, `catalyst`, `quantity`, `tuc`) VALUES\n (0, 2040727, 50, 1, 50000, 0, 1122013, 0, 1, 0),\n@@ -13884,7 +13891,7 @@ CREATE TABLE IF NOT EXISTS `makerrecipedata` (\n   `req_item` int(11) NOT NULL,\n   `count` smallint(6) NOT NULL,\n   PRIMARY KEY (`itemid`,`req_item`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1;\n \n INSERT INTO `makerrecipedata` (`itemid`, `req_item`, `count`) VALUES\n (1002022, 4007001, 5),\n@@ -15808,7 +15815,7 @@ CREATE TABLE IF NOT EXISTS `makerrewarddata` (\n   `quantity` smallint(6) NOT NULL,\n   `prob` tinyint(3) unsigned NOT NULL DEFAULT '100',\n   PRIMARY KEY (`itemid`,`rewardid`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1;\n \n INSERT INTO `makerrewarddata` (`itemid`, `rewardid`, `quantity`, `prob`) VALUES\n (4250000, 4250000, 1, 14),\n@@ -15937,7 +15944,7 @@ CREATE TABLE IF NOT EXISTS `monstercarddata` (\n   `mobid` int(11) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`id`) USING BTREE,\n   UNIQUE KEY `id` (`id`)\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=309 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=309 ;\n \n INSERT INTO `monstercarddata` (`id`, `cardid`, `mobid`) VALUES\n (1, 2380000, 100100),\n@@ -16323,7 +16330,7 @@ CREATE TABLE IF NOT EXISTS `nxcoupons` (\n   `starthour` int(11) NOT NULL DEFAULT '0',\n   `endhour` int(11) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=41 ;\n+) ENGINE=MyISAM DEFAULT CHARSET=latin1 AUTO_INCREMENT=41 ;\n \n INSERT INTO `nxcoupons` (`id`, `couponid`, `rate`, `activeday`, `starthour`, `endhour`) VALUES\n (1,5211000,2,254,18,20),\n@@ -16456,7 +16463,7 @@ CREATE TABLE IF NOT EXISTS `reactordrops` (\n   `questid` int(5) NOT NULL DEFAULT '-1',\n   PRIMARY KEY (`reactordropid`),\n   KEY `reactorid` (`reactorid`)\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 PACK_KEYS=1 AUTO_INCREMENT=841 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 PACK_KEYS=1 AUTO_INCREMENT=841 ;\n \n INSERT INTO `reactordrops` (`reactordropid`, `reactorid`, `itemid`, `chance`, `questid`) VALUES\n (1, 2001, 4031161, 1, 1008),\n@@ -17339,7 +17346,7 @@ CREATE TABLE IF NOT EXISTS `shopitems` (\n   `pitch` int(11) NOT NULL DEFAULT '0',\n   `position` int(11) NOT NULL COMMENT 'sort is an arbitrary field designed to give leeway when modifying shops. The lowest number is 104 and it increments by 4 for each item to allow decent space for swapping/inserting/removing items.',\n   PRIMARY KEY (`shopitemid`)\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=20047 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=20047 ;\n \n INSERT INTO `shopitems` (`shopitemid`, `shopid`, `itemid`, `price`, `pitch`, `position`) VALUES\n (1, 11000, 1332005, 500, 0, 104),\n@@ -20967,7 +20974,7 @@ CREATE TABLE IF NOT EXISTS `shops` (\n   `shopid` int(10) unsigned NOT NULL AUTO_INCREMENT,\n   `npcid` int(11) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`shopid`)\n-) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=10000000 ;\n+) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=10000000 ;\n \n INSERT INTO `shops` (`shopid`, `npcid`) VALUES\n (11000, 11000),"}, {"sha": "aa9bddafc4f614cdda06a53cf97cac45fe030e37", "filename": "sql/db_drops.sql", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/fd03471ec0911a88a0ca70167f3fe362e72ea0fb/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=fd03471ec0911a88a0ca70167f3fe362e72ea0fb", "patch": "@@ -19884,8 +19884,9 @@ USE `maplesolaxia`;\n     `chance` int(11) NOT NULL DEFAULT '0',\n     PRIMARY KEY (`id`),\n     UNIQUE KEY (`dropperid`, `itemid`),\n-    KEY `mobid` (`dropperid`)\n-  ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+    KEY `mobid` (`dropperid`),\n+    INDEX (dropperid, itemid)\n+  ) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n \t#pass (sorted) data from one table to another\n   INSERT INTO drop_data (dropperid, itemid, minimum_quantity, maximum_quantity, questid, chance)\n@@ -21223,7 +21224,7 @@ USE `maplesolaxia`;\n     `mobid` int(11) NOT NULL DEFAULT '0',\n     PRIMARY KEY (`id`) USING BTREE,\n     UNIQUE KEY `id` (`id`)\n-  ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+  ) ENGINE=MyISAM  DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n   INSERT INTO `monstercarddata` (`cardid`, `mobid`) (SELECT itemid, min(dropperid) FROM drop_data where itemid>=2380000 and itemid<2390000 group by itemid);\n "}]}]},
