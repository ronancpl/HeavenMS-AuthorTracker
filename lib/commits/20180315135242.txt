{"fetchDate": "2019-12-19", "content": [{"sha": "ae147a5a9f28513322509b7c9f67ba885b780a40", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YWUxNDdhNWE5ZjI4NTEzMzIyNTA5YjdjOWY2N2JhODg1Yjc4MGE0MA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-15T13:52:42Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-03-15T13:52:42Z"}, "message": "HT spawn sequence + Banner length\n\nImproved the Horntail spawn sequence to better fit the end of the animation with the HT parts assembly. Thanks to Arnah and Zenns.\nImproved the usage of visual space by the \"hint banners\" throughout the source.", "tree": {"sha": "9b297bb8f3499faed0c4ca03156cb3355b146a7b", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/9b297bb8f3499faed0c4ca03156cb3355b146a7b"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/ae147a5a9f28513322509b7c9f67ba885b780a40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ae147a5a9f28513322509b7c9f67ba885b780a40", "html_url": "https://github.com/ronancpl/HeavenMS/commit/ae147a5a9f28513322509b7c9f67ba885b780a40", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ae147a5a9f28513322509b7c9f67ba885b780a40/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67ab83a09b2e6db0bbe0a9a8b05e2ebd222a690d", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/67ab83a09b2e6db0bbe0a9a8b05e2ebd222a690d", "html_url": "https://github.com/ronancpl/HeavenMS/commit/67ab83a09b2e6db0bbe0a9a8b05e2ebd222a690d"}], "stats": {"total": 168, "additions": 105, "deletions": 63}, "files": [{"sha": "2a056ae0c5435845c7811bceb68546f7c0576636", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -825,4 +825,8 @@ Nova PQ: TreasurePQ, level 140+, acess\u00edvel via portal em NLC.\n \n 08 Mar\u00e7o 2018,\n Corrigido levelup contabilizando o stat INT nos ganhos de MP mesmo quando a flag USE_RANDOMIZE_HPMP_GAIN est\u00e1 desativada.\n-Aprimorado comando de item/drop agora permitindo gerar pets.\n\\ No newline at end of file\n+Aprimorado comando de item/drop agora permitindo gerar pets.\n+\n+14 Mar\u00e7o 2018,\n+Modificado spawn do Horntail, utilizando efeitos de mob ao inv\u00e9s de schedules. Cortesia de Arnah e Zenns.\n+Modificado \"hint\" banners para usar menor espa\u00e7o visual.\n\\ No newline at end of file"}, {"sha": "46017e597d7bda9c9ed163d95385821f9a7ae1a7", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -1496,7 +1496,7 @@ public final void pickupItem(MapleMapObject ob, int petIndex) {     // yes, one\n                             int nxGain = mapitem.getItemId() == 4031865 ? 100 : 250;\n                             this.getCashShop().gainCash(1, nxGain);\n                             \n-                            showHint(\"You have earned #e#b\" + nxGain + \" NX#k#n. (\" + this.getCashShop().getCash(1) + \" NX)\");\n+                            showHint(\"You have earned #e#b\" + nxGain + \" NX#k#n. (\" + this.getCashShop().getCash(1) + \" NX)\", 300);\n                             \n                             this.getMap().pickItemDrop(pickupPacket, mapitem);\n                         } else if (MapleInventoryManipulator.addFromDrop(client, mapitem.getItem(), true)) {\n@@ -1573,7 +1573,7 @@ public final void pickupItem(MapleMapObject ob, int petIndex) {     // yes, one\n                         int nxGain = mapitem.getItemId() == 4031865 ? 100 : 250;\n                         this.getCashShop().gainCash(1, nxGain);\n                         \n-                        showHint(\"You have earned #e#b\" + nxGain + \" NX#k#n. (\" + this.getCashShop().getCash(1) + \" NX)\");\n+                        showHint(\"You have earned #e#b\" + nxGain + \" NX#k#n. (\" + this.getCashShop().getCash(1) + \" NX)\", 300);\n                     } else if (useItem(client, mapitem.getItem().getItemId())) {\n                         if (mapitem.getItem().getItemId() / 10000 == 238) {\n                             this.getMonsterBook().addCard(client, mapitem.getItem().getItemId());\n@@ -4939,7 +4939,7 @@ public void levelUp(boolean takeexp) {\n             if(this.isPartyLeader()) party.assignNewLeader(client);\n             PartyOperationHandler.leaveParty(party, mpc, client);\n             \n-            client.announceHint(\"You have reached #blevel 10#k, therefore you must leave your #rstarter party#k.\");\n+            showHint(\"You have reached #blevel 10#k, therefore you must leave your #rstarter party#k.\");\n         }\n         \n         if (this.guildid > 0) {\n@@ -7238,7 +7238,11 @@ public void showUnderleveledInfo(MapleMonster mob) {\n     }\n     \n     public void showHint(String msg) {\n-        client.announceHint(msg);\n+        showHint(msg, 500);\n+    }\n+    \n+    public void showHint(String msg, int length) {\n+        client.announceHint(msg, length);\n     }\n     \n     public void showNote() {\n@@ -7993,7 +7997,7 @@ public void showAllEquipFeatures() {\n         }\n         \n         if(!showMsg.isEmpty()) {\n-            this.showHint(\"#ePLAYER EQUIPMENTS:#n\\r\\n\\r\\n\" + showMsg);\n+            this.showHint(\"#ePLAYER EQUIPMENTS:#n\\r\\n\\r\\n\" + showMsg, 400);\n         }\n     }\n "}, {"sha": "112fbb2571cea0acfb2463c6d4603a83a34f1ea5", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -1258,8 +1258,8 @@ public synchronized void announce(final byte[] packet) {//MINA CORE IS A FUCKING\n \t\tsession.write(packet);\n \t}\n \n-        public void announceHint(String msg) {\n-                announce(MaplePacketCreator.sendHint(msg, 500, 10));\n+        public void announceHint(String msg, int length) {\n+                announce(MaplePacketCreator.sendHint(msg, length, 10));\n                 announce(MaplePacketCreator.enableActions());\n         }\n "}, {"sha": "e31f487529f3dde8a67688360639b1b16b31a545", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -355,9 +355,9 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n                 case \"droplimit\":\n                         int dropCount = c.getPlayer().getMap().getDroppedItemCount();\n                         if(((float) dropCount) / ServerConstants.ITEM_LIMIT_ON_MAP < 0.75f) {\n-                            c.getPlayer().showHint(\"Current drop count: #b\" + dropCount + \"#k / #e\" + ServerConstants.ITEM_LIMIT_ON_MAP + \"#n\");\n+                            c.getPlayer().showHint(\"Current drop count: #b\" + dropCount + \"#k / #e\" + ServerConstants.ITEM_LIMIT_ON_MAP + \"#n\", 300);\n                         } else {\n-                            c.getPlayer().showHint(\"Current drop count: #r\" + dropCount + \"#k / #e\" + ServerConstants.ITEM_LIMIT_ON_MAP + \"#n\");\n+                            c.getPlayer().showHint(\"Current drop count: #r\" + dropCount + \"#k / #e\" + ServerConstants.ITEM_LIMIT_ON_MAP + \"#n\", 300);\n                         }\n                         \n                         break;\n@@ -523,7 +523,7 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n                             showMsg += \"Server QUEST Rate: #e#b\" + c.getWorldServer().getQuestRate() + \"x#k#n\" + \"\\r\\n\";\n                         }\n                         \n-                        player.showHint(showMsg);\n+                        player.showHint(showMsg, 300);\n                     break;\n                      \n                 case \"rates\":\n@@ -533,7 +533,7 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n                         showMsg_ += \"DROP Rate: #e#b\" + player.getDropRate() + \"x#k#n\" + \"\\r\\n\";\n                         if(ServerConstants.USE_QUEST_RATE) showMsg_ += \"QUEST Rate: #e#b\" + c.getWorldServer().getQuestRate() + \"x#k#n\" + \"\\r\\n\";\n                         \n-                        player.showHint(showMsg_);\n+                        player.showHint(showMsg_, 300);\n                     break;\n                     \n \t\tcase \"online\":\n@@ -1970,8 +1970,9 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\t\t\tplayer.dropMessage(6, s.substring(0, s.length() - 2));\n \t\t\t\t}\n \t\t\t}\n-\t\t\tplayer.dropMessage(6, \"There are a total of \" + total + \" players online.\");\n-                        player.showHint(\"Players online: #e#r\" + total + \"#k#n.\");\n+\t\t\t\n+                        //player.dropMessage(6, \"There are a total of \" + total + \" players online.\");\n+                        player.showHint(\"Players online: #e#r\" + total + \"#k#n.\", 300);\n                     break;\n        \n \t\tcase \"warpsnowball\":"}, {"sha": "765dce1e83f6208d221c1f40b51912cff4284356", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -553,7 +553,7 @@ public String showEquipFeatures(MapleClient c) {\n     }\n \n     public final void showLevelupMessage(String msg, MapleClient c) {\n-        c.getPlayer().showHint(msg);\n+        c.getPlayer().showHint(msg, 300);\n     }\n     \n     public void setItemExp(int exp) {"}, {"sha": "cfb19f11a3ee126770aa8a4d42a507f68e36c825", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -84,6 +84,7 @@\n     private Map<Pair<Integer, Integer>, Integer> skillsUsed = new HashMap<>();\n     private List<Integer> stolenItems = new ArrayList<>();\n     private int team;\n+    private int parentMobOid = 0;\n     private final HashMap<Integer, AtomicInteger> takenDamage = new HashMap<>();\n \n     private Lock externalLock = new MonitoredReentrantLock(MonitoredLockType.MOB_EXT);\n@@ -128,6 +129,14 @@ public boolean dropsDisabled() {\n     public void setMap(MapleMap map) {\n         this.map = map;\n     }\n+    \n+    public int getParentMobOid() {\n+        return parentMobOid;\n+    }\n+\n+    public void setParentMobOid(int parentMobId) {\n+        this.parentMobOid = parentMobId;\n+    }\n \n     public int getHp() {\n         return hp.get();\n@@ -497,6 +506,9 @@ public void run() {\n                         for (Integer mid : toSpawn) {\n                             final MapleMonster mob = MapleLifeFactory.getMonster(mid);\n                             mob.setPosition(getPosition());\n+                            mob.setFh(getFh());\n+                            mob.setParentMobOid(getObjectId());\n+                            \n                             if (dropsDisabled()) {\n                                 mob.disableDrops();\n                             }"}, {"sha": "36491eb7cd8a9b90bcd941e37487d776d115219a", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 37, "deletions": 39, "changes": 76, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -3534,50 +3534,48 @@ public boolean isHorntailDefeated() {   // all parts of dead horntail can be fou\n     }\n     \n     public void spawnHorntailOnGroundBelow(final Point targetPoint) {   // ayy lmao\n-        spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8810026), targetPoint);\n-        TimerManager.getInstance().schedule(new Runnable() {\n+        MapleMonster htIntro = MapleLifeFactory.getMonster(8810026);\n+        spawnMonsterOnGroundBelow(htIntro, targetPoint);\n+        \n+        final MapleMonster ht = MapleLifeFactory.getMonster(8810018);\n+        ht.setParentMobOid(htIntro.getObjectId());\n+        ht.addListener(new MonsterListener() {\n             @Override\n-            public void run() {\n-                final MapleMonster ht = MapleLifeFactory.getMonster(8810018);\n-                ht.addListener(new MonsterListener() {\n-                    @Override\n-                    public void monsterKilled(int aniTime) {}\n+            public void monsterKilled(int aniTime) {}\n \n-                    @Override\n-                    public void monsterDamaged(MapleCharacter from, int trueDmg) {\n-                        ht.addHp(trueDmg);\n-                    }\n+            @Override\n+            public void monsterDamaged(MapleCharacter from, int trueDmg) {\n+                ht.addHp(trueDmg);\n+            }\n \n-                    @Override\n-                    public void monsterHealed(int trueHeal) {\n-                        ht.addHp(-trueHeal);\n-                    }\n-                });\n-                spawnMonsterOnGroundBelow(ht, targetPoint);\n-                \n-                for (int x = 8810002; x <= 8810009; x++) {\n-                    MapleMonster m = MapleLifeFactory.getMonster(x);\n-                    \n-                    m.addListener(new MonsterListener() {\n-                        @Override\n-                        public void monsterKilled(int aniTime) {}\n-\n-                        @Override\n-                        public void monsterDamaged(MapleCharacter from, int trueDmg) {\n-                            ht.applyAndGetHpDamage(trueDmg, true);\n-                            ht.broadcastMobHpBar(from);\n-                        }\n+            @Override\n+            public void monsterHealed(int trueHeal) {\n+                ht.addHp(-trueHeal);\n+            }\n+        });\n+        spawnMonsterOnGroundBelow(ht, targetPoint);\n \n-                        @Override\n-                        public void monsterHealed(int trueHeal) {\n-                            ht.addHp(trueHeal);\n-                        }\n-                    });\n-                    \n-                    spawnMonsterOnGroundBelow(m, targetPoint);\n+        for (int x = 8810002; x <= 8810009; x++) {\n+            MapleMonster m = MapleLifeFactory.getMonster(x);\n+            m.setParentMobOid(htIntro.getObjectId());\n+\n+            m.addListener(new MonsterListener() {\n+                @Override\n+                public void monsterKilled(int aniTime) {}\n+\n+                @Override\n+                public void monsterDamaged(MapleCharacter from, int trueDmg) {\n+                    ht.applyAndGetHpDamage(trueDmg, true);\n+                    ht.broadcastMobHpBar(from);\n                 }\n-            }\n \n-        }, 5 * 1000);\n+                @Override\n+                public void monsterHealed(int trueHeal) {\n+                    ht.addHp(trueHeal);\n+                }\n+            });\n+\n+            spawnMonsterOnGroundBelow(m, targetPoint);\n+        }\n     }\n }"}, {"sha": "2147bd2173ef69131a857c8c5556f720a1a294a9", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 32, "deletions": 9, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ae147a5a9f28513322509b7c9f67ba885b780a40/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ae147a5a9f28513322509b7c9f67ba885b780a40/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=ae147a5a9f28513322509b7c9f67ba885b780a40", "patch": "@@ -1428,18 +1428,41 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.write(life.getStance());\n                 mplew.writeShort(0); //Origin FH //life.getStartFh()\n                 mplew.writeShort(life.getFh());\n-\n-                if (effect > 0) {\n-                        mplew.write(effect);\n-                        mplew.write(0);\n-                        mplew.writeShort(0);\n-                        if (effect == 15) {\n-                                mplew.write(0);\n+                \n+                \n+                /**\n+        \t\t * -4: Fake\n+        \t\t * -3: Appear after linked mob is dead\n+        \t\t * -2: Fade in\n+        \t\t * 1: Smoke\n+        \t\t * 3: King Slime spawn\n+        \t\t * 4: Summoning rock thing, used for 3rd job?\n+        \t\t * 6: Magical shit\n+        \t\t * 7: Smoke shit\n+        \t\t * 8: 'The Boss'\n+        \t\t * 9/10: Grim phantom shit?\n+        \t\t * 11/12: Nothing?\n+        \t\t * 13: Frankenstein\n+        \t\t * 14: Angry ^\n+        \t\t * 15: Orb animation thing, ??\n+        \t\t * 16: ??\n+        \t\t * 19: Mushroom kingdom boss thing\n+        \t\t */\n+                \n+                if (life.getParentMobOid() != 0) {\n+                        MapleMonster parentMob = life.getMap().getMonsterByOid(life.getParentMobOid());\n+                        if(parentMob != null && parentMob.isAlive()) {\n+                                mplew.write(effect != 0 ? effect : -3);\n+                                mplew.writeInt(life.getParentMobOid());\n+                        } else {\n+                                mplew.write(newSpawn ? -2 : -1);\n                         }\n+                } else {\n+                \tmplew.write(newSpawn ? -2 : -1);\n                 }\n-                mplew.write(newSpawn ? -2 : -1);\n+                \n                 mplew.write(life.getTeam());\n-                mplew.writeInt(0);\n+                mplew.writeInt(0); // getItemEffect\n                 return mplew.getPacket();\n         }\n "}]}]},
