{"fetchDate": "2019-12-19", "content": [{"sha": "b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YjQ3ZGQwM2EzZTFiZTI4MzNiOWJlOGM2MjhhOWRhZDU3MjJmMTRlMg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-01-07T14:10:41Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-01-07T14:10:41Z"}, "message": "Client Timestamp update + Cosmetic NPCs & H Beacon patch + Log rework\n\nFixed Music command not playing soundtracks at all.\nFixed stylish scripts stucking player NPC interactions in certain cases.\nReviewed client mistimed view on items, quest expirations, BBS threads, etc.\nFixed Homing Beacon skill provoking autoflag in mobs with same objectid in different maps.\nSolved DB leak cases with removing pets from inventory.\nReviewed logging throughout the source, aiming to normalize the varied-spaced log content within the facilities.\nFixed a bug that would occur when trying to reaccess Horntail expedition.", "tree": {"sha": "ed5ae6429d6675359b008647443bfe2b437823ca", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/ed5ae6429d6675359b008647443bfe2b437823ca"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "35ea13420e18c939cf5749cbda53d951c4ccaf19", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/35ea13420e18c939cf5749cbda53d951c4ccaf19", "html_url": "https://github.com/ronancpl/HeavenMS/commit/35ea13420e18c939cf5749cbda53d951c4ccaf19"}], "stats": {"total": 1096, "additions": 511, "deletions": 585}, "files": [{"sha": "11c5760ce4fecc169d15f4a96027b94cf647a3b8", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -1530,4 +1530,20 @@ Corrigido comandos que transportam jogadores entre mapas n\u00e3o levando em conside\n \n 21 Dezembro 2018,\n Cosm\u00e9ticos j\u00e1 usados pelo jogador n\u00e3o est\u00e3o mais dispon\u00edveis nos estilistas/cirurgi\u00f5es.\n-Corrigido alguns itens est\u00e9ticos n\u00e3o sendo devidamente disponibilizados se jogadores usam algum cosm\u00e9tico de cor n\u00e3o-default.\n\\ No newline at end of file\n+Corrigido alguns itens est\u00e9ticos n\u00e3o sendo devidamente disponibilizados se jogadores usam algum cosm\u00e9tico de cor n\u00e3o-default.\n+\n+28 Dezembro 2018,\n+Corrigido um problema com comando Music, que n\u00e3o identificaria informa\u00e7\u00f5es das m\u00fasicas do jogo corretamente.\n+Corrigido scripts de NPC de cosm\u00e9ticos bloqueando dial\u00f3go de jogadores em certos casos.\n+\n+29 - 31 Dezembro 2018,\n+Resolvido envio de temporariza\u00e7\u00e3o descompassada pro cliente (quests, expira\u00e7\u00f5es de itens, BBS threads, etc).\n+Corrigido quests n\u00e3o registrando tempo de completude corretamente.\n+Corrigido mob Jesters utilizando autoaggro.\n+\n+03 - 06 Janeiro 2019,\n+Corrigido Homing Beacon skill provocando autoflag em mobs para jogadores que mudam de mapas, onde h\u00e1 mobs com mesmo objectid do mob alvejado anteriormente.\n+Resolvido casos onde pets equipados poderiam provocar inconsist\u00eancias na DB ao ser removido da aba de cash no invent\u00e1rio.\n+Revisado sistema de log por todo o c\u00f3digo-fonte. Espera-se uma formata\u00e7\u00e3o similar para os v\u00e1rios logs.\n+Corrigido pet excludes n\u00e3o sendo devidamente removidos ao retirar o pet da DB.\n+Corrigido bug na expedi\u00e7\u00e3o de Horntail ao tentar reentrar numa expedi\u00e7\u00e3o j\u00e1 come\u00e7ada.\n\\ No newline at end of file"}, {"sha": "8f3c7556430bcf2152a734397bcf9354c278fa97", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -237,7 +237,7 @@ function changedMap(eim, player, mapid) {\n function afterChangedMap(eim, player, mapid) {\n         if (mapid == 990000100) {\n                 var texttt = \"So, here is the brief. You guys should be warned that, once out on the fortress outskirts, anyone that would not be equipping the #b#t1032033##k will die instantly due to the deteriorated state of the air around there. That being said, once your team moves out, make sure to #bhit the glowing rocks#k in that region and #bequip the dropped item#k before advancing stages. That will protect you thoroughly from the air sickness. Good luck!\";\n-                player.getClient().announce(Packages.tools.MaplePacketCreator.getNPCTalk(9040000, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n+                player.getClient().getAbstractPlayerInteraction().npcTalk(9040000, texttt);\n         }\n }\n "}, {"sha": "f31c2cdb06a0909483885ed3fef415b3bcd4549b", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -88,7 +88,7 @@ function setEventRewards(eim) {\n function afterSetup(eim) {}\n \n function setup(channel) {\n-    var eim = em.newInstance(\"Scarga\" + channel);\n+    var eim = em.newInstance(\"Horntail\" + channel);     // thanks Thora for reporting an issue with misleading event name here\n     eim.setProperty(\"canJoin\", 1);\n     eim.setProperty(\"defeatedBoss\", 0);\n     eim.setProperty(\"defeatedHead\", 0);"}, {"sha": "2d11c2c409b815e3726d558e6280bba441201c07", "filename": "scripts/event/OrbisPQ.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/OrbisPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/event/OrbisPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/OrbisPQ.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -180,7 +180,7 @@ function playerEntry(eim, player) {\n         player.changeMap(map, map.getPortal(0));\n         \n         var texttt = \"Hi, my name is Eak, the Chamberlain of the Goddess. Don't be alarmed; you won't be able to see me right now. Back when the Goddess turned into a block of stone, I simultaneously lost my own power. If you gather up the power of the Magic Cloud of Orbis, however, then I'll be able to recover my body and re-transform back to my original self. Please collect #b20#k Magic Clouds and bring them back to me. Right now, you'll only see me as a tiny, flickering light.\";\n-        player.getClient().announce(Packages.tools.MaplePacketCreator.getNPCTalk(2013001, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n+        player.getClient().getAbstractPlayerInteraction().npcTalk(2013001, texttt);\n }\n \n function scheduledTimeout(eim) {"}, {"sha": "8f075f6ac7aa6d3c5a2aa8938306ad6c71af7fd3", "filename": "scripts/npc/1012104.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012104.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012104.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012104.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -45,13 +45,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "0e052b6ddc497ff45d01c3b6200f9a4afacd2f7b", "filename": "scripts/npc/1012105.js", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012105.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012105.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012105.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -32,14 +32,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-        if (mode == -1) {\n+        if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n                 cm.dispose();\n         } else {\n-                if (mode == 0 && type > 0) {\n-                        cm.dispose();\n-                        return;\n-                }\n-                \n                 if (mode == 1)\n                         status++;\n                 else"}, {"sha": "131f45b7f9e13b9d27b58207a7c4bdb428ea611b", "filename": "scripts/npc/1012117.js", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012117.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1012117.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012117.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -48,14 +48,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && type > 0) {\n-            cm.dispose();\n-            return;\n-        }\n-        \n         if (mode == 1)\n             status++;\n         else"}, {"sha": "7d2848bf59bbed830cc41690245361aedc7a389c", "filename": "scripts/npc/1052004.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052004.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -42,13 +42,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "2e7bd8e5b304b27615ef92824be298fcf57ce6da", "filename": "scripts/npc/1052005.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052005.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -42,13 +42,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "5be126551ffa5afad9fe57ed8bd77fd12ea9de08", "filename": "scripts/npc/1052100.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052100.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "53b5e393bad36aaaa46e0e2030e53bd7f374107b", "filename": "scripts/npc/1052101.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1052101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052101.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -45,13 +45,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "e08c21fb28d472e5843b4d1c7ac3ff45c73cde89", "filename": "scripts/npc/1101001.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1101001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/1101001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1101001.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -8,8 +8,10 @@ importPackage(Packages.constants);\n function start() {\n     if (cm.getPlayer().isCygnus() && GameConstants.getJobBranch(cm.getJob()) > 2) {\n         cm.useItem(2022458);\n+        cm.sendOk(\"Let me cast you my blessings, my Knight. Please protect the world of Maple....\");\n+    } else {\n+        cm.sendOk(\"Don't stop training. Every ounce of your energy is required to protect the world of Maple....\");\n     }\n     \n-    cm.sendOk(\"Don't stop training. Every ounce of your energy is required to protect the world of Maple....\");\n     cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "ed798b74fedbb2862c715d3263595da9d34229b6", "filename": "scripts/npc/2010001.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2010001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2010001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2010001.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "c9dd0e51360bb9bcd7a8b9b80e8404ff5dff8822", "filename": "scripts/npc/2010002.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2010002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2010002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2010002.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "bf7cdcb96cb4afef782843a5047f3ae6c14e555f", "filename": "scripts/npc/2012008.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2012008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2012008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012008.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -31,13 +31,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "7ecf6af85f19cb4f0577c83a41da17b2697ecd7e", "filename": "scripts/npc/2040019.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2040019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2040019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2040019.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "0cc2197a5d176033c29dd5903e954d01a0145e1a", "filename": "scripts/npc/2041007.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041007.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "af2cd7d99516cbac81fe7100cde661230b43c8f2", "filename": "scripts/npc/2041009.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041009.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -46,13 +46,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "adff60bdc94821906d778b15a63e0a74296274e4", "filename": "scripts/npc/2041010.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041010.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "16f85921dd0f6ff40756e76c7ea78769ccea37a4", "filename": "scripts/npc/2041013.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2041013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041013.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -29,13 +29,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n \t\tcm.dispose();\n \t} else {\n-\t\tif (mode == 0 && status == 0) {\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "60609facb3ea4f3c88fe083ffd891267b8353a86", "filename": "scripts/npc/2090100.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090100.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "92066c7c3e91792bd9c5b3ba34fe1d9b33f93bff", "filename": "scripts/npc/2090101.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090101.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "e1980b9840bdb40643809fe71344894ca13e90df", "filename": "scripts/npc/2090102.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090102.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -32,13 +32,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "e825cd60402e44774ea6da7505af86be45a0b308", "filename": "scripts/npc/2090103.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090103.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090103.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090103.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -51,13 +51,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "755f0d8d52b23bf556d691e3b6b79d53202ef658", "filename": "scripts/npc/2090104.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090104.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2090104.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090104.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -51,13 +51,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "015b847652d0290373b9aacf73dd38e6beb7cfee", "filename": "scripts/npc/2100005.js", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100005.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -24,14 +24,13 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n+                if (type == 7) {\n+                        cm.sendNext(\"I guess you aren't ready to make the change yet. Let me know when you are!\");\n+                }\n+                \n \t\tcm.dispose();\n \t} else {\n-\t\tif (mode == 0 && status >= 0) {\n-\t\t\tcm.sendNext(\"I guess you aren't ready to make the change yet. Let me know when you are!\");\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "5da564f95d69910454fc984d96cf6691c1508a7b", "filename": "scripts/npc/2100006.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100006.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -24,13 +24,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n \t\tcm.dispose();\n \t} else {\n-\t\tif (mode == 0 && status >= 0) {\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "55a32b25c3ea6efecffeb379be99d677eaaa538f", "filename": "scripts/npc/2100007.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100007.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -13,13 +13,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n \t\tcm.dispose();\n \t} else {\n-\t\tif (mode == 0 && status >= 0) {\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "9fac81c781fbbd8b75d03b14f27f228cc625fd90", "filename": "scripts/npc/2100008.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100008.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -34,13 +34,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n \t\tcm.dispose();\n \t} else {\n-\t\tif (mode == 0 && status == 0) {\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "181a396c8b3ea8f4b8e968d83a3d1bfbdd9b9710", "filename": "scripts/npc/2100009.js", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/2100009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100009.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -34,14 +34,13 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-\tif (mode == -1) {\n-\t\tcm.dispose();\n-\t} else {\n-\t\tif (mode == 0 && status == 0) {\n+\tif (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n+                if (type == 7) {\n \t\t\tcm.sendNext(\"I see...take your time, see if you really want it. Let me know when you make up your mind.\");\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n \t\t}\n+            \n+\t\tcm.dispose();\n+\t} else {\n \t\tif (mode == 1)\n \t\t\tstatus++;\n \t\telse"}, {"sha": "5533c582e16f993f23fcc9fad58196e8d6b7252b", "filename": "scripts/npc/9120100.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9120100.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "3a0dee60ddf1ef01bb411a657b049c384f22641b", "filename": "scripts/npc/9120101.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9120101.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "52b1e7d27ae1a7b24b815707ac2f245117ae98ef", "filename": "scripts/npc/9120102.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9120102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9120102.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -56,13 +56,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "85bc796f47c083c811de64ba06dde8757a36ece9", "filename": "scripts/npc/9200100.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9200100.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,15 +50,14 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0)\n-            cm.dispose();\n         if (mode == 1)\n             status++;\n         else\n             status--;\n+        \n         if (status == 0)\n             cm.sendSimple(\"Hi, there~! I'm Dr. Lenu, in charge of the cosmetic lenses here at the Henesys Plastic Surgery Shop! With #b#t5152010##k or #b#t5152013##k, you can let us take care of the rest and have the kind of beautiful look you've always craved~! Remember, the first thing everyone notices about you is the eyes, and we can help you find the cosmetic lens that most fits you! Now, what would you like to use?\\r\\n#L1#Cosmetic Lenses: #i5152010##t5152010##l\\r\\n#L2#Cosmetic Lenses: #i5152013##t5152013##l\\r\\n#L3#One-time Cosmetic Lenses: #i5152103# (any color)#l\");\n         else if (status == 1) {"}, {"sha": "99532c29b421f9b5f84d1cf893a3a34c6eaaabed", "filename": "scripts/npc/9200101.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9200101.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,13 +50,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "69386b776fa98263499124a8bb8f094226845099", "filename": "scripts/npc/9200102.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9200102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9200102.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,13 +50,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "3d3ade88b4c5c97ceea7139366b66c480cc25b94", "filename": "scripts/npc/9201015.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201015.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201015.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201015.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "1e05472a600e8616a344971346aff07db8518426", "filename": "scripts/npc/9201016.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201016.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "d3aa73dfafe1309a4ac737ef84a03d658e8e3275", "filename": "scripts/npc/9201017.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201017.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,13 +50,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "62961731515cc25b3a9e66c23f29517a9914baed", "filename": "scripts/npc/9201018.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201018.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "4db4bb3c64c3888bdcf6e708fc78e63d9fa2518e", "filename": "scripts/npc/9201019.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201019.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "203cc8de61c0f612bdd82a96c0e1df4d988170ca", "filename": "scripts/npc/9201039.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201039.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201039.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201039.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -46,12 +46,12 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n-        cm.dispose();\n-    } else if (mode == 0) {\n-        cm.sendNext(\"Ok, I'll give you a minute.\");\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n+        if (type == 7) {\n+            cm.sendNext(\"Ok, I'll give you a minute.\");\n+        }\n+        \n         cm.dispose();\n-        return;\n     }\n     status++;\n     if (status == 1) {"}, {"sha": "bbdb900422df83d8286c5f548a80d63e6c4b57ef", "filename": "scripts/npc/9201061.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201061.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201061.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201061.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -42,13 +42,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "1438423ac7c588d044a6d827cbaf2599b45582e8", "filename": "scripts/npc/9201062.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201062.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201062.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201062.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -49,13 +49,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "d59b5c2cc872d9fc1126cfedc9cb16e12e73aba7", "filename": "scripts/npc/9201063.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201063.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201063.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201063.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,13 +44,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "7625f74fe1b209b3096a2e2e875dbcf52ff8e245", "filename": "scripts/npc/9201064.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201064.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201064.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201064.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,13 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "32049e4b76d6390fd3cd0dbf57c42f46f0aef0ac", "filename": "scripts/npc/9201065.js", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201065.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201065.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201065.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -20,7 +20,7 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /* Miranda\n-NLC Skin Change.\n+        NLC Skin Change.\n */\n var status = 0;\n var price = 1000000;\n@@ -31,13 +31,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "edb97c8e7592664d2a38932f7545557bf4cd71e4", "filename": "scripts/npc/9201069.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201069.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201069.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201069.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -42,13 +42,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "70f03ecdf9157a5bb7671a98626a5906e14a4372", "filename": "scripts/npc/9201070.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201070.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9201070.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201070.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -42,13 +42,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n+    if (mode < 1) {  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n-            cm.dispose();\n-            return;\n-        }\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "656c7c151ac5865726521ddc9616dbc5b851a64f", "filename": "scripts/npc/9270023.js", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9270023.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,14 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) \n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status >= 0) {\n-            cm.dispose();\n-            return;\n-        }\n-        \n         if (mode == 1)\n             status++;\n         else"}, {"sha": "b194e24c8e1e0187d2947598ae56322e4a73d16f", "filename": "scripts/npc/9270024.js", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270024.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270024.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9270024.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,14 +43,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) \n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc \n         cm.dispose();\n     else {\n-        if (mode == 0 && status >= 0) {\n-            cm.dispose();\n-            return;\n-        }\n-\n         if (mode == 1)\n             status++;\n         else"}, {"sha": "84ef57df6369c07ba78f1c663eb3dc8ff2fc9b5a", "filename": "scripts/npc/9270025.js", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270025.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/npc/9270025.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9270025.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -32,13 +32,9 @@ function start() {\n }\n \n function action(mode, type, selection) {\n-    if (mode < 1)\n+    if (mode < 1)  // disposing issue with stylishs found thanks to Vcoc\n         cm.dispose();\n     else {\n-        if (mode == 0 && status >= 0) {\n-                cm.dispose();\n-                return;\n-        }\n         if (mode == 1)\n                 status++;\n         else"}, {"sha": "b4623a147cdc11f3012c3536c2dc7ca849bffc3d", "filename": "scripts/quest/8185.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/quest/8185.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/scripts/quest/8185.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8185.js?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -44,7 +44,7 @@ function end(mode, type, selection) {\n                             return;\n                         }\n                     \n-\t\t\tqm.sendNextPrev(\"#e#bHey, you did it!#n#k \\r\\n#rWow!#k Now I could complete my studies on your pet!\");\n+\t\t\tqm.sendNext(\"#e#bHey, you did it!#n#k \\r\\n#rWow!#k Now I could complete my studies on your pet!\");\n \t\t} else if (status == 1) {\n \t\t\tif (mode == 0) {\n \t\t\t\tqm.sendOk(\"I see... Come back when you wish to do it. I'm really excited to do this.\");"}, {"sha": "f5db5de785e6582900b2c38e64c8b739597efa22", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -187,7 +187,6 @@\n     private MapleFamily family;\n     private int familyId;\n     private int bookCover;\n-    private int markedMonster = 0;\n     private int battleshipHp = 0;\n     private int mesosTraded = 0;\n     private int possibleReports = 10;\n@@ -2785,11 +2784,6 @@ public void run() {\n                                         deletedCoupon = true;\n                                     }\n                                 } else {\n-                                    if (item.getPetId() > -1) {\n-                                        int petIdx = getPetIndex(item.getPetId());\n-                                        if(petIdx > -1) unequipPet(getPet(petIdx), true);\n-                                    }\n-                                    \n                                     if (ItemConstants.isExpirablePet(item.getItemId())) {\n                                         client.announce(MaplePacketCreator.itemExpired(item.getItemId()));\n                                         toberemove.add(item);\n@@ -4638,10 +4632,6 @@ public int getMapId() {\n         return mapid;\n     }\n \n-    public int getMarkedMonster() {\n-        return markedMonster;\n-    }\n-\n     public MapleRing getMarriageRing() {\n         return partnerId > 0 ? marriageRing : null;\n     }\n@@ -8003,10 +7993,10 @@ public void sendPolice(String text) {\n         String message = getName() + \" received this - \" + text;\n         if (Server.getInstance().isGmOnline(this.getWorld())) { //Alert and log if a GM is online\n             Server.getInstance().broadcastGMMessage(this.getWorld(), MaplePacketCreator.sendYellowTip(message));\n-            FilePrinter.printError(\"autobanwarning.txt\", message + \"\\r\\n\");\n+            FilePrinter.print(FilePrinter.AUTOBAN_WARNING, message);\n         } else { //Auto DC and log if no GM is online\n             client.disconnect(false, false);\n-            FilePrinter.printError(\"autobandced.txt\", message + \"\\r\\n\");\n+            FilePrinter.print(FilePrinter.AUTOBAN_DC, message);\n         }\n         //Server.getInstance().broadcastGMMessage(0, MaplePacketCreator.serverNotice(1, getName() + \" received this - \" + text));\n         //announce(MaplePacketCreator.sendPolice(text));\n@@ -8357,10 +8347,6 @@ public void setMap(int PmapId) {\n     public void setMap(MapleMap newmap) {\n         this.map = newmap;\n     }\n-\n-    public void setMarkedMonster(int markedMonster) {\n-        this.markedMonster = markedMonster;\n-    }\n     \n     public void setMessenger(MapleMessenger messenger) {\n         this.messenger = messenger;"}, {"sha": "92894c0fe19d8e2de64497f212dea8c95d80bf16", "filename": "src/client/autoban/AutobanFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/autoban/AutobanFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/autoban/AutobanFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/autoban/AutobanFactory.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -91,7 +91,7 @@ public void alert(MapleCharacter chr, String reason) {\n \t\tServer.getInstance().broadcastGMMessage((chr != null ? chr.getWorld() : 0), MaplePacketCreator.sendYellowTip((chr != null ? MapleCharacter.makeMapleReadable(chr.getName()) : \"\") + \" caused \" + this.name() + \" \" + reason));\n             }\n         if (ServerConstants.USE_AUTOBAN_LOG) {\n-\t\t\tFilePrinter.printError(\"autobanwarning.txt\", (chr != null ? MapleCharacter.makeMapleReadable(chr.getName()) : \"\") + \" caused \" + this.name() + \" \" + reason + \"\\r\\n\");\n+\t\t\tFilePrinter.print(FilePrinter.AUTOBAN_WARNING, (chr != null ? MapleCharacter.makeMapleReadable(chr.getName()) : \"\") + \" caused \" + this.name() + \" \" + reason);\n \t\t}\n \t}\n \t"}, {"sha": "b9579daae17c2da2cf85f31a4d79e8d50f2d9b5c", "filename": "src/client/autoban/AutobanManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/autoban/AutobanManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/autoban/AutobanManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/autoban/AutobanManager.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -58,7 +58,7 @@ public void addPoint(AutobanFactory fac, String reason) {\n         }\n         if (ServerConstants.USE_AUTOBAN_LOG) {\n             // Lets log every single point too.\n-            FilePrinter.printError(\"autobanwarning.txt\", MapleCharacter.makeMapleReadable(chr.getName()) + \" caused \" + fac.name() + \" \" + reason + \"\\r\\n\");\n+            FilePrinter.print(FilePrinter.AUTOBAN_WARNING, MapleCharacter.makeMapleReadable(chr.getName()) + \" caused \" + fac.name() + \" \" + reason);\n         }\n     }\n "}, {"sha": "701ba30e1e94e22f13456f6c07f5ab574d51e2d7", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -113,7 +113,7 @@ public void handle(MapleClient client, String message){\n     private void writeLog(MapleClient client, String command){\n         SimpleDateFormat sdf = new SimpleDateFormat(\"dd-MM-yyyy HH:mm\");\n         FilePrinter.print(FilePrinter.USED_COMMANDS, client.getPlayer().getName() + \" used: \" + command + \" on \"\n-                + sdf.format(Calendar.getInstance().getTime()) + \"\\r\\n\");\n+                + sdf.format(Calendar.getInstance().getTime()));\n     }\n \n     private void addCommandInfo(String name, Class<? extends Command> commandClass) {\n@@ -262,7 +262,7 @@ private void registerLv3Commands() {\n         addCommand(\"ignored\", 3, IgnoredCommand.class);\n         addCommand(\"pos\", 3, PosCommand.class);\n         addCommand(\"togglecoupon\", 3, ToggleCouponCommand.class);\n-        addCommand(\"chat\", 3, ChatCommand.class);\n+        addCommand(\"togglewhitechat\", 3, ChatCommand.class);\n         addCommand(\"fame\", 3, FameCommand.class);\n         addCommand(\"givenx\", 3, GiveNxCommand.class);\n         addCommand(\"givevp\", 3, GiveVpCommand.class);"}, {"sha": "44762e9a4374f2c7589bc76547f15dd3844e0ce0", "filename": "src/client/command/commands/gm0/GachaCommand.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/GachaCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/GachaCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/GachaCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -61,6 +61,7 @@ public void execute(MapleClient c, String[] params) {\n             }\n         }\n         talkStr += \"\\r\\nPlease keep in mind that there are items that are in all gachapons and are not listed here.\";\n-        c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, talkStr, \"00 00\", (byte) 0));\n+        \n+        c.getAbstractPlayerInteraction().npcTalk(9010000, talkStr);\n     }\n }"}, {"sha": "906210a6368856634e182b16f398cb3085d61d03", "filename": "src/client/command/commands/gm0/GmCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/GmCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/GmCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/GmCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -53,7 +53,7 @@ public void execute(MapleClient c, String[] params) {\n         String message = joinStringFrom(params, 0);\n         Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[GM MESSAGE]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n         Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(1, message));\n-        FilePrinter.printError(\"gm.txt\", MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message + \"\\r\\n\");\n+        FilePrinter.printError(FilePrinter.COMMAND_GM, MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message);\n         player.dropMessage(5, \"Your message '\" + message + \"' was sent to GMs.\");\n         player.dropMessage(5, tips[Randomizer.nextInt(tips.length)]);\n     }"}, {"sha": "06dfff78b629d338d39336ba432fdf9acc31cde5", "filename": "src/client/command/commands/gm0/ReportBugCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/ReportBugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm0/ReportBugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/ReportBugCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -46,7 +46,7 @@ public void execute(MapleClient c, String[] params) {\n         String message = joinStringFrom(params, 0);\n         Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[BUG]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n         Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(1, message));\n-        FilePrinter.printError(\"bug.txt\", MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message + \"\\r\\n\");\n+        FilePrinter.printError(FilePrinter.COMMAND_BUG, MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message);\n         player.dropMessage(5, \"Your bug '\" + message + \"' was submitted successfully to our developers. Thank you!\");\n \n     }"}, {"sha": "f39df864987c30ed45d5542f504375eac56a4d8e", "filename": "src/client/command/commands/gm1/GotoCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/GotoCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/GotoCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/GotoCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,7 +50,7 @@ public void execute(MapleClient c, String[] params) {\n         }\n \n         if (player.getEventInstance() != null || MapleMiniDungeonInfo.isDungeonMap(player.getMapId()) || FieldLimit.CANNOTMIGRATE.check(player.getMap().getFieldLimit()) || !player.isAlive()) {\n-            player.yellowMessage(\"This command can not be used in this map.\");\n+            player.dropMessage(1, \"This command can not be used in this map.\");\n             return;\n         }\n "}, {"sha": "d8d554121ddd49eece4416f7b5ec9100671c76ca", "filename": "src/client/command/commands/gm1/WhatDropsFromCommand.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/WhatDropsFromCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/WhatDropsFromCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhatDropsFromCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -72,6 +72,7 @@ public void execute(MapleClient c, String[] params) {\n                 output += \"\\r\\n\";\n             }\n         }\n-        c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, output, \"00 00\", (byte) 0));\n+        \n+        c.getAbstractPlayerInteraction().npcTalk(9010000, output);\n     }\n }"}, {"sha": "81f5dd4580124514d0fa00145a44f132787b9c35", "filename": "src/client/command/commands/gm1/WhoDropsCommand.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/WhoDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm1/WhoDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhoDropsCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -86,7 +86,8 @@ public void execute(MapleClient c, String[] params) {\n                     player.dropMessage(5, \"The item you searched for doesn't exist.\");\n                     return;\n                 }\n-                c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, output, \"00 00\", (byte) 0));\n+                \n+                c.getAbstractPlayerInteraction().npcTalk(9010000, output);\n             } finally {\n                 c.releaseClient();\n             }"}, {"sha": "81640584d4b5a370d864a15f7efca0e7c6ec92f0", "filename": "src/client/command/commands/gm2/SearchCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm2/SearchCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm2/SearchCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SearchCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -136,6 +136,6 @@ public void execute(MapleClient c, String[] params) {\n         }\n         sb.append(\"\\r\\n#kLoaded within \").append((double) (System.currentTimeMillis() - start) / 1000).append(\" seconds.\");//because I can, and it's free\n \n-        c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, sb.toString(), \"00 00\", (byte) 0));\n+        c.getAbstractPlayerInteraction().npcTalk(9010000, sb.toString());\n     }\n }"}, {"sha": "ff03a70f15c59c36a7401f154e00f1632a9d2427", "filename": "src/client/command/commands/gm2/WarpCommand.java", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm2/WarpCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm2/WarpCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/WarpCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -26,7 +26,9 @@\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n+import server.maps.FieldLimit;\n import server.maps.MapleMap;\n+import server.maps.MapleMiniDungeonInfo;\n \n public class WarpCommand extends Command {\n     {\n@@ -48,6 +50,11 @@ public void execute(MapleClient c, String[] params) {\n                 return;\n             }\n             \n+            if (player.getEventInstance() != null || MapleMiniDungeonInfo.isDungeonMap(player.getMapId()) || FieldLimit.CANNOTMIGRATE.check(player.getMap().getFieldLimit()) || !player.isAlive()) {\n+                player.dropMessage(1, \"This command cannot be used in this map.\");\n+                return;\n+            }\n+            \n             // expedition issue with this command detected thanks to Masterrulax\n             player.saveLocationOnWarp();\n             player.changeMap(target, target.getRandomPlayerSpawnpoint());"}, {"sha": "9f383d781f05fb7b1c086095c71596da59a8a050", "filename": "src/client/command/commands/gm3/MusicCommand.java", "status": "modified", "additions": 28, "deletions": 166, "changes": 194, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm3/MusicCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm3/MusicCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/MusicCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -26,188 +26,50 @@\n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n+import constants.GameConstants;\n import tools.MaplePacketCreator;\n \n public class MusicCommand extends Command {\n     {\n         setDescription(\"\");\n     }\n \n+    private static String getSongList() {\n+        String songList = \"Song:\\r\\n\";\n+        for (String s : GameConstants.GAME_SONGS) {\n+            songList += (\"  \" + s + \"\\r\\n\");\n+        }\n+        \n+        return songList;\n+    }\n+    \n     @Override\n     public void execute(MapleClient c, String[] params) {\n-        final String[] songs = {\n-                \"Jukebox/Congratulation\",\n-                \"Bgm00/SleepyWood\",\n-                \"Bgm00/FloralLife\",\n-                \"Bgm00/GoPicnic\",\n-                \"Bgm00/Nightmare\",\n-                \"Bgm00/RestNPeace\",\n-                \"Bgm01/AncientMove\",\n-                \"Bgm01/MoonlightShadow\",\n-                \"Bgm01/WhereTheBarlogFrom\",\n-                \"Bgm01/CavaBien\",\n-                \"Bgm01/HighlandStar\",\n-                \"Bgm01/BadGuys\",\n-                \"Bgm02/MissingYou\",\n-                \"Bgm02/WhenTheMorningComes\",\n-                \"Bgm02/EvilEyes\",\n-                \"Bgm02/JungleBook\",\n-                \"Bgm02/AboveTheTreetops\",\n-                \"Bgm03/Subway\",\n-                \"Bgm03/Elfwood\",\n-                \"Bgm03/BlueSky\",\n-                \"Bgm03/Beachway\",\n-                \"Bgm03/SnowyVillage\",\n-                \"Bgm04/PlayWithMe\",\n-                \"Bgm04/WhiteChristmas\",\n-                \"Bgm04/UponTheSky\",\n-                \"Bgm04/ArabPirate\",\n-                \"Bgm04/Shinin'Harbor\",\n-                \"Bgm04/WarmRegard\",\n-                \"Bgm05/WolfWood\",\n-                \"Bgm05/DownToTheCave\",\n-                \"Bgm05/AbandonedMine\",\n-                \"Bgm05/MineQuest\",\n-                \"Bgm05/HellGate\",\n-                \"Bgm06/FinalFight\",\n-                \"Bgm06/WelcomeToTheHell\",\n-                \"Bgm06/ComeWithMe\",\n-                \"Bgm06/FlyingInABlueDream\",\n-                \"Bgm06/FantasticThinking\",\n-                \"Bgm07/WaltzForWork\",\n-                \"Bgm07/WhereverYouAre\",\n-                \"Bgm07/FunnyTimeMaker\",\n-                \"Bgm07/HighEnough\",\n-                \"Bgm07/Fantasia\",\n-                \"Bgm08/LetsMarch\",\n-                \"Bgm08/ForTheGlory\",\n-                \"Bgm08/FindingForest\",\n-                \"Bgm08/LetsHuntAliens\",\n-                \"Bgm08/PlotOfPixie\",\n-                \"Bgm09/DarkShadow\",\n-                \"Bgm09/TheyMenacingYou\",\n-                \"Bgm09/FairyTale\",\n-                \"Bgm09/FairyTalediffvers\",\n-                \"Bgm09/TimeAttack\",\n-                \"Bgm10/Timeless\",\n-                \"Bgm10/TimelessB\",\n-                \"Bgm10/BizarreTales\",\n-                \"Bgm10/TheWayGrotesque\",\n-                \"Bgm10/Eregos\",\n-                \"Bgm11/BlueWorld\",\n-                \"Bgm11/Aquarium\",\n-                \"Bgm11/ShiningSea\",\n-                \"Bgm11/DownTown\",\n-                \"Bgm11/DarkMountain\",\n-                \"Bgm12/AquaCave\",\n-                \"Bgm12/DeepSee\",\n-                \"Bgm12/WaterWay\",\n-                \"Bgm12/AcientRemain\",\n-                \"Bgm12/RuinCastle\",\n-                \"Bgm12/Dispute\",\n-                \"Bgm13/CokeTown\",\n-                \"Bgm13/Leafre\",\n-                \"Bgm13/Minar'sDream\",\n-                \"Bgm13/AcientForest\",\n-                \"Bgm13/TowerOfGoddess\",\n-                \"Bgm14/DragonLoad\",\n-                \"Bgm14/HonTale\",\n-                \"Bgm14/CaveOfHontale\",\n-                \"Bgm14/DragonNest\",\n-                \"Bgm14/Ariant\",\n-                \"Bgm14/HotDesert\",\n-                \"Bgm15/MureungHill\",\n-                \"Bgm15/MureungForest\",\n-                \"Bgm15/WhiteHerb\",\n-                \"Bgm15/Pirate\",\n-                \"Bgm15/SunsetDesert\",\n-                \"Bgm16/Duskofgod\",\n-                \"Bgm16/FightingPinkBeen\",\n-                \"Bgm16/Forgetfulness\",\n-                \"Bgm16/Remembrance\",\n-                \"Bgm16/Repentance\",\n-                \"Bgm16/TimeTemple\",\n-                \"Bgm17/MureungSchool1\",\n-                \"Bgm17/MureungSchool2\",\n-                \"Bgm17/MureungSchool3\",\n-                \"Bgm17/MureungSchool4\",\n-                \"Bgm18/BlackWing\",\n-                \"Bgm18/DrillHall\",\n-                \"Bgm18/QueensGarden\",\n-                \"Bgm18/RaindropFlower\",\n-                \"Bgm18/WolfAndSheep\",\n-                \"Bgm19/BambooGym\",\n-                \"Bgm19/CrystalCave\",\n-                \"Bgm19/MushCatle\",\n-                \"Bgm19/RienVillage\",\n-                \"Bgm19/SnowDrop\",\n-                \"Bgm20/GhostShip\",\n-                \"Bgm20/NetsPiramid\",\n-                \"Bgm20/UnderSubway\",\n-                \"Bgm21/2021year\",\n-                \"Bgm21/2099year\",\n-                \"Bgm21/2215year\",\n-                \"Bgm21/2230year\",\n-                \"Bgm21/2503year\",\n-                \"Bgm21/KerningSquare\",\n-                \"Bgm21/KerningSquareField\",\n-                \"Bgm21/KerningSquareSubway\",\n-                \"Bgm21/TeraForest\",\n-                \"BgmEvent/FunnyRabbit\",\n-                \"BgmEvent/FunnyRabbitFaster\",\n-                \"BgmEvent/wedding\",\n-                \"BgmEvent/weddingDance\",\n-                \"BgmEvent/wichTower\",\n-                \"BgmGL/amoria\",\n-                \"BgmGL/Amorianchallenge\",\n-                \"BgmGL/chapel\",\n-                \"BgmGL/cathedral\",\n-                \"BgmGL/Courtyard\",\n-                \"BgmGL/CrimsonwoodKeep\",\n-                \"BgmGL/CrimsonwoodKeepInterior\",\n-                \"BgmGL/GrandmastersGauntlet\",\n-                \"BgmGL/HauntedHouse\",\n-                \"BgmGL/NLChunt\",\n-                \"BgmGL/NLCtown\",\n-                \"BgmGL/NLCupbeat\",\n-                \"BgmGL/PartyQuestGL\",\n-                \"BgmGL/PhantomForest\",\n-                \"BgmJp/Feeling\",\n-                \"BgmJp/BizarreForest\",\n-                \"BgmJp/Hana\",\n-                \"BgmJp/Yume\",\n-                \"BgmJp/Bathroom\",\n-                \"BgmJp/BattleField\",\n-                \"BgmJp/FirstStepMaster\",\n-                \"BgmMY/Highland\",\n-                \"BgmMY/KualaLumpur\",\n-                \"BgmSG/BoatQuay_field\",\n-                \"BgmSG/BoatQuay_town\",\n-                \"BgmSG/CBD_field\",\n-                \"BgmSG/CBD_town\",\n-                \"BgmSG/Ghostship\",\n-                \"BgmUI/ShopBgm\",\n-                \"BgmUI/Title\"\n-        };\n+        \n         MapleCharacter player = c.getPlayer();\n         if (params.length < 1) {\n-            player.yellowMessage(\"Syntax: !music <song>\");\n-            for (String s : songs) {\n-                player.yellowMessage(s);\n-            }\n+            String sendMsg = \"\";\n+            \n+            sendMsg += \"Syntax: #r!music <song>#k\\r\\n\\r\\n\";\n+            sendMsg += getSongList();\n+            \n+            c.announce(MaplePacketCreator.getNPCTalk(1052015, (byte) 0, sendMsg, \"00 00\", (byte) 0));\n             return;\n         }\n+        \n         String song = joinStringFrom(params, 0);\n-        for (String s : songs) {\n-            if (s.equals(song)) {\n+        for (String s : GameConstants.GAME_SONGS) {\n+            if (s.equalsIgnoreCase(song)) {    // thanks Masterrulax for finding an issue here\n                 player.getMap().broadcastMessage(MaplePacketCreator.musicChange(s));\n-                player.yellowMessage(\"Now playing song \" + song + \".\");\n-                break;\n+                player.yellowMessage(\"Now playing song \" + s + \".\");\n+                return;\n             }\n         }\n-        player.yellowMessage(\"Song not found, please enter a song below.\");\n-        for (String s : songs) {\n-            player.yellowMessage(s);\n-        }\n+        \n+        String sendMsg = \"\";\n+        sendMsg += \"Song not found, please enter a song below.\\r\\n\\r\\n\";\n+        sendMsg += getSongList();\n+        \n+        c.announce(MaplePacketCreator.getNPCTalk(1052015, (byte) 0, sendMsg, \"00 00\", (byte) 0));\n     }\n }"}, {"sha": "86ff99636b5755cecbebbb950600bb186691420a", "filename": "src/client/command/commands/gm4/ProItemCommand.java", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm4/ProItemCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm4/ProItemCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/ProItemCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -45,11 +45,18 @@ public void execute(MapleClient c, String[] params) {\n             player.yellowMessage(\"Syntax: !proitem <itemid> <stat value> [<spdjmp value>]\");\n             return;\n         }\n+        \n+        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         int itemid = Integer.parseInt(params[0]);\n+        \n+        if(ii.getName(itemid) == null) {\n+            player.yellowMessage(\"Item id '\" + params[0] + \"' does not exist.\");\n+            return;\n+        }\n+        \n         short stat = (short) Math.max(0, Short.parseShort(params[1]));\n         short spdjmp = params.length >= 3 ? (short) Math.max(0, Short.parseShort(params[2])) : 0;\n-\n-        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+        \n         MapleInventoryType type = ItemConstants.getInventoryType(itemid);\n         if (type.equals(MapleInventoryType.EQUIP)) {\n             Item it = ii.getEquipById(itemid);"}, {"sha": "9d1296867b64800a53c77f4c1fa68588ac81a385", "filename": "src/client/command/commands/gm5/DebugCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm5/DebugCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/command/commands/gm5/DebugCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/DebugCommand.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -64,7 +64,7 @@ public void execute(MapleClient c, String[] params) {\n                     msgTypes += (\"#L\" + i + \"#\" + debugTypes[i] + \"#l\\r\\n\");\n                 }\n                 \n-                player.announce(MaplePacketCreator.getNPCTalk(9201143, (byte) 0, msgTypes, \"00 00\", (byte) 0));\n+                c.getAbstractPlayerInteraction().npcTalk(9201143, msgTypes);\n                 break;\n             \n             case \"monster\":"}, {"sha": "5227e900654b3aca16fed3f5ecaf7f762dbaef81", "filename": "src/client/creator/CharacterFactory.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/creator/CharacterFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/creator/CharacterFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/creator/CharacterFactory.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -28,6 +28,7 @@\n import constants.ServerConstants;\n import net.server.Server;\n import server.MapleItemInformationProvider;\n+import tools.FilePrinter;\n import tools.MaplePacketCreator;\n \n /**\n@@ -93,6 +94,7 @@ protected synchronized static int createNewCharacter(MapleClient c, String name,\n                 \n                 Server.getInstance().createCharacterEntry(newchar);\n                 Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[NEW CHAR]: \" + c.getAccountName() + \" has created a new character with IGN \" + name));\n+                FilePrinter.print(FilePrinter.CREATED_CHAR + c.getAccountName() + \".txt\", c.getAccountName() + \" created character with IGN \" + name);\n                 \n                 return 0;\n         }        "}, {"sha": "67483cd49e7ad887699c76cc7964ff3ed99241ba", "filename": "src/client/inventory/MaplePet.java", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/inventory/MaplePet.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/inventory/MaplePet.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MaplePet.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -81,17 +81,24 @@ public static MaplePet loadFromDb(int itemid, short position, int petid) {\n             return null;\n         }\n     }\n-\n-    public void deleteFromDb() {\n+    \n+    public static void deleteFromDb(int petid) {\n         try {\n             Connection con = DatabaseConnection.getConnection();\n+            \n             PreparedStatement ps = con.prepareStatement(\"DELETE FROM pets WHERE `petid` = ?\");\n-            ps.setInt(1, this.getUniqueId());\n+            ps.setInt(1, petid);\n             ps.executeUpdate();\n             ps.close();\n+            \n+            ps = con.prepareStatement(\"DELETE FROM petignores WHERE `petid` = ?\");  // thanks Vcoc for detecting petignores remaining after deletion\n+            ps.setInt(1, petid);\n+            ps.executeUpdate();\n+            ps.close();\n+            \n             con.close();\n             \n-            MapleCashidGenerator.freeCashId(this.getUniqueId());\n+            MapleCashidGenerator.freeCashId(petid);\n         } catch (SQLException ex) {\n             ex.printStackTrace();\n         }"}, {"sha": "bfd9ed9e57037992bdf1bee11d5b33783c1ea8fe", "filename": "src/client/inventory/manipulator/MapleInventoryManipulator.java", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/inventory/manipulator/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/inventory/manipulator/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleInventoryManipulator.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -28,6 +28,7 @@\n import client.inventory.Item;\n import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n+import client.inventory.MaplePet;\n import client.inventory.ModifyInventory;\n import client.newyear.NewYearCardRecord;\n import constants.ItemConstants;\n@@ -361,25 +362,41 @@ public static void removeFromSlot(MapleClient c, MapleInventoryType type, short\n     }\n \n     public static void removeFromSlot(MapleClient c, MapleInventoryType type, short slot, short quantity, boolean fromDrop, boolean consume) {\n-        MapleInventory inv = c.getPlayer().getInventory(type);\n+        MapleCharacter chr = c.getPlayer();\n+        MapleInventory inv = chr.getInventory(type);\n         Item item = inv.getItem(slot);\n         boolean allowZero = consume && ItemConstants.isRechargeable(item.getItemId());\n         \n         if(type == MapleInventoryType.EQUIPPED) {\n             inv.lockInventory();\n             try {\n-                c.getPlayer().unequippedItem((Equip) item);\n+                chr.unequippedItem((Equip) item);\n                 inv.removeItem(slot, quantity, allowZero);\n             } finally {\n                 inv.unlockInventory();\n             }\n             \n             announceModifyInventory(c, item, fromDrop, allowZero);\n         } else {\n-            inv.removeItem(slot, quantity, allowZero);\n+            int petid = item.getPetId();\n+            if (petid > -1) { // thanks Vcoc for finding a d/c issue with equipped pets & pets remaining on DB here\n+                int petIdx = chr.getPetIndex(petid);\n+                if(petIdx > -1) {\n+                    MaplePet pet = chr.getPet(petIdx);\n+                    chr.unequipPet(pet, true);\n+                }\n             \n-            if(type != MapleInventoryType.CANHOLD) {\n-                announceModifyInventory(c, item, fromDrop, allowZero);\n+                inv.removeItem(slot, quantity, allowZero);\n+                if(type != MapleInventoryType.CANHOLD) {\n+                    announceModifyInventory(c, item, fromDrop, allowZero);\n+                }\n+                \n+                MaplePet.deleteFromDb(petid);\n+            } else {\n+                inv.removeItem(slot, quantity, allowZero);\n+                if(type != MapleInventoryType.CANHOLD) {\n+                    announceModifyInventory(c, item, fromDrop, allowZero);\n+                }\n             }\n         }\n     }"}, {"sha": "a5a4e8ca9801559135b1d0510f2402501f42db07", "filename": "src/client/processor/AssignSPProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/AssignSPProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/AssignSPProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/AssignSPProcessor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -53,7 +53,7 @@ public static void SPAssignAction(MapleClient c, int skillid) {\n             boolean isBeginnerSkill = false;\n             if ((!GameConstants.isPqSkillMap(player.getMapId()) && GameConstants.isPqSkill(skillid)) || (!player.isGM() && GameConstants.isGMSkills(skillid)) || (!GameConstants.isInJobTree(skillid, player.getJob().getId()) && !player.isGM())) {\n                 AutobanFactory.PACKET_EDIT.alert(player, \"tried to packet edit in distributing sp.\");\n-                FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use skill \" + skillid + \" without it being in their job.\\r\\n\");\n+                FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use skill \" + skillid + \" without it being in their job.\");\n                 \n                 final MapleClient client = c;\n                 ThreadManager.getInstance().newTask(new Runnable() {"}, {"sha": "b06ffdd3d90af4ea2a8337d546dcdd56f4fe2b04", "filename": "src/client/processor/DueyProcessor.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/DueyProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/DueyProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/DueyProcessor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -351,7 +351,7 @@ public static void dueySendItem(MapleClient c, byte inventId, short itemPos, sho\n                 final long sendMesos = (long) mesos + fee;\n                 if (mesos < 0 || sendMesos > Integer.MAX_VALUE || (amount < 1 && mesos == 0)) {\n                     AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with duey.\");\n-                    FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use duey with mesos \" + mesos + \" and amount \" + amount + \"\\r\\n\");           \t\n+                    FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use duey with mesos \" + mesos + \" and amount \" + amount);\n                     c.disconnect(true, false);\n                     return;\n                 }\n@@ -464,7 +464,7 @@ public static void dueyClaimPackage(MapleClient c, int packageid) {\n                     dp = dueypack;\n                     if(dp == null) {\n                         c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_UNKNOWN_ERROR.getCode()));\n-                        FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to receive package from duey with id \" + packageid + \"\\r\\n\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to receive package from duey with id \" + packageid);\n                         return;\n                     }\n "}, {"sha": "50cd97f912ad1f3afe11e33d07da27ad32efdc72", "filename": "src/client/processor/FredrickProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/FredrickProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/FredrickProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/FredrickProcessor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -94,7 +94,7 @@ public static void fredrickRetrieveItems(MapleClient c) {     // thanks Gustav f\n                             Item item = it.getLeft();\n                             MapleInventoryManipulator.addFromDrop(chr.getClient(), item, false);\n                             String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                            FilePrinter.print(FilePrinter.FREDRICK + chr.getName() + \".txt\", chr.getName() + \" gained \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                            FilePrinter.print(FilePrinter.FREDRICK + chr.getName() + \".txt\", chr.getName() + \" gained \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\");\n                         }\n \n                         chr.announce(MaplePacketCreator.fredrickMessage((byte) 0x1E));"}, {"sha": "459fba8b8c8aa50b042bfe36ebe350f478137468", "filename": "src/client/processor/SpawnPetProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/SpawnPetProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/SpawnPetProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/SpawnPetProcessor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -62,7 +62,7 @@ public static void processSpawnPet(MapleClient c, byte slot, boolean lead) {\n                         long expiration = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getExpiration();\n                         MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, petid, (short) 1, false, false);\n                         MapleInventoryManipulator.addById(c, evolveid, (short) 1, null, petId, expiration);\n-                        pet.deleteFromDb();\n+                        MaplePet.deleteFromDb(petId);\n \n                         c.announce(MaplePacketCreator.enableActions());\n                         return;"}, {"sha": "77eeafd740aabbd4a5f2a969464d66603e4f5dcc", "filename": "src/client/processor/StorageProcessor.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/StorageProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/client/processor/StorageProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/StorageProcessor.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -61,7 +61,7 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                         byte slot = slea.readByte();\n                                         if (slot < 0 || slot > storage.getSlots()) { // removal starts at zero\n                                                 AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n-                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to work with storage slot \" + slot + \"\\r\\n\");\n+                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to work with storage slot \" + slot);\n                                                 c.disconnect(true, false);\n                                                 return;\n                                         }\n@@ -84,7 +84,7 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                                 if (MapleInventoryManipulator.checkSpace(c, item.getItemId(), item.getQuantity(), item.getOwner())) {                \n                                                         item = storage.takeOut(slot);//actually the same but idc\n                                                         String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" took out \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" took out \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\");\n                                                         chr.setUsedStorage();\n                                                         MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n                                                         MapleInventoryManipulator.addFromDrop(c, item, false);\n@@ -101,7 +101,7 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                         MapleInventory Inv = chr.getInventory(slotType);\n                                         if (slot < 1 || slot > Inv.getSlotLimit()) { //player inv starts at one\n                                                 AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n-                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to store item at slot \" + slot + \"\\r\\n\");\n+                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to store item at slot \" + slot);\n                                                 c.disconnect(true, false);\n                                                 return;\n                                         }\n@@ -137,7 +137,7 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                                         storage.store(item);\n                                                         storage.sendStored(c, ItemConstants.getInventoryType(itemId));\n                                                         String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\");\n                                                         chr.setUsedStorage();\n                                                 }\n                                         }\n@@ -164,7 +164,7 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                                 }\n                                                 storage.setMeso(storageMesos - meso);\n                                                 chr.gainMeso(meso, false, true, false);\n-                                                FilePrinter.print(FilePrinter.STORAGE + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + (meso > 0 ? \" took out \" : \" stored \") + Math.abs(meso) + \" mesos\\r\\n\");\n+                                                FilePrinter.print(FilePrinter.STORAGE + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + (meso > 0 ? \" took out \" : \" stored \") + Math.abs(meso) + \" mesos\");\n                                                 chr.setUsedStorage();\n                                         } else {\n                                                 c.announce(MaplePacketCreator.enableActions());"}, {"sha": "1c5b8c7dd75633a04dbedda5ccfae31a65f09ac4", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 157, "deletions": 0, "changes": 157, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -1,5 +1,7 @@\n package constants;\n \n+import java.util.ArrayList;\n+import java.util.List;\n import java.util.HashMap;\n import java.util.Map;\n import client.MapleJob;\n@@ -102,6 +104,161 @@ public static int getPlayerBonusExpRate(int slot) {\n         put(\"fm\", 910000000);\n     }};\n     \n+    public static final List<String> GAME_SONGS = new ArrayList<String>(170) {{\n+        add(\"Jukebox/Congratulation\");\n+        add(\"Bgm00/SleepyWood\");\n+        add(\"Bgm00/FloralLife\");\n+        add(\"Bgm00/GoPicnic\");\n+        add(\"Bgm00/Nightmare\");\n+        add(\"Bgm00/RestNPeace\");\n+        add(\"Bgm01/AncientMove\");\n+        add(\"Bgm01/MoonlightShadow\");\n+        add(\"Bgm01/WhereTheBarlogFrom\");\n+        add(\"Bgm01/CavaBien\");\n+        add(\"Bgm01/HighlandStar\");\n+        add(\"Bgm01/BadGuys\");\n+        add(\"Bgm02/MissingYou\");\n+        add(\"Bgm02/WhenTheMorningComes\");\n+        add(\"Bgm02/EvilEyes\");\n+        add(\"Bgm02/JungleBook\");\n+        add(\"Bgm02/AboveTheTreetops\");\n+        add(\"Bgm03/Subway\");\n+        add(\"Bgm03/Elfwood\");\n+        add(\"Bgm03/BlueSky\");\n+        add(\"Bgm03/Beachway\");\n+        add(\"Bgm03/SnowyVillage\");\n+        add(\"Bgm04/PlayWithMe\");\n+        add(\"Bgm04/WhiteChristmas\");\n+        add(\"Bgm04/UponTheSky\");\n+        add(\"Bgm04/ArabPirate\");\n+        add(\"Bgm04/Shinin'Harbor\");\n+        add(\"Bgm04/WarmRegard\");\n+        add(\"Bgm05/WolfWood\");\n+        add(\"Bgm05/DownToTheCave\");\n+        add(\"Bgm05/AbandonedMine\");\n+        add(\"Bgm05/MineQuest\");\n+        add(\"Bgm05/HellGate\");\n+        add(\"Bgm06/FinalFight\");\n+        add(\"Bgm06/WelcomeToTheHell\");\n+        add(\"Bgm06/ComeWithMe\");\n+        add(\"Bgm06/FlyingInABlueDream\");\n+        add(\"Bgm06/FantasticThinking\");\n+        add(\"Bgm07/WaltzForWork\");\n+        add(\"Bgm07/WhereverYouAre\");\n+        add(\"Bgm07/FunnyTimeMaker\");\n+        add(\"Bgm07/HighEnough\");\n+        add(\"Bgm07/Fantasia\");\n+        add(\"Bgm08/LetsMarch\");\n+        add(\"Bgm08/ForTheGlory\");\n+        add(\"Bgm08/FindingForest\");\n+        add(\"Bgm08/LetsHuntAliens\");\n+        add(\"Bgm08/PlotOfPixie\");\n+        add(\"Bgm09/DarkShadow\");\n+        add(\"Bgm09/TheyMenacingYou\");\n+        add(\"Bgm09/FairyTale\");\n+        add(\"Bgm09/FairyTalediffvers\");\n+        add(\"Bgm09/TimeAttack\");\n+        add(\"Bgm10/Timeless\");\n+        add(\"Bgm10/TimelessB\");\n+        add(\"Bgm10/BizarreTales\");\n+        add(\"Bgm10/TheWayGrotesque\");\n+        add(\"Bgm10/Eregos\");\n+        add(\"Bgm11/BlueWorld\");\n+        add(\"Bgm11/Aquarium\");\n+        add(\"Bgm11/ShiningSea\");\n+        add(\"Bgm11/DownTown\");\n+        add(\"Bgm11/DarkMountain\");\n+        add(\"Bgm12/AquaCave\");\n+        add(\"Bgm12/DeepSee\");\n+        add(\"Bgm12/WaterWay\");\n+        add(\"Bgm12/AcientRemain\");\n+        add(\"Bgm12/RuinCastle\");\n+        add(\"Bgm12/Dispute\");\n+        add(\"Bgm13/CokeTown\");\n+        add(\"Bgm13/Leafre\");\n+        add(\"Bgm13/Minar'sDream\");\n+        add(\"Bgm13/AcientForest\");\n+        add(\"Bgm13/TowerOfGoddess\");\n+        add(\"Bgm14/DragonLoad\");\n+        add(\"Bgm14/HonTale\");\n+        add(\"Bgm14/CaveOfHontale\");\n+        add(\"Bgm14/DragonNest\");\n+        add(\"Bgm14/Ariant\");\n+        add(\"Bgm14/HotDesert\");\n+        add(\"Bgm15/MureungHill\");\n+        add(\"Bgm15/MureungForest\");\n+        add(\"Bgm15/WhiteHerb\");\n+        add(\"Bgm15/Pirate\");\n+        add(\"Bgm15/SunsetDesert\");\n+        add(\"Bgm16/Duskofgod\");\n+        add(\"Bgm16/FightingPinkBeen\");\n+        add(\"Bgm16/Forgetfulness\");\n+        add(\"Bgm16/Remembrance\");\n+        add(\"Bgm16/Repentance\");\n+        add(\"Bgm16/TimeTemple\");\n+        add(\"Bgm17/MureungSchool1\");\n+        add(\"Bgm17/MureungSchool2\");\n+        add(\"Bgm17/MureungSchool3\");\n+        add(\"Bgm17/MureungSchool4\");\n+        add(\"Bgm18/BlackWing\");\n+        add(\"Bgm18/DrillHall\");\n+        add(\"Bgm18/QueensGarden\");\n+        add(\"Bgm18/RaindropFlower\");\n+        add(\"Bgm18/WolfAndSheep\");\n+        add(\"Bgm19/BambooGym\");\n+        add(\"Bgm19/CrystalCave\");\n+        add(\"Bgm19/MushCatle\");\n+        add(\"Bgm19/RienVillage\");\n+        add(\"Bgm19/SnowDrop\");\n+        add(\"Bgm20/GhostShip\");\n+        add(\"Bgm20/NetsPiramid\");\n+        add(\"Bgm20/UnderSubway\");\n+        add(\"Bgm21/2021year\");\n+        add(\"Bgm21/2099year\");\n+        add(\"Bgm21/2215year\");\n+        add(\"Bgm21/2230year\");\n+        add(\"Bgm21/2503year\");\n+        add(\"Bgm21/KerningSquare\");\n+        add(\"Bgm21/KerningSquareField\");\n+        add(\"Bgm21/KerningSquareSubway\");\n+        add(\"Bgm21/TeraForest\");\n+        add(\"BgmEvent/FunnyRabbit\");\n+        add(\"BgmEvent/FunnyRabbitFaster\");\n+        add(\"BgmEvent/wedding\");\n+        add(\"BgmEvent/weddingDance\");\n+        add(\"BgmEvent/wichTower\");\n+        add(\"BgmGL/amoria\");\n+        add(\"BgmGL/Amorianchallenge\");\n+        add(\"BgmGL/chapel\");\n+        add(\"BgmGL/cathedral\");\n+        add(\"BgmGL/Courtyard\");\n+        add(\"BgmGL/CrimsonwoodKeep\");\n+        add(\"BgmGL/CrimsonwoodKeepInterior\");\n+        add(\"BgmGL/GrandmastersGauntlet\");\n+        add(\"BgmGL/HauntedHouse\");\n+        add(\"BgmGL/NLChunt\");\n+        add(\"BgmGL/NLCtown\");\n+        add(\"BgmGL/NLCupbeat\");\n+        add(\"BgmGL/PartyQuestGL\");\n+        add(\"BgmGL/PhantomForest\");\n+        add(\"BgmJp/Feeling\");\n+        add(\"BgmJp/BizarreForest\");\n+        add(\"BgmJp/Hana\");\n+        add(\"BgmJp/Yume\");\n+        add(\"BgmJp/Bathroom\");\n+        add(\"BgmJp/BattleField\");\n+        add(\"BgmJp/FirstStepMaster\");\n+        add(\"BgmMY/Highland\");\n+        add(\"BgmMY/KualaLumpur\");\n+        add(\"BgmSG/BoatQuay_field\");\n+        add(\"BgmSG/BoatQuay_town\");\n+        add(\"BgmSG/CBD_field\");\n+        add(\"BgmSG/CBD_town\");\n+        add(\"BgmSG/Ghostship\");\n+        add(\"BgmUI/ShopBgm\");\n+        add(\"BgmUI/Title\");\n+    }};\n+    \n     // MapleStory default keyset\n     private static final int[] DEFAULT_KEY = {18, 65, 2, 23, 3, 4, 5, 6, 16, 17, 19, 25, 26, 27, 31, 34, 35, 37, 38, 40, 43, 44, 45, 46, 50, 56, 59, 60, 61, 62, 63, 64, 57, 48, 29, 7, 24, 33, 41, 39};\n     private static final int[] DEFAULT_TYPE = {4, 6, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 4, 4, 5, 6, 6, 6, 6, 6, 6, 5, 4, 5, 4, 4, 4, 4, 4};"}, {"sha": "319f1bd144f666c5ac2b16b3af883986c6e3a817", "filename": "src/net/server/audit/ThreadTracker.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/ThreadTracker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/ThreadTracker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/ThreadTracker.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -198,7 +198,7 @@ public void accessThreadTracker(boolean update, boolean lock, MonitoredLockType\n                     dateFormat.setTimeZone(TimeZone.getDefault());\n \n                     FilePrinter.printError(FilePrinter.DEADLOCK_STATE, printThreadTrackerState(dateFormat.format(new Date())));\n-                    //FilePrinter.printError(FilePrinter.DEADLOCK_STATE, \"[\" + dateFormat.format(new Date()) + \"] Presenting current lock path for lockid \" + lockId.name() + \".\\r\\n\" + printLockStatus(lockId) + \"\\r\\n-------------------------------\\r\\n\");\n+                    //FilePrinter.printError(FilePrinter.DEADLOCK_STATE, \"[\" + dateFormat.format(new Date()) + \"] Presenting current lock path for lockid \" + lockId.name() + \".\\r\\n\" + printLockStatus(lockId) + \"\\r\\n-------------------------------\");\n                 }\n             } else {\n                 long tid = Thread.currentThread().getId();"}, {"sha": "bed688d8f00be180c193753e14fe9d930a65a37e", "filename": "src/net/server/audit/locks/active/TrackerReadLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerReadLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerReadLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/active/TrackerReadLock.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -64,7 +64,7 @@ public void lock() {\n                 DateFormat dateFormat = new SimpleDateFormat(\"dd-MM-yyyy HH:mm:ss\");\n                 dateFormat.setTimeZone(TimeZone.getDefault());\n \n-                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                 ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                 deadlockedState = null;\n             }\n@@ -89,7 +89,7 @@ public boolean tryLock() {\n         if(super.tryLock()) {\n             if(ServerConstants.USE_THREAD_TRACKER) {\n                 if(deadlockedState != null) {\n-                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                     ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                     deadlockedState = null;\n                 }"}, {"sha": "5a211086f2257ebbd6713738eabf6e44c63197d2", "filename": "src/net/server/audit/locks/active/TrackerReentrantLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerReentrantLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerReentrantLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/active/TrackerReentrantLock.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -66,7 +66,7 @@ public void lock() {\n                 DateFormat dateFormat = new SimpleDateFormat(\"dd-MM-yyyy HH:mm:ss\");\n                 dateFormat.setTimeZone(TimeZone.getDefault());\n \n-                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                 ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                 deadlockedState = null;\n             }\n@@ -91,7 +91,7 @@ public boolean tryLock() {\n         if(super.tryLock()) {\n             if(ServerConstants.USE_THREAD_TRACKER) {\n                 if(deadlockedState != null) {\n-                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                     ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                     deadlockedState = null;\n                 }"}, {"sha": "dd160fcad98a54edc1c2311723b5a961e065c31f", "filename": "src/net/server/audit/locks/active/TrackerWriteLock.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerWriteLock.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/audit/locks/active/TrackerWriteLock.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/active/TrackerWriteLock.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -62,7 +62,7 @@ public void lock() {\n                 DateFormat dateFormat = new SimpleDateFormat(\"dd-MM-yyyy HH:mm:ss\");\n                 dateFormat.setTimeZone(TimeZone.getDefault());\n \n-                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"[CRITICAL] \" + dateFormat.format(new Date()) + \" Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                 ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                 deadlockedState = null;\n             }\n@@ -87,7 +87,7 @@ public boolean tryLock() {\n         if(super.tryLock()) {\n             if(ServerConstants.USE_THREAD_TRACKER) {\n                 if(deadlockedState != null) {\n-                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState) + \"\\r\\n\\r\\n\");\n+                    //FilePrinter.printError(FilePrinter.DEADLOCK_ERROR, \"Deadlock occurred when trying to use the '\" + id.name() + \"' lock resources:\\r\\n\" + printStackTrace(deadlockedState));\n                     ThreadTracker.getInstance().accessThreadTracker(true, true, id, hashcode);\n                     deadlockedState = null;\n                 }"}, {"sha": "6eecd578dc8dd05a4ba1454cd865010a8dc215d5", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -326,8 +326,8 @@ public void run() {\n                     } else if (attack.skill == ILArchMage.ICE_DEMON) {\n                         monster.setTempEffectiveness(Element.FIRE, ElementalEffectiveness.WEAK, SkillFactory.getSkill(ILArchMage.ICE_DEMON).getEffect(player.getSkillLevel(SkillFactory.getSkill(ILArchMage.ICE_DEMON))).getDuration() * 1000);\n                     } else if (attack.skill == Outlaw.HOMING_BEACON || attack.skill == Corsair.BULLSEYE) {\n-                        player.setMarkedMonster(monster.getObjectId());\n-                        player.announce(MaplePacketCreator.giveBuff(1, attack.skill, Collections.singletonList(new Pair<>(MapleBuffStat.HOMING_BEACON, monster.getObjectId()))));\n+                        MapleStatEffect beacon = SkillFactory.getSkill(attack.skill).getEffect(player.getSkillLevel(attack.skill));\n+                        beacon.applyBeaconBuff(player, monster.getObjectId());\n                     } else if (attack.skill == Outlaw.FLAME_THROWER) {\n                         if (!monster.isBoss()) {\n                             Skill type = SkillFactory.getSkill(Outlaw.FLAME_THROWER);"}, {"sha": "34fbcc7ecb9beb7b4d89a600c617af465db8ead0", "filename": "src/net/server/channel/handlers/CashOperationHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/CashOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/CashOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CashOperationHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -172,7 +172,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     return;\n                 }\n                 if (chr.getStorage().gainSlots(4)) {\n-                    FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" bought 4 slots to their account storage.\\r\\n\");\n+                    FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" bought 4 slots to their account storage.\");\n                     chr.setUsedStorage();\n                     \n                     c.announce(MaplePacketCreator.showBoughtStorageSlots(chr.getStorage().getSlots()));\n@@ -187,7 +187,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     return;\n                 }\n                 if (chr.getStorage().gainSlots(8)) {    // thanks ABaldParrot & Thora for detecting storage issues here\n-                    FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" bought 8 slots to their account storage.\\r\\n\");\n+                    FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" bought 8 slots to their account storage.\");\n                     chr.setUsedStorage();\n                     \n                     c.announce(MaplePacketCreator.showBoughtStorageSlots(chr.getStorage().getSlots()));"}, {"sha": "5fbea4eb43cf80a09da1b3083620864013dce102", "filename": "src/net/server/channel/handlers/GeneralChatHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/GeneralChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/GeneralChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/GeneralChatHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,7 +43,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n                 if (s.length() > Byte.MAX_VALUE && !chr.isGM()) {\n                         AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit in General Chat.\");\n-                        FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + s.length() + \"\\r\\n\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + s.length());\n                         c.disconnect(true, false);\n                         return;\n                 }"}, {"sha": "fadf9f8e6b0df6eb4dd73f96714a8450e077459e", "filename": "src/net/server/channel/handlers/GiveFameHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/GiveFameHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/GiveFameHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/GiveFameHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -43,7 +43,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             return;\n         } else if (famechange != 1 && famechange != -1) {\n             AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit fame.\");\n-            FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to fame hack with famechange \" + famechange + \"\\r\\n\");\n+            FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to fame hack with famechange \" + famechange);\n             c.disconnect(true, false);\n             return;\n         }"}, {"sha": "fca88aae9f9c59fbc8fe6d57f50c41df0e13f8f2", "filename": "src/net/server/channel/handlers/ItemPickupHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/ItemPickupHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/ItemPickupHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ItemPickupHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -49,7 +49,7 @@ public final void handlePacket(final SeekableLittleEndianAccessor slea, final Ma\n         Point charPos = chr.getPosition();\n         Point obPos = ob.getPosition();\n         if (Math.abs(charPos.getX() - obPos.getX()) > 800 || Math.abs(charPos.getY() - obPos.getY()) > 600) {\n-            FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to pick up an item too far away. Mapid: \" + chr.getMapId() + \" Player pos: \" + charPos + \" Object pos: \" + obPos + \"\\r\\n\");\n+            FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to pick up an item too far away. Mapid: \" + chr.getMapId() + \" Player pos: \" + charPos + \" Object pos: \" + obPos);\n             return;\n         }\n         "}, {"sha": "5613ddaef65f725114833d3fe7b07dfa3992e6c7", "filename": "src/net/server/channel/handlers/KeymapChangeHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/KeymapChangeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/KeymapChangeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/KeymapChangeHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -51,7 +51,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                                                         isBanndedSkill = GameConstants.bannedBindSkills(skill.getId());\n                                                         if (isBanndedSkill || (!c.getPlayer().isGM() && GameConstants.isGMSkills(skill.getId())) || (!GameConstants.isInJobTree(skill.getId(), c.getPlayer().getJob().getId()) && !c.getPlayer().isGM())) { //for those skills are are \"technically\" in the beginner tab, like bamboo rain in Dojo or skills you find in PYPQ\n                                                                 //AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit keymapping.\");\n-                                                                //FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use skill \" + skill.getId() + \"\\r\\n\");\n+                                                                //FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use skill \" + skill.getId());\n                                                                 //c.disconnect(true, false);\n                                                                 //return;\n "}, {"sha": "8924774c32b16825bd65c03927ea843d04eadd54", "filename": "src/net/server/channel/handlers/MultiChatHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/MultiChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/MultiChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MultiChatHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -50,7 +50,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         String chattext = slea.readMapleAsciiString();\n         if (chattext.length() > Byte.MAX_VALUE && !player.isGM()) {\n         \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit chats.\");\n-        \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + chattext.length() + \"\\r\\n\");\n+        \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + chattext.length());\n         \tc.disconnect(true, false);\n         \treturn;\n         }\t"}, {"sha": "1598df933c1899cd18fcbcad6db1374f82f88c6e", "filename": "src/net/server/channel/handlers/NPCShopHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/NPCShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/NPCShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/NPCShopHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -41,7 +41,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             short quantity = slea.readShort();\n             if (quantity < 1) {\n             \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit a npc shop.\");\n-            \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to buy quantity \" + quantity + \" of item id \" + itemId + \"\\r\\n\");\n+            \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to buy quantity \" + quantity + \" of item id \" + itemId);\n             \tc.disconnect(true, false);\n             \treturn;\n             }"}, {"sha": "64f5a3b7fee5419b9d814c37f702796e96a93416", "filename": "src/net/server/channel/handlers/NPCTalkHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/NPCTalkHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/NPCTalkHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/NPCTalkHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -67,7 +67,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     boolean hasNpcScript = NPCScriptManager.getInstance().start(c, npc.getId(), oid, null);\n                     if (!hasNpcScript) {\n                         if (!npc.hasShop()) {\n-                            FilePrinter.printError(FilePrinter.NPC_UNCODED, \"NPC \" + npc.getName() + \"(\" + npc.getId() + \") is not coded.\\r\\n\");\n+                            FilePrinter.printError(FilePrinter.NPC_UNCODED, \"NPC \" + npc.getName() + \"(\" + npc.getId() + \") is not coded.\");\n                             return;\n                         } else if(c.getPlayer().getShop() != null) {\n                             c.announce(MaplePacketCreator.enableActions());"}, {"sha": "448583b5f6915343fd35471a1ef3baa88d76181e", "filename": "src/net/server/channel/handlers/PetChatHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PetChatHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PetChatHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetChatHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -45,7 +45,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         String text = slea.readMapleAsciiString();\n         if (text.length() > Byte.MAX_VALUE) {\n         \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with pets.\");\n-        \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + text.length() + \"\\r\\n\");\n+        \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + text.length());\n         \tc.disconnect(true, false);\n         \treturn;\n         }"}, {"sha": "d674c85ac04df66b102d28cd9377d679b76dd193", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -577,7 +577,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     int slot = slea.readShort();\n                     if (slot >= shop.getItems().size() || slot < 0) {\n                         AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a player shop.\");\n-                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot);\n                         c.disconnect(true, false);\n                         return;\n                     }\n@@ -609,7 +609,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 short quantity = slea.readShort();\n                 if (quantity < 1) {\n                     AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant and or player shop.\");\n-                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to buy item \" + itemid + \" with quantity \" + quantity + \"\\r\\n\");\n+                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to buy item \" + itemid + \" with quantity \" + quantity);\n                     c.disconnect(true, false);\n                     return;\n                 }\n@@ -635,7 +635,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     int slot = slea.readShort();\n                     if (slot >= merchant.getItems().size() || slot < 0) {\n                         AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant.\");\n-                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot);\n                         c.disconnect(true, false);\n                         return;\n                     }"}, {"sha": "af7ccc57b5945e4651503ca6cd1fdba965f6634d", "filename": "src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerMapTransitionHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -20,8 +20,14 @@\n \n package net.server.channel.handlers;\n \n+import client.MapleBuffStat;\n+import client.MapleCharacter;\n import client.MapleClient;\n+import java.util.Collections;\n+import java.util.List;\n import net.AbstractMaplePacketHandler;\n+import tools.MaplePacketCreator;\n+import tools.Pair;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n /**\n@@ -32,6 +38,15 @@\n     \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        c.getPlayer().setMapTransitionComplete();\n+        MapleCharacter chr = c.getPlayer();\n+        chr.setMapTransitionComplete();\n+        \n+        int beaconid = chr.getBuffSource(MapleBuffStat.HOMING_BEACON);\n+        if (beaconid != -1) {\n+            chr.cancelBuffStats(MapleBuffStat.HOMING_BEACON);\n+            \n+            final List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.HOMING_BEACON, 0));\n+            chr.announce(MaplePacketCreator.giveBuff(1, beaconid, stat));\n+        }\n     }\n }\n\\ No newline at end of file"}, {"sha": "1fb868d3409f30fa6ef35dea15624683e566df91", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -54,7 +54,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         /*\n         if ((!GameConstants.isPqSkillMap(chr.getMapId()) && GameConstants.isPqSkill(skillid)) || (!chr.isGM() && GameConstants.isGMSkills(skillid)) || (!GameConstants.isInJobTree(skillid, chr.getJob().getId()) && !chr.isGM())) {\n         \tAutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit skills.\");\n-        \tFilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to use skill \" + skillid + \" without it being in their job.\\r\\n\");\n+        \tFilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to use skill \" + skillid + \" without it being in their job.\");\n     \t\tc.disconnect(true, false);\n             return;\n         }"}, {"sha": "d3e35f78dda93657dacacafe4742c2a349f8a3d8", "filename": "src/net/server/channel/handlers/WhisperHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/WhisperHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/channel/handlers/WhisperHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/WhisperHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -56,7 +56,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n             if (text.length() > Byte.MAX_VALUE && !player.isGM()) {\n             \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with whispers.\");\n-            \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + text.length() + \"\\r\\n\");\n+            \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + text.length());\n             \tc.disconnect(true, false);\n             \treturn;\n             }"}, {"sha": "5220c9ea3a0f6fb43eeda43cd519b754063d76de", "filename": "src/net/server/handlers/login/DeleteCharHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/handlers/login/DeleteCharHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/handlers/login/DeleteCharHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/DeleteCharHandler.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -35,7 +35,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         int cid = slea.readInt();\n         if (c.checkPic(pic)) {\n             if(c.deleteCharacter(cid, c.getAccID())) {\n-                FilePrinter.print(FilePrinter.DELETED_CHARACTERS + c.getAccountName() + \".txt\", c.getAccountName() + \" deleted CID: \" + cid + \"\\r\\n\");\t\t\t\n+                FilePrinter.print(FilePrinter.DELETED_CHAR + c.getAccountName() + \".txt\", c.getAccountName() + \" deleted CID: \" + cid);\n                 c.announce(MaplePacketCreator.deleteCharResponse(cid, 0));\n             } else {\n                 c.announce(MaplePacketCreator.deleteCharResponse(cid, 0x14));"}, {"sha": "484c4b225f692801235b7ec7497bed6990c72aca", "filename": "src/net/server/worker/CouponWorker.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/worker/CouponWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/net/server/worker/CouponWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/CouponWorker.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -34,7 +34,7 @@ public void run() {\n             Server.getInstance().updateActiveCoupons();\n             Server.getInstance().commitActiveCoupons();\n         } catch(SQLException sqle) {\n-            FilePrinter.printError(FilePrinter.EXCEPTION_CAUGHT, \"Unexpected SQL error: \" + sqle.getMessage() + \"\\n\\n\");\n+            FilePrinter.printError(FilePrinter.EXCEPTION_CAUGHT, \"Unexpected SQL error: \" + sqle.getMessage());\n         }\n     }\n }"}, {"sha": "6b3363ef8a21b0b6611c29fdc704b331a2a411be", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -450,7 +450,6 @@ public Item evolvePet(byte slot, int afterId) {\n             }\n             \n             Item tmp = gainItem(afterId, (short) 1, false, true, period, target);\n-            getPlayer().unequipPet(target, true, false);\n             \n             /*\n             evolved = MaplePet.loadFromDb(tmp.getItemId(), tmp.getPosition(), tmp.getPetId());"}, {"sha": "c599a943f26855ba28188cc0d9683f413782e1d6", "filename": "src/scripting/quest/QuestScriptManager.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/scripting/quest/QuestScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/scripting/quest/QuestScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/quest/QuestScriptManager.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -67,7 +67,7 @@ public void start(MapleClient c, short questid, int npc) {\n                                         if(GameConstants.isMedalQuest(questid)) {   // start generic medal quest\n                                                 iv = getInvocable(\"quest/medalQuest.js\", c);\n                                         } else {\n-                                                FilePrinter.printError(FilePrinter.QUEST_UNCODED, \"START Quest \" + questid + \" is uncoded.\\r\\n\");\n+                                                FilePrinter.printError(FilePrinter.QUEST_UNCODED, \"START Quest \" + questid + \" is uncoded.\");\n                                         }\n                                 }\n                                 if (iv == null || QuestScriptManager.getInstance() == null) {\n@@ -122,7 +122,7 @@ public void end(MapleClient c, short questid, int npc) {\n                                         if(GameConstants.isMedalQuest(questid)) {   // start generic medal quest\n                                                 iv = getInvocable(\"quest/medalQuest.js\", c);\n                                         } else {\n-                                                FilePrinter.printError(FilePrinter.QUEST_UNCODED, \"END Quest \" + questid + \" is uncoded.\\r\\n\");\n+                                                FilePrinter.printError(FilePrinter.QUEST_UNCODED, \"END Quest \" + questid + \" is uncoded.\");\n                                                 qm.dispose();\n                                                 return;\n                                         }"}, {"sha": "8416453e141e11e908344e2f43e7cc5c8352ddd6", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -1659,7 +1659,7 @@ public boolean canWearEquipment(MapleCharacter chr, Equip equip, int dst) {\n             String itemName = MapleItemInformationProvider.getInstance().getName(equip.getItemId());\n             Server.getInstance().broadcastGMMessage(chr.getWorld(), MaplePacketCreator.sendYellowTip(\"[WARNING]: \" + chr.getName() + \" tried to equip \" + itemName + \" into slot \" + dst + \".\"));\n             AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to forcibly equip an item.\");\n-            FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to equip \" + itemName + \" into \" + dst + \" slot.\\r\\n\");      \t\n+            FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to equip \" + itemName + \" into \" + dst + \" slot.\");\n             return false;\n         }\n         "}, {"sha": "6db3bd234dc0f582cd123674ff471be71a8f6c66", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -1016,6 +1016,14 @@ public final void applyComboBuff(final MapleCharacter applyto, int combo) {\n         applyto.registerEffect(this, starttime, Long.MAX_VALUE, false);\n     }\n     \n+    public final void applyBeaconBuff(final MapleCharacter applyto, int objectid) { // thanks Thora & Hyun for reporting an issue with homing beacon autoflagging mobs when changing maps\n+        final List<Pair<MapleBuffStat, Integer>> stat = Collections.singletonList(new Pair<>(MapleBuffStat.HOMING_BEACON, objectid));\n+        applyto.announce(MaplePacketCreator.giveBuff(1, sourceid, stat));\n+\n+        final long starttime = Server.getInstance().getCurrentTime();\n+        applyto.registerEffect(this, starttime, Long.MAX_VALUE, false);\n+    }\n+    \n     public void updateBuffEffect(MapleCharacter target, List<Pair<MapleBuffStat, Integer>> activeStats, long starttime) {\n         int localDuration = getBuffLocalDuration();\n         localDuration = alchemistModifyVal(target, localDuration, false);"}, {"sha": "5b4d1fff584de76f0fa6fa23fa46acd6afc5fdaf", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -1952,7 +1952,7 @@ public void sendPackets(MapleClient c) {\n             } else if (monster.getId() == 9400326 || monster.getId() == 9400331 || monster.getId() == 9400336) {\n                 monsterItemDrop(monster, monster.getDropPeriodTime());\n             } else {\n-                FilePrinter.printError(FilePrinter.UNHANDLED_EVENT, \"UNCODED TIMED MOB DETECTED: \" + monster.getId() + \"\\r\\n\");\n+                FilePrinter.printError(FilePrinter.UNHANDLED_EVENT, \"UNCODED TIMED MOB DETECTED: \" + monster.getId());\n             }\n         }\n         "}, {"sha": "cef5a64c29081eb02f201b831c4cc23bd6dba436", "filename": "src/tools/FilePrinter.java", "status": "modified", "additions": 70, "deletions": 50, "changes": 120, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/FilePrinter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/FilePrinter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/FilePrinter.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -11,55 +11,67 @@\n public class FilePrinter {\n \n     public static final String \n-            ACCOUNT_STUCK = \"accountStuck.txt\",\n-            EXCEPTION_CAUGHT = \"exceptionCaught.txt\",\n-            CLIENT_START = \"clientStartError.txt\",\n-            ADD_PLAYER = \"addPlayer.txt\",\n-            MAPLE_MAP = \"mapleMap.txt\",\n-            ERROR38 = \"error38.txt\",\n-            PACKET_LOG = \"log.txt\",\n-            CASHITEM_BOUGHT = \"cashlog.txt\",\n-            EXCEPTION = \"exceptions.txt\",\n-            SQL_EXCEPTION = \"sqlexceptions.txt\",\n-            PACKET_HANDLER = \"PacketHandler/\",\n-            PORTAL = \"portals/\",\n-            PORTAL_STUCK = \"portalblocks/\",\n-            NPC = \"npcs/\",\n-            INVOCABLE = \"invocable/\",\n-            REACTOR = \"reactors/\",\n-            QUEST = \"quests/\",\n-            ITEM = \"items/\",\n-            MOB_MOVEMENT = \"mobmovement.txt\",\n-            MAP_SCRIPT = \"mapscript/\",\n-            DIRECTION = \"directions/\",\n-            SAVE_CHAR = \"saveToDB.txt\",\n-            INSERT_CHAR = \"insertCharacter.txt\",\n-            LOAD_CHAR = \"loadCharFromDB.txt\",\n-            UNHANDLED_EVENT = \"doesNotExist.txt\",\n-            SESSION = \"sessions.txt\",\n-            EXPLOITS = \"exploits/\",\n-            STORAGE = \"storage/\",\n-            PACKET_LOGS = \"packetlogs/\",\n-            DELETED_CHARACTERS = \"deletedchars/\",\n-            FREDRICK = \"fredrick/\",\n-            NPC_UNCODED = \"uncodedNPCs.txt\",\n-            QUEST_UNCODED = \"uncodedQuests.txt\",\n-            AUTOSAVING_CHARACTER = \"saveCharAuto.txt\",\n-            SAVING_CHARACTER = \"saveChar.txt\",\n-            USED_COMMANDS = \"usedCommands.txt\",\n-            DEADLOCK_ERROR = \"deadlocks.txt\",\n-            DEADLOCK_STACK = \"deadlocks/path.txt\",\n-            DEADLOCK_LOCKS = \"deadlocks/locks.txt\",\n-            DEADLOCK_STATE = \"deadlocks/state.txt\",\n-            DISPOSED_LOCKS = \"deadlocks/disposed.txt\";\n+            AUTOBAN_WARNING = \"game/AutoBanWarning.txt\",    // log naming version by Vcoc\n+            AUTOBAN_DC = \"game/AutoBanDC.txt\",\n+            ACCOUNT_STUCK = \"players/AccountStuck.txt\",\n+            COMMAND_GM = \"reports/Gm.txt\",\n+            COMMAND_BUG = \"reports/Bug.txt\",\n+            LOG_TRADE = \"interactions/Trades.txt\",\n+            LOG_EXPEDITION = \"interactions/Expeditions.txt\",\n+            LOG_LEAF = \"interactions/MapleLeaves.txt\",\n+            LOG_GACHAPON = \"interactions/Gachapon.txt\",\n+            LOG_CHAT = \"interactions/ChatLog.txt\",\n+            EXCEPTION_CAUGHT = \"game/ExceptionCaught.txt\",\n+            CLIENT_START = \"game/ClientStartError.txt\",\n+            MAPLE_MAP = \"game/MapleMap.txt\",\n+            ERROR38 = \"game/Error38.txt\",\n+            PACKET_LOG = \"game/Log.txt\",\n+            CASHITEM_BOUGHT = \"interactions/CashLog.txt\",\n+            EXCEPTION = \"game/Exceptions.txt\",\n+            SQL_EXCEPTION = \"game/SqlExceptions.txt\",\n+            PACKET_HANDLER = \"game/packethandler/\",\n+            PORTAL = \"game/portals/\",\n+            PORTAL_STUCK = \"game/portalblocks/\",\n+            NPC = \"game/npcs/\",\n+            INVOCABLE = \"game/invocable/\",\n+            REACTOR = \"game/reactors/\",\n+            QUEST = \"game/quests/\",\n+            ITEM = \"game/items/\",\n+            MOB_MOVEMENT = \"game/MobMovement.txt\",\n+            MAP_SCRIPT = \"game/mapscript/\",\n+            DIRECTION = \"game/directions/\",\n+            SAVE_CHAR = \"players/SaveToDB.txt\",\n+            INSERT_CHAR = \"players/InsertCharacter.txt\",\n+            LOAD_CHAR = \"players/LoadCharFromDB.txt\",\n+            CREATED_CHAR = \"players/createdchars/\",\n+            DELETED_CHAR = \"players/deletedchars/\",\n+            UNHANDLED_EVENT = \"game/DoesNotExist.txt\",\n+            SESSION = \"players/Sessions.txt\",\n+            EXPLOITS = \"game/exploits/\",\n+            STORAGE = \"game/storage/\",\n+            PACKET_LOGS = \"game/packetlogs/\",\n+            FREDRICK = \"game/npcs/fredrick/\",\n+            NPC_UNCODED = \"game/npcs/UncodedNPCs.txt\",\n+            QUEST_UNCODED = \"game/quests/UncodedQuests.txt\",\n+            AUTOSAVING_CHARACTER = \"players/SaveCharAuto.txt\",\n+            SAVING_CHARACTER = \"players/SaveChar.txt\",\n+            USED_COMMANDS = \"commands/UsedCommands.txt\",\n+            DEADLOCK_ERROR = \"deadlocks/Deadlocks.txt\",\n+            DEADLOCK_STACK = \"deadlocks/Path.txt\",\n+            DEADLOCK_LOCKS = \"deadlocks/Locks.txt\",\n+            DEADLOCK_STATE = \"deadlocks/State.txt\",\n+            DISPOSED_LOCKS = \"deadlocks/Disposed.txt\";\n     \n     private static final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\"); //for file system purposes, it's nice to use yyyy-MM-dd\n     private static final String FILE_PATH = \"logs/\" + sdf.format(Calendar.getInstance().getTime()) + \"/\"; // + sdf.format(Calendar.getInstance().getTime()) + \"/\"\n     private static final String ERROR = \"error/\";\n \n     public static void printError(final String name, final Throwable t) {\n+        String stringT = getString(t);\n+        \n     \tSystem.out.println(\"Error thrown: \" + name);\n-    \tSystem.out.println(getString(t));\n+    \tSystem.out.println(stringT);\n+        System.out.println();\n         FileOutputStream out = null;\n         final String file = FILE_PATH + ERROR + name;\n         try {\n@@ -68,8 +80,9 @@ public static void printError(final String name, final Throwable t) {\n                 outputFile.getParentFile().mkdirs();\n             }\n             out = new FileOutputStream(file, true);\n-            out.write(getString(t).getBytes());\n-            out.write(\"\\n---------------------------------\\r\\n\".getBytes());\n+            out.write(stringT.getBytes());\n+            out.write(\"\\r\\n---------------------------------\\r\\n\".getBytes());\n+            out.write(\"\\r\\n\".getBytes()); // thanks Vcoc for suggesting review body log structure\n         } catch (IOException ess) {\n             ess.printStackTrace();\n         } finally {\n@@ -84,8 +97,11 @@ public static void printError(final String name, final Throwable t) {\n     }\n \n     public static void printError(final String name, final Throwable t, final String info) {\n+        String stringT = getString(t);\n+        \n     \tSystem.out.println(\"Error thrown: \" + name);\n-    \tSystem.out.println(getString(t));\n+    \tSystem.out.println(stringT);\n+        System.out.println();\n         FileOutputStream out = null;\n         final String file = FILE_PATH + ERROR + name;\n         try {\n@@ -95,8 +111,9 @@ public static void printError(final String name, final Throwable t, final String\n             }\n             out = new FileOutputStream(file, true);\n             out.write((info + \"\\r\\n\").getBytes());\n-            out.write(getString(t).getBytes());\n-            out.write(\"\\n---------------------------------\\r\\n\".getBytes());\n+            out.write(stringT.getBytes());\n+            out.write(\"\\r\\n---------------------------------\\r\\n\".getBytes());\n+            out.write(\"\\r\\n\".getBytes());\n         } catch (IOException ess) {\n             ess.printStackTrace();\n         } finally {\n@@ -113,6 +130,7 @@ public static void printError(final String name, final Throwable t, final String\n     public static void printError(final String name, final String s) {\n     \tSystem.out.println(\"Error thrown: \" + name);\n     \tSystem.out.println(s);\n+        System.out.println();\n         FileOutputStream out = null;\n         final String file = FILE_PATH + ERROR + name;\n         try {\n@@ -122,7 +140,8 @@ public static void printError(final String name, final String s) {\n             }\n             out = new FileOutputStream(file, true);\n             out.write(s.getBytes());\n-            //out.write(\"\\n---------------------------------\\n\".getBytes());\n+            //out.write(\"\\r\\n---------------------------------\\r\\n\".getBytes());\n+            out.write(\"\\r\\n\".getBytes());\n         } catch (IOException ess) {\n             ess.printStackTrace();\n         } finally {\n@@ -143,6 +162,7 @@ public static void print(final String name, final String s) {\n     public static void print(final String name, final String s, boolean line) {\n     \tSystem.out.println(\"Log: \" + name);\n     \tSystem.out.println(s);\n+        System.out.println();\n         FileOutputStream out = null;\n         String file = FILE_PATH + name;\n         try {\n@@ -152,10 +172,10 @@ public static void print(final String name, final String s, boolean line) {\n             }\n             out = new FileOutputStream(file, true);\n             out.write(s.getBytes());\n-            out.write(\"\\r\\n\".getBytes());\n             if (line) {\n-                out.write(\"---------------------------------\\r\\n\".getBytes());\n+                out.write(\"\\r\\n---------------------------------\\r\\n\".getBytes());\n             }\n+            out.write(\"\\r\\n\".getBytes());\n         } catch (IOException ess) {\n             ess.printStackTrace();\n         } finally {"}, {"sha": "f34d6422b6143fe322eeb6773a97d733b8d8b5f2", "filename": "src/tools/LogHelper.java", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/LogHelper.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/LogHelper.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/LogHelper.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -6,9 +6,6 @@\n \n import client.MapleClient;\n import net.server.Server;\n-import net.server.channel.Channel;\n-import net.server.world.MapleParty;\n-import net.server.world.MaplePartyCharacter;\n import server.MapleItemInformationProvider;\n import server.MapleTrade;\n import server.expeditions.MapleExpedition;\n@@ -34,7 +31,7 @@ public static void logTrade(MapleTrade trade1, MapleTrade trade2) {\n \t\t\tlog += item.getQuantity() + \" \" + itemName + \" from \" + name2 + \" to \" + name1 + \" \\r\\n\";;\n \t\t}\n \t\tlog += \"\\r\\n\\r\\n\";\n-\t\tFilePrinter.print(\"trades.txt\", log);\n+\t\tFilePrinter.print(FilePrinter.LOG_TRADE, log);\n \t}\n \n \tpublic static void logExpedition(MapleExpedition expedition) {\n@@ -50,8 +47,8 @@ public static void logExpedition(MapleExpedition expedition) {\n \t\tfor (String message: expedition.getBossLogs()){\n \t\t\tlog += message;\n \t\t}\n-\t\tlog += \"\\r\\n\\r\\n\";\n-\t\tFilePrinter.print(\"expeditions.txt\", log);\n+\t\tlog += \"\\r\\n\";\n+\t\tFilePrinter.print(FilePrinter.LOG_EXPEDITION, log);\n \t}\n \t\n \tpublic static String getTimeString(long then){\n@@ -63,20 +60,20 @@ public static String getTimeString(long then){\n \n \tpublic static void logLeaf(MapleCharacter player, boolean gotPrize, String operation) {\n \t\tString timeStamp = new SimpleDateFormat(\"dd-MM-yyyy hh:mm:ss\").format(new Date());\n-\t\tString log = player.getName() + (gotPrize ? \" used a maple leaf to buy \" + operation : \" redeemed \" + operation + \" VP for a leaf\") + \" - \" + timeStamp + \"\\r\\n\";\n-\t\tFilePrinter.print(\"mapleleaves.txt\", log);\n+\t\tString log = player.getName() + (gotPrize ? \" used a maple leaf to buy \" + operation : \" redeemed \" + operation + \" VP for a leaf\") + \" - \" + timeStamp;\n+\t\tFilePrinter.print(FilePrinter.LOG_LEAF, log);\n \t}\n \t\n \tpublic static void logGacha(MapleCharacter player, int itemid, String map) {\n \t\tString itemName = MapleItemInformationProvider.getInstance().getName(itemid);\n \t\tString timeStamp = new SimpleDateFormat(\"dd-MM-yyyy hh:mm:ss\").format(new Date());\n-\t\tString log = player.getName() + \" got a \" + itemName + \"(\" + itemid + \") from the \" + map + \" gachapon. - \" + timeStamp + \"\\r\\n\";\n-\t\tFilePrinter.print(\"gachapon.txt\", log);\n+\t\tString log = player.getName() + \" got a \" + itemName + \"(\" + itemid + \") from the \" + map + \" gachapon. - \" + timeStamp;\n+\t\tFilePrinter.print(FilePrinter.LOG_GACHAPON, log);\n \t}\n \n \tpublic static void logChat(MapleClient player, String chatType, String text){\n \t\tSimpleDateFormat sdf = new SimpleDateFormat(\"dd-MM-yyyy HH:mm\");\n-\t\tFilePrinter.print(\"chat.txt\", \"[\" + sdf.format(Calendar.getInstance().getTime()) + \"] (\" + chatType + \") \" +player.getPlayer().getName() + \": \" + text + \"\\r\\n\");\n+\t\tFilePrinter.print(FilePrinter.LOG_CHAT, \"[\" + sdf.format(Calendar.getInstance().getTime()) + \"] (\" + chatType + \") \" +player.getPlayer().getName() + \": \" + text);\n \t}\n \n }"}, {"sha": "2ee01e10416548f61dca4e269e125aa36d6a14f9", "filename": "src/tools/MapleLogger.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/MapleLogger.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/MapleLogger.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MapleLogger.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -49,7 +49,7 @@ public static void logRecv(MapleClient c, short packetId, Object message) {\n \t\t\treturn;\n \t\t}\n \t\tString packet = op.toString() + \"\\r\\n\" + HexTool.toString((byte[]) message);\n-\t\tFilePrinter.printError(FilePrinter.PACKET_LOGS + c.getAccountName() + \"-\" + c.getPlayer().getName() + \".txt\", packet + \"\\r\\n\\r\\n\");\n+\t\tFilePrinter.printError(FilePrinter.PACKET_LOGS + c.getAccountName() + \"-\" + c.getPlayer().getName() + \".txt\", packet);\n \t}\n \t\n \tprivate static final boolean isRecvBlocked(RecvOpcode op){"}, {"sha": "c9dde3513b6d5b6602b65a5fc6f04d4dc698a5b0", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -120,7 +120,7 @@\n public class MaplePacketCreator {\n \n         public static final List<Pair<MapleStat, Integer>> EMPTY_STATUPDATE = Collections.emptyList();\n-        private final static long FT_UT_OFFSET = 116444592000000000L; // EDT\n+        private final static long FT_UT_OFFSET = 116444628000000000L;\n         private final static long DEFAULT_TIME = 150842304000000000L;//00 80 05 BB 46 E6 17 02\n         public final static long ZERO_TIME = 94354848000000000L;//00 40 E0 FD 3B 37 4F 01\n         private final static long PERMANENT = 150841440000000000L; // 00 C0 9B 90 7D E5 17 02\n@@ -363,7 +363,7 @@ private static void addQuestInfo(final MaplePacketLittleEndianWriter mplew, Mapl\n         }\n \n         private static void addExpirationTime(final MaplePacketLittleEndianWriter mplew, long time) {\n-                mplew.writeLong(getTime(time));\n+                mplew.writeLong(getTime(time)); // offset expiration time issue found thanks to Thora\n         }\n \n         private static void addItemInfo(final MaplePacketLittleEndianWriter mplew, Item item) {\n@@ -1064,8 +1064,8 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.write(spawnPoint);\n                 mplew.writeShort(chr.getHp());\n                 mplew.writeBool(false);\n-                mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(8);\n+                mplew.writeLong(0);                 // getTime(Server.getInstance().getCurrentTime())?\n+                mplew.skip(ServerConstants.DEBUG_VALUES[0]);\n                 return mplew.getPacket();\n         }\n         \n@@ -1081,8 +1081,8 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.writeBool(true);\n                 mplew.writeInt(spawnPosition.x);    // spawn position placement thanks to Arnah (Vertisy)\n                 mplew.writeInt(spawnPosition.y);\n-                mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(8);\n+                mplew.writeLong(0);                 // getTime(Server.getInstance().getCurrentTime())?\n+                mplew.skip(ServerConstants.DEBUG_VALUES[0]);\n                 return mplew.getPacket();\n         }\n         \n@@ -2867,7 +2867,7 @@ private static int doubleToShortBits(double d) {\n                 mplew.write(1);\n                 mplew.writeShort(quest);\n                 mplew.write(2);\n-                mplew.writeLong(time);\n+                mplew.writeLong(getTime(time));\n                 return mplew.getPacket();\n         }\n "}, {"sha": "48531a52761625601e07efe90754baac829d1674", "filename": "wz/Mob.wz/9400638.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400638.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400638.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400638.img.xml?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -18,7 +18,7 @@\n     <float name=\"fs\" value=\"10.0\"/>\n     <int name=\"summonType\" value=\"1\"/>\n     <string name=\"elemAttr\" value=\"S1H3\"/>\n-    <int name=\"firstAttack\" value=\"1\"/>\n+    <int name=\"firstAttack\" value=\"0\"/>\n   </imgdir>\n   <imgdir name=\"move\">\n     <canvas name=\"0\" width=\"99\" height=\"126\">"}, {"sha": "ee46fb8a19a50463ea133165ce438e629f7864af", "filename": "wz/Mob.wz/9400639.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400639.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400639.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400639.img.xml?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -17,7 +17,7 @@\n     <int name=\"pushed\" value=\"1\"/>\n     <float name=\"fs\" value=\"10.0\"/>\n     <int name=\"summonType\" value=\"1\"/>\n-    <int name=\"firstAttack\" value=\"1\"/>\n+    <int name=\"firstAttack\" value=\"0\"/>\n   </imgdir>\n   <imgdir name=\"move\">\n     <canvas name=\"0\" width=\"132\" height=\"127\">"}, {"sha": "2511b500eac3932f7f958c0eac22e2c392ea932d", "filename": "wz/Mob.wz/9400640.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400640.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/Mob.wz/9400640.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Mob.wz/9400640.img.xml?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -17,7 +17,7 @@\n     <int name=\"pushed\" value=\"1200\"/>\n     <float name=\"fs\" value=\"10.0\"/>\n     <int name=\"summonType\" value=\"1\"/>\n-    <int name=\"firstAttack\" value=\"1\"/>\n+    <int name=\"firstAttack\" value=\"0\"/>\n   </imgdir>\n   <imgdir name=\"move\">\n     <canvas name=\"0\" width=\"82\" height=\"86\">"}, {"sha": "76726b3dfbcf49b64c7279e48d31f1f086c564db", "filename": "wz/String.wz/Skill.img.xml", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/String.wz/Skill.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b47dd03a3e1be2833b9be8c628a9dad5722f14e2/wz/String.wz/Skill.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Skill.img.xml?ref=b47dd03a3e1be2833b9be8c628a9dad5722f14e2", "patch": "@@ -8702,26 +8702,26 @@\n   <imgdir name=\"5121003\">\n     <string name=\"name\" value=\"Super Transformation\"/>\n     <string name=\"desc\" value=\"Increases power to extreme levels for 120 seconds. \\nAvailable skills : Changes have been made so that while using the Viper skill, Super Transform, you can now use all skills excluding the Oak Barrel and the Double Fire. \\nRequired Skill : #cLevel 20 of Transformation#\"/>\n-    <string name=\"h1\" value=\"MP -22; weapon &amp; magic att. +41, waiting time until next use : 740 sec.\"/>\n-    <string name=\"h2\" value=\"MP -24; weapon &amp; magic att. +42, waiting time until next use : 720 sec.\"/>\n-    <string name=\"h3\" value=\"MP -26; weapon &amp; magic att. +43, waiting time until next use : 700 sec.\"/>\n-    <string name=\"h4\" value=\"MP -28; weapon &amp; magic att. +44, waiting time until next use : 680 sec.\"/>\n-    <string name=\"h5\" value=\"MP -30; weapon &amp; magic att. +45, waiting time until next use : 660 sec.\"/>\n-    <string name=\"h6\" value=\"MP -32; weapon &amp; magic att. +46, waiting time until next use : 640 sec.\"/>\n-    <string name=\"h7\" value=\"MP -34; weapon &amp; magic att. +47, waiting time until next use : 620 sec.\"/>\n-    <string name=\"h8\" value=\"MP -36; weapon &amp; magic att. +48, waiting time until next use : 600 sec.\"/>\n-    <string name=\"h9\" value=\"MP -38; weapon &amp; magic att. +49, waiting time until next use : 580 sec.\"/>\n-    <string name=\"h10\" value=\"MP -40; weapon &amp; magic att. +50, waiting time until next use : 560 sec.\"/>\n-    <string name=\"h11\" value=\"MP -42; weapon &amp; magic att. +51, waiting time until next use : 540 sec.\"/>\n-    <string name=\"h12\" value=\"MP -44; weapon &amp; magic att. +52, waiting time until next use : 520 sec.\"/>\n-    <string name=\"h13\" value=\"MP -46; weapon &amp; magic att. +53, waiting time until next use : 500 sec.\"/>\n-    <string name=\"h14\" value=\"MP -48; weapon &amp; magic att. +54, waiting time until next use : 480 sec.\"/>\n-    <string name=\"h15\" value=\"MP -50; weapon &amp; magic att. +55, waiting time until next use : 460 sec.\"/>\n-    <string name=\"h16\" value=\"MP -52; weapon &amp; magic att. +56, waiting time until next use : 440 sec.\"/>\n-    <string name=\"h17\" value=\"MP -54; weapon &amp; magic att. +57, waiting time until next use : 420 sec.\"/>\n-    <string name=\"h18\" value=\"MP -56; weapon &amp; magic att. +58, waiting time until next use : 400 sec.\"/>\n-    <string name=\"h19\" value=\"MP -58; weapon &amp; magic att. +59, waiting time until next use : 380 sec.\"/>\n-    <string name=\"h20\" value=\"MP -60; weapon &amp; magic att. +60, waiting time until next use : 360 sec.\"/>\n+    <string name=\"h1\" value=\"MP -22; weapon &amp; magic def. +41, waiting time until next use : 740 sec.\"/>\n+    <string name=\"h2\" value=\"MP -24; weapon &amp; magic def. +42, waiting time until next use : 720 sec.\"/>\n+    <string name=\"h3\" value=\"MP -26; weapon &amp; magic def. +43, waiting time until next use : 700 sec.\"/>\n+    <string name=\"h4\" value=\"MP -28; weapon &amp; magic def. +44, waiting time until next use : 680 sec.\"/>\n+    <string name=\"h5\" value=\"MP -30; weapon &amp; magic def. +45, waiting time until next use : 660 sec.\"/>\n+    <string name=\"h6\" value=\"MP -32; weapon &amp; magic def. +46, waiting time until next use : 640 sec.\"/>\n+    <string name=\"h7\" value=\"MP -34; weapon &amp; magic def. +47, waiting time until next use : 620 sec.\"/>\n+    <string name=\"h8\" value=\"MP -36; weapon &amp; magic def. +48, waiting time until next use : 600 sec.\"/>\n+    <string name=\"h9\" value=\"MP -38; weapon &amp; magic def. +49, waiting time until next use : 580 sec.\"/>\n+    <string name=\"h10\" value=\"MP -40; weapon &amp; magic def. +50, waiting time until next use : 560 sec.\"/>\n+    <string name=\"h11\" value=\"MP -42; weapon &amp; magic def. +51, waiting time until next use : 540 sec.\"/>\n+    <string name=\"h12\" value=\"MP -44; weapon &amp; magic def. +52, waiting time until next use : 520 sec.\"/>\n+    <string name=\"h13\" value=\"MP -46; weapon &amp; magic def. +53, waiting time until next use : 500 sec.\"/>\n+    <string name=\"h14\" value=\"MP -48; weapon &amp; magic def. +54, waiting time until next use : 480 sec.\"/>\n+    <string name=\"h15\" value=\"MP -50; weapon &amp; magic def. +55, waiting time until next use : 460 sec.\"/>\n+    <string name=\"h16\" value=\"MP -52; weapon &amp; magic def. +56, waiting time until next use : 440 sec.\"/>\n+    <string name=\"h17\" value=\"MP -54; weapon &amp; magic def. +57, waiting time until next use : 420 sec.\"/>\n+    <string name=\"h18\" value=\"MP -56; weapon &amp; magic def. +58, waiting time until next use : 400 sec.\"/>\n+    <string name=\"h19\" value=\"MP -58; weapon &amp; magic def. +59, waiting time until next use : 380 sec.\"/>\n+    <string name=\"h20\" value=\"MP -60; weapon &amp; magic def. +60, waiting time until next use : 360 sec.\"/>\n   </imgdir>\n   <imgdir name=\"5121004\">\n     <string name=\"name\" value=\"Demolition\"/>"}]}]},
