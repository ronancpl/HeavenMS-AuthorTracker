{"fetchDate": "2019-12-19", "content": [{"sha": "ab6074a40c3f14f084a9e2b64e373217fc624ef9", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YWI2MDc0YTQwYzNmMTRmMDg0YTllMmI2NGUzNzMyMTdmYzYyNGVmOQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2016-08-01T14:17:31Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2016-08-01T14:17:31Z"}, "message": "Script clean-up Patch\n\nFixed bugs in some scripts, minor game patches.", "tree": {"sha": "93ab53aba131802ca3414feea23542e28d68fa60", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/93ab53aba131802ca3414feea23542e28d68fa60"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/ab6074a40c3f14f084a9e2b64e373217fc624ef9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ab6074a40c3f14f084a9e2b64e373217fc624ef9", "html_url": "https://github.com/ronancpl/HeavenMS/commit/ab6074a40c3f14f084a9e2b64e373217fc624ef9", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ab6074a40c3f14f084a9e2b64e373217fc624ef9/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "63d0e87d4d99a91309a40045a010d37e8cad97f9", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/63d0e87d4d99a91309a40045a010d37e8cad97f9", "html_url": "https://github.com/ronancpl/HeavenMS/commit/63d0e87d4d99a91309a40045a010d37e8cad97f9"}], "stats": {"total": 304, "additions": 255, "deletions": 49}, "files": [{"sha": "818b48edf05d7f028a83646a7e1b587604685b7f", "filename": "scripts/event/PiratePQ.js", "status": "added", "additions": 154, "deletions": 0, "changes": 154, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/event/PiratePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/event/PiratePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PiratePQ.js?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -0,0 +1,154 @@\n+var minPlayers = 1;\n+\n+function init() {\n+em.setProperty(\"state\", \"0\");\n+\tem.setProperty(\"leader\", \"true\");\n+}\n+\n+function setup(level, leaderid) {\n+em.setProperty(\"state\", \"1\");\n+\tem.setProperty(\"leader\", \"true\");\n+    var eim = em.newInstance(\"Pirate\" + leaderid);\n+\tem.setProperty(\"stage2\", \"0\");\n+\tem.setProperty(\"stage2a\", \"0\");\n+\tem.setProperty(\"stage3a\", \"0\");\n+\tem.setProperty(\"stage4\", \"0\");\n+\tem.setProperty(\"stage5\", \"0\");\n+        eim.setInstanceMap(925100000).resetPQ(level);\n+\teim.setInstanceMap(925100100).resetPQ(level);\n+\tvar map = eim.setInstanceMap(925100200);\n+\tmap.resetPQ(level);\n+\tfor (var i = 0; i < 5; i++) {\n+\t\tvar mob = em.getMonster(9300124);\n+\t\tvar mob2 = em.getMonster(9300125);\n+\t\tvar mob3 = em.getMonster(9300124);\n+\t\tvar mob4 = em.getMonster(9300125);\n+\t\teim.registerMonster(mob);\n+\t\teim.registerMonster(mob2);\n+\t\teim.registerMonster(mob3);\n+\t\teim.registerMonster(mob4);\n+\t\tmob.changeLevel(level);\n+\t\tmob2.changeLevel(level);\n+\t\tmob3.changeLevel(level);\n+\t\tmob4.changeLevel(level);\n+\t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(430, 75));\n+\t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1600, 75));\n+\t\tmap.spawnMonsterOnGroundBelow(mob3, new java.awt.Point(430, 238));\n+\t\tmap.spawnMonsterOnGroundBelow(mob4, new java.awt.Point(1600, 238));\n+\t}\n+\tmap = eim.setInstanceMap(925100201);\n+\tmap.resetPQ(level);\n+\tfor (var i = 0; i < 10; i++) {\n+\t\tvar mob = em.getMonster(9300112);\n+\t\tvar mob2 = em.getMonster(9300113);\n+\t\teim.registerMonster(mob);\n+\t\teim.registerMonster(mob2);\n+\t\tmob.changeLevel(level);\n+\t\tmob2.changeLevel(level);\n+\t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(0, 238));\n+\t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1700, 238));\n+\t}\n+\teim.setInstanceMap(925100202).resetPQ(level);\n+\tmap = eim.setInstanceMap(925100300);\n+\tmap.resetPQ(level);\n+\tfor (var i = 0; i < 5; i++) {\n+\t\tvar mob = em.getMonster(9300124);\n+\t\tvar mob2 = em.getMonster(9300125);\n+\t\tvar mob3 = em.getMonster(9300124);\n+\t\tvar mob4 = em.getMonster(9300125);\n+\t\teim.registerMonster(mob);\n+\t\teim.registerMonster(mob2);\n+\t\teim.registerMonster(mob3);\n+\t\teim.registerMonster(mob4);\n+\t\tmob.changeLevel(level);\n+\t\tmob2.changeLevel(level);\n+\t\tmob3.changeLevel(level);\n+\t\tmob4.changeLevel(level);\n+\t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(430, 75));\n+\t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1600, 75));\n+\t\tmap.spawnMonsterOnGroundBelow(mob3, new java.awt.Point(430, 238));\n+\t\tmap.spawnMonsterOnGroundBelow(mob4, new java.awt.Point(1600, 238));\n+\t}\n+\tmap = eim.setInstanceMap(925100301);\n+\tmap.resetPQ(level);\n+\tfor (var i = 0; i < 10; i++) {\n+\t\tvar mob = em.getMonster(9300112);\n+\t\tvar mob2 = em.getMonster(9300113);\n+\t\teim.registerMonster(mob);\n+\t\teim.registerMonster(mob2);\n+\t\tmob.changeLevel(level);\n+\t\tmob2.changeLevel(level);\n+\t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(0, 238));\n+\t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1700, 238));\n+\t}\n+\teim.setInstanceMap(925100302).resetPQ(level);\n+\teim.setInstanceMap(925100400).resetPQ(level);\n+\teim.setInstanceMap(925100500).resetPQ(level);\n+\n+    eim.startEventTimer(1200000); //20 mins\n+    return eim;\n+}\n+\n+function playerEntry(eim, player) {\n+    var map = eim.getMapInstance(0);\n+    player.changeMap(map, map.getPortal(0));\n+    player.tryPartyQuest(1204);\n+}\n+\n+function playerRevive(eim, player) {\n+}\n+\n+function scheduledTimeout(eim) {\n+    end(eim);\n+}\n+\n+function changedMap(eim, player, mapid) {\n+    if (mapid < 925100000 || mapid > 925100500) {\n+\teim.unregisterPlayer(player);\n+\n+\tif (eim.disposeIfPlayerBelow(0, 0)) {\n+\t\tem.setProperty(\"state\", \"0\");\n+\t\tem.setProperty(\"leader\", \"true\");\n+\t}\n+    }\n+}\n+\n+function playerDisconnected(eim, player) {\n+    return 0;\n+}\n+\n+function monsterValue(eim, mobId) {\n+    return 1;\n+}\n+\n+function playerExit(eim, player) {\n+    eim.unregisterPlayer(player);\n+\n+    if (eim.disposeIfPlayerBelow(0, 0)) {\n+\tem.setProperty(\"state\", \"0\");\n+\t\tem.setProperty(\"leader\", \"true\");\n+\t}\n+}\n+\n+function end(eim) {\n+    eim.disposeIfPlayerBelow(100, 925100700);\n+\tem.setProperty(\"state\", \"0\");\n+\t\tem.setProperty(\"leader\", \"true\");\n+}\n+\n+function clearPQ(eim) {\n+    end(eim);\n+}\n+\n+function allMonstersDead(eim) {\n+}\n+\n+function leftParty (eim, player) {\n+    // If only 2 players are left, uncompletable:\n+\tend(eim);\n+}\n+function disbandParty (eim) {\n+\tend(eim);\n+}\n+function playerDead(eim, player) {}\n+function cancelSchedule() {}\n\\ No newline at end of file"}, {"sha": "b4c8dd037f8a297b06d3aff532d0ccc2d967fcdf", "filename": "scripts/npc/world0/2094000.js", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/npc/world0/2094000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/npc/world0/2094000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094000.js?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -61,10 +61,12 @@ function action(mode, type, selection) {\n                     next = false;\n                 else {\n                     for (var i = 0; i < party.size() && next; i++) {\n-                        if ((party.get(i).getLevel() >= minLevel) && (party.get(i).getLevel() <= maxLevel))\n+                        if ((party.get(i).getLevel() >= minLevel) && (party.get(i).getLevel() <= maxLevel)) {\n                             levelValid += 1;\n-                        if (party.get(i).getMapid() == mapId)\n-                            inMap += 1;\n+\n+                            if (party.get(i).getMapId() == mapId)\n+                                inMap += 1;\n+\t\t\t}\n                     }\n                     if (levelValid < minPlayers || inMap < minPlayers)\n                         next = false;\n@@ -77,7 +79,7 @@ function action(mode, type, selection) {\n                     }\n                     else {\n                         em.startInstance(cm.getParty(),cm.getPlayer().getMap());\n-                        party = cm.getPlayer().getEventInstance().getPlayers();\n+                        party = cm.getParty().getMembers();\n                     }\n                     cm.dispose();\n                 }"}, {"sha": "afeb6c184253e7c650449d5ea325a21c5059b894", "filename": "scripts/npc/world0/9000036.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/npc/world0/9000036.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/scripts/npc/world0/9000036.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9000036.js?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n             \n         }else if (selection == 4) { //ring refine\n             var selStr = \"Rings, huh? These are my specialty, go check it yourself!#b\";\n-            items = [1112407, 1112408, 1112401, 1112405, 1112413, 1112414, 1112402];\n+            items = [1112407, 1112408, 1112401, 1112413, 1112414, 1112405, 1112402];\n             \n             for (var i = 0; i < items.length; i++)\n                 selStr += \"\\r\\n#L\" + i + \"##t\" + items[i] + \"##b\";\n@@ -121,7 +121,7 @@ function action(mode, type, selection) {\n             var matQtySet = [[2, 5, 10], [7777, 7777]];\n             var costSet = [15000, 7777];\n         }else if (selectedType == 4) { //ring refine\n-            var matSet = [[4003001, 4001344, 4006000], [4003001, 4001344, 4006000], [4021004, 4011008], [4011008, 4001006], [1112405, 2022039], [1112413, 4000176], [4011007, 4021009]];\n+            var matSet = [[4003001, 4001344, 4006000], [4003001, 4001344, 4006000], [4021004, 4011008], [4011008, 4001006], [1112413, 2022039], [1112414, 4000176], [4011007, 4021009]];\n             var matQtySet = [[2, 2, 2], [2, 2, 2], [1, 1], [1, 1], [1, 1], [1, 1], [1, 1]];\n             var costSet = [10000, 10000, 10000, 20000, 15000, 15000, 10000];\n         }else if (selectedType == 5) { //necklace refine"}, {"sha": "7501025366d4933f190e0a9495dcee76f127289e", "filename": "sql/db_database.sql", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -12789,7 +12789,8 @@ INSERT INTO `drop_data_global` (`id`, `continent`, `dropType`, `itemid`, `minimu\n (1, 0, 0, 4031865, 1, 1, 0, 150000, 'NX Card 100 PTS'),\n (2, 0, 0, 4031866, 1, 1, 0, 90000, 'NX Card 250 PTS'),\n (3, 0, 0, 4001126, 1, 2, 0, 10000, 'Maple Leaves'),\n-(4, 0, 0, 2049100, 1, 1, 0, 2000, 'Chaos Scroll 60%');\n+(4, 0, 0, 2049100, 1, 1, 0, 2000, 'Chaos Scroll 60%'),\n+(5, 0, 0, 4001006, 1, 1, 0, 12000, 'Flaming Feather');\n \n CREATE TABLE IF NOT EXISTS `dueyitems` (\n   `id` int(10) unsigned NOT NULL AUTO_INCREMENT,"}, {"sha": "4f8de854223cb6785886827dcf932b738ba68a98", "filename": "sql/db_drops.sql", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -3,7 +3,9 @@\n   INSERT IGNORE INTO temp_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n   #-- copy+paste inside here as many drop data as possible from the spider (drop generator) files --\n (5100004, 2383034, 1, 1, 0, 10000),\n-\n+(2100108, 2381030, 1, 1, 0, 10000),\n+(3230300, 2382021, 1, 1, 0, 10000),\n+(3230301, 2382021, 1, 1, 0, 10000),\n (100100, 4000019, 1, 1, 0, 200000),\n (100100, 2000000, 1, 1, 0, 40000), \n (100100, 2040002, 1, 1, 0, 750), "}, {"sha": "e24309df352ecf33cf4e59dbfd145723985060e9", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -852,16 +852,21 @@ public final void disconnect(boolean shutdown, boolean cashshop) {//once per Map\n \t\t\t\tFilePrinter.printError(FilePrinter.ACCOUNT_STUCK, e);\n \t\t\t} finally {\n \t\t\t\tgetChannelServer().removePlayer(player);\n-\t\t\t\tif (!this.serverTransition) {\n+                                \n+                                if (!this.serverTransition) {\n \t\t\t\t\tworlda.removePlayer(player);\n+                                        \n+                                        player.saveCooldowns();\n+                                        player.saveToDB();\n \t\t\t\t\tif (player != null) {//no idea, occur :(\n \t\t\t\t\t\tplayer.empty(false);\n \t\t\t\t\t}\n \t\t\t\t\tplayer.logOff();\n \t\t\t\t}\n-\t\t\t\t\n-                                player.saveCooldowns();\n-                                player.saveToDB();\n+                                else {\n+                                    player.saveCooldowns();\n+                                    player.saveToDB();\n+                                }\n                                 player = null;\n \t\t\t}\n \t\t}"}, {"sha": "ea33cd97336c3fbc2d35b5621238631dc68c6c44", "filename": "src/net/server/channel/handlers/ScrollHandler.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/net/server/channel/handlers/ScrollHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/net/server/channel/handlers/ScrollHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScrollHandler.java?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -67,6 +67,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleInventory useInventory = c.getPlayer().getInventory(MapleInventoryType.USE);\n         Item scroll = useInventory.getItem(slot);\n         Item wscroll = null;\n+\n         if (((Equip) toScroll).getUpgradeSlots() < 1 && !isCleanSlate(scroll.getItemId())) {\n             c.announce(MaplePacketCreator.getInventoryFull());\n             return;\n@@ -82,6 +83,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 whiteScroll = false;\n             }\n         }\n+\n         if (!isChaosScroll(scroll.getItemId()) && !isCleanSlate(scroll.getItemId())) {\n             if (!canScroll(scroll.getItemId(), toScroll.getItemId())) {\n                 return;\n@@ -130,6 +132,14 @@ private boolean isChaosScroll(int scrollId) {\n     }\n     \n     public boolean canScroll(int scrollid, int itemid) {\n-        return (scrollid / 100) % 100 == (itemid / 10000) % 100;\n+        int sid = scrollid / 100;\n+        \n+        switch(sid) {\n+            case 20492: //scroll for accessory (pendant, belt, ring)\n+                return canScroll(2041100, itemid) || canScroll(2041200, itemid) || canScroll(2041300, itemid);\n+                \n+            default:\n+                return (scrollid / 100) % 100 == (itemid / 10000) % 100;\n+        }\n     }\n }"}, {"sha": "74dd8e268468a85edac5833f5dddb4424b4be322", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -304,6 +304,11 @@ public Item gainItem(int id, short quantity, boolean randomStats, boolean showMe\n             return gainItem(id, quantity, randomStats, showMessage, expires, null);\n         }\n         \n+        private boolean isAccessory(int id) {\n+            int val = id / 10000;\n+            return(val >= 111 && val <= 113);\n+        }\n+        \n \tpublic Item gainItem(int id, short quantity, boolean randomStats, boolean showMessage, long expires, MaplePet from) {\n \t\tItem item = null;\n                 MaplePet evolved = null;\n@@ -336,6 +341,11 @@ public Item gainItem(int id, short quantity, boolean randomStats, boolean showMe\n \t\t\tif (ii.getInventoryType(id).equals(MapleInventoryType.EQUIP)) {\n \t\t\t\titem = ii.getEquipById(id);\n                                 \n+                                if(item != null) {\n+                                    Equip it = (Equip)item;\n+                                    if(isAccessory(item.getItemId()) && it.getUpgradeSlots() <= 0) it.setUpgradeSlots(3);\n+                                }\n+                                \n                                 if(ServerConstants.USE_ENHANCED_CRAFTING == true && c.getPlayer().getCS() == true)\n                                     item = MapleItemInformationProvider.getInstance().scrollEquipWithId(item, 2049100, true, c.getPlayer().isGM());\n \t\t\t} else {"}, {"sha": "b11108e5d3c78eb28c9fa59ca6a5b336a2c8ad93", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -59,6 +59,9 @@\n \tprivate long timeStarted = 0;\n \tprivate long eventTime = 0;\n \tprivate MapleExpedition expedition = null;\n+        private List<Integer> mapIds = new LinkedList<Integer>();\n+        private List<Boolean> isInstanced = new LinkedList<Boolean>();\n+        private boolean disposed = false;\n \n \tpublic EventInstanceManager(EventManager em, String name) {\n \t\tthis.em = em;\n@@ -322,4 +325,13 @@ public void removePlayer(MapleCharacter chr) {\n \tpublic boolean isLeader(MapleCharacter chr) {\n \t\treturn (chr.getParty().getLeader().getId() == chr.getId());\n \t}\n+        \n+        public final MapleMap setInstanceMap(final int mapid) { //gets instance map from the channelserv\n+            if (disposed) {\n+                return this.getMapFactory().getMap(mapid);\n+            }\n+            mapIds.add(mapid);\n+            isInstanced.add(false);\n+            return this.getMapFactory().getMap(mapid);\n+        }\n }"}, {"sha": "2e156bedc7463e0a7887741154c49dc06c740d23", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 46, "deletions": 36, "changes": 82, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/ab6074a40c3f14f084a9e2b64e373217fc624ef9/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=ab6074a40c3f14f084a9e2b64e373217fc624ef9", "patch": "@@ -411,7 +411,12 @@ public double getPrice(int itemId) {\n             if (pData == null) {\n                 return -1;\n             }\n-            pEntry = (double) MapleDataTool.getInt(pData);\n+            try {\n+                pEntry = (double) MapleDataTool.getInt(pData);\n+            } catch(Exception e) {\n+                priceCache.put(itemId, 0.0);\n+                return 0;\n+            }\n         }\n         priceCache.put(itemId, pEntry);\n         return pEntry;\n@@ -522,11 +527,12 @@ private double testYourLuck() {\n     public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll, boolean isGM) {\n         if (equip instanceof Equip) {\n             Equip nEquip = (Equip) equip;\n+            \n             Map<String, Integer> stats = this.getEquipStats(scrollId);\n             Map<String, Integer> eqstats = this.getEquipStats(equip.getItemId());\n+            \n+            System.out.println(\"GM: \" + isGM + \"\\tWS: \" + usingWhiteScroll + \"\\tITEM: \" + scrollId);\n             if (((nEquip.getUpgradeSlots() > 0 || isCleanSlate(scrollId))) || isGM) {\n-                System.out.println(\"GM: \" + isGM + \"\\tWS: \" + usingWhiteScroll + \"\\tITEM: \" + scrollId);\n-                \n                 if(isGM || testYourLuck() <= stats.get(\"success\")) {\n                     short flag = nEquip.getFlag();\n                     switch (scrollId) {\n@@ -552,181 +558,183 @@ public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll\n                             int inc, i;\n                             \n                             if(ServerConstants.SCROLL_CHANCE_RATE > 0) {\n+                                //int tempStr, tempDex, tempInt, tempLuk, tempWatk, tempWdef, tempMatk, tempMdef, tempAcc, tempAvoid, tempSpeed, tempJump, tempHp, tempMp;\n                                 int temp;\n                                 int mdStr = nEquip.getStr(), mdDex = nEquip.getDex(), mdInt = nEquip.getInt(), mdLuk = nEquip.getLuk(), mdWatk = nEquip.getWatk(), mdWdef = nEquip.getWdef(), mdMatk = nEquip.getMatk(), mdMdef = nEquip.getMdef(), mdAcc = nEquip.getAcc(), mdAvoid = nEquip.getAvoid(), mdSpeed = nEquip.getSpeed(), mdJump = nEquip.getJump(), mdHp = nEquip.getHp(), mdMp = nEquip.getMp();\n                                 \n+                                inc = 1;\n+                                if (Randomizer.nextInt(2) == 0) {\n+                                    inc = -1;\n+                                }\n+                                if(ServerConstants.USE_ENHANCED_CHSCROLL == true) inc = 1;\n+                                \n                                 for(i = 0; i < ServerConstants.SCROLL_CHANCE_RATE; i++) {\n-                                    inc = 1;\n-\n-                                    if (Randomizer.nextInt(2) == 0) {\n-                                        inc = -1;\n-                                    }\n                                     if (nEquip.getStr() > 0) {\n                                         temp = (nEquip.getStr() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setStr((short) Math.max(mdStr, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdStr = nEquip.getStr();\n                                         }\n                                         else {\n                                             temp = (mdStr + temp) / 2;\n-                                            if(temp > 0) mdStr = temp;\n+                                            if(temp > mdStr) mdStr = temp;\n                                         }\n                                     }\n                                     if (nEquip.getDex() > 0) {\n                                         temp = (nEquip.getDex() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setDex((short) Math.max(mdDex, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdDex = nEquip.getDex();\n                                         }\n                                         else {\n                                             temp = (mdDex + temp) / 2;\n-                                            if(temp > 0) mdDex = temp;\n+                                            if(temp > mdDex) mdDex = temp;\n                                         }\n                                     }\n                                     if (nEquip.getInt() > 0) {\n                                         temp = (nEquip.getInt() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setInt((short) Math.max(mdInt, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdInt = nEquip.getInt();\n                                         }\n                                         else {\n                                             temp = (mdInt + temp) / 2;\n-                                            if(temp > 0) mdInt = temp;\n+                                            if(temp > mdInt) mdInt = temp;\n                                         }\n                                     }\n                                     if (nEquip.getLuk() > 0) {\n                                         temp = (nEquip.getLuk() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setLuk((short) Math.max(mdLuk, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdLuk = nEquip.getLuk();\n                                         }\n                                         else {\n                                             temp = (mdLuk + temp) / 2;\n-                                            if(temp > 0) mdLuk = temp;\n+                                            if(temp > mdLuk) mdLuk = temp;\n                                         }\n                                     }\n                                     if (nEquip.getWatk() > 0) {\n                                         temp = (nEquip.getWatk() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setWatk((short) Math.max(mdWatk, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdWatk = nEquip.getWatk();\n                                         }\n                                         else {\n                                             temp = (mdWatk + temp) / 2;\n-                                            if(temp > 0) mdWatk = temp;\n+                                            if(temp > mdWatk) mdWatk = temp;\n                                         }\n                                     }\n                                     if (nEquip.getWdef() > 0) {\n                                         temp = (nEquip.getWdef() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setWdef((short) Math.max(mdWdef, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdWdef = nEquip.getWdef();\n                                         }\n                                         else {\n                                             temp = (mdWdef + temp) / 2;\n-                                            if(temp > 0) mdWdef = temp;\n+                                            if(temp > mdWdef) mdWdef = temp;\n                                         }\n                                     }\n                                     if (nEquip.getMatk() > 0) {\n                                         temp = (nEquip.getMatk() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setMatk((short) Math.max(mdMatk, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdMatk = nEquip.getMatk();\n                                         }\n                                         else {\n                                             temp = (mdMatk + temp) / 2;\n-                                            if(temp > 0) mdMatk = temp;\n+                                            if(temp > mdMatk) mdMatk = temp;\n                                         }\n                                     }\n                                     if (nEquip.getMdef() > 0) {\n                                         temp = (nEquip.getMdef() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setMdef((short) Math.max(mdMdef, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdMdef = nEquip.getMdef();\n                                         }\n                                         else {\n                                             temp = (mdMdef + temp) / 2;\n-                                            if(temp > 0) mdMdef = temp;\n+                                            if(temp > mdMdef) mdMdef = temp;\n                                         }\n                                     }\n                                     if (nEquip.getAcc() > 0) {\n                                         temp = (nEquip.getAcc() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setAcc((short) Math.max(mdAcc, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdAcc = nEquip.getAcc();\n                                         }\n                                         else {\n                                             temp = (mdAcc + temp) / 2;\n-                                            if(temp > 0) mdAcc = temp;\n+                                            if(temp > mdAcc) mdAcc = temp;\n                                         }\n                                     }\n                                     if (nEquip.getAvoid() > 0) {\n                                         temp = (nEquip.getAvoid() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setAvoid((short) Math.max(mdAvoid, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdAvoid = nEquip.getAvoid();\n                                         }\n                                         else {\n                                             temp = (mdAvoid + temp) / 2;\n-                                            if(temp > 0) mdAvoid = temp;\n+                                            if(temp > mdAvoid) mdAvoid = temp;\n                                         }\n                                     }\n                                     if (nEquip.getSpeed() > 0) {\n                                         temp = (nEquip.getSpeed() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setSpeed((short) Math.max(mdSpeed, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdSpeed = nEquip.getSpeed();\n                                         }\n                                         else {\n                                             temp = (mdSpeed + temp) / 2;\n-                                            if(temp > 0) mdSpeed = temp;\n+                                            if(temp > mdSpeed) mdSpeed = temp;\n                                         }\n                                     }\n                                     if (nEquip.getJump() > 0) {\n                                         temp = (nEquip.getJump() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setJump((short) Math.max(mdJump, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdJump = nEquip.getJump();\n                                         }\n                                         else {\n                                             temp = (mdJump + temp) / 2;\n-                                            if(temp > 0) mdJump = temp;\n+                                            if(temp > mdJump) mdJump = temp;\n                                         }\n                                     }\n                                     if (nEquip.getHp() > 0) {\n                                         temp = (nEquip.getHp() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setHp((short) Math.max(mdHp, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdHp = nEquip.getHp();\n                                         }\n                                         else {\n                                             temp = (mdHp + temp) / 2;\n-                                            if(temp > 0) mdHp = temp;\n+                                            if(temp > mdHp) mdHp = temp;\n                                         }\n                                     }\n                                     if (nEquip.getMp() > 0) {\n                                         temp = (nEquip.getMp() + Randomizer.nextInt(6) * inc);\n                                         nEquip.setMp((short) Math.max(mdMp, temp));\n                                         \n-                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == false) {\n+                                        if(ServerConstants.USE_ENHANCED_CHSCROLL == true) {\n                                             mdMp = nEquip.getMp();\n                                         }\n                                         else {\n                                             temp = (mdMp + temp) / 2;\n-                                            if(temp > 0) mdMp = temp;\n+                                            if(temp > mdMp) mdMp = temp;\n                                         }\n                                     }\n                                 }\n@@ -738,6 +746,8 @@ public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll\n                                 if (Randomizer.nextInt(2) == 0) {\n                                     inc = -1;\n                                 }\n+                                if(ServerConstants.USE_ENHANCED_CHSCROLL == true) inc = 1;\n+                                \n                                 if (nEquip.getStr() > 0) {\n                                     if(ServerConstants.USE_ENHANCED_CHSCROLL == true) nEquip.setStr((short) Math.max(nEquip.getStr(), (nEquip.getStr() + Randomizer.nextInt(6) * inc)));\n                                     else nEquip.setStr((short) Math.max(0, (nEquip.getStr() + Randomizer.nextInt(6) * inc)));"}]}]},
