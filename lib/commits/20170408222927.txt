{"fetchDate": "2019-12-19", "content": [{"sha": "7dc163fc765db51669b8feaa8613d68c3bf628ca", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6N2RjMTYzZmM3NjVkYjUxNjY5YjhmZWFhODYxM2Q2OGMzYmY2MjhjYQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-08T22:29:27Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-08T22:29:27Z"}, "message": "Concurrency fix + new scripts\n\nFixed some situation involving concurrency upon using getCharacters()\nfrom MapleMap, added scripts and other bug fixes.", "tree": {"sha": "08cb587335e76e552e440c50f0c48b6412b3861c", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/08cb587335e76e552e440c50f0c48b6412b3861c"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/7dc163fc765db51669b8feaa8613d68c3bf628ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7dc163fc765db51669b8feaa8613d68c3bf628ca", "html_url": "https://github.com/ronancpl/HeavenMS/commit/7dc163fc765db51669b8feaa8613d68c3bf628ca", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7dc163fc765db51669b8feaa8613d68c3bf628ca/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c8f905e1a58f1da5a81f634ed5aa7f587a26adde", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c8f905e1a58f1da5a81f634ed5aa7f587a26adde"}], "stats": {"total": 864, "additions": 684, "deletions": 180}, "files": [{"sha": "21d1710bb96179b0d465a0445ac97846123f84a1", "filename": "README_wzchanges.txt", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/README_wzchanges.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/README_wzchanges.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README_wzchanges.txt?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -3,7 +3,8 @@ Changes from the original v83 WZs:\n Map.wz/MapX/*:\n \tFixed entries of portals placed incorrectly.\n \n-Item.wz/Etc:\n+Item.wz/*:\n+\tFixed lacking \"slotMax\" properties in some items.\n \tSet flag \"Quest Item\" for Springy Worm.\n \n Quest.wz/*:"}, {"sha": "d299c6bb7f2124e4051d031e4d71c9bb62790580", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -2,6 +2,9 @@\n <project-private xmlns=\"http://www.netbeans.org/ns/project-private/1\">\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n-        <group/>\n+        <group>\n+            <file>file:/C:/Nexon/MapleSolaxia/scripts/portal/outPerrion_2.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/scripting/AbstractPlayerInteraction.java</file>\n+        </group>\n     </open-files>\n </project-private>"}, {"sha": "b0a792c6540be31299412e48b387df7e43bfe941", "filename": "scripts/event/Hak.js", "status": "modified", "additions": 29, "deletions": 11, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/event/Hak.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/event/Hak.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Hak.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -1,32 +1,50 @@\n+importPackage(Packages.tools);\n+\n var returnTo = new Array(200000141, 250000100);\n var rideTo = new Array(250000100, 200000141);\n var birdRide = new Array(200090300, 200090310);\n var myRide;\n var returnMap;\n var map;\n var docked;\n-\n var timeOnRide = 60; //Seconds\n+var onRide;\n \n function init() {\n-    em.setProperty(\"isRiding\",\"false\");\n }\n \n-function playerEntry(eim, player) {\n-    myRide = em.getProperty(\"myRide\");\n-    docked = em.getChannelServer().getMapFactory().getMap(rideTo[myRide]);\n-    returnMap = em.getChannelServer().getMapFactory().getMap(returnTo[myRide]);\n-    onRide = em.getChannelServer().getMapFactory().getMap(birdRide[myRide]);\n+function setup() {\n+\tvar eim = em.newInstance(\"Hak_\" + + em.getProperty(\"player\"));\n+\treturn eim;\n+}\n \n-    em.setProperty(\"isRiding\",\"true\");\n-    em.schedule(\"timeOut\", timeOnRide * 1000);\n+function playerEntry(eim, player) {\n+\tif (player.getMapId() == returnTo[0]) {\n+\t\tmyRide = 0;\n+\t} else {\n+\t\tmyRide = 1;\n+\t}\n+\tdocked = eim.getEm().getChannelServer().getMapFactory().getMap(rideTo[myRide]);\n+    returnMap = eim.getMapFactory().getMap(returnTo[myRide]);\n+    onRide = eim.getMapFactory().getMap(birdRide[myRide]);\n     player.changeMap(onRide, onRide.getPortal(0));\n-    player.getClient().getSession().write(tools.MaplePacketCreator.getClock(timeOnRide));\n+    player.getClient().getSession().write(MaplePacketCreator.getClock(timeOnRide));\n+    eim.schedule(\"timeOut\", timeOnRide * 1000);\n }\n \n+function timeOut() {\n+\tonRide.warpEveryone(docked.getId());\n+}\n+\n+\n+\n+\n function playerDisconnected(eim, player) {\n     return 0;\n }\n \n-function cancelSchedule() {\n+function cancelSchedule() {}\n+\n+function dispose() {\n+    em.cancelSchedule();\n }\n\\ No newline at end of file"}, {"sha": "c5040e229795d14a52690a74871083be084e0264", "filename": "scripts/npc/world0/1061014.js", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061014.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061014.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1061014.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -30,12 +30,16 @@ var status = 0;\n var expedition;\n var player;\n var em;\n-var barlog_easy = MapleExpeditionType.BALROG_EASY;\n-var barlog_hard = MapleExpeditionType.BALROG_HARD;\n+//var barlog_easy = MapleExpeditionType.BALROG_EASY;\n+//var barlog_hard = MapleExpeditionType.BALROG_HARD;\n \n function start(){\n     status = 0;\n-    action(1, 0, 0);\n+    \n+    cm.sendNext(\"Hi there. I am #b#nMu Young#n#k, the temple Keeper. This expedition is currently unavailable.\");\n+    cm.dispose();\n+    \n+    //action(1, 0, 0);\n }\n \n function action(mode, type, selection) {"}, {"sha": "be95599193576bf1f68a76910e3fab7141234473", "filename": "scripts/npc/world0/1061016.js", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1061016.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,34 @@\n+var status = -1;\n+var itemids = Array(2040728, 2040729, 2040730, 2040731, 2040732, 2040733, 2040734, 2040735, 2040736, 2040737, 2040738, 2040739);\n+\n+function start() {\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode != 1) {\n+\t\tcm.dispose();\n+\t\treturn;\n+\t}\n+\tstatus++;\n+\tif (status == 0) {\n+\t\tcm.sendSimple(\"Hello, #h0#. I can exchange your Balrog Leathers.\\r\\n\\r\\n#r#L1#Redeem items#l#k\");\n+\t} else if (status == 1) {\n+\t\tvar selStr = \"Well, okay. These are what you can redeem...\\r\\n\\r\\n#b\";\n+\t\tfor (var i = 0; i < itemids.length; i++) {\n+\t\t\tselStr += \"#L\" + i + \"##i\" + itemids[i] + \"##z\" + itemids[i] + \"##l\\r\\n\";\n+\t\t}\n+\t\tcm.sendSimple(selStr);\n+\t} else if (status == 2) {\n+\t\tif (!cm.canHold(itemids[selection], 1)) {\n+\t\t\tcm.sendOk(\"Please make room\");\n+\t\t} else if (cm.itemQuantity(4001261) < 1) {\n+\t\t\tcm.sendOk(\"You don't have enough leathers.\");\n+\t\t} else {\n+\t\t\tcm.gainItem(4001261, -1);\n+\t\t\tcm.gainItem(itemids[selection], 1);\n+\t\t\tcm.sendOk(\"Thank you for your redemption\");\n+\t\t}\n+\t\tcm.dispose();\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "2ba01cf1aa491b46eb9b0be5d635cd71c4a7e4dc", "filename": "scripts/npc/world0/1061018.js", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/1061018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1061018.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,10 @@\n+function start() {\n+    cm.sendYesNo(\"If you leave now, you'll have to start over. Are you sure you want to leave?\");\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tcm.warp(105100301);\n+    }\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "bceb408de653066a3f88f58c1f52df0f02396ce2", "filename": "scripts/npc/world0/2080000.js", "status": "modified", "additions": 37, "deletions": 17, "changes": 54, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2080000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2080000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2080000.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -29,11 +29,20 @@ var matQty;\n var cost;\n var stimID;\n \n+var cd_item = 4001078;\n+var cd_mats = new Array(4011001,4011002,4001079);\n+var cd_matQty = new Array(1,1,1);\n+var cd_cost = 25000;\n+\n function start() {\n     cm.getPlayer().setCS(true);\n     var selStr = \"A dragon's power is not to be underestimated. If you like, I can add its power to one of your weapons. However, the weapon must be powerful enough to hold its potential...#b\"\n     var options = new Array(\"What's a stimulator?\",\"Create a Warrior weapon\",\"Create a Bowman weapon\",\"Create a Magician weapon\",\"Create a Thief weapon\",\"Create a Pirate Weapon\",\n         \"Create a Warrior weapon with a Stimulator\",\"Create a Bowman weapon with a Stimulator\",\"Create a Magician weapon with a Stimulator\",\"Create a Thief weapon with a Stimulator\",\"Create a Pirate Weapon with a Stimulator\");\n+        \n+    if(cm.isQuestStarted(7301)) options.push(\"Make #t4001078#\");\n+    \n+        \n     for (var i = 0; i < options.length; i++){\n         selStr += \"\\r\\n#L\" + i + \"# \" + options[i] + \"#l\";\n     }\n@@ -49,7 +58,7 @@ function action(mode, type, selection) {\n     }\n     if (status == 1) {\n         selectedType = selection;\n-        if (selectedType > 5) {\n+        if (selectedType > 5 && selectedType < 11) {\n             stimulator = true;\n             selectedType -= 5;\n         }\n@@ -88,15 +97,20 @@ function action(mode, type, selection) {\n             }\n             cm.sendSimple(selStr);\n         } else if (selectedType == 5){ //pirate weapon\n-\t\t\tvar selStr = \"Very well, then which Pirate weapon shall recieve a dragon's power?#b\";\n-\t\t\tvar weapon = new Array (\"Dragon Slash Claw#k - Lv. 110 Knuckle#b\",\"Dragonfire Revolver#k - Lv. 110 Gun#b\");\n-\t\t\tfor (var i = 0; i < weapon.length; i++){\n-\t\t\t\tselStr += \"\\r\\n#L\" + i + \"# \" + weapon[i] + \"#l\";\n-\t\t\t}\n-\t\t\tcm.sendSimple(selStr);\n-\t    }\n+            var selStr = \"Very well, then which Pirate weapon shall recieve a dragon's power?#b\";\n+            var weapon = new Array (\"Dragon Slash Claw#k - Lv. 110 Knuckle#b\",\"Dragonfire Revolver#k - Lv. 110 Gun#b\");\n+            for (var i = 0; i < weapon.length; i++){\n+                    selStr += \"\\r\\n#L\" + i + \"# \" + weapon[i] + \"#l\";\n+            }\n+            cm.sendSimple(selStr);\n+\t}\n+        else if (selectedType == 11){ //cornian's dagger\n+            var selStr = \"Oh, are you trying to sneak into these lizards to save Moira? I will support your cause wherever I can. Bring me a couple of resources and I will make you an almost identical piece of #t4001078#.\";\n+            cm.sendNext(selStr);\n+\t}\n     } else if (status == 2) {\n         selectedItem = selection;\n+        \n         if (selectedType == 1){ //warrior weapon\n             var itemSet = new Array(1302059,1312031,1322052,1402036,1412026,1422028,1432038,1442045);\n             var matSet = new Array(new Array(1302056,4000244,4000245,4005000),new Array(1312030,4000244,4000245,4005000),new Array(1322045,4000244,4000245,4005000),new Array(1402035,4000244,4000245,4005000),\n@@ -135,15 +149,21 @@ function action(mode, type, selection) {\n             matQty = matQtySet[selectedItem];\n             cost = costSet[selectedItem];\n         } else if (selectedType == 5){ //pirate weapon\n-\t\t\tvar itemSet = new Array(1482013,1492013);\n-\t\t\tvar matSet = new Array(new Array(1482012,4000244,4000245,4005000,4005002),new Array(1492012,4000244,4000245,4005000,4005002));\n-\t\t\tvar matQtySet = new Array(new Array(1,20,25,5,3),new Array(1,20,25,3,5));\n-\t\t\tvar costSet = new Array(120000,120000);\n-\t\t\titem = itemSet[selectedItem];\n-\t\t\tmats = matSet[selectedItem];\n-\t\t\tmatQty = matQtySet[selectedItem];\n-\t\t\tcost = costSet[selectedItem];\n-\t\t}\n+            var itemSet = new Array(1482013,1492013);\n+            var matSet = new Array(new Array(1482012,4000244,4000245,4005000,4005002),new Array(1492012,4000244,4000245,4005000,4005002));\n+            var matQtySet = new Array(new Array(1,20,25,5,3),new Array(1,20,25,3,5));\n+            var costSet = new Array(120000,120000);\n+            item = itemSet[selectedItem];\n+            mats = matSet[selectedItem];\n+            matQty = matQtySet[selectedItem];\n+            cost = costSet[selectedItem];\n+        } else if (selectedType == 11){ //cornian's dagger\n+            item = cd_item;\n+            mats = cd_mats;\n+            matQty = cd_matQty;\n+            cost = cd_cost;\n+        }\n+        \n         var prompt = \"You want me to make a #t\" + item + \"#? In that case, I'm going to need specific items from you in order to make it. Make sure you have room in your inventory, though!#b\";\n         if(stimulator){\n             stimID = getStimID(item);"}, {"sha": "fa19b5922eb9ff5b1bffa5d98386c9189cca94f2", "filename": "scripts/npc/world0/2083005.js", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2083005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2083005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2083005.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,36 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/**\n+Fountain of Life 2083005\n+**/\n+\n+function start() {\n+    if(cm.isQuestStarted(6280)) {\n+        if(cm.hasItem(4031454)) {\n+            cm.sendOk(\"(You poured some water from the fountain into the cup.)\");\n+            cm.gainItem(4031454, -1);\n+            cm.gainItem(4031455, 1);\n+        }\n+    }\n+    \n+    cm.dispose();\n+}"}, {"sha": "22015e332c002696b48772f90b84e1f56013d0ec", "filename": "scripts/npc/world0/2100001.js", "status": "modified", "additions": 0, "deletions": 92, "changes": 92, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100001.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -200,96 +200,4 @@ function action(mode, type, selection) {\n             }\n             cm.dispose();\n         }\n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        \n-        /*\n-        else if(status == 4 && mode == 1) {\n-            if (equip) {\n-                selectedItem = selection;\n-                qty = 1;\n-            }\n-            else\n-                qty = selection;\n-            \n-            var prompt = \"To make #t\" + item + \"#s, I'll need the following materials:\";\n-            \n-            if (mats instanceof Array){\n-\t\tfor(var i = 0; i < mats.length; i++){\n-\t\t\tprompt += \"\\r\\n#i\"+mats[i]+\"# \" + matQty[i] * qty + \" #t\" + mats[i] + \"#\";\n-\t\t}\n-            }\n-            else {\n-\t\tprompt += \"\\r\\n#i\"+mats+\"# \" + matQty * qty + \" #t\" + mats + \"#\";\n-            }\n-\t\t\n-            if (cost > 0)\n-\t\tprompt += \"\\r\\n#i4031138# \" + cost * qty + \" meso\";\n-           \n-        }\n-        \n-\telse if (status == 5 && mode == 1) {\n-\t\tvar complete = false;\n-\t\t\t\n-\t\tif (cm.getMeso() < cost * qty) {\n-\t\t\tcm.sendOk(\"I'm afraid you cannot afford my services.\")\n-\t\t\tcm.dispose();\n-\t\t\treturn;\n-\t\t}\n-\t\telse {\n-\t\t\tif (mats instanceof Array) {\n-\t\t\t\tfor (var i = 0; i < mats.length; i++) {\n-\t\t\t\t\tcomplete = cm.haveItem(mats[i], matQty[i] * qty);\n-\t\t\t\t\tif (!complete) {\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\tcomplete = cm.haveItem(mats, matQty * qty);\n-\t\t\t}\t\n-        \t}\n-\t\t\t\n-\t\tif (!complete) \n-\t\t\tcm.sendNext(\"Please check and see if you have all the necessary items with you. If so, then please check your etc. inventory and see if you have an empty space.\");\n-\t\telse {\n-\t\t\tif (mats instanceof Array) {\n-\t\t\t\tfor (var i = 0; i < mats.length; i++){\n-\t\t\t\t\tcm.gainItem(mats[i], -matQty[i] * qty);\n-\t\t\t\t}\n-\t\t\t}\n-\t\t\telse\n-\t\t\t\tcm.gainItem(mats, -matQty * qty);\n-\t\t\t\t\t\n-\t\t\tcm.gainMeso(-cost * qty);\n-\t\t\tcm.gainItem(item,qty);\n-\t\t\tcm.sendOk(\"There, finished. What do you think, a piece of art, isn't it? Well, if you need anything else, you know where to find me.\");\n-\t\t}\n-\t\t\n-\t\tcm.dispose();\n-\t}*/\n }\n\\ No newline at end of file"}, {"sha": "c6d032441fe7e2856f59c46a62fbabd359d01cf1", "filename": "scripts/npc/world0/2100002.js", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100002.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,11 @@\n+var status = 0;\n+\n+function start() {\n+    status = -1;\n+    action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    cm.openShopNPC(48);\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "8e20e05d1b092a6ac2a03e53c0d3720a06279b77", "filename": "scripts/npc/world0/2100003.js", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100003.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,11 @@\n+var status = 0;\n+\n+function start() {\n+    status = -1;\n+    action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    cm.openShopNPC(52);\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "2c0172b494a22866e3356cd60e592b9a008a1626", "filename": "scripts/npc/world0/2100005.js", "status": "added", "additions": 83, "deletions": 0, "changes": 83, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100005.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,83 @@\n+/* Author: aaroncsn (MapleSea Like)\n+\tNPC Name: \t\tShati\n+\tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n+\tDescription: \tAssistant Hairdresser\n+*/\n+\n+var status = 0;\n+var beauty = 0;\n+var mhair = Array(30250, 30350, 30270, 30150, 30300, 30600, 30160, 30700, 30720, 30420);\n+var fhair = Array(31040, 31250, 31310, 31220, 31300, 31680, 31160, 31030, 31230, 31690, 31210, 31170, 31450);\n+var hairnew = Array();\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\t\tif (mode == 0 && status >= 0) {\n+\t\t\tcm.sendNext(\"I guess you aren't ready to make the change yet. Let me know when you are!\");\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tif (mode == 1)\n+\t\t\tstatus++;\n+\t\telse\n+\t\t\tstatus--;\n+\t\tif (status == 0) {\n+\t\t\tcm.sendSimple(\"Hey there! I'm Shatti, and I'm Mazra's apprentice. If you have #bAriant hair style coupon(REG)#k or #bAriant hair color coupon(REG)#k with you, how about allowing me to work on your hair? \\r\\n#L0##bChange Hairstyle (Reg Coupon) \\r\\n#L1##bDye Hair(Reg. coupon)\");\n+\t\t} else if (status == 1) {\n+\t\t\tif (selection == 0) {\n+\t\t\t\tbeauty = 1;\n+\t\t\t\thairnew = Array();\n+\t\t\t\tif (cm.getChar().getGender() == 0) {\n+\t\t\t\t\tfor(var i = 0; i < mhair.length; i++) {\n+\t\t\t\t\t\thairnew.push(mhair[i] + parseInt(cm.getChar().getHair()\n+ % 10));\n+\t\t\t\t\t}\n+\t\t\t\t} \n+\t\t\t\tif (cm.getChar().getGender() == 1) {\n+\t\t\t\t\tfor(var i = 0; i < fhair.length; i++) {\n+\t\t\t\t\t\thairnew.push(fhair[i] + parseInt(cm.getChar().getHair()\n+ % 10));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcm.sendYesNo(\"If you use the Reg. coupon, your hairstyle will be changed to a random new look. You'll also have access to new hairstyles I worked on that's not available for VIP coupons. Would you like to use #bAriant hair style coupon(REG)#k for a fabulous new look?\");\n+\t\t\t} else if (selection == 1) {\n+\t\t\t\tbeauty = 2;\n+\t\t\t\thaircolor = Array();\n+\t\t\t\tvar current = parseInt(cm.getChar().getHair()\n+/10)*10;\n+\t\t\t\tfor(var i = 0; i < 8; i++) {\n+\t\t\t\t\thaircolor.push(current + i);\n+\t\t\t\t}\n+\t\t\t\tcm.sendYesNo(\"If you use the regular coupon, your hair color will change to a random new color. Are you sure you want to use #b#t5151021##k and randomly change your hair color?\");\n+\t\t\t}\n+\t\t}\n+\t\telse if (status == 2){\n+\t\t\tcm.dispose();\n+\t\t\tif (beauty == 1){\n+\t\t\t\tif (cm.haveItem(5150026) == true){\n+\t\t\t\t\tcm.gainItem(5150026, -1);\n+\t\t\t\t\tcm.setHair(hairnew[Math.floor(Math.random() * hairnew.length)]);\n+\t\t\t\t\tcm.sendOk(\"Enjoy your new and improved hairstyle!\");\n+\t\t\t\t} else {\n+\t\t\t\t\tcm.sendNext(\"I can only change your hairstyle if you bring me the coupon. You didn't forget that, did you?\");\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif (beauty == 2){\n+\t\t\t\tif (cm.haveItem(5151021) == true){\n+\t\t\t\t\tcm.gainItem(5151021, -1);\n+\t\t\t\t\tcm.setHair(haircolor[Math.floor(Math.random() * haircolor.length)]);\n+\t\t\t\t\tcm.sendOk(\"Enjoy your new and improved haircolor!\");\n+\t\t\t\t} else {\n+\t\t\t\t\tcm.sendNext(\"I can only change your hairstyle if you bring me the coupon. You didn't forget that, did you?\");\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "d307601075cfe315b5111cf55ead6dcd88b19ab2", "filename": "scripts/npc/world0/2100006.js", "status": "added", "additions": 84, "deletions": 0, "changes": 84, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100006.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,84 @@\n+/* Author: aaroncsn (MapleSea Like)\n+\tNPC Name: \t\tMazra\n+\tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n+\tDescription: \tHair Salon Owner\n+*/\n+\n+var status = 0;\n+var beauty = 0;\n+var mhair = Array(30030, 30020, 30000, 30130, 30350, 30190, 30110, 30180, 30050, 30040, 30160);\n+var fhair = Array(31050, 31040, 31000, 31060, 31090, 31020, 31130, 31120, 31140, 31330, 31010);\n+var hairnew = Array();\n+\n+\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\t\tif (mode == 0 && status >= 0) {\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tif (mode == 1)\n+\t\t\tstatus++;\n+\t\telse\n+\t\t\tstatus--;\n+\t\tif (status == 0) {\n+\t\t\tcm.sendSimple(\"Hahaha... it takes a lot of style and flair for someone to pay attention to his or her hairsyle in a desert. Someone like you...If you have #bAriant hair style coupon(VIP)#k or #bAriant hair color coupon(VIP)#k, I'll give your hair a fresh new look. \\r\\n#L0##bChange Hairstyle(VIP Coupon)#k#l \\r\\n#L1##bDye Hair(VIP Coupon)#k#l\");\n+\t\t} else if (status == 1) {\n+\t\t\tif (selection == 0) {\n+\t\t\t\tbeauty = 1;\n+\t\t\t\thairnew = Array();\n+\t\t\t\tif (cm.getChar().getGender() == 0) {\n+\t\t\t\t\tfor(var i = 0; i < mhair.length; i++) {\n+\t\t\t\t\t\thairnew.push(mhair[i] + parseInt(cm.getChar().getHair()\n+ % 10));\n+\t\t\t\t\t}\n+\t\t\t\t} \n+\t\t\t\tif (cm.getChar().getGender() == 1) {\n+\t\t\t\t\tfor(var i = 0; i < fhair.length; i++) {\n+\t\t\t\t\t\thairnew.push(fhair[i] + parseInt(cm.getChar().getHair()\n+ % 10));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcm.sendStyle(\"Hahaha~all you need is #bAriant hair style coupon(VIP)#k to change up your hairstyle. Choose the new style, and let me do the rest.\", hairnew);\n+\t\t\t} else if (selection == 1) {\n+\t\t\t\tbeauty = 2;\n+\t\t\t\thaircolor = Array();\n+\t\t\t\tvar current = parseInt(cm.getChar().getHair()\n+/10)*10;\n+\t\t\t\tfor(var i = 0; i < 8; i++) {\n+\t\t\t\t\thaircolor.push(current + i);\n+\t\t\t\t}\n+\t\t\t\tcm.sendStyle(\"Every once in a while, it doesn't hurt to change up your hair color... it's fun. Allow me, the great Mazra, to dye your hair, so you just bring me #bAriant hair color coupon(VIP)#k, and choose your new hair color.\", haircolor);\n+\t\t\t}\n+\t\t}\n+\t\telse if (status == 2){\n+\t\t\tcm.dispose();\n+\t\t\tif (beauty == 1){\n+\t\t\t\tif (cm.haveItem(5150027) == true){\n+\t\t\t\t\tcm.gainItem(5150027, -1);\n+\t\t\t\t\tcm.setHair(hairnew[selection]);\n+\t\t\t\t\tcm.sendOk(\"Enjoy your new and improved hairstyle!\");\n+\t\t\t\t} else {\n+\t\t\t\t\tcm.sendNext(\"I thought I told you, you need the coupon in order for me to work magic on your hair check again.\");\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif (beauty == 2){\n+\t\t\t\tif (cm.haveItem(5151022) == true){\n+\t\t\t\t\tcm.gainItem(5151022, -1);\n+\t\t\t\t\tcm.setHair(haircolor[selection]);\n+\t\t\t\t\tcm.sendOk(\"Enjoy your new and improved haircolor!\");\n+\t\t\t\t} else {\n+\t\t\t\t\tcm.sendNext(\"I thought I told you, you need the coupon in order for me to work magic on your hair check again.\");\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "89e8ecfd3600eb85ecca4d58f90c5d523a3a50be", "filename": "scripts/npc/world0/2100007.js", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100007.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,42 @@\n+/* Author: aaroncsn (MapleSea Like)(Incomplete- Needs skin id)\n+\tNPC Name: \t\tLaila\n+\tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n+\tDescription: \tSkin Care Specialist\n+*/\n+\n+var status = 0;\n+var skin = Array(0, 1, 2, 3, 4);\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\t\tif (mode == 0 && status >= 0) {\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tif (mode == 1)\n+\t\t\tstatus++;\n+\t\telse\n+\t\t\tstatus--;\n+\t\tif (status == 0) {\n+\t\t\tcm.sendNext(\"Hohoh~ welcome welcome. Welcome to Ariant Skin Care. You have stepped into a renowned Skin Care shop that even the Queen herself frequents this place. If you have #bAriant skin care coupon#k with you, we'll take care of the rest. How about letting work on your skin today?\");\n+\t\t} else if (status == 1) {\n+\t\t\tcm.sendStyle(\"With our specialized machine, you can see yourself after the treatment in advance. What kind of skin-treatment would you like to do? Choose the style of your liking...\", skin);\n+\t\t} else if (status == 2){\n+\t\t\tcm.dispose();\n+\t\t\tif (cm.haveItem(5153007) == true){\n+\t\t\t\tcm.gainItem(5153007, -1);\n+\t\t\t\tcm.setSkin(skin[selection]);\n+\t\t\t\tcm.sendOk(\"Enjoy your new and improved skin!\");\n+\t\t\t} else {\n+\t\t\t\tcm.sendNext(\"Hmmm... I don't think you have our Skin Care coupon with you. Without it, I can't give you the treatment\");\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "c9ce080a927b0ee52e0b3f7b91b8370c79cffa9c", "filename": "scripts/npc/world0/2100008.js", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100008.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,59 @@\n+/* Author: aaroncsn (MapleSea Like)\n+\tNPC Name: \t\tBadr\n+\tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n+\tDescription: \tAriant Plastic Surgery\n+*/\n+\n+var status = 0;\n+var beauty = 0;\n+var mface = Array(20000, 20001, 20002, 20003, 20004, 20005, 20006, 20007, 20008, 20012, 20014);\n+var fface = Array(21000, 21001, 21002, 21003, 21004, 21005, 21006, 21007, 21008, 21012, 21014);\n+var facenew = Array();\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\t\tif (mode == 0 && status == 0) {\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tif (mode == 1)\n+\t\t\tstatus++;\n+\t\telse\n+\t\t\tstatus--;\n+\t\tif (status == 0) {\n+\t\t\t\tfacenew = Array();\n+\t\t\t\tif (cm.getChar().getGender() == 0) {\n+\t\t\t\t\tfor(var i = 0; i < mface.length; i++) {\n+\t\t\t\t\t\tfacenew.push(mface[i] + cm.getChar().getFace()\n+ % 1000 - (cm.getChar().getFace()\n+ % 100));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tif (cm.getChar().getGender() == 1) {\n+\t\t\t\t\tfor(var i = 0; i < fface.length; i++) {\n+\t\t\t\t\t\tfacenew.push(fface[i] + cm.getChar().getFace()\n+ % 1000 - (cm.getChar().getFace()\n+ % 100));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcm.sendStyle(\"Hmmm... Face of beauty glows even under cover and burning desert. With #bAriant face coupon(VIP)#k, I can make your face so much better. Choose the face you want, and I will pull out my outstanding skill for the great make over.\", facenew);\n+\t\t\t}\n+\t\telse if (status == 1){\n+\t\t\tcm.dispose();\n+\t\t\tif (cm.haveItem(5152030) == true){\n+\t\t\t\tcm.gainItem(5152030, -1);\n+\t\t\t\tcm.setFace(facenew[selection]);\n+\t\t\t\tcm.sendOk(\"Enjoy your new and improved face!\");\n+\t\t\t} else {\n+\t\t\t\tcm.sendNext(\"Erm... You don't seem to have the exclusive coupon for this hospital. Without the coupon, I'm afraid I can't do it for you.\");\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "1034d0a7ca5bcf68b9869df5f3e2d0c87041261f", "filename": "scripts/npc/world0/2100009.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2100009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2100009.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,60 @@\n+/* Author: aaroncsn (MapleSea Like)\n+\tNPC Name: \t\tAldin\n+\tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n+\tDescription: \tAriant Plastic Surgery\n+*/\n+\n+var status = 0;\n+var beauty = 0;\n+var mface = Array(20000, 20001, 20002, 20003, 20004, 20005, 20006, 20007, 20008, 20012, 20014);\n+var fface = Array(21000, 21001, 21002, 21003, 21004, 21005, 21006, 21007, 21008, 21012, 21014);\n+var facenew = Array();\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\t\tif (mode == 0 && status == 0) {\n+\t\t\tcm.sendNext(\"I see...take your time, see if you really want it. Let me know when you make up your mind.\");\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tif (mode == 1)\n+\t\t\tstatus++;\n+\t\telse\n+\t\t\tstatus--;\n+\t\tif (status == 0) {\n+\t\t\t\tfacenew = Array();\n+\t\t\t\tif (cm.getChar().getGender() == 0) {\n+\t\t\t\t\tfor(var i = 0; i < mface.length; i++) {\n+\t\t\t\t\t\tfacenew.push(mface[i] + cm.getChar().getFace()\n+ % 1000 - (cm.getChar().getFace()\n+ % 100));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tif (cm.getChar().getGender() == 1) {\n+\t\t\t\t\tfor(var i = 0; i < fface.length; i++) {\n+\t\t\t\t\t\tfacenew.push(fface[i] + cm.getChar().getFace()\n+ % 1000 - (cm.getChar().getFace()\n+ % 100));\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcm.sendYesNo(\"If you use the regular coupon, your face may transform into a random new look...do you still want to do it using #b#t5152029##k?\");\n+\t\t\t}\n+\t\telse if (status == 1){\t\n+\t\t\tcm.dispose();\n+\t\t\tif (cm.haveItem(5152029) == true){\n+\t\t\t\tcm.gainItem(5152029, -1);\n+\t\t\t\tcm.setFace(facenew[Math.floor(Math.random() * facenew.length)]);\n+\t\t\t\tcm.sendOk(\"Enjoy your new and improved face!\");\n+\t\t\t} else {\n+\t\t\t\tcm.sendNext(\"Um ... it looks like you don't have the coupon specifically for this place...sorry to say this, but without the coupon, there's no plastic surgery for you.\");\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "de3e4f0497f57e075c2813f63c80e1a7ada37517", "filename": "scripts/npc/world0/2101002.js", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2101002.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,12 @@\n+/* \tEleska\n+\tAriant\t\n+*/\n+\n+\n+function start() {\n+    cm.sendOk(\"Stay away from me, if you don't want any danger.\");\n+}\n+\n+function action() {\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "52f384ad18a6296b68d94be5a6dad0efc066aa41", "filename": "scripts/npc/world0/2101003.js", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2101003.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,12 @@\n+/* \tArdin\n+\tAriant\t\n+*/\n+\n+\n+function start() {\n+    cm.sendNext (\"Hey hey, don't try to start trouble with anyone. I want nothing to do with you.\");\n+}\n+\n+function action() {\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "9d88b2e76f5092b5ad03613193d3f461d074a67f", "filename": "scripts/npc/world0/2101013.js", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/npc/world0/2101013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2101013.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,42 @@\n+/* Author: aaroncsn(MapleSea Like)\n+\tNPC Name: \t\tKarcasa\n+\tMap(s): \t\tThe Burning Sands: Tents of the Entertainers(260010600)\n+\tDescription: \t\tWarps to Victoria Island\n+*/\n+var towns = new Array(100000000,101000000,102000000,103000000,104000000);\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+\tif (mode == -1) {\n+\t\tcm.dispose();\n+\t} else {\n+\tif (status == 0 && mode == 0) {\n+\t\tcm.sendNext(\"Aye...are you scared of speed or heights? You can't trust my flying skills? Trust me, I've worked out all the kinks!\");\n+\t\tcm.dispose();\n+\t\treturn;\n+\t}\n+\tif (mode == 1)\n+\t\tstatus++;\n+\telse\n+\t\tstatus--;\n+\tif(status == 0){\n+\t\tcm.sendAcceptDecline(\"I don't know how you found out about this, but you came to the right place! For those that wandered around Nihal Desert and are getting homesick, I am offering a flight straight to Victorial Island, non-stop! Don't worry about the flying ship--it's only fallen once or twice! Don't you feel claustrophobic being in a long flight on that small ship? What do you think? Are you willing to take the offer on this direct flight?\");\n+\t} else if(status == 1){\n+\t\tcm.sendAcceptDecline(\"Please remember two things. One, this line is actually for overseas shipping, so #rI cannot gurantee exactly which town you'll land#k. Two, since I am putting you in this special flight, it'll be a bit expensive. The service charge is #e#b10,000 mesos#n#k. There's a flight thats about to take off. Are you interested?\");\n+\t} else if(status == 2){\n+\t\tcm.sendNext(\"Okay, ready to takeoff~\");\n+\t} else if(status == 3){\n+\t\tif(cm.getMeso() >= 10000){\n+\t\t\tcm.gainMeso(-10000);\n+\t\t\tcm.warp(towns[Math.floor(Math.random() * towns.length)]);\n+\t\t} else{\n+\t\t\tcm.sendNextPrev(\"Hey, are you short on cash? I told you you'll need #b10,000#k mesos to get on this.\");\n+\t\t\tcm.dispose();\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n\\ No newline at end of file"}, {"sha": "1b9e6913932f446c57416a9a0cf885926549e6b0", "filename": "scripts/portal/balogTemple.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/balogTemple.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/balogTemple.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/balogTemple.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+    pi.warp(105100000, 2);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "b392201b8a395b73b5d6ee1ba3d2069160e34cb4", "filename": "scripts/portal/balog_end.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/balog_end.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/balog_end.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/balog_end.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+\tif (!pi.canHold(4001261,1)) {\n+\t\tpi.playerMessage(5, \"Please make 1 ETC room.\");\n+\t\treturn false;\n+\t}\n+\tpi.gainItem(4001261,1);\n+\tpi.warp(105100100,0);\n+\treturn(true);\n+}\n\\ No newline at end of file"}, {"sha": "c0168eba84707c81d72921d4c772b6cceaa9c821", "filename": "scripts/portal/inNix1.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/inNix1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/inNix1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/inNix1.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+\tpi.warp(240020600,\"out00\");\n+        return(true);\n+}\n\\ No newline at end of file"}, {"sha": "424159f7bcdb7f60d857f52be69eb18a070746f6", "filename": "scripts/portal/inNix2.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/inNix2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/inNix2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/inNix2.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+\tpi.warp(240020600,\"out01\");\n+        return(true);\n+}\n\\ No newline at end of file"}, {"sha": "38e79512bd768793cfdddf4016e940cc5d748871", "filename": "scripts/portal/outNix1.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outNix1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outNix1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/outNix1.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+\tpi.warp(240020101,\"in00\");\n+        return(true);\n+}\n\\ No newline at end of file"}, {"sha": "8ba1f4a5b2c811898c654d1b2b93528d6e0cc59d", "filename": "scripts/portal/outNix2.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outNix2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outNix2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/outNix2.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+\tpi.warp(240020401,\"in00\");\n+        return(true);\n+}\n\\ No newline at end of file"}, {"sha": "920c03fe4699d431e658e4748b03f55266a59a5f", "filename": "scripts/portal/outPerrion_1.js", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outPerrion_1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outPerrion_1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/outPerrion_1.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,5 @@\n+function enter(pi) {\n+    pi.message(\"You found a shortcut to the start of the underground temple.\");\n+    pi.warp(105100000, 2);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "59a7f3d0f4c46ef4de477418d09d5951cece7d1f", "filename": "scripts/portal/outPerrion_2.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outPerrion_2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/outPerrion_2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/outPerrion_2.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+    pi.warp(105100000);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "32eaf5bb36ae93cf03334cb86ee2961e0291680d", "filename": "scripts/portal/tristanEnter.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/tristanEnter.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/portal/tristanEnter.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/tristanEnter.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+    pi.warp(105100101, \"in00\");\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "c06753da3bf1b1f703528bebcd9a62e1bd0821da", "filename": "scripts/reactor/1052001.js", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/reactor/1052001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/scripts/reactor/1052001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1052001.js?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -0,0 +1,3 @@\n+function act() {\n+\trm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "75c3c295f3ed40121c3e53734f89a5962ce5ba21", "filename": "sql/db_drops.sql", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -18845,6 +18845,7 @@\n   UPDATE drop_data SET chance=0 WHERE itemid=2050099;\n   UPDATE drop_data SET chance=40000 WHERE itemid=4031991;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4031477;\n+  UPDATE drop_data SET questid=6190 WHERE itemid=4001111;\n \n   # two items named \"Sparta\": remove the entries where lv100 Sparta is being dropped by low-level mobs.\n   UPDATE IGNORE drop_data SET itemid=1402011 WHERE itemid=1302056 AND dropperid < 8000000;"}, {"sha": "d816d451a04e87aa6978e315baf34bd4fa3b072a", "filename": "src/net/server/channel/handlers/SkillBookHandler.java", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/net/server/channel/handlers/SkillBookHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/net/server/channel/handlers/SkillBookHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SkillBookHandler.java?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -64,13 +64,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 canuse = false;\n             } else if ((player.getSkillLevel(skill2) >= skilldata.get(\"reqSkillLevel\") || skilldata.get(\"reqSkillLevel\") == 0) && player.getMasterLevel(skill2) < skilldata.get(\"masterLevel\")) {\n                 canuse = true;\n-                if (Randomizer.nextInt(101) < skilldata.get(\"success\") && skilldata.get(\"success\") != 0) {\n+                if (MapleItemInformationProvider.rollSuccessChance(skilldata.get(\"success\"))) {\n                     success = true;\n-                    \n                     player.changeSkillLevel(skill2, player.getSkillLevel(skill2), Math.max(skilldata.get(\"masterLevel\"), player.getMasterLevel(skill2)), -1);\n                 } else {\n                     success = false;\n-                    player.dropMessage(\"The skill book lights up, but the skill winds up as if nothing happened.\");\n+                    //player.dropMessage(\"The skill book lights up, but the skill winds up as if nothing happened.\");\n                 }\n                 MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n             } else {"}, {"sha": "409d71449364dc1613a7e627a377b8896fde6905", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -83,6 +83,10 @@ public MapleClient getClient() {\n \tpublic MapleCharacter getPlayer() {\n \t\treturn c.getPlayer();\n \t}\n+        \n+        public MapleCharacter getChar() {\n+\t\treturn c.getPlayer();\n+\t}\n \n \tpublic void warp(int map) {\n \t\tgetPlayer().changeMap(getWarpMap(map), getWarpMap(map).getPortal(0));"}, {"sha": "538a987a16a646d6a4f47a7881d2621575035c3d", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -511,7 +511,7 @@ private boolean isCleanSlate(int scrollId) {\n         return scrollId > 2048999 && scrollId < 2049004;\n     }\n \n-    private double testYourLuck() {\n+    private static double testYourLuck() {\n         double result = 100.0, rolled;\n         int i, j = ServerConstants.SCROLL_CHANCE_RATE;\n         \n@@ -524,6 +524,9 @@ private double testYourLuck() {\n         return(result);\n     }\n     \n+    public static boolean rollSuccessChance(double prop) {\n+        return(testYourLuck() <= prop && prop > 0.0);\n+    }\n     \n     public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll, boolean isGM) {\n         if (equip instanceof Equip) {\n@@ -534,7 +537,7 @@ public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll\n             \n             System.out.println(\"GM: \" + isGM + \"\\tWS: \" + usingWhiteScroll + \"\\tITEM: \" + scrollId);\n             if (((nEquip.getUpgradeSlots() > 0 || isCleanSlate(scrollId))) || isGM) {\n-                if(isGM || testYourLuck() <= stats.get(\"success\")) {\n+                if(isGM || rollSuccessChance((double)stats.get(\"success\"))) {\n                     short flag = nEquip.getFlag();\n                     switch (scrollId) {\n                         case 2040727:"}, {"sha": "cea59069d563d785d989d3bd32c80f0192cbf686", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 21, "deletions": 29, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -250,19 +250,14 @@ public boolean isAttackedBy(MapleCharacter chr) {\n \n     private void distributeExperienceToParty(int pid, int exp, int killer, Map<Integer, Integer> expDist) {\n         LinkedList<MapleCharacter> members = new LinkedList<>();\n-\n-        map.getCharacterReadLock().lock();\n         Collection<MapleCharacter> chrs = map.getCharacters();\n-        try {\n-            for (MapleCharacter mc : chrs) {\n-                if (mc.getPartyId() == pid) {\n-                    members.add(mc);\n-                }\n+        \n+        for (MapleCharacter mc : chrs) {\n+            if (mc.getPartyId() == pid) {\n+                members.add(mc);\n             }\n-        } finally {\n-            map.getCharacterReadLock().unlock();\n         }\n-\n+        \n         final int minLevel = getLevel() - 5;\n \n         int partyLevel = 0;\n@@ -312,29 +307,26 @@ public void distributeExperience(int killerId) {\n         for (Entry<Integer, AtomicInteger> damage : takenDamage.entrySet()) {\n             expDist.put(damage.getKey(), (int) (0.80f * exp * damage.getValue().get() / totalHealth));\n         }\n-        map.getCharacterReadLock().lock(); // avoid concurrent mod\n+        \n         Collection<MapleCharacter> chrs = map.getCharacters();\n-        try {\n-            for (MapleCharacter mc : chrs) {\n-                if (expDist.containsKey(mc.getId())) {\n-                    boolean isKiller = mc.getId() == killerId;\n-                    int xp = expDist.get(mc.getId());\n-                    if (isKiller) {\n-                        xp += exp / 5;\n-                    }\n-                    MapleParty p = mc.getParty();\n-                    if (p != null) {\n-                        int pID = p.getId();\n-                        int pXP = xp + (partyExp.containsKey(pID) ? partyExp.get(pID) : 0);\n-                        partyExp.put(pID, pXP);\n-                    } else {\n-                        giveExpToCharacter(mc, xp, isKiller, 1);\n-                    }\n+        for (MapleCharacter mc : chrs) {\n+            if (expDist.containsKey(mc.getId())) {\n+                boolean isKiller = mc.getId() == killerId;\n+                int xp = expDist.get(mc.getId());\n+                if (isKiller) {\n+                    xp += exp / 5;\n+                }\n+                MapleParty p = mc.getParty();\n+                if (p != null) {\n+                    int pID = p.getId();\n+                    int pXP = xp + (partyExp.containsKey(pID) ? partyExp.get(pID) : 0);\n+                    partyExp.put(pID, pXP);\n+                } else {\n+                    giveExpToCharacter(mc, xp, isKiller, 1);\n                 }\n             }\n-        } finally {\n-            map.getCharacterReadLock().unlock();\n         }\n+        \n         for (Entry<Integer, Integer> party : partyExp.entrySet()) {\n             distributeExperienceToParty(party.getKey(), party.getValue(), killerId, expDist);\n         }"}, {"sha": "bbf8f2970f98b5a1fa00fb67b7fff36e8b3c0bf8", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 23, "deletions": 20, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -153,14 +153,6 @@ public MapleMap(int mapid, int world, int channel, int returnMapId, float monste\n         objectWLock = objectLock.writeLock();\n     }\n     \n-    public ReadLock getCharacterReadLock() {\n-        return chrRLock;\n-    }\n-    \n-    public WriteLock getCharacterWriteLock() {\n-        return chrWLock;\n-    }\n-\n     public void broadcastMessage(MapleCharacter source, final byte[] packet) {\n         chrRLock.lock();\n         try {\n@@ -1293,9 +1285,11 @@ public void run() {\n \n     public void addPlayer(final MapleCharacter chr) {\n         chrWLock.lock();\n+        chrRLock.lock();\n         try {\n             characters.add(chr);\n         } finally {\n+            chrRLock.unlock();\n             chrWLock.unlock();\n         }\n         chr.setMapId(mapid);\n@@ -1534,9 +1528,11 @@ public MaplePortal getRandomSpawnpoint() {\n \n     public void removePlayer(MapleCharacter chr) {\n         chrWLock.lock();\n+        chrRLock.lock();\n         try {\n             characters.remove(chr);\n         } finally {\n+            chrRLock.unlock();\n             chrWLock.unlock();\n         }\n         removeMapObject(chr.getObjectId());\n@@ -1794,7 +1790,13 @@ public void addAllMonsterSpawn(MapleMonster monster, int mobTime, int team) {\n     }\n \n     public Collection<MapleCharacter> getCharacters() {\n-        return Collections.unmodifiableCollection(this.characters);\n+        chrRLock.lock();\n+        try {\n+            return Collections.unmodifiableCollection(this.characters);\n+        }\n+        finally {\n+            chrRLock.unlock();\n+        }\n     }\n \n     public MapleCharacter getCharacterById(int id) {\n@@ -2068,9 +2070,16 @@ public void restoreMapSpawnPoints() {\n     }\n \n     public void respawn() {\n-        if (characters.isEmpty()) {\n-            return;\n+        chrRLock.lock();\n+        try {\n+            if (characters.isEmpty()) {\n+                return;\n+            }\n         }\n+        finally {\n+            chrRLock.unlock();\n+        }\n+        \n         short numShouldSpawn = (short) ((monsterSpawn.size() - spawnedMonstersOnMap.get()));//Fking lol'd\n         if (numShouldSpawn > 0) {\n             List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n@@ -2227,6 +2236,7 @@ public void run() {\n                 if (timeLimit != 0 && timeLimit < System.currentTimeMillis()) {\n                     warpEveryone(getForcedReturnId());\n                 }\n+                \n                 if (getCharacters().isEmpty()) {\n                     resetReactors();\n                     killAllMonsters();\n@@ -2263,14 +2273,8 @@ public boolean getSummonState() {\n     }\n \n     public void warpEveryone(int to) {\n-        List<MapleCharacter> players;\n-        chrRLock.lock();\n-        try {\n-            players = new ArrayList<>(getCharacters());\n-        } finally {\n-            chrRLock.unlock();\n-        }\n-\n+        List<MapleCharacter> players = new ArrayList<>(getCharacters());\n+        \n         for (MapleCharacter chr : players) {\n             chr.changeMap(to);\n         }\n@@ -2315,7 +2319,6 @@ public MapleCoconut getCoconut() {\n \n     public void warpOutByTeam(int team, int mapid) {\n         List<MapleCharacter> chars = new ArrayList<>(getCharacters());\n-\n         for (MapleCharacter chr : chars) {\n             if (chr != null) {\n                 if (chr.getTeam() == team) {"}, {"sha": "9d13d76a659f2257391171b1bd94df3771ba4ef9", "filename": "wz/Item.wz/Etc/0400.img.xml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Item.wz/Etc/0400.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Item.wz/Etc/0400.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Etc/0400.img.xml?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -7340,6 +7340,7 @@\n       </canvas>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n+      <int name=\"quest\" value=\"1\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04001112\">"}, {"sha": "9404edc0d8468170390221f6369b276e350f1976", "filename": "wz/Quest.wz/Act.img.xml", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Quest.wz/Act.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Quest.wz/Act.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Act.img.xml?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -9994,6 +9994,12 @@\n     <imgdir name=\"1\">\n     </imgdir>\n     <imgdir name=\"0\">\n+      <imgdir name=\"item\">\n+        <imgdir name=\"0\">\n+          <int name=\"id\" value=\"4031619\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"2127\">"}, {"sha": "9ae3d8374310342b3ba19eb36ea1a71ac6881c8d", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7dc163fc765db51669b8feaa8613d68c3bf628ca/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=7dc163fc765db51669b8feaa8613d68c3bf628ca", "patch": "@@ -37776,7 +37776,7 @@\n   </imgdir>\n   <imgdir name=\"6110\">\n     <imgdir name=\"1\">\n-      <string name=\"0\" value=\" Great! You eliminated 200#r#o9300087##k. Can you feel your strength growing? Now you can learn the Rush skill.\"/>\n+      <string name=\"0\" value=\"Great! You eliminated 200 #r#o9300087##k. Can you feel your strength growing? Now you can learn the Rush skill.\"/>\n       <string name=\"1\" value=\"Look. This is #bBook of Taurospear&apos;s Rush Skill#k. It can be translated into a language humans can understand. If you&apos;re smart enough, you can learn and read it! \"/>\n       <imgdir name=\"yes\">\n         <string name=\"0\" value=\" Good! It feels great to be strong doesn&apos;t it?\"/>"}]}]},
