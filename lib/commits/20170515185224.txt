{"fetchDate": "2019-12-19", "content": [{"sha": "a56312ddd30f54ebc73ceda528bc9267bf8b4105", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YTU2MzEyZGRkMzBmNTRlYmM3M2NlZGE1MjhiYzkyNjdiZjhiNDEwNQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-15T18:52:24Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-15T18:52:24Z"}, "message": "Ludibrium Maze PQ\n\nImplemented Ludibrium Maze PQ.", "tree": {"sha": "bf262ebf76e0d950aa26ff5950d1d5235faa91f4", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/bf262ebf76e0d950aa26ff5950d1d5235faa91f4"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/a56312ddd30f54ebc73ceda528bc9267bf8b4105", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a56312ddd30f54ebc73ceda528bc9267bf8b4105", "html_url": "https://github.com/ronancpl/HeavenMS/commit/a56312ddd30f54ebc73ceda528bc9267bf8b4105", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a56312ddd30f54ebc73ceda528bc9267bf8b4105/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b26469301d8ccb4d2e42cea8b4c5b11688ca83d7", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b26469301d8ccb4d2e42cea8b4c5b11688ca83d7", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b26469301d8ccb4d2e42cea8b4c5b11688ca83d7"}], "stats": {"total": 12204, "additions": 6135, "deletions": 6069}, "files": [{"sha": "a25568c5a5adc80963aaafe3175049d6d39d031b", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -211,4 +211,11 @@ Sistema de lobbys para PQs agora. \n \n 12 - 13 Maio 2017,\n Nova ferramenta: monta uma tabela SQL que armazena id-nome de todos os itens descritos nos arquivos handbook e realiza buscas por nomes, retornando seus ids.\n-Implementa\ufffd\ufffdo da LPQ.\n\\ No newline at end of file\n+Implementa\ufffd\ufffdo da LPQ.\n+\n+14 Maio 2017,\n+Sistema de Lobbys na BRPQ: aloca lobbys disponiveis para times de acordo com o level medio dos jogadores.\n+Sword Earrings: +30HP -> +1 W.att / Shield Earrings: +1ACC -> +1 M.att\n+\n+15 Maio 2017,\n+Implementa\ufffd\ufffdo da LMPQ.\n\\ No newline at end of file"}, {"sha": "331d35f788d67be6f1e3bc1748df4db59d88d485", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 4, "deletions": 34, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -3,41 +3,11 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040038.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/command/Commands.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040041.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/reactor/2202004.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq5.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/Boats.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/AbstractPlayerInteraction.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq7.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/KerningPQ.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq0.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040043.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9020002.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040039.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9020001.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/world/MaplePartyCharacter.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/event/EventInstanceManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040035.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040037.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleMap.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/PiratePQ.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/reactor/ReactorActionManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040034.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040045.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq4.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040036.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/reactor/ReactorScriptManager.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/LudiPQ.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq1.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040047.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040042.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq6.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040044.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq2.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040040.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/portal/lpq3.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/BossRushPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/9000037.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/event/EventManager.java</file>\n         </group>\n     </open-files>\n </project-private>"}, {"sha": "7346ea53f548b153f4abce56d0a660412dee4705", "filename": "scripts/event/BossRushPQ.js", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/BossRushPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/BossRushPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BossRushPQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -9,6 +9,8 @@ var clearMap = 970030000;\n var minMapId = 970030001;\n var maxMapId = 970042711;\n \n+var eventTime = 5;     //5 minutes\n+\n var lobbyRange = [0, 7];\n \n function init() {\n@@ -30,6 +32,9 @@ function setEventRequirements() {\n         if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n         else reqStr += minLevel;\n         \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n         em.setProperty(\"party\", reqStr);\n }\n \n@@ -39,12 +44,12 @@ function setEventRewards(eim) {\n         var itemSet, itemQty, evLevel;\n \n         evLevel = 6;    //Rewards at event completion\n-        itemSet = [1122018, 1122005, 1022088, 1402013, 1032048, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022180, 2022179, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n+        itemSet = [1122018, 1122005, 1022088, 1402013, 1032030, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022180, 2022179, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n         itemQty = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 25, 25, 25, 25, 25, 25, 25, 25, 4, 4, 12, 12, 12, 12, 12, 25];\n         eim.setEventRewards(evLevel, itemSet, itemQty);\n \n         evLevel = 5;    //Rewards at Rest Spot V\n-        itemSet = [1122018, 1122005, 1022088, 1402013, 1032048, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022180, 2022179, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n+        itemSet = [1122018, 1122005, 1022088, 1402013, 1032030, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022180, 2022179, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n         itemQty = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 15, 15, 15, 15, 15, 15, 15, 15, 2, 2, 8, 8, 8, 8, 8, 12];\n         eim.setEventRewards(evLevel, itemSet, itemQty);\n         \n@@ -95,7 +100,7 @@ function setup(level, lobbyid) {\n         eim.setProperty(\"level\", level);\n         eim.setProperty(\"lobby\", lobbyid);\n         \n-        eim.startEventTimer(45 * 60000); //45 mins\n+        eim.startEventTimer(eventTime * 60000);\n         setEventRewards(eim);\n         setEventExclusives(eim);\n         return eim;"}, {"sha": "01b7d9d9b445fb9fb16171941a7fb5716158beee", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -33,7 +33,7 @@ em.setProperty(\"state\", \"1\");\n \tem.setProperty(\"glpq6\", \"0\");\n     var eim = em.newInstance(\"CWKPQ\" + leaderid);\n \tfor (var i = 0; i < mapz.length; i++) {\n-\t\tvar map = eim.setInstanceMap(610030000 + mapz[i]);\n+\t\tvar map = eim.getInstanceMap(610030000 + mapz[i]);\n \t\tif (map != null) {\n \t\t\tmap.resetFully();\n \t\t\tif (map.getId() == 610030400) {"}, {"sha": "e853b8d4f2d88cddae52ab23eecf8a7b55d45c6d", "filename": "scripts/event/Ellin.js", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/Ellin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/Ellin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Ellin.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -9,6 +9,8 @@ var clearMap = 930000800;\n var minMapId = 930000000;\n var maxMapId = 930000800;\n \n+var eventTime = 30;     // 30 minutes\n+\n var lobbyRange = [0, 0];\n \n function init() {\n@@ -67,20 +69,20 @@ function setup(level, lobbyid) {\n         var eim = em.newInstance(\"Ellin\" + lobbyid);\n         eim.setProperty(\"level\", level);\n         \n-        eim.setInstanceMap(930000000).resetPQ(level);\n-\teim.setInstanceMap(930000100).resetPQ(level);\n-\teim.setInstanceMap(930000200).resetPQ(level);\n-\teim.setInstanceMap(930000300).resetPQ(level);\n-\teim.setInstanceMap(930000400).resetPQ(level);\n-\tvar map = eim.setInstanceMap(930000500);\n+        eim.getInstanceMap(930000000).resetPQ(level);\n+\teim.getInstanceMap(930000100).resetPQ(level);\n+\teim.getInstanceMap(930000200).resetPQ(level);\n+\teim.getInstanceMap(930000300).resetPQ(level);\n+\teim.getInstanceMap(930000400).resetPQ(level);\n+\tvar map = eim.getInstanceMap(930000500);\n \tmap.resetPQ(level);\n         map.shuffleReactors();\n-\teim.setInstanceMap(930000600).resetPQ(level);\n-\teim.setInstanceMap(930000700).resetPQ(level);\n+\teim.getInstanceMap(930000600).resetPQ(level);\n+\teim.getInstanceMap(930000700).resetPQ(level);\n \n         respawnStg2(eim);\n         \n-        eim.startEventTimer(30 * 60000); //30 mins\n+        eim.startEventTimer(eventTime * 60000);\n         setEventRewards(eim);\n         setEventExclusives(eim);\n         return eim;"}, {"sha": "0238193a076f6213cce026ee0e875f63fd96bce9", "filename": "scripts/event/KerningPQ.js", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/KerningPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/KerningPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KerningPQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -1,6 +1,6 @@\n var isPq = true;\n-var minPlayers = 1, maxPlayers = 6;\n-var minLevel = 21, maxLevel = 200;\n+var minPlayers = 3, maxPlayers = 4;\n+var minLevel = 21, maxLevel = 30;\n var entryMap = 103000800;\n var exitMap = 103000890;\n var recruitMap = 103000000;\n@@ -9,6 +9,8 @@ var clearMap = 103000805;\n var minMapId = 103000800;\n var maxMapId = 103000805;\n \n+var eventTime = 30;     // 30 minutes\n+\n var lobbyRange = [0, 0];\n \n function init() {\n@@ -30,6 +32,9 @@ function setEventRequirements() {\n         if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n         else reqStr += minLevel;\n         \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n         em.setProperty(\"party\", reqStr);\n }\n \n@@ -76,7 +81,7 @@ function setup(level, lobbyid) {\n         eim.setProperty(\"level\", level);\n         \n         respawnStages(eim);\n-        eim.startEventTimer(30 * 60000); //30 mins\n+        eim.startEventTimer(eventTime * 60000);\n         setEventRewards(eim);\n         setEventExclusives(eim);\n         return eim;"}, {"sha": "604d59c6024d7cf687c527cd142e118232f85fef", "filename": "scripts/event/LudiMazePQ.js", "status": "modified", "additions": 149, "deletions": 108, "changes": 257, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/LudiMazePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/LudiMazePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiMazePQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -1,129 +1,185 @@\n-/* \n- * This file is part of the OdinMS Maple Story Server\n-    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc> \n-                       Matthias Butz <matze@odinms.de>\n-                       Jan Christian Meyer <vimes@odinms.de>\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License version 3\n-    as published by the Free Software Foundation. You may not use, modify\n-    or distribute this program under any other version of the\n-    GNU Affero General Public License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n- */\n-\n-/*\n- * @Author Raz\n- * \n- * Ludi Maze PQ\n- */\n-\n-var exitMap;\n-var instanceId;\n-var finishMap;\n+var isPq = true;\n+var minPlayers = 3, maxPlayers = 6;\n+var minLevel = 51, maxLevel = 70;\n+var entryMap = 809050000;\n+var exitMap = 809050017;\n+var recruitMap = 220000000;\n+var clearMap = 809050016;\n+\n+var minMapId = 809050000;\n+var maxMapId = 809050016;\n+\n+var eventTime = 15;     // 15 minutes\n+\n+var lobbyRange = [0, 0];\n \n function init() {\n-    instanceId = 1;\n-    em.setProperty(\"shuffleReactors\", \"true\");\n+        setEventRequirements();\n }\n \n+function setLobbyRange() {\n+        return lobbyRange;\n+}\n \n+function setEventRequirements() {\n+        var reqStr = \"\";\n+        \n+        reqStr += \"\\r\\n    Number of players: \";\n+        if(maxPlayers - minPlayers >= 1) reqStr += minPlayers + \" ~ \" + maxPlayers;\n+        else reqStr += minPlayers;\n+        \n+        reqStr += \"\\r\\n    Level range: \";\n+        if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n+        else reqStr += minLevel;\n+        \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n+        em.setProperty(\"party\", reqStr);\n+}\n \n-function monsterValue(eim, mobId) {\n-    return 1;\n+function setEventExclusives(eim) {\n+        var itemSet = [4001106];\n+        eim.setExclusiveItems(itemSet);\n }\n \n-function setup() {\n-    exitMap = em.getChannelServer().getMapFactory().getMap(809050017);\n-    finishMap = em.getChannelServer().getMapFactory().getMap(809050016);\n-    var instanceName = \"LudiMazePQ\" + instanceId;\n-    var eim = em.newInstance(instanceName);\n-    var mf = eim.getMapFactory();\n-    instanceId++;\n-    var eventTime = 15 * (1000 * 60);\n-    em.schedule(\"timeOut\", eim, eventTime);\n-    eim.startEventTimer(eventTime);\n-    return eim;\n+function setEventRewards(eim) {\n+        var itemSet, itemQty, evLevel, expStages;\n+\n+        evLevel = 1;    //Rewards at clear PQ\n+        itemSet = [1442017, 1322025, 1032013, 1302016, 1072263, 1032043, 2000005, 2000004, 2001001, 2001002, 2020008, 2020010, 2030008, 2030010, 2030009, 2022000, 2001000, 2022019, 2020007, 2020006, 2020009, 2000006, 2040601, 2040605, 2040602, 2041027, 2041028, 2041004, 2041029, 2041017, 2041020, 2040008, 2040001, 2040009, 2040002, 2040504, 2040511, 2040505, 2040501, 2040904, 2040901, 2040905, 2040902, 2040404, 2040401, 2040405, 2040402];\n+        itemQty = [1, 1, 1, 1, 1, 1, 1, 5, 5, 5, 20, 20, 20, 20, 20, 50, 50, 50, 100, 100, 100, 100, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];\n+        eim.setEventRewards(evLevel, itemSet, itemQty);\n+        \n+        expStages = [];    //bonus exp given on CLEAR stage signal\n+        eim.setEventClearStageExp(expStages);\n+}\n+\n+function getEligibleParty(party) {      //selects, from the given party, the team that is allowed to attempt this event\n+        var eligible = [];\n+        var hasLeader = false;\n+        \n+        if(party.size() > 0) {\n+                var partyList = party.toArray();\n+\n+                for(var i = 0; i < party.size(); i++) {\n+                        var ch = partyList[i];\n+\n+                        if(ch.getMapId() == recruitMap && ch.getLevel() >= minLevel && ch.getLevel() <= maxLevel) {\n+                                if(ch.isLeader()) hasLeader = true;\n+                                eligible.push(ch);\n+                        }\n+                }\n+        }\n+        \n+        if(!(hasLeader && eligible.length >= minPlayers && eligible.length <= maxPlayers)) eligible = [];\n+        return eligible;\n }\n \n+function setup(level, lobbyid) {\n+        var eim = em.newInstance(\"LudiMaze\" + lobbyid);\n+        eim.setProperty(\"level\", level);\n+        \n+        for(var i = 809050000; i <= 809050016; i++) {\n+                eim.getInstanceMap(i).resetPQ(level);\n+                eim.getInstanceMap(i).shuffleReactors();\n+        }\n+        \n+        respawnStages(eim);\n+        eim.startEventTimer(eventTime * 60000);\n+        setEventRewards(eim);\n+        setEventExclusives(eim);\n+        return eim;\n+}\n+\n+function respawnStages(eim) {}\n+\n function playerEntry(eim, player) {\n-\tvar random = Math.floor((Math.random() * 16));\n-    var map = eim.getMapInstance(809050000 + random);\n-    player.changeMap(map, map.getPortal(0));\n-\t\n+        var map = eim.getMapInstance(entryMap);\n+        player.changeMap(map, map.getPortal(0));\n }\n \n-function playerDead(eim, player) {\n-    if (player.isAlive()) { //don't trigger on death, trigger on manual revive\n-        if (eim.isLeader(player)) { //check for party leader\n-            var party = eim.getPlayers();\n-            for (var i = 0; i < party.size(); i++)\n-                playerExit(eim, party.get(i));\n-            eim.dispose();\n+function scheduledTimeout(eim) {\n+        end(eim);\n+}\n+\n+function playerExit(eim, player) {\n+        eim.unregisterPlayer(player);\n+        player.changeMap(exitMap, 0);\n+}\n+\n+function changedMap(eim, player, mapid) {\n+        if (mapid < minMapId || mapid > maxMapId) {\n+                if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                        eim.unregisterPlayer(player);\n+                        end(eim);\n+                }\n+                else\n+                        eim.unregisterPlayer(player);\n+        }\n+}\n+\n+function changedLeader(eim, leader) {\n+        var mapid = leader.getMapId();\n+        if (!eim.isEventCleared() && (mapid < minMapId || mapid > maxMapId)) {\n+                end(eim);\n+        }\n+}\n+\n+function playerDead(eim, player) {}\n+\n+function playerRevive(eim, player) { // player presses ok on the death pop up.\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n         }\n         else\n-            playerExit(eim, player);\n-    }\n+                eim.unregisterPlayer(player);\n }\n \n function playerDisconnected(eim, player) {\n-    if (eim.isLeader(player)) { //check for party leader\n-        //boot whole party and end\n-        var party = eim.getPlayers();\n-        for (var i = 0; i < party.size(); i++)\n-            if (party.get(i).equals(player))\n-                removePlayer(eim, player);\n-            else\n-                playerExit(eim, party.get(i));\n-        eim.dispose();\n-    }\n-    else\n-        removePlayer(eim, player);\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n+        }\n+        else\n+                eim.unregisterPlayer(player);\n }\n \n function leftParty(eim, player) {\n-    playerExit(eim, player);\n+        if (eim.isEventTeamLackingNow(false, minPlayers, player)) {\n+                eim.unregisterPlayer(player);\n+                end(eim);\n+        }\n+        else\n+                eim.unregisterPlayer(player);\n }\n \n function disbandParty(eim) {\n-    //boot whole party and end\n-    var party = eim.getPlayers();\n-    for (var i = 0; i < party.size(); i++)\n-        playerExit(eim, party.get(i));\n-    eim.dispose();\n+        end(eim);\n }\n \n-function playerExit(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.changeMap(exitMap, exitMap.getPortal(0));\n+function monsterValue(eim, mobId) {\n+        return 1;\n }\n \n-\n-function playerFinish(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.changeMap(finishMap, finishMap.getPortal(0));\n+function end(eim) {\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++) {\n+                playerExit(eim, party.get(i));\n+        }\n+        eim.dispose();\n }\n \n-//for offline players\n-function removePlayer(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.getMap().removePlayer(player);\n-    player.setMap(exitMap);\n+function giveRandomEventReward(eim, player) {\n+        eim.giveEventReward(player);\n }\n \n function clearPQ(eim) {\n-    var party = eim.getPlayers();\n-    for (var i = 0; i < party.size(); i++) {\n-        playerFinish(eim, party.get(i));\n-    }\n-    eim.dispose();\n+        eim.stopEventTimer();\n+        eim.setEventCleared();\n+        \n+        eim.warpEventTeam(809050016);\n }\n \n function monsterKilled(mob, eim) {}\n@@ -133,18 +189,3 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose(eim) {}\n-\n-function timeOut(eim) {\n-    if (eim != null) {\n-        if (eim.getPlayerCount() > 0) {\n-            var pIter = eim.getPlayers().iterator();\n-            while (pIter.hasNext())\n-                playerExit(eim, pIter.next());\n-        }\n-        eim.dispose();\n-    }\n-}\n-\n-function playerRevive(eim, player) {\n-     \n-}\n\\ No newline at end of file"}, {"sha": "8469542404b75065d59391fe400800a1ce8bb4ba", "filename": "scripts/event/LudiPQ.js", "status": "modified", "additions": 32, "deletions": 27, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/LudiPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/LudiPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/LudiPQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -1,6 +1,6 @@\n var isPq = true;\n-var minPlayers = 1, maxPlayers = 6;\n-var minLevel = 1, maxLevel = 200;\n+var minPlayers = 5, maxPlayers = 6;\n+var minLevel = 35, maxLevel = 50;\n var entryMap = 922010100;\n var exitMap = 922010000;\n var recruitMap = 221024500;\n@@ -9,6 +9,8 @@ var clearMap = 922011000;\n var minMapId = 922010100;\n var maxMapId = 922011100;\n \n+var eventTime = 45;     // 45 minutes\n+\n var lobbyRange = [0, 0];\n \n function init() {\n@@ -30,6 +32,9 @@ function setEventRequirements() {\n         if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n         else reqStr += minLevel;\n         \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n         em.setProperty(\"party\", reqStr);\n }\n \n@@ -85,33 +90,33 @@ function setup(level, lobbyid) {\n         eim.setProperty(\"statusStg8\", -1);\n         eim.setProperty(\"statusStg9\", -1);\n         \n-        eim.setInstanceMap(922010100).resetPQ(level);\n-        eim.setInstanceMap(922010200).resetPQ(level);\n-        eim.setInstanceMap(922010201).resetPQ(level);\n-        eim.setInstanceMap(922010300).resetPQ(level);\n-        eim.setInstanceMap(922010400).resetPQ(level);\n-        eim.setInstanceMap(922010401).resetPQ(level);\n-        eim.setInstanceMap(922010402).resetPQ(level);\n-        eim.setInstanceMap(922010403).resetPQ(level);\n-        eim.setInstanceMap(922010404).resetPQ(level);\n-        eim.setInstanceMap(922010405).resetPQ(level);\n-        eim.setInstanceMap(922010500).resetPQ(level);\n-        eim.setInstanceMap(922010500).resetPQ(level);\n-        eim.setInstanceMap(922010501).resetPQ(level);\n-        eim.setInstanceMap(922010502).resetPQ(level);\n-        eim.setInstanceMap(922010503).resetPQ(level);\n-        eim.setInstanceMap(922010504).resetPQ(level);\n-        eim.setInstanceMap(922010505).resetPQ(level);\n-        eim.setInstanceMap(922010506).resetPQ(level);\n-        eim.setInstanceMap(922010600).resetPQ(level);\n-        eim.setInstanceMap(922010700).resetPQ(level);\n-        eim.setInstanceMap(922010800).resetPQ(level);\n-        eim.setInstanceMap(922010900).resetPQ(level);\n-        eim.setInstanceMap(922011000).resetPQ(level);\n-        eim.setInstanceMap(922011100).resetPQ(level);\n+        eim.getInstanceMap(922010100).resetPQ(level);\n+        eim.getInstanceMap(922010200).resetPQ(level);\n+        eim.getInstanceMap(922010201).resetPQ(level);\n+        eim.getInstanceMap(922010300).resetPQ(level);\n+        eim.getInstanceMap(922010400).resetPQ(level);\n+        eim.getInstanceMap(922010401).resetPQ(level);\n+        eim.getInstanceMap(922010402).resetPQ(level);\n+        eim.getInstanceMap(922010403).resetPQ(level);\n+        eim.getInstanceMap(922010404).resetPQ(level);\n+        eim.getInstanceMap(922010405).resetPQ(level);\n+        eim.getInstanceMap(922010500).resetPQ(level);\n+        eim.getInstanceMap(922010500).resetPQ(level);\n+        eim.getInstanceMap(922010501).resetPQ(level);\n+        eim.getInstanceMap(922010502).resetPQ(level);\n+        eim.getInstanceMap(922010503).resetPQ(level);\n+        eim.getInstanceMap(922010504).resetPQ(level);\n+        eim.getInstanceMap(922010505).resetPQ(level);\n+        eim.getInstanceMap(922010506).resetPQ(level);\n+        eim.getInstanceMap(922010600).resetPQ(level);\n+        eim.getInstanceMap(922010700).resetPQ(level);\n+        eim.getInstanceMap(922010800).resetPQ(level);\n+        eim.getInstanceMap(922010900).resetPQ(level);\n+        eim.getInstanceMap(922011000).resetPQ(level);\n+        eim.getInstanceMap(922011100).resetPQ(level);\n         \n         respawnStages(eim);\n-        eim.startEventTimer(45 * 60000); //45 mins\n+        eim.startEventTimer(eventTime * 60000);\n         setEventRewards(eim);\n         setEventExclusives(eim);\n         return eim;"}, {"sha": "f077674c7d2c4bfd56d50f0bc338bd71c11c00bd", "filename": "scripts/event/PiratePQ.js", "status": "modified", "additions": 17, "deletions": 12, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/PiratePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/PiratePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PiratePQ.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -9,6 +9,8 @@ var clearMap = 925100600;\n var minMapId = 925100000;\n var maxMapId = 925100500;\n \n+var eventTime = 20;     // 20 minutes\n+\n var lobbyRange = [0, 0];\n \n function init() {\n@@ -30,6 +32,9 @@ function setEventRequirements() {\n         if(maxLevel - minLevel >= 1) reqStr += minLevel + \" ~ \" + maxLevel;\n         else reqStr += minLevel;\n         \n+        reqStr += \"\\r\\n    Time limit: \";\n+        reqStr += eventTime + \" minutes\";\n+        \n         em.setProperty(\"party\", reqStr);\n }\n \n@@ -74,11 +79,11 @@ function setup(level, lobbyid) {\n \teim.setProperty(\"stage5\", \"0\");\n         \n         eim.setProperty(\"openedChests\", \"0\");\n-        eim.setInstanceMap(925100000).resetPQ(level);\n-        eim.setInstanceMap(925100000).shuffleReactors();\n+        eim.getInstanceMap(925100000).resetPQ(level);\n+        eim.getInstanceMap(925100000).shuffleReactors();\n         \n-\teim.setInstanceMap(925100100).resetPQ(level);\n-\tvar map = eim.setInstanceMap(925100200);\n+\teim.getInstanceMap(925100100).resetPQ(level);\n+\tvar map = eim.getInstanceMap(925100200);\n \tmap.resetPQ(level);\n         map.shuffleReactors();\n \tfor (var i = 0; i < 5; i++) {\n@@ -99,7 +104,7 @@ function setup(level, lobbyid) {\n \t\tmap.spawnMonsterOnGroundBelow(mob3, new java.awt.Point(430, 238));\n \t\tmap.spawnMonsterOnGroundBelow(mob4, new java.awt.Point(1600, 238));\n \t}\n-\tmap = eim.setInstanceMap(925100201);\n+\tmap = eim.getInstanceMap(925100201);\n \tmap.resetPQ(level);\n \tfor (var i = 0; i < 10; i++) {\n \t\tvar mob = em.getMonster(9300112);\n@@ -111,8 +116,8 @@ function setup(level, lobbyid) {\n \t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(0, 238));\n \t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1700, 238));\n \t}\n-\teim.setInstanceMap(925100202).resetPQ(level);\n-\tmap = eim.setInstanceMap(925100300);\n+\teim.getInstanceMap(925100202).resetPQ(level);\n+\tmap = eim.getInstanceMap(925100300);\n \tmap.resetPQ(level);\n         map.shuffleReactors();\n \tfor (var i = 0; i < 5; i++) {\n@@ -133,7 +138,7 @@ function setup(level, lobbyid) {\n \t\tmap.spawnMonsterOnGroundBelow(mob3, new java.awt.Point(430, 238));\n \t\tmap.spawnMonsterOnGroundBelow(mob4, new java.awt.Point(1600, 238));\n \t}\n-\tmap = eim.setInstanceMap(925100301);\n+\tmap = eim.getInstanceMap(925100301);\n \tmap.resetPQ(level);\n \tfor (var i = 0; i < 10; i++) {\n \t\tvar mob = em.getMonster(9300112);\n@@ -145,13 +150,13 @@ function setup(level, lobbyid) {\n \t\tmap.spawnMonsterOnGroundBelow(mob, new java.awt.Point(0, 238));\n \t\tmap.spawnMonsterOnGroundBelow(mob2, new java.awt.Point(1700, 238));\n \t}\n-\teim.setInstanceMap(925100302).resetPQ(level);\n-\teim.setInstanceMap(925100400).resetPQ(level);\n-\teim.setInstanceMap(925100500).resetPQ(level);\n+\teim.getInstanceMap(925100302).resetPQ(level);\n+\teim.getInstanceMap(925100400).resetPQ(level);\n+\teim.getInstanceMap(925100500).resetPQ(level);\n         \n         respawnStg4(eim);\n         \n-        eim.startEventTimer(20 * 60000); //20 mins\n+        eim.startEventTimer(eventTime * 60000);\n         setEventRewards(eim);\n         setEventExclusives(eim);\n         return eim;"}, {"sha": "ad3bacd9e4dbd2fea0517a5dc2a33bd5b5f5f5bb", "filename": "scripts/event/s4aWorld.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/s4aWorld.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/event/s4aWorld.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/s4aWorld.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -15,7 +15,7 @@ function monsterValue(eim, mobId) {\n function setup() {\n     var eim = em.newInstance(\"s4aWorld\");\n \n-    eim.setInstanceMap(910500000).resetFully();\n+    eim.getInstanceMap(910500000).resetFully();\n     eim.startEventTimer(1200000);\n \n     em.setProperty(\"started\", \"true\");"}, {"sha": "8be44816495ea50d0624875ef84ef67ab53e1c9b", "filename": "scripts/npc/world0/1012112.js", "status": "modified", "additions": 67, "deletions": 2, "changes": 69, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/1012112.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/1012112.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/1012112.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -20,9 +20,73 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /**\n- * @author BubblesDev\n+ * @author BubblesDev, Ronan\n  * @NPC Tory\n  */\n+\n+var status = 0;\n+var em = null;\n+\n+function start() {\n+\tstatus = -1;\n+\taction(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && status == 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+                \n+                if (status == 0) {\n+                        em = cm.getEventManager(\"HenesysPQ\");\n+                        if(em == null) {\n+                                cm.sendOk(\"The Henesys PQ has encountered an error.\");\n+                                cm.dispose();\n+                                return;\n+                        }\n+                    \n+                        cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\");\n+                } else if (status == 1) {\n+                        if (selection == 0) {\n+                                if (cm.getParty() == null) {\n+                                        cm.sendOk(\"Hi there! I'm Tory. This place is covered with mysterious aura of the full moon, and no one person can enter here by him/herself.\");\n+                                        cm.dispose();\n+                                } else if(!cm.isLeader()) {\n+                                        cm.sendOk(\"If you'd like to enter here, the leader of your party will have to talk to me. Talk to your party leader about this.\");\n+                                        cm.dispose();\n+                                } else {\n+                                        var eli = em.getEligibleParty(cm.getParty());\n+                                        if(eli.size() > 0) {\n+                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                        cm.sendOk(\"Someone is already attempting the PQ. Please wait for them to finish, or find another channel.\");\n+                                                }\n+                                        }\n+                                        else {\n+                                                cm.sendOk(\"You cannot start this party quest yet, because either your party is not in the range size, some of your party members are not eligible to attempt it or they are not in this map. If you're having trouble finding party members, try Party Search.\");\n+                                        }\n+                                        \n+                                        cm.dispose();\n+                                }\n+                        } else if (selection == 1) {\n+                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                cm.dispose();\n+                        } else {\n+                                cm.sendOk(\"#e#b<Party Quest: Primrose Hill>#k#n\\r\\nCollect primrose seeds from the flowers at the bottom part of the map and drop them by the platforms above the stage. Primrose seed color must match to grow the seeds, so test until you find the correct combination. When all the seeds have been planted, that is, starting second part of the mission, scout the Moon Bunny while it prepares Rice Cakes for the hungry Growlie. Once Growlie becomes satisfied, your mission is complete.\");\n+                                cm.dispose();\n+                        }\n+                }\n+        }\n+}\n+\n+/*\n var status = 0;\n var chosen = 0;\n var min = 3;\n@@ -142,4 +206,5 @@ function action(mode, type, selection) {\n             }\n         }\n     }\n-}\n\\ No newline at end of file\n+}\n+*/\n\\ No newline at end of file"}, {"sha": "3195432b52ef0418f250a2cca4ee4d1337046265", "filename": "scripts/npc/world0/2040034.js", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040034.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040034.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040034.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -46,14 +46,9 @@ function action(mode, type, selection) {\n                                 } else {\n                                         var eli = em.getEligibleParty(cm.getParty());\n                                         if(eli.size() > 0) {\n-                                                if(!em.startInstance(0, cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n                                                         cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");                            \n                                                 }\n-                                                /*\n-                                                else {\n-                                                        cm.gainItem(4001022, 200);\n-                                                }\n-                                                */\n                                         }\n                                         else {\n                                                 cm.sendOk(\"You cannot start this party quest yet, because either your party is not in the range size, some of your party members are not eligible to attempt it or they are not in this map. If you're having trouble finding party members, try Party Search.\");"}, {"sha": "15006c97f0105e9449fdb4c6cc2a884212c09b1e", "filename": "scripts/npc/world0/2040035.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040035.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040035.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040035.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -45,7 +45,7 @@ function action(mode, type, selection) {\n                         var eim = cm.getEventInstance();\n                     \n                         if(!eim.giveEventReward(cm.getPlayer())) {\n-                                cm.sendNext(\"It seems you don't have a free slot in your #rEquip#k, #rUse#k or #rEtc#k inventories. Please make room and try again.\");\n+                                cm.sendNext(\"It seems you don't have a free slot in either your #rEquip#k, #rUse#k or #rEtc#k inventories. Please make room and try again.\");\n                         } else {\n                                 cm.warp(221024500);\n                         }"}, {"sha": "f6e545d0dcc1ad107799d17163655add6889dd58", "filename": "scripts/npc/world0/2040036.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040036.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040036.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040036.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -73,7 +73,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else {       // check stage completion\n                                         if (cm.haveItem(4001022, 25)) {\n-                                                cm.sendOk(\"Good job! you have collected all 25 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 25 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -25);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "d9cc41273d70d2a6f9caad8966c771c93dd0c647", "filename": "scripts/npc/world0/2040037.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040037.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040037.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040037.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -73,7 +73,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else {       // check stage completion\n                                         if (cm.haveItem(4001022, 15)) {\n-                                                cm.sendOk(\"Good job! you have collected all 15 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 15 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -15);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "4b928d6f36a1fe4c15a19363346d000a7b7dee06", "filename": "scripts/npc/world0/2040038.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040038.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040038.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040038.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -73,7 +73,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else {       // check stage completion\n                                         if (cm.haveItem(4001022, 32)) {\n-                                                cm.sendOk(\"Good job! you have collected all 32 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 32 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -32);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "63cd9ea51f07696e0274634af9970bc06062a424", "filename": "scripts/npc/world0/2040039.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040039.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040039.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040039.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -73,7 +73,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else {                      // check stage completion\n                                         if (cm.haveItem(4001022, 6)) {\n-                                                cm.sendOk(\"Good job! you have collected all 6 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 6 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -6);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "0c95cae66d0b34fcf1f46cc69ee131daed98a23a", "filename": "scripts/npc/world0/2040040.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040040.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040040.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040040.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -73,7 +73,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else {       // check stage completion\n                                         if (cm.haveItem(4001022, 24)) {\n-                                                cm.sendOk(\"Good job! you have collected all 24 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 24 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -24);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "75595b99d5229c198b73f78ef6e9d562fc23a786", "filename": "scripts/npc/world0/2040042.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040042.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2040042.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040042.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -76,7 +76,7 @@ function action(mode, type, selection) {\n                                 }\n                                 else if(state == 0) {       // check stage completion\n                                         if (cm.haveItem(4001022, 3)) {\n-                                                cm.sendOk(\"Good job! you have collected all 3 #b#t4001022#'s.#k\");\n+                                                cm.sendOk(\"Good job! You have collected all 3 #b#t4001022#'s.#k\");\n                                                 cm.gainItem(4001022, -3);\n \n                                                 eim.setProperty(\"statusStg\" + stage, 1);"}, {"sha": "51062545b236c164db44bb97dc2b063e35a5ca35", "filename": "scripts/npc/world0/2094000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2094000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2094000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094000.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -46,7 +46,7 @@ function action(mode, type, selection) {\n                                 } else {\n                                         var eli = em.getEligibleParty(cm.getParty());\n                                         if(eli.size() > 0) {\n-                                                if(!em.startInstance(0, cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n                                                         cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");                            \n                                                 }\n                                         }"}, {"sha": "cbbcf62708b704a740f0a62026de0d0fd1917a1b", "filename": "scripts/npc/world0/2133000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2133000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/2133000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -46,7 +46,7 @@ function action(mode, type, selection) {\n                                 } else {\n                                         var eli = em.getEligibleParty(cm.getParty());\n                                         if(eli.size() > 0) {\n-                                                if(!em.startInstance(0, cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n                                                         cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");\n                                                 }\n                                         }"}, {"sha": "9658041cb87167a0ba51b822c5ca50a9721df26e", "filename": "scripts/npc/world0/9000037.js", "status": "modified", "additions": 31, "deletions": 2, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9000037.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9000037.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9000037.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -17,6 +17,28 @@ function isFinalBossDone() {\n     return cm.getMapId() >= 970032700 && cm.getMapId() < 970032800 && cm.getMap().getMonsters().isEmpty();\n }\n \n+function detectTeamLobby(team) {\n+    var midLevel = 0;\n+    \n+    for(var i = 0; i < team.size(); i++) {\n+        var player = team.get(i);\n+        midLevel += player.getLevel();\n+    }\n+    midLevel = Math.floor(midLevel / team.size());\n+    \n+    var lobby;  // teams low level can be allocated at higher leveled lobbys\n+    if(midLevel <= 20) lobby = 0;\n+    else if(midLevel <= 40) lobby = 1;\n+    else if(midLevel <= 60) lobby = 2;\n+    else if(midLevel <= 80) lobby = 3;\n+    else if(midLevel <= 90) lobby = 4;\n+    else if(midLevel <= 100) lobby = 5;\n+    else if(midLevel <= 110) lobby = 6;\n+    else lobby = 7;\n+        \n+    return lobby;\n+}\n+\n function start() {\n \tstatus = -1;\n         state = (cm.getMapId() >= 970030001 && cm.getMapId() <= 970042711) ? (!onRestingSpot() ? (isFinalBossDone() ? 3 : 1) : 2) : 0;\n@@ -91,7 +113,9 @@ function action(mode, type, selection) {\n                                 cm.dispose();\n                         } else if(state == 2) {\n                                 var restSpot = ((cm.getMapId() - 1) % 5) + 1;\n+                                cm.getPlayer().getEventInstance().addEventTimer(restSpot * 4 * 60000);  // adds (restspot number * 4) minutes\n                                 cm.getPlayer().getEventInstance().warpEventTeam(970030100 + cm.getEventInstance().getIntProperty(\"lobby\") + (500 * restSpot));\n+                                \n                                 cm.dispose();\n                         } else if(state == 1) {\n                                 cm.warp(970030000);\n@@ -108,7 +132,12 @@ function action(mode, type, selection) {\n                                         } else {\n                                                 var eli = em.getEligibleParty(cm.getParty());\n                                                 if(eli.size() > 0) {\n-                                                        if(!em.startInstance(0, cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                        var lobby = detectTeamLobby(eli), i;\n+                                                        for(i = lobby; i < 8; i++) {\n+                                                                if(em.startInstance(i, cm.getParty(), cm.getPlayer().getMap(), 1)) break;\n+                                                        }\n+                                                        \n+                                                        if(i == 8) {\n                                                                 cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");\n                                                         }\n                                                 }\n@@ -122,7 +151,7 @@ function action(mode, type, selection) {\n                                         cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n                                         cm.dispose();\n                                 } else {\n-                                        cm.sendOk(\"#e#b<Party Quest: Boss Rush>#k#n\\r\\nBrave adventurers from all over the places travels here to test their skills and abilities in combat, as they face even more powerful bosses from MapleStory. Join forces with fellow adventurers or face all the burden by yourself and receive all the glory, it is up to you. REWARDS are given accordingly to how far the adventurers reach and extra prizes may are given to a random member of the party, all attributed at the end of an expedition.\");\n+                                        cm.sendOk(\"#e#b<Party Quest: Boss Rush>#k#n\\r\\nBrave adventurers from all over the places travels here to test their skills and abilities in combat, as they face even more powerful bosses from MapleStory. Join forces with fellow adventurers or face all the burden by yourself and receive all the glory, it is up to you. REWARDS are given accordingly to how far the adventurers reach and extra prizes may are given to a random member of the party, all attributed at the end of an expedition.\\r\\n\\r\\nThis event also supports #bmultiple lobbies for matchmaking several ranges of team levels#k at once: team up with players with lower level if you want better chances to swiftly set up a boss rush for your team.\");\n                                         cm.dispose();\n                                 }\n                         }"}, {"sha": "b47767451858ab4202b358c6c058577692cc1ae7", "filename": "scripts/npc/world0/9000038.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9000038.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9000038.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9000038.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -7,10 +7,10 @@\n \n var status;\n \n-var itemSet_lv6 = [1122018, 1122005, 1022088, 1402013, 1032048, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022179, 2022180, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n+var itemSet_lv6 = [1122018, 1122005, 1022088, 1402013, 1032030, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022179, 2022180, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n var itemQty_lv6 = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 25, 25, 25, 25, 25, 25, 25, 25, 4, 4, 12, 12, 12, 12, 12, 25];\n \n-var itemSet_lv5 = [1122018, 1122005, 1022088, 1402013, 1032048, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022179, 2022180, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n+var itemSet_lv5 = [1122018, 1122005, 1022088, 1402013, 1032030, 1032070, 1102046, 2330004, 2041013, 2041016, 2041019, 2041022, 2049100, 2049003, 2020012, 2020013, 2020014, 2020015, 2022029, 2022045, 2022068, 2022069, 2022179, 2022180, 4004000, 4004001, 4004002, 4004003, 4004004, 4003000];\n var itemQty_lv5 = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 15, 15, 15, 15, 15, 15, 15, 15, 2, 2, 8, 8, 8, 8, 8, 12];\n \n var itemSet_lv4 = [1122001, 1122006, 1022103, 1442065, 1032042, 1032021, 1102168, 2070005, 2040025, 2040029, 2040301, 2040413, 2040701, 2040817, 2002028, 2020009, 2020010, 2020011, 2022004, 2022005, 2022025, 2022027, 2022048, 2022049, 4020000, 4020001, 4020002, 4020003, 4020004, 4020005, 4020006, 4020007, 4020008, 4003000];"}, {"sha": "b60eee316ef08cb0edda24017935bea1e488eed2", "filename": "scripts/npc/world0/9020000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9020000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9020000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9020000.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -57,7 +57,7 @@ function action(mode, type, selection) {\n                                         } else {\n                                                 var eli = em.getEligibleParty(cm.getParty());\n                                                 if(eli.size() > 0) {\n-                                                        if(!em.startInstance(0, cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                        if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n                                                                 cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");\n                                                         }\n                                                 }"}, {"sha": "869ed6d58d6dfbfeb0a7e9813fdf5df35a77e266", "filename": "scripts/npc/world0/9103000.js", "status": "modified", "additions": 48, "deletions": 48, "changes": 96, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9103000.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -20,60 +20,60 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /*\n- *@Author RMZero213\n- * Ludibrium Maze Party Quest\n- * Do not release anywhere other than RaGEZONE. Give credit if used.\n- */\n+*\tAuthor : Raz, Ronan\n+*\n+*\tNPC = 9103000 - Pierre\n+*\tMap =  Ludibrium - Ludibrium Maze 16\n+*\tNPC MapId = 809050015\n+*\tFunction = Gives LMPQ EXP reward\n+*\n+*/\n \n var status = 0;\n-var minimumCouponsNeeded = 200;\n+var qty = 0;\n+\n function start() {\n     status = -1;\n-    action(1,0,0);\n+    action(1, 0, 0);\n }\n \n-function action(mode, type, selection){\n-    if (mode == -1|| (mode == 0 && status == 0))\n-        cm.dispose();\n-    else {\n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        if (status == 0) {\n-            if (!isLeader()) {\n-                cm.sendOk(\"Give any coupons to the leader of the party and tell them to talk to me.\");\n-                cm.dispose();\n-            } else {\n-                cm.sendYesNo(\"Do you have all the coupons of the party and would like to get out of here?\");\n-\t\t\t}\n-        } else if (status == 1) {\n-\t\t\tif (cm.itemQuantity(4001106) < minimumCouponsNeeded){\n-\t\t\t\tcm.sendOk(\"Sorry, but you do not have at least \" + minimumCouponsNeeded + \" coupons! Talk to me again when you've collected more!\");\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n                 cm.dispose();\n-\t\t\t\treturn;\n-\t\t\t}\n-\t\t\tvar party = cm.getPartyMembers();\n-            for (var i = 0; i < party.size(); i++) {\n-                if (party.get(i).getMap().getId() != 809050015) {\n-                    cm.sendOk(\"A member of your party is not presently in the map.\");\n-                    cm.dispose();\n-                    return;\n+        } else {\n+                if (mode == 0 && status == 0) {\n+                        cm.dispose();\n+                        return;\n                 }\n-            }\n-\t\t\tvar members = cm.getPlayer().getEventInstance().getPlayers();\n-\t\t\t//cm.removeFromParty(4001106, members);\n-\t\t\tcm.gainItem(4001106, -200);\n-\t\t\tcm.givePartyExp(\"LudiMazePQ\");\n-\t\t\tcm.warpParty(809050016);\n-            cm.dispose();\n-        }\t\n-    }\n-}\n-\n-function isLeader(){\n-    if(cm.getParty() == null)\n-        return false;\n-    else\n-        return cm.isLeader();\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+                \n+                if (status == 0) {\n+                        if(cm.isLeader()) {\n+                                if(!cm.getEventInstance().isEventTeamTogether()) {\n+                                        cm.sendOk(\"One or more event team members is missing, please wait for them to reach here first.\");\n+                                        cm.dispose();\n+                                }\n+                                else if(cm.hasItem(4001106, 30)) {\n+                                        qty = cm.getItemQuantity(4001106);\n+                                        cm.sendYesNo(\"Splendid! You have retrieved \" + qty + \" #t4001106# from this run, now your team will receive the fair amount of EXP from this action. Are you ready to get transported out?\");\n+                                }\n+                                else {\n+                                        cm.sendOk(\"Your party cannot finish this PQ yet, as you have not reached the minimum of 30 #t4001106#'s in hand yet.\");\n+                                        cm.dispose();\n+                                }\n+                        }\n+                        else {\n+                                cm.sendOk(\"Let your party leader talk to me to end this quest.\");\n+                                cm.dispose();\n+                        }\n+                } else if(status == 1) {\n+                        cm.removeAll(4001106);\n+                        cm.getEventInstance().giveEventPlayersExp(50 * qty);\n+                        cm.getEventInstance().clearPQ();\n+                        cm.dispose();\n+                }\n+        }\n }\n\\ No newline at end of file"}, {"sha": "27891371f31a51a6eb82a065882973e24d695ffb", "filename": "scripts/npc/world0/9103001.js", "status": "modified", "additions": 54, "deletions": 102, "changes": 156, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9103001.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -20,120 +20,72 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /*\n-@\tAuthor : Raz\n-@\n-@\tNPC = 9103001 - Rolly\n-@\tMap =  Ludibrium - <Ludibrium>\n-@\tNPC MapId = 220000000\n-@\tFunction = Start LMPQ\n-@\n+*\tAuthor : Raz, Ronan\n+*\n+*\tNPC = 9103001 - Rolly\n+*\tMap =  Ludibrium - <Ludibrium>\n+*\tNPC MapId = 220000000\n+*\tFunction = Start LMPQ\n+*\n */\n \n var status = 0;\n-var minlvl = 51;\n-var maxlvl = 200;\n-var minplayers = 3;\n-var maxplayers = 6;\n-var time = 15;\n-var open = true;\n \n function start() {\n     status = -1;\n     action(1, 0, 0);\n }\n \n function action(mode, type, selection) {\n-    if (mode == -1) {\n-        cm.dispose();\n-    } else if (mode == 0) {\n-        cm.dispose();\n-    } else {\n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-\t\t\n-        if (status == 0) {\n-            cm.sendSimple(\"This is the entrance to the Ludibrium Maze. Enjoy!\\r\\n#b#L0#Enter the Lubidrium Maze#l\\r\\n#L1#What is the Ludibrium Maze?\");\n-\t \t\n-        } else if (status == 1) {\n-            var em = cm.getEventManager(\"LudiMazePQ\");\n-            if(selection == 0) {//ENTER THE PQ\n-                if (!hasParty()) {//NO PARTY\n-                    cm.sendOk(\"Try taking on the Maze Quest with your party. If you DO decide to tackle it, please have your Party Leader notify me!\");\n-                } else if (!isLeader()) {//NOT LEADER\n-                    cm.sendOk(\"Try taking on the Maze Quest with your party. If you DO decide to tackle it, please have your Party Leader notify me!\");\n-                } else if (!checkPartySize()) {//PARTY SIZE WRONG\n-                    cm.sendOk(\"Your party needs to consist of at least \" + minplayers + \" members in order to tackle this maze\");\n-                } else if (!checkPartyLevels()) {//WRONG LEVELS\n-                    cm.sendOk(\"One of your party members has not met the level requirements of \" + minlvl + \"~\" + maxlvl + \".\");\n-                } else if (em == null) {//EVENT ERROR\n-                    cm.sendOk(\"ERROR IN EVENT\");\n-                } else if (!open){\n-                    cm.sendOk(\"The PQ is #rclosed#k for now.\");\n-                } else {\n-                    if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap())) {\n-                        cm.sendOk(\"A party in your name is already registered in this event.\");\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && status == 0) {\n                         cm.dispose();\n                         return;\n-                    }\n-                    var party = cm.getPlayer().getEventInstance().getPlayers();\n-                    cm.removeFromParty(4001106, party);\n                 }\n-                cm.dispose();\n-            } else if(selection == 1) {\n-                cm.sendOk(\"This maze is available to all parties of \" + minplayers + \" or more members, and all participants must be between Level \" + minlvl + \"~\" + maxlvl + \".  You will be given \" + time + \" minutes to escape the maze.  At the center of the room, there will be a Warp Portal set up to transport you to a different room.  These portals will transport you to other rooms where you'll (hopefully) find the exit.  Pietri will be waiting at the exit, so all you need to do is talk to him, and he'll let you out.  Break all the boxes located in the room, and a monster inside the box will drop a coupon.  After escaping the maze, you will be awarded with EXP based on the coupons collected.  Additionally, if the leader possesses at least 200 coupons, then a special gift will be presented to the party.  If you cannot escape the maze within the allotted \" + time +\" minutes, you will receive 0 EXP for your time in the maze.  If you decide to log off while you're in the maze, you will be automatically kicked out of the maze.  Even if the members of the party leave in the middle of the quest, the remaining members will be able to continue on with the quest.  If you are in critical condition and unable to hunt down the monsters, you may avoid them to save yourself.  Your fighting spirit and wits will be tested!  Good luck!\");\n-                cm.dispose();\n-            }\n-        }\n-    }\n-}\n-     \n-function getPartySize(){\n-    if(cm.getPlayer().getParty() == null){\n-        return 0;\n-    }else{\n-        return (cm.getPlayer().getParty().getMembers().size());\n-    }\n-}\n-\n-function isLeader(){\n-    return cm.isLeader();\n-}\n-\n-function checkPartySize(){\n-    var size = 0;\n-    if(cm.getPlayer().getParty() == null){\n-        size = 0;\n-    }else{\n-        size = (cm.getPlayer().getParty().getMembers().size());\n-    }\n-    if(size < minplayers || size > maxplayers){\n-        return false;\n-    }else{\n-        return true;\n-    }\n-}\n-\n-function checkPartyLevels(){\n-    var pass = true;\n-    var party = cm.getPlayer().getParty().getMembers();\n-    if(cm.getPlayer().getParty() == null){\n-        pass = false;\n-    }else{\n-        for (var i = 0; i < party.size() && pass; i++) {\n-            if ((party.get(i).getLevel() < minlvl) || (party.get(i).getLevel() > maxlvl) || (party.get(i).getPlayer().getMapId() != cm.getPlayer().getMapId())) {\n-                pass = false;\n-            }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+                \n+                if (status == 0) {\n+                        em = cm.getEventManager(\"LudiMazePQ\");\n+                        if(em == null) {\n+                                cm.sendOk(\"The Ludibrium Maze PQ has encountered an error.\");\n+                                cm.dispose();\n+                                return;\n+                        }\n+                    \n+                        cm.sendSimple(\"#e#b<Party Quest: Ludibrium Maze>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nThis is the entrance to the Ludibrium Maze. Enjoy!\\r\\n#b#L0#Enter the Lubidrium Maze#l\\r\\n#L1#I want to find party members.\\r\\n#L2#What is the Ludibrium Maze?\");\n+                } else if (status == 1) {\n+                        if (selection == 0) {\n+                                if (cm.getParty() == null) {\n+                                        cm.sendOk(\"Try taking on the Maze Quest with your party.\");\n+                                        cm.dispose();\n+                                } else if(!cm.isLeader()) {\n+                                        cm.sendOk(\"If you DO decide to tackle it, please have your Party Leader notify me!\");\n+                                        cm.dispose();\n+                                } else {\n+                                        var eli = em.getEligibleParty(cm.getParty());\n+                                        if(eli.size() > 0) {\n+                                                if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n+                                                        cm.sendOk(\"Another party has already entered the #rParty Quest#k in this channel. Please try another channel, or wait for the current party to finish.\");\n+                                                }\n+                                        }\n+                                        else {\n+                                                cm.sendOk(\"Your party needs to consist of at least 3 members in order to tackle this maze.\");\n+                                        }\n+                                        \n+                                        cm.dispose();\n+                                }\n+                        } else if (selection == 1) {\n+                                cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n+                                cm.dispose();\n+                        } else {\n+                                cm.sendOk(\"#e#b<Party Quest: Ludibrium Maze>#k#n\\r\\nThis maze is available to all parties of 3 or more members, and all participants must be between Level 51~70.  You will be given 15 minutes to escape the maze.  At the center of the room, there will be a Warp Portal set up to transport you to a different room.  These portals will transport you to other rooms where you'll (hopefully) find the exit.  Pietri will be waiting at the exit, so all you need to do is talk to him, and he'll let you out.  Break all the boxes located in the room, and a monster inside the box will drop a coupon.  After escaping the maze, you will be awarded with EXP based on the coupons collected.  Additionally, if the leader possesses at least 30 coupons, then a special gift will be presented to the party.  If you cannot escape the maze within the allotted 15 minutes, you will receive 0 EXP for your time in the maze.  If you decide to log off while you're in the maze, you will be automatically kicked out of the maze.  Even if the members of the party leave in the middle of the quest, the remaining members will be able to continue on with the quest, except if they run out of the minimum amount of party members in the maze.  If you are in critical condition and unable to hunt down the monsters, you may avoid them to save yourself.  Your fighting spirit and wits will be tested!  Good luck!\");\n+                                cm.dispose();\n+                        }\n+                }\n         }\n-    }\n-    return pass;\n-}\n-\n-function hasParty(){\n-    if(cm.getPlayer().getParty() == null){\n-        return false;\n-    }else{\n-        return true;\n-    }\n }\n\\ No newline at end of file"}, {"sha": "1aada5cea925d4c09c67d88979bc85d83e807ce5", "filename": "scripts/npc/world0/9103002.js", "status": "modified", "additions": 15, "deletions": 74, "changes": 89, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9103002.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -20,61 +20,13 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /*\n- *@Author RMZero213\n- * Ludibrium Maze Party Quest\n- * Do not release anywhere other than RaGEZONE. Give credit if used.\n+ *@Author Ronan\n+ * Rolly\n+ *\tLudibrium - Exit of the Maze (809050016)\n+ *\tGives Ludibrium Maze Party Quest reward\n  */\n \n var status = 0;\n-var rewards = new Array(\n-\t\t\t1442017, 1, //Blood Snowboard\n-\t\t\t1322025, 1, //Emergency Rescue Tube\n-\t\t\t1032013, 1, //Red-Hearted Earrings\n-\t\t\t1302016, 1, //Yellow Umbrella\n-\t\t\t1072263, 1, //Green Strap Shoes\n-\t\t\t1032043, 1, //Cecelia's Earrings\n-\t\t\t2000005, 1, //Power Elixir\n-\t\t\t2000004, 5, //Elixir\n-\t\t\t2001001, 5, //Ice Cream Pop\n-\t\t\t2001002, 5, //Red Bean Sundae\n-\t\t\t2020008, 20, //Fat Sausage\n-\t\t\t2020010, 20, //Grape Juice\n-\t\t\t2030008, 20, //Coffee Milk\n-\t\t\t2030010, 20, //Fruit Milk\n-\t\t\t2030009, 20, //Strawberry Milk\n-\t\t\t2022000, 50, //Pure Water\n-\t\t\t2001000, 50, //Watermelon\n-\t\t\t2022019, 50, //Kinoko Ramen (Pig Head)\n-\t\t\t2020007, 100, //Dried Squid\n-\t\t\t2020006, 100, //Hot Dog Supreme\n-\t\t\t2020009, 100, //Orange Juice\n-\t\t\t2000006, 100, //Mana Elixir\n-\t\t\t2040601, 1, //Scroll for Bottomwear for Def (60%)\n-\t\t\t2040605, 1, //Dark Scroll for Bottomwear for DEF 30%\n-\t\t\t2040602, 1, //Scroll for Bottomwear for DEF (10%)\n-\t\t\t2041027, 1, //Dark Scroll for Cape for Magic Def 30%\n-\t\t\t2041028, 1,\t//Dark Scroll for Cape for Weapon Def 70%\n-\t\t\t2041004, 1,\t//Scroll for Cape for Weapon Def 60%\n-\t\t\t2041029, 1,\t//Dark Scroll for Cape for Weapon Def 30%\n-\t\t\t2041017, 1,\t//Scroll for Cape for INT 10%\n-\t\t\t2041020, 1,\t//Scroll for Cape for DEX 10%\n-\t\t\t2040008, 1,\t//Dark Scroll for Helmet for DEF 70%\n-\t\t\t2040001, 1,\t//Scroll for Helmet for DEF 60%\n-\t\t\t2040009, 1,\t//Dark Scroll for Helmet for DEF 30%\n-\t\t\t2040002, 1,\t//Scroll for Helmet for DEF 10%\n-\t\t\t2040504, 1,\t//Scroll for Overall Armor for DEF 60%\n-\t\t\t2040511, 1, //Dark Scroll for Overall Armor for DEF 30%\n-\t\t\t2040505, 1,\t//Scroll for Overall Armor for DEF 10%\n-\t\t\t2040501, 1, //Scroll for Overall Armor for DEX 60%\n-\t\t\t2040904, 1,\t//Dark Scroll for Shield for DEF 70%\n-\t\t\t2040901, 1,\t//Scroll for Shield for DEF 60%\n-\t\t\t2040905, 1,\t//Dark Scroll for Shield for DEF 30%\n-\t\t\t2040902, 1,\t//Scroll for Shield for DEF 10%\n-\t\t\t2040404, 1, //Dark Scroll for Topwear for DEF 70%\n-\t\t\t2040401, 1,\t//Scroll for Topwear for DEF 60%\n-\t\t\t2040405, 1,\t//Dark Scroll for Topwear for DEF 30%\n-\t\t\t2040402, 1\t//Scroll for Topwear for DEF 10%\n-\t\t\t);\n \n function start() {\n     status = -1;\n@@ -94,28 +46,17 @@ function action(mode, type, selection){\n         else\n             status--;\n         if (status == 0) {\n-\t\t\tvar index = Math.floor(Math.random()*rewards.length);\n-\t\t\tvar reward;\n-\t\t\tvar quantity;\n-\t\t\tif (index % 2 == 0){ //The index was an item id\n-\t\t\t\treward = rewards[index];\n-\t\t\t\tquantity = rewards[index + 1];\n-\t\t\t} else {\n-\t\t\t\treward = rewards[index - 1];\n-\t\t\t\tquantity = rewards[index];\n-\t\t\t}\n-\t\t\tif(!cm.canHold(reward)){\n-\t\t\t\tcm.sendOk(\"Please make space in your inventory!\");\n-\t\t\t\treturn;\n-\t\t\t}\n-\t\t\tcm.gainItem(reward, quantity);\n-            var eim = cm.getPlayer().getEventInstance();\n-            if (eim != null) {\n-                eim.unregisterPlayer(cm.getPlayer());\n-            }\n-            cm.warp(220000000, 0);\n-\t\t\tcm.gainItem(4001106, -cm.itemQuantity(4001106))\n-            cm.dispose();\n+\t\tcm.sendYesNo(\"Your party gave a stellar effort and gathered up at least 30 coupons. For that, I have a present for each and every one of you. After receiving the present, you will be sent back to Ludibrium. Now, would you like to receive the present right now?\");\n+        } else if(status == 1) {\n+                var eim = cm.getEventInstance();\n+                    \n+                if(!eim.giveEventReward(cm.getPlayer())) {\n+                        cm.sendNext(\"It seems you don't have a free slot in either your #rEquip#k, #rUse#k or #rEtc#k inventories. Please make room and try again.\");\n+                } else {\n+                        cm.warp(809050017);\n+                }\n+\n+                cm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "f89a83d54f77161ae83992946790a096743da275", "filename": "scripts/npc/world0/9103003.js", "status": "modified", "additions": 22, "deletions": 9, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/scripts/npc/world0/9103003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/9103003.js?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -20,21 +20,34 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /*\n- *@Author SharpAceX (Alan)\n+ *@Author Ronan\n  * Ludibrium Maze Party Quest\n  */\n \n var status = 0;\n function start() {\n     status = -1;\n-    action(1,0,0);\n+    action(1, 0, 0);\n }\n \n function action(mode, type, selection){\n-    var eim = cm.getPlayer().getEventInstance();\n-    if (eim != null) {\n-        eim.unregisterPlayer(cm.getPlayer());\n-    }\n-    cm.warp(220000000, 0);\n-    cm.dispose();\n-}\n\\ No newline at end of file\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && status == 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+\n+                if (status == 0) {\n+                        cm.sendNext(\"Come this way to return to Ludibrium.\");\n+                } else {\n+                        cm.warp(220000000, 0);\n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "cf708d1e7aea5bd0dbc5ea416c8e6c633f48d583", "filename": "sql/db_drops.sql", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -19109,6 +19109,9 @@\n   # remove key of dimension dropping outside PQ\n   DELETE FROM drop_data where itemid=4001023 and dropperid!=9300012;\n \n+  # make Sword Earrings not drop by normal means, just like Shield Earrings\n+  DELETE FROM drop_data where itemid=1032030;\n+\n   # remove every not-card drop from bosses out of their natural habitat\n   DELETE FROM drop_data WHERE dropperid >= 9300184 AND dropperid < 9300215 AND (itemid < 2380000 OR itemid >= 2390000);\n   DELETE FROM drop_data WHERE dropperid >= 9500337 AND dropperid < 9500364 AND (itemid < 2380000 OR itemid >= 2390000);"}, {"sha": "d172a5ddcabc6f653a1e89c382107ee463518f9f", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -182,6 +182,10 @@ public boolean haveItem(int itemid) {\n \tpublic boolean haveItem(int itemid, int quantity) {\n \t\treturn getPlayer().getItemQuantity(itemid, false) >= quantity;\n \t}\n+        \n+        public int getItemQuantity(int itemid) {\n+                return getPlayer().getItemQuantity(itemid, false);\n+        }\n \n \tpublic boolean canHold(int itemid) {\n             return canHold(itemid, 1);"}, {"sha": "53d524d25e8ecd4d966907825f878a8fade33dd6", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -552,7 +552,7 @@ public boolean isLeader(MapleCharacter chr) {\n \t\treturn (chr.getParty().getLeaderId() == chr.getId());\n \t}\n         \n-        public final MapleMap setInstanceMap(final int mapid) { //gets instance map from the channelserv\n+        public final MapleMap getInstanceMap(final int mapid) { //gets instance map from the channelserv\n                 if (disposed) {\n                         return getMapFactory().getMap(mapid);\n                 }"}, {"sha": "6ac3e53a1fd1c727b6ffcefe820b493cb3d63dc5", "filename": "src/scripting/event/EventManager.java", "status": "modified", "additions": 34, "deletions": 5, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/event/EventManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/src/scripting/event/EventManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventManager.java?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -183,6 +183,15 @@ public int getIntProperty(String key) {\n         return Integer.parseInt(props.getProperty(key));\n     }\n     \n+    private boolean getLockLobby(int lobbyId) {\n+        l.lock();\n+        try {\n+            return openedLobbys.get(lobbyId);\n+        } finally {\n+            l.unlock();\n+        }\n+    }\n+    \n     private void setLockLobby(int lobbyId, boolean lock) {\n         l.lock();\n         try {\n@@ -243,10 +252,14 @@ public boolean startInstance(MapleExpedition exped) {\n     //Expedition method: starts an expedition\n     public boolean startInstance(int lobbyId, MapleExpedition exped) {\n         try {\n-            if(lobbyId > -1) {\n+            if(lobbyId == -1) {\n                 lobbyId = availableLobbyInstance();\n                 if(lobbyId == -1) return false;\n             }\n+            else {\n+                if(getLockLobby(lobbyId)) return false;\n+                startLobbyInstance(lobbyId);\n+            }\n             \n             EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", (Object) null));\n             if(eim == null) {\n@@ -271,10 +284,14 @@ public boolean startInstance(MapleCharacter chr) {\n     \n     public boolean startInstance(int lobbyId, MapleCharacter chr) {\n         try {\n-            if(lobbyId > -1) {\n+            if(lobbyId == -1) {\n                 lobbyId = availableLobbyInstance();\n                 if(lobbyId == -1) return false;\n             }\n+            else {\n+                if(getLockLobby(lobbyId)) return false;\n+                startLobbyInstance(lobbyId);\n+            }\n             \n             EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", (Object) null));\n             if(eim == null) {\n@@ -298,10 +315,14 @@ public boolean startInstance(MapleParty party, MapleMap map) {\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map) {\n         try {\n-            if(lobbyId > -1) {\n+            if(lobbyId == -1) {\n                 lobbyId = availableLobbyInstance();\n                 if(lobbyId == -1) return false;\n             }\n+            else {\n+                if(getLockLobby(lobbyId)) return false;\n+                startLobbyInstance(lobbyId);\n+            }\n             \n             EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", (Object) null));\n             if(eim == null) {\n@@ -326,10 +347,14 @@ public boolean startInstance(MapleParty party, MapleMap map, int difficulty) {\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, int difficulty) {\n         try {\n-            if(lobbyId > -1) {\n+            if(lobbyId == -1) {\n                 lobbyId = availableLobbyInstance();\n                 if(lobbyId == -1) return false;\n             }\n+            else {\n+                if(getLockLobby(lobbyId)) return false;\n+                startLobbyInstance(lobbyId);\n+            }\n             \n             EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", difficulty, (lobbyId > -1) ? lobbyId : party.getLeaderId()));\n             if(eim == null) {\n@@ -354,10 +379,14 @@ public boolean startInstance(EventInstanceManager eim, String leader) {\n     \n     public boolean startInstance(int lobbyId, EventInstanceManager eim, String leader) {\n         try {\n-            if(lobbyId > -1) {\n+            if(lobbyId == -1) {\n                 lobbyId = availableLobbyInstance();\n                 if(lobbyId == -1) return false;\n             }\n+            else {\n+                if(getLockLobby(lobbyId)) return false;\n+                startLobbyInstance(lobbyId);\n+            }\n             \n             if(eim == null) {\n                 if(lobbyId > -1) setLockLobby(lobbyId, false);"}, {"sha": "871ded8a5eb1591d00905cfdc67ac6520c345206", "filename": "wz/Character.wz/Accessory/01032030.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Character.wz/Accessory/01032030.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Character.wz/Accessory/01032030.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Accessory/01032030.img.xml?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -16,7 +16,7 @@\n     <int name=\"reqINT\" value=\"0\"/>\n     <int name=\"reqLUK\" value=\"0\"/>\n     <int name=\"incMDD\" value=\"80\"/>\n-    <int name=\"incMHP\" value=\"30\"/>\n+    <int name=\"incPAD\" value=\"1\"/>\n     <int name=\"price\" value=\"200000\"/>\n     <int name=\"cash\" value=\"0\"/>\n     <int name=\"tuc\" value=\"5\"/>"}, {"sha": "bc3a344476e64350ab4e590aaf27768b73c9491e", "filename": "wz/Character.wz/Accessory/01032070.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Character.wz/Accessory/01032070.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Character.wz/Accessory/01032070.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Character.wz/Accessory/01032070.img.xml?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105", "patch": "@@ -16,10 +16,10 @@\n     <int name=\"reqINT\" value=\"0\"/>\n     <int name=\"reqLUK\" value=\"0\"/>\n     <int name=\"incMDD\" value=\"80\"/>\n-    <int name=\"incACC\" value=\"1\"/>\n     <int name=\"price\" value=\"200000\"/>\n     <int name=\"cash\" value=\"0\"/>\n     <int name=\"tuc\" value=\"5\"/>\n+    <int name=\"incMAD\" value=\"1\"/>\n   </imgdir>\n   <imgdir name=\"default\">\n     <canvas name=\"default\" width=\"35\" height=\"11\">"}, {"sha": "36cf8656409cf53044c5cc4115b1c3e838bf65e1", "filename": "wz/Map.wz/Map/Map9/922010800.img.xml", "status": "modified", "additions": 5602, "deletions": 5607, "changes": 11209, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Map.wz/Map/Map9/922010800.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a56312ddd30f54ebc73ceda528bc9267bf8b4105/wz/Map.wz/Map/Map9/922010800.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map9/922010800.img.xml?ref=a56312ddd30f54ebc73ceda528bc9267bf8b4105"}]}]},
