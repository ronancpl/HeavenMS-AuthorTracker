{"fetchDate": "2019-12-19", "content": [{"sha": "94425ba616dacf61b156044ac3993e2d06584c8f", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6OTQ0MjViYTYxNmRhY2Y2MWIxNTYwNDRhYzM5OTNlMmQwNjU4NGM4Zg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-07-01T01:48:02Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-07-01T01:48:02Z"}, "message": "EXP system & Mob buffs/diseases optimization\n\nSolved a problem within EXP distribution system that would hand out less overall EXP than the expected when the amount to be earned is low.\nOptimized mob buffs and diseases, now using a dedicated thread to process all status expirations on a batch.\nRefactored MonitoredLockTypes names to something more easily identificable.\nAdded a delay on mob effect applications, to be registered in after the cast animation time.\nFixed Flame Thrower acting passively when a attacking skill is used by the player.", "tree": {"sha": "629b37f28dd58429e2c542496256dae012f11318", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/629b37f28dd58429e2c542496256dae012f11318"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/94425ba616dacf61b156044ac3993e2d06584c8f", "comment_count": 2, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/94425ba616dacf61b156044ac3993e2d06584c8f", "html_url": "https://github.com/ronancpl/HeavenMS/commit/94425ba616dacf61b156044ac3993e2d06584c8f", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/94425ba616dacf61b156044ac3993e2d06584c8f/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dac5c436350664c69172c22c70642b8cdbdca7c7", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/dac5c436350664c69172c22c70642b8cdbdca7c7", "html_url": "https://github.com/ronancpl/HeavenMS/commit/dac5c436350664c69172c22c70642b8cdbdca7c7"}], "stats": {"total": 1196, "additions": 757, "deletions": 439}, "files": [{"sha": "c635df16b333fc2d77025c5ac37c5e9318e792a8", "filename": ".gitignore", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -1,4 +1,4 @@\n-/logs/**\n+\ufeff/logs/**\n .idea/\n \n # build files"}, {"sha": "d28e49a516b97f2c371b08033454561b13b6c6a0", "filename": "docs/issues.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/docs/issues.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/docs/issues.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/issues.txt?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -13,6 +13,7 @@ Known issues:\n - If there are multiple bosses that shows HPBar on the map, if a player hits more than one the HPBar may start flickering on the screen.\n - Sometimes battleship may behave oddly with the enhanced buff system, making the character d/c in certain scenarios.\n - Dragon Roar doesn't show the stun effect to players.\n+- Some monster status such as freeze and weapon/magic reflect doesn't behave properly in certain scenarios. Freeze seems to not work on mobs with low OID or are starters from server boot time.\n ---------------------------\n \n ---------------------------"}, {"sha": "285c1bb37184aa588dc65ab66641dc92605ed13e", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -1083,4 +1083,14 @@ Adicionado efeito de dispel de weapondef e magicdef up em mobs ao atacar com Sha\n Corrigido Shadow Meso consumindo projetil (deveria usar meso somente).\n Adicionado recompensa de buff ao completar o HolidayPQ.\n Adicionado drops de itens que d\u00e3o buffs caracter\u00edsticos nos reatores da Zakum Prequest.\n-Scroll shop custom mudou para a NPC Asia em Neo City (anteriormente estava no Spindle).\n\\ No newline at end of file\n+Scroll shop custom mudou para a NPC Asia em Neo City (anteriormente estava no Spindle).\n+\n+27 Junho 2018,\n+Resolvido um problema no sistema de ganho de EXP que daria ao jogador um valor abaixo do que seria o normal nos casos onde o EXP ganho \u00e9 baixo.\n+Otimizado mob buffs e diseases agora utilizando thread dedicada para lidar com a dura\u00e7\u00e3o, anteriormente eram criadas novas schedules pra cada inst\u00e2ncia.\n+Refatorado MonitoredLockTypes para agora dar um label espec\u00edfico a cada lock do sistema.\n+\n+29 - 30 Junho 2018,\n+Corrigido quest Milk Jug com NPCs trocados.\n+Adicionado um delay na aplica\u00e7\u00e3o de efeitos dos skills de mobs, buffs e demais efeitos agora s\u00e3o registrados ap\u00f3s o tempo da anima\u00e7\u00e3o.\n+Corrigido Flame Thrower atuando passivamente quando o jogador usa uma skill de ataque.\n\\ No newline at end of file"}, {"sha": "903b1ba09bd53fce648068bb626ac89505a64139", "filename": "handbook/Etc.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/handbook/Etc.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/handbook/Etc.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/handbook/Etc.txt?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -241,7 +241,7 @@\n 4000172 - Three-Tailed Foxtail - A soft foxtail that Three-Tailed Fox removed from itself.\n 4000173 - Broom - A small broom made from bushes that Blins dropped.\n 4000174 - Money Envelope - You can sell this envelope for 10,000 meso in the store.\n-4000175 - Minature Pianus - A miniature version of Pianus\n+4000175 - Miniature Pianus - A miniature version of Pianus\n 4000176 - Poisonous Mushroom - A poisonous mushroom that lives on the humongous Zombie Mushroom.\n 4000177 - Mixed Block - A block from Mix Golem that consists of its chest area.\n 4000178 - Iron Boar Armor - A small piece of the solid armor from Iron Boar."}, {"sha": "a132cfce1773f03257b76c6a202dea435ae52e16", "filename": "scripts/npc/1012100.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1012100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1012100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012100.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -49,7 +49,7 @@ function start() {\n             if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType))\n                 cm.sendNext(\"So you decided to become a #rBowman#k?\");\n             else {\n-                cm.sendOk(\"Train a bit more and I can show you the way of the #rBowman#k.\");\n+                cm.sendOk(\"Train a bit more until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rBowman#k.\");\n                 cm.dispose();\n             }\n         } else if (cm.getLevel() >= 30 && cm.getJobId() == 300) {"}, {"sha": "a112e93b0c5306f6c9aaa55b10ed885385a83291", "filename": "scripts/npc/1022000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1022000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1022000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1022000.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -50,7 +50,7 @@ function start() {\n             if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType))\n                 cm.sendNext(\"Do you want to become a Warrior? You need to meet some criteria in order to do so.#b You should be at least in level 10, with at least 35 in STR#k. Let's see...\");\n             else {\n-                cm.sendOk(\"Train a bit more and I can show you the way of the #rWarrior#k.\");\n+                cm.sendOk(\"Train a bit more until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rWarrior#k.\");\n                 cm.dispose();\n             }\n         } else if (cm.getLevel() >= 30 && cm.getJobId() == 100) {"}, {"sha": "993eb304fca5a53f6b2e1c218fde9f07907da3b3", "filename": "scripts/npc/1032001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1032001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1032001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1032001.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -50,7 +50,7 @@ function start() {\n             if (cm.getLevel() >= 8 && cm.canGetFirstJob(jobType))\n                 cm.sendNext(\"Want to be a magician? There are some standards to meet. because we can't just accept EVERYONE in... #bYour level should be at least 8#k, with getting INT as your top priority. Let's see.\");\n             else {\n-                cm.sendOk(\"Train a bit more and I can show you the way of the #rMagician#k.\");\n+                cm.sendOk(\"Train a bit more until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rMagician#k.\");\n                 cm.dispose();\n             }\n         } else if (cm.getLevel() >= 30 && cm.getJobId() == 200) {"}, {"sha": "3f76c7fb14849f3efaf9ba37b3ad9f24aa9b8207", "filename": "scripts/npc/1052001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1052001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1052001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052001.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -49,7 +49,7 @@ function start() {\n             if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType))\n                 cm.sendNext(\"Want to be a thief? There are some standards to meet. because we can't just accept EVERYONE in... #bYour level should be at least 10, with your DEX over 25#k. Let's see.\");\n             else {\n-                cm.sendOk(\"Train a bit more and I can show you the way of the #rThief#k.\");\n+                cm.sendOk(\"Train a bit more until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rThief#k.\");\n                 cm.dispose();\n             }\n         } else if (cm.getLevel() >= 30 && cm.getJobId() == 400) {"}, {"sha": "575c7aaffb60b7e433890ed8369e8e50f9a20af8", "filename": "scripts/npc/1090000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1090000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1090000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1090000.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -49,7 +49,7 @@ function start() {\n             if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType))\n                 cm.sendNext(\"Want to be a pirate? There are some standards to meet. because we can't just accept EVERYONE in... #bYour level should be at least 10#k. Let's see.\");\n             else {\n-                cm.sendOk(\"Train a bit more and I can show you the way of the #rPirate#k.\");\n+                cm.sendOk(\"Train a bit more until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rPirate#k.\");\n                 cm.dispose();\n             }\n         } else if (cm.getLevel() >= 30 && cm.getJobId() == 500) {"}, {"sha": "2dac576325ad4d2ab64b3ad5a2b6d3f5776c066c", "filename": "scripts/npc/1092090.js", "status": "modified", "additions": 26, "deletions": 26, "changes": 52, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092090.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092090.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092090.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -19,34 +19,34 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-status = -1;\n \n function start() {\n-    if(cm.haveItem(4031847))\n-        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle remains empty...\");\n-    else if(cm.haveItem(4031848) || cm.haveItem(4031849) || cm.haveItem(4031850)){\n-        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle is now empty.\");\n-        if(cm.haveItem(4031848))\n-            cm.gainItem(4031848,-1);\n-        else if(cm.haveItem(4031849))\n-            cm.gainItem(4031849, -1);\n-        else\n-            cm.gainItem(4031850, -1);\n-        cm.gainItem(4031847, 1);\n+    if(cm.getQuestProgress(2180, 0) == 1) {\n+        cm.sendNext(\"You have taken milk from this cow recently, check another cow.\");\n         cm.dispose();\n+        return;\n     }\n-}\n-\n-function action(mode, type, selection){\n-    if(mode == -1)\n-        cm.dispose();\n-    else if(mode == 0){\n-        status--;\n-        start();\n-    }else\n-        status++;\n-    if(status == 0)\n-        cm.sendPrev(\"The hungry calf isn't interested in the empty bottle.\");\n-    else if(status == 1)\n-        cm.dispose();\n+    \n+    if (cm.canHold(4031848) && cm.haveItem(4031847)) {\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 1/3 full of milk.\");\n+        cm.gainItem(4031847, -1);\n+        cm.gainItem(4031848, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 1);\n+    } else if (cm.canHold(4031849, 1) && cm.haveItem(4031848)) {\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n+        cm.gainItem(4031848, -1);\n+        cm.gainItem(4031849, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 1);\n+    } else if (cm.canHold(4031850) && cm.haveItem(4031849)) {\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n+        cm.gainItem(4031849, -1);\n+        cm.gainItem(4031850, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 1);\n+    } else {\n+        cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n+    }\n+    cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "5d5db97d543f9d6058b2b3dc54f003e1f5196c00", "filename": "scripts/npc/1092091.js", "status": "modified", "additions": 26, "deletions": 27, "changes": 53, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092091.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092091.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092091.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -20,34 +20,33 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-status = -1;\n-\n function start() {\n-    if (cm.haveItem(4031847))\n-        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle remains empty...\");\n-    else if (cm.haveItem(4031848) || cm.haveItem(4031849) || cm.haveItem(4031850)) {\n-        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle is now empty.\");\n-        if (cm.haveItem(4031848))\n-            cm.gainItem(4031848,-1);\n-        else if (cm.haveItem(4031849))\n-            cm.gainItem(4031849, -1);\n-        else\n-            cm.gainItem(4031850, -1);\n-        cm.gainItem(4031847, 1);\n+    if(cm.getQuestProgress(2180, 0) == 2) {\n+        cm.sendNext(\"You have taken milk from this cow recently, check another cow.\");\n         cm.dispose();\n+        return;\n     }\n-}\n-\n-function action(mode, type, selection){\n-    if (mode == -1)\n-        cm.dispose();\n-    else if (mode == 0) {\n-        status--;\n-        start();\n-    } else\n-        status++;\n-    if (status == 0)\n-        cm.sendPrev(\"The hungry calf isn't interested in the empty bottle.\");\n-    else if (status == 1)\n-        cm.dispose();\n+    \n+    if (cm.canHold(4031848) && cm.haveItem(4031847)){\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 1/3 full of milk.\");\n+        cm.gainItem(4031847, -1);\n+        cm.gainItem(4031848, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 2);\n+    } else if(cm.canHold(4031849) && cm.haveItem(4031848)){\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n+        cm.gainItem(4031848, -1);\n+        cm.gainItem(4031849, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 2);\n+    } else if(cm.canHold(4031850) && cm.haveItem(4031849)){\n+        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n+        cm.gainItem(4031849, -1);\n+        cm.gainItem(4031850, 1);\n+        \n+        cm.setQuestProgress(2180, 0, 2);\n+    } else {\n+        cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n+    }\n+    cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "ed8920180011952ad64701a52a10be890f61bb3d", "filename": "scripts/npc/1092094.js", "status": "modified", "additions": 28, "deletions": 15, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092094.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092094.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092094.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -19,21 +19,34 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n+status = -1;\n \n function start() {\n-    if (cm.canHold(4031848) && cm.haveItem(4031847)) {\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 1/3 full of milk.\");\n-        cm.gainItem(4031847, -1);\n-        cm.gainItem(4031848, 1);\n-    } else if (cm.canHold(4031849, 1) && cm.haveItem(4031848)) {\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n-        cm.gainItem(4031848, -1);\n-        cm.gainItem(4031849, 1);\n-    } else if (cm.canHold(4031850) && cm.haveItem(4031849)) {\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n-        cm.gainItem(4031849, -1);\n-        cm.gainItem(4031850, 1);\n-    } else\n-        cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n-    cm.dispose();\n+    if(cm.haveItem(4031847))\n+        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle remains empty...\");\n+    else if(cm.haveItem(4031848) || cm.haveItem(4031849) || cm.haveItem(4031850)){\n+        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle is now empty.\");\n+        if(cm.haveItem(4031848))\n+            cm.gainItem(4031848,-1);\n+        else if(cm.haveItem(4031849))\n+            cm.gainItem(4031849, -1);\n+        else\n+            cm.gainItem(4031850, -1);\n+        cm.gainItem(4031847, 1);\n+        cm.dispose();\n+    }\n+}\n+\n+function action(mode, type, selection){\n+    if(mode == -1)\n+        cm.dispose();\n+    else if(mode == 0){\n+        status--;\n+        start();\n+    }else\n+        status++;\n+    if(status == 0)\n+        cm.sendPrev(\"The hungry calf isn't interested in the empty bottle.\");\n+    else if(status == 1)\n+        cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "f6e83bfc2b2fffefd476a9fb7a02853fd20a58bd", "filename": "scripts/npc/1092095.js", "status": "modified", "additions": 28, "deletions": 14, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092095.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/1092095.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092095.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -20,20 +20,34 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n+status = -1;\n+\n function start() {\n-    if (cm.canHold(4031848) && cm.haveItem(4031847)){\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 1/3 full of milk.\");\n-        cm.gainItem(4031847, -1);\n-        cm.gainItem(4031848, 1);\n-    } else if(cm.canHold(4031849) && cm.haveItem(4031848)){\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n-        cm.gainItem(4031848, -1);\n-        cm.gainItem(4031849, 1);\n-    } else if(cm.canHold(4031850) && cm.haveItem(4031849)){\n-        cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n-        cm.gainItem(4031849, -1);\n-        cm.gainItem(4031850, 1);\n+    if (cm.haveItem(4031847))\n+        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle remains empty...\");\n+    else if (cm.haveItem(4031848) || cm.haveItem(4031849) || cm.haveItem(4031850)) {\n+        cm.sendNext(\"The hungry calf is drinking all the milk! The bottle is now empty.\");\n+        if (cm.haveItem(4031848))\n+            cm.gainItem(4031848,-1);\n+        else if (cm.haveItem(4031849))\n+            cm.gainItem(4031849, -1);\n+        else\n+            cm.gainItem(4031850, -1);\n+        cm.gainItem(4031847, 1);\n+        cm.dispose();\n+    }\n+}\n+\n+function action(mode, type, selection){\n+    if (mode == -1)\n+        cm.dispose();\n+    else if (mode == 0) {\n+        status--;\n+        start();\n     } else\n-        cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n-    cm.dispose();\n+        status++;\n+    if (status == 0)\n+        cm.sendPrev(\"The hungry calf isn't interested in the empty bottle.\");\n+    else if (status == 1)\n+        cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "b35a45ff68d5be9b3dedf0e55f1aa7f4b059f0fc", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -144,6 +144,7 @@ function writeFeatureTab_Serverpotentials() {\n         addFeature(\"Enhanced auto-pot system: smart pet potion handle.\");\n         addFeature(\"Enhanced buff system: best buffs effects takes place.\");\n         addFeature(\"Enhanced AP auto-assigner: focus on eqp demands.\");\n+        addFeature(\"Consistent experience gain system.\");\n         addFeature(\"NPC crafters won't take items freely anymore.\");\n         addFeature(\"Duey: pkg rcvd popup and many delivery mechanics.\");\n         addFeature(\"Pet pickup gives preference to player attacks.\");\n@@ -169,6 +170,7 @@ function writeFeatureTab_AdminGMcommands() {\n \n function writeFeatureTab_CustomNPCs() {\n         addFeature(\"Spiegelmann: automatized rock-refiner.\");\n+        addFeature(\"Asia: scroll & rarities shop NPC.\");\n         addFeature(\"Abdula: lists droppers of needed skill/mastery books.\");\n         addFeature(\"Agent E: accessory crafter.\");\n         addFeature(\"Donation Box: automatized item-buyer.\");\n@@ -197,6 +199,7 @@ function writeFeatureTab_Project() {\n         addFeature(\"Reviewed many Java aspects that needed attention.\");\n         addFeature(\"Reviewed SQL data, eliminating duplicated entries.\");\n         addFeature(\"Protected many flaws with login management system.\");\n+        addFeature(\"Developed many survey tools for content management.\");\n         addFeature(\"ThreadTracker: runtime tool for deadlock detection.\");\n         addFeature(\"Heavily reviewed future task management, spawning much less threads and relieving task overload on the TimerManager.\");\n }"}, {"sha": "f6d2107782b64cb16a43d90fe35fb6ab445108bd", "filename": "scripts/quest/20101.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20101.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,8 +22,8 @@ function end(mode, type, selection) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Dawn Warrior?\");\n     } else if (status == 1) {\n         if(!qm.canGetFirstJob(jobType)) {\n-            cm.sendOk(\"Train a bit more and I can show you the way of the #rDawn Warrior#k.\");\n-            cm.dispose();\n+            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rDawn Warrior#k.\");\n+            qm.dispose();\n             return;\n         }\n         "}, {"sha": "f4bd37ddcb209ccea97a8e7bc8b6714ec6021b78", "filename": "scripts/quest/20102.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20102.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,8 +22,8 @@ function end(mode, type, selection) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Blaze Wizard?\");\n     } else if (status == 1) {\n         if(!qm.canGetFirstJob(jobType)) {\n-            cm.sendOk(\"Train a bit more and I can show you the way of the #rBlaze Wizard#k.\");\n-            cm.dispose();\n+            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rBlaze Wizard#k.\");\n+            qm.dispose();\n             return;\n         }\n         "}, {"sha": "03d54ab4e8d94663bf1a4978e68f39478ced14cd", "filename": "scripts/quest/20103.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20103.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20103.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20103.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,8 +22,8 @@ function end(mode, type, selection) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Wind Archer?\");\n     } else if (status == 1) {\n         if(!qm.canGetFirstJob(jobType)) {\n-            cm.sendOk(\"Train a bit more and I can show you the way of the #rWind Archer#k.\");\n-            cm.dispose();\n+            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rWind Archer#k.\");\n+            qm.dispose();\n             return;\n         }\n         "}, {"sha": "a0fc3311a04a294f38fb0fd67cbed585ee8247d2", "filename": "scripts/quest/20104.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20104.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20104.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20104.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,8 +22,8 @@ function end(mode, type, selection) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Night Walker?\");\n     } else if (status == 1) {\n         if(!qm.canGetFirstJob(jobType)) {\n-            cm.sendOk(\"Train a bit more and I can show you the way of the #rNight Walker#k.\");\n-            cm.dispose();\n+            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rNight Walker#k.\");\n+            qm.dispose();\n             return;\n         }\n         "}, {"sha": "5de72b98f42acf2320912aebc682488b7a21cedb", "filename": "scripts/quest/20105.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20105.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/20105.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20105.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,8 +22,8 @@ function end(mode, type, selection) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Thunder Breaker?\");\n     } else if (status == 1) {\n         if(!qm.canGetFirstJob(jobType)) {\n-            cm.sendOk(\"Train a bit more and I can show you the way of the #rThunder Breaker#k.\");\n-            cm.dispose();\n+            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rThunder Breaker#k.\");\n+            qm.dispose();\n             return;\n         }\n         "}, {"sha": "c26f42341b5c34d626b21838f01e070667078687", "filename": "scripts/quest/4647.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/4647.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/quest/4647.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/4647.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -41,7 +41,7 @@ function end(mode, type, selection) {\n \t\tif (status == 0) {\n \t\t\tif(qm.haveItem(5460000)) {\n \t\t\t\tqm.sendOk(\"You got the Pet Snack! Thanks! You can use these to feed multiple pets at once!\");\n-\t\t\t\tqm.teachSkill(0008, 1, 1, -1);\n+\t\t\t\tqm.teachSkill(8, 1, 1, -1);\n \t\t\t\tqm.gainItem(5460000, -1, false);\n \t\t\t\tqm.completeQuest();\n \t\t\t\tqm.dispose();"}, {"sha": "6be4803511e2afa4e2745a52557b1db8d77257cf", "filename": "scripts/reactor/8001000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/reactor/8001000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/scripts/reactor/8001000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/8001000.js?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -20,5 +20,5 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n function act(){\n-        rm.spawnMonster(9400112);\n+        rm.spawnMonster(9400112, 1, 420, 160);\n }\n\\ No newline at end of file"}, {"sha": "6439a3e49564646f2f5000e271eece29a95837d6", "filename": "sql/db_database.sql", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -3794,7 +3794,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (3575, 4250001, 1442005, 1, 1, 0, 700),\n (3576, 4250001, 4000438, 1, 1, 0, 600000),\n (3577, 4250001, 4130014, 1, 1, 0, 6000),\n-(3578, 5090000, 4000413, 1, 1, 0, 600000),\n+(3578, 5090000, 4000413, 1, 1, 0, 200000),\n (3579, 5090001, 4000412, 1, 1, 0, 600000),\n (3580, 5100000, 4000048, 1, 1, 0, 600000),\n (3581, 5100000, 4003005, 1, 1, 0, 200000),\n@@ -7995,7 +7995,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (7772, 8180000, 4004001, 1, 1, 0, 100000),\n (7773, 8180000, 4004002, 1, 1, 0, 100000),\n (7774, 8180000, 4004003, 1, 1, 0, 100000),\n-(7775, 8180000, 4000235, 1, 1, 0, 600000),\n+(7775, 8180000, 4000235, 1, 1, 0, 200000),\n (7776, 8180000, 4000244, 1, 1, 0, 20000),\n (7777, 8180000, 4000245, 1, 1, 0, 20000),\n (7778, 8180000, 2290003, 1, 1, 0, 5000),\n@@ -8052,7 +8052,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (7829, 8180001, 4004001, 1, 1, 0, 100000),\n (7830, 8180001, 4004002, 1, 1, 0, 100000),\n (7831, 8180001, 4004003, 1, 1, 0, 100000),\n-(7832, 8180001, 4000243, 1, 1, 0, 600000),\n+(7832, 8180001, 4000243, 1, 1, 0, 200000),\n (7833, 8180001, 4000244, 1, 1, 0, 20000),\n (7834, 8180001, 4000245, 1, 1, 0, 20000),\n (7835, 8180001, 2290018, 1, 1, 0, 5000),\n@@ -10413,10 +10413,10 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (10190, 9400546, 4031681, 1, 1, 4915, 1000000),\n (10191, 9600005, 4000191, 1, 1, 0, 1000000),\n (10192, 9600006, 4000192, 1, 1, 0, 1000000),\n-(10193, 8500002, 4031196, 1, 1, 0, 1000000),\n-(10194, 8500002, 4031196, 1, 1, 0, 1000000),\n-(10195, 8500002, 4031196, 1, 1, 0, 187500),\n-(10196, 8500002, 4031196, 1, 1, 0, 125000),\n+(10193, 8500002, 4031196, 1, 1, 0, 80000),\n+(10194, 8500002, 4031196, 1, 1, 0, 80000),\n+(10195, 8500002, 4031196, 1, 1, 0, 80000),\n+(10196, 8500002, 4031196, 1, 1, 0, 80000),\n (10197, 3000006, 4031209, 1, 1, 3072, 500000),\n (10198, 2230109, 4031209, 1, 1, 3072, 500000),\n (10199, 2230200, 4031209, 1, 1, 3072, 500000),"}, {"sha": "a7cb0be4db2516cd00ae77e97fe4a1512a4e3472", "filename": "sql/db_drops.sql", "status": "modified", "additions": 23, "deletions": 23, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -15794,15 +15794,15 @@ USE `heavenms`;\n (6400006, 4030012, 1, 1, 0, 125000), \n (6400009, 4030012, 1, 1, 0, 125000), \n (9303013, 4030012, 1, 1, 0, 125000), \n-(8150000, 4031906, 1, 1, 0, 7000), \n-(9300210, 4031906, 1, 1, 0, 7000), \n-(9500140, 4031906, 1, 1, 0, 7000), \n-(9500171, 4031906, 1, 1, 0, 7000), \n-(9500328, 4031906, 1, 1, 0, 7000), \n-(9500358, 4031906, 1, 1, 0, 7000), \n-(6400006, 4031906, 1, 1, 0, 7000), \n-(6400009, 4031906, 1, 1, 0, 7000), \n-(9303013, 4031906, 1, 1, 0, 7000), \n+(8150000, 4031906, 1, 1, 0, 400000), \n+(9300210, 4031906, 1, 1, 0, 400000), \n+(9500140, 4031906, 1, 1, 0, 400000), \n+(9500171, 4031906, 1, 1, 0, 400000), \n+(9500328, 4031906, 1, 1, 0, 400000), \n+(9500358, 4031906, 1, 1, 0, 400000), \n+(6400006, 4031906, 1, 1, 0, 400000), \n+(6400009, 4031906, 1, 1, 0, 400000), \n+(9303013, 4031906, 1, 1, 0, 400000), \n (8150000, 2043002, 1, 4, 0, 10000), \n (9300210, 2043002, 1, 4, 0, 10000), \n (9500140, 2043002, 1, 4, 0, 10000), \n@@ -17473,18 +17473,18 @@ USE `heavenms`;\n (8200010, 1072225, 1, 1, 0, 700),\n (8200010, 1082158, 1, 1, 0, 700), \n (8200010, 1002646, 1, 1, 0, 700), \n-(8500002, 4031196, 1, 1, 0, 7000), \n-(9300214, 4031196, 1, 1, 0, 7000), \n-(9500180, 4031196, 1, 1, 0, 7000), \n-(9500181, 4031196, 1, 1, 0, 7000),\n-(9500331, 4031196, 1, 1, 0, 7000), \n-(9500362, 4031196, 1, 1, 0, 7000), \n-(8500002, 4031901, 1, 1, 0, 7000), \n-(9300214, 4031901, 1, 1, 0, 7000), \n-(9500180, 4031901, 1, 1, 0, 7000), \n-(9500181, 4031901, 1, 1, 0, 7000), \n-(9500331, 4031901, 1, 1, 0, 7000), \n-(9500362, 4031901, 1, 1, 0, 7000), \n+(8500002, 4031196, 1, 1, 0, 80000), \n+(9300214, 4031196, 1, 1, 0, 80000), \n+(9500180, 4031196, 1, 1, 0, 80000), \n+(9500181, 4031196, 1, 1, 0, 80000),\n+(9500331, 4031196, 1, 1, 0, 80000), \n+(9500362, 4031196, 1, 1, 0, 80000), \n+(8500002, 4031901, 1, 1, 0, 400000), \n+(9300214, 4031901, 1, 1, 0, 400000), \n+(9500180, 4031901, 1, 1, 0, 400000), \n+(9500181, 4031901, 1, 1, 0, 400000), \n+(9500331, 4031901, 1, 1, 0, 400000), \n+(9500362, 4031901, 1, 1, 0, 400000), \n (8500002, 4001084, 1, 1, 0, 7000),\n (9300214, 4001084, 1, 1, 0, 7000), \n (9500180, 4001084, 1, 1, 0, 7000), \n@@ -20775,7 +20775,7 @@ USE `heavenms`;\n   UPDATE drop_data SET questid=28248 WHERE itemid=4001358;\n   UPDATE drop_data SET questid=28248 WHERE itemid=4001359;\n   UPDATE drop_data SET questid=28175 WHERE itemid=4001342;\n-  UPDATE drop_data SET questid=7777 WHERE itemid=4031906;\t#id 7777 for ALL \"quest items\" with no v83 quest.\n+  UPDATE drop_data SET questid=7777 WHERE itemid=4031905;\t#id 7777 for ALL \"quest items\" with no v83 quest.\n   UPDATE drop_data SET chance=0 WHERE itemid=2050099;\n   UPDATE drop_data SET questid=6191 WHERE itemid=4031477;\n   UPDATE drop_data SET questid=6190 WHERE itemid=4001111;\n@@ -21364,7 +21364,7 @@ USE `heavenms`;\n (9300270, 2022431, 1, 1, 0, 200000),\n (9300270, 2022432, 1, 1, 0, 200000),\n (9300270, 2022433, 1, 1, 0, 200000),\n-(6090002, 4000414, 1, 1, 0, 400000),\n+(6090002, 4000414, 1, 1, 0, 200000),\n (9300147, 4001132, 1, 1, 0, 400000),\n (9300148, 4001133, 1, 1, 0, 100000),\n (4300012, 4000537, 1, 1, 0, 200000),"}, {"sha": "60ba02f2b1a19d83e245db3f036a986e5fd8d042", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -273,10 +273,10 @@\n     private ScheduledFuture<?> extraRecoveryTask = null;\n     private ScheduledFuture<?> chairRecoveryTask = null;\n     private ScheduledFuture<?> pendantOfSpirit = null; //1122017\n-    private Lock chrLock = new MonitoredReentrantLock(MonitoredLockType.CHR, true);\n-    private Lock effLock = new MonitoredReentrantLock(MonitoredLockType.EFF, true);\n-    private Lock petLock = new MonitoredReentrantLock(MonitoredLockType.PET, true); // for quest tasks as well\n-    private Lock prtLock = new MonitoredReentrantLock(MonitoredLockType.PRT);\n+    private Lock chrLock = new MonitoredReentrantLock(MonitoredLockType.CHARACTER_CHR, true);\n+    private Lock effLock = new MonitoredReentrantLock(MonitoredLockType.CHARACTER_EFF, true);\n+    private Lock petLock = new MonitoredReentrantLock(MonitoredLockType.CHARACTER_PET, true); // for quest tasks as well\n+    private Lock prtLock = new MonitoredReentrantLock(MonitoredLockType.CHARACTER_PRT);\n     private Map<Integer, Set<Integer>> excluded = new LinkedHashMap<>();\n     private Set<Integer> excludedItems = new LinkedHashSet<>();\n     private static String[] ariantroomleader = new String[3];"}, {"sha": "9b51e6e694e2d8fc1006b66000081814e2c74666", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -107,8 +107,8 @@\n \tprivate byte gender = -1;\n \tprivate boolean disconnecting = false;\n \tprivate final Lock lock = new MonitoredReentrantLock(MonitoredLockType.CLIENT, true);\n-        private final Lock encoderLock = new MonitoredReentrantLock(MonitoredLockType.CLIENT, true);\n-        private static final Lock loginLock = new MonitoredReentrantLock(MonitoredLockType.CLIENT, true);\n+        private final Lock encoderLock = new MonitoredReentrantLock(MonitoredLockType.CLIENT_ENCODER, true);\n+        private static final Lock loginLock = new MonitoredReentrantLock(MonitoredLockType.CLIENT_LOGIN, true);\n \tprivate int votePoints;\n \tprivate int voteTime = -1;\n \tprivate long lastNpcClick;"}, {"sha": "56deeef26b1cf9f94041c10b779ed0fd376dfa7e", "filename": "src/client/status/MonsterStatusEffect.java", "status": "modified", "additions": 1, "deletions": 29, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/status/MonsterStatusEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/client/status/MonsterStatusEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/status/MonsterStatusEffect.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -23,7 +23,6 @@\n \n import client.Skill;\n import java.util.Map;\n-import java.util.concurrent.ScheduledFuture;\n import server.life.MobSkill;\n import tools.ArrayMap;\n \n@@ -33,9 +32,7 @@\n     private Skill skill;\n     private MobSkill mobskill;\n     private boolean monsterSkill;\n-    private ScheduledFuture<?> cancelTask;\n-    private ScheduledFuture<?> damageSchedule;\n-\n+    \n     public MonsterStatusEffect(Map<MonsterStatus, Integer> stati, Skill skillId, MobSkill mobskill, boolean monsterSkill) {\n         this.stati = new ArrayMap<>(stati);\n         this.skill = skillId;\n@@ -59,35 +56,10 @@ public boolean isMonsterSkill() {\n         return monsterSkill;\n     }\n \n-    public final void cancelTask() {\n-\tif (cancelTask != null) {\n-\t    cancelTask.cancel(false);\n-\t}\n-        cancelTask = null;\n-    }\n-\n-    public ScheduledFuture<?> getCancelTask() {\n-        return cancelTask;\n-    }\n-\n-    public void setCancelTask(ScheduledFuture<?> cancelTask) {\n-        this.cancelTask = cancelTask;\n-    }\n-\n     public void removeActiveStatus(MonsterStatus stat) {\n         stati.remove(stat);\n     }\n \n-    public void setDamageSchedule(ScheduledFuture<?> damageSchedule) {\n-        this.damageSchedule = damageSchedule;\n-    }\n-\n-    public void cancelDamageSchedule() {\n-        if (damageSchedule != null) {\n-            damageSchedule.cancel(false);\n-        }\n-    }\n-\n     public MobSkill getMobSkill() {\n         return mobskill;\n     }"}, {"sha": "ad6859229246b180ea4752c9c87e977dad3755ed", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -123,6 +123,10 @@\n     public static final int ITEM_LIMIT_ON_MAP = 200;            //Max number of items allowed on a map.\n     public static final int MAP_VISITED_SIZE = 5;               //Max length for last mapids visited by a player. This is used to recover and update drops on these maps accordingly with player actions.\n     \n+    //Channel Mob Disease Monitor Configuration\n+    public static final int MOB_STATUS_MONITOR_PROC = 200;     //Frequency in milliseconds between each proc on the mob disease monitor schedule.\n+    public static final int MOB_STATUS_MONITOR_LIFE = 84;      //Idle proc count the mob disease monitor is allowed to be there before closing it due to inactivity.\n+    \n     //Some Gameplay Enhancing Configurations\n     //Scroll Configuration\n     public static final boolean USE_PERFECT_GM_SCROLL = true;   //Scrolls from GMs never uses up slots nor fails."}, {"sha": "c7c70e273cf49991ed815930a3f20c2b023743b2", "filename": "src/net/server/Server.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -96,8 +96,8 @@\n     private final Map<Integer, MapleGuild> guilds = new HashMap<>(100);\n     private final Map<MapleClient, Long> inLoginState = new HashMap<>(100);\n     private final Lock srvLock = new MonitoredReentrantLock(MonitoredLockType.SERVER);\n-    private final Lock lgnLock = new MonitoredReentrantLock(MonitoredLockType.SERVER);\n-    private final Lock disLock = new MonitoredReentrantLock(MonitoredLockType.SERVER);\n+    private final Lock lgnLock = new MonitoredReentrantLock(MonitoredLockType.SERVER_LOGIN);\n+    private final Lock disLock = new MonitoredReentrantLock(MonitoredLockType.SERVER_DISEASES);\n     private final PlayerBuffStorage buffStorage = new PlayerBuffStorage();\n     private final Map<Integer, MapleAlliance> alliances = new HashMap<>(100);\n     private final Map<Integer, NewYearCardRecord> newyears = new HashMap<>();"}, {"sha": "9d3ed7dd3cc497d367c3a6d751194903d8feae29", "filename": "src/net/server/audit/ThreadTracker.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/audit/ThreadTracker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/audit/ThreadTracker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/ThreadTracker.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -233,7 +233,7 @@ public void accessThreadTracker(boolean update, boolean lock, MonitoredLockType\n \n                     List<MonitoredLockType> list = threadTracker.get(tid);\n                     for(int i = list.size() - 1; i >= 0; i--) {\n-                        if(lockId.getValue() == list.get(i).getValue()) {\n+                        if(lockId.equals(list.get(i))) {\n                             list.remove(i);\n                             break;\n                         }"}, {"sha": "ad43f71bd6e58fdaa346101f6fe7b6da76ce5af8", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -21,6 +21,7 @@\n  */\n package net.server.channel;\n \n+import net.server.channel.worker.MobStatusScheduler;\n import java.io.File;\n import java.net.InetSocketAddress;\n import java.util.ArrayList;\n@@ -70,6 +71,7 @@\n import tools.MaplePacketCreator;\n import tools.Pair;\n import client.MapleCharacter;\n+import client.status.MonsterStatusEffect;\n import constants.ServerConstants;\n import server.maps.MapleMiniDungeonInfo;\n import tools.locks.MonitoredLockType;\n@@ -83,6 +85,7 @@\n     private String ip, serverMessage;\n     private MapleMapFactory mapFactory;\n     private EventScriptManager eventSM;\n+    private MobStatusScheduler mobStatusSchedulers[] = new MobStatusScheduler[4];\n     private Map<Integer, MapleHiredMerchant> hiredMerchants = new HashMap<>();\n     private final Map<Integer, Integer> storedVars = new HashMap<>();\n     private List<MapleExpedition> expeditions = new ArrayList<>();\n@@ -149,6 +152,10 @@ public Channel(final int world, final int channel, long startTime) {\n                 dojoTask[i] = null;\n             }\n             \n+            for(int i = 0; i < 4; i++) {\n+                mobStatusSchedulers[i] = new MobStatusScheduler();\n+            }\n+            \n             System.out.println(\"    Channel \" + getId() + \": Listening on port \" + port);\n         } catch (Exception e) {\n             e.printStackTrace();\n@@ -817,6 +824,34 @@ public void dropMessage(int type, String message) {\n         }\n     }\n     \n+    private static int getMobStatusSchedulerIndex(int mapid) {\n+        if(mapid >= 250000000) {\n+            if(mapid >= 900000000) {\n+                return 3;\n+            } else {\n+                return 2;\n+            }\n+        } else {\n+            if(mapid >= 200000000) {\n+                return 1;\n+            } else {\n+                return 0;\n+            }\n+        }\n+    }\n+    \n+    public void registerMobStatus(int mapid, MonsterStatusEffect mse, Runnable cancelAction, long duration) {\n+        registerMobStatus(mapid, mse, cancelAction, duration, null, -1);\n+    }\n+    \n+    public void registerMobStatus(int mapid, MonsterStatusEffect mse, Runnable cancelAction, long duration, Runnable overtimeAction, int overtimeDelay) {\n+        mobStatusSchedulers[getMobStatusSchedulerIndex(mapid)].registerMobStatus(mse, cancelAction, duration, overtimeAction, overtimeDelay);\n+    }\n+    \n+    public void interruptMobStatus(int mapid, MonsterStatusEffect mse) {\n+        mobStatusSchedulers[getMobStatusSchedulerIndex(mapid)].interruptMobStatus(mse);\n+    }\n+    \n     public void debugMarriageStatus() {\n         System.out.println(\" ----- WORLD DATA -----\");\n         Server.getInstance().getWorld(world).debugMarriageStatus();"}, {"sha": "aec0ca92f1b03ccbfd1ea4151b1cf7e8b063ccc9", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -326,6 +326,15 @@ public void run() {\n                     } else if (attack.skill == Outlaw.HOMING_BEACON || attack.skill == Corsair.BULLSEYE) {\n                         player.setMarkedMonster(monster.getObjectId());\n                         player.announce(MaplePacketCreator.giveBuff(1, attack.skill, Collections.singletonList(new Pair<>(MapleBuffStat.HOMING_BEACON, monster.getObjectId()))));\n+                    } else if (attack.skill == Outlaw.FLAME_THROWER) {\n+                        if (!monster.isBoss()) {\n+                            Skill type = SkillFactory.getSkill(Outlaw.FLAME_THROWER);\n+                            if (player.getSkillLevel(type) > 0) {\n+                                MapleStatEffect DoT = type.getEffect(player.getSkillLevel(type));\n+                                MonsterStatusEffect monsterStatusEffect = new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.POISON, 1), type, null, false);\n+                                monster.applyStatus(player, monsterStatusEffect, true, DoT.getDuration(), false);\n+                            }\n+                        }\n                     }\n                     \n                     if (job == 2111 || job == 2112) {\n@@ -406,15 +415,6 @@ public void run() {\n                                 }\n                             }\n                         }\n-                    } else if (job == 521 || job == 522) { // from what I can gather this is how it should work\n-                    \tif (!monster.isBoss()) {\n-                            Skill type = SkillFactory.getSkill(Outlaw.FLAME_THROWER);\n-                            if (player.getSkillLevel(type) > 0) {\n-                                MapleStatEffect DoT = type.getEffect(player.getSkillLevel(type));\n-                                MonsterStatusEffect monsterStatusEffect = new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.POISON, 1), type, null, false);\n-                                monster.applyStatus(player, monsterStatusEffect, true, DoT.getDuration(), false);\n-                            }\n-                        }\n                     } else if (job >= 311 && job <= 322) {                   \t\n                     \tif (!monster.isBoss()) {\n                             Skill mortalBlow;"}, {"sha": "6223b19f31a5b08f6a68421e328c7b9650b86718", "filename": "src/net/server/channel/handlers/MoveLifeHandler.java", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/handlers/MoveLifeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/handlers/MoveLifeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveLifeHandler.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -27,6 +27,7 @@\n import java.util.ArrayList;\n import java.util.List;\n import server.life.MapleMonster;\n+import server.life.MapleMonsterInformationProvider;\n //import server.life.MobAttackInfo;\n //import server.life.MobAttackInfoFactory;\n import server.life.MobSkill;\n@@ -94,20 +95,27 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\t} else if (toUse.getHP() < percHpLeft) {\n \t\t\t\t\ttoUse = null;\n \t\t\t\t} else if (monster.canUseSkill(toUse)) {\n-\t\t\t\t\ttoUse.applyEffect(c.getPlayer(), monster, true, banishPlayers);\n+                                        int animationTime = MapleMonsterInformationProvider.getInstance().getMobSkillAnimationTime(monster.getId(), Random);\n+                                        if(animationTime > 0) {\n+                                                toUse.applyDelayedEffect(c.getPlayer(), monster, true, banishPlayers, animationTime);\n+                                        } else {\n+                                                toUse.applyEffect(c.getPlayer(), monster, true, banishPlayers);\n+                                        }\n \t\t\t\t} else {\n                                         toUse = null;\n                                 }\n \t\t\t} else {\n+                                toUse = null; // paliative measure for suspicious mob movement\n+                            \n+                                /*\n                                 long curtime = System.currentTimeMillis();\n                                 if(curtime >= monster.getNextBasicSkillTime()) {  // dont use the special attack too often, chase the player f3\n-                                        //MobAttackInfo mobAttack = MobAttackInfoFactory.getMobAttackInfo(monster, attackId);\n-                                        //monster.setNextBasicSkillTime(curtime);\n-                                    \n-                                        toUse = null;   // paliative measure for suspicious mob movement\n+                                        MobAttackInfo mobAttack = MobAttackInfoFactory.getMobAttackInfo(monster, attackId);\n+                                        monster.setNextBasicSkillTime(curtime);\n                                 } else {\n                                         toUse = null;\n                                 }\n+                                */\n \t\t\t}\n \t\t}\n "}, {"sha": "083ade082734350333de3c1f921df62baddf120d", "filename": "src/net/server/channel/worker/MobStatusScheduler.java", "status": "added", "additions": 148, "deletions": 0, "changes": 148, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/worker/MobStatusScheduler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/channel/worker/MobStatusScheduler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/worker/MobStatusScheduler.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -0,0 +1,148 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.channel.worker;\n+\n+import client.status.MonsterStatusEffect;\n+import constants.ServerConstants;\n+import java.util.HashMap;\n+import java.util.ArrayList;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.locks.Lock;\n+import server.TimerManager;\n+import tools.Pair;\n+import tools.locks.MonitoredLockType;\n+import tools.locks.MonitoredReentrantLock;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class MobStatusScheduler {\n+    private int idleProcs = 0;\n+    private Map<MonsterStatusEffect, Pair<Runnable, Long>> registeredMobStatus = new HashMap<>();\n+    private Map<MonsterStatusEffect, MobStatusOvertimeEntry> registeredMobStatusOvertime = new HashMap<>();\n+    \n+    private class MobStatusOvertimeEntry {\n+        private int procCount;\n+        private int procLimit;\n+        private Runnable r;\n+        \n+        protected MobStatusOvertimeEntry(int delay, Runnable run) {\n+            procCount = 0;\n+            procLimit = (int)Math.ceil((float) delay / ServerConstants.MOB_STATUS_MONITOR_PROC);\n+            r = run;\n+        }\n+        \n+        protected void update() {\n+            procCount++;\n+            if(procCount >= procLimit) {\n+                procCount = 0;\n+                r.run();\n+            }\n+        }\n+    }\n+    \n+    private ScheduledFuture<?> mobStatusSchedule = null;\n+    private Lock mobStatusLock = new MonitoredReentrantLock(MonitoredLockType.CHANNEL_MOBSTATUS, true);\n+    private Runnable monitorTask = new Runnable() {\n+                                        @Override\n+                                        public void run() {\n+                                            runMobStatusSchedule();\n+                                        }\n+                                    };\n+    \n+    private void runMobStatusSchedule() {\n+        mobStatusLock.lock();\n+        try {\n+            if(registeredMobStatus.isEmpty()) {\n+                idleProcs++;\n+                \n+                if(idleProcs >= ServerConstants.MOB_STATUS_MONITOR_LIFE) {\n+                    if(mobStatusSchedule != null) {\n+                        mobStatusSchedule.cancel(false);\n+                        mobStatusSchedule = null;\n+                    }\n+                }\n+                \n+                return;\n+            }\n+            idleProcs = 0;\n+            \n+            long timeNow = System.currentTimeMillis();\n+            List<MonsterStatusEffect> toRemove = new LinkedList<>();\n+            for(Entry<MonsterStatusEffect, Pair<Runnable, Long>> rmd : registeredMobStatus.entrySet()) {\n+                Pair<Runnable, Long> r = rmd.getValue();\n+                \n+                if(r.getRight() < timeNow) {\n+                    r.getLeft().run();  // runs the cancel action\n+                    toRemove.add(rmd.getKey());\n+                }\n+            }\n+            \n+            for(MonsterStatusEffect mse : toRemove) {\n+                registeredMobStatus.remove(mse);\n+                registeredMobStatusOvertime.remove(mse);\n+            }\n+            \n+            // it's probably ok to use one thread for both management & overtime actions\n+            List<MobStatusOvertimeEntry> mdoeList = new ArrayList<>(registeredMobStatusOvertime.values());\n+            for(MobStatusOvertimeEntry mdoe : mdoeList) {\n+                mdoe.update();\n+            }\n+        } finally {\n+            mobStatusLock.unlock();\n+        }\n+    }\n+    \n+    public void registerMobStatus(MonsterStatusEffect mse, Runnable cancelStatus, long duration, Runnable overtimeStatus, int overtimeDelay) {\n+        mobStatusLock.lock();\n+        try {\n+            idleProcs = 0;\n+            if(mobStatusSchedule == null) {\n+                mobStatusSchedule = TimerManager.getInstance().register(monitorTask, ServerConstants.MOB_STATUS_MONITOR_PROC, ServerConstants.MOB_STATUS_MONITOR_PROC);\n+            }\n+            \n+            registeredMobStatus.put(mse, new Pair<>(cancelStatus, System.currentTimeMillis() + duration));\n+            \n+            if(overtimeStatus != null) {\n+                MobStatusOvertimeEntry mdoe = new MobStatusOvertimeEntry(overtimeDelay, overtimeStatus);\n+                registeredMobStatusOvertime.put(mse, mdoe);\n+            }\n+        } finally {\n+            mobStatusLock.unlock();\n+        }\n+    }\n+    \n+    public void interruptMobStatus(MonsterStatusEffect mse) {\n+        mobStatusLock.lock();\n+        try {\n+            Pair<Runnable, Long> rmd = registeredMobStatus.remove(mse);\n+            if(rmd != null) rmd.getLeft().run();\n+            \n+            registeredMobStatusOvertime.remove(mse);\n+        } finally {\n+            mobStatusLock.unlock();\n+        }\n+    }\n+}"}, {"sha": "1b4000533132c3270529cfd8d5ab53ae5c6b7b5d", "filename": "src/net/server/worker/BaseWorker.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/worker/BaseWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/worker/BaseWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/BaseWorker.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -24,7 +24,7 @@\n /**\n  * @author Ronan\n  */\n-public class BaseWorker implements Runnable {\n+public abstract class BaseWorker implements Runnable {\n     protected World wserv;\n     \n     @Override"}, {"sha": "155f2366f740ef8da1677ace1f6dfba7d4d8c994", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -124,7 +124,7 @@\n     \n     private Map<Runnable, Long> registeredTimedMapObjects = new LinkedHashMap<>();\n     private ScheduledFuture<?> timedMapObjectsSchedule;\n-    private Lock timedMapObjectLock = new MonitoredReentrantLock(MonitoredLockType.MAP_OBJS, true);\n+    private Lock timedMapObjectLock = new MonitoredReentrantLock(MonitoredLockType.WORLD_MAPOBJS, true);\n     \n     private ScheduledFuture<?> charactersSchedule;\n     private ScheduledFuture<?> marriagesSchedule;"}, {"sha": "1f5e5e835809b7034b4819678e6e677df644015f", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -978,4 +978,23 @@ public boolean canGetFirstJob(int jobType) {\n                         return true;\n                 }\n         }\n+        \n+        public static String getFirstJobStatRequirement(int jobType) {\n+                switch(jobType) {\n+                    case 1:\n+                        return \"STR \" + 35;\n+                        \n+                    case 2:\n+                        return \"INT \" + 20;\n+                        \n+                    case 3:\n+                    case 4:\n+                        return \"DEX \" + 25;\n+                        \n+                    case 5:\n+                        return \"DEX \" + 20;\n+                }\n+                \n+                return null;\n+        }\n }"}, {"sha": "2ec8782b110cb25f729db6d515e687ffe6c98d91", "filename": "src/scripting/AbstractScriptManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/AbstractScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/AbstractScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractScriptManager.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -69,7 +69,7 @@ protected Invocable getInvocable(String path, MapleClient c) {\n             }\n             try (FileReader fr = new FileReader(scriptFile)) {\n             \tif (ServerConstants.JAVA_8){\n-            \t\tengine.eval(\"load('nashorn:mozilla_compat.js');\");\n+            \t\tengine.eval(\"load('nashorn:mozilla_compat.js');\" + System.lineSeparator());\n             \t}\n                 engine.eval(fr);\n             } catch (final ScriptException | IOException t) {"}, {"sha": "b5d11eade1d861835b1e3bf9f82f2ff69a20d954", "filename": "src/scripting/item/ItemScriptManager.java", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/item/ItemScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/item/ItemScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/item/ItemScriptManager.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,14 +22,14 @@\n package scripting.item;\n \n import client.MapleClient;\n+import constants.ServerConstants;\n import java.io.File;\n import java.io.FileReader;\n import java.io.IOException;\n import java.lang.reflect.UndeclaredThrowableException;\n import java.util.HashMap;\n import java.util.Map;\n import javax.script.Compilable;\n-import javax.script.CompiledScript;\n import javax.script.Invocable;\n import javax.script.ScriptEngine;\n import javax.script.ScriptEngineFactory;\n@@ -76,8 +76,13 @@ public void getItemScript(MapleClient c, String scriptName) {\n         ScriptEngine portal = sef.getScriptEngine();\n         try {\n             fr = new FileReader(scriptFile);\n-            CompiledScript compiled = ((Compilable) portal).compile(fr);\n-            compiled.eval();\n+            \n+            // java 8 support here thanks to Arufonsu\n+            if (ServerConstants.JAVA_8){\n+                    portal.eval(\"load('nashorn:mozilla_compat.js');\" + System.lineSeparator());\n+            }\n+            \n+            ((Compilable) portal).compile(fr).eval();\n \n             final Invocable script = ((Invocable) portal);\n             scripts.put(scriptName, script);"}, {"sha": "303f1ae1fc34a518cc7146c398c2cff753451ec2", "filename": "src/scripting/map/MapScriptManager.java", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/map/MapScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/map/MapScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/map/MapScriptManager.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,14 +22,14 @@\n package scripting.map;\n \n import client.MapleClient;\n+import constants.ServerConstants;\n import java.io.File;\n import java.io.FileReader;\n import java.io.IOException;\n import java.lang.reflect.UndeclaredThrowableException;\n import java.util.HashMap;\n import java.util.Map;\n import javax.script.Compilable;\n-import javax.script.CompiledScript;\n import javax.script.Invocable;\n import javax.script.ScriptEngine;\n import javax.script.ScriptEngineFactory;\n@@ -80,8 +80,14 @@ public void getMapScript(MapleClient c, String scriptName, boolean firstUser) {\n         ScriptEngine portal = sef.getScriptEngine();\n         try {\n             fr = new FileReader(scriptFile);\n-            CompiledScript compiled = ((Compilable) portal).compile(fr);\n-            compiled.eval();\n+            \n+            // java 8 support here thanks to Arufonsu\n+            if (ServerConstants.JAVA_8){\n+                    portal.eval(\"load('nashorn:mozilla_compat.js');\" + System.lineSeparator());\n+            }\n+            \n+            ((Compilable) portal).compile(fr).eval();\n+            \n             final Invocable script = ((Invocable) portal);\n             scripts.put(scriptName, script);\n             script.invokeFunction(\"start\", new MapScriptMethods(c));"}, {"sha": "fd85fe5cc375cbe9d15eee828cd4cec51675eb34", "filename": "src/scripting/portal/PortalScriptManager.java", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/portal/PortalScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/scripting/portal/PortalScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/portal/PortalScriptManager.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -22,6 +22,7 @@\n package scripting.portal;\n \n import client.MapleClient;\n+import constants.ServerConstants;\n import java.io.File;\n import java.io.FileReader;\n import java.io.IOException;\n@@ -65,6 +66,12 @@ private PortalScript getPortalScript(String scriptName) {\n         ScriptEngine portal = sef.getScriptEngine();\n         try {\n             fr = new FileReader(scriptFile);\n+            \n+            // java 8 support here thanks to Arufonsu\n+            if (ServerConstants.JAVA_8){\n+                    portal.eval(\"load('nashorn:mozilla_compat.js');\" + System.lineSeparator());\n+            }\n+            \n             ((Compilable) portal).compile(fr).eval();\n         } catch (ScriptException | IOException | UndeclaredThrowableException e) {\n             FilePrinter.printError(FilePrinter.PORTAL + scriptName + \".txt\", e);"}, {"sha": "5d5f3655d3c405b2a0f1751a35febfd06ea9f3a6", "filename": "src/server/life/MapleLifeFactory.java", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleLifeFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleLifeFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleLifeFactory.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -132,12 +132,23 @@ public static MapleMonster getMonster(int mid) {\n                     stats.setRevives(revives);\n                 }\n                 decodeElementalString(stats, MapleDataTool.getString(\"elemAttr\", monsterInfoData, \"\"));\n-                MapleData monsterSkillData = monsterInfoData.getChildByPath(\"skill\");\n-                if (monsterSkillData != null) {\n+                MapleData monsterSkillInfoData = monsterInfoData.getChildByPath(\"skill\");\n+                if (monsterSkillInfoData != null) {\n                     int i = 0;\n                     List<Pair<Integer, Integer>> skills = new ArrayList<>();\n-                    while (monsterSkillData.getChildByPath(Integer.toString(i)) != null) {\n-                        skills.add(new Pair<>(Integer.valueOf(MapleDataTool.getInt(i + \"/skill\", monsterSkillData, 0)), Integer.valueOf(MapleDataTool.getInt(i + \"/level\", monsterSkillData, 0))));\n+                    while (monsterSkillInfoData.getChildByPath(Integer.toString(i)) != null) {\n+                        skills.add(new Pair<>(Integer.valueOf(MapleDataTool.getInt(i + \"/skill\", monsterSkillInfoData, 0)), Integer.valueOf(MapleDataTool.getInt(i + \"/level\", monsterSkillInfoData, 0))));\n+                        \n+                        MapleData monsterSkillData = monsterData.getChildByPath(\"skill\" + i);\n+                        if(monsterSkillData != null) {\n+                            int animationTime = 0;\n+                            for(MapleData effectEntry : monsterSkillData.getChildren()) {\n+                                animationTime += MapleDataTool.getIntConvert(\"delay\", effectEntry, 0);\n+                            }\n+                            \n+                            MapleMonsterInformationProvider.getInstance().setMobSkillAnimationTime(mid, i, animationTime);\n+                        }\n+                        \n                         i++;\n                     }\n                     stats.setSkills(skills);"}, {"sha": "c7d3d30a726df901966182369d533c884b2c4df2", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 54, "deletions": 35, "changes": 89, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -56,6 +56,7 @@\n import java.util.concurrent.atomic.AtomicLong;\n import java.util.concurrent.locks.Lock;\n import tools.locks.MonitoredReentrantLock;\n+import net.server.channel.Channel;\n import net.server.world.MapleParty;\n import net.server.world.MaplePartyCharacter;\n import server.TimerManager;\n@@ -320,7 +321,7 @@ public boolean isAttackedBy(MapleCharacter chr) {\n         return takenDamage.containsKey(chr.getId());\n     }\n \n-    private void distributeExperienceToParty(int pid, int exp, int killer, Set<MapleCharacter> underleveled, int minThresholdLevel) {\n+    private void distributeExperienceToParty(int pid, float exp, int killer, Set<MapleCharacter> underleveled, int minThresholdLevel) {\n         List<MapleCharacter> members = new LinkedList<>();\n         MapleCharacter pchar = getMap().getAnyCharacterFromParty(pid);\n         if(pchar != null) {\n@@ -353,7 +354,7 @@ private void distributeExperienceToParty(int pid, int exp, int killer, Set<Maple\n             if (level >= minThresholdLevel) {\n                 boolean isKiller = killer == id;\n                 boolean mostDamage = mostDamageCid == id;\n-                int xp = (int) ((0.80f * exp * level) / partyLevel);\n+                float xp = ((0.80f * exp * level) / partyLevel);\n                 if (mostDamage) {\n                     xp += (0.20f * exp);\n                 }\n@@ -378,30 +379,31 @@ public void distributeExperience(int killerId) {\n         int minThresholdLevel = calcThresholdLevel(this.getMap().getEventInstance() != null);\n         int exp = getExp();\n         long totalHealth = maxHpPlusHeal.get();\n-        Map<Integer, Integer> expDist = new HashMap<>();\n-        Map<Integer, Integer> partyExp = new HashMap<>();\n+        Map<Integer, Float> expDist = new HashMap<>();\n+        Map<Integer, Float> partyExp = new HashMap<>();\n         \n         float exp8perHp = (0.8f * exp) / totalHealth;   // 80% of pool is split amongst all the damagers\n         float exp2 = (0.2f * exp);                      // 20% of pool goes to the killer or his/her party\n         \n         for (Entry<Integer, AtomicInteger> damage : takenDamage.entrySet()) {\n-            expDist.put(damage.getKey(), (int) (Math.min((exp8perHp * damage.getValue().get()), Integer.MAX_VALUE)));\n+            expDist.put(damage.getKey(), exp8perHp * damage.getValue().get());\n         }\n         \n         Collection<MapleCharacter> chrs = map.getCharacters();\n         Set<MapleCharacter> underleveled = new HashSet<>();\n         for (MapleCharacter mc : chrs) {\n             if (expDist.containsKey(mc.getId())) {\n                 boolean isKiller = (mc.getId() == killerId);\n-                int xp = expDist.get(mc.getId());\n+                float xp = expDist.get(mc.getId());\n                 if (isKiller) {\n-                    xp = (int)Math.min(exp2 + xp, Integer.MAX_VALUE);\n+                    xp += exp2;\n                 }\n+                \n                 MapleParty p = mc.getParty();\n                 if (p != null) {\n                     int pID = p.getId();\n-                    long pXP = (long) xp + (partyExp.containsKey(pID) ? partyExp.get(pID) : 0);\n-                    partyExp.put(pID, (int)Math.min(pXP, Integer.MAX_VALUE));\n+                    float pXP = xp + (partyExp.containsKey(pID) ? partyExp.get(pID) : 0);\n+                    partyExp.put(pID, pXP);\n                 } else {\n                     if(mc.getLevel() >= minThresholdLevel) {\n                         //NO EXP WILL BE GIVEN for those who are underleveled!\n@@ -413,7 +415,7 @@ public void distributeExperience(int killerId) {\n             }\n         }\n         \n-        for (Entry<Integer, Integer> party : partyExp.entrySet()) {\n+        for (Entry<Integer, Float> party : partyExp.entrySet()) {\n             distributeExperienceToParty(party.getKey(), party.getValue(), killerId, underleveled, minThresholdLevel);\n         }\n         \n@@ -422,7 +424,7 @@ public void distributeExperience(int killerId) {\n         }\n     }\n \n-    public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKiller, int numExpSharers) {\n+    public void giveExpToCharacter(MapleCharacter attacker, float exp, boolean isKiller, int numExpSharers) {\n         if (isKiller) {\n             if (getMap().getEventInstance() != null) {\n                 getMap().getEventInstance().monsterKilled(attacker, this);\n@@ -434,17 +436,18 @@ public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKille\n         \n         int partyExp = 0;\n         if (attacker.getHp() > 0) {\n-            int personalExp = exp * attacker.getExpRate();\n+            exp *= attacker.getExpRate();\n+            int personalExp = (int) exp;\n \n-            if (exp > 0) {\n+            if (exp <= Integer.MAX_VALUE) {  // assuming no negative xp here\n                 if (partyModifier > 0.0f) {\n                     partyExp = (int) (personalExp * partyModifier * ServerConstants.PARTY_BONUS_EXP_RATE);\n                 }\n                 Integer holySymbol = attacker.getBuffedValue(MapleBuffStat.HOLY_SYMBOL);\n                 if (holySymbol != null) {\n                     personalExp *= 1.0 + (holySymbol.doubleValue() / 100.0);\n                 }\n-                \n+\n                 statiLock.lock();\n                 try {\n                     if (stati.containsKey(MonsterStatus.SHOWDOWN)) {\n@@ -453,6 +456,8 @@ public void giveExpToCharacter(MapleCharacter attacker, int exp, boolean isKille\n                 } finally {\n                     statiLock.unlock();\n                 }\n+            } else {\n+                personalExp = Integer.MAX_VALUE;\n             }\n             \n             attacker.gainExp(personalExp, partyExp, true, false, isKiller);\n@@ -777,9 +782,9 @@ private int broadcastStatusEffect(final MonsterStatusEffect status) {\n         byte[] packet = MaplePacketCreator.applyMonsterStatus(getObjectId(), status, null);\n         map.broadcastMessage(packet, getPosition());\n         \n-        MapleCharacter controller = getController();\n-        if (controller != null && !controller.isMapObjectVisible(this)) {\n-            controller.getClient().announce(packet);\n+        MapleCharacter chrController = getController();\n+        if (chrController != null && !chrController.isMapObjectVisible(this)) {\n+            chrController.getClient().announce(packet);\n         }\n         \n         return animationTime;\n@@ -832,6 +837,8 @@ public boolean applyStatus(MapleCharacter from, final MonsterStatusEffect status\n             }\n         }\n \n+        final Channel ch = map.getChannelServer();\n+        final int mapid = map.getId();\n         if(statis.size() > 0) {\n             statiLock.lock();\n             try {\n@@ -840,8 +847,7 @@ public boolean applyStatus(MapleCharacter from, final MonsterStatusEffect status\n                     if (oldEffect != null) {\n                         oldEffect.removeActiveStatus(stat);\n                         if (oldEffect.getStati().isEmpty()) {\n-                            oldEffect.cancelTask();\n-                            oldEffect.cancelDamageSchedule();\n+                            ch.interruptMobStatus(mapid, oldEffect);\n                         }\n                     }\n                 }\n@@ -850,7 +856,6 @@ public boolean applyStatus(MapleCharacter from, final MonsterStatusEffect status\n             }\n         }\n         \n-        TimerManager timerManager = TimerManager.getInstance();\n         final Runnable cancelTask = new Runnable() {\n \n             @Override\n@@ -875,17 +880,21 @@ public void run() {\n                 }\n                 \n                 setVenomMulti(0);\n-                status.cancelDamageSchedule();\n             }\n         };\n         \n+        Runnable overtimeAction = null;\n+        int overtimeDelay = -1;\n+        \n         int animationTime;\n         if (poison) {\n             int poisonLevel = from.getSkillLevel(status.getSkill());\n             int poisonDamage = Math.min(Short.MAX_VALUE, (int) (getMaxHp() / (70.0 - poisonLevel) + 0.999));\n             status.setValue(MonsterStatus.POISON, Integer.valueOf(poisonDamage));\n             animationTime = broadcastStatusEffect(status);\n-            status.setDamageSchedule(timerManager.register(new DamageTask(poisonDamage, from, status, cancelTask, 0), 1000, 1000));\n+            \n+            overtimeAction = new DamageTask(poisonDamage, from, status, 0);\n+            overtimeDelay = 1000;\n         } else if (venom) {\n             if (from.getJob() == MapleJob.NIGHTLORD || from.getJob() == MapleJob.SHADOWER || from.getJob().isA(MapleJob.NIGHTWALKER3)) {\n                 int poisonLevel, matk, jobid = from.getJob().getId();\n@@ -910,7 +919,9 @@ public void run() {\n                 status.setValue(MonsterStatus.VENOMOUS_WEAPON, Integer.valueOf(poisonDamage));\n                 status.setValue(MonsterStatus.POISON, Integer.valueOf(poisonDamage));\n                 animationTime = broadcastStatusEffect(status);\n-                status.setDamageSchedule(timerManager.register(new DamageTask(poisonDamage, from, status, cancelTask, 0), 1000, 1000));\n+                \n+                overtimeAction = new DamageTask(poisonDamage, from, status, 0);\n+                overtimeDelay = 1000;\n             } else {\n                 return false;\n             }\n@@ -919,7 +930,9 @@ public void run() {\n             int webDamage = (int) (getMaxHp() / 50.0 + 0.999);\n             status.setValue(MonsterStatus.SHADOW_WEB, Integer.valueOf(webDamage));\n             animationTime = broadcastStatusEffect(status);\n-            status.setDamageSchedule(timerManager.schedule(new DamageTask(webDamage, from, status, cancelTask, 1), 3500));\n+            \n+            overtimeAction = new DamageTask(webDamage, from, status, 1);\n+            overtimeDelay = 3500;\n             */\n         } else if (status.getSkill().getId() == 4121004 || status.getSkill().getId() == 4221004) { // Ninja Ambush\n             final Skill skill = SkillFactory.getSkill(status.getSkill().getId());\n@@ -928,7 +941,9 @@ public void run() {\n             \n             status.setValue(MonsterStatus.NINJA_AMBUSH, Integer.valueOf(damage));\n             animationTime = broadcastStatusEffect(status);\n-            status.setDamageSchedule(timerManager.register(new DamageTask(damage, from, status, cancelTask, 2), 1000, 1000));\n+            \n+            overtimeAction = new DamageTask(damage, from, status, 2);\n+            overtimeDelay = 1000;\n         } else {\n             animationTime = broadcastStatusEffect(status);\n         }\n@@ -943,12 +958,11 @@ public void run() {\n             statiLock.unlock();\n         }\n         \n-        status.setCancelTask(timerManager.schedule(cancelTask, duration + animationTime - 100));\n+        ch.registerMobStatus(mapid, status, cancelTask, duration + animationTime - 100, overtimeAction, overtimeDelay);\n         return true;\n     }\n \n     public void applyMonsterBuff(final Map<MonsterStatus, Integer> stats, final int x, int skillId, long duration, MobSkill skill, final List<Integer> reflection) {\n-        TimerManager timerManager = TimerManager.getInstance();\n         final Runnable cancelTask = new Runnable() {\n \n             @Override\n@@ -991,7 +1005,8 @@ public void run() {\n         if (controller != null && !controller.isMapObjectVisible(this)) {\n             controller.getClient().announce(packet);\n         }\n-        effect.setCancelTask(timerManager.schedule(cancelTask, duration));\n+        \n+        map.getChannelServer().registerMobStatus(map.getId(), effect, cancelTask, duration);\n     }\n \n     private void debuffMobStat(MonsterStatus stat) {\n@@ -1191,36 +1206,40 @@ public int getBuffToGive() {\n         private final int dealDamage;\n         private final MapleCharacter chr;\n         private final MonsterStatusEffect status;\n-        private final Runnable cancelTask;\n         private final int type;\n         private final MapleMap map;\n \n-        private DamageTask(int dealDamage, MapleCharacter chr, MonsterStatusEffect status, Runnable cancelTask, int type) {\n+        private DamageTask(int dealDamage, MapleCharacter chr, MonsterStatusEffect status, int type) {\n             this.dealDamage = dealDamage;\n             this.chr = chr;\n             this.status = status;\n-            this.cancelTask = cancelTask;\n             this.type = type;\n             this.map = chr.getMap();\n         }\n \n         @Override\n         public void run() {\n             int curHp = hp.get();\n-            if(curHp <= 1) return;\n+            if(curHp <= 1) {\n+                map.getChannelServer().interruptMobStatus(map.getId(), status);\n+                return;\n+            }\n             \n             int damage = dealDamage;\n             if (damage >= curHp) {\n                 damage = curHp - 1;\n                 if (type == 1 || type == 2) {\n-                    cancelTask.run();\n-                    status.getCancelTask().cancel(false);\n+                    map.getChannelServer().interruptMobStatus(map.getId(), status);\n                 }\n             }\n             if (damage > 0) {\n                 damage(chr, damage, true);\n-                if (type == 1) {    // ninja ambush (type 2) is already displaying DOT\n+                if (type == 1) {\n                     map.broadcastMessage(MaplePacketCreator.damageMonster(getObjectId(), damage), getPosition());\n+                } else if (type == 2) {\n+                    if(damage < dealDamage) {    // ninja ambush (type 2) is already displaying DOT to the caster\n+                        map.broadcastMessage(MaplePacketCreator.damageMonster(getObjectId(), damage), getPosition());\n+                    }\n                 }\n             }\n         }"}, {"sha": "41eaa84bce1101d531266993878f3726e8ebb130", "filename": "src/server/life/MapleMonsterInformationProvider.java", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleMonsterInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MapleMonsterInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterInformationProvider.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -53,6 +53,8 @@\n         private final Map<Integer, List<Integer>> dropsChancePool = new HashMap<>();    // thanks to ronan\n         private final Set<Integer> hasNoMultiEquipDrops = new HashSet<>();\n         private final Map<Integer, List<MonsterDropEntry>> extraMultiEquipDrops = new HashMap<>();\n+        \n+        private final Map<Pair<Integer, Integer>, Integer> mobSkillAnimationTime = new HashMap<>();\n \n \tprotected MapleMonsterInformationProvider() {\n \t\tretrieveGlobal();\n@@ -223,9 +225,17 @@ private void retrieveGlobal() {\n                 dropsChancePool.put(monsterId, ret);\n \t\treturn ret;\n \t}\n+        \n+        public final void setMobSkillAnimationTime(int monsterId, int skillPos, int animationTime) {\n+                mobSkillAnimationTime.put(new Pair<>(monsterId, skillPos), animationTime);\n+        }\n+        \n+        public final Integer getMobSkillAnimationTime(int monsterId, int skillPos) {\n+                Integer time = mobSkillAnimationTime.get(new Pair<>(monsterId, skillPos));\n+                return time == null ? 0 : time;\n+        }\n \n-\tpublic static ArrayList<Pair<Integer, String>> getMobsIDsFromName(String search)\n-\t{\n+\tpublic static ArrayList<Pair<Integer, String>> getMobsIDsFromName(String search) {\n \t\tMapleDataProvider dataProvider = MapleDataProviderFactory.getDataProvider(new File(\"wz/String.wz\"));\n \t\tArrayList<Pair<Integer, String>> retMobs = new ArrayList<Pair<Integer, String>>();\n \t\tMapleData data = dataProvider.getData(\"Mob.img\");\n@@ -243,8 +253,7 @@ private void retrieveGlobal() {\n \t\treturn retMobs;\n \t}\n \n-\tpublic static String getMobNameFromId(int id)\n-\t{\n+\tpublic static String getMobNameFromId(int id) {\n \t\ttry\n \t\t{\n \t\t\treturn MapleLifeFactory.getMonster(id).getName();\n@@ -261,8 +270,7 @@ public static String getMobNameFromId(int id)\n \t\t}\n \t}\n         \n-        public static String getMobNameFromID(int id)\n-\t{\n+        public static String getMobNameFromID(int id) {\n \t\ttry\n \t\t{\n \t\t\treturn MapleLifeFactory.getMonster(id).getName();"}, {"sha": "032b6ab662666dbbf123df41a8cd227dc3b81965", "filename": "src/server/life/MobSkill.java", "status": "modified", "additions": 21, "deletions": 9, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MobSkill.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/life/MobSkill.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MobSkill.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -32,6 +32,7 @@\n import constants.GameConstants;\n import java.util.LinkedList;\n import java.util.Map;\n+import server.TimerManager;\n import tools.Randomizer;\n import server.maps.MapleMapObject;\n import server.maps.MapleMapObjectType;\n@@ -103,6 +104,17 @@ public void setLimit(int limit) {\n         this.limit = limit;\n     }\n \n+    public void applyDelayedEffect(final MapleCharacter player, final MapleMonster monster, final boolean skill, final List<MapleCharacter> banishPlayers, int animationTime) {\n+        TimerManager.getInstance().schedule(new Runnable() {\n+                                                @Override\n+                                                public void run() {\n+                                                    if(monster.isAlive()) {\n+                                                        applyEffect(player, monster, skill, banishPlayers);\n+                                                    }\n+                                                }\n+                                            }, animationTime);\n+    }\n+    \n     public void applyEffect(MapleCharacter player, MapleMonster monster, boolean skill, List<MapleCharacter> banishPlayers) {\n         MapleDisease disease = null;\n         Map<MonsterStatus, Integer> stats = new ArrayMap<MonsterStatus, Integer>();\n@@ -282,15 +294,15 @@ public void applyEffect(MapleCharacter player, MapleMonster monster, boolean ski\n                 System.out.println(\"Unhandled Mob skill: \" + skillId);\n                 break;\n         }\n-\t\tif (stats.size() > 0) {\n-\t\t    if (lt != null && rb != null && skill) {\n-\t\t\t\tfor (MapleMapObject mons : getObjectsInRange(monster, MapleMapObjectType.MONSTER)) {\n-\t\t\t\t    ((MapleMonster) mons).applyMonsterBuff(stats, getX(), getSkillId(), getDuration(), this, reflection);\n-\t\t\t\t}\n-\t\t    } else {\n-\t\t    \tmonster.applyMonsterBuff(stats, getX(), getSkillId(), getDuration(), this, reflection);\n-\t\t    }\n-\t\t}        \n+        if (stats.size() > 0) {\n+            if (lt != null && rb != null && skill) {\n+                for (MapleMapObject mons : getObjectsInRange(monster, MapleMapObjectType.MONSTER)) {\n+                    ((MapleMonster) mons).applyMonsterBuff(stats, getX(), getSkillId(), getDuration(), this, reflection);\n+                }\n+            } else {\n+                monster.applyMonsterBuff(stats, getX(), getSkillId(), getDuration(), this, reflection);\n+            }\n+        }\n         if (disease != null) {\n             if (lt != null && rb != null && skill) {\n                 int i = 0;"}, {"sha": "c9fcd86f7108cadf9b7ef3b5db28554e541315f7", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 29, "deletions": 26, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -59,7 +59,6 @@\n import java.util.concurrent.locks.ReentrantReadWriteLock.ReadLock;\n import java.util.concurrent.locks.ReentrantReadWriteLock.WriteLock;\n import java.lang.ref.WeakReference;\n-import java.util.Comparator;\n import net.server.Server;\n import net.server.channel.Channel;\n import scripting.map.MapScriptManager;\n@@ -255,15 +254,43 @@ private static double getRangedDistance() {\n     public int getId() {\n         return mapid;\n     }\n+    \n+    public Channel getChannelServer() {\n+        return Server.getInstance().getWorld(world).getChannel(channel);\n+    }\n \n     public MapleMap getReturnMap() {\n         if(returnMapId == 999999999) return this;\n-        return Server.getInstance().getWorld(world).getChannel(channel).getMapFactory().getMap(returnMapId);\n+        return getChannelServer().getMapFactory().getMap(returnMapId);\n     }\n \n     public int getReturnMapId() {\n         return returnMapId;\n     }\n+    \n+    public MapleMap getForcedReturnMap() {\n+        return getChannelServer().getMapFactory().getMap(forcedReturnMap);\n+    }\n+    \n+    public int getForcedReturnId() {\n+        return forcedReturnMap;\n+    }\n+\n+    public void setForcedReturnMap(int map) {\n+        this.forcedReturnMap = map;\n+    }\n+\n+    public long getTimeLimit() {\n+        return timeLimit;\n+    }\n+\n+    public void setTimeLimit(int timeLimit) {\n+        this.timeLimit = timeLimit;\n+    }\n+\n+    public int getTimeLeft() {\n+        return (int) ((timeLimit - System.currentTimeMillis()) / 1000);\n+    }\n \n     public void setReactorState() {\n         chrRLock.lock();\n@@ -322,30 +349,6 @@ public boolean isAllReactorState(final int reactorId, final int state) {\n         return true;\n     }\n     \n-    public int getForcedReturnId() {\n-        return forcedReturnMap;\n-    }\n-\n-    public MapleMap getForcedReturnMap() {\n-        return Server.getInstance().getWorld(world).getChannel(channel).getMapFactory().getMap(forcedReturnMap);\n-    }\n-\n-    public void setForcedReturnMap(int map) {\n-        this.forcedReturnMap = map;\n-    }\n-\n-    public long getTimeLimit() {\n-        return timeLimit;\n-    }\n-\n-    public void setTimeLimit(int timeLimit) {\n-        this.timeLimit = timeLimit;\n-    }\n-\n-    public int getTimeLeft() {\n-        return (int) ((timeLimit - System.currentTimeMillis()) / 1000);\n-    }\n-\n     public int getCurrentPartyId() {\n         for (MapleCharacter chr : this.getCharacters()) {\n             if (chr.getPartyId() != -1) {"}, {"sha": "5d3e398e783d349f1b8d01ce1ec1ea9af63d2122", "filename": "src/server/maps/MapleReactor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/maps/MapleReactor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/server/maps/MapleReactor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleReactor.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -55,7 +55,7 @@\n     private boolean attackHit;\n     private ScheduledFuture<?> timeoutTask = null;\n     private Lock reactorLock = new MonitoredReentrantLock(MonitoredLockType.REACTOR, true);\n-    private Lock hitLock = new MonitoredReentrantLock(MonitoredLockType.REACTOR, true);\n+    private Lock hitLock = new MonitoredReentrantLock(MonitoredLockType.REACTOR_HIT, true);\n \n     public MapleReactor(MapleReactorStats stats, int rid) {\n         this.evstate = (byte)0;"}, {"sha": "ca12f0e55b7cfc2d02a7805555af6cf146425312", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -3877,12 +3877,13 @@ private static void writeIntMask(final MaplePacketLittleEndianWriter mplew, Map<\n         }\n \n         public static byte[] applyMonsterStatus(final int oid, final MonsterStatusEffect mse, final List<Integer> reflection) {\n+                Map<MonsterStatus, Integer> stati = mse.getStati();\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.APPLY_MONSTER_STATUS.getValue());\n                 mplew.writeInt(oid);\n                 mplew.writeLong(0);\n-                writeIntMask(mplew, mse.getStati());\n-                for (Map.Entry<MonsterStatus, Integer> stat : mse.getStati().entrySet()) {\n+                writeIntMask(mplew, stati);\n+                for (Map.Entry<MonsterStatus, Integer> stat : stati.entrySet()) {\n                         mplew.writeShort(stat.getValue());\n                         if (mse.isMonsterSkill()) {\n                                 mplew.writeShort(mse.getMobSkill().getSkillId());\n@@ -3892,7 +3893,7 @@ private static void writeIntMask(final MaplePacketLittleEndianWriter mplew, Map<\n                         }\n                         mplew.writeShort(-1); // might actually be the buffTime but it's not displayed anywhere\n                 }\n-                int size = mse.getStati().size(); // size\n+                int size = stati.size(); // size\n                 if (reflection != null) {\n                         for (Integer ref : reflection) {\n                                 mplew.writeInt(ref);"}, {"sha": "7930122041937ffa3c6893c4d5dae5ed6a0f07fa", "filename": "src/tools/locks/MonitoredLockType.java", "status": "modified", "additions": 53, "deletions": 56, "changes": 109, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/src/tools/locks/MonitoredLockType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/src/tools/locks/MonitoredLockType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/locks/MonitoredLockType.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -1,6 +1,6 @@\n /*\n     This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n+    Copyleft 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n@@ -25,59 +25,56 @@\n  */\n \n public enum MonitoredLockType {\n-    UNDEFINED(-1),\n-    CHR(0),\n-    EFF(1),\n-    PET(2),\n-    PRT(3),\n-    CLIENT(4),\n-    BOOK(5),\n-    ITEM(6),\n-    INVENTORY(7),\n-    SRVHANDLER_IDLE(8),\n-    SRVHANDLER_TEMP(9),\n-    BUFF_STORAGE(10),\n-    PLAYER_STORAGE(11),\n-    SERVER(12),\n-    MERCHANT(13),\n-    CHANNEL(14),\n-    GUILD(15),\n-    PARTY(16),\n-    WORLD_PARTY(17),\n-    WORLD_OWL(18),\n-    WORLD_PETS(19),\n-    WORLD_MOUNTS(20),\n-    WORLD_PSHOPS(21),\n-    WORLD_MERCHS(21),\n-    EIM(22),\n-    EIM_PARTY(23),\n-    EIM_SCRIPT(24),\n-    EM_LOBBY(25),\n-    EM_QUEUE(26),\n-    CASHSHOP(27),\n-    VISITOR_PSHOP(28),\n-    STORAGE(29),\n-    MOB_EXT(30),\n-    MOB(31),\n-    MOB_STATI(32),\n-    MOBSKILL_FACTORY(33),\n-    PORTAL(34),\n-    VISITOR_MERCH(35),\n-    MAP_CHRS(36),\n-    MAP_OBJS(37),\n-    MAP_FACTORY(38),\n-    MAP_ITEM(39),\n-    MAP_BOUNDS(40),\n-    MINIDUNGEON(41),\n-    REACTOR(42);\n-    \n-    private final int i;\n-    \n-    private MonitoredLockType(int val) {\n-        this.i = val;\n-    }\n-\n-    public int getValue() {\n-        return i;\n-    }\n+    UNDEFINED,\n+    CHARACTER_CHR,\n+    CHARACTER_EFF,\n+    CHARACTER_PET,\n+    CHARACTER_PRT,\n+    CLIENT,\n+    CLIENT_ENCODER,\n+    CLIENT_LOGIN,\n+    BOOK,\n+    ITEM,\n+    INVENTORY,\n+    SRVHANDLER_IDLE,\n+    SRVHANDLER_TEMP,\n+    BUFF_STORAGE,\n+    PLAYER_STORAGE,\n+    SERVER,\n+    SERVER_LOGIN,\n+    SERVER_DISEASES,\n+    MERCHANT,\n+    CHANNEL,\n+    CHANNEL_MOBSTATUS,\n+    GUILD,\n+    PARTY,\n+    WORLD_PARTY,\n+    WORLD_OWL,\n+    WORLD_PETS,\n+    WORLD_MOUNTS,\n+    WORLD_PSHOPS,\n+    WORLD_MERCHS,\n+    WORLD_MAPOBJS,\n+    EIM,\n+    EIM_PARTY,\n+    EIM_SCRIPT,\n+    EM_LOBBY,\n+    EM_QUEUE,\n+    CASHSHOP,\n+    VISITOR_PSHOP,\n+    STORAGE,\n+    MOB_EXT,\n+    MOB,\n+    MOB_STATI,\n+    MOBSKILL_FACTORY,\n+    PORTAL,\n+    VISITOR_MERCH,\n+    MAP_CHRS,\n+    MAP_OBJS,\n+    MAP_FACTORY,\n+    MAP_ITEM,\n+    MAP_BOUNDS,\n+    MINIDUNGEON,\n+    REACTOR,\n+    REACTOR_HIT;\n }"}, {"sha": "c16e02e882d46604013fb7af56b6bf3f3aa7e4f9", "filename": "tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar?ref=94425ba616dacf61b156044ac3993e2d06584c8f"}, {"sha": "8b24fabf13bf8941ca00f01a9d0abfdc28609f1d", "filename": "tools/MapleQuestItemFetcher/lib/QuestReport.txt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/lib/QuestReport.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/lib/QuestReport.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/lib/QuestReport.txt?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -1,5 +1,5 @@\n  # Report File autogenerated from the MapleQuestItemFetcher feature by Ronan Lana.\n- # Generated data takes into account several data info from the underlying DB and the server-side WZ.xmls.\n+ # Generated data takes into account several data info from the underlying DB, server source files and the server-side WZ.xmls.\n \n INCORRECT QUESTIDS ON DB\n 2022055 : -1 -> 9330 EXPIRED"}, {"sha": "8302ee5a39504b789ddc940ca254235b4aa24985", "filename": "tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "status": "modified", "additions": 10, "deletions": 17, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -403,36 +403,29 @@ private static void filterDirectorySearchMatchingData(String path, List<Pair<Int\n         }\n     }\n     \n-    private static boolean foundMatchingDataOnFile(Scanner scan, String searchStr) {\n-        while(scan.hasNext()){\n-            String line = scan.nextLine().toLowerCase();\n-            if(line.contains(searchStr)){\n-                return true;\n-            }\n-        }\n-        \n-        return false;\n+    private static boolean foundMatchingDataOnFile(String fileContent, String searchStr) {\n+        return fileContent.contains(searchStr);\n     }\n     \n-    \n     private static void fileSearchMatchingData(File file, List<Pair<Integer, Integer>> itemsWithQuest) {\n         try {\n-            Scanner scanner = new Scanner(file);\n-\n+            String fileContent = FileUtils.readFileToString(file, \"UTF-8\");\n+            \n             List<Pair<Integer, Integer>> copyItemsWithQuest = new ArrayList<>(itemsWithQuest);\n             for(Pair<Integer, Integer> iq : copyItemsWithQuest) {\n-                scanner.reset();\n-                \n-                if(foundMatchingDataOnFile(scanner, String.valueOf(iq.getLeft()))) {\n+                if(foundMatchingDataOnFile(fileContent, String.valueOf(iq.getLeft()))) {\n                     itemsWithQuest.remove(iq);\n                 }\n             }\n-        } catch(FileNotFoundException e) {}\n+        } catch(IOException ioe) {\n+            System.out.println(\"Failed to read file: \" + file.getAbsolutePath());\n+            ioe.printStackTrace();\n+        }\n     }\n     \n     private static void printReportFileHeader() {\n         printWriter.println(\" # Report File autogenerated from the MapleQuestItemFetcher feature by Ronan Lana.\");\n-        printWriter.println(\" # Generated data takes into account several data info from the underlying DB and the server-side WZ.xmls.\");\n+        printWriter.println(\" # Generated data takes into account several data info from the underlying DB, server source files and the server-side WZ.xmls.\");\n         printWriter.println();\n     }\n     "}, {"sha": "124dfea55a4ee9a4af1fc79863f53dacc4a4afce", "filename": "wz/Item.wz/Etc/0403.img.xml", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Item.wz/Etc/0403.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Item.wz/Etc/0403.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Etc/0403.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -9725,10 +9725,8 @@\n         <vector name=\"origin\" x=\"-1\" y=\"31\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"price\" value=\"1\"/>\n-      <int name=\"tradeBlock\" value=\"1\"/>\n-      <int name=\"slotMax\" value=\"1\"/>\n-      <int name=\"notSale\" value=\"1\"/>\n+      <int name=\"price\" value=\"1700\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04031902\">\n@@ -9805,8 +9803,8 @@\n         <vector name=\"origin\" x=\"-3\" y=\"30\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"price\" value=\"1\"/>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"price\" value=\"1500\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04031907\">"}, {"sha": "0dedff9a41fe426eff167e5b8d4e63959af41cf4", "filename": "wz/Map.wz/Map/Map1/101000301.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Map.wz/Map/Map1/101000301.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Map.wz/Map/Map1/101000301.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map1/101000301.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -10,7 +10,7 @@\n     <string name=\"bgm\" value=\"Bgm01/MoonlightShadow\"/>\n     <string name=\"mapMark\" value=\"Ellinia\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n-    <int name=\"fieldLimit\" value=\"393340\"/>\n+    <int name=\"fieldLimit\" value=\"393342\"/>\n     <int name=\"VRTop\" value=\"-900\"/>\n     <int name=\"VRLeft\" value=\"1230\"/>\n     <int name=\"VRBottom\" value=\"550\"/>"}, {"sha": "fd93b2cc1144a78569b22247fae55e29cbe719a4", "filename": "wz/Quest.wz/Act.img.xml", "status": "modified", "additions": 56, "deletions": 40, "changes": 96, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/Act.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/Act.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Act.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -1,4 +1,4 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+\ufeff<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n <imgdir name=\"Act.img\">\n   <imgdir name=\"1000\">\n     <imgdir name=\"1\">\n@@ -39231,7 +39231,7 @@\n           <int name=\"count\" value=\"-50\"/>\n         </imgdir>\n         <imgdir name=\"3\">\n-          <int name=\"id\" value=\"4000150\"/>\n+          <int name=\"id\" value=\"4000135\"/>\n           <int name=\"count\" value=\"-50\"/>\n         </imgdir>\n         <imgdir name=\"4\">\n@@ -39258,138 +39258,154 @@\n           <int name=\"id\" value=\"4000176\"/>\n           <int name=\"count\" value=\"-2\"/>\n         </imgdir>\n+        <imgdir name=\"10\">\n+          <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4000413\"/>\n+        </imgdir>\n+        <imgdir name=\"11\">\n+          <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4000414\"/>\n+        </imgdir>\n         <imgdir name=\"12\">\n-          <int name=\"id\" value=\"4000175\"/>\n           <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4031901\"/>\n         </imgdir>\n         <imgdir name=\"13\">\n-          <int name=\"id\" value=\"4000138\"/>\n           <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4000224\"/>\n         </imgdir>\n         <imgdir name=\"14\">\n-          <int name=\"id\" value=\"4011007\"/>\n           <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4000235\"/>\n         </imgdir>\n         <imgdir name=\"15\">\n-          <int name=\"id\" value=\"4021009\"/>\n           <int name=\"count\" value=\"-2\"/>\n+          <int name=\"id\" value=\"4000243\"/>\n         </imgdir>\n         <imgdir name=\"16\">\n+          <int name=\"id\" value=\"4000175\"/>\n+          <int name=\"count\" value=\"-2\"/>\n+        </imgdir>\n+        <imgdir name=\"17\">\n+          <int name=\"id\" value=\"4000138\"/>\n+          <int name=\"count\" value=\"-2\"/>\n+        </imgdir>\n+        <imgdir name=\"18\">\n+          <int name=\"id\" value=\"4011007\"/>\n+          <int name=\"count\" value=\"-2\"/>\n+        </imgdir>\n+        <imgdir name=\"19\">\n+          <int name=\"id\" value=\"4021009\"/>\n+          <int name=\"count\" value=\"-2\"/>\n+        </imgdir>\n+        <imgdir name=\"20\">\n           <int name=\"id\" value=\"4005000\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"17\">\n+        <imgdir name=\"21\">\n           <int name=\"id\" value=\"4005001\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"18\">\n+        <imgdir name=\"22\">\n           <int name=\"id\" value=\"4005002\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"19\">\n+        <imgdir name=\"23\">\n           <int name=\"id\" value=\"4005003\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"20\">\n+        <imgdir name=\"24\">\n           <int name=\"id\" value=\"4005004\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"21\">\n+        <imgdir name=\"25\">\n           <int name=\"id\" value=\"4011000\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"22\">\n+        <imgdir name=\"26\">\n           <int name=\"id\" value=\"4011001\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"23\">\n+        <imgdir name=\"27\">\n           <int name=\"id\" value=\"4011002\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"24\">\n+        <imgdir name=\"28\">\n           <int name=\"id\" value=\"4011003\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"25\">\n+        <imgdir name=\"29\">\n           <int name=\"id\" value=\"4011004\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"26\">\n+        <imgdir name=\"30\">\n           <int name=\"id\" value=\"4011005\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"27\">\n+        <imgdir name=\"31\">\n           <int name=\"id\" value=\"4011006\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"28\">\n+        <imgdir name=\"32\">\n           <int name=\"id\" value=\"4021000\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"29\">\n+        <imgdir name=\"33\">\n           <int name=\"id\" value=\"4021001\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"30\">\n+        <imgdir name=\"34\">\n           <int name=\"id\" value=\"4021002\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"31\">\n+        <imgdir name=\"35\">\n           <int name=\"id\" value=\"4021003\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"32\">\n+        <imgdir name=\"36\">\n           <int name=\"id\" value=\"4021004\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"33\">\n+        <imgdir name=\"37\">\n           <int name=\"id\" value=\"4021005\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"34\">\n+        <imgdir name=\"38\">\n           <int name=\"id\" value=\"4021006\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"35\">\n+        <imgdir name=\"39\">\n           <int name=\"id\" value=\"4021007\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"36\">\n+        <imgdir name=\"40\">\n           <int name=\"id\" value=\"4021008\"/>\n           <int name=\"count\" value=\"-5\"/>\n         </imgdir>\n-        <imgdir name=\"37\">\n+        <imgdir name=\"41\">\n           <int name=\"id\" value=\"1442030\"/>\n           <int name=\"count\" value=\"-1\"/>\n         </imgdir>\n-        <imgdir name=\"38\">\n+        <imgdir name=\"42\">\n           <int name=\"id\" value=\"1002033\"/>\n           <int name=\"count\" value=\"-1\"/>\n         </imgdir>\n-        <imgdir name=\"39\">\n+        <imgdir name=\"43\">\n           <int name=\"id\" value=\"1050132\"/>\n           <int name=\"count\" value=\"-1\"/>\n         </imgdir>\n-        <imgdir name=\"40\">\n+        <imgdir name=\"44\">\n           <int name=\"id\" value=\"1082002\"/>\n           <int name=\"count\" value=\"-1\"/>\n         </imgdir>\n-        <imgdir name=\"41\">\n+        <imgdir name=\"45\">\n           <int name=\"id\" value=\"1072169\"/>\n           <int name=\"count\" value=\"-1\"/>\n         </imgdir>\n-        <imgdir name=\"42\">\n+        <imgdir name=\"46\">\n           <int name=\"id\" value=\"2049100\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"10\">\n-          <int name=\"count\" value=\"-2\"/>\n-          <int name=\"id\" value=\"4000413\"/>\n-        </imgdir>\n-        <imgdir name=\"11\">\n-          <int name=\"count\" value=\"-2\"/>\n-          <int name=\"id\" value=\"4000414\"/>\n-        </imgdir>\n       </imgdir>\n       <int name=\"exp\" value=\"80000\"/>\n       <int name=\"pop\" value=\"5\"/>"}, {"sha": "729f3aff7096c318a85ab9ccc7f1e407380761f2", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 54, "deletions": 38, "changes": 92, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -62651,7 +62651,7 @@\n           <int name=\"count\" value=\"50\"/>\n         </imgdir>\n         <imgdir name=\"3\">\n-          <int name=\"id\" value=\"4000150\"/>\n+          <int name=\"id\" value=\"4000135\"/>\n           <int name=\"count\" value=\"50\"/>\n         </imgdir>\n         <imgdir name=\"4\">\n@@ -62678,134 +62678,150 @@\n           <int name=\"id\" value=\"4000176\"/>\n           <int name=\"count\" value=\"2\"/>\n         </imgdir>\n+        <imgdir name=\"10\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000413\"/>\n+        </imgdir>\n+        <imgdir name=\"11\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000414\"/>\n+        </imgdir>\n         <imgdir name=\"12\">\n-          <int name=\"id\" value=\"4000175\"/>\n           <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4031901\"/>\n         </imgdir>\n         <imgdir name=\"13\">\n-          <int name=\"id\" value=\"4000138\"/>\n           <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000224\"/>\n         </imgdir>\n         <imgdir name=\"14\">\n-          <int name=\"id\" value=\"4011007\"/>\n           <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000235\"/>\n         </imgdir>\n         <imgdir name=\"15\">\n-          <int name=\"id\" value=\"4021009\"/>\n           <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000243\"/>\n         </imgdir>\n         <imgdir name=\"16\">\n+          <int name=\"id\" value=\"4000175\"/>\n+          <int name=\"count\" value=\"2\"/>\n+        </imgdir>\n+        <imgdir name=\"17\">\n+          <int name=\"id\" value=\"4000138\"/>\n+          <int name=\"count\" value=\"2\"/>\n+        </imgdir>\n+        <imgdir name=\"18\">\n+          <int name=\"id\" value=\"4011007\"/>\n+          <int name=\"count\" value=\"2\"/>\n+        </imgdir>\n+        <imgdir name=\"19\">\n+          <int name=\"id\" value=\"4021009\"/>\n+          <int name=\"count\" value=\"2\"/>\n+        </imgdir>\n+        <imgdir name=\"20\">\n           <int name=\"id\" value=\"4005000\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"17\">\n+        <imgdir name=\"21\">\n           <int name=\"id\" value=\"4005001\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"18\">\n+        <imgdir name=\"22\">\n           <int name=\"id\" value=\"4005002\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"19\">\n+        <imgdir name=\"23\">\n           <int name=\"id\" value=\"4005003\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"20\">\n+        <imgdir name=\"24\">\n           <int name=\"id\" value=\"4005004\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"21\">\n+        <imgdir name=\"25\">\n           <int name=\"id\" value=\"4011000\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"22\">\n+        <imgdir name=\"26\">\n           <int name=\"id\" value=\"4011001\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"23\">\n+        <imgdir name=\"27\">\n           <int name=\"id\" value=\"4011002\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"24\">\n+        <imgdir name=\"28\">\n           <int name=\"id\" value=\"4011003\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"25\">\n+        <imgdir name=\"29\">\n           <int name=\"id\" value=\"4011004\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"26\">\n+        <imgdir name=\"30\">\n           <int name=\"id\" value=\"4011005\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"27\">\n+        <imgdir name=\"31\">\n           <int name=\"id\" value=\"4011006\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"28\">\n+        <imgdir name=\"32\">\n           <int name=\"id\" value=\"4021000\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"29\">\n+        <imgdir name=\"33\">\n           <int name=\"id\" value=\"4021001\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"30\">\n+        <imgdir name=\"34\">\n           <int name=\"id\" value=\"4021002\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"31\">\n+        <imgdir name=\"35\">\n           <int name=\"id\" value=\"4021003\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"32\">\n+        <imgdir name=\"36\">\n           <int name=\"id\" value=\"4021004\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"33\">\n+        <imgdir name=\"37\">\n           <int name=\"id\" value=\"4021005\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"34\">\n+        <imgdir name=\"38\">\n           <int name=\"id\" value=\"4021006\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"35\">\n+        <imgdir name=\"39\">\n           <int name=\"id\" value=\"4021007\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"36\">\n+        <imgdir name=\"40\">\n           <int name=\"id\" value=\"4021008\"/>\n           <int name=\"count\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"37\">\n+        <imgdir name=\"41\">\n           <int name=\"id\" value=\"1442030\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"38\">\n+        <imgdir name=\"42\">\n           <int name=\"id\" value=\"1002033\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"39\">\n+        <imgdir name=\"43\">\n           <int name=\"id\" value=\"1050132\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"40\">\n+        <imgdir name=\"44\">\n           <int name=\"id\" value=\"1082002\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"41\">\n+        <imgdir name=\"45\">\n           <int name=\"id\" value=\"1072169\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"10\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000413\"/>\n-        </imgdir>\n-        <imgdir name=\"11\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000414\"/>\n-        </imgdir>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"0\">"}, {"sha": "a6c91d3fef4c1a8f85f4650cb4dcff84473e0caf", "filename": "wz/Quest.wz/QuestInfo.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/QuestInfo.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/Quest.wz/QuestInfo.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/QuestInfo.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -19525,7 +19525,7 @@ Able to proceed to &apos;Merry-go-round in Kampung&apos; as next quest.\n   <imgdir name=\"8206\">\n     <string name=\"name\" value=\"Ace of Heart&apos;s Secret Ability\"/>\n     <string name=\"0\" value=\"#b#p2041017##k and his partner seems pretty busy recently. Should I check with them on what kind of business they are on now?\"/>\n-    <string name=\"1\" value=\"#b#p2041017##k said he can make a nice package for a chocolate... ...... Nope, not this time. Actually, he and his partner are providing a &quot;synthetizing on demand&quot; kind of service. Of #b#t2049100##k! By completing his quest, I am granted a fair amount of these scrolls. But LOOK AT THIS LIST:\\n\\n#i4032474# #t4032474# #c4032474# / #r5#k\\n#i4000046# #t4000046# #c4000046# / #r50#k\\n#i4000054# #t4000054# #c4000054# / #r50#k\\n#i4000150# #t4000150# #c4000150# / #r50#k\\n#i4000080# #t4000080# #c4000080# / #r50#k\\n#i4000151# #t4000151# #c4000151# / #r5#k\\n#i4000152# #t4000152# #c4000152# / #r5#k\\n#i4031906# #t4031906# #c4031906# / #r5#k\\n#i4000040# #t4000040# #c4000040# / #r2#k\\n#i4000176# #t4000176# #c4000176# / #r2#k\\n#i4000413# #t4000413# #c4000413# / #r2#k\\n#i4000414# #t4000414# #c4000414# / #r2#k\\n#i4000175# #t4000175# #c4000175# / #r2#k\\n#i4000138# #t4000138# #c4000138# / #r2#k\\n#i4011007# #t4011007# #c4011007# / #r2#k\\n#i4021009# #t4021009# #c4021009# / #r2#k\\n#i4005000# #t4005000# #c4005000# / #r5#k\\n#i4005001# #t4005001# #c4005001# / #r5#k\\n#i4005002# #t4005002# #c4005002# / #r5#k\\n#i4005003# #t4005003# #c4005003# / #r5#k\\n#i4005004# #t4005004# #c4005004# / #r5#k\\n#i4011000# #t4011000# #c4011000# / #r5#k\\n#i4011001# #t4011001# #c4011001# / #r5#k\\n#i4011002# #t4011002# #c4011002# / #r5#k\\n#i4011003# #t4011003# #c4011003# / #r5#k\\n#i4011004# #t4011004# #c4011004# / #r5#k\\n#i4011005# #t4011005# #c4011005# / #r5#k\\n#i4011006# #t4011006# #c4011006# / #r5#k\\n#i4021000# #t4021000# #c4021000# / #r5#k\\n#i4021001# #t4021001# #c4021001# / #r5#k\\n#i4021002# #t4021002# #c4021002# / #r5#k\\n#i4021003# #t4021003# #c4021003# / #r5#k\\n#i4021004# #t4021004# #c4021004# / #r5#k\\n#i4021005# #t4021005# #c4021005# / #r5#k\\n#i4021006# #t4021006# #c4021006# / #r5#k\\n#i4021007# #t4021007# #c4021007# / #r5#k\\n#i4021008# #t4021008# #c4021008# / #r5#k\\n#i1442030# #t1442030# #c1442030# / #r1#k\\n#i1002033# #t1002033# #c1002033# / #r1#k\\n#i1050132# #t1050132# #c1050132# / #r1#k\\n#i1082002# #t1082002# #c1082002# / #r1#k\\n#i1072169# #t1072169# #c1072169# / #r1#k\"/>\n+    <string name=\"1\" value=\"#b#p2041017##k said he can make a nice package for a chocolate... ...... Nope, not this time. Actually, he and his partner are providing a &quot;synthetizing on demand&quot; kind of service. Of #b#t2049100##k! By completing his quest, I am granted a fair amount of these scrolls. But LOOK AT THIS LIST:\\n\\n#i4032474# #t4032474# #c4032474# / #r5#k\\n#i4000046# #t4000046# #c4000046# / #r50#k\\n#i4000054# #t4000054# #c4000054# / #r50#k\\n#i4000135# #t4000135# #c4000135# / #r50#k\\n#i4000080# #t4000080# #c4000080# / #r50#k\\n#i4000151# #t4000151# #c4000151# / #r5#k\\n#i4000152# #t4000152# #c4000152# / #r5#k\\n#i4031906# #t4031906# #c4031906# / #r5#k\\n#i4000040# #t4000040# #c4000040# / #r2#k\\n#i4000176# #t4000176# #c4000176# / #r2#k\\n#i4000413# #t4000413# #c4000413# / #r2#k\\n#i4000414# #t4000414# #c4000414# / #r2#k\\n#i4031901# #t4031901# #c4031901# / #r2#k\\n#i4000224# #t4000224# #c4000224# / #r2#k\\n#i4000235# #t4000235# #c4000235# / #r2#k\\n#i4000243# #t4000243# #c4000243# / #r2#k\\n#i4000175# #t4000175# #c4000175# / #r2#k\\n#i4000138# #t4000138# #c4000138# / #r2#k\\n#i4011007# #t4011007# #c4011007# / #r2#k\\n#i4021009# #t4021009# #c4021009# / #r2#k\\n#i4005000# #t4005000# #c4005000# / #r5#k\\n#i4005001# #t4005001# #c4005001# / #r5#k\\n#i4005002# #t4005002# #c4005002# / #r5#k\\n#i4005003# #t4005003# #c4005003# / #r5#k\\n#i4005004# #t4005004# #c4005004# / #r5#k\\n#i4011000# #t4011000# #c4011000# / #r5#k\\n#i4011001# #t4011001# #c4011001# / #r5#k\\n#i4011002# #t4011002# #c4011002# / #r5#k\\n#i4011003# #t4011003# #c4011003# / #r5#k\\n#i4011004# #t4011004# #c4011004# / #r5#k\\n#i4011005# #t4011005# #c4011005# / #r5#k\\n#i4011006# #t4011006# #c4011006# / #r5#k\\n#i4021000# #t4021000# #c4021000# / #r5#k\\n#i4021001# #t4021001# #c4021001# / #r5#k\\n#i4021002# #t4021002# #c4021002# / #r5#k\\n#i4021003# #t4021003# #c4021003# / #r5#k\\n#i4021004# #t4021004# #c4021004# / #r5#k\\n#i4021005# #t4021005# #c4021005# / #r5#k\\n#i4021006# #t4021006# #c4021006# / #r5#k\\n#i4021007# #t4021007# #c4021007# / #r5#k\\n#i4021008# #t4021008# #c4021008# / #r5#k\\n#i1442030# #t1442030# #c1442030# / #r1#k\\n#i1002033# #t1002033# #c1002033# / #r1#k\\n#i1050132# #t1050132# #c1050132# / #r1#k\\n#i1082002# #t1082002# #c1082002# / #r1#k\\n#i1072169# #t1072169# #c1072169# / #r1#k\"/>\n     <string name=\"2\" value=\"Ace of Hearts helped me make these scrolls... Geez, that was hard. It is repeatable within 3 days, huh?\"/>\n     <int name=\"area\" value=\"50\"/>\n   </imgdir>"}, {"sha": "14f985fcd8757b33b9fa1ec926c6ced863c7e425", "filename": "wz/String.wz/Etc.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/94425ba616dacf61b156044ac3993e2d06584c8f/wz/String.wz/Etc.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/94425ba616dacf61b156044ac3993e2d06584c8f/wz/String.wz/Etc.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Etc.img.xml?ref=94425ba616dacf61b156044ac3993e2d06584c8f", "patch": "@@ -973,8 +973,8 @@\n       <string name=\"desc\" value=\"You can sell this envelope for 10,000 meso in the store.\"/>\n     </imgdir>\n     <imgdir name=\"4000175\">\n-      <string name=\"name\" value=\"Minature Pianus\"/>\n-      <string name=\"desc\" value=\"A miniature version of Pianus\"/>\n+      <string name=\"name\" value=\"Miniature Pianus\"/>\n+      <string name=\"desc\" value=\"A miniature version of Pianus.\"/>\n     </imgdir>\n     <imgdir name=\"4000176\">\n       <string name=\"name\" value=\"Poisonous Mushroom\"/>"}]}]},
