{"fetchDate": "2019-12-19", "content": [{"sha": "c1126213cc51831004c98121b0c738a67bae16e9", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YzExMjYyMTNjYzUxODMxMDA0Yzk4MTIxYjBjNzM4YTY3YmFlMTZlOQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-12-14T13:08:55Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-12-14T13:08:55Z"}, "message": "Server broadcastMessage to worlds & MapleQuestItemFetcher update\n\nFixed a bug with the map drop mechanics sometimes permitting over the max drop count in certain circumstances.\nFixed server broadcastMessage always broadcasting packets at world 0, even if the caller is from another world id.\nImproved the MapleQuestItemFetcher, now displaying expired quests alongside the reported info.", "tree": {"sha": "d795b7b04227aa2402a92749be6b2cc9b5eec375", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/d795b7b04227aa2402a92749be6b2cc9b5eec375"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/c1126213cc51831004c98121b0c738a67bae16e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c1126213cc51831004c98121b0c738a67bae16e9", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c1126213cc51831004c98121b0c738a67bae16e9", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c1126213cc51831004c98121b0c738a67bae16e9/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b141efdbf21adfcd0a7ec88652409705821be260", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b141efdbf21adfcd0a7ec88652409705821be260", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b141efdbf21adfcd0a7ec88652409705821be260"}], "stats": {"total": 182, "additions": 99, "deletions": 83}, "files": [{"sha": "1324c99121814f9472453af64c2c4390f4c4244e", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -720,5 +720,7 @@ Corrigido 3o job de Cygnus.\n Removido UI que aponta erroneamente \"Stat Upgrade\" nos n\ufffdveis 15, 20, 25 e 30.\n Adicionado comando \"droplimit\", cuja funcionalidade \ufffd informar ao jogador a quantidade de drops no mapa em contraste com o limite permitido.\n \n-11 Dezembro 2017,\n-Resolvido bug onde contador do drops do mapa n\ufffdo atualizaria seu valor em casos onde reatores consomem itens ou ao se aplicar comandos como \"cleardrops\".\n\\ No newline at end of file\n+11 - 12 Dezembro 2017,\n+Resolvido bug onde contador do drops do mapa n\ufffdo atualizaria seu valor em casos onde reatores consomem itens ou ao se aplicar comandos como \"cleardrops\".\n+Corrigido server enviando packets com BroadcastMessage somente para o world 0, ao inv\ufffds de ser para o world alvo.\n+MapleQuestItemFetcher agora mostra quests j\ufffd expiradas no relat\ufffdrio.\n\\ No newline at end of file"}, {"sha": "43096485095f874c679adf31b7950b791af1c8b4", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -6606,8 +6606,8 @@ public void run() {\n \n     public void sendPolice(String text) {\n         String message = getName() + \" received this - \" + text;\n-        if (Server.getInstance().isGmOnline()) { //Alert and log if a GM is online\n-            Server.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip(message));\n+        if (Server.getInstance().isGmOnline(this.getWorld())) { //Alert and log if a GM is online\n+            Server.getInstance().broadcastGMMessage(this.getWorld(), MaplePacketCreator.sendYellowTip(message));\n             FilePrinter.printError(\"autobanwarning.txt\", message + \"\\r\\n\");\n         } else { //Auto DC and log if no GM is online\n             client.disconnect(false, false);\n@@ -7656,7 +7656,8 @@ public void run() {\n                 client.disconnect(false, false);\n             }\n         }, 5000);\n-        Server.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, MapleCharacter.makeMapleReadable(this.name) + \" was autobanned for \" + reason));\n+        \n+        Server.getInstance().broadcastGMMessage(this.getWorld(), MaplePacketCreator.serverNotice(6, MapleCharacter.makeMapleReadable(this.name) + \" was autobanned for \" + reason));\n     }\n \n     public void block(int reason, int days, String desc) {"}, {"sha": "1d385a587a5168bb7ee6b81900739cb0c3852602", "filename": "src/client/autoban/AutobanFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/client/autoban/AutobanFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/client/autoban/AutobanFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/autoban/AutobanFactory.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -91,7 +91,7 @@ public void alert(MapleCharacter chr, String reason) {\n \t\tif (chr != null && MapleLogger.ignored.contains(chr.getName())){\n \t\t\treturn;\n \t\t}\n-\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip((chr != null ? MapleCharacter.makeMapleReadable(chr.getName()) : \"\") + \" caused \" + this.name() + \" \" + reason));\n+\t\tServer.getInstance().broadcastGMMessage((chr != null ? chr.getWorld() : 0), MaplePacketCreator.sendYellowTip((chr != null ? MapleCharacter.makeMapleReadable(chr.getName()) : \"\") + \" caused \" + this.name() + \" \" + reason));\n             }\n \t}\n \t"}, {"sha": "a13cb42af9acb4ab472dbd56fb6a936ca30ab444", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -551,8 +551,8 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n \t\t\t\tbreak;\n \t\t\t}\n \t\t\tString message = joinStringFrom(sub, 1);\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip(\"[GM MESSAGE]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(1, message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[GM MESSAGE]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(1, message));\n \t\t\tFilePrinter.printError(\"gm.txt\", MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message + \"\\r\\n\");\n \t\t\tplayer.dropMessage(5, \"Your message '\" + message + \"' was sent to GMs.\");\n \t\t\tplayer.dropMessage(5, tips[Randomizer.nextInt(tips.length)]);\n@@ -565,8 +565,8 @@ public static boolean executeHeavenMsCommandLv0(Channel cserv, Server srv, Maple\n \t\t\t\tbreak;\n \t\t\t}\n \t\t\tmessage = joinStringFrom(sub, 1);\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip(\"[BUG]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(1, message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[BUG]:\" + MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(1, message));\n \t\t\tFilePrinter.printError(\"bug.txt\", MapleCharacter.makeMapleReadable(player.getName()) + \": \" + message + \"\\r\\n\");\n \t\t\tplayer.dropMessage(5, \"Your bug '\" + message + \"' was submitted successfully to our developers. Thank you!\");\n \t\t\tbreak;\n@@ -881,7 +881,7 @@ public static boolean executeHeavenMsCommandLv2(Channel cserv, Server srv, Maple\n                                 \n                                 if(victim != null) {\n                                         victim.getMap().spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(9300166), victim.getPosition());\n-                                        Server.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(5, player.getName() + \" used !bomb on \" + victim.getName()));\n+                                        Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, player.getName() + \" used !bomb on \" + victim.getName()));\n                                 } else {\n                                         player.message(\"Player '\" + sub[1] + \"' could not be found on this world.\");\n                                 }\n@@ -1598,7 +1598,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\t}\n \t\t\tplayer.yellowMessage(victim.getName() + \" is \" + (!monitored ? \"now being monitored.\" : \"no longer being monitored.\"));\n \t\t\tString message = player.getName() + (!monitored ? \" has started monitoring \" : \" has stopped monitoring \") + victim.getName() + \".\";\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(5, message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, message));\n                     break;\n                     \n \t\tcase \"monitors\":\n@@ -1625,7 +1625,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\t}\n \t\t\tplayer.yellowMessage(victim.getName() + \" is \" + (!monitored_ ? \"now being ignored.\" : \"no longer being ignored.\"));\n \t\t\tString message_ = player.getName() + (!monitored_ ? \" has started ignoring \" : \" has stopped ignoring \") + victim.getName() + \".\";\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(5, message_));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, message_));\n                     break;\n                     \n \t\tcase \"ignored\":\n@@ -1754,7 +1754,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n                     break;\n                     \n \t\tcase \"expeds\":\n-\t\t\tfor (Channel ch : Server.getInstance().getChannelsFromWorld(0)) {\n+\t\t\tfor (Channel ch : Server.getInstance().getChannelsFromWorld(c.getWorld())) {\n \t\t\t\tif (ch.getExpeditions().size() == 0) {\n \t\t\t\t\tplayer.yellowMessage(\"No Expeditions in Channel \" + ch.getId());\n \t\t\t\t\tcontinue;\n@@ -1789,7 +1789,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n                         victim = cserv.getPlayerStorage().getCharacterByName(sub[1]);\n                         if(victim != null) {\n                                 victim.setHpMp(0);\n-                                Server.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(5, player.getName() + \" used !kill on \" + victim.getName()));\n+                                Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, player.getName() + \" used !kill on \" + victim.getName()));\n                         } else {\n                                 player.message(\"Player '\" + sub[1] + \"' could not be found on this channel.\");\n                         }\n@@ -1831,11 +1831,11 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n                     break;\n            \n \t\tcase \"notice\":\n-\t\t\tServer.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(6, \"[Notice] \" + joinStringFrom(sub, 1)));\n+\t\t\tServer.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, \"[Notice] \" + joinStringFrom(sub, 1)));\n                     break;\n                     \n \t\tcase \"rip\":\n-\t\t\tServer.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(6, \"[RIP]: \" + joinStringFrom(sub, 1)));\n+\t\t\tServer.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, \"[RIP]: \" + joinStringFrom(sub, 1)));\n                     break;\n                     \n \t\tcase \"openportal\":\n@@ -1964,10 +1964,10 @@ public void run() {\n \t\t\t\t\t\trip.getClient().disconnect(false, false);\n \t\t\t\t\t}\n \t\t\t\t}, 5000); //5 Seconds\n-\t\t\t\tServer.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(6, \"[RIP]: \" + ign + \" has been banned.\"));\n+\t\t\t\tServer.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, \"[RIP]: \" + ign + \" has been banned.\"));\n \t\t\t} else if (MapleCharacter.ban(ign, reason, false)) {\n \t\t\t\tc.announce(MaplePacketCreator.getGMEffect(4, (byte) 0));\n-\t\t\t\tServer.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(6, \"[RIP]: \" + ign + \" has been banned.\"));\n+\t\t\t\tServer.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, \"[RIP]: \" + ign + \" has been banned.\"));\n \t\t\t} else {\n \t\t\t\tc.announce(MaplePacketCreator.getGMEffect(6, (byte) 1));\n \t\t\t}\n@@ -2513,7 +2513,7 @@ public static boolean executeHeavenMsCommandLv6(Channel cserv, Server srv, Maple\n \t\t\t\t}\n \t\t\t}\n \t\t\tString message = player.getName() + \" used !saveall.\";\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(5, message));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(5, message));\n \t\t\tplayer.message(\"All players saved successfully.\");\n \t\t\tbreak;\n                     "}, {"sha": "0282c68fbe3c36b9e402a1a8d79b32e59fed00bc", "filename": "src/net/server/Server.java", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -688,20 +688,20 @@ public void reloadGuildCharacters(int world) {\n         worlda.reloadGuildSummary();\n     }\n \n-    public void broadcastMessage(final byte[] packet) {\n-        for (Channel ch : getChannelsFromWorld(0)) {\n+    public void broadcastMessage(int world, final byte[] packet) {\n+        for (Channel ch : getChannelsFromWorld(world)) {\n             ch.broadcastPacket(packet);\n         }\n     }\n \n-    public void broadcastGMMessage(final byte[] packet) {\n-        for (Channel ch : getChannelsFromWorld(0)) {\n+    public void broadcastGMMessage(int world, final byte[] packet) {\n+        for (Channel ch : getChannelsFromWorld(world)) {\n             ch.broadcastGMPacket(packet);\n         }\n     }\n     \n-    public boolean isGmOnline() {\n-        for (Channel ch : getChannelsFromWorld(0)) {\n+    public boolean isGmOnline(int world) {\n+        for (Channel ch : getChannelsFromWorld(world)) {\n         \tfor (MapleCharacter player : ch.getPlayerStorage().getAllCharacters()) {\n         \t\tif (player.isGM()){\n         \t\t\treturn true;"}, {"sha": "1d40cf261aea0ded3e5cd73df289b42bb96c0355", "filename": "src/net/server/channel/handlers/ItemRewardHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/ItemRewardHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/ItemRewardHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ItemRewardHandler.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -67,7 +67,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     String msg = reward.worldmsg;\n                     msg.replaceAll(\"/name\", c.getPlayer().getName());\n                     msg.replaceAll(\"/item\", ii.getName(reward.itemid));\n-                    Server.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(6, msg));\n+                    Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, msg));\n                 }\n                 break;\n             }"}, {"sha": "1446ea5e9b15730812023f1dd8d4d85ddcf23323", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -281,7 +281,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n                     */\n             if (player.isGM()){\n-            \tServer.getInstance().broadcastGMMessage(MaplePacketCreator.earnTitleMessage((player.gmLevel() < 6 ? \"GM \" : \"Admin \") + player.getName() + \" has logged in\"));\n+            \tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.earnTitleMessage((player.gmLevel() < 6 ? \"GM \" : \"Admin \") + player.getName() + \" has logged in\"));\n             }\n             \n         }"}, {"sha": "17a28596d47a07f447ebc832529c4fb55b2b0239", "filename": "src/net/server/channel/handlers/ReportHandler.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/ReportHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/ReportHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ReportHandler.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -58,7 +58,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\tc.announce(MaplePacketCreator.reportResponse((byte) 2));\n \t\t\t\treturn;\n \t\t\t}\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, victim + \" was reported for: \" + description));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, victim + \" was reported for: \" + description));\n \t\t\taddReport(c.getPlayer().getId(), MapleCharacter.getIdByName(victim), 0, description, null);\n \t\t} else if (type == 1) {\n \t\t\tString chatlog = slea.readMapleAsciiString();\n@@ -74,10 +74,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\t\treturn;\n \t\t\t\t}\n \t\t\t}\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, victim + \" was reported for: \" + description));\n-\t\t\taddReport(c.getPlayer().getId() ,MapleCharacter.getIdByName(victim), reason, description, chatlog);\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, victim + \" was reported for: \" + description));\n+\t\t\taddReport(c.getPlayer().getId(), MapleCharacter.getIdByName(victim), reason, description, chatlog);\n \t\t} else {\n-\t\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, c.getPlayer().getName() + \" is probably packet editing. Got unknown report type, which is impossible.\"));\n+\t\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.serverNotice(6, c.getPlayer().getName() + \" is probably packet editing. Got unknown report type, which is impossible.\"));\n \t\t}\n \t}\n "}, {"sha": "72702717843f1a4b29f96822f682c2dd35756719", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -277,7 +277,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     }\n                     break;\n                 case 2: // Super megaphone\n-                    Server.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(3, c.getChannel(), medal + player.getName() + \" : \" + slea.readMapleAsciiString(), (slea.readByte() != 0)));\n+                    Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(3, c.getChannel(), medal + player.getName() + \" : \" + slea.readMapleAsciiString(), (slea.readByte() != 0)));\n                     break;\n                 case 5: // Maple TV\n                     int tvType = itemId % 10;\n@@ -309,7 +309,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     }\n                     slea.readInt();\n                     if (megassenger) {\n-                        Server.getInstance().broadcastMessage(MaplePacketCreator.serverNotice(3, c.getChannel(), medal + player.getName() + \" : \" + builder.toString(), ear));\n+                        Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.serverNotice(3, c.getChannel(), medal + player.getName() + \" : \" + builder.toString(), ear));\n                     }\n                     if (!MapleTVEffect.isActive()) {\n                         new MapleTVEffect(player, victim, messages, tvType);\n@@ -334,7 +334,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             return;\n                         }\n                     }\n-                    Server.getInstance().broadcastMessage(MaplePacketCreator.itemMegaphone(msg, whisper, c.getChannel(), item));\n+                    Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.itemMegaphone(msg, whisper, c.getChannel(), item));\n                     break;\n                 case 7: //triple megaphone\n                     int lines = slea.readByte();\n@@ -347,7 +347,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         msg2[i] = medal + c.getPlayer().getName() + \" : \" + slea.readMapleAsciiString();\n                     }\n                     whisper = slea.readByte() == 1;\n-                    Server.getInstance().broadcastMessage(MaplePacketCreator.getMultiMegaphone(msg2, c.getChannel(), whisper));\n+                    Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.getMultiMegaphone(msg2, c.getChannel(), whisper));\n                     break;\n             }\n             remove(c, itemId);\n@@ -475,11 +475,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             for (int i = 0; i < 4; i++) {\n                 lines.add(slea.readMapleAsciiString());\n             }\n-            Server.getInstance().broadcastMessage(MaplePacketCreator.getAvatarMega(c.getPlayer(), medal, c.getChannel(), itemId, lines, (slea.readByte() != 0)));\n+            \n+            final int world = c.getWorld();\n+            Server.getInstance().broadcastMessage(world, MaplePacketCreator.getAvatarMega(c.getPlayer(), medal, c.getChannel(), itemId, lines, (slea.readByte() != 0)));\n             TimerManager.getInstance().schedule(new Runnable() {\n             \t@Override\n             \tpublic void run() {\n-            \t\tServer.getInstance().broadcastMessage(MaplePacketCreator.byeAvatarMega());\n+            \t\tServer.getInstance().broadcastMessage(world, MaplePacketCreator.byeAvatarMega());\n             \t}\n             }, 1000 * 10);\n             remove(c, itemId);"}, {"sha": "010126b2494d03f8202f5d8bec90d4e8ef6eb47b", "filename": "src/net/server/handlers/login/CreateCharHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/handlers/login/CreateCharHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/net/server/handlers/login/CreateCharHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CreateCharHandler.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -131,6 +131,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\treturn;\n \t\t}\n \t\tc.announce(MaplePacketCreator.addNewCharEntry(newchar));\n-\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip(\"[NEW CHAR]: \" + c.getAccountName() + \" has created a new character with IGN \" + name));\n+\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[NEW CHAR]: \" + c.getAccountName() + \" has created a new character with IGN \" + name));\n \t}\n }\n\\ No newline at end of file"}, {"sha": "090d0631949695466f9d0aaf33f6ba6e7ad823c3", "filename": "src/scripting/npc/NPCConversationManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/scripting/npc/NPCConversationManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/scripting/npc/NPCConversationManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/npc/NPCConversationManager.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -385,7 +385,7 @@ public void doGachapon() {\n \t\tLogHelper.logGacha(getPlayer(), item.getId(), map);\n \t\t\n \t\tif (item.getTier() > 0){ //Uncommon and Rare\n-\t\t\tServer.getInstance().broadcastMessage(MaplePacketCreator.gachaponMessage(itemGained, map, getPlayer()));\n+\t\t\tServer.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.gachaponMessage(itemGained, map, getPlayer()));\n \t\t}\n \t}\n         "}, {"sha": "20cc979404ca6f4c5b133dd1e43a57a4a3af84d3", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -1488,7 +1488,7 @@ public boolean canWearEquipment(MapleCharacter chr, Equip equip, int dst) {\n         if (!EquipSlot.getFromTextSlot(islot).isAllowed(dst, isCash(id))) {\n             equip.wear(false);\n             String itemName = MapleItemInformationProvider.getInstance().getName(equip.getItemId());\n-            Server.getInstance().broadcastGMMessage(MaplePacketCreator.sendYellowTip(\"[WARNING]: \" + chr.getName() + \" tried to equip \" + itemName + \" into slot \" + dst + \".\"));\n+            Server.getInstance().broadcastGMMessage(chr.getWorld(), MaplePacketCreator.sendYellowTip(\"[WARNING]: \" + chr.getName() + \" tried to equip \" + itemName + \" into slot \" + dst + \".\"));\n             AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to forcibly equip an item.\");\n             FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to equip \" + itemName + \" into \" + dst + \" slot.\\r\\n\");      \t\n             return false;"}, {"sha": "2b863433236b08a1be6ade3f1218698bff29021e", "filename": "src/server/expeditions/MapleExpedition.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/server/expeditions/MapleExpedition.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/server/expeditions/MapleExpedition.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpedition.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -133,7 +133,7 @@ public void start(){\n \t\tbroadcastExped(MaplePacketCreator.removeClock());\n \t\tbroadcastExped(MaplePacketCreator.serverNotice(6, \"[Expedition] The expedition has started! Good luck, brave heroes!\"));\n \t\tstartTime = System.currentTimeMillis();\n-\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, \"[Expedition] \" + type.toString() + \" Expedition started with leader: \" + leader.getName()));\n+\t\tServer.getInstance().broadcastGMMessage(leader.getWorld(), MaplePacketCreator.serverNotice(6, \"[Expedition] \" + type.toString() + \" Expedition started with leader: \" + leader.getName()));\n \t}\n \n \tpublic String addMember(MapleCharacter player) {"}, {"sha": "0ef92dc95013e6a84f0295dc013bb18748e5826c", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -708,21 +708,22 @@ public int getDroppedItemCount() {\n         return droppedItemCount.get();\n     }\n     \n-    private void instantiateItemDrop(MapleMapItem mdrop) {\n+    private synchronized void instantiateItemDrop(MapleMapItem mdrop) {\n         if(droppedItemCount.get() >= ServerConstants.ITEM_LIMIT_ON_MAP) {\n             MapleMapObject mapobj;\n             \n-            objectWLock.lock();\n-            try {\n-                mapobj = registeredDrops.remove(0).get();\n-                while(mapobj == null) {\n+            do {\n+                objectWLock.lock();\n+                try {\n                     mapobj = registeredDrops.remove(0).get();\n+                    while(mapobj == null) {\n+                        if(registeredDrops.isEmpty()) break;\n+                        mapobj = registeredDrops.remove(0).get();\n+                    }\n+                } finally {\n+                    objectWLock.unlock();\n                 }\n-            } finally {\n-                objectWLock.unlock();\n-            }\n-\n-            makeDisappearItemFromMap(mapobj);\n+            } while (!makeDisappearItemFromMap(mapobj));\n         }\n         \n         objectWLock.lock();\n@@ -2806,24 +2807,30 @@ public MapleCharacter getCharacterByName(String name) {\n         return null;\n     }\n     \n-    public void makeDisappearItemFromMap(MapleMapObject mapobj) {\n+    public boolean makeDisappearItemFromMap(MapleMapObject mapobj) {\n         if(mapobj instanceof MapleMapItem) {\n-            makeDisappearItemFromMap((MapleMapItem) mapobj);\n+            return makeDisappearItemFromMap((MapleMapItem) mapobj);\n+        } else {\n+            return mapobj == null;  // no drop to make disappear...\n         }\n     }\n     \n-    public void makeDisappearItemFromMap(MapleMapItem mapitem) {\n+    public boolean makeDisappearItemFromMap(MapleMapItem mapitem) {\n         if (mapitem != null && mapitem == getMapObject(mapitem.getObjectId())) {\n             mapitem.lockItem();\n             try {\n                 if (mapitem.isPickedUp()) {\n-                    return;\n+                    return true;\n                 }\n+                \n                 MapleMap.this.pickItemDrop(MaplePacketCreator.removeItemFromMap(mapitem.getObjectId(), 0, 0), mapitem);\n+                return true;\n             } finally {\n                 mapitem.unlockItem();\n             }\n         }\n+        \n+        return false;\n     }\n \n     private class ActivateItemReactor implements Runnable {"}, {"sha": "f11d3090df436be05a5d9fe7d73e0137adb3b5ef", "filename": "src/server/maps/MapleTVEffect.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/server/maps/MapleTVEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/server/maps/MapleTVEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleTVEffect.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -57,8 +57,8 @@ private void broadcastTV(boolean activity) {\n \t\tServer server = Server.getInstance();\n \t\tACTIVE = activity;\n \t\tif (ACTIVE) {\n-\t\t\tserver.broadcastMessage(MaplePacketCreator.enableTV());\n-\t\t\tserver.broadcastMessage(MaplePacketCreator.sendTV(user, message, type <= 2 ? type : type - 3, partner));\n+\t\t\tserver.broadcastMessage(user.getWorld(), MaplePacketCreator.enableTV());\n+\t\t\tserver.broadcastMessage(user.getWorld(), MaplePacketCreator.sendTV(user, message, type <= 2 ? type : type - 3, partner));\n \t\t\tint delay = 15000;\n \t\t\tif (type == 4) {\n \t\t\t\tdelay = 30000;\n@@ -72,7 +72,7 @@ public void run() {\n \t\t\t\t}\n \t\t\t}, delay);\n \t\t} else {\n-\t\t\tserver.broadcastMessage(MaplePacketCreator.removeTV());\n+\t\t\tserver.broadcastMessage(user.getWorld(), MaplePacketCreator.removeTV());\n \t\t}\n \t}\n }"}, {"sha": "39903c36982d50b93fbf1d2140d1b30afa162377", "filename": "src/tools/LogHelper.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/src/tools/LogHelper.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/src/tools/LogHelper.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/LogHelper.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -36,7 +36,7 @@ public static void logTrade(MapleTrade trade1, MapleTrade trade2) {\n \t}\n \n \tpublic static void logExpedition(MapleExpedition expedition) {\n-\t\tServer.getInstance().broadcastGMMessage(MaplePacketCreator.serverNotice(6, expedition.getType().toString() + \" Expedition with leader \" + expedition.getLeader().getName() + \" finished after \" + getTimeString(expedition.getStartTime())));\n+\t\tServer.getInstance().broadcastGMMessage(expedition.getLeader().getWorld(), MaplePacketCreator.serverNotice(6, expedition.getType().toString() + \" Expedition with leader \" + expedition.getLeader().getName() + \" finished after \" + getTimeString(expedition.getStartTime())));\n \n \t\tString log = expedition.getType().toString() + \" EXPEDITION\\r\\n\";\n \t\tlog += getTimeString(expedition.getStartTime()) + \"\\r\\n\";"}, {"sha": "eecb39f117b1348fc8034a4f2c7f0d8ee3d07d60", "filename": "tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/dist/MapleQuestItemFetcher.jar?ref=c1126213cc51831004c98121b0c738a67bae16e9"}, {"sha": "23c39d930f18e6301c301af8bef34737696c0665", "filename": "tools/MapleQuestItemFetcher/lib/QuestReport.txt", "status": "modified", "additions": 3, "deletions": 15, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/lib/QuestReport.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/lib/QuestReport.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/lib/QuestReport.txt?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -29,6 +29,7 @@ INCORRECT QUESTIDS ON DB\n 4031860 : 6944 -> 6945\n 4031861 : 6944 -> 6945\n 4031871 : 6350 -> 28344\n+4032324 : 21736 -> 21737\n 4032339 : 0 -> 21303\n \n \n@@ -110,7 +111,7 @@ ITEMS WITH NO QUEST DROP DATA ON DB\n 4031220 - 9210\n 4031225 - 3606\n 4031226 - 9321\n-4031227 - 4103\n+4031227 - 4103 EXPIRED\n 4031230 - 3619\n 4031231 - 3620\n 4031235 - 3607\n@@ -233,6 +234,7 @@ ITEMS WITH NO QUEST DROP DATA ON DB\n 4031812 - 4950\n 4031833 - 9946\n 4031837 - 9945\n+4031839 - 2162\n 4031881 - 4484\n 4031894 - 2214\n 4031921 - 4646\n@@ -288,8 +290,6 @@ ITEMS WITH NO QUEST DROP DATA ON DB\n 4032318 - 21718\n 4032319 - 21723\n 4032321 - 21727\n-4032322 - 21731\n-4032324 - 21737\n 4032325 - 21752\n 4032326 - 21752\n 4032331 - 21601\n@@ -313,13 +313,7 @@ ITEMS WITH NO QUEST DROP DATA ON DB\n 4032437 - 28321\n 4032443 - 28317\n 4032496 - 28238\n-4032511 - 3718\n 4032512 - 3720\n-4032513 - 3722\n-4032514 - 3727\n-4032516 - 3735\n-4032517 - 3740\n-4032518 - 3743\n 4161000 - 9322\n \n \n@@ -340,12 +334,6 @@ COMPLETE QUEST ITEMS WITH ZERO QUANTITY\n 2054:\n   4031028\n \n-2162:\n-  4031839\n-\n-2164:\n-  4031840\n-\n 2167:\n   4031841\n "}, {"sha": "531edc4876e7938fbc40bda23d4e3eb2945af46a", "filename": "tools/MapleQuestItemFetcher/nbproject/private/private.xml", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/nbproject/private/private.xml?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -2,6 +2,8 @@\n <project-private xmlns=\"http://www.netbeans.org/ns/project-private/1\">\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n-        <group/>\n+        <group>\n+            <file>file:/C:/Nexon/MapleSolaxia/HeavenMS/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java</file>\n+        </group>\n     </open-files>\n </project-private>"}, {"sha": "8231c3858522064481c94128ac3f23e393aaa2f1", "filename": "tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c1126213cc51831004c98121b0c738a67bae16e9/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemFetcher/src/maplequestitemfetcher/MapleQuestItemFetcher.java?ref=c1126213cc51831004c98121b0c738a67bae16e9", "patch": "@@ -61,7 +61,7 @@ This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n  * \n  * Running it should generate a report file under \"lib\" folder with the search results.\n  * \n- * Estimated parse time: 1.5 minute\n+ * Estimated parse time: 1 minute\n  */\n public class MapleQuestItemFetcher {\n     static MapleItemInformationProvider ii;\n@@ -91,6 +91,7 @@ This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n     static Map<Integer, Set<Integer>> zeroedStartQuestItems = new HashMap<>();\n     static Map<Integer, Set<Integer>> zeroedCompleteQuestItems = new HashMap<>();\n     static Map<Integer, int[]> mixedQuestidItems = new HashMap<>();\n+    static Set<Integer> limitedQuestids = new HashSet<>();\n     \n     static byte status = 0;\n     static int questId = -1;\n@@ -103,11 +104,13 @@ private static String getName(String token) {\n         int i, j;\n         char[] dest;\n         String d;\n-\n+        \n         i = token.lastIndexOf(\"name\");\n         i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n         j = token.indexOf(\"\\\"\", i);     //upper bound\n \n+        if(j < i) return \"0\";           //node value containing 'name' in it's scope, cheap fix since we don't deal with strings anyway\n+        \n         dest = new char[initialStringLength];\n         token.getChars(i, j, dest, 0);\n \n@@ -245,8 +248,15 @@ else if(status == 3) {\n             }\n \n             status += 1;\n-        }\n+        } else {\n+            if(status == 3) {\n+                d = getName(token);\n \n+                if(d.equals(\"end\")) {\n+                    limitedQuestids.add(questId);\n+                }\n+            }\n+        }\n     }\n \n     private static void calculateQuestItemDiff() {\n@@ -414,6 +424,10 @@ public int compare(Pair<Integer, List<Integer>> o1, Pair<Integer, List<Integer>>\n         return list;\n     }\n     \n+    private static String getExpiredStringLabel(int questid) {\n+        return (!limitedQuestids.contains(questid) ? \"\" : \" EXPIRED\");\n+    }\n+    \n     private static void ReportQuestItemData() {\n         // This will reference one line at a time\n         String line = null;\n@@ -460,7 +474,7 @@ private static void ReportQuestItemData() {\n                 printWriter.println(\"INCORRECT QUESTIDS ON DB\");\n                 for(Entry<Integer, int[]> emqi : getSortedMapEntries1(mixedQuestidItems)) {\n                     int[] mqi = emqi.getValue();\n-                    printWriter.println(mqi[0] + \" : \" + mqi[1] + \" -> \" + mqi[2]);\n+                    printWriter.println(mqi[0] + \" : \" + mqi[1] + \" -> \" + mqi[2] + getExpiredStringLabel(mqi[2]));\n                 }\n                 printWriter.println(\"\\n\\n\\n\\n\\n\");\n             }\n@@ -473,7 +487,7 @@ private static void ReportQuestItemData() {\n                 \n                 printWriter.println(\"ITEMS WITH NO QUEST DROP DATA ON DB\");\n                 for(Entry<Integer, Integer> iwq : getSortedMapEntries0(mapIwq)) {\n-                    printWriter.println(iwq.getKey() + \" - \" + iwq.getValue());\n+                    printWriter.println(iwq.getKey() + \" - \" + iwq.getValue() + getExpiredStringLabel(iwq.getValue()));\n                 }\n                 printWriter.println(\"\\n\\n\\n\\n\\n\");\n             }\n@@ -482,7 +496,7 @@ private static void ReportQuestItemData() {\n                 if(!zeroedStartQuestItems.isEmpty()) {\n                     printWriter.println(\"START QUEST ITEMS WITH ZERO QUANTITY\");\n                     for(Pair<Integer, List<Integer>> iwq : getSortedMapEntries2(zeroedStartQuestItems)) {\n-                        printWriter.println(iwq.getLeft() + \":\");\n+                        printWriter.println(iwq.getLeft() + getExpiredStringLabel(iwq.getLeft()) + \":\");\n                         for(Integer i : iwq.getRight()) {\n                             printWriter.println(\"  \" + i);\n                         }\n@@ -494,7 +508,7 @@ private static void ReportQuestItemData() {\n                 if(!zeroedCompleteQuestItems.isEmpty()) {\n                     printWriter.println(\"COMPLETE QUEST ITEMS WITH ZERO QUANTITY\");\n                     for(Pair<Integer, List<Integer>> iwq : getSortedMapEntries2(zeroedCompleteQuestItems)) {\n-                        printWriter.println(iwq.getLeft() + \":\");\n+                        printWriter.println(iwq.getLeft() + getExpiredStringLabel(iwq.getLeft()) + \":\");\n                         for(Integer i : iwq.getRight()) {\n                             printWriter.println(\"  \" + i);\n                         }"}]}]},
