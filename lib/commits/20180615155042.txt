{"fetchDate": "2019-12-19", "content": [{"sha": "c4d6531177c45bedb5f36db2b96d41e3286b9789", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YzRkNjUzMTE3N2M0NWJlZGI1ZjM2ZGIyYjk2ZDQxZTMyODZiOTc4OQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-06-15T15:50:42Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-06-15T15:50:42Z"}, "message": "Show HH/CT damage + Miniroom patch + Removed redundant skillbook drops\n\nAdded a server flag to allow solo expeditions.\nAdded a server flag that allows short-lengthened cooldown on Hero's Will skill.\nAdded recipes for Advanced Mob Crystal 2 and 3 (level 120 and 130) within Etc Maker.\nFixed Heaven's Hammer and Combo Tempest not displaying damage dealt value.\nFixed some minor PE exploits with players being allowed to create minirooms while dead or inside an event.\nAdjusted item dropped from mobs to now allow visible quest items appear before not-visible ones, thus showing no \"empty spaces\" when the mob has multiple quest drops.\nFixed Horntail not attributing quest progress for \"The Last Hour of Horntail\" quest. Attribution only happens inside the expedition.\nRemoved unnecessary skill books from the drop data, since quests for them were recently implemented.", "tree": {"sha": "741ef5d2088d1662c7cc55c5a2c7a7a7a866f6d6", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/741ef5d2088d1662c7cc55c5a2c7a7a7a866f6d6"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/c4d6531177c45bedb5f36db2b96d41e3286b9789", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c4d6531177c45bedb5f36db2b96d41e3286b9789", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c4d6531177c45bedb5f36db2b96d41e3286b9789", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c4d6531177c45bedb5f36db2b96d41e3286b9789/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dddfdcf315ed69d3c599b4658bb0f0e72865d118", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/dddfdcf315ed69d3c599b4658bb0f0e72865d118", "html_url": "https://github.com/ronancpl/HeavenMS/commit/dddfdcf315ed69d3c599b4658bb0f0e72865d118"}], "stats": {"total": 829, "additions": 727, "deletions": 102}, "files": [{"sha": "abb0fd94ed9e4c0d872ef72b5a632adc49100858", "filename": "docs/issues.txt", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/docs/issues.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/docs/issues.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/issues.txt?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -20,6 +20,7 @@ Missing features list:\n - Change name/World transfer.\n - Some pirate skills doesn't work for 3rd parties.\n - Medal quests.\n+- Cache frequently used SQL data.\n ---------------------------\n \n "}, {"sha": "2b9d973b386e5c66e8e06ac206055defdfc34d8e", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -1039,4 +1039,14 @@ Corrigido battleship n\u00e3o dando buffs na defesa corretamente.\n 11 - 12 Junho 2018,\n Adicionado efeito do us\u00e1vel Happy Birthday pra todos no mapa.\n Implementado HolidayPQ.\n-Adicionado sistema de sandbox para itens.\n\\ No newline at end of file\n+Adicionado sistema de sandbox para itens.\n+\n+13 - 14 Junho 2018,\n+Adicionado novo server flag para permitir criar expedi\u00e7\u00f5es solo.\n+Adicionado novo server flag para cooldown reduzido no Hero's Will.\n+Adicionado recipes para forjar Mob Crystal lv120 e 130 pelo Maker, usando Maple Leaf e vers\u00e3o de cristal anterior.\n+Corrigido Heaven's Hammer e Combo Tempest n\u00e3o mostrando dano aos jogadores.\n+Corrigido exploit onde jogadores poderiam criar minirooms em certos casos onde os mesmos n\u00e3o poderiam faz\u00ea-lo.\n+Quest itens dropados de mobs que n\u00e3o vis\u00edveis pelo jogador atacante agora s\u00e3o mostrados mais nas pontas, de forma que o conjunto de drops agora aparente n\u00e3o ter espa\u00e7o com itens invis\u00edveis no meio.\n+Corrigido Horntail n\u00e3o atruibuindo quest progress corretamente para a quest The Last Hour of Horntail.\n+Removido skill books agora desnecess\u00e1rios do drop data, uma vez que j\u00e1 foi implementado as quests para conseguir elas.\n\\ No newline at end of file"}, {"sha": "b85b44aef9c7cb0a1cededb347654b716fdd19fa", "filename": "scripts/event/Aran_3rdmount.js", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/event/Aran_3rdmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/event/Aran_3rdmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_3rdmount.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -92,7 +92,11 @@ function clearPQ(eim) {\n     em.setProperty(\"noEntry\",\"false\");\n }\n \n-function monsterKilled(mob, eim) {}\n+function monsterKilled(mob, eim) {\n+    if(eim.getInstanceMap(entryMap).countMonsters() == 0) {\n+        eim.showClearEffect();\n+    }\n+}\n \n function monsterValue(eim, mobId) {\n         return 1;"}, {"sha": "732015e7bb96b371d8226cefc70bf290b295e67d", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -214,6 +214,7 @@ function monsterKilled(mob, eim) {\n         eim.showClearEffect(mob.getMap().getId());\n         eim.clearPQ();\n         \n+        eim.dispatchUpdateQuestMobCount(8810018, 240060200);\n         mob.getMap().broadcastHorntailVictory();\n     } else if(isHorntailHead(mob)) {\n         var killed = eim.getIntProperty(\"defeatedHead\");"}, {"sha": "41f43aa71e238f2b2cde321608702cea5515ead8", "filename": "scripts/npc/2020008.js", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020008.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -54,7 +54,15 @@ function start() {\n         return;\n     }\n     \n-    if (!(cm.getPlayer().getLevel() >= 70 && parseInt(cm.getJobId() / 100) == 1)){\n+    var jobBase = parseInt(cm.getJobId() / 100);\n+    var jobStyle = 1;\n+    if (!(cm.getPlayer().getLevel() >= 70 && jobBase == jobStyle)){\n+        if(cm.getPlayer().getLevel() >= 70 && jobBase % 10 == jobStyle) {\n+            status++;\n+            action(1, 0, 1);\n+            return;\n+        }\n+        \n         cm.sendNext(\"Hi there.\");\n         cm.dispose();\n         return;\n@@ -134,6 +142,7 @@ function action(mode, type, selection){\n             if (cm.getPlayer().getLevel() >= 50){\n             \tcm.sendNext(\"Ok, go.\");\n                 if(!cm.isQuestStarted(100200)) cm.startQuest(100200);\n+                if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS && !cm.isQuestCompleted(100201)) cm.completeQuest(100201);\n             }else\n                 cm.sendNext(\"You're weak.\");\n             cm.dispose();"}, {"sha": "a118b1a7b9979c80a85f0dc772ce7dc4eaf31db0", "filename": "scripts/npc/2020009.js", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020009.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -26,11 +26,19 @@ var sel;\n actionx = {\"Mental\" : false, \"Physical\" : false};\n \n function start() {\n-    if (!(cm.getPlayer().getLevel() >= 70 && parseInt(cm.getJobId() / 100) == 2)){\n-\t    cm.sendNext(\"Hi there.\");\n-\t\tcm.dispose();\n-\t\treturn;\n-\t}\n+    var jobBase = parseInt(cm.getJobId() / 100);\n+    var jobStyle = 2;\n+    if (!(cm.getPlayer().getLevel() >= 70 && jobBase == jobStyle)){\n+        if(cm.getPlayer().getLevel() >= 70 && jobBase % 10 == jobStyle) {\n+            status++;\n+            action(1, 0, 1);\n+            return;\n+        }\n+        \n+        cm.sendNext(\"Hi there.\");\n+        cm.dispose();\n+        return;\n+    }\n     if (cm.haveItem(4031058))\n \t    actionx[\"Mental\"] = true;\n \telse if (cm.haveItem(4031057))\n@@ -106,6 +114,7 @@ function action(mode, type, selection){\n                 if (cm.getPlayer().getLevel() >= 50){\n             \t    cm.sendNext(\"Ok, go.\");\n                     if(!cm.isQuestStarted(100200)) cm.startQuest(100200);\n+                    if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS && !cm.isQuestCompleted(100201)) cm.completeQuest(100201);\n                 }else\n                     cm.sendNext(\"You're weak.\");\n                 cm.dispose();"}, {"sha": "ad882702c6e1db929fe14fd874df5a6b1005225e", "filename": "scripts/npc/2020010.js", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020010.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -28,11 +28,19 @@ var sel;\n actionx = {\"Mental\" : false, \"Physical\" : false};\n \n function start() {\n-    if (!(cm.getPlayer().getLevel() >= 70 && parseInt(cm.getJobId() / 100) == 3)){\n-\t    cm.sendNext(\"Hi there.\");\n-\t\tcm.dispose();\n-\t\treturn;\n-\t}\n+    var jobBase = parseInt(cm.getJobId() / 100);\n+    var jobStyle = 3;\n+    if (!(cm.getPlayer().getLevel() >= 70 && jobBase == jobStyle)){\n+        if(cm.getPlayer().getLevel() >= 70 && jobBase % 10 == jobStyle) {\n+            status++;\n+            action(1, 0, 1);\n+            return;\n+        }\n+        \n+        cm.sendNext(\"Hi there.\");\n+        cm.dispose();\n+        return;\n+    }\n     if (cm.haveItem(4031058))\n \t    actionx[\"Mental\"] = true;\n \telse if (cm.haveItem(4031057))\n@@ -107,6 +115,7 @@ function action(mode, type, selection){\n             \tif (cm.getPlayer().getLevel() >= 50){\n             \t\tcm.sendNext(\"Ok, go.\");\n                 \tif(!cm.isQuestStarted(100200)) cm.startQuest(100200);\n+                        if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS && !cm.isQuestCompleted(100201)) cm.completeQuest(100201);\n             \t}else\n                 \tcm.sendNext(\"You're weak.\");\n             \tcm.dispose();"}, {"sha": "44d0e62032d746165359b449ce62a957bb8a83a4", "filename": "scripts/npc/2020011.js", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020011.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -26,7 +26,15 @@ var sel;\n actionx = {\"Mental\" : false, \"Physical\" : false};\n \n function start() {\n-    if (!(cm.getPlayer().getLevel() >= 70 && parseInt(cm.getJobId() / 100) == 4)){\n+    var jobBase = parseInt(cm.getJobId() / 100);\n+    var jobStyle = 4;\n+    if (!(cm.getPlayer().getLevel() >= 70 && jobBase == jobStyle)){\n+        if(cm.getPlayer().getLevel() >= 70 && jobBase % 10 == jobStyle) {\n+            status++;\n+            action(1, 0, 1);\n+            return;\n+        }\n+        \n         cm.sendNext(\"Hi there.\");\n         cm.dispose();\n         return;\n@@ -106,6 +114,7 @@ function action(mode, type, selection){\n             if (cm.getPlayer().getLevel() >= 50){\n             \tcm.sendNext(\"Ok, go.\");\n                 if(!cm.isQuestStarted(100200)) cm.startQuest(100200);\n+                if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS && !cm.isQuestCompleted(100201)) cm.completeQuest(100201);\n             }else\n                 cm.sendNext(\"You're weak.\");\n             cm.dispose();"}, {"sha": "7658c22e9497f92ab77242ae93a309b902460990", "filename": "scripts/npc/2020013.js", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2020013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020013.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -26,7 +26,15 @@ var sel;\n actionx = {\"Mental\" : false, \"Physical\" : false};\n \n function start() {\n-    if (!(cm.getPlayer().getLevel() >= 70 && parseInt(cm.getJobId() / 100) == 5)){\n+    var jobBase = parseInt(cm.getJobId() / 100);\n+    var jobStyle = 5;\n+    if (!(cm.getPlayer().getLevel() >= 70 && jobBase == jobStyle)){\n+        if(cm.getPlayer().getLevel() >= 70 && jobBase % 10 == jobStyle) {\n+            status++;\n+            action(1, 0, 1);\n+            return;\n+        }\n+        \n         cm.sendNext(\"Hi there.\");\n         cm.dispose();\n         return;\n@@ -105,6 +113,7 @@ function action(mode, type, selection){\n             if (cm.getPlayer().getLevel() >= 50){\n             \tcm.sendNext(\"Ok, go.\");\n                 if(!cm.isQuestStarted(100200)) cm.startQuest(100200);\n+                if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS && !cm.isQuestCompleted(100201)) cm.completeQuest(100201);\n             }else\n                 cm.sendNext(\"You're weak.\");\n             cm.dispose();"}, {"sha": "7488954c211981d6fc01639cb54bc8306aac65f2", "filename": "scripts/npc/2042001.js", "status": "added", "additions": 226, "deletions": 0, "changes": 226, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2042001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2042001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2042001.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -0,0 +1,226 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Spiegelmann\n+        Refining NPC: \n+\t* Auto ore refiner\n+        * \n+        * @author RonanLana\n+*/\n+\n+var status;\n+var refineRocks = true;     // enables moon rock, star rock\n+var refineCrystals = true;  // enables common crystals\n+var refineSpecials = true;  // enables lithium, special crystals\n+var feeMultiplier = 7.0;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        var selStr = \"The Monster Carnival is currently unavailable, but instead I offer a steadfast #bore refining#k service for you, taxing #r\" + ((feeMultiplier * 100) | 0) + \"%#k over the usual fee to synthetize them. What will you do?#b\";\n+                        \n+                        var options = new Array(\"Refine mineral ores\",\"Refine jewel ores\");\n+                        if(refineCrystals) {\n+                            options.push(\"Refine crystal ores\");\n+                        }\n+                        if(refineRocks) {\n+                            options.push(\"Refine plates/jewels\");\n+                        }\n+                        \n+                        for (var i = 0; i < options.length; i++){\n+                            selStr += \"\\r\\n#L\" + i + \"# \" + options[i] + \"#l\";\n+                        }\n+                        \n+                        cm.sendSimple(selStr);\n+                } else if(status == 1) {\n+                        var allDone;\n+                        \n+                        if (selection == 0) {\n+                                allDone = refineItems(0); // minerals\n+                        } else if (selection == 1) {\n+                                allDone = refineItems(1); // jewels\n+                        } else if (selection == 2 && refineCrystals) {\n+                                allDone = refineItems(2); // crystals\n+                        } else if (selection == 2 && !refineCrystals || selection == 3) {\n+                                allDone = refineRockItems(); // moon/star rock\n+                        }\n+                        \n+                        if(allDone) {\n+                            cm.sendOk(\"Done. Thanks for showing up~.\");\n+                        } else {\n+                            cm.sendOk(\"Done. Be aware some of the items could not be synthetized because either you have a lack of space on your ETC inventory or there's not enough mesos to cover the fee.\");\n+                        }\n+                        cm.dispose();\n+                }\n+        }\n+}\n+\n+function getRefineFee(fee) {\n+    return ((feeMultiplier * fee) | 0);\n+}\n+\n+function isRefineTarget(refineType, refineItemid) {\n+    if(refineType == 0) { //mineral refine\n+        return refineItemid >= 4010000 && refineItemid <= 4010007 && !(refineItemid == 4010007 && !refineSpecials);\n+    } else if(refineType == 1) { //jewel refine\n+        return refineItemid >= 4020000 && refineItemid <= 4020008 && !(refineItemid == 4020008 && !refineSpecials);\n+    } else if(refineType == 2) { //crystal refine\n+        return refineItemid >= 4004000 && refineItemid <= 4004004 && !(refineItemid == 4004004 && !refineSpecials);\n+    }\n+    \n+    return false;\n+}\n+\n+function getRockRefineTarget(refineItemid) {\n+    if(refineItemid >= 4011000 && refineItemid <= 4011006) {\n+        return 0;\n+    } else if(refineItemid >= 4021000 && refineItemid <= 4021008) {\n+        return 1;\n+    }\n+    \n+    return -1;\n+}\n+\n+function refineItems(refineType) {\n+    var allDone = true;\n+    \n+    var refineFees = [[300,300,300,500,500,500,800,270],[500,500,500,500,500,500,500,1000,3000],[5000,5000,5000,5000,1000000]];\n+    var itemCount = {};\n+    \n+    var iter = cm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).iterator();\n+    while (iter.hasNext()) {\n+        var it = iter.next();\n+        var itemid = it.getItemId();\n+\n+        if(isRefineTarget(refineType, itemid)) {\n+            var ic = itemCount[itemid];\n+            \n+            if(ic != undefined) {\n+                itemCount[itemid] += it.getQuantity();\n+            } else {\n+                itemCount[itemid] = it.getQuantity();\n+            }\n+        }\n+    }\n+    \n+    for(var key in itemCount) {\n+        var itemqty = itemCount[key];\n+        var itemid = parseInt(key);\n+        \n+        var refineQty = ((itemqty / 10) | 0);\n+        if(refineQty <= 0) continue;\n+        \n+        while(true) {\n+            itemqty = refineQty * 10;\n+        \n+            var fee = getRefineFee(refineFees[refineType][(itemid % 100) | 0] * refineQty);\n+            if(cm.canHold(itemid + 1000, refineQty) && cm.getMeso() >= fee) {\n+                cm.gainMeso(-fee);\n+                cm.gainItem(itemid, -itemqty);\n+                cm.gainItem(itemid + (itemid != 4010007 ? 1000 : 1001), refineQty);\n+                \n+                break;\n+            } else if(refineQty <= 1) {\n+                allDone = false;\n+                break;\n+            } else {\n+                refineQty--;\n+            }\n+        }\n+    }\n+    \n+    return allDone;\n+}\n+\n+function refineRockItems() {\n+    var allDone = true;\n+    var minItems = [[0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]];\n+    var minRocks = [2147483647, 2147483647];\n+    \n+    var rockItems = [4011007, 4021009];\n+    var rockFees = [10000, 15000];\n+\n+    var iter = cm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).iterator();\n+    while (iter.hasNext()) {\n+        var it = iter.next();\n+        var itemid = it.getItemId();\n+        var rockRefine = getRockRefineTarget(itemid);\n+        if(rockRefine >= 0) {\n+            var rockItem = ((itemid % 100) | 0);\n+            var itemqty = it.getQuantity();\n+            \n+            minItems[rockRefine][rockItem] += itemqty;\n+        }\n+    }\n+    \n+    for(var i = 0; i < minRocks.length; i++) {\n+        for(var j = 0; j < minItems[i].length; j++) {\n+            if(minRocks[i] > minItems[i][j]) {\n+                minRocks[i] = minItems[i][j];\n+            }\n+        }\n+        if(minRocks[i] <= 0 || minRocks[i] == 2147483647) continue;\n+        \n+        var refineQty = minRocks[i];\n+        while(true) {\n+            var fee = getRefineFee(rockFees[i] * refineQty);\n+            if(cm.canHold(rockItems[i], refineQty) && cm.getMeso() >= fee) {\n+                cm.gainMeso(-fee);\n+\n+                var j;\n+                if(i == 0) {\n+                    for(j = 4011000; j < 4011007; j++) {\n+                        cm.gainItem(j, -refineQty);\n+                    }\n+                    cm.gainItem(j, refineQty);\n+                } else {\n+                    for(j = 4021000; j < 4021009; j++) {\n+                        cm.gainItem(j, -refineQty);\n+                    }\n+                    cm.gainItem(j, refineQty);\n+                }\n+                \n+                break;\n+            } else if(refineQty <= 1) {\n+                allDone = false;\n+                break;\n+            } else {\n+                refineQty--;\n+            }\n+        }\n+    }\n+    \n+    return allDone;\n+}"}, {"sha": "7488954c211981d6fc01639cb54bc8306aac65f2", "filename": "scripts/npc/2042002.js", "status": "added", "additions": 226, "deletions": 0, "changes": 226, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2042002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2042002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2042002.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -0,0 +1,226 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Spiegelmann\n+        Refining NPC: \n+\t* Auto ore refiner\n+        * \n+        * @author RonanLana\n+*/\n+\n+var status;\n+var refineRocks = true;     // enables moon rock, star rock\n+var refineCrystals = true;  // enables common crystals\n+var refineSpecials = true;  // enables lithium, special crystals\n+var feeMultiplier = 7.0;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        var selStr = \"The Monster Carnival is currently unavailable, but instead I offer a steadfast #bore refining#k service for you, taxing #r\" + ((feeMultiplier * 100) | 0) + \"%#k over the usual fee to synthetize them. What will you do?#b\";\n+                        \n+                        var options = new Array(\"Refine mineral ores\",\"Refine jewel ores\");\n+                        if(refineCrystals) {\n+                            options.push(\"Refine crystal ores\");\n+                        }\n+                        if(refineRocks) {\n+                            options.push(\"Refine plates/jewels\");\n+                        }\n+                        \n+                        for (var i = 0; i < options.length; i++){\n+                            selStr += \"\\r\\n#L\" + i + \"# \" + options[i] + \"#l\";\n+                        }\n+                        \n+                        cm.sendSimple(selStr);\n+                } else if(status == 1) {\n+                        var allDone;\n+                        \n+                        if (selection == 0) {\n+                                allDone = refineItems(0); // minerals\n+                        } else if (selection == 1) {\n+                                allDone = refineItems(1); // jewels\n+                        } else if (selection == 2 && refineCrystals) {\n+                                allDone = refineItems(2); // crystals\n+                        } else if (selection == 2 && !refineCrystals || selection == 3) {\n+                                allDone = refineRockItems(); // moon/star rock\n+                        }\n+                        \n+                        if(allDone) {\n+                            cm.sendOk(\"Done. Thanks for showing up~.\");\n+                        } else {\n+                            cm.sendOk(\"Done. Be aware some of the items could not be synthetized because either you have a lack of space on your ETC inventory or there's not enough mesos to cover the fee.\");\n+                        }\n+                        cm.dispose();\n+                }\n+        }\n+}\n+\n+function getRefineFee(fee) {\n+    return ((feeMultiplier * fee) | 0);\n+}\n+\n+function isRefineTarget(refineType, refineItemid) {\n+    if(refineType == 0) { //mineral refine\n+        return refineItemid >= 4010000 && refineItemid <= 4010007 && !(refineItemid == 4010007 && !refineSpecials);\n+    } else if(refineType == 1) { //jewel refine\n+        return refineItemid >= 4020000 && refineItemid <= 4020008 && !(refineItemid == 4020008 && !refineSpecials);\n+    } else if(refineType == 2) { //crystal refine\n+        return refineItemid >= 4004000 && refineItemid <= 4004004 && !(refineItemid == 4004004 && !refineSpecials);\n+    }\n+    \n+    return false;\n+}\n+\n+function getRockRefineTarget(refineItemid) {\n+    if(refineItemid >= 4011000 && refineItemid <= 4011006) {\n+        return 0;\n+    } else if(refineItemid >= 4021000 && refineItemid <= 4021008) {\n+        return 1;\n+    }\n+    \n+    return -1;\n+}\n+\n+function refineItems(refineType) {\n+    var allDone = true;\n+    \n+    var refineFees = [[300,300,300,500,500,500,800,270],[500,500,500,500,500,500,500,1000,3000],[5000,5000,5000,5000,1000000]];\n+    var itemCount = {};\n+    \n+    var iter = cm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).iterator();\n+    while (iter.hasNext()) {\n+        var it = iter.next();\n+        var itemid = it.getItemId();\n+\n+        if(isRefineTarget(refineType, itemid)) {\n+            var ic = itemCount[itemid];\n+            \n+            if(ic != undefined) {\n+                itemCount[itemid] += it.getQuantity();\n+            } else {\n+                itemCount[itemid] = it.getQuantity();\n+            }\n+        }\n+    }\n+    \n+    for(var key in itemCount) {\n+        var itemqty = itemCount[key];\n+        var itemid = parseInt(key);\n+        \n+        var refineQty = ((itemqty / 10) | 0);\n+        if(refineQty <= 0) continue;\n+        \n+        while(true) {\n+            itemqty = refineQty * 10;\n+        \n+            var fee = getRefineFee(refineFees[refineType][(itemid % 100) | 0] * refineQty);\n+            if(cm.canHold(itemid + 1000, refineQty) && cm.getMeso() >= fee) {\n+                cm.gainMeso(-fee);\n+                cm.gainItem(itemid, -itemqty);\n+                cm.gainItem(itemid + (itemid != 4010007 ? 1000 : 1001), refineQty);\n+                \n+                break;\n+            } else if(refineQty <= 1) {\n+                allDone = false;\n+                break;\n+            } else {\n+                refineQty--;\n+            }\n+        }\n+    }\n+    \n+    return allDone;\n+}\n+\n+function refineRockItems() {\n+    var allDone = true;\n+    var minItems = [[0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]];\n+    var minRocks = [2147483647, 2147483647];\n+    \n+    var rockItems = [4011007, 4021009];\n+    var rockFees = [10000, 15000];\n+\n+    var iter = cm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).iterator();\n+    while (iter.hasNext()) {\n+        var it = iter.next();\n+        var itemid = it.getItemId();\n+        var rockRefine = getRockRefineTarget(itemid);\n+        if(rockRefine >= 0) {\n+            var rockItem = ((itemid % 100) | 0);\n+            var itemqty = it.getQuantity();\n+            \n+            minItems[rockRefine][rockItem] += itemqty;\n+        }\n+    }\n+    \n+    for(var i = 0; i < minRocks.length; i++) {\n+        for(var j = 0; j < minItems[i].length; j++) {\n+            if(minRocks[i] > minItems[i][j]) {\n+                minRocks[i] = minItems[i][j];\n+            }\n+        }\n+        if(minRocks[i] <= 0 || minRocks[i] == 2147483647) continue;\n+        \n+        var refineQty = minRocks[i];\n+        while(true) {\n+            var fee = getRefineFee(rockFees[i] * refineQty);\n+            if(cm.canHold(rockItems[i], refineQty) && cm.getMeso() >= fee) {\n+                cm.gainMeso(-fee);\n+\n+                var j;\n+                if(i == 0) {\n+                    for(j = 4011000; j < 4011007; j++) {\n+                        cm.gainItem(j, -refineQty);\n+                    }\n+                    cm.gainItem(j, refineQty);\n+                } else {\n+                    for(j = 4021000; j < 4021009; j++) {\n+                        cm.gainItem(j, -refineQty);\n+                    }\n+                    cm.gainItem(j, refineQty);\n+                }\n+                \n+                break;\n+            } else if(refineQty <= 1) {\n+                allDone = false;\n+                break;\n+            } else {\n+                refineQty--;\n+            }\n+        }\n+    }\n+    \n+    return allDone;\n+}"}, {"sha": "f59c817e1e71cfca50b7bae32f18aabafff68204", "filename": "scripts/npc/2083000.js", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2083000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/2083000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2083000.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -24,10 +24,6 @@\n  */\n \n var status = 0;\n-var minLevel = 80;\n-var maxLevel = 255;\n-var minPlayers = 1;\n-var maxPlayers = 6;\n \n function start() {\n     status = -1;\n@@ -49,6 +45,13 @@ function action(mode, type, selection) {\n         if (status == 0) {\n             if(cm.haveItem(4001086)) {\n                 cm.sendYesNo(\"Do you want to access #b#m240050400##k right now?\");\n+            } else if(Packages.constants.ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS) {\n+                if(canBypassHTPQ()) {\n+                    cm.sendYesNo(\"Do you want to access #b#m240050400##k right now?\");\n+                } else {\n+                    cm.sendOk(\"Those who don't have the #r#t4001086##k must prove their valor before challenging #bHorntail#k. Come here holding the #r3 certificates#k that proves you're worthy to || the task.\");    // NPC picture is so long it goes through some section of text, || to fill up that space\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"Those who don't have the #r#t4001086##k must prove their valor before challenging #bHorntail#k.\");\n                 cm.dispose();\n@@ -60,5 +63,7 @@ function action(mode, type, selection) {\n         }\n     }\n }\n-\t\t\t\t\t\n-\t\t\t\t\t\n+\n+function canBypassHTPQ() {\n+    return cm.haveItem(4001083) && cm.haveItem(4001084) && cm.haveItem(4001085);\n+}\n\\ No newline at end of file"}, {"sha": "e3c805a0d98cca94f830d4daaaa4083738eae7f0", "filename": "scripts/npc/9000037.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/9000037.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/npc/9000037.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9000037.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -136,7 +136,7 @@ function action(mode, type, selection) {\n                                 cm.dispose();\n                         } else if(state == 2) {\n                                 var restSpot = ((cm.getMapId() - 1) % 5) + 1;\n-                                cm.getPlayer().getEventInstance().addEventTimer(restSpot * 4 * 60000);  // adds (restspot number * 4) minutes\n+                                cm.getPlayer().getEventInstance().restartEventTimer(restSpot * 4 * 60000);  // adds (restspot number * 4) minutes\n                                 cm.getPlayer().getEventInstance().warpEventTeam(970030100 + cm.getEventInstance().getIntProperty(\"lobby\") + (500 * restSpot));\n                                 \n                                 cm.dispose();"}, {"sha": "3da41bc370f8949a168105ae3d37f8fcd0bdc5c7", "filename": "scripts/quest/3514.js", "status": "modified", "additions": 30, "deletions": 13, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/quest/3514.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/scripts/quest/3514.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3514.js?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -25,6 +25,8 @@\n \n importPackage(Packages.client);\n \n+var status = -1;\n+\n function start(mode, type, selection) {\n         if(qm.getPlayer().getMeso() >= 1000000) {\n             if(qm.canHold(2022337, 1)) {\n@@ -48,21 +50,36 @@ function usedPotion(ch) {\n }\n \n function end(mode, type, selection) {\n-        if(!usedPotion(qm.getPlayer())) {\n-                if(qm.haveItem(2022337)) {\n-                        qm.sendOk(\"Are you scared to drink the potion? I can assure you it has only a minor #rside effect#k.\");\n-                } else {\n-                        if(qm.canHold(2022337)) {\n-                                qm.gainItem(2022337, 1);\n-                                qm.sendOk(\"Lost it? Luckily for you I managed to recover it back. Take it.\");\n+        if (mode == 0 && type == 0) {\n+\t\tstatus--;\n+\t} else if (mode == -1) {\n+\t\tqm.dispose();\n+\t\treturn;\n+\t} else {\n+\t\tstatus++;\n+\t}\n+    \n+        if(status == 0) {\n+                if(!usedPotion(qm.getPlayer())) {\n+                        if(qm.haveItem(2022337)) {\n+                                qm.sendOk(\"Are you scared to drink the potion? I can assure you it has only a minor #rside effect#k.\");\n                         } else {\n-                                qm.sendOk(\"Lost it? Luckily for you I managed to recover it back. Make a room to get it.\");\n+                                if(qm.canHold(2022337)) {\n+                                        qm.gainItem(2022337, 1);\n+                                        qm.sendOk(\"Lost it? Luckily for you I managed to recover it back. Take it.\");\n+                                } else {\n+                                        qm.sendOk(\"Lost it? Luckily for you I managed to recover it back. Make a room to get it.\");\n+                                }\n                         }\n+                        \n+                        qm.dispose();\n+                        return;\n+                } else {\n+                        qm.sendOk(\"It seems the potion worked and your emotions are no longer frozen. And, oh, my... You're ailing bad, #bpurge#k that out quickly.\");\n                 }\n-\t} else {\n-\t\tqm.sendOk(\"It seems the potion worked and your emotions are no longer frozen. And, oh, my... You're ailing bad, #bpurge#k that out quickly.\");\n+        } else if(status == 1) {\n                 qm.gainExp(891500 * qm.getPlayer().getExpRate());\n-\t\tqm.completeQuest(3514);\n-\t}\n-        qm.dispose();\n+                qm.completeQuest(3514);\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "b8f54aa3141261ba148676570045e3e4498827e2", "filename": "sql/db_drops.sql", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -19546,19 +19546,6 @@ USE `heavenms`;\n (9500319, 2020019, 5, 20, 0, 40000),\n (9500319, 2020020, 5, 20, 0, 40000),\n (9500319, 1052166, 1, 1, 0, 4000),\n-(9500319, 2280000, 1, 1, 0, 4000),\n-(9500319, 2280001, 1, 1, 0, 4000),\n-(9500319, 2280002, 1, 1, 0, 4000),\n-(9500319, 2280003, 1, 1, 0, 4000),\n-(9500319, 2280004, 1, 1, 0, 4000),\n-(9500319, 2280005, 1, 1, 0, 4000),\n-(9500319, 2280006, 1, 1, 0, 4000),\n-(9500319, 2280007, 1, 1, 0, 4000),\n-(9500319, 2280008, 1, 1, 0, 4000),\n-(9500319, 2280009, 1, 1, 0, 4000),\n-(9500319, 2280010, 1, 1, 0, 4000),\n-(9500319, 2280011, 1, 1, 0, 4000),\n-(9500319, 2280012, 1, 1, 0, 4000),\n (9500319, 2044712, 1, 1, 0, 4000),\n (9500319, 2044612, 1, 1, 0, 4000),\n (9500319, 2044512, 1, 1, 0, 4000),\n@@ -20293,12 +20280,6 @@ USE `heavenms`;\n \n   # add more skill/mastery books\n   INSERT IGNORE INTO temp_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n-(9400014, 2280000, 1, 1, 0, 40000),\n-(8150000, 2280001, 1, 1, 0, 40000),\n-(9400121, 2280002, 1, 1, 0, 40000),\n-(9300028, 2280003, 1, 1, 0, 100000),\n-(8150100, 2280011, 1, 1, 0, 1000),\n-(8220009, 2280012, 1, 1, 0, 40000),\n (8150000, 2280013, 1, 1, 0, 40000),\n (8200005, 2280014, 1, 1, 0, 1000),\n (9300028, 2280015, 1, 1, 0, 100000),\n@@ -20372,12 +20353,6 @@ USE `heavenms`;\n (9400582, 2290135, 1, 1, 0, 1000),\n (9400593, 2290138, 1, 1, 0, 40000),\n (8200002, 2290139, 1, 1, 0, 1000),\n-(8190004, 2280000, 1, 1, 0, 1000),\n-(9400300, 2280001, 1, 1, 0, 100000),\n-(8200012, 2280002, 1, 1, 0, 1000),\n-(8140511, 2280003, 1, 1, 0, 1000),\n-(8200005, 2280011, 1, 1, 0, 1000),\n-(9420513, 2280012, 1, 1, 0, 40000),\n (8190003, 2280013, 1, 1, 0, 1000),\n (9400121, 2280014, 1, 1, 0, 40000),\n (8200001, 2280015, 1, 1, 0, 1000),"}, {"sha": "d29aa46de17c0b1addfb96f5a9990108adcd7032", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 20, "deletions": 10, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -198,7 +198,7 @@\n     private int expRate = 1, mesoRate = 1, dropRate = 1, expCoupon = 1, mesoCoupon = 1, dropCoupon = 1;\n     private int omokwins, omokties, omoklosses, matchcardwins, matchcardties, matchcardlosses;\n     private int owlSearch;\n-    private long lastfametime, lastUsedCashItem, lastHealed, lastBuyback, lastDeathtime, lastMesoDrop = -1, jailExpiration = -1;\n+    private long lastfametime, lastUsedCashItem, lastHealed, lastBuyback = 0, lastDeathtime, lastMesoDrop = -1, jailExpiration = -1;\n     private transient int localmaxhp, localmaxmp, localstr, localdex, localluk, localint_, magic, watk;\n     private boolean hidden, canDoor = true, berserk, hasMerchant, hasSandboxItem = false, whiteChat = false;\n     private int linkedLevel = 0;\n@@ -1729,14 +1729,17 @@ public final void pickupItem(MapleMapObject ob, int petIndex) {     // yes, one\n                                 if (mesosamm > 50000 * this.getMesoRate()) {\n                                     return;\n                                 }\n+                                \n+                                MapleMap thisMap = this.getMap();\n                                 int partynum = 0;\n-                                for (MaplePartyCharacter partymem : this.party.getMembers()) {\n-                                    if (partymem.isOnline() && partymem.getMapId() == this.getMap().getId() && partymem.getChannel() == client.getChannel()) {\n+                                Collection<MaplePartyCharacter> mpcs = this.party.getMembers();\n+                                for (MaplePartyCharacter partymem : mpcs) {\n+                                    if (partymem.getPlayer().isLoggedinWorld() && partymem.getMapId() == thisMap.getId() && partymem.getChannel() == client.getChannel()) {\n                                         partynum++;\n                                     }\n                                 }\n-                                for (MaplePartyCharacter partymem : this.party.getMembers()) {\n-                                    if (partymem.isOnline() && partymem.getMapId() == this.getMap().getId()) {\n+                                for (MaplePartyCharacter partymem : mpcs) {\n+                                    if (partymem.getPlayer().isLoggedinWorld() && partymem.getMapId() == thisMap.getId()) {\n                                         MapleCharacter somecharacter = client.getChannelServer().getPlayerStorage().getCharacterById(partymem.getId());\n                                         if (somecharacter != null) {\n                                             somecharacter.gainMeso(mesosamm / partynum, true, true, false);\n@@ -5213,6 +5216,10 @@ private void applyBuybackFee(int fee, boolean usingMesos) {\n         }\n     }\n     \n+    private long getNextBuybackTime() {\n+        return lastBuyback + ServerConstants.BUYBACK_COOLDOWN_MINUTES * 60 * 1000;\n+    }\n+    \n     public boolean couldBuyback() {  // Ronan's buyback system\n         long timeNow = System.currentTimeMillis();\n         \n@@ -5221,7 +5228,7 @@ public boolean couldBuyback() {  // Ronan's buyback system\n             return false;\n         }\n         \n-        long nextBuybacktime = lastBuyback + ServerConstants.BUYBACK_COOLDOWN_MINUTES * 60 * 1000;\n+        long nextBuybacktime = getNextBuybackTime();\n         if(timeNow < nextBuybacktime) {\n             long timeLeft = nextBuybacktime - timeNow;\n             int seconds = (int) Math.floor(timeLeft / 1000) % 60;\n@@ -5840,14 +5847,15 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n             ret.mgc = new MapleGuildCharacter(ret);\n             int buddyCapacity = rs.getInt(\"buddyCapacity\");\n             ret.buddylist = new BuddyList(buddyCapacity);\n+            \n             ret.getInventory(MapleInventoryType.EQUIP).setSlotLimit(rs.getByte(\"equipslots\"));\n             ret.getInventory(MapleInventoryType.USE).setSlotLimit(rs.getByte(\"useslots\"));\n             ret.getInventory(MapleInventoryType.SETUP).setSlotLimit(rs.getByte(\"setupslots\"));\n             ret.getInventory(MapleInventoryType.ETC).setSlotLimit(rs.getByte(\"etcslots\"));\n+            \n+            byte sandboxCheck = 0x0;\n             for (Pair<Item, MapleInventoryType> item : ItemFactory.INVENTORY.loadItems(ret.id, !channelserver)) {\n-                if(MapleInventoryManipulator.isSandboxItem(item.getLeft())) {\n-                    ret.setHasSandboxItem();\n-                }\n+                sandboxCheck |= item.getLeft().getFlag();\n                 \n                 ret.getInventory(item.getRight()).addFromDB(item.getLeft());\n                 Item itemz = item.getLeft();\n@@ -5872,6 +5880,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                     }\n                 }\n             }\n+            if((sandboxCheck & ItemConstants.SANDBOX) == ItemConstants.SANDBOX) ret.setHasSandboxItem();\n             \n             World wserv = Server.getInstance().getWorld(ret.world);\n             \n@@ -6072,10 +6081,11 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                 ps = con.prepareStatement(\"SELECT SkillID,StartTime,length FROM cooldowns WHERE charid = ?\");\n                 ps.setInt(1, ret.getId());\n                 rs = ps.executeQuery();\n+                long curTime = System.currentTimeMillis();\n                 while (rs.next()) {\n                     final int skillid = rs.getInt(\"SkillID\");\n                     final long length = rs.getLong(\"length\"), startTime = rs.getLong(\"StartTime\");\n-                    if (skillid != 5221999 && (length + startTime < System.currentTimeMillis())) {\n+                    if (skillid != 5221999 && (length + startTime < curTime)) {\n                         continue;\n                     }\n                     ret.giveCoolDowns(skillid, startTime, length);"}, {"sha": "435bb8894cf2d7a50c48ba84c104bf5df79fe73c", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -75,6 +75,7 @@\n     public static final boolean USE_MULTIPLE_SAME_EQUIP_DROP = true;//Enables multiple drops by mobs of the same equipment, number of possible drops based on the quantities provided at the drop data.\n     public static final boolean USE_BANISHABLE_TOWN_SCROLL = true;  //Enables town scrolls to act as if it's a \"player banish\", rendering the antibanish scroll effect available.\n     public static final boolean USE_OLD_GMS_STYLED_PQ_NPCS = true;  //Enables PQ NPCs with similar behaviour to old GMS style, that skips info about the PQs and immediately tries to register the party in.\n+    public static final boolean USE_ENABLE_SOLO_EXPEDITIONS = true; //Enables start expeditions with any number of players. This will also bypass all the Zakum prequest.\n     \n     //Announcement Configuration\n     public static final boolean USE_ANNOUNCE_SHOPITEMSOLD = false;  //Automatic message sent to owner when an item from the Player Shop or Hired Merchant is sold.\n@@ -137,6 +138,9 @@\n     public static final boolean USE_ULTRA_RECOVERY = true;      //Massive recovery amounts overtime.\n     public static final boolean USE_ULTRA_THREE_SNAILS = true;  //Massive damage on shell toss.\n     \n+    //Other Skills Configuration\n+    public static final boolean USE_FAST_REUSE_HERO_WILL = true;//Greatly reduce cooldown on Hero's Will.\n+    \n     //Character Configuration\n     public static final boolean USE_ADD_SLOTS_BY_LEVEL = true;  //Slots are added each 20 levels.\n     public static final boolean USE_ADD_RATES_BY_LEVEL = true;  //Rates are added each 20 levels."}, {"sha": "99210b695e09035eab0df4a983c823d2fd3ce933", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 24, "deletions": 4, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -487,17 +487,17 @@ public void run() {\n                     }\n                     if (attack.skill == Paladin.HEAVENS_HAMMER) {\n                         if(!monster.isBoss()) {\n-                            map.damageMonster(player, monster, monster.getHp() - 1);\n+                            damageMonsterWithSkill(player, map, monster, monster.getHp() - 1, attack.skill, 1777);\n                         } else {\n                             int HHDmg = (player.calculateMaxBaseDamage(player.getTotalWatk()) * (SkillFactory.getSkill(Paladin.HEAVENS_HAMMER).getEffect(player.getSkillLevel(SkillFactory.getSkill(Paladin.HEAVENS_HAMMER))).getDamage() / 100));\n-                            map.damageMonster(player, monster, (int) (Math.floor(Math.random() * (HHDmg / 5) + HHDmg * .8)));\n+                            damageMonsterWithSkill(player, map, monster, (int) (Math.floor(Math.random() * (HHDmg / 5) + HHDmg * .8)), attack.skill, 1777);\n                         }\n                     } else if (attack.skill == Aran.COMBO_TEMPEST) {\n                         if(!monster.isBoss()) {\n-                            map.damageMonster(player, monster, monster.getHp());\n+                            damageMonsterWithSkill(player, map, monster, monster.getHp(), attack.skill, 0);\n                         } else {\n                             int TmpDmg = (player.calculateMaxBaseDamage(player.getTotalWatk()) * (SkillFactory.getSkill(Aran.COMBO_TEMPEST).getEffect(player.getSkillLevel(SkillFactory.getSkill(Aran.COMBO_TEMPEST))).getDamage() / 100));\n-                            map.damageMonster(player, monster, (int) (Math.floor(Math.random() * (TmpDmg / 5) + TmpDmg * .8)));\n+                            damageMonsterWithSkill(player, map, monster, (int) (Math.floor(Math.random() * (TmpDmg / 5) + TmpDmg * .8)), attack.skill, 0);\n                         }\n                     } else {\n                         if(attack.skill == Aran.BODY_PRESSURE) {\n@@ -534,6 +534,26 @@ public void run() {\n         }\n     }\n \n+    private static void damageMonsterWithSkill(final MapleCharacter attacker, final MapleMap map, final MapleMonster monster, final int damage, int skillid, int fixedTime) {\n+        int animationTime;\n+        \n+        if(fixedTime == 0) animationTime = SkillFactory.getSkill(skillid).getAnimationTime();\n+        else animationTime = fixedTime;\n+        \n+        if(animationTime > 0) { // be sure to only use LIMITED ATTACKS with animation time here\n+            TimerManager.getInstance().schedule(new Runnable() {\n+                @Override\n+                public void run() {\n+                    map.broadcastMessage(MaplePacketCreator.damageMonster(monster.getObjectId(), damage), monster.getPosition());\n+                    map.damageMonster(attacker, monster, damage);\n+                }\n+            }, animationTime);\n+        } else {\n+            map.broadcastMessage(MaplePacketCreator.damageMonster(monster.getObjectId(), damage), monster.getPosition());\n+            map.damageMonster(attacker, monster, damage);\n+        }\n+    }\n+    \n     protected AttackInfo parseDamage(LittleEndianAccessor lea, MapleCharacter chr, boolean ranged, boolean magic) {    \n     \t//2C 00 00 01 91 A1 12 00 A5 57 62 FC E2 75 99 10 00 47 80 01 04 01 C6 CC 02 DD FF 5F 00\n         AttackInfo ret = new AttackInfo();"}, {"sha": "728292d783a734a2fa49d359f3d8650cdb3f4946", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -117,6 +117,16 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         final MapleCharacter chr = c.getPlayer();\n         \n         if (mode == Action.CREATE.getCode()) {\n+            if(!chr.isAlive()) {    // thanks GabrielSin for pointing this\n+                chr.getClient().announce(MaplePacketCreator.getMiniRoomError(4));\n+                return;\n+            }\n+            \n+            if(chr.getEventInstance() != null) {\n+                chr.getClient().announce(MaplePacketCreator.getMiniRoomError(5));\n+                return;\n+            }\n+            \n             byte createType = slea.readByte();\n             if (createType == 3) {// trade\n                 MapleTrade.startTrade(chr);\n@@ -585,8 +595,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         } else if (mode == Action.BAN_PLAYER.getCode()) {\n             slea.skip(1);\n             \n-            if (chr.getPlayerShop() != null && chr.getPlayerShop().isOwner(chr)) {\n-                chr.getPlayerShop().banPlayer(slea.readMapleAsciiString());\n+            MaplePlayerShop shop = chr.getPlayerShop();\n+            if (shop != null && shop.isOwner(chr)) {\n+                shop.banPlayer(slea.readMapleAsciiString());\n             }\n         } else if (mode == Action.EXPEL.getCode()) {\n             MapleMiniGame miniGame = chr.getMiniGame();"}, {"sha": "b9483ac9345ad81afd0c7b98652a266ef155615a", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -36,6 +36,7 @@\n import client.Skill;\n import client.SkillFactory;\n import constants.GameConstants;\n+import constants.ServerConstants;\n import constants.skills.Brawler;\n import constants.skills.Corsair;\n import constants.skills.DarkKnight;\n@@ -82,8 +83,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (chr.skillIsCooling(skillid)) {\n                 return;\n             } else if (skillid != Corsair.BATTLE_SHIP) {\n-                c.announce(MaplePacketCreator.skillCooldown(skillid, effect.getCooldown()));\n-                chr.addCooldown(skillid, System.currentTimeMillis(), effect.getCooldown() * 1000);\n+                int cooldownTime = effect.getCooldown();\n+                if(MapleStatEffect.isHerosWill(skillid) && ServerConstants.USE_FAST_REUSE_HERO_WILL) {\n+                    cooldownTime /= 60;\n+                }\n+                \n+                c.announce(MaplePacketCreator.skillCooldown(skillid, cooldownTime));\n+                chr.addCooldown(skillid, System.currentTimeMillis(), cooldownTime * 1000);\n             }\n         }\n         if (skillid == Hero.MONSTER_MAGNET || skillid == Paladin.MONSTER_MAGNET || skillid == DarkKnight.MONSTER_MAGNET) { // Monster Magnet"}, {"sha": "7ca91b32eddc03b55c331efd43932a3c1c383161", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 22, "deletions": 17, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -1444,27 +1444,32 @@ private boolean isDispel() {\n \n     private boolean isCureAllAbnormalStatus() {\n         if (skill) {\n-            switch (sourceid) {\n-                case Hero.HEROS_WILL:\n-                case Paladin.HEROS_WILL:\n-                case DarkKnight.HEROS_WILL:\n-                case FPArchMage.HEROS_WILL:\n-                case ILArchMage.HEROS_WILL:\n-                case Bishop.HEROS_WILL:\n-                case Bowmaster.HEROS_WILL:\n-                case Marksman.HEROS_WILL:\n-                case NightLord.HEROS_WILL:\n-                case Shadower.HEROS_WILL:\n-                case Buccaneer.PIRATES_RAGE:\n-                case Aran.HEROS_WILL:\n-                    return true;\n-                default:\n-                    return false;\n-            }\n+            return isHerosWill(sourceid);\n         } else if (sourceid == 2022544) return true;\n         \n         return false;\n     }\n+    \n+    public static boolean isHerosWill(int skillid) {\n+        switch(skillid) {\n+            case Hero.HEROS_WILL:\n+            case Paladin.HEROS_WILL:\n+            case DarkKnight.HEROS_WILL:\n+            case FPArchMage.HEROS_WILL:\n+            case ILArchMage.HEROS_WILL:\n+            case Bishop.HEROS_WILL:\n+            case Bowmaster.HEROS_WILL:\n+            case Marksman.HEROS_WILL:\n+            case NightLord.HEROS_WILL:\n+            case Shadower.HEROS_WILL:\n+            case Buccaneer.PIRATES_RAGE:\n+            case Aran.HEROS_WILL:\n+                return true;\n+\n+            default:\n+                return false;\n+        }\n+    }\n \n     private boolean isDash() {\n         return skill && (sourceid == Pirate.DASH || sourceid == ThunderBreaker.DASH || sourceid == Beginner.SPACE_DASH || sourceid == Noblesse.SPACE_DASH);"}, {"sha": "eaa664689d6ecef179535a047b0a57c8e29ed482", "filename": "src/server/expeditions/MapleExpeditionType.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/expeditions/MapleExpeditionType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/expeditions/MapleExpeditionType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpeditionType.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -22,6 +22,8 @@\n \n package server.expeditions;\n \n+import constants.ServerConstants;\n+\n /**\n *\n * @author SharpAceX(Alan)\n@@ -55,7 +57,7 @@ private MapleExpeditionType(int minSize, int maxSize, int minLevel, int maxLevel\n     }\n \n     public int getMinSize() {\n-    \treturn minSize;\n+    \treturn !ServerConstants.USE_ENABLE_SOLO_EXPEDITIONS ? minSize : 1;\n     }\n     \n     public int getMaxSize() {"}, {"sha": "4e37f71fcd8af8ae9f2da5e11fc3e004e2e08056", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -583,14 +583,18 @@ public static String getRoundedCoordinate(double angle) {\n         return new Pair<>(getRoundedCoordinate(angle), Integer.valueOf((int)distn));\n     }\n \n-    private static void sortDropEntries(List<MonsterDropEntry> from, List<MonsterDropEntry> item, List<MonsterDropEntry> quest) {\n+    private static void sortDropEntries(List<MonsterDropEntry> from, List<MonsterDropEntry> item, List<MonsterDropEntry> visibleQuest, List<MonsterDropEntry> otherQuest, MapleCharacter chr) {\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         \n         for(MonsterDropEntry mde : from) {\n             if(!ii.isQuestItem(mde.itemId)) {\n                 item.add(mde);\n             } else {\n-                quest.add(mde);\n+                if(chr.needQuestItem(mde.questid, mde.itemId)) {\n+                    visibleQuest.add(mde);\n+                } else {\n+                    otherQuest.add(mde);\n+                }\n             }\n         }\n     }\n@@ -690,8 +694,9 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob, f\n         final MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n         \n         final List<MonsterDropEntry>  dropEntry = new ArrayList<>();\n-        final List<MonsterDropEntry> questEntry = new ArrayList<>();\n-        sortDropEntries(mi.retrieveEffectiveDrop(mob.getId()), dropEntry, questEntry);\n+        final List<MonsterDropEntry> visibleQuestEntry = new ArrayList<>();\n+        final List<MonsterDropEntry> otherQuestEntry = new ArrayList<>();\n+        sortDropEntries(mi.retrieveEffectiveDrop(mob.getId()), dropEntry, visibleQuestEntry, otherQuestEntry, chr);\n         \n         // Normal Drops\n         d = dropItemsFromMonsterOnMap(dropEntry, pos, d, chRate, droptype, mobpos, chr, mob);\n@@ -701,7 +706,8 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob, f\n         d = dropGlobalItemsFromMonsterOnMap(globalEntry, pos, d, droptype, mobpos, chr, mob);\n         \n         // Quest Drops\n-        dropItemsFromMonsterOnMap(questEntry, pos, d, chRate, droptype, mobpos, chr, mob);\n+        d = dropItemsFromMonsterOnMap(visibleQuestEntry, pos, d, chRate, droptype, mobpos, chr, mob);\n+        dropItemsFromMonsterOnMap(otherQuestEntry, pos, d, chRate, droptype, mobpos, chr, mob);\n     }\n     \n     public void dropItemsFromMonster(List<MonsterDropEntry> list, final MapleCharacter chr, final MapleMonster mob) {"}, {"sha": "5a6e886d8d0b88701b3dbc6f1d2df8579382255d", "filename": "wz/Etc.wz/ItemMake.img.xml", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Etc.wz/ItemMake.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Etc.wz/ItemMake.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Etc.wz/ItemMake.img.xml?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -1573,6 +1573,42 @@\n         </imgdir>\n       </imgdir>\n     </imgdir>\n+    <imgdir name=\"04260007\">\n+      <int name=\"reqLevel\" value=\"105\"/>\n+      <int name=\"reqSkillLevel\" value=\"3\"/>\n+      <int name=\"itemNum\" value=\"5\"/>\n+      <int name=\"reqItem\" value=\"4001126\"/>\n+      <int name=\"tuc\" value=\"0\"/>\n+      <int name=\"meso\" value=\"2000000\"/>\n+      <imgdir name=\"recipe\">\n+        <imgdir name=\"0\">\n+          <int name=\"item\" value=\"4260006\"/>\n+          <int name=\"count\" value=\"100\"/>\n+        </imgdir>\n+        <imgdir name=\"1\">\n+          <int name=\"item\" value=\"4001126\"/>\n+          <int name=\"count\" value=\"5\"/>\n+        </imgdir>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"04260008\">\n+      <int name=\"reqLevel\" value=\"105\"/>\n+      <int name=\"reqSkillLevel\" value=\"3\"/>\n+      <int name=\"itemNum\" value=\"10\"/>\n+      <int name=\"reqItem\" value=\"4001126\"/>\n+      <int name=\"tuc\" value=\"0\"/>\n+      <int name=\"meso\" value=\"5000000\"/>\n+      <imgdir name=\"recipe\">\n+        <imgdir name=\"0\">\n+          <int name=\"item\" value=\"4260007\"/>\n+          <int name=\"count\" value=\"50\"/>\n+        </imgdir>\n+        <imgdir name=\"1\">\n+          <int name=\"item\" value=\"4001126\"/>\n+          <int name=\"count\" value=\"5\"/>\n+        </imgdir>\n+      </imgdir>\n+    </imgdir>\n   </imgdir>\n   <imgdir name=\"1\">\n     <imgdir name=\"01002028\">"}, {"sha": "0eba3c7dddbf24ead2811649fa9e4b2ee2a34b77", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -27173,6 +27173,8 @@\n   <imgdir name=\"28002\">\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9105003\"/>\n+      <int name=\"lvmax\" value=\"51\"/>\n+      <int name=\"lvmin\" value=\"21\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2020005\"/>"}, {"sha": "28760b3886c7cfa0a29b44b96515205a7e071a22", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -3455,7 +3455,7 @@\n   <imgdir name=\"7778\">\n     <imgdir name=\"0\">\n       <string name=\"0\" value=\"Hey, do you have a minute? This is Showa Town, a humble town famous for the rich veggies market and movie productions of the most finest quality in the world of Maple.\"/>\n-      <string name=\"1\" value=\"However, the streets around here have always been surrounded by an air of incertainty, as if anywhere you go eyes are gazing at you, watching you, stalking you. Somebody ready to assault you at any moment, at the slightest drop of guard. Troublesome, no?\"/>\n+      <string name=\"1\" value=\"However, the streets around here have always been surrounded by an air of uncertainty, as if anywhere you go eyes are gazing at you, watching you, stalking you. Somebody ready to assault you at any moment, at the slightest drop of guard. Troublesome, no?\"/>\n       <string name=\"2\" value=\"The patrolling in the region has had their golden age quite a time ago, now it&apos;s just like nothing. That&apos;s because of the emergent #rShowa gang#k, that took control of the city at the very moment they started to act.\"/>\n       <string name=\"3\" value=\"Now, listen my plea. We, citizens of good, must take arms against the tyranny that befell over us! To end this, we must gather together to form a counter-task force against these mafia guys. Mind to join us?\"/>\n       <imgdir name=\"yes\">\n@@ -3467,6 +3467,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <string name=\"0\" value=\"Ah, there you are. Thank you for bringing an end to their tyranny. Now Showa will finally shine again for the tourists that will start to come for the local specialties. There is your grand prize, enjoy!\"/>\n+      <imgdir name=\"stop\">\n+        <imgdir name=\"item\">\n+          <string name=\"0\" value=\"It doesn&apos;t look like the streets are clear yet...\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"1030\">"}, {"sha": "8a32ff461be7fa9d0b121c354b0c7a05e191156b", "filename": "wz/String.wz/Npc.img.xml", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/String.wz/Npc.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c4d6531177c45bedb5f36db2b96d41e3286b9789/wz/String.wz/Npc.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Npc.img.xml?ref=c4d6531177c45bedb5f36db2b96d41e3286b9789", "patch": "@@ -5354,6 +5354,7 @@\n     <string name=\"n0\" value=\"Happy Holidays! Did you hear what happened to Happyville?\"/>\n     <string name=\"n1\" value=\"Can you believe that someone is trying to ruin it for everyone here at Happyville?\"/>\n     <string name=\"func\" value=\"Christmas Party Quest NPC\"/>\n+    <string name=\"d0\" value=\"Happy Holidays!\"/>\n   </imgdir>\n   <imgdir name=\"9105004\">\n     <string name=\"name\" value=\"Snow Spirit\"/>\n@@ -5498,16 +5499,19 @@\n     <string name=\"name\" value=\"Skai\"/>\n     <string name=\"n0\" value=\"A movie premier!\"/>\n     <string name=\"n1\" value=\"I&apos;m the lead actress!\"/>\n+    <string name=\"d0\" value=\"Hey, did you know I am the lead actress on the movie they are going to premier tonight?\"/>\n   </imgdir>\n   <imgdir name=\"9120007\">\n     <string name=\"name\" value=\"Furano\"/>\n     <string name=\"n0\" value=\"Hey, no pushing!\"/>\n     <string name=\"n1\" value=\"Please line up!\"/>\n+    <string name=\"d0\" value=\"Everyone willing to see the movie, please line up here to get your tickets!\"/>\n   </imgdir>\n   <imgdir name=\"9120008\">\n     <string name=\"name\" value=\"Tsuri\"/>\n     <string name=\"n0\" value=\"This has been fished out by yours truly.\"/>\n     <string name=\"n1\" value=\"Fishing is the best!\"/>\n+    <string name=\"d0\" value=\"Hey, what&apos;s up? Cheap prices for fishes only here, take a look around and you will see what I&apos;m talking about.\"/>\n   </imgdir>\n   <imgdir name=\"9120009\">\n     <string name=\"name\" value=\"Yuse\"/>\n@@ -5539,21 +5543,25 @@\n     <string name=\"name\" value=\"Boss Kitty\"/>\n     <string name=\"n0\" value=\"Hooo~\"/>\n     <string name=\"n1\" value=\"Haaaah!\"/>\n+    <string name=\"d0\" value=\"Meeeeow. ... hohohohoho~\"/>\n   </imgdir>\n   <imgdir name=\"9120014\">\n     <string name=\"name\" value=\"Popo\"/>\n     <string name=\"n0\" value=\"It&apos;s windy...\"/>\n     <string name=\"n1\" value=\"We shall protect this town to the fullest!\"/>\n+    <string name=\"d0\" value=\"I am #p91200214#, from the Police dept. of Showa Town. Do you need something?\"/>\n   </imgdir>\n   <imgdir name=\"9120015\">\n     <string name=\"name\" value=\"Konpei\"/>\n     <string name=\"n0\" value=\"Enthusiasm alone won&apos;t get it done here. Don&apos;t bother us.\"/>\n     <string name=\"n1\" value=\"I&apos;m not here to test your strength. This is life-and-death situation!!\"/>\n+    <string name=\"d0\" value=\"Don&apos;t talk to me if you are just as weak-willed as the people that lives around here.\"/>\n   </imgdir>\n   <imgdir name=\"9120016\">\n     <string name=\"name\" value=\"Mariwaka\"/>\n     <string name=\"n0\" value=\"Say hello to the soon-to-be leading actress in a movie!\"/>\n     <string name=\"n1\" value=\"My gosh, why is the wind so strong!\"/>\n+    <string name=\"d0\" value=\"Standing there is #p9120006#, the lead actress of the upcoming movie, and a friend of mine. She&apos;s so nice!\"/>\n   </imgdir>\n   <imgdir name=\"9120017\">\n     <string name=\"name\" value=\"Poni Chai\"/>"}]}]},
