{"fetchDate": "2019-12-19", "content": [{"sha": "f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6Zjk1ODYyNGY2YTJhOWZhMTk2Y2E2N2RmZWFmYzU3N2U5YjkzYjgzYQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-08-15T00:14:15Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-08-15T00:14:15Z"}, "message": "Reactor Loot + Obstacles damage mob + Static calls from scripts\n\nRevised starting AP, now working out with flags. To supply the 9AP shortage of 4/4/4/4, two options: one giving out 9 AP from the start, other giving 4/5 AP when changing jobs (1st, 2nd). This change would also work with the autoassign for beginners flag.\nRefactored several quest scripts, that would be glitching the player when doing quest start/complete and disposing under the same script status.\nCleared some cases with the quest reward system where it would call out a \"full inventory\" even though new inventory slots could get discovered when doing the quest loot transaction.\nFixed an issue with player stores being deployed overlapping in a few scenarios.\nFixed reduced EXP gain from kills when triggering skill Mortal Blow.\nAdded \"open Duey\" functionality when clicking \"O\" in the incoming package notification.\nFixed packages without messages (a quirk from quick delivery) not accounting visually as a \"quick\" one.\nFixed certain mounts (non-item skill mounts, such as Yeti or Spaceship) not showing up properly to other players when changing maps.\nAdded handler for mob damage by environment objects (OrbisPQ jail storage area).\nAdded a placeholder on mob's stolen items to prevent more steals to be placed as soon as the Steal mechanism is triggered.\nPatched boss logs not removing recent entries from the DB tables (the reset method is actually supposed to clear every entry).\nRevised a possible memory leak scenario happening due to an exception thrown midway monster kill method.\nImproved reactor drops, now placing loots visible for the acting player centered (similar as to how mob loots work).\nRefactored several issues in scripts, related to accessing static Java methods through an object, that would start appearing after transitioning to Java 8.", "tree": {"sha": "9062cc6953ceeb4a89de3e888b4b1d85f46dd03b", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/9062cc6953ceeb4a89de3e888b4b1d85f46dd03b"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "html_url": "https://github.com/ronancpl/HeavenMS/commit/f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c16a4d908fe78c62cbc52a46c38ebd5204fadf6", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/2c16a4d908fe78c62cbc52a46c38ebd5204fadf6", "html_url": "https://github.com/ronancpl/HeavenMS/commit/2c16a4d908fe78c62cbc52a46c38ebd5204fadf6"}], "stats": {"total": 3246, "additions": 2363, "deletions": 883}, "files": [{"sha": "b0d48368cbc723da6d4366cc206819806f8fc43a", "filename": "docs/issues.txt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/docs/issues.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/docs/issues.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/issues.txt?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -10,6 +10,9 @@ Known issues:\n - If there are multiple bosses that shows HPBar on the map, if a player hits more than one the HPBar may start flickering on the screen.\n - Sometimes battleship may behave oddly with the enhanced buff system, making the character d/c in certain scenarios.\n - Dragon Roar doesn't show the stun effect to players.\n+- Cygnus job 'Final Attack' skills not functional.\n+- Steal skill doesn't deduct the loot from the drop pool from a mob.\n+- Using Shark Wave with Transformation on female thunderbreakers will cause consecutive attacks to proc immediately.\n - Snipe will show much higher damage value than actually applicable to the attacker.\n - Some monster status such as freeze and weapon/magic reflect doesn't behave properly in certain scenarios. Freeze seems to not work on mobs with low OID or are starters from server boot time.\n - On low-end connections, things such as command summoning a player that is currently logging in (already visible to other players) may cause the player to freeze, consequently freezing the account as well since the server-side disconnection doesn't happen."}, {"sha": "510964378517ed2deb0b9280fc8d538de91e1abb", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -2049,4 +2049,38 @@ Corrigido alguns danos de summons sendo calculados extremamente baixos quando o\n Corrigido funcionalidade de loot explosivo de mobs n\u00e3o aplicando devidamente.\n Corrigido linguagens, bastante usado na MCPQ, n\u00e3o utilizando o valor requisitado pelo jogador ao logar/trocar de canais.\n Corrigido casos de NPE ao tentar realizar updates de posi\u00e7\u00e3o lado-servidor em alguns summons de jogador.\n-Revisado reset de reatores em reatores que est\u00e3o desaparecidos por um tempo, para retornar de imediato.\n\\ No newline at end of file\n+Revisado reset de reatores em reatores que est\u00e3o desaparecidos por um tempo, para retornar de imediato.\n+\n+31 Julho 2019,\n+Revisado AP inicial de jogadores, agora mantendo dois sistemas para suprir a falta de 9 AP's. Ambos com AP's come\u00e7ando em 4/4/4/4: 0AP inicialmente, com ganhos de 4AP na primeira mudan\u00e7a de classe e 5AP na segunda mudan\u00e7a. Se n\u00e3o estiver usando esse m\u00e9todo, jogadores possuem de in\u00edcio 9 AP's \u00e0 disposi\u00e7\u00e3o.\n+\n+02 Agosto 2019,\n+Refatorado v\u00e1rios scripts de quests, n\u00e3o mais realizando disposes e envio de caixas de texto no mesmo status.\n+\n+05 Agosto 2019,\n+Revisado casos onde o sistema de recompensas de quests avisa \"invent\u00e1rio cheio\" mesmo embora novos espa\u00e7os pudessem ser encontrados na retirada de itens.\n+Corrigido posicionamento n\u00e3o-verificado de lojas criadas por jogadores.\n+Corrigido ganho reduzido de EXP ao utilizar skill Mortal Blow.\n+Corrigido clique em \"O\" na UI de recep\u00e7\u00e3o de itens pelo Duey n\u00e3o realizando a\u00e7\u00e3o alguma.\n+Corrigido representa\u00e7\u00e3o de \"quick\" na lista de pacotes recebidos pelo Duey n\u00e3o constando os pacotes enviados sem mensagem escrita.\n+Revisado certos casos onde itens enviados com \"quick delivery\" n\u00e3o conseguiam ser recebidos imediatamente.\n+\n+06 Agosto 2019,\n+Corrigido certas montarias n\u00e3o-ligadas a itens de invent\u00e1rio n\u00e3o atuando devidamente ao transicionar mapas (terceiros n\u00e3o conseguiam visualizar a montaria).\n+Revisado os v\u00e1rios scripts de quests anteriormente refatorado. Adi\u00e7\u00e3o: \u00faltimo if status sinalizando disposes de caixas de texto nos pen\u00faltimos status.\n+\n+08 - 10 Agosto 2019,\n+Adicionado handler para aplica\u00e7\u00e3o de dano em mobs por objetos de ambiente.\n+Revisado uso de Steal ao aplicar dano, preenchendo lista (e buscando evitar novas aplica\u00e7\u00f5es) assim que utilizado.\n+Setado checagem para limites de lobbyid ao se iniciar uma inst\u00e2ncia de evento.\n+Revisado boss logs somente removendo os itens da tabela a partir de um dia antes, n\u00e3o todas as entradas, assim que a tarefa de reset \u00e9 iniciada.\n+Refatorado elementos n\u00e3o-condizentes com o padr\u00e3o de design Factory na classe geradora de mapas.\n+Revisado poss\u00edvel cen\u00e1rio de vazamento de mem\u00f3ria ocorrido devido a exce\u00e7\u00e3o lan\u00e7ada em algum trecho entre removeKilledMonsterObject e dispatchMonsterKilled.\n+Aprimorado loots de reatores, agora colocando loots vis\u00edveis ao jogador no centro, similarmente a como loots de mobs ocorrem.\n+Ajustado frequ\u00eancia de loots de reatores para 200ms.\n+\n+12 - 14 Agosto 2019,\n+Refatorado v\u00e1rios casos de erros em acessos a fun\u00e7\u00f5es est\u00e1ticas a partir de scripts, que passou a ocorrer ap\u00f3s trocar de vers\u00e3o Java.\n+Corrigido listas que mant\u00e9m conte\u00fado dos mundos e canais esvaziando antes que os processos em execu\u00e7\u00e3o do TimerManager terminem de executar, no momento do sinal de shutdown do servidor.\n+Revisado update de quests para o jogador durante script de quests, problema permite movimento enquanto o mesmo ainda est\u00e1 falando com o NPC.\n+Revisado novamente os scripts de quest! Problema detectado envolvia incid\u00eancias de iniciar e completar de quests com disposes na mesma estrutura status.\n\\ No newline at end of file"}, {"sha": "2fe501b8c569b9c35210e3c3355ce3e27404cf92", "filename": "scripts/event/3rdJob_bowman.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_bowman.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_bowman.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_bowman.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 108010101;\n \n var eventTime = 20; //20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n         return lobbyRange;"}, {"sha": "9742e19f144a357e15aea40da627e49367b1b40c", "filename": "scripts/event/3rdJob_magician.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_magician.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_magician.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_magician.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 108010201;\n \n var eventTime = 20; //20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n         return lobbyRange;"}, {"sha": "5a04044b6630bfa0c278d84f6aa1bcc1ab3728dd", "filename": "scripts/event/3rdJob_mount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_mount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_mount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_mount.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -33,7 +33,7 @@ var eventMaps = [923010000];\n \n var eventTime = 5; //5 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "82e268496a8533ec271de7d9bbdc4118d1a2b72d", "filename": "scripts/event/3rdJob_pirate.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_pirate.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_pirate.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_pirate.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 108010501;\n \n var eventTime = 20; //20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n         return lobbyRange;"}, {"sha": "a940130997ed9c3f196166b75916f8202365972b", "filename": "scripts/event/3rdJob_thief.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_thief.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_thief.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_thief.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 108010401;\n \n var eventTime = 20; //20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n         return lobbyRange;"}, {"sha": "ce0e50da8270cb1ad5f2530b8993de6cf1935e16", "filename": "scripts/event/3rdJob_warrior.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_warrior.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/3rdJob_warrior.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_warrior.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 108010301;\n \n var eventTime = 20; //20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n         return lobbyRange;"}, {"sha": "95ec6c3e1f31abed64b01d6777e008bc480460d6", "filename": "scripts/event/4jaerial.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jaerial.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jaerial.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jaerial.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,7 +30,7 @@ var maxMapId = 912020000;\n \n var eventTime = 2; //2 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "17f62c4454da4922aa6b7d93c34bf9bceb55371c", "filename": "scripts/event/4jship.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jship.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jship.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jship.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,7 +30,7 @@ var maxMapId = 912010200;\n \n var eventTime = 4; //4 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "cffac5f48f2d97b7a0d7f36bca3db1a4e9d57e7a", "filename": "scripts/event/4jsuper.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jsuper.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/4jsuper.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jsuper.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,7 +30,7 @@ var maxMapId = 912010200;\n \n var eventTime = 4; //4 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "ce31cc64e59221f3cd2ba2c2cf31286f85d43461", "filename": "scripts/event/Aran_2ndmount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/Aran_2ndmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/Aran_2ndmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_2ndmount.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 921110000;\n \n var eventTime = 3; //3 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "c5c5058fae9d973df92999f226f4cf308635ad84", "filename": "scripts/event/Aran_3rdmount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/Aran_3rdmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/Aran_3rdmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_3rdmount.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 914030000;\n \n var eventTime = 3; //3 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "c69e05b52140738ad8977beaa55fa1f5b09e8f20", "filename": "scripts/event/BalrogQuest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/BalrogQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/BalrogQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogQuest.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,7 @@ var maxMapId = 910520000;\n \n var eventTime = 10;     //10 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function setLobbyRange() {\n     return lobbyRange;"}, {"sha": "415521505c0c047b38c8100d9d1025014c9ced10", "filename": "scripts/event/DelliBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/DelliBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/DelliBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/DelliBattle.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -35,7 +35,7 @@ var maxMapId = 925010300;\n \n var eventTime = 6;     // 6 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function init() {\n         setEventRequirements();"}, {"sha": "6a32a98b7b3b592e2b5d20be32689d30b293af7a", "filename": "scripts/event/ElementalBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/ElementalBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/ElementalBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ElementalBattle.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,7 +36,7 @@ var maxMapId = 922020100;\n \n var eventTime = 20;     // 20 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function init() {\n         setEventRequirements();"}, {"sha": "3d533e6740076accac565cba74d976bd7d2921f9", "filename": "scripts/event/MahaBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/MahaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/event/MahaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MahaBattle.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -33,7 +33,7 @@ var maxMapId = 914020000;\n \n var eventTime = 10;     // 10 minutes\n \n-var lobbyRange = [0, 0];\n+var lobbyRange = [0, 7];\n \n function init() {}\n "}, {"sha": "5ea75f4e3ad4a310e3bdab1baeced3bb7f88a1e9", "filename": "scripts/npc/2010007.js", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/2010007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/2010007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2010007.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -57,8 +57,10 @@ function action(mode, type, selection) {\n                 if (cm.getPlayer().getGuildId() < 1 || cm.getPlayer().getGuildRank() != 1) {\n                     cm.sendOk(\"You can only increase your Guild's capacity if you are the leader.\");\n                     cm.dispose();\n-                } else\n-                    cm.sendYesNo(\"Increasing your Guild capacity by #b5#k costs #b \" + cm.getPlayer().getGuild().getIncreaseGuildCost(cm.getPlayer().getGuild().getCapacity()) +\" mesos#k, are you sure you want to continue?\");\n+                } else {\n+                    var MapleGuild = Java.type(\"net.server.guild.MapleGuild\");  // thanks Conrad for noticing an issue due to call on a static method here\n+                    cm.sendYesNo(\"Increasing your Guild capacity by #b5#k costs #b \" + MapleGuild.getIncreaseGuildCost(cm.getPlayer().getGuild().getCapacity()) +\" mesos#k, are you sure you want to continue?\");\n+                }\n             }\n         } else if (status == 2) {\n             if (sel == 0 && cm.getPlayer().getGuildId() <= 0) {"}, {"sha": "7e4006775bcb1b6079887143e3a5252d3e3d699e", "filename": "scripts/npc/9201005.js", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201005.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -21,6 +21,8 @@\n \tMarriage NPC\n  */\n \n+importPackage(Packages.net.server.channel);\n+\n var status;\n var wid;\n var isMarrying;\n@@ -176,7 +178,7 @@ function action(mode, type, selection) {\n                                         if(resStatus > 0) {\n                                             cm.gainItem((weddingType) ? weddingEntryTicketPremium : weddingEntryTicketCommon, -1);\n \n-                                            var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n+                                            var expirationTime = Channel.getRelativeWeddingTicketExpireTime(resStatus);\n                                             cm.gainItem(weddingSendTicket,15,false,true,expirationTime);\n                                             partner.getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n \n@@ -251,7 +253,7 @@ function action(mode, type, selection) {\n                             if(cm.canHold(weddingSendTicket, 3)) {\n                                 cm.gainItem(5251100, -1);\n \n-                                var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n+                                var expirationTime = Channel.getRelativeWeddingTicketExpireTime(resStatus);\n                                 cm.gainItem(weddingSendTicket,3,false,true,expirationTime);\n                             } else {\n                                 cm.sendOk(\"Please have a free ETC slot available to get more invitations.\");"}, {"sha": "8d1813e23bbcb6c528be72b4ac1c8fa82cbdcbb1", "filename": "scripts/npc/9201008.js", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201008.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -21,6 +21,8 @@\n \tMarriage NPC\n  */\n \n+importPackage(Packages.net.server.channel);\n+\n var status;\n var wid;\n var isMarrying;\n@@ -176,7 +178,7 @@ function action(mode, type, selection) {\n                                         if(resStatus > 0) {\n                                             cm.gainItem((weddingType) ? weddingEntryTicketPremium : weddingEntryTicketCommon, -1);\n \n-                                            var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n+                                            var expirationTime = Channel.getRelativeWeddingTicketExpireTime(resStatus);\n                                             cm.gainItem(weddingSendTicket,15,false,true,expirationTime);\n                                             partner.getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n \n@@ -251,7 +253,7 @@ function action(mode, type, selection) {\n                             if(cm.canHold(weddingSendTicket, 3)) {\n                                 cm.gainItem(5251100, -1);\n \n-                                var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n+                                var expirationTime = Channel.getRelativeWeddingTicketExpireTime(resStatus);\n                                 cm.gainItem(weddingSendTicket,3,false,true,expirationTime);\n                             } else {\n                                 cm.sendOk(\"Please have a free ETC slot available to get more invitations.\");"}, {"sha": "8e6326a9a2d8ed86810776c9e315fc8c85ef399c", "filename": "scripts/npc/9201023.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201023.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -99,14 +99,14 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if(!cm.isQuestStarted(100400)) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201023# the fairy of Love.\");     // thanks Periwinks (LuckyStory) for noticing Nana's introducing themselves as Nana (H)\n                 cm.dispose();\n                 return;\n             }\n             \n             nanaLoc = getNanaLocation(cm.getPlayer());\n             if(nanaLoc == -1) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201023# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }"}, {"sha": "271cf7a75b24b48a55ee827dc4216bda3d831322", "filename": "scripts/npc/9201024.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201024.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201024.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201024.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -99,14 +99,14 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if(!cm.isQuestStarted(100400)) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201024# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }\n             \n             nanaLoc = getNanaLocation(cm.getPlayer());\n             if(nanaLoc == -1) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201024# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }"}, {"sha": "d284706f1838f5ba1732cd6c2ac3dbbd23ffe1f6", "filename": "scripts/npc/9201025.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201025.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201025.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201025.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -99,14 +99,14 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if(!cm.isQuestStarted(100400)) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201025# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }\n             \n             nanaLoc = getNanaLocation(cm.getPlayer());\n             if(nanaLoc == -1) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201025# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }"}, {"sha": "48d97f52a3a4e9a86f327ceba1ad111a060896e6", "filename": "scripts/npc/9201026.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201026.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201026.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201026.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -99,14 +99,14 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if(!cm.isQuestStarted(100400)) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201026# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }\n             \n             nanaLoc = getNanaLocation(cm.getPlayer());\n             if(nanaLoc == -1) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201026# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }"}, {"sha": "e02f52039edbcca6cf0d0e89de43c56c5f12b7e9", "filename": "scripts/npc/9201027.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201027.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9201027.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201027.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -99,14 +99,14 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if(!cm.isQuestStarted(100400)) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201027# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }\n             \n             nanaLoc = getNanaLocation(cm.getPlayer());\n             if(nanaLoc == -1) {\n-                cm.sendOk(\"Hello #b#h0##k, I'm #p9201001# the fairy of Love.\");\n+                cm.sendOk(\"Hello #b#h0##k, I'm #p9201027# the fairy of Love.\");\n                 cm.dispose();\n                 return;\n             }"}, {"sha": "a02e7870f6eeca2f3da3d39c1717485358638958", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -75,6 +75,7 @@ function writeFeatureTab_Quests() {\n         addFeature(\"Rewarding system now looks up for item stacking.\");\n         addFeature(\"3rd job quiz with all 40-question pool available.\");\n         addFeature(\"Item raising functional.\");\n+        addFeature(\"Cleared issue with player movement during NPC talk.\");\n }\n \n function writeFeatureTab_PlayerSocialNetwork() {\n@@ -295,7 +296,7 @@ function writeAllFeatures() {\n                 feature_cursor = [];\n \n                 var tabName = (tabs[i]).replace(re, \"\");\n-                eval(\"writeFeatureTab_\" + tabName)();\n+                this[\"writeFeatureTab_\" + tabName]();\n         \n                 feature_tree.push(feature_cursor);\n         }"}, {"sha": "64847fd2119a871a91882ff29e8791077ae32a65", "filename": "scripts/portal/party3_jailin.js", "status": "modified", "additions": 63, "deletions": 37, "changes": 100, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/portal/party3_jailin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/portal/party3_jailin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party3_jailin.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,46 +1,72 @@\n importPackage(Packages.tools);\n \n-function enter(pi) {\n-        var map = pi.getMap();\n+var leverSequenceExit = false;\n+\n+function enterLeverSequence(pi) {\n+    var map = pi.getMap();\n     \n-        var jailn = (pi.getMap().getId() / 10) % 10;\n-        var maxToggles = (jailn == 1) ? 7 : 6;\n-        \n-        var mapProp = pi.getEventInstance().getProperty(\"jail\" + jailn);\n-        \n-        if(mapProp == null) {\n-            var seq = 0;\n-            \n-            for(var i = 1; i <= maxToggles; i++) {\n-                if(Math.random() < 0.5) seq += (1 << i);\n-            }\n-            \n-            pi.getEventInstance().setProperty(\"jail\" + jailn, seq);\n-            mapProp = seq;\n+    var jailn = (pi.getMap().getId() / 10) % 10;\n+    var maxToggles = (jailn == 1) ? 7 : 6;\n+\n+    var mapProp = pi.getEventInstance().getProperty(\"jail\" + jailn);\n+\n+    if(mapProp == null) {\n+        var seq = 0;\n+\n+        for(var i = 1; i <= maxToggles; i++) {\n+            if(Math.random() < 0.5) seq += (1 << i);\n         }\n-        \n-        mapProp = Number(mapProp);\n-        if(mapProp != 0) {\n-            var countMiss = 0;\n-            for(var i = 1; i <= maxToggles; i++) {\n-                if(!(pi.getMap().getReactorByName(\"lever\" + i).getState() == (mapProp >> i) % 2)) {\n-                    countMiss++;\n-                }\n-            }\n-            \n-            if(countMiss > 0) {\n-                map.broadcastMessage(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n-                map.broadcastMessage(MaplePacketCreator.playSound(\"Party1/Failed\"));\n-                \n-                pi.playerMessage(5, \"The right combination of levers is needed to pass. \" + countMiss + \" lever(s) are misplaced.\");\n-                return false;\n+\n+        pi.getEventInstance().setProperty(\"jail\" + jailn, seq);\n+        mapProp = seq;\n+    }\n+\n+    mapProp = Number(mapProp);\n+    if(mapProp != 0) {\n+        var countMiss = 0;\n+        for(var i = 1; i <= maxToggles; i++) {\n+            if(!(pi.getMap().getReactorByName(\"lever\" + i).getState() == (mapProp >> i) % 2)) {\n+                countMiss++;\n             }\n-            \n-            map.broadcastMessage(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n-            map.broadcastMessage(MaplePacketCreator.playSound(\"Party1/Clear\"));\n-            pi.getEventInstance().setProperty(\"jail\" + jailn, \"0\");\n         }\n-        \n+\n+        if(countMiss > 0) {\n+            map.broadcastMessage(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n+            map.broadcastMessage(MaplePacketCreator.playSound(\"Party1/Failed\"));\n+\n+            pi.playerMessage(5, \"The right combination of levers is needed to pass. \" + countMiss + \" lever(s) are misplaced.\");\n+            return false;\n+        }\n+\n+        map.broadcastMessage(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n+        map.broadcastMessage(MaplePacketCreator.playSound(\"Party1/Clear\"));\n+        pi.getEventInstance().setProperty(\"jail\" + jailn, \"0\");\n+    }\n+\n+    pi.playPortalSound(); pi.warp(pi.getMapId() + 2,0);\n+    return true;\n+}\n+\n+function enterNoMobs(pi) {\n+    var map = pi.getMap();\n+    var mobcount = map.countMonster(9300044);\n+\n+    if (mobcount > 0) {\n+        pi.playerMessage(5, \"Please use the levers to defeat all the threats before you proceed.\");\n+        return false;\n+    } else {\n         pi.playPortalSound(); pi.warp(pi.getMapId() + 2,0);\n         return true;\n+    }\n+}\n+\n+function enter(pi) {\n+    var ret;\n+    if (leverSequenceExit) {\n+        ret = enterLeverSequence(pi);\n+    } else {\n+        ret = enterNoMobs(pi);\n+    }\n+\n+    return ret;\n }\n\\ No newline at end of file"}, {"sha": "6590a761e05e51337c26990ffd8eb93f0ac4a3a3", "filename": "scripts/quest/10940.js", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/10940.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/10940.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/10940.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -10,14 +10,15 @@ function start(mode, type, selection) {\n             status++;\n         else\n             qm.dispose();\n-        if (status == 0)\n+        if (status == 0) {\n             qm.sendAcceptDecline(\"Hello, #h0#. Welcome to Maple World. It's currently event season, and we're welcome new characters with a gift. Would you like your gift now?\");\n-        else if (status == 1) {\n+        } else if (status == 1) {\n+            qm.sendOk(\"Open your inventory and double-click on it! These gifts will make you look stylish. Oh, one more thing! You'll get another gift at level 30. Good luck!\");\n             qm.forceStartQuest();\n \t    qm.forceCompleteQuest();\n             qm.gainItem(2430191, 1, true);\n-\t    qm.sendOk(\"Open your inventory and double-click on it! These gifts will make you look stylish. Oh, one more thing! You'll get another gift at level 30. Good luck!\");\n-\t    qm.dispose();\n+        } else if (status == 2) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "8284cc250dce4dcfdd834879e5496a0bcf580925", "filename": "scripts/quest/20002.js", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20002.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -44,13 +44,16 @@ function start(mode, type, selection) {\n         else if (status == 2)\n             qm.sendAcceptDecline(\"Ah, I don't know if you are aware of this, but you won't find any monsters here in Ereve. Any form of evil will not be able to set foot on this island. Don't worry, you'll still have your opportunity to train here. Shinsoo created a fantasy creature called Mimi, which will be used as your training partners. Shall we begin?\");\n         else if (status == 3) {\n+            qm.forceStartQuest();\n+            qm.forceCompleteQuest();\n+\n             qm.gainExp(60);\n             qm.gainItem(2000020, 10); // Red Potion for Noblesse * 10\n             qm.gainItem(2000021, 10); // Blue Potion for Noblesse * 10\n             qm.gainItem(1002869, 1);  // Elegant Noblesse Hat * 1\n+\n             qm.sendOk(\"Ha, I like your enthusiasm, but you must prepare yourself for the training first before we start things off. Make sure that you are equipped with weapons, and that your skills are calibrated and ready to be used. I also gave you some potions, so have it ready just in case. Let me know when you're ready. You're going to wish that you didn't sign up to become a Cygnus Knight.\");\n-            qm.forceStartQuest();\n-            qm.forceCompleteQuest();\n+        } else if (status == 4) {\n             qm.dispose();\n         }\n     }"}, {"sha": "e5d7d9d6179a2522f55f33cdcde5277b1481c726", "filename": "scripts/quest/20008.js", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20008.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -34,17 +34,21 @@ function start(mode, type, selection) {\n     if (mode < 1) {\n         qm.dispose();\n     } \n-    if (mode > 0)\n+    else if (mode > 0)\n         status++;\n     if (status == 0)\n         qm.sendSimple(\"Are you ready to take on a mission? If you can't pass this test, then you won't be able to call yourself a real Knight. Are you sure you can do this? If you are afraid to do this, let me know. I won't tell Neinheart. \\r\\n #L0#I'll try this later.#l \\r\\n #L1#I'm not afraid. Let's do this.#l\");\n-    else if (selection == 0) {\n-        qm.sendNext(\"If you call yourself a Knight, then do not hesitate. Show everyone how much courage you have in you.\");\n+    else if (status == 1) {\n+        if (selection == 0) {\n+            qm.sendNext(\"If you call yourself a Knight, then do not hesitate. Show everyone how much courage you have in you.\");\n+            qm.dispose();\n+        } else if (selection == 1) {\n+            choice1 = selection;\n+            qm.sendSimple(\"I'm glad you didn't run away, but... are you sure you want to become a Knight-in-Training? What I am asking is whether you're okay with being a Cygnus Knight, and therefore being tied to the Empress at all times? She may be an Empress, but she's also still just a kid. Are you sure you can fight for her? I won't let Neinheart know so just tell me what you really feel. \\r\\n #L2#If the Empress wants peace in the Maple World, then I'm down for whatever.#l \\r\\n #L3#As long as I can become a knight I'll endure whatever #l\");\n+            qm.forceStartQuest();\n+            qm.forceCompleteQuest();\n+        }\n+    } else if (status == 2) {\n         qm.dispose();\n-    } else if (selection == 1) {\n-        choice1 = selection;\n-        qm.sendSimple(\"I'm glad you didn't run away, but... are you sure you want to become a Knight-in-Training? What I am asking is whether you're okay with being a Cygnus Knight, and therefore being tied to the Empress at all times? She may be an Empress, but she's also still just a kid. Are you sure you can fight for her? I won't let Neinheart know so just tell me what you really feel. \\r\\n #L2#If the Empress wants peace in the Maple World, then I'm down for whatever.#l \\r\\n #L3#As long as I can become a knight I'll endure whatever #l\");\n-        qm.forceStartQuest();\n-        qm.forceCompleteQuest();\n     }\n }\n\\ No newline at end of file"}, {"sha": "9d6e0f190395494953194b2efe896b7f8f60e6c3", "filename": "scripts/quest/20016.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20016.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -50,9 +50,10 @@ function start(mode, type, selection) {\n     } else if (status == 11) {\n     \tqm.sendNextPrev(\"But no one starts as a strong Knight on day one. The Empress didn't want someone strong. She wanted someone with courage whom she could develop into a strong Knight through rigorous training. So, you should first become a Knight-in-Training. We'll talk about your missions when you get to that point.\");\n     } else if (status == 12) {\n-    \tqm.sendPrev(\"Take the portal on the left to reach the Training Forest. There, you will find #p1102000#, the Training Instructor, who will teach you how to become stronger. I don't want to find you wandering around aimlessly until you reach Lv. 10, you hear?\");\n     \tqm.forceCompleteQuest();\n-    \tqm.dispose();\n+        qm.sendPrev(\"Take the portal on the left to reach the Training Forest. There, you will find #p1102000#, the Training Instructor, who will teach you how to become stronger. I don't want to find you wandering around aimlessly until you reach Lv. 10, you hear?\");\n+    } else if (status == 13) {\n+        qm.dispose();\n     }\n }\n "}, {"sha": "697eba843d25588c898b96d2f8bb718533640825", "filename": "scripts/quest/20100.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20100.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -39,9 +39,11 @@ function start(mode, type, selection) {\n     if (status == 0)\n         qm.sendAcceptDecline(\"Ahhh, you're back. I can see that you're at level 10 now. It looks like you're flashing a glimmer of hope towards becoming a Knight. The basic training has now ended, and it's time for you to make the decision.\");\n     else if (status == 1) {\n-        qm.sendOk(\"Now look to the left. The leaders of the Knights will be waiting for you. There will be 5 paths for you to choose from. All you need to do is choose one of them. All 5 of them will lead you to the path of a Knight, so... I suggest you pay attention to what each path offers, and select the one you'd most like to take.\");\n         qm.forceStartQuest();\n         qm.forceCompleteQuest();\n+        \n+        qm.sendOk(\"Now look to the left. The leaders of the Knights will be waiting for you. There will be 5 paths for you to choose from. All you need to do is choose one of them. All 5 of them will lead you to the path of a Knight, so... I suggest you pay attention to what each path offers, and select the one you'd most like to take.\");\n+    } else if (status == 2) {\n         qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "5c4fb9ea9c05cbf9b3174782283ed488499f5ecb", "filename": "scripts/quest/20101.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20101.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -49,6 +49,7 @@ function end(mode, type, selection) {\n     \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Dawn Warrior, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n-    \tqm.dispose();\n+    } else if (status == 6) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "852b4d733745028efbdf4fd6b2339464f68acdf6", "filename": "scripts/quest/20102.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20102.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -49,6 +49,7 @@ function end(mode, type, selection) {\n     \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Blaze Wizard, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n-    \tqm.dispose();\n+    } else if (status == 6) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "2c119025c2165f056fecb83453f6a24193443f2d", "filename": "scripts/quest/20103.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20103.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20103.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20103.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -50,6 +50,7 @@ function end(mode, type, selection) {\n     \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Wind Archer, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n-    \tqm.dispose();\n+    } else if (status == 6) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "3957ff6101fc95b40312808cb89fdc0c8866aa6e", "filename": "scripts/quest/20104.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20104.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20104.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20104.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -50,6 +50,7 @@ function end(mode, type, selection) {\n     \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Night Walker, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n-    \tqm.dispose();\n+    } else if (status == 6) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "5d957edb9dad068604469a69516338079a24050e", "filename": "scripts/quest/20105.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20105.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20105.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20105.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -49,6 +49,7 @@ function end(mode, type, selection) {\n     \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Thunder Breaker, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n-    \tqm.dispose();\n+    } else if (status == 6) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "a1a0752699400464dfe53298bd41a36d59645a29", "filename": "scripts/quest/20200.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20200.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20200.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20200.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -44,7 +44,9 @@ function start(mode, type, selection) {\n         } else if (status == 1) {\n             qm.startQuest();\n             qm.completeQuest();\n+            \n             qm.sendOk(\"If you wish to take the Knighthood Exam, please come to Ereve. Each Chief Knight will test your abilities, and if you meet their standards, then you will officially become a Knight.\");\n+        } else if (status == 2) {\n             qm.dispose();\n         }\n     }"}, {"sha": "4075738092721fea2da317292f607b79acfab0f0", "filename": "scripts/quest/20311.js", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20311.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20311.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20311.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,19 +48,18 @@ function start(mode, type, selection) {\n             nPSP = (qm.getPlayer().getLevel() - 70) * 3;\n             if (qm.getPlayer().getRemainingSp() > nPSP) {\n                 qm.sendNext(\"You still have way too much #bSP#k with you. You can't earn a new title like that, I strongly urge you to use more SP on your 1st and 2nd level skills.\");\n-                qm.dispose();\n             } else {\n                 if (!qm.canHold(1142068)) {\n                     qm.sendNext(\"If you wish to receive the medal befitting the title, you may want to make some room in your equipment inventory.\");\n-                    qm.dispose();\n                 } else {\n+                    qm.completeQuest();\n                     qm.gainItem(1142068, 1);\n                     qm.getPlayer().changeJob(Packages.client.MapleJob.DAWNWARRIOR3);\n                     qm.sendOk(\"#h #, as of this moment, you are an Advanced Knight. From this moment on, you shall carry yourself with dignity and respect befitting your new title, an Advanced Knight of Cygnus Knights. May your glory continue to shine as bright as this moment.\");\n-                    qm.completeQuest();\n-                    qm.dispose();\n                 }\n             }\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "b562dea87ef385214c7f8d9e2f83a93113122062", "filename": "scripts/quest/20312.js", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20312.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20312.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20312.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,20 +48,18 @@ function start(mode, type, selection) {\n             nPSP = (qm.getPlayer().getLevel() - 70) * 3;\n             if (qm.getPlayer().getRemainingSp() > nPSP) {\n                 qm.sendNext(\"You still have way too much #bSP#k with you. You can't earn a new title like that, I strongly urge you to use more SP on your 1st and 2nd level skills.\");\n-                qm.dispose();\n             } else {\n                 if (!qm.canHold(1142068)) {\n                     qm.sendNext(\"If you wish to receive the medal befitting the title, you may want to make some room in your equipment inventory.\");\n-                    qm.dispose();\n                 } else {\n+                    qm.completeQuest();\n                     qm.gainItem(1142068, 1);\n                     qm.getPlayer().changeJob(Packages.client.MapleJob.BLAZEWIZARD3);\n                     qm.sendOk(\"#h #, as of this moment, you are an Advanced Knight. From this moment on, you will train yourself with fervor as you will lead your group of Knights for the safety of this world. That fervor will provide you with plenty of courage.\");\n-                    qm.completeQuest();\n-                    qm.dispose();\n                 }\n             }\n-\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "58e7a89064ca5eb4703894d1cf06df59489a50c6", "filename": "scripts/quest/20313.js", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20313.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20313.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20313.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,20 +48,18 @@ function start(mode, type, selection) {\n             nPSP = (qm.getPlayer().getLevel() - 70) * 3;\n             if (qm.getPlayer().getRemainingSp() > nPSP) {\n                 qm.sendNext(\"You still have way too much #bSP#k with you. You can't earn a new title like that, I strongly urge you to use more SP on your 1st and 2nd level skills.\");\n-                qm.dispose();\n             } else {\n                 if (!qm.canHold(1142068)) {\n                     qm.sendNext(\"If you wish to receive the medal befitting the title, you may want to make some room in your equipment inventory.\");\n-                    qm.dispose();\n                 } else {\n+                    qm.completeQuest();\n                     qm.gainItem(1142068, 1);\n                     qm.getPlayer().changeJob(Packages.client.MapleJob.WINDARCHER3);\n                     qm.sendOk(\"#h #, as of this moment, you are an Advanced Knight. From this moment on, you will be carrying a while lot of responsibility befitting your new title as an Advanced Knight of Cygnus Knights. You may view the world in a carefree mode, but please remember what your mission is.\");\n-                    qm.completeQuest();\n-                    qm.dispose();\n                 }\n             }\n-\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "be6c955c90c18d4cfad5cd27dbf76d1bee70dd39", "filename": "scripts/quest/20314.js", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20314.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20314.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20314.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,20 +48,18 @@ function start(mode, type, selection) {\n             nPSP = (qm.getPlayer().getLevel() - 70) * 3;\n             if (qm.getPlayer().getRemainingSp() > nPSP) {\n                 qm.sendNext(\"You still have way too much #bSP#k with you. You can't earn a new title like that, I strongly urge you to use more SP on your 1st and 2nd level skills.\");\n-                qm.dispose();\n             } else {\n                 if (!qm.canHold(1142068)) {\n                     qm.sendNext(\"If you wish to receive the medal befitting the title, you may want to make some room in your equipment inventory.\");\n-                    qm.dispose();\n                 } else {\n                     qm.gainItem(1142068, 1);\n                     qm.getPlayer().changeJob(Packages.client.MapleJob.NIGHTWALKER3);\n-                    qm.sendOk(\"#h #, from here on out, you are an Advanced Knight of Cygnus Knights. The title comes with a newfound broad view on everything. You may encounter temptations here and there, but I want you to keep your faith and beliefs intact and do not succumb to the darkness.\");\n                     qm.completeQuest();\n-                    qm.dispose();\n+                    qm.sendOk(\"#h #, from here on out, you are an Advanced Knight of Cygnus Knights. The title comes with a newfound broad view on everything. You may encounter temptations here and there, but I want you to keep your faith and beliefs intact and do not succumb to the darkness.\");\n                 }\n             }\n-\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "073fc6da8bd2377117f2e54ff4c19cfe17ce55bc", "filename": "scripts/quest/20315.js", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20315.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20315.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20315.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,20 +48,18 @@ function start(mode, type, selection) {\n             nPSP = (qm.getPlayer().getLevel() - 70) * 3;\n             if (qm.getPlayer().getRemainingSp() > nPSP) {\n                 qm.sendNext(\"You still have way too much #bSP#k with you. You can't earn a new title like that, I strongly urge you to use more SP on your 1st and 2nd level skills.\");\n-                qm.dispose();\n             } else {\n                 if (!qm.canHold(1142068)) {\n                     qm.sendNext(\"If you wish to receive the medal befitting the title, you may want to make some room in your equipment inventory.\");\n-                    qm.dispose();\n                 } else {\n                     qm.gainItem(1142068, 1);\n                     qm.getPlayer().changeJob(Packages.client.MapleJob.THUNDERBREAKER3);\n-                    qm.sendOk(\"#h #, from here on out, you will become an Advanced Knight of the Knights of Cygnus! As your standing rises, so does the difficulty of the tasks you will be receiving. But challenge is good, right? You have to enjoy life. Enjoy what's given to you!\");\n                     qm.completeQuest();\n-                    qm.dispose();\n+                    qm.sendOk(\"#h #, from here on out, you will become an Advanced Knight of the Knights of Cygnus! As your standing rises, so does the difficulty of the tasks you will be receiving. But challenge is good, right? You have to enjoy life. Enjoy what's given to you!\");\n                 }\n             }\n-\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "37105e5b12da262ff0a185328e62ece2e7653087", "filename": "scripts/quest/2034.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2034.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2034.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2034.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,7 +1,6 @@\n importPackage(Packages.client);\n \n var item;\n-var stance;\n var status = -1;\n var item;\n \n@@ -23,8 +22,7 @@ function end(mode, type, selection) {\n \t\treturn;\n \t    }\n \n-            stance = qm.getPlayer().getJobStyle();\n-            \n+            var stance = qm.getPlayer().getJobStyle();\n             if(stance == Packages.client.MapleJob.WARRIOR) item = 1072003;\n             else if(stance == Packages.client.MapleJob.MAGICIAN) item = 1072077;\n             else if(stance == Packages.client.MapleJob.BOWMAN || stance == Packages.client.MapleJob.CROSSBOWMAN) item = 1072081;\n@@ -34,11 +32,13 @@ function end(mode, type, selection) {\n          \n             qm.gainItem(item, 1);\n             qm.gainItem(4000007, -150);\n-            \n             qm.gainExp(2200);\n             qm.completeQuest();\n             \n             qm.sendOk(\"Alright, if you need work sometime down the road, feel free to come back and see me. This town sure can use a person like you for help~\");\n+        }\n+\n+        else if (status == 2) {\n             qm.dispose();\n-\t}\n+        }\n }\n\\ No newline at end of file"}, {"sha": "6f1c5e193d243fd733cdd8ee0bcc3c8d257829c7", "filename": "scripts/quest/20520.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20520.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20520.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20520.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -44,6 +44,7 @@ function start(mode, type, selection) {\n \t\tqm.forceStartQuest();\n \t\tqm.forceCompleteQuest();\n \t\tqm.sendOk(\"There's a special mount that only the Cygnus Knights can enjoy. If you are interested, visit #bEreve#k. I will give you more information on it.\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 3) {\n+            qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "862c2bf98fa7fcae57b4563fe8e4e57da46602a9", "filename": "scripts/quest/20522.js", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20522.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20522.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20522.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -54,6 +54,7 @@ function start(mode, type, selection) {\n         qm.forceStartQuest();\n         if(!qm.haveItem(4220137)) qm.gainItem(4220137);\n \tqm.sendOk(\"Mimiana's egg can be raised by #bsharing your daily experiences with it#k. Once Mimiana fully grows up, please come see me.\");\n+    } else if (status == 4) {\n \tqm.dispose();\n     }\n }\n@@ -70,17 +71,15 @@ function end(mode, type, selection) {\n     } else if (status == 1) {   //pretty sure there would need to have an egg EXP condition... Whatever.\n         if(!qm.haveItem(4220137)) {\n             qm.sendOk(\"I see, you lost your egg... You need to be more careful when raising a baby Mimiana!\");\n-            qm.dispose();\n             return;\n         }\n         \n-\tqm.sendOk(\"Oh, were you able to awaken Mimiana Egg? That's amazing... Most knights can't even dream of awakening it in such a short amount of time.\");\n-        \n-        qm.forceCompleteQuest();\n+\tqm.forceCompleteQuest();\n         qm.gainItem(4220137, -1);\n         qm.gainExp(37600);\n-        \n-\tqm.dispose();\n+        qm.sendOk(\"Oh, were you able to awaken Mimiana Egg? That's amazing... Most knights can't even dream of awakening it in such a short amount of time.\");\n+    } else if (status == 2) {\n+        qm.dispose();\n     }\n }\n "}, {"sha": "440581b89a35295bce0de6d52aef507b9c041106", "filename": "scripts/quest/20526.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20526.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20526.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20526.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -55,6 +55,7 @@ function start(mode, type, selection) {\n         \n         if(!qm.haveItem(4220137)) qm.gainItem(4220137);\n \tqm.sendOk(\"Mimiana's egg can be raised by #bsharing your daily experiences with it#k. Once Mimiana fully grows up, please come see me. One more thing, I talked with #p2060005# beforehand and retrieved the #b#t4032117##k for you. The price to charge remains the same: #r10,000,000 mesos#k.\");\n+    } else if (status == 4) {\n \tqm.dispose();\n     }\n }\n@@ -80,14 +81,13 @@ function end(mode, type, selection) {\n             return;\n         }\n         \n-\tqm.sendOk(\"Okay, you now may mount Mimiana again. Take good care of it this time.\");\n-        \n+        qm.forceCompleteQuest();\n         qm.gainItem(1902005, 1);\n         qm.gainItem(4220137, -1);\n         qm.gainMeso(-10000000);\n-        \n-        qm.forceCompleteQuest();\n-\tqm.dispose();\n+        qm.sendOk(\"Okay, you now may mount Mimiana again. Take good care of it this time.\");\n+    } else if (status == 2) {\n+        qm.dispose();\n     }\n }\n "}, {"sha": "b6ebc5419894e2c045f03d2cdd57e7daeaf8205e", "filename": "scripts/quest/20527.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20527.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20527.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20527.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,12 +38,12 @@ function start(mode, type, selection) {\n             var mount = qm.getPlayer().getMount();\n             \n             if(mount != null && mount.getLevel() >= 3) {\n-                qm.sendNext(\"Alright, I'll get you started in how to train Mimio, the next step for Mimianas. When you're ready, talk to me again.\");\n                 qm.forceCompleteQuest();\n+                qm.sendNext(\"Alright, I'll get you started in how to train Mimio, the next step for Mimianas. When you're ready, talk to me again.\");\n             } else {\n                 qm.sendNext(\"It looks like your Mimiana haven't reached #rlevel 3#k yet. Please train it a bit more before trying to advance it.\");\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "cee458fe5e8d0f3c93870bd6e7b4b61fe4278191", "filename": "scripts/quest/20600.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20600.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20600.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20600.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -9,7 +9,7 @@ function start(mode, type, selection) {\n \n     if (status == 0) {\n     \tqm.sendAcceptDecline(\"#h0#. Have you been slacking off on training since reaching Level 100? We all know how powerful you are, but the training is not complete. Take a look at these Knight Commanders. They train day and night, preparing themselves for the possible encounter with the Black Mage.\");\n-    } else {\n+    } else if (status == 1) {\n \tif (mode == 1) {\n \t    qm.forceStartQuest();\n \t}"}, {"sha": "3f15cbab65504ba435795add22e6cd9d090e1661", "filename": "scripts/quest/20610.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20610.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/20610.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20610.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -14,8 +14,10 @@ function start(mode, type, selection) {\n \t    qm.sendOk(\"Well, what you're doing right now doesn't make you look like someone that's humble. You just look complacent by doing that, and that's never a good thing.\");\n \t} else {\n \t    qm.forceStartQuest();\n+            qm.dispose();\n \t}\n-\tqm.dispose();\n+    } else if (status == 2) {\n+        qm.dispose();\n     }\n }\n "}, {"sha": "736aea907817b46095f60e9aaced2e4262fd730a", "filename": "scripts/quest/21011.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21011.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,8 +48,9 @@ function start(mode, type, selection) {\n     } else if (status == 4) {\n \tqm.forceStartQuest();\n \tqm.sendOk(\"My brother #bPuir #kis just down the street, and he's been dying to meet you! I know you're busy, but could you please stop by and say hello to Puir? Please...\");\n+    } else if (status == 5) {\n \tqm.dispose();\n-\t}\n+    }\n }\n \n function end(mode, type, selection) {\n@@ -83,7 +84,7 @@ function end(mode, type, selection) {\n \t\tqm.sendNext(\"#b(Your skills are nowhere close to being hero-like... But a sword? Have you ever even held a sword in your lifetime? You can't remember... How do you even equip it?)\", 3);\n \t}else\n \t\tqm.dropMessage(1,\"Your inventory is full\");   \n-\t} else if (status == 6) {\n+    } else if (status == 6) {\n \t\tqm.guideHint(16); \n \t\tqm.dispose();\n     }"}, {"sha": "6b1e3910631659b4d4b26cd8e5e27e9527bc2504", "filename": "scripts/quest/21012.js", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21012.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -71,14 +71,16 @@ function end(mode, type, selection) {\n         if(qm.isQuestCompleted(21012))\n             qm.dropMessage(1,\"Unknown Error\");\t\t\n         else if(qm.canHold(2000022) && qm.canHold(2000023)){\n+            qm.forceCompleteQuest();\n             qm.gainExp(57);\n             qm.gainItem(2000022, 10);\n             qm.gainItem(2000023, 10);\n-            qm.forceCompleteQuest();\n \t    qm.sendOk(\"#b(Even if you're really the hero everyone says you are... What good are you without any skills?)\", 3);\n-            qm.dispose();\n-\t}else\n+\t} else {\n             qm.dropMessage(1,\"Your inventory is full\");  \n-\t    qm.dispose();\t\n+\t    qm.dispose();\n+        }\n+    } else if (status == 2) {\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "ae758bccc55e0bc080f23d8e7c762de507f0cdc4", "filename": "scripts/quest/21013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21013.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -73,7 +73,7 @@ function end(mode, type, selection) {\n \t\t\tqm.gainItem(4032309, -1);\n \t\t\tqm.gainItem(4032310, -1);\n             qm.gainItem(3010062, 1);\n-\t    qm.sendNextPrev(\"Here, a fully-assembled chair, just for you! I've always wanted to give you a chair as a gift, because I know a hero can occasionally use some good rest. Tee hee.\", 9);\t\n+\t    qm.sendNext(\"Here, a fully-assembled chair, just for you! I've always wanted to give you a chair as a gift, because I know a hero can occasionally use some good rest. Tee hee.\", 9);\t\n     } else if (status == 2) { \n \tqm.sendNext(\"A hero is not invincible. A hero is human. I'm sure you will face challenges and even falter at times. But you are a hero because you have what it takes to overcome any obstacles you may encounter.\", 9);\n     } else if (status == 3) { "}, {"sha": "475a81af996fd9b1a25c681c0efb75085716efc0", "filename": "scripts/quest/21100.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21100.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,6 +31,7 @@ function start(mode, type, selection) {\n \t\t\tqm.sendOk(\"If the #p1201001# reacts to you, then we'll know that you're #bAran#k, the hero that wielded a #p1201001#.\", 8);\n \t\t\tqm.showIntro(\"Effect/Direction1.img/aranTutorial/ClickPoleArm\");\n \t\t}\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 8) {\n+            qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "c7e7bb101d6171a1fe0ed470236df24b0abd7b63", "filename": "scripts/quest/21200.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21200.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21200.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21200.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -35,6 +35,7 @@ function start(mode, type, selection) {\n         qm.sendAcceptDecline(\"How is the training going? Wow, you've reached such a high level! That's amazing. I knew you would do just fine on Victoria Island... Oh, look at me. I'm wasting your time. I know you're busy, but you'll have to return to the island for a bit.\");\n     else if(status == 1){\n         qm.sendOk(\"Your #b#p1201001##k in #b#m140000000##k is acting strange all of a sudden. According to the records, the Polearm acts this way when it is calling for its master. #bPerhaps it's calling for you#k. Please return to the island and check things out.\");\n+    } else if(status == 2){\n         qm.startQuest();\n         qm.dispose();\n     }"}, {"sha": "db80f5d8e1b37746a4d0288192841505d82c96aa", "filename": "scripts/quest/21201.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21201.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21201.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21201.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -60,7 +60,6 @@ function end(mode, type, selection) {\n             if(!qm.isQuestCompleted(21201)) {\n                 if(!qm.canHold(1142130)) {\n                     qm.sendOk(\"Wow, your #bequip#k inventory is full. I need you to make at least 1 empty slot to complete this quest.\");   // thanks MedicOP for finding an issue here\n-                    qm.dispose();\n                     return;\n                 }\n \n@@ -78,6 +77,7 @@ function end(mode, type, selection) {\n             }\n \n             qm.sendNext(\"Your level isn't what it used to be back in your glory days, so I can't restore all of your old abilities. But the few I can restore should help you level up faster. Now hurry up and train so you can return to the old you.\");    \n+        } else if (status == 9) {\n             qm.dispose();\n         }\n     }"}, {"sha": "4d0591fb01d5d616d621ec12751d684c7eb9621d", "filename": "scripts/quest/21202.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21202.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21202.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21202.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -42,7 +42,7 @@ function start(mode, type, selection) {\n         qm.sendAcceptDecline(\"I'm too old to make weapons now, but.. I do have a Polearm that I made way back when. It's still in excellent shape. But I can't give it to you because that Polearm is extremely sharp, so sharp it could hurt its master. Do you still want it?\");\n     } else if(status == 5) {\n         qm.sendOk(\"Well, if you say so.. I can't object to that. I'll tell you what. I'll give you a quick test, and if you pass it, the Giant Polearm is yours. Head over to the #bTraining Center#k and take on the #rScarred Bears#k that are there. Your job is to bring back #b30 Sign of Acceptances#k.\");\n-    } else {\n+    } else if(status == 6) {\n         qm.startQuest();\n         qm.dispose();\n     }"}, {"sha": "451b5f41310889e3d41fd5b711d8dc8f6a18c143", "filename": "scripts/quest/2124.js", "status": "modified", "additions": 25, "deletions": 10, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2124.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2124.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2124.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,15 +24,30 @@\n */\n \n function end(mode, type, selection) {\n-    \n-    if(!qm.haveItem(4031619, 1)) {\n-        qm.sendOk(\"Please bring me the box with the supplies that lies with #b#p2012019##k...\");\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(!qm.haveItem(4031619, 1)) {\n+                qm.sendOk(\"Please bring me the box with the supplies that lies with #b#p2012019##k...\");\n+            }\n+            else {\n+                qm.gainItem(4031619, -1);\n+                qm.sendOk(\"Oh, you brought #p2012019#'s box! Thank you.\");\n+                qm.forceCompleteQuest();\n+            }\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n     }\n-    else {\n-        qm.gainItem(4031619, -1);\n-        qm.sendOk(\"Oh, you brought #p2012019#'s box! Thank you.\");\n-        qm.forceCompleteQuest();\n-    }\n-    \n-    qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "451b5f41310889e3d41fd5b711d8dc8f6a18c143", "filename": "scripts/quest/2126.js", "status": "modified", "additions": 25, "deletions": 10, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2126.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2126.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2126.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,15 +24,30 @@\n */\n \n function end(mode, type, selection) {\n-    \n-    if(!qm.haveItem(4031619, 1)) {\n-        qm.sendOk(\"Please bring me the box with the supplies that lies with #b#p2012019##k...\");\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(!qm.haveItem(4031619, 1)) {\n+                qm.sendOk(\"Please bring me the box with the supplies that lies with #b#p2012019##k...\");\n+            }\n+            else {\n+                qm.gainItem(4031619, -1);\n+                qm.sendOk(\"Oh, you brought #p2012019#'s box! Thank you.\");\n+                qm.forceCompleteQuest();\n+            }\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n     }\n-    else {\n-        qm.gainItem(4031619, -1);\n-        qm.sendOk(\"Oh, you brought #p2012019#'s box! Thank you.\");\n-        qm.forceCompleteQuest();\n-    }\n-    \n-    qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "822ace878866ede6f5e9bc2227a8a34965a5072f", "filename": "scripts/quest/2127.js", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2127.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2127.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2127.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,8 +24,24 @@\n */\n \n function end(mode, type, selection) {\n-    qm.sendOk(\"I see you're ready for the task. Now, pay heed to the details of your mission...\");\n-    qm.forceCompleteQuest();\n-    \n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendOk(\"I see you're ready for the task. Now, pay heed to the details of your mission...\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "e0c454d6126a8dccb1c6d61043cb938ef8e9ac37", "filename": "scripts/quest/21300.js", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21300.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21300.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21300.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -11,13 +11,14 @@ function start(mode, type, selection) {\n         return;\n     }\n \t\n-\tif (status == 0) {\n-        qm.sendNext(\"How's the training going? Hmmm... Level 70... That's still not much, but you have really made some strides since the first time I met you fresh out of ice. Keep training, and I am sure one day you'll be able to regain your pre-battle form.\");\n+    if (status == 0) {\n+            qm.sendNext(\"How's the training going? Hmmm... Level 70... That's still not much, but you have really made some strides since the first time I met you fresh out of ice. Keep training, and I am sure one day you'll be able to regain your pre-battle form.\");\n     } else if (status == 1) {\n-\t\tqm.sendAcceptDecline(\"But before doing that, I'll need you back in Rein for a bit. #bYour pole arm is reacting strange once again. It looks like it has something it wants to tell you. #kIt might be able to awaken your hidden powers, so please come immediately.\");\n-\t} else if (status == 2) {\n-\t\tqm.sendOk(\"Anyway, I thought it was really something that a weapon has its own identity, but seriously... this weapon does not stop talking. It first kept on crying because I wasn't really paying attention to its needs, and... ahh, please keep this a secret from the pole arm. I don't think it's a good idea to upset the weapon any further.\");\n-\t\tqm.forceStartQuest();\n-\t\tqm.dispose();\n-\t}\n+            qm.sendAcceptDecline(\"But before doing that, I'll need you back in Rein for a bit. #bYour pole arm is reacting strange once again. It looks like it has something it wants to tell you. #kIt might be able to awaken your hidden powers, so please come immediately.\");\n+    } else if (status == 2) {\n+            qm.forceStartQuest();\n+            qm.sendOk(\"Anyway, I thought it was really something that a weapon has its own identity, but seriously... this weapon does not stop talking. It first kept on crying because I wasn't really paying attention to its needs, and... ahh, please keep this a secret from the pole arm. I don't think it's a good idea to upset the weapon any further.\");\n+    } else if (status == 3) {\n+            qm.dispose();\n+    }\n }\n\\ No newline at end of file"}, {"sha": "e9077098d67b599b9b9b7d836f33983d3b404fa9", "filename": "scripts/quest/21301.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21301.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21301.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21301.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,8 +24,9 @@ function end(mode, type, selection) {\n \t} else if (status == 5) {\n \t\tqm.sendNextPrev(\"...No hope, no dreams... Nooooo!!\");\n \t} else if (status == 6) {\n-\t\tqm.sendNextPrev(\"#b(Maha is beginning to really get hysterical. I better leave right this minute. Maybe Lirin can do something about it.)\", 2);\n \t\tqm.completeQuest();\n-\t\tqm.dispose();\n-\t}\n+                qm.sendNextPrev(\"#b(Maha is beginning to really get hysterical. I better leave right this minute. Maybe Lilin can do something about it.)\", 2);\n+\t} else if (status == 7) {\n+            qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "69a40ee7b7583037ee08e72923c867e4217935b9", "filename": "scripts/quest/21302.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21302.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21302.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21302.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -59,6 +59,7 @@ function end(mode, type, selection) {\n         }\n         \n         qm.sendNext(\"Come on, keep training so you can get all your abilities back, and that way we can explore together once more!\");    \n+    } else if (status == 3) {\n         qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "2caeb2de21a8ff8b21433a526afffa180c8a3c23", "filename": "scripts/quest/21400.js", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21400.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21400.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21400.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -14,8 +14,9 @@ function start(mode, type, selection) {\n \tif (status == 0) {\n         qm.sendAcceptDecline(\"How is the training going? I know you're busy, but please come to #bRien#k immediately. The #bMaha#k has started to act weird again... But its even weirder now. It's different from before. It's... darker than usual.\");\n     } else if (status == 1) {\n-\t\tqm.sendOk(\"I have a bad feeling about this. Please come back here. I've never seen or herd Maha like this, but I can sense the suffering its going through. #bOnly you, the master of Maha, can do something about it!\");\n-\t\tqm.startQuest();\n-\t\tqm.dispose();\n-\t}\n+            qm.startQuest();\n+            qm.sendOk(\"I have a bad feeling about this. Please come back here. I've never seen or herd Maha like this, but I can sense the suffering its going through. #bOnly you, the master of Maha, can do something about it!\");\n+    } else if (status == 2) {\n+            qm.dispose();\n+    }\n }\n\\ No newline at end of file"}, {"sha": "600aaded9e21e69c1a687cb04e497fefef73ef1d", "filename": "scripts/quest/21401.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21401.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21401.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21401.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -68,7 +68,9 @@ function end(mode, type, selection) {\n \t\t\tqm.completeQuest();\n \t\t}\n \t\tqm.sendNext(\"Your skills have been restored. Those skills have been dormant for so long that you'll have to re-train yourself, but you'll be as good as new once you complete your training.\");\n-\t}\n+\t} else if(status == 3) {\n+                qm.dispose();\n+        }\n }\n \n function spawnMob(x, y, id, map) {"}, {"sha": "58c7a3512e11208f62282b21cbc4b9543ab41bc3", "filename": "scripts/quest/2148.js", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2148.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2148.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2148.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,9 +1,26 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-        qm.sendNext(\"Some bats seems to accompany this tree wherever it goes. Creepy...\");\n-        qm.forceCompleteQuest();\n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"Some bats seems to accompany this tree wherever it goes. Creepy...\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n function end(mode, type, selection) {\n         qm.dispose();"}, {"sha": "3e10046fd86dca282292c8b2cc973f3379a4b72a", "filename": "scripts/quest/2149.js", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2149.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2149.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2149.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,28 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-        qm.sendNext(\"It is said that a old tree gets alive whenever something sinister disturbs this land... We need a hero that fends our village of that creature!\");\n-        qm.forceCompleteQuest();\n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"It is said that a old tree gets alive whenever something sinister disturbs this land... We need a hero that fends our village of that creature!\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n+\n function end(mode, type, selection) {\n         qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "38cb1538d02edcfa1805e43f4a0ca8a7da0bd761", "filename": "scripts/quest/2150.js", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2150.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2150.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2150.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,28 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-        qm.sendNext(\"The tree has a scarf upon its branches, I tell you.\");\n-        qm.forceCompleteQuest();\n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"The tree has a scarf upon its branches, I tell you.\");\n+            qm.forceCompleteQuest();    \n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }        \n }\n+\n function end(mode, type, selection) {\n         qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "56facb7ee72002b46cd4dc0310ca392242cd43ed", "filename": "scripts/quest/2151.js", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2151.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2151.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2151.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,28 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-        qm.sendNext(\"The tree has a strange carving that resembles a scary face.\");\n-        qm.forceCompleteQuest();\n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"The tree has a strange carving that resembles a scary face.\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n+\n function end(mode, type, selection) {\n         qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "a8453cbc3c9a511b8d2cc77c5f1e25af1028e604", "filename": "scripts/quest/2152.js", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2152.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2152.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2152.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,28 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-        qm.sendNext(\"That tree... I've heard of it before, I even studied its behavior! If I recall correctly, the #bStumpy#k comes alive when the soil deems infertile by some sort of magic, and those stumps who evolves under these conditions starts to drain these suspicious magical sources instead of water and minerals for living, which makes them very threathening to people and villages nearby.\");\n-        qm.forceCompleteQuest();\n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"That tree... I've heard of it before, I even studied its behavior! If I recall correctly, the #bStumpy#k comes alive when the soil deems infertile by some sort of magic, and those stumps who evolves under these conditions starts to drain these suspicious magical sources instead of water and minerals for living, which makes them very threathening to people and villages nearby.\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n+\n function end(mode, type, selection) {\n         qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "f30354e46f7b964fb6eb5913d37ac764b827b015", "filename": "scripts/quest/21600.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21600.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21600.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21600.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -39,9 +39,9 @@ function start(mode, type, selection) {\n         } else if (status == 1) {\n             qm.sendAcceptDecline(\"Picked your interest, huh? Very well, first you must make your way to #bAqua#k, there is a person there who makes #rfood for wolf cubs#k. Bring one portion to me, and I shall deem you able to tame and take care of one. What do you say, will you try for it?\");\n         } else if (status == 2) {\n-            qm.sendNext(\"Alright. The one you must meet is #bNanuke#k, she is on top of a #rsnowy whale#k, somewhere in the ocean. Good luck!\");\n             qm.forceStartQuest();\n-            \n+            qm.sendNext(\"Alright. The one you must meet is #bNanuke#k, she is on top of a #rsnowy whale#k, somewhere in the ocean. Good luck!\");\n+        } else if (status == 3) {\n             qm.dispose();\n         }\n     }"}, {"sha": "488aa7cef895bde472d1a9c0a612154d7d1f21a4", "filename": "scripts/quest/21613.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21613.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21613.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21613.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -44,7 +44,6 @@ function start(mode, type, selection) {\n             var em = qm.getEventManager(\"Aran_3rdmount\");\n             if (em == null) {\n                 qm.sendOk(\"Sorry, but the 3rd mount quest (Wolves) is closed.\");\n-                qm.dispose();\n                 return;\n             }\n             else {\n@@ -54,9 +53,9 @@ function start(mode, type, selection) {\n                 } else {\n                     qm.forceStartQuest();\n                 }\n-                \n-                qm.dispose();\n             }\n+        } else if (status == 4) {\n+            qm.dispose();\n         }\n     }\n }"}, {"sha": "fae1da010edf2061326bee9efca4c717f712f2a7", "filename": "scripts/quest/21618.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21618.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21618.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21618.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -71,11 +71,12 @@ function end(mode, type, selection) {\n             }\n             \n             qm.sendNext(\"Step aside, behold the mighty prowess of Maha!!\");\n-        } else {\n+        } else if (status == 1) {\n+            qm.forceCompleteQuest();\n+            \n             qm.gainItem(1902017, -1);\n             qm.gainItem(1902018, 1);\n             \n-            qm.forceCompleteQuest();\n             qm.dispose();\n         }\n     }"}, {"sha": "7157a1567eb3e2d269b853d17d0de7f010f957f3", "filename": "scripts/quest/21700.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21700.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21700.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21700.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -33,8 +33,9 @@ function start(mode, type, selection) {\n \t\t\tqm.forceStartQuest();\n \t\t}\n     } else if (status == 6) {\n-\t\tqm.sendPrev(\"You'll find a Training Center if you exit to the #bleft#k. There, you'll meet #b#p1202006##k. I'm a bit worried because I think he may be struggling with bouts of Alzheimer's, but he spent a long time researching skills to help you. I'm sure you'll learn a thing or two from him.\");\n-\t\tqm.dispose();\n+            qm.sendPrev(\"You'll find a Training Center if you exit to the #bleft#k. There, you'll meet #b#p1202006##k. I'm a bit worried because I think he may be struggling with bouts of Alzheimer's, but he spent a long time researching skills to help you. I'm sure you'll learn a thing or two from him.\");\n+    } else if (status == 7) {\n+            qm.dispose();\n     }\n }\n "}, {"sha": "380e6e59f7fd55f65f43a0df44232a383d425b59", "filename": "scripts/quest/21703.js", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21703.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21703.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21703.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -35,6 +35,7 @@ function start(mode, type, selection) {\n     } else if (status == 7) {\n         qm.forceStartQuest();\n         qm.sendOk(\"Now go and take on those monstrous #o9300343#s!\");\n+    } else if (status == 8) {\n         qm.dispose();\n     }\n }\n@@ -70,6 +71,7 @@ function end(mode, type, selection) {\n         qm.sendNext(\"(You remembered the #bCombo Ability#k skill! You were skeptical of the training at first, since the old man suffers from Alzheimer's and all, but boy, was it effective!)\", 2);\n     } else if (status == 4) {\n         qm.sendPrev(\"Now report back to #p1201000#. I know she'll be ecstatic when she sees the progress you've made!\");\n+    } else if (status == 5) {\n         qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "8d4eb2b5a0b2058c0bd94fb8f92395b1896a776e", "filename": "scripts/quest/21712.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21712.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21712.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21712.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,7 +25,8 @@ function start(mode, type, selection) {\n \tqm.sendNext(\"I wonder what triggered this in the first place. There is no way this puppet was naturally created, which means someone planned this. I should keep an eye on the #o1210102#s.\", 9);\n     } else if (status == 3) {\n \tqm.sendPrev(\"#b(You were able to find out what caused the changes in the #o1210102#s. You should report to #p1002104# and deliver the information you've gathered.)#k\", 2);\n-\tqm.dispose();\n+    } else if (status == 4) {\n+        qm.dispose();\n     }\n }\n "}, {"sha": "59ef6d5e4dba582c3650b0231f89aa0fc6453f13", "filename": "scripts/quest/21728.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21728.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21728.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21728.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -42,7 +42,7 @@ function end(mode, type, selection) {\n                 qm.gainExp(200);\n                 qm.forceCompleteQuest();\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "bba95c9621f4a612a08c1c8481f22d5b23bd5293", "filename": "scripts/quest/21733.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21733.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21733.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21733.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -61,7 +61,7 @@ function end(mode, type, selection) {\n             qm.sendNext(\"Aran, thank you very much! Somehow the Puppeteer managed to bypass the security of Lith Harbor. He was trying to seek revenge because of the other day. Luckily, you came by. Nicely done!\");\n         } else if(status == 1) {\n             qm.sendNext(\"I will teach you the #rPolearm Mastery#k skill, to reward your actions here. You will be able to improve your accuracy and the overall mastery of your polearm arts.\");\n-        } else {\n+        } else if(status == 2) {\n             qm.gainExp(8000);\n             qm.teachSkill(21100000, 0, 20, -1); // polearm mastery\n             "}, {"sha": "2377d6db841c91c251baa7a75558cb36689504e0", "filename": "scripts/quest/21734.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21734.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21734.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21734.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -63,11 +63,12 @@ function end(mode, type, selection) {\n             qm.sendNext(\"They were after the #bcrystal seal of Victoria#k. These seals are what repels the Black Mage to further taking the continents into his grasp at once. Each continent has one, Victoria's now is safe and sound.\");\n         } else if(status == 2) {\n             qm.sendNext(\"For your bravery inputted on these series of missions, I will now reward you properly. Behold, the #rCombo Drain#k Skill: that let's you heal back a portion of damage dealt to the monsters.\");\n-        } else {\n+        } else if(status == 3) {\n+            qm.forceCompleteQuest();\n+            \n             qm.gainExp(12500);\n             qm.teachSkill(21100005, 0, 20, -1); // combo drain\n             \n-            qm.forceCompleteQuest();\n             qm.dispose();\n         }\n     }"}, {"sha": "12be56e8a00b5f911b6338480f1a50bfc394651d", "filename": "scripts/quest/21736.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21736.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21736.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21736.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -42,7 +42,7 @@ function start(mode, type, selection) {\n             qm.sendNextPrev(\"It seems like something strange is happening in Orbis in Ossyria. It's a bit different from when we were dealing with the puppeteer, but my instincts tell me it has to do with the Black Wings. Please head over to Orbis.\");\n         } else if(status == 3) {\n             qm.sendAcceptDecline(\"#bLisa the Fairy#k in Orbis should know a thing or two. Go see Lisa first, she knows someone that knows the whereabouts of the sealing stone. That person #rwill require a password from you#k, when requested use the #bThere's something strange going on in Orbis....#k keyword to talk to her. Understood?\");\n-        } else {\n+        } else if(status == 4) {\n             qm.forceStartQuest();\n             qm.dispose();\n         }"}, {"sha": "fdb5bc4606147a41d3d9e78d8eeafb6c0a3330d7", "filename": "scripts/quest/21738.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21738.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21738.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21738.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -50,7 +50,7 @@ function start(mode, type, selection) {\n             qm.sendAcceptDecline(\"I can't tell you about Sealed Garden. If you want to find out, I must first see whether you are worthy of the information. Do you mind if I look into your fate?\", 9);\n         } else if (status == 7) {\n             qm.sendOk(\"Well, now let's look into your fate. Give me a second.\");\n-        } else {\n+        } else if (status == 8) {\n             qm.forceStartQuest();\n             qm.dispose();\n         }"}, {"sha": "a86b8aa2868c0d8fca7e5289331dac02128c4482", "filename": "scripts/quest/21739.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21739.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21739.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21739.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,9 +36,9 @@ function end(mode, type, selection) {\n         \n         if(status == 0) {\n             qm.sendNext(\"So, have you defeated the giant? Oh, a Black Wing agent undercover? And he GOT THE SEAL STONE OF ORBIS?! Oh, no. That's horrible! We need to develop countermeasures as soon as possible! Tell the informant on Lith about the situation.\");\n-        } else {\n-            qm.gainExp(29500);\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(29500);\n             qm.dispose();\n         }\n     }"}, {"sha": "e1800ca83e5cf5e555b7888e02242d03f71fc04b", "filename": "scripts/quest/21740.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21740.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21740.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21740.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -61,10 +61,9 @@ function end(mode, type, selection) {\n             qm.sendNext(\"Oh, hi #h0#! You won't believe what I just uncovered. It's one of your lost skills... What, the seal of Orbis got stolen by the Black Wings? Oh my...\");\n         } else if(status == 1) {\n             qm.sendNext(\"For now, let me teach you the #bCombo Smash#k, with it you will be able to deal massive amount of damage to many monsters at once. We will need to use it if we want to stand a chance against the Black Wings now, so don't forget it!\");\n-        } else {\n-            qm.teachSkill(21100004, 0, 20, -1); // combo smash\n-            \n+        } else if(status == 2) {\n             qm.forceCompleteQuest();\n+            qm.teachSkill(21100004, 0, 20, -1); // combo smash\n             qm.dispose();\n         }\n     }"}, {"sha": "25bebfd5337ed30378b31f79b8b8904f990046ec", "filename": "scripts/quest/21741.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21741.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21741.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21741.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,9 +38,9 @@ function start(mode, type, selection) {\n             qm.sendNext(\"Have you been advancing your levels? I found an interesting piece of information about the Black Wings. This time, you'll have to travel quite a bit. Do you know a town called #bMu Lung#k? You'll have to head there.\");\n         } else if (status == 1) {\n             qm.sendAcceptDecline(\"Apparently, #bMr. Do#k in Mu Lung somehow met with the Black Wings. I don't know the details. Please go and find out why the Black Wings contacted Mr. Do and what exactly happened between them.\");\n-        } else {\n+        } else if (status == 2) {\n             qm.sendNext(\"Mr. Do is known to be curt, so you are going to have to remain patient while talking to him. Talk to him with the #bI heard you met the Shadow Knight of the Black Wings#k keyword.\");\n-            \n+        } else if (status == 3) {\n             qm.forceStartQuest();\n             qm.dispose();\n         }"}, {"sha": "8d381676508e48dfb910cdeb945c56d00a85943d", "filename": "scripts/quest/21749.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21749.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21749.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21749.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,9 +38,9 @@ function start(mode, type, selection) {\n             qm.sendNext(\"So we have lost #btwo seal stones#k so far, from the neighboring areas of #rOrbis#k and #rMu Lung#k... Things are starting to get out of control, it seems.\");\n         } else if (status == 1) {\n             qm.sendNext(\"Aran, your next objective will be to use the #btime gate to Ellin#k again. This time you will be retrieving the long lost #rSeal Stone of Ellin Forest#k. According to informations our network have gathered, #b#p2131002##k of that time have a clue about that gem, #rfind her#k. Please be successful on this task, our world is relying on you more than ever!\");\n-        } else {\n-            qm.gainExp(500);\n+        } else if (status == 2) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(500);\n             qm.dispose();\n         }\n     }"}, {"sha": "b10b401ea3cee7f2579e45351ebf0b374417c30a", "filename": "scripts/quest/21750.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21750.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21750.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21750.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,7 +36,7 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Aran, you're finally back!!! How you've been doing? Where did you go for so long? We have so much to catch up...\");\n-        } else {\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n             qm.dispose();\n         }"}, {"sha": "91e35ccce2b42aa926d2f1930f13bba60026556a", "filename": "scripts/quest/21753.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21753.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21753.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21753.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,8 +38,8 @@ function start(mode, type, selection) {\n             qm.sendNext(\"Aran, I've discovered some disturbing news... You said you've come from the eastern forest section, right? We traced and studied the magic being used to support the portal over there. It turns out that's of a #rtemporal#k-type. The garments you're using... They were never seen around before. That must mean, #ryou must have come from the future#k.\");\n         } else if (status == 1) {\n             qm.sendNext(\"Now about the problem: the Seal Stone that seems to have been missing in your timeline... It is a powerful artifact, that prevents the army of the #rBlack Mage#k from laying siege on our world. If that stone goes away, nothing more can prevent him. As this is a matter of great importance, find the #rself of mine#k from the future. I'm actually a #rfairy#k with a great life expectancy, I must be alive even on your timeline. Got it, #rfetch the me from the future#k!\");\n+        } else if (status == 2) {\n             qm.forceStartQuest();\n-            \n             qm.dispose();\n         }\n     }"}, {"sha": "2f344bef33dedfdb81be7ff8e11ffd9d9dd6f4b6", "filename": "scripts/quest/21757.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21757.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21757.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21757.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,11 +36,10 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Oh, a letter for the #rempress#k? From the #bheroes#k?!\");\n-        } else {\n+        } else if (status == 1) {\n+            qm.forceCompleteQuest();\n             qm.gainExp(1000);\n             qm.gainItem(4032330, -1);\n-            qm.forceCompleteQuest();\n-            \n             qm.dispose();\n         }\n     }"}, {"sha": "dbcbb141bcc0ce4c6baa720a40cb7219e70b4714", "filename": "scripts/quest/21766.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21766.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21766.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21766.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -10,14 +10,14 @@ function start(mode, type, selection) {\n \t\tqm.sendNext(\"I have a feeling there is a secret behind that wooden box. Could you stealthily look into the wooden box next to #p20000#?\");\n \t} else if (status == 3) {\n \t\tqm.sendNext(\"You know where #p20000# is, right? He's to the right. Just keep going until you see where Vikin is, then head down past the hanging shark and octopus, and you''ll see John. The box should be right next to him.\");\n-\t} else {\n+\t} else if (status == 4) {\n                 qm.forceStartQuest();\n \t\tqm.dispose();\n         }\n }\n \n function end(mode, type, selection) {\n-\tqm.gainExp(200);\n \tqm.forceCompleteQuest();\n+\tqm.gainExp(200);\n \tqm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "de63158d03aa9ffc6ce30707ce91b206d5460248", "filename": "scripts/quest/21767.js", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21767.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/21767.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21767.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,4 +1,5 @@\n var status = -1;\n+var canStart;\n \n function start(mode, type, selection) {\n \tstatus++;\n@@ -8,12 +9,20 @@ function start(mode, type, selection) {\n                         qm.dispose();\n                         return;\n                 }\n+                \n+                canStart = qm.canHold(4032423, 1);\n+                if(!canStart) {\n+                        qm.sendNext(\"Please open a slot in your ETC inventory first.\");\n+                        return;\n+                }\n             \n \t\tqm.sendNext(\"#bHm, there's a medicinal substance in the box. What could this be? You better take this to John and ask him what it is.#k\");\n-\t} else {\n-                qm.gainItem(4032423,1);\n-\t\t\n-                qm.forceStartQuest();\n+\t} else if (status == 1) {\n+                if(canStart) {\n+                        qm.gainItem(4032423,1);\n+                        qm.forceStartQuest();\n+                }\n+                \n \t\tqm.dispose();\n \t}\n }\n\\ No newline at end of file"}, {"sha": "56ca1e0a383bdfe399cfddcbf53f2308135a63c2", "filename": "scripts/quest/2186.js", "status": "modified", "additions": 45, "deletions": 29, "changes": 74, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2186.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2186.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2186.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -4,37 +4,53 @@\n */\n \n function end(mode, type, selection){\n-    if(!qm.isQuestCompleted(2186)) {\n-        if(qm.haveItem(4031853)){\n-            if(qm.canHold(2030019)) {\n-                qm.gainItem(4031853, -1);\n-                qm.gainExp(1700);\n-                qm.gainItem(2030019, 10);\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(!qm.isQuestCompleted(2186)) {\n+                if(qm.haveItem(4031853)){\n+                    if(qm.canHold(2030019)) {\n+                        qm.gainItem(4031853, -1);\n+                        qm.gainExp(1700);\n+                        qm.gainItem(2030019, 10);\n \n-                qm.sendOk(\"Geez, you found my glasses! Thank you, thank you so much. Now I'm able to see everything again!\");\n-                qm.forceCompleteQuest();\n-            }\n-            else {\n-                qm.sendOk(\"I need you to have an USE slot available to reward you properly!\");\n-            }\n-        }else if(qm.haveItem(4031854) || qm.haveItem(4031855)){ //When I figure out how to make a completance with just a pickup xD\n-            if(qm.canHold(2030019)) {\n-                if(qm.haveItem(4031854))\n-                    qm.gainItem(4031854, -1);\n-                else\n-                    qm.gainItem(4031855, -1);\n-                   \n-                qm.gainExp(1000);\n-                qm.gainItem(2030019, 5);\n- \n-                qm.sendOk(\"Hm, those aren't my glasses... But alas, I'll take it anyway. Thanks.\");\n-                qm.forceCompleteQuest();\n-            }\n-            else {\n-                qm.sendOk(\"I need you to have an USE slot available to reward you properly!\");\n+                        qm.sendOk(\"Geez, you found my glasses! Thank you, thank you so much. Now I'm able to see everything again!\");\n+                        qm.forceCompleteQuest();\n+                    }\n+                    else {\n+                        qm.sendOk(\"I need you to have an USE slot available to reward you properly!\");\n+                    }\n+                }else if(qm.haveItem(4031854) || qm.haveItem(4031855)){ //When I figure out how to make a completance with just a pickup xD\n+                    if(qm.canHold(2030019)) {\n+                        if(qm.haveItem(4031854))\n+                            qm.gainItem(4031854, -1);\n+                        else\n+                            qm.gainItem(4031855, -1);\n+\n+                        qm.gainExp(1000);\n+                        qm.gainItem(2030019, 5);\n+\n+                        qm.sendOk(\"Hm, those aren't my glasses... But alas, I'll take it anyway. Thanks.\");\n+                        qm.forceCompleteQuest();\n+                    }\n+                    else {\n+                        qm.sendOk(\"I need you to have an USE slot available to reward you properly!\");\n+                    }\n+                }\n             }\n+        } else if (status == 1) {\n+            qm.dispose();\n         }\n     }\n-    \n-    qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "d2fa18169c291e472c9c3a7dd24677a03dc2c3b3", "filename": "scripts/quest/2197.js", "status": "modified", "additions": 40, "deletions": 6, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2197.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2197.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2197.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,12 +1,46 @@\n var status = -1;\n \n function start(mode, type, selection) {\n-\tqm.sendNext(\"Oh, you already have monster book. Good luck on your journey~!\");\n-\tqm.forceCompleteQuest();\n-\tqm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"Oh, you already have monster book. Good luck on your journey~!\");\n+        } else if (status == 1) {\n+            qm.forceCompleteQuest();\n+            qm.dispose();\n+        }\n+    }\n }\n function end(mode, type, selection) {\n-\tqm.sendNext(\"Oh, you already have monster book. Good luck on your journey~!\");\n-\tqm.forceCompleteQuest();\n-\tqm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"Oh, you already have monster book. Good luck on your journey~!\");\n+        } else if (status == 1) {\n+            qm.forceCompleteQuest();\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "98ce206ec006e5d602179f40c61e014701eb75e7", "filename": "scripts/quest/22001.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22001.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,7 +25,8 @@ function start(mode, type, selection) {\n \t\t\tqm.sendNext(\"Hurry up and head #bleft#k to feed #b#p1013102##k. He's been barking to be fed all morning.\");\n \t\t}\n \t} else if (status == 4) {\n-\t\tqm.sendPrev(\"Feed #p1013102# and come back to see me.\");\n-\t\tqm.dispose();\n-\t}\n+\t\tqm.sendNextPrev(\"Feed #p1013102# and come back to see me.\");\n+\t} else if (status == 5) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "d759a4ec9bade8517efc7ba688a2bd2458847be3", "filename": "scripts/quest/22002.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22002.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -40,10 +40,10 @@ function end(mode, type, selection) {\n \tif (status == 0) {\n \t\tqm.sendNext(\"Did you eat your breakfast, Evan? Then, will you do me a favor?  \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#i1003028# 1 #t1003028#  \\r\\n#i2022621# 5 #t2022621#s \\r\\n#i2022622# 5 #t2022622# \\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 60 exp\");\n \t} else if (status == 1) {\n-\t\tqm.gainItem(1003028, 1, true);\n+\t\tqm.forceCompleteQuest();\n+                qm.gainItem(1003028, 1, true);\n \t\tqm.gainItem(2022621, 5, true);\n \t\tqm.gainItem(2022622, 5, true);\n-\t\tqm.forceCompleteQuest();\n \t\tqm.gainExp(60);\n \t\tqm.sendImage(\"UI/tutorial/evan/4/0\");\n \t\tqm.dispose();"}, {"sha": "19519e523653bc3047dfd2bd24af78c29a3be386", "filename": "scripts/quest/22007.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22007.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,6 +22,7 @@ function end(mode, type, selection) {\n \t\t\tqm.gainExp(360);\n \t\t\tqm.sendImage(\"UI/tutorial/evan/9/0\");\n \t\t}\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 3) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "cf5431dadd3e69f8e4b3b4926ad6911ac5839202", "filename": "scripts/quest/22008.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22008.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -69,6 +69,7 @@ function end(mode, type, selection) {\n \t\tqm.sendNextPrev(\"#bThis is a weapon that Magicians use. It's a Wand#k. You probably won't really need it, but it'll make you look important if you carry it around. Hahahahaha.\");\n \t} else if (status == 13) {\n \t\tqm.sendPrev(\"Anyway, the Foxes have increased, right? How weird is that? Why are they growing day by day? We should really look into it and get to the bottom of this.\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 14) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "c4b59520898c1760e80af3d7c0f859a9b7658b04", "filename": "scripts/quest/2214.js", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2214.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2214.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2214.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -26,6 +26,7 @@\n */\n \n var status = -1;\n+var canComplete;\n \n function end(mode, type, selection) {\n     if (mode == -1) {\n@@ -45,20 +46,24 @@ function end(mode, type, selection) {\n             var hourDay = qm.getHourOfDay();\n             if(!(hourDay >= 17 && hourDay < 20)) {\n                 qm.sendNext(\"(Hmm, I'm searching the trash can but can't find the #t4031894# JM was talking about, maybe it's not time yet...)\");\n-                qm.dispose();\n+                canComplete = false;\n                 return;\n             }\n             \n             if(!qm.canHold(4031894, 1)) {\n                 qm.sendNext(\"(Eh, I can't hold the #t4031894# right now, I need an ETC slot available.)\");\n-                qm.dispose();\n+                canComplete = false;\n                 return;\n             }\n             \n+            canComplete = true;\n             qm.sendNext(\"(Ah, there is a crumbled note here... Hm, it contains details about some scheme that is about to happen, that must be what #r#p1052002##k was talking about.)\");\n-            qm.gainItem(4031894, 1);\n-            qm.gainExp(20000);\n-            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            if (canComplete) {\n+                qm.forceCompleteQuest();\n+                qm.gainItem(4031894, 1);\n+                qm.gainExp(20000);\n+            }\n             \n             qm.dispose();\n         }"}, {"sha": "e486d7479797515fe9a2d5f755b7c6e62e639566", "filename": "scripts/quest/2215.js", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2215.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2215.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2215.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -26,6 +26,7 @@\n */\n \n var status = -1;\n+var canComplete;\n \n function end(mode, type, selection) {\n     if (mode == -1) {\n@@ -45,26 +46,30 @@ function end(mode, type, selection) {\n             var hourDay = qm.getHourOfDay();\n             if(!(hourDay >= 17 && hourDay < 20)) {\n                 qm.sendNext(\"(Hmm, I'm searching the trash can but can't find the #t4031894# JM was talking about, maybe it's not time yet...)\");\n-                qm.dispose();\n+                canComplete = false;\n                 return;\n             }\n             \n             if(qm.getMeso() < 2000) {\n                 qm.sendNext(\"(Oh, I don't have the combined fee amount yet.)\");\n-                qm.dispose();\n+                canComplete = false;\n                 return;\n             }\n             \n             if(!qm.canHold(4031894, 1)) {\n                 qm.sendNext(\"(Eh, I can't hold the #t4031894# right now, I need an ETC slot available.)\");\n-                qm.dispose();\n+                canComplete = false;\n                 return;\n             }\n             \n+            canComplete = true;\n             qm.sendNext(\"(Alright, now I will deposit the fee there and get the paper... That's it, yea, that's done.)\");\n-            qm.gainItem(4031894, 1);\n-            qm.gainMeso(-2000);\n-            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            if (canComplete) {\n+                qm.gainMeso(-2000);\n+                qm.forceCompleteQuest();\n+                qm.gainItem(4031894, 1);\n+            }\n             \n             qm.dispose();\n         }"}, {"sha": "68f56e27fd0e50b24a9a67d346fd1ba2368fc6f1", "filename": "scripts/quest/2216.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2216.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2216.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2216.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,8 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"I've just gathered an interesting information, #rDyle looks just like regular Ligators#k, but bigger.\");\n-            qm.gainExp(7000);\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(7000);\n             \n             if(isAllSubquestsDone() && qm.haveItem(4031894)) {\n                 qm.gainItem(4031894, -1);"}, {"sha": "c2dbd7b7dbd770a804a3a6642bebf927a9c2548c", "filename": "scripts/quest/2217.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2217.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2217.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2217.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,8 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Hey, did you notice already, it looks like some awful stench is emanating from the sewers... Ewww\");\n-            qm.gainExp(7000);\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(7000);\n             \n             if(isAllSubquestsDone() && qm.haveItem(4031894)) {\n                 qm.gainItem(4031894, -1);"}, {"sha": "7e1c47dcd0e2394b6330d16e87979566b714a70f", "filename": "scripts/quest/2218.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2218.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2218.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2218.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,8 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Hey did you see how strange #rLakelis#k has been acting these days? We should see what's going on aabout her, her actions have been so weird lately...\");\n-            qm.gainExp(7000);\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(7000);\n             \n             if(isAllSubquestsDone() && qm.haveItem(4031894)) {\n                 qm.gainItem(4031894, -1);"}, {"sha": "2a8730e351aab0e98b1feb2f54340da6c27f56fa", "filename": "scripts/quest/2219.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2219.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2219.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2219.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,8 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Did you know, they say someone from the sewers has been trying to #rdevelop a magic powder that let's one to grow#k, isn't that nice?\");\n-            qm.gainExp(7000);\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainExp(7000);\n             \n             if(isAllSubquestsDone() && qm.haveItem(4031894)) {\n                 qm.gainItem(4031894, -1);"}, {"sha": "d7e9826d26d857550976d9bcd7109834e1d4133a", "filename": "scripts/quest/2228.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2228.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2228.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2228.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,10 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Thank you for defeating #rFaust#k. That will finally settle my spirit to rest.\");\n-        } else {\n-            qm.gainFame(8);\n-            \n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n+            qm.gainFame(8);\n             qm.dispose();\n         }\n     }"}, {"sha": "2da466673cd83b64a00f53e2b561aa5b0bf46c4a", "filename": "scripts/quest/2230.js", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2230.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2230.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2230.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@\n */\n \n var status = -1;\n+var canComplete;\n \n function start(mode, type, selection) {\n     if (mode == -1) {\n@@ -45,6 +46,8 @@ function start(mode, type, selection) {\n             qm.sendOk(\"Put your hand in your pocket. I think your friend has already found you.\\r\\nThe purple bellflower that soaks in the sun in between the skyscraping trees...Follow the path to the unknown that leads you to the bellflower. I will wait for you here.\");\n             qm.forceStartQuest();\n             qm.gainItem(4032086, 1); // Mysterious Egg * 1\n+        } else if (status == 3) {\n+            qm.dispose();\n         }\n     }\n }\n@@ -76,11 +79,20 @@ function end(mode, type, selection) {\n         } else if (status == 5) {\n             qm.sendYesNo(\"Now do you understand? Every action comes with consequences, and pets are no exception. The egg of the snail shall hatch soon.\");\n         } else if (status == 6) {\n-            qm.gainItem(5000054, 1, false, true, 5 * 60 * 60 * 1000);  // rune snail (5hrs), missing expiration time detected thanks to cljnilsson\n+            canComplete = qm.canHold(5000054, 1);\n+            if (!canComplete) {\n+                qm.sendNext(\"Please free a slot in your CASH inventory before you try to receive the pet...\");\n+                return;\n+            }\n             \n-            qm.gainItem(4032086, -1); // Mysterious Egg * -1\n-            qm.forceCompleteQuest();\n             qm.sendNext(\"This snail will only be alive for #b5 hours#k. Shower it with love. Your love will be reciprocated in the end.\");\n+        } else if (status == 7) {\n+            if (canComplete) {\n+                qm.gainItem(4032086, -1); // Mysterious Egg * -1\n+                qm.forceCompleteQuest();\n+                qm.gainItem(5000054, 1, false, true, 5 * 60 * 60 * 1000);  // rune snail (5hrs), missing expiration time detected thanks to cljnilsson\n+            }\n+            \n             qm.dispose();\n         }\n     }"}, {"sha": "41e90b07a022d8fd33f2e078ad24244a6cded340", "filename": "scripts/quest/2236.js", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2236.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2236.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2236.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -8,6 +8,7 @@ Version 1.0 - Script Done.(20/3/2017)\n */\n \n var status = -1;\n+var canStart;\n \n function start(mode, type, selection) {\n     status++;\n@@ -16,20 +17,28 @@ function start(mode, type, selection) {\n \t\t    status -= 2;\n \t\telse{\n \t\t\tqm.sendOk(\"If we don't place these Charms on the Shaman Rocks, evil might awaken...\");\n-\t\t\tqm.dispose();\n+                        canStart = false;\n+                        status = 0;\n \t\t\treturn;\n \t\t}\n \t}\n-\tif (status == 0)\n+\tif (status == 0) {\n \t\tqm.sendAcceptDecline(\"I can feel the forces of evil. They're deep inside the dungeon and they're very, very powerful. If we want to drive the evil away from this place, we must place Charms on the Shaman Rocks inside the dungeon. Will you do that for me?\");\n-\tif (status == 1){\n-\t\tif(qm.haveItem(4032263)) qm.gainItem(4032263, -6);\n+                canStart = true;\n+\t} else if (status == 1) {\n+                if (canStart) {\n+                        qm.sendOk(\"Take these Charms and place them on the Shaman Rocks in the dungeon. I'm giving you a total of 6 Charms.\");\n+                } else {\n+                        qm.dispose();\n+                }\n+\t} else {\n+                qm.forceStartQuest();\n+                \n+                if(qm.haveItem(4032263)) qm.gainItem(4032263, -6);\n \t\tqm.gainItem(4032263, 6);\n-\n-\t\tqm.sendOk(\"Take these Charms and place them on the Shaman Rocks in the dungeon. I'm giving you a total of 6 Charms.\");\n-\t\tqm.forceStartQuest();\n+                \n \t\tqm.dispose();\n-\t}\n+        }\n }\n \n function end(mode, type, selection) {\n@@ -48,7 +57,7 @@ function end(mode, type, selection) {\n \t\t\tqm.sendOk(\"Oh, not good. I still sense bad omens coming from the interior. Here, take these charms and seal them at the Shaman Rocks. We are counting on you.\");\n \t\t\tqm.updateQuest(2236, 0);\n \t\t}\n-\t\n+\t} else if (status == 1) {\n \t\tqm.dispose();\n-\t}\n+        }\n }\n\\ No newline at end of file"}, {"sha": "2007688819971f4ebdf3dea6cb6915791de5f10e", "filename": "scripts/quest/2245.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2245.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2245.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2245.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,7 +38,6 @@ function start(mode, type, selection) {\n             em = qm.getEventManager(\"BalrogQuest\");\n             if (em == null) {\n                 qm.sendOk(\"Sorry, but the BalrogQuest is closed.\");\n-                qm.dispose();\n                 return;\n             }\n             \n@@ -47,8 +46,9 @@ function start(mode, type, selection) {\n                 qm.sendOk(\"There is currently someone in this map, come back later.\");\n             } else {\n                 qm.forceStartQuest();\n+                qm.dispose();\n             }\n-\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "e329b8d49c5ed77a5d88a21c60c9e657e26e2164", "filename": "scripts/quest/22501.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22501.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22501.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22501.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -20,11 +20,11 @@ function start(mode, type, selection) {\n \t} else if (status == 4) {\n \t\tif (mode == 0) {\n \t\t\tqm.sendNext(\"*gasp* How can you refuse to feed your Dragon? This is child abuse! \");\n-\t\t\tqm.dispose();\n \t\t} else {\n \t\t\tqm.forceStartQuest();\n \t\t\tqm.sendOk(\"#b#b(#p1013000# the baby Dragon appears to be extremely hungry. You must feed him. Maybe your Dad can give you advice on what dragons eat.)\");\n-\t\t\tqm.dispose();\n \t\t}\n-\t}\n+\t} else if (status == 5) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "6abcf2a1c6a931b56d77199398c02aa3817eb25d", "filename": "scripts/quest/22502.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22502.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22502.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22502.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -18,6 +18,6 @@ function start(mode, type, selection) {\n \t\t\tqm.forceStartQuest();\n \t\t\tqm.sendImage(\"UI/tutorial/evan/12/0\");\n \t\t}\n-\t\tqm.dispose();\t\t\n-\t}\n-}\n\\ No newline at end of file\n+                qm.dispose();\n+        }\n+}"}, {"sha": "b1f931d2ba614c417d1cd1aa4f315447660a8c73", "filename": "scripts/quest/22503.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22503.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22503.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22503.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,6 +22,7 @@ function start(mode, type, selection) {\n \t\t\tqm.forceStartQuest();\n \t\t\tqm.sendNext(\"#b#b(Try giving #p1013000# some #t4032453#. You have to hunt a few #o1210100#s at the farm. Ten should be plenty...)\");\n \t\t}\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 4) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "a77be2beb5a18db7d930640eea400d9a18883965", "filename": "scripts/quest/22504.js", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22504.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22504.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22504.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,5 +22,7 @@ function start(mode, type, selection) {\n \t\t\tqm.forceStartQuest();\n \t\t\tqm.sendNext(\"#b#b(You already asked Dad once, but you don't have any better ideas. Time to ask him again!)\");\n \t\t}\n-\t}\n+\t} else if (status == 4) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "bbd890fb0e6c09ebfcefe0fc560cb5f50be76f79", "filename": "scripts/quest/22507.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22507.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/22507.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/22507.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -53,6 +53,7 @@ function start(mode, type, selection) {\n \t\tqm.sendNextPrev(\"#b(You're a bit confused, but you are now traveling with Mir the Dragon. Perhaps you'll go on an adventure together, like he said.)\", 2);\n \t} else if (status == 17) {\t\n \t\tqm.sendPrev(\"#b#b(You still have an errand to run. Your dad needs to talk to you, so go and see him now.)\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 18) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "0eea0dc779afb0e47a048f4893264f1be4d13ea0", "filename": "scripts/quest/2251.js", "status": "modified", "additions": 26, "deletions": 11, "changes": 37, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2251.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2251.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2251.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -6,16 +6,31 @@\n */\n \n function end(mode, type, selection) {\n-    \n-    if(!qm.haveItem(4032399, 20)) {\n-        qm.sendOk(\"Please bring me 20 #b#t4032399##k...  #i4032399#\");\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(!qm.haveItem(4032399, 20)) {\n+                qm.sendOk(\"Please bring me 20 #b#t4032399##k...  #i4032399#\");\n+            }\n+            else {\n+                qm.gainItem(4032399, -20);\n+                qm.sendOk(\"Oh, you brought 20 #b#t4032399##k! Thank you.\");\n+                qm.gainExp(8000);\n+                qm.forceCompleteQuest();\n+            }\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n     }\n-    else {\n-        qm.gainItem(4032399, -20);\n-        qm.sendOk(\"Oh, you brought 20 #b#t4032399##k! Thank you.\");\n-        qm.gainExp(8000);\n-        qm.forceCompleteQuest();\n-    }\n-    \n-    qm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "f21d36115f814bccf5124223fe49297fec294d03", "filename": "scripts/quest/2257.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2257.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2257.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2257.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -36,7 +36,7 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Hey there, do you want a ride to #r#m261000000##k? Oh a request from #b#p2101013##k?\");\n-        } else {\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n             qm.dispose();\n         }"}, {"sha": "8f2d5f0903ad69189fd69a469c1599f3fd98f6d7", "filename": "scripts/quest/2258.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2258.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2258.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2258.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,7 +38,7 @@ function start(mode, type, selection) {\n             qm.sendAcceptDecline(\"Meerkats spreads rumors like wildfire... By blackmailing me and my cab service, they are taking costumers away from me day after day... Hey, tell no one about this, if you clean some #rMeerkats#k from my way, I'll tell you an info about the #rMushroom Castle#k. What do you say?\");\n         } else if (status == 1) {\n             qm.sendNext(\"Great, they you have #r5 minutes#k to kill #b40 Meerkats#k within this time. Good luck!\");\n-        } else {\n+        } else if (status == 2) {\n             qm.forceStartQuest();\n             qm.dispose();\n         }\n@@ -61,7 +61,7 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"You did it! ... Hey, #rMeerkats#k around here may listen to our conversation. I'm not going to talk about THAT right now.\");\n-        } else {\n+        } else if (status == 1) {\n             qm.forceCompleteQuest();\n             qm.dispose();\n         }"}, {"sha": "783dfc5cf5ecf23f98a50e1395210d929c8e6528", "filename": "scripts/quest/2259.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2259.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2259.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2259.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -60,13 +60,12 @@ function end(mode, type, selection) {\n         if (status == 0) {\n             if(qm.getMapId() == 260020000) {\n                 qm.sendNext(\"Eh you're still here? To reach #b#m260020700##k, follow #reast#k from here until you reach #rMagatia#k, I will be there. Now go.\");\n-                qm.dispose();\n                 return;\n             }\n             \n             qm.sendNext(\"Oh there you are. There're no Meerkat's nearby, so there probably is no eavesdropping around here. Very well, you must be fit to go to the #rMushroom Castle#k. Talk to me once you've got #blevel 30#k.\");\n-        } else {\n             qm.forceCompleteQuest();\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "4c196cdf2653544cea64322faf46a1963a6bd050", "filename": "scripts/quest/2260.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2260.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2260.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2260.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -38,7 +38,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Once you've got #b2nd job advancement#k, I'll tell you about the #bMushroom Castle#k.\");\n-        } else {\n+        } else if (status == 1) {\n             qm.forceStartQuest();\n             qm.dispose();\n         }\n@@ -67,8 +67,8 @@ function end(mode, type, selection) {\n             }\n             \n             qm.sendNext(\"Okay you seem ready to go to the #bMushroom Castle#k. In #rHenesys#k, climb at the tree fort at #bwest#k then enter a portal over there. On the other area, #rgo west#k. From there, a portal will be readily available to access the #bMushroom Castle#k area.\");\n-        } else {\n             qm.forceCompleteQuest();\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "dd9cefc5d0ded106062e02841839f8f46b517970", "filename": "scripts/quest/2293.js", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2293.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2293.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2293.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -37,9 +37,12 @@ function start(mode, type, selection) {\n     if(status == 0)\n     {\n         qm.sendNext(\"Do you remember the last song that the Spirit of Rock played? I can think of a few songs that he may be imitating, so listen carefully and tell me which song it is. #bYou only get one chance,#k so please choose wisely.\");\n+        qm.forceStartQuest();\n+    }\n+    else if(status == 1)\n+    {\n+        qm.dispose();\n     }\n-    qm.forceStartQuest();\n-    qm.dispose();\n }\n \n function end(mode, type, selection)\n@@ -92,19 +95,24 @@ function end(mode, type, selection)\n         if(selection == 1)\n         {\n             qm.sendOk(\"Obviously you don't enjoy music.\");\n-            qm.dispose();\n         }\n         else if(selection == 2)\n         {\n             qm.sendOk(\"I suppose you could get #b#eone#n#k more chance.\");\n-            qm.dispose();\n         }\n         else if(selection == 3)\n         {\n             qm.sendOk(\"So that was the song he was playing... Well, it wasn't my song after all, but I'm glad I can know that now with certainty. Thank you so much.\");\n-            qm.gainExp(32500);\n             qm.forceCompleteQuest();\n+            qm.gainExp(32500);\n+        }\n+        else\n+        {\n             qm.dispose();\n         }\n     }\n+    else if(status == 3)\n+    {\n+        qm.dispose();\n+    }\n }\n\\ No newline at end of file"}, {"sha": "3b72709bedebd2e6a9d1ea78bc34e4883c244daa", "filename": "scripts/quest/2312.js", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2312.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2312.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2312.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,11 +25,12 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"We need your help, noble explorer. Our kingdom is currently facing a big threat, and we are in desperate need of a courageous explorer willing to fight for us, and that's how you ended up here. Please understand, though, that since we need place our faith in you, we'll have to test your skills first before we can stand firmly behind you. Will it be okay for you to do this for us?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Keep moving forward, and you'll see #bRenegade Spores#k, the Spores that turned their backs on the Kingdom of Mushroom. We'd appreciate it if you can teach them a lesson or two, and bring back #b50 Mutated Spores#k in return.\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2){\n+                qm.dispose();\n+        }\n }\n \n function end(mode, type, selection) {\n@@ -44,12 +45,13 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Did you teach those Renegade Spores a lesson?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceCompleteQuest();\n \t\tqm.gainExp(11500);\n \t\tqm.gainItem(4000499, -50);\n \t\tqm.sendOk(\"That was amazing. I apologize for doubting your abilities. Please save our Kingdom of Mushroom from this crisis!\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2){\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "e5e69bd569dc599611df65f786807c21657958ba", "filename": "scripts/quest/2313.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2313.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2313.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2313.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,11 +25,12 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"I have told our #bMinister of Home Affairs#k of your abilities. Please go pay a visit to him immediately.\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Save our kingdom! We believe in you!\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2){\n+                qm.dispose();\n+        }\n }\n \n function end(mode, type, selection) {"}, {"sha": "58b157d0ee32b9743c149bf4abaa523da8315648", "filename": "scripts/quest/2314.js", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2314.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2314.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2314.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -23,16 +23,17 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"In order to rescue the princess, you must first navigate the Mushroom Forest. King Pepe set up a powerful barrier forbidding anyone from entering the castle. Please investigate this matter for us.\");\n-\tif (status == 1)\n+\telse if (status == 1)\n \t\tqm.sendNext(\"You'll run into the barrier at the Mushroom Forest by heading east of where you are standing right now. Please be careful. I hear that the area is infested with crazy, fear-inducing monsters.\");\n-\tif(status == 2){\n+\telse if(status == 2){\n \t\t//qm.forceStartQuest();\n \t\t//qm.forceStartQuest(2314,\"1\");\n \t\tqm.gainExp(8300);\n \t\tqm.sendOk(\"I see, so it was indeed not a regular barrier by any means. Great work there. If not for you help, we wouldn't have had a clue as to what that was all about.\");\n \t\tqm.forceCompleteQuest(); \n-\t\tqm.dispose();\n-\t}\n+\t} else if(status == 3){\n+                qm.dispose();\n+        }\n }\n \n function end(mode, type, selection) {\n@@ -47,11 +48,12 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"I see that you have thoroughly investigated the barrier at the Mushroom Forest. What was it like?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n+\t\tqm.forceCompleteQuest(); \n \t\tqm.gainExp(8300);\n \t\tqm.sendOk(\"I see, so it was indeed not a regular barrier by any means. Great work there. If not for you help, we wouldn't have had a clue as to what that was all about.\");\n-\t\tqm.forceCompleteQuest(); \n-\t\tqm.dispose();\n-\t\t}\n-\t}\n+        } else if (status == 2){\n+                qm.dispose();\n+        }\n+}\n \t\n\\ No newline at end of file"}, {"sha": "b0571a8622e2365a3c6c63373fcab78646aafdf5", "filename": "scripts/quest/2315.js", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2315.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2315.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2315.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,11 +25,12 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"A powerful barrier of magic, huh? Then what should we do...? If we can't find a way to break that barrier, then we can't save the princess. If it's impossible to physically break through, as you mentioned, then how about requesting help from our #bMinister of Magic#k?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Please go see him immediately. The #bMinister of Magic#k may seem a bit on the edge, but he's very knowledgeable, and I'm sure he'll know what to do.\");\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2){\n+                qm.dispose();\n+        }\n }\n \n function end(mode, type, selection) {\n@@ -44,11 +45,12 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"What? You investigated the barrier at the Mushroom Forest?\");\n-\tif (status == 1){\n-\t\tqm.gainExp(4000);\n-\t\tqm.sendOk(\"Hmmm...this is interesting. It's a barrier set up by someone with a powerful force of magic, which means there's no way we can manually break through it.\");\n+\telse if (status == 1){\n \t\tqm.forceCompleteQuest(); \n-\t\tqm.dispose();\n-\t}\n+                qm.gainExp(4000);\n+\t\tqm.sendOk(\"Hmmm...this is interesting. It's a barrier set up by someone with a powerful force of magic, which means there's no way we can manually break through it.\");\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "9c5d62897f0a9b5309abf6db1edc665d8e3e6bb4", "filename": "scripts/quest/2316.js", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2316.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2316.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2316.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,9 +25,10 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"I think i've heard of a potion that breaks these kinds of barriers. I think it's called #bKiller Mushroom Spores#k? Hmmm... outside, you'll find the Mushroom Scholar #bScarrs#k waiting outside. #bScarrs#k is an expert on mushrooms, so go talk to him.\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"I am confident #kScarrs#k will do everything to help you.\");\n+        else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -44,11 +45,12 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Ah, so you're the explorer people were talking about. I'm #bScarrs, the Royal Mushroom Scholar#k representing the Kingdom of Mushroom. So you need some #kKiller Mushroom Spores#k?\");\n-\tif (status == 1){\n+\t} else if (status == 1){\n+                qm.forceCompleteQuest();\n \t\tqm.gainExp(4200);\n \t\tqm.sendOk(\"#kKiller Mushroom Spores#k... I think i've heard of them before...\");\n-\t\tqm.forceCompleteQuest(); \n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "1e3db1a23edeae11d7650dfa842e4ef4df0c66ef", "filename": "scripts/quest/2317.js", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2317.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2317.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2317.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,9 +25,10 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"Ah! If I am not mistaken, I saw the #bKiller Mushroom Spores#k way back when I was a kid in a book. Now I remember... it's made out of extracts of powerful poisons from Poison Mushrooms, which means you'll need some Poison Mushroom Caps. If you can get me those, I think I'll be able to make it.\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Please defeat #bPoison Mushrooms#k and bring back #b100 Poison Mushroom Caps#k in return.\");\n+        } else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -44,12 +45,13 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Have you gathered up the 100 Poison Mushroom Caps like I asked you to get?\");\n-\tif (status == 1){\n-\t\tqm.gainExp(13500);\n+\telse if (status == 1){\n+                qm.sendOk(\"I am amazed that you were able to gather up these 100 Poison Mushroom Caps, which is considered a difficult feat. I think I'll be able to make #bKiller Mushroom Spores#k our of these.\");\n+\t} else if (status == 2) {\n+                qm.forceCompleteQuest();\n+                qm.gainExp(13500);\n \t\tqm.gainItem(4000500, -100);\n-\t\tqm.sendOk(\"I am amazed that you were able to gather up these 100 Poison Mushroom Caps, which is considered a difficult feat. I think I'll be able to make #bKiller Mushroom Spores#k our of these.\");\n-\t\tqm.forceCompleteQuest(); \n \t\tqm.dispose();\n-\t}\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "ff1281e504cada599ec624e84bfaf12a787e4092", "filename": "scripts/quest/2318.js", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2318.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2318.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2318.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,9 +25,10 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"Hmmm... I looked into the making of the Spores while you were gathering up the Poison Mushroom Caps, and realised that we'll need more materials for it. I want you to gather up one more set of items. Can you do it?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Okay, I want you to defeat the Regenade Spores and bring back #b50 Mutated Spores#k in return.\");\n+        } else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -44,15 +45,22 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Did you gather up all the necessary ingredients for it?\")\n-\tif (status == 1){\n-\t\tqm.gainExp(11500);\n+\telse if (status == 1){\n+                if (!qm.haveItem(4000499, 50)) {\n+                        qm.sendOk(\"Please gather all the ingredients first.\");\n+                        status = 2;\n+                        return;\n+                }\n+\n+                qm.sendNext(\"These should be enough for me to make the #bKiller Mushroom Spores.#k Please hold on for a bit.\");\n+\t} else if(status == 2){\n+                qm.sendOk(\"Okay, here are the Killer Mushroom Spores. Hopefully this will be enough for you to save our princess and help regain our kingdom. Good luck!\");\n+\t} else if(status == 3) {\n+                qm.forceCompleteQuest();\n+                qm.gainExp(11500);\n \t\tqm.gainItem(4000499, -50);\n-\t\tqm.sendNext(\"Okay, these should be enough for me to make the #bKiller Mushroom Spores.#k Please hold on for a bit.\");\n-\t\tqm.forceCompleteQuest();\n \t\tqm.gainItem(2430014, 1);\n-\t} if(status == 2){\n-\t\tqm.sendPrev(\"Okay, here are the Killer Mushroom Spores. Hopefully this will be enough for you to save our princess and help regain our kingdom. Good luck!\");\n-\t\tqm.dispose();\n-\t}\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "b51d69db2e8ab50875a6c51125eb4bf08d01e184", "filename": "scripts/quest/2319.js", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2319.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2319.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2319.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,10 +25,11 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"Oh, I almost forgot! What was I thinking? I need you to hand this #bSample of Killer Mushroom Spores#k to #bMinister of Magic#k and report the results.\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.gainItem(4032389, 1);\n \t\tqm.sendOk(\"The #bMinister of Magic#k told me once the #bKiller Mushroom Spores#k is complete, that he'll want a sample of it as well. I'll give you the sample; now go please hand it in to our #bMinister of Magic.#k\");\n+        } else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -45,12 +46,13 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Are the #bKiller Mushroom Spores#k finally completed?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n+                qm.forceCompleteQuest();\n \t\tqm.gainExp(4200);\n \t\tqm.gainItem(4032389, -1);\n \t\tqm.sendOk(\"Okay, so this is the #bKiller Mushroom Spores.#k Thank you, thank you, and please tell #bScarrs#k the same.\");\n-\t\tqm.forceCompleteQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "2b6cc9bcde4f48dab43f7a93550f7caabd8c3f74", "filename": "scripts/quest/2320.js", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2320.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2320.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2320.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,10 +25,11 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"I have just one more request for you. Would you like to take a listen?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.gainItem(4032389, 1);\n \t\tqm.sendOk(\"To be honest, these #bKiller Mushroom Spores#k are not completely out of my own work. Do you remember #bBruce#k from #bHenesys#k? I have been friends with him since childhood, and #bKiller Mushroom Spores#k was completed after he shared the results of his studies with me. This was all thanks to him, so I'd like for you to give this to him for me.\");\n+        } else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -45,12 +46,13 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Oh! You're here on behalf of #bScarrs#k? \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 8800 exp\");\n-\tif (status == 1){\n+\telse if (status == 1){\n+                qm.forceCompleteQuest();\n \t\tqm.gainExp(8800);\n \t\tqm.gainItem(4032389, -1);\n \t\tqm.sendOk(\"Ahh, so this is the #bKiller Mushroom Spores#k that I was working on in the past. I had a tough time gathering up the ingredients, so I left it in theory only, but he was able to complete it, with a sample to show for as well. Please tell him I appreciate his good work.\");\n-\t\tqm.forceCompleteQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "126e531a9afea79764ba5c66a230f1c844be2df0", "filename": "scripts/quest/2321.js", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2321.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2321.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2321.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,9 +25,10 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"Now you'll be able to penetrate the spiny vine barrier of Mushroom Forest, but before that, #bMinister of Home Affairs#k wants to have a word with you. Please go see him immediately.\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.forceStartQuest();\n \t\tqm.sendOk(\"Good luck.\");\n+        } else if (status == 2){\n \t\tqm.dispose();\n \t}\n }\n@@ -44,11 +45,12 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"I have been keeping up on your fabulour work. I am aware that you have successfully created the #bKiller Mushroom Spores#k, which penetrates through the unpenetrable barrier of the forest. Congratulations!\");\n-\tif (status == 1){\n+\telse if (status == 1){\n+                qm.forceCompleteQuest();\n \t\tqm.gainExp(2500);\n \t\tqm.sendOk(\"The problem now is to figure out how to enter the castle.\");\n-\t\tqm.forceCompleteQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "00b7a8cc22a2265fd3ebe24e6538a13d4855706a", "filename": "scripts/quest/2322.js", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2322.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2322.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2322.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,14 +25,15 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendYesNo(\"Like I told you, just breaking the barrier cannot be a cause for celebration. That's because our castle for the Kingdom of Mushroom completely denies entry of anyone outside our kingdom, so it'll be hard for you to do that. Hmmm... to figure out a way to enter, can you...investigate the outer walls of the castle first?\");\n-\tif (status == 1)\n+\telse if (status == 1)\n \t\tqm.sendNext(\"Walk past the Mushroom Forest and when you reach the #bSplit Road of Choice#k, just walk towards the castle. Good luck.\");\n-\tif (status == 2){\n+\telse if (status == 2){\n \t\t//qm.forceStartQuest();\n \t\t//qm.forceStartQuest(2322, \"1\");\n \t\tqm.gainExp(11000);\n \t\tqm.sendOk(\"Good job navigating through the area.\");\n \t\tqm.forceCompleteQuest();\n+        } else if (status == 3){\n \t\tqm.dispose();\n \t}\n }\n@@ -49,11 +50,12 @@ function end(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendOk(\"Hmmm I see... so they have completely shut off the entrance and everything.\");\n-\tif (status == 1){\n-\t\tqm.gainExp(11000);\n-\t\tqm.sendOk(\"Good job navigating through the area.\");\n+\telse if (status == 1){\n \t\tqm.forceCompleteQuest();\n-\t\tqm.dispose();\n-\t}\n+                qm.gainExp(11000);\n+\t\tqm.sendOk(\"Good job navigating through the area.\");\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "288ab764771f2e7a8f481b5a231f4843ce47cf39", "filename": "scripts/quest/2325.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2325.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2325.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2325.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,9 +22,10 @@ function end(mode, type, selection){\n \t\tqm.sendNextPrev(\"Don't be afriad, #b#p1300005##k sent me here.\", 2);\n \t}\n \telse if(status == 2){\n-\t\tqm.sendOk(\"What? My brother sent you here? Ahhh... I am safe now. Thank you so much...\");\n \t\tqm.forceCompleteQuest();\n \t\tqm.gainExp(6000);\n-\t\tqm.dispose();\n-\t}\n+                qm.sendOk(\"What? My brother sent you here? Ahhh... I am safe now. Thank you so much...\");\n+\t} else if (status == 3) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "8722341befbfece02f60e6f4167f549675977d60", "filename": "scripts/quest/2338.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2338.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2338.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2338.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -37,7 +37,7 @@ function start(mode, type, selection) {\n         if (status == 0) {\n             if(qm.haveItem(2430014, 1)) {\n                 qm.sendNext(\"It looks like you already have one #b#t2430014##k on your inventory.\");\n-                qm.dispose();\n+                status = 1;\n                 return;\n             }\n             \n@@ -48,8 +48,9 @@ function start(mode, type, selection) {\n             } else {\n                 qm.gainItem(2430014, 1);\n                 qm.forceCompleteQuest();\n+                qm.dispose();\n             }\n-            \n+        } else if (status == 2) {\n             qm.dispose();\n         }\n     }"}, {"sha": "6d5d2ff6e49670971052be4b702fcaa9bd2bd636", "filename": "scripts/quest/2342.js", "status": "modified", "additions": 32, "deletions": 16, "changes": 48, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2342.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2342.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2342.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -6,22 +6,38 @@\n var status = -1;\n \n function start(mode, type, selection){\n-\tif(!qm.hasItem(4001318) && qm.isQuestStarted(2331) && !qm.isQuestCompleted(2331)){\n-\t\tif(qm.canHold(4001318)){\n-\t\t\tqm.forceStartQuest();\n-\t\t\tqm.gainItem(4001318, 1);\n-\t\t\tqm.forceCompleteQuest();\n-\t\t\tqm.sendOk(\"Looks like you forgot to pick up the #b#t4001318##k when you fought with the #bPrime Minister#k. This is very important to our kingdom, so please deliver this to my father as soon as possible.\");\n-\t\t\tqm.dispose();\n-\t\t}\n-\t\telse{\n-\t\t\tqm.sendOk(\"Please free up one spot in your ETC inventory\");\n-\t\t\tqm.dispose();\n-\t\t}\n-\t}\n-\telse{\n-\t\tqm.dispose();\n-\t}\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(!qm.hasItem(4001318) && qm.isQuestStarted(2331) && !qm.isQuestCompleted(2331)){\n+                if(qm.canHold(4001318)){\n+                    qm.forceStartQuest();\n+                    qm.gainItem(4001318, 1);\n+                    qm.forceCompleteQuest();\n+                    qm.sendOk(\"Looks like you forgot to pick up the #b#t4001318##k when you fought with the #bPrime Minister#k. This is very important to our kingdom, so please deliver this to my father as soon as possible.\");\n+                }\n+                else{\n+                    qm.sendOk(\"Please free up one spot in your ETC inventory\");\n+                }\n+            }\n+            else{\n+                qm.dispose();\n+            }\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n \n function end(mode, type, selection){"}, {"sha": "985edef5c430d77eea69f9ab5784899633d70815", "filename": "scripts/quest/2560.js", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2560.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2560.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2560.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -20,8 +20,10 @@ function start(mode, type, selection) {\n \t\t\tqm.sendNext(\"Ook! Ook! (The monkey looks very dissatisfied.)\");\n \t\t} else {\n \t\t\tqm.forceStartQuest();\n+                        qm.dispose();\n \t\t}\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 4) {\n+                qm.dispose();\n+        }\n }\n \t\n\\ No newline at end of file"}, {"sha": "8d05cda8e4afb3b946ebfce1f8c48060b9fecd7c", "filename": "scripts/quest/2573.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2573.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/2573.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2573.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -17,10 +17,11 @@ function start(mode, type, selection) {\n \t\tif (mode == 0) {//decline\n \t\t\tqm.sendNext(\"Hey, take it easy! Sometimes you just gotta wait.\");\n \t\t} else {\n-\t\t\tqm.sendNext(\"Looks like we're all set! I think this is going to be a great voyage. Let's get underway.\");\n \t\t\tqm.warp(3000000, 0);\n \t\t\tqm.forceCompleteQuest();\n+                        qm.sendNext(\"Looks like we're all set! I think this is going to be a great voyage. Let's get underway.\");\n \t\t}\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 3) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "3cb9ea26759e03f12715630e6fa26667aca4b4e2", "filename": "scripts/quest/28004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/28004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/28004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/28004.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -44,7 +44,7 @@ function start(mode, type, selection) {\n             qm.sendNext(\"Okay... so here's our plan to defeat Scrooge and his dastardly plans. The Force of the Spirit I gave you is an item packed with mana. It's an item you'll definitely use at the map I am about to send you. In order to do that, you'll have to bring your party members with you as well. You should bring your party members here or form one right now!\");\n         } else if (status == 1) {\n             qm.sendAcceptDecline(\"Would you like to move forward?\");\n-        } else {\n+        } else if (status == 2) {\n             var level = qm.getPlayer().getLevel();\n             \n             qm.warp(level <= 30 ? 889100000 : (level <= 40 ? 889100010 : 889100020));"}, {"sha": "dc129556dd165e6f0345ea5541c1ed02d49ab90f", "filename": "scripts/quest/29900.js", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29900.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29900.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/29900.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -41,14 +41,16 @@ function end(mode, type, selection) {\n         if (status == 0) \n             qm.sendNext(\"Congratulations on earning your honorable #b<Beginner Adventurer>#k title. I wish you the best of luck in your future endeavors! Keep up the good work.\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n #v1142107:# #t1142107# 1\");\n         else if (status == 1) {\n-\t\t\tif (qm.canHold(1142107)) {\n-\t\t\t\tqm.gainItem(1142107);\n-\t\t\t\tqm.forceCompleteQuest();\n-\t\t\t} else \n-\t\t\t\tqm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n-\t\t\t\n-\t\t\tqm.dispose();        \n-\t\t}\n+            if (qm.canHold(1142107)) {\n+                qm.gainItem(1142107);\n+                qm.forceCompleteQuest();\n+                qm.dispose();\n+            } else {\n+                qm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n+            }\n+        } else if (status == 2) {\n+            qm.dispose();\n+        }\n     }\n \t\n }\n\\ No newline at end of file"}, {"sha": "b38d41c0ae0c919384a523c24253ac40a5120749", "filename": "scripts/quest/29901.js", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29901.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29901.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/29901.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -41,14 +41,16 @@ function end(mode, type, selection) {\n         if (status == 0) \n             qm.sendNext(\"Congratulations on earning your honorable #b<Junior Adventurer>#k title. I wish you the best of luck in your future endeavors! Keep up the good work.\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n #v1142108:# #t1142108# 1\");\n         else if (status == 1) {\n-\t\t\tif (qm.canHold(1142108)) {\n-\t\t\t\tqm.gainItem(1142108);\n-\t\t\t\tqm.forceCompleteQuest();\n-\t\t\t} else \n-\t\t\t\tqm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n-\t\t\t\n-\t\t\tqm.dispose();        \n-\t\t}\n+                if (qm.canHold(1142108)) {\n+                        qm.gainItem(1142108);\n+                        qm.forceCompleteQuest();\n+                        qm.dispose();\n+                } else {\n+                        qm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n+                }\n+        } else if (status == 2) {\n+                qm.dispose();\n+        }\n     }\n \t\n }\n\\ No newline at end of file"}, {"sha": "c665731a14186921db25aaa90610f80bb8d77429", "filename": "scripts/quest/29902.js", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29902.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29902.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/29902.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -41,14 +41,16 @@ function end(mode, type, selection) {\n         if (status == 0) \n             qm.sendNext(\"Congratulations on earning your honorable #b<Veteran Adventurer>#k title. I wish you the best of luck in your future endeavors! Keep up the good work.\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n #v1142109:# #t1142109# 1\");\n         else if (status == 1) {\n-\t\t\tif (qm.canHold(1142109)) {\n-\t\t\t\tqm.gainItem(1142109);\n-\t\t\t\tqm.forceCompleteQuest();\n-\t\t\t} else \n-\t\t\t\tqm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n-\t\t\t\n-\t\t\tqm.dispose();        \n-\t\t}\n+                if (qm.canHold(1142109)) {\n+                        qm.gainItem(1142109);\n+                        qm.forceCompleteQuest();\n+                        qm.dispose();\n+                } else {\n+                        qm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n+                }\n+        } else if (status == 2) {\n+                qm.dispose();\n+        }\n     }\n \t\n }\n\\ No newline at end of file"}, {"sha": "999075c0f9247828b3caec1858e81e96bb6d02b0", "filename": "scripts/quest/29903.js", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29903.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/29903.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/29903.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -41,14 +41,16 @@ function end(mode, type, selection) {\n         if (status == 0) \n             qm.sendNext(\"Congratulations on earning your honorable #b<Master Adventurer>#k title. I wish you the best of luck in your future endeavors! Keep up the good work.\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n #v1142110:# #t1142110# 1\");\n         else if (status == 1) {\n-\t\t\tif (qm.canHold(1142110)) {\n-\t\t\t\tqm.gainItem(1142110);\n-\t\t\t\tqm.forceCompleteQuest();\n-\t\t\t} else \n-\t\t\t\tqm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n-\t\t\t\n-\t\t\tqm.dispose();        \n-\t\t}\n+                if (qm.canHold(1142110)) {\n+                        qm.gainItem(1142110);\n+                        qm.forceCompleteQuest();\n+                        qm.dispose();\n+                } else {\n+                        qm.sendNext(\"Please make room in your inventory\");//NOT GMS LIKE\n+                }\n+        } else if (status == 2) {\n+            qm.dispose();\n+        }\n     }\n \t\n }\n\\ No newline at end of file"}, {"sha": "5321d3839bb44d25b93cbe7e07b36a3ee15af5d0", "filename": "scripts/quest/3108.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3108.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3108.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3108.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -37,7 +37,7 @@ function start(mode, type, selection) {\n         if (status == 0) {\n             qm.sendNext(\"(As you peek into the shattered statue, you might have found a clue about what happened. Better talk to #rScadur#k about this.)\");\n             qm.forceCompleteQuest();\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "bcf0edca884059f05994bdbf9e3d03b57c41d8f3", "filename": "scripts/quest/3301.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3301.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3301.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3301.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,8 +48,7 @@ function end(mode, type, selection) {\n \t    qm.gainItem(oreArray[selection], -2); // Take 2 ores\n \t    qm.sendNext(\"Then wait for awhile. I'll go and get the stuff to help you pass the test of Chief Zanumist.\");\n \t    qm.forceCompleteQuest();\n-\t    qm.dispose();\n-\t} else {\n+\t} else if (status == 1) {\n \t    qm.dispose();\n \t}\n     }"}, {"sha": "a9d44c42fe534e701529323c643306b4e4f7f859", "filename": "scripts/quest/3303.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3303.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3303.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3303.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,8 +48,7 @@ function end(mode, type, selection) {\n \t    qm.gainItem(oreArray[selection], -2); // Take 2 ores\n \t    qm.sendNext(\"Then wait for awhile. I'll go and get the stuff to help you pass the test of Chief Alcadno.\");\n \t    qm.forceCompleteQuest();\n-\t    qm.dispose();\n-\t} else {\n+\t} else if (status == 1) {\n \t    qm.dispose();\n \t}\n     }"}, {"sha": "572eb80bc424d67a97fcc52978909d225f83e8f7", "filename": "scripts/quest/3311.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3311.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3311.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3311.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -42,7 +42,7 @@ function end(mode, type, selection) {\n             } else {\n                 qm.sendNext(\"Found nothing yet? Please check out Dr. De Lang's house properly, something there may give out a clue about what is going on.\");\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "31edf6da5d1e7f266642d69ad8112e1551b2cc1e", "filename": "scripts/quest/3314.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3314.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3314.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3314.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -58,7 +58,7 @@ function end(mode, type, selection) {\n             } else {\n                 qm.sendNext(\"You seem pretty normal, don't you? I can't detect any possible effect from my experiment on you. Go take the pill I asked you to take and show me the effects, will you?\");\n             }\n-        } else {\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "686c60fe30444ceb121d95c69477788b9c823d24", "filename": "scripts/quest/3321.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3321.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3321.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3321.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,8 +48,8 @@ function start(mode, type, selection) {\n             qm.sendNext(\"Oh, and I have a personal favor to ask, if it's not too much. I am worried about my wife, #b#p2111004##k. Since the incident with the Huroids I could send a word to her, that must have made a toll on her... Please, if you could, could you get the #bSilver Pendant#k I left #bback at home#k, and give it to her in my stead? I regret not giving the item right away to her, it was her birthday... Maybe giving it now to her can get her a good sleeping night, at least.\");\n         } else if (status == 5) {\n             qm.sendNext(\"#rMake sure to remember this pattern!#k I've hid the pendant in my house, in a container #bbehind the water pipes#k. The pipes must be turned #bin order#k: top, bottom, middle. And then, enter the secret password: '#rmy love Phyllia#k'.\");\n-            \n             qm.forceStartQuest();\n+        } else if (status == 6) {\n             qm.dispose();\n         }\n     }"}, {"sha": "def3916b247514c60a7db7fe95cfab6afbefe3bc", "filename": "scripts/quest/3345.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3345.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3345.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3345.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -43,7 +43,7 @@ function end(mode, type, selection) {\n             } else {\n                 qm.sendNext(\"Did you not seal the #rmagic circle beneath Magatia#k yet? It is a matter of great importance, please haste yourself.\");\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "1b1246c66b2f821a8828c251f73ec6e27e64420e", "filename": "scripts/quest/3360.js", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3360.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3360.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3360.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -51,6 +51,7 @@ function start(mode, type, selection) {\n \t    qm.sendOk(\"The key code is #b\" + pass + \"#k. Got that? Put the key into the door of the secret passage, and you will be able to walk around the passage freely.\");\n \t    qm.forceStartQuest();\n             qm.setStringQuestProgress(3360, 0, pass);\n+\t} else if (status == 3) {\n \t    qm.dispose();\n \t}\n     }\n@@ -69,10 +70,11 @@ function end(mode, type, selection) {\n                 qm.sendNext(\"What's up? You haven't opened the Secret Passage yet?\");\n             } else {\n                 qm.forceCompleteQuest();\n+                qm.dispose();\n             }\n-            \n+\t} else if (status == 1) {\n             qm.dispose();\n-\t}\n+        }\n     }\n }\n "}, {"sha": "ce732bbd295e1490c7e11de2cdcf71f3d6b99fd7", "filename": "scripts/quest/3382.js", "status": "modified", "additions": 41, "deletions": 27, "changes": 68, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3382.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3382.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3382.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,36 +28,50 @@\n */\n \n function end(mode, type, selection) {\n-        if(qm.haveItem(4001159, 25) && qm.haveItem(4001160, 25) && !qm.haveItemWithId(1122010, true)) {\n-            if(qm.canHold(1122010)) {\n-                qm.gainItem(4001159, -25);\n-                qm.gainItem(4001160, -25);\n-                qm.gainItem(1122010, 1);\n-                \n-                qm.sendOk(\"Thank you for retrieving the marbles. Accept this pendant as a token of my appreciation.\");\n-            } else {\n-                qm.sendNext(\"Free a slot on your EQUIP tab before claiming a prize.\");\n-                qm.dispose();\n-                return;\n-            }\n-        } else if(qm.haveItem(4001159, 10) && qm.haveItem(4001160, 10)) {\n-            if(qm.canHold(2041212)) {\n-                qm.gainItem(4001159, -10);\n-                qm.gainItem(4001160, -10);\n-                qm.gainItem(2041212, 1);\n-                \n-                qm.sendOk(\"Thank you for retrieving the marbles. This rock, that I am giving to you, can be used to improve the stats on the #b#t1122010##k. Take it as a token of my appreciation and use it wisely.\");\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(qm.haveItem(4001159, 25) && qm.haveItem(4001160, 25) && !qm.haveItemWithId(1122010, true)) {\n+                if(qm.canHold(1122010)) {\n+                    qm.gainItem(4001159, -25);\n+                    qm.gainItem(4001160, -25);\n+                    qm.gainItem(1122010, 1);\n+\n+                    qm.sendOk(\"Thank you for retrieving the marbles. Accept this pendant as a token of my appreciation.\");\n+                } else {\n+                    qm.sendNext(\"Free a slot on your EQUIP tab before claiming a prize.\");\n+                    return;\n+                }\n+            } else if(qm.haveItem(4001159, 10) && qm.haveItem(4001160, 10)) {\n+                if(qm.canHold(2041212)) {\n+                    qm.gainItem(4001159, -10);\n+                    qm.gainItem(4001160, -10);\n+                    qm.gainItem(2041212, 1);\n+\n+                    qm.sendOk(\"Thank you for retrieving the marbles. This rock, that I am giving to you, can be used to improve the stats on the #b#t1122010##k. Take it as a token of my appreciation and use it wisely.\");\n+                } else {\n+                    qm.sendNext(\"Free a slot on your USE tab before claiming a prize.\");\n+                    return;\n+                }\n             } else {\n-                qm.sendNext(\"Free a slot on your USE tab before claiming a prize.\");\n-                qm.dispose();\n+                qm.sendNext(\"I need at least #b10 of both #t4001159# and #t4001160##k to reward you appropriately. If you happen to come with #b25 of these#k instead, I can reward you with a valuable gear. Fare well.\");\n                 return;\n             }\n-        } else {\n-            qm.sendNext(\"I need at least #b10 of both #t4001159# and #t4001160##k to reward you appropriately. If you happen to come with #b25 of these#k instead, I can reward you with a valuable gear. Fare well.\");\n+\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n             qm.dispose();\n-            return;\n         }\n-\n-\tqm.forceCompleteQuest();\n-\tqm.dispose();\n+    }\n }"}, {"sha": "6c159e63f2e45833542a88234c12bcb339cfe6e9", "filename": "scripts/quest/3437.js", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3437.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3437.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3437.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -14,9 +14,7 @@ function end(mode, type, selection) {\n \n \tif(status == 0) {\n \t\tqm.sendNext(\"What the? Are you telling me you've already taken out 150 #o4230120#s? And these ... yes, these really are 120 #t4000122#s. I was wondering how you were going to complete this mission all by yourself, but you took care of it just fine. Alright, here ... this is a very important item for me, but please take it.\");\n-\t}\n-\n-\telse if(status == 1) {\n+\t} else if(status == 1) {\n \t    if(qm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.EQUIP).getNumFreeSlot() < 1) {\n \t\tqm.sendOk(\"Please free a EQUIP inventory slot to receive the reward.\");\n \t\tqm.dispose();\n@@ -34,16 +32,13 @@ function end(mode, type, selection) {\n             else item = 1082149;\n             \n             qm.sendNext(talkStr);\n-\t}\n-\n-        if(status == 2) {\n+\t} else if(status == 2) {\n+            qm.completeQuest();\n             qm.gainItem(item, 1);\n             qm.gainItem(4000122, -120);\n-            \n             qm.gainExp(6100);\n-            qm.completeQuest();\n-            \n             qm.sendOk(\"Thank you so much for fulfilling your missions as one of the Mesorangers. I've told the Sector about your successful story, and the Sector seems to be very pleased with you, too. Hopefully you'll keep working with us. Bye~\");\n+        } else if (status == 3) {\n             qm.dispose();\n         }\n }\n\\ No newline at end of file"}, {"sha": "a87f73f566974f3715365f8c8c85447b908a784f", "filename": "scripts/quest/3452.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3452.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3452.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3452.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -17,12 +17,13 @@ function end(mode, type, selection) {\n \t\t\tqm.gainItem(2000011, 50);\n \t\t\tqm.gainExp(8000);\n \t\t\tqm.forceCompleteQuest();\n+                        qm.dispose();\n \t\t}\n \t\telse {\n \t\t\tqm.sendNext(\"Hm? It looks like your inventory is full.\");\n \t\t}\n-                \n+\t} else if (status == 2) {\n                 qm.dispose();\n-\t}\n+        }\n     }    \n }\n\\ No newline at end of file"}, {"sha": "cf33327420a5ffdf063646357d877a96167bce3c", "filename": "scripts/quest/3454.js", "status": "modified", "additions": 36, "deletions": 19, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3454.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3454.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3454.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,26 +28,43 @@\n */\n \n function end(mode, type, selection) {\n-\tif(qm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).getNumFreeSlot() < 1) {\n-\t\tqm.sendOk(\"Make room on your ETC inventory first.\");\n-\t\tqm.dispose();\t\t\n-\t\treturn;\n-\t}\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(qm.getPlayer().getInventory(Packages.client.inventory.MapleInventoryType.ETC).getNumFreeSlot() < 1) {\n+                qm.sendOk(\"Make room on your ETC inventory first.\");\n+                qm.dispose();\t\t\n+                return;\n+            }\n \n-\tqm.gainItem(4000125, -1);\n-\tqm.gainItem(4031926, -10);\n-\tqm.gainItem(4000119, -30);\n-\tqm.gainItem(4000118, -30);\n+            qm.gainItem(4000125, -1);\n+            qm.gainItem(4031926, -10);\n+            qm.gainItem(4000119, -30);\n+            qm.gainItem(4000118, -30);\n \n-\trnd = Math.random();\n-\tif(rnd < 1.0) {\n-\t\tqm.gainItem(4031928, 1);\n-\t}\n-\telse {\n-\t\tqm.gainItem(4031927, 1);\n-\t}\n+            rnd = Math.random();\n+            if(rnd < 1.0) {\n+                qm.gainItem(4031928, 1);\n+            }\n+            else {\n+                qm.gainItem(4031927, 1);\n+            }\n \n-\tqm.sendOk(\"Now, go meet Alien Gray and use this undercover to read through their plans. If this fails, we will need to gather some materials once again.\");\n-\tqm.forceCompleteQuest();\n-\tqm.dispose();\n+            qm.sendOk(\"Now, go meet Alien Gray and use this undercover to read through their plans. If this fails, we will need to gather some materials once again.\");\n+            qm.forceCompleteQuest();\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }"}, {"sha": "80f44994fa717a040142c4e4ad4e7d3b469a28b0", "filename": "scripts/quest/3507.js", "status": "modified", "additions": 23, "deletions": 7, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3507.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3507.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3507.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,26 @@\n function end(mode, type, selection) {\n-        if(qm.isQuestCompleted(3523) || qm.isQuestCompleted(3524) || qm.isQuestCompleted(3525) || qm.isQuestCompleted(3526) || qm.isQuestCompleted(3527) || qm.isQuestCompleted(3529) || qm.isQuestCompleted(3539)) {\n-            qm.completeQuest();\n-            qm.sendOk(\"You are now filled with all of your memories again.. You are now allowed to go to #m270020000#.\");\n-        } else {\n-            qm.sendOk(\"You have not yet checked with your first teacher about your memories?\");\n-        }\n-    \n+    if (mode == -1) {\n         qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            if(qm.isQuestCompleted(3523) || qm.isQuestCompleted(3524) || qm.isQuestCompleted(3525) || qm.isQuestCompleted(3526) || qm.isQuestCompleted(3527) || qm.isQuestCompleted(3529) || qm.isQuestCompleted(3539)) {\n+                qm.completeQuest();\n+                qm.sendOk(\"You are now filled with all of your memories again.. You are now allowed to go to #m270020000#.\");\n+            } else {\n+                qm.sendOk(\"You have not yet checked with your first teacher about your memories?\");\n+            }\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "1bca9087c85835d8208aac2ee8dac3ebd5ef3444", "filename": "scripts/quest/3523.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3523.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3523.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3523.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "6fde502f1b6fe2037129b38c137bb00d7ea1091e", "filename": "scripts/quest/3524.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3524.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3524.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3524.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "319a71ae0ac167e5b8257b570bccaeacfab5274c", "filename": "scripts/quest/3525.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3525.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3525.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3525.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "7601322390297000bf9ae735f1419f264564d38a", "filename": "scripts/quest/3526.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3526.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3526.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3526.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "8b6c855857b7fffdafd07ee245199c5bb686a4fe", "filename": "scripts/quest/3527.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3527.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3527.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3527.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "8b6c855857b7fffdafd07ee245199c5bb686a4fe", "filename": "scripts/quest/3539.js", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3539.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3539.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3539.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -24,9 +24,26 @@\n */\n \n function start(mode, type, selection) {\n-    qm.startQuest();\n-    //qm.getPlayer().updateQuestInfo(3507, \"1\");\n-    qm.completeQuest();\n-    qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-    qm.dispose();\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.startQuest();\n+            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.completeQuest();\n+            qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n+        } else if (status == 1) {\n+            qm.dispose();\n+        }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "e142e844f89ceba843d631fadd2d508afa4f2f46", "filename": "scripts/quest/3714.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3714.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3714.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3714.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -55,11 +55,10 @@ function start(mode, type, selection) {\n                 return;\n             }\n             \n+            qm.forceCompleteQuest();\n             qm.gainItem(4001094, -1);\n             qm.gainItem(2041200, 1);    // quest not rewarding properly found thanks to MedicOP & Thora\n             qm.gainExp(42000);\n-            \n-            qm.forceCompleteQuest();\n             qm.dispose();\n         }\n     }"}, {"sha": "b01f5946fa1d710e8bc4d7069165ea10ab6195b0", "filename": "scripts/quest/3833.js", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3833.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3833.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3833.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -51,12 +51,14 @@ function end(mode, type, selection) {\n \t\t\t\tqm.gainExp(10);\n \t\t\t\tqm.forceCompleteQuest();\n \t\t\t}\n+\n+                        qm.dispose();\n \t\t}\n \t\telse {\n \t\t\tqm.sendOk(\"Could you make #b2 slots available#k on your USE inventory before receiving your reward?\");\n-\t\t}\t\n-                \n-                qm.dispose();\n-\t}\n+\t\t}\n+\t} else if (status == 2) {\n+            qm.dispose();\n+        }\n     }\n }\n\\ No newline at end of file"}, {"sha": "dce1ce974a5eb9811b5d6514f0184c80c262e81a", "filename": "scripts/quest/3926.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3926.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3926.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3926.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -51,8 +51,8 @@ function end(mode, type, selection) {\n                 qm.forceCompleteQuest();\n             } else {\n                 qm.sendNext(\"Have you brought all the jewels from the Red Scorpions? They have to be delivered to the Residential areas of the Sand Bandits.\");\n-            }   \n-            \n+            }\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "26b254eba33caab547b0f69fbc5c47ef771fff3e", "filename": "scripts/quest/3929.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3929.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3929.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3929.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -63,7 +63,7 @@ function end(mode, type, selection) {\n                     qm.sendNext(\"Hey, what are you trying to pull on? To pass my test you must to deliver all the foods to the Residential areas.\");\n                 }\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "401d2bf45fbe51eb92ffe3269067678c80048ee6", "filename": "scripts/quest/3933.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3933.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3933.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3933.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -43,15 +43,15 @@ function start(mode, type, selection) {\n             qm.sendAcceptDecline(\"To truly see your strength, I'll have to face you myself. Don't worry, I'll summon my other self to face off against you. Are you ready?\");\n         } else if (status == 2) {\n             qm.sendNext(\"Good, I like your confidence.\");\n-        } else {\n+        } else if (status == 3) {\n             if(qm.getWarpMap(926000000).getCharacters().size() > 0) {\n                 qm.sendOk(\"There is someone currently in this map, come back later.\");\n+                qm.dispose();\n             } else {\n                 qm.warp(926000000);\n                 qm.forceStartQuest();\n+                qm.dispose();\n             }\n-            \n-            qm.dispose();\n         }\n     }\n }"}, {"sha": "ecee5987ea486ea1cf2d0f17daa30eb74ff0f03e", "filename": "scripts/quest/3941.js", "status": "modified", "additions": 20, "deletions": 15, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3941.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3941.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3941.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -42,18 +42,23 @@ function start(mode, type, selection) {\n         else\n             status--;\n         \n-        if(!isTigunMorphed(qm.getPlayer())) {\n-            qm.sendNext(\"What's this? I can't simply give the Queen's silk to anyone, claiming they will hand it at once to the queen. Get out of my sights.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n         if (status == 0) {\n+            if(!isTigunMorphed(qm.getPlayer())) {\n+                qm.sendNext(\"What's this? I can't simply give the Queen's silk to anyone, claiming they will hand it at once to the queen. Get out of my sights.\");\n+                status = 1;\n+                return;\n+            }\n+\n             qm.sendNext(\"Tigun, what are you doing here?\");\n         } else if (status == 1) {\n+            if(!isTigunMorphed(qm.getPlayer())) {\n+                qm.sendNext(\"What's this? I can't simply give the Queen's silk to anyone, claiming they will hand it at once to the queen. Get out of my sights.\");\n+                return;\n+            }\n+\n             qm.sendNext(\"The Queen wants her silk right now? Alright, I have them here. Hold on a moment.\");\n-            \n-            qm.forceStartQuest();            \n+            qm.forceStartQuest();\n+        } else if (status == 2) {\n             qm.dispose();\n         }\n     }\n@@ -73,13 +78,13 @@ function end(mode, type, selection) {\n         else\n             status--;\n         \n-        if(!isTigunMorphed(qm.getPlayer())) {\n-            qm.sendNext(\"What's this? I can't simply give the Queen's silk to anyone, claiming they will hand it at once to the queen. Get out of my sights.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n         if (status == 0) {\n+            if(!isTigunMorphed(qm.getPlayer())) {\n+                qm.sendNext(\"What's this? I can't simply give the Queen's silk to anyone, claiming they will hand it at once to the queen. Get out of my sights.\");\n+                qm.dispose();\n+                return;\n+            }\n+\n             if(qm.canHold(4031571, 1)) {\n                 qm.gainItem(4031571);\n                 \n@@ -88,7 +93,7 @@ function end(mode, type, selection) {\n             } else {\n                 qm.sendNext(\"Hey, you're lacking space to hold this, man. I will stay with it while you arrange your backpack...\");\n             }\n-            \n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "0229c9b019e6a1de2daa12e09329ce643c5ee478", "filename": "scripts/quest/3953.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3953.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/3953.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3953.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -43,12 +43,12 @@ function end(mode, type, selection) {\n         } else if (status == 3) {\n             qm.sendSimple(\"They have departed on an expedition to get rid of some major threats in the desert that were ravaging Ariant, for quite some time now... It's strange, they should have already returned... Thinking about it now, the last attack on the merchants was around the direction the Guardians departed... No, that can't be... Can it?\\r\\n\\r\\n#L0##bPerhaps Deo has already turned into a monster.#k\");\n         } else if (status == 4) {\n+            qm.forceCompleteQuest();\n             qm.gainItem(4011008, -1);\n-            \n-            qm.sendNext(\"We're in great trouble, if it is like this. And it really seems like it. If the Royal Cactus Deo has gone insane, Ariant is done for. You, can you do something to defeat Deo? We really need your help now.\");\n             qm.gainExp(20000);\n-            \n-            qm.forceCompleteQuest();\n+\n+            qm.sendNext(\"We're in great trouble, if it is like this. And it really seems like it. If the Royal Cactus Deo has gone insane, Ariant is done for. You, can you do something to defeat Deo? We really need your help now.\");\n+        } else if (status == 5) {\n             qm.dispose();\n         }\n     }"}, {"sha": "0e18b92d347a19411844c8118f2a72417a299db0", "filename": "scripts/quest/4647.js", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/4647.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/4647.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/4647.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -40,16 +40,14 @@ function end(mode, type, selection) {\n \t\t\tstatus--;\n \t\tif (status == 0) {\n \t\t\tif(qm.haveItem(5460000)) {\n-\t\t\t\tqm.sendOk(\"You got the Pet Snack! Thanks! You can use these to feed multiple pets at once!\");\n+\t\t\t\tqm.completeQuest();\n \t\t\t\tqm.teachSkill(8, 1, 1, -1);\n \t\t\t\tqm.gainItem(5460000, -1, false);\n-\t\t\t\tqm.completeQuest();\n-\t\t\t\tqm.dispose();\n+\t\t\t\tqm.sendOk(\"You got the Pet Snack! Thanks! You can use these to feed multiple pets at once!\");\n \t\t\t} else {\n \t\t\t\tqm.sendOk(\"Get me the Pet Snack! It can be found in a very big shop....\");\n-\t\t\t\tqm.dispose();\n \t\t\t}\n-\t\t} else {\n+\t\t} else if (status == 1) {\n \t\t\tqm.dispose();\n \t\t}\n \t}"}, {"sha": "2e50f3ca0146e603dacf559ba9cc03eb7387ebe7", "filename": "scripts/quest/4659.js", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/4659.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/4659.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/4659.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -52,9 +52,10 @@ function end(mode, type, selection) {\n         qm.sendNext(\"Great job on finding your evolution materials. I will now give you a robot.\");\n     }\n     else if (status == 1) {\n-        if (qm.isQuestCompleted(4659))\n+        if (qm.isQuestCompleted(4659)) {\n             qm.dropMessage(1, \"how did this get here?\");\n-        else if (qm.canHold(5000048)){\n+            qm.dispose();\n+        } else if (qm.canHold(5000048)){\n             var pet = 0;\n             var after;\n             var i;\n@@ -108,8 +109,10 @@ function end(mode, type, selection) {\n //            var petId = MaplePet.createPet(rand + 5000049, level, closeness, fullness);\n //            if (petId == -1) return;\n //            MapleInventoryManipulator.addById(qm.getClient(), rand+5000049, 1, \"\", petId);\n-        } else\n+            qm.dispose();\n+        } else {\n             qm.dropMessage(1,\"Your inventory is full\");\n-        qm.dispose();\n+            qm.dispose();\n+        }\n     }\n }\n\\ No newline at end of file"}, {"sha": "3362c48d8fc773ba589511d1c3e8ff47dbd48c0e", "filename": "scripts/quest/6033.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/6033.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/6033.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/6033.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,12 +48,12 @@ function end(mode, type, selection) {\n                 qm.dispose();\n                 return;\n             }\n-        } else {\n+        } else if (status == 2) {\n+            qm.forceCompleteQuest();\n+            \n             var skillid = Math.floor(qm.getPlayer().getJob().getId() / 1000) * 10000000 + 1007;\n             qm.teachSkill(skillid, 2, 3, -1);\n-\n             qm.gainExp(230000);\n-            qm.forceCompleteQuest();\n             qm.dispose();\n         }\n     }"}, {"sha": "af09ed22955ca704f285c62b3a5cddeee10bad41", "filename": "scripts/quest/6036.js", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/6036.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/6036.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/6036.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -48,14 +48,13 @@ function end(mode, type, selection) {\n                 qm.dispose();\n                 return;\n             }\n-        } else {\n+        } else if (status == 2) {\n+            qm.forceCompleteQuest();\n+            \n             qm.gainItem(4031980, -1);\n-                \n             var skillid = Math.floor(qm.getPlayer().getJob().getId() / 1000) * 10000000 + 1007;\n             qm.teachSkill(skillid, 3, 3, -1);\n-\n             qm.gainExp(300000);\n-            qm.forceCompleteQuest();\n             \n             qm.dispose();\n         }"}, {"sha": "dccab63ba8d4e931c6c725d995688b688a396d6b", "filename": "scripts/quest/8185.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8185.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8185.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8185.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -100,7 +100,8 @@ function end(mode, type, selection) {\n                         //SpawnPetHandler.evolve(qm.getPlayer().getClient(), 5000029, after);\n                         \n                         qm.sendOk(\"#bSWEET! IT WORKED!#k Your dragon has grown beautifully! #rYou may find your new pet under your 'CASH' inventory.\\r #kIt used to be a #b #i5000029##t5000029##k, and now it's \\r a #b#i\" + after + \"##t\" + after + \"##k!\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n#v\"+after+\"# #t\"+after+\"#\");\n-\t\t\tqm.dispose();\n-\t\t}\n+\t\t} else if (status == 5) {\n+                        qm.dispose();\n+                }\n \t}\n }\n\\ No newline at end of file"}, {"sha": "64b6b82f5b4a19e70a809123c18d58c2d813d4fe", "filename": "scripts/quest/8189.js", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8189.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8189.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8189.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -63,6 +63,7 @@ function end(mode, type, selection) {\n \t\t\tif (id < 5000029 || id > 5000033) {\n \t\t\t\tqm.sendOk(\"Something wrong, try again.\");\n \t\t\t\tqm.dispose();\n+                                return;\n \t\t\t}\n \t\t\tvar rand = 1 + Math.floor(Math.random() * 10);\n \t\t\tvar after = 0;\n@@ -77,6 +78,7 @@ function end(mode, type, selection) {\n \t\t\t} else {\n \t\t\t\tqm.sendOk(\"Something wrong. Try again.\");\n \t\t\t\tqm.dispose();\n+                                return;\n \t\t\t}\n \t\t\t\n                         /*if (name.equals(MapleItemInformationProvider.getInstance().getName(id))) {\n@@ -88,7 +90,8 @@ function end(mode, type, selection) {\n \t\t\tqm.evolvePet(pet, after);\n                         \n \t\t\tqm.sendOk(\"Woo! It worked again! #rYou may find your new pet under your 'CASH' inventory.\\r #kIt used to be a #b#i\" + id + \"##t\" + id + \"##k, and now it's \\r a#b #i\" + after + \"##t\" + after + \"##k! \\r\\n Come back with 10,000 mesos and another Rock of Evolution if you don't like it!\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n#v\"+after+\"# #t\"+after+\"#\");\n-\t\t\tqm.dispose();\n-\t\t}\n+\t\t} else if (status == 3) {\n+                        qm.dispose();\n+                }\n \t}\n }\n\\ No newline at end of file"}, {"sha": "ff770041d58564cc8d1c982166838ca8c04cad53", "filename": "scripts/quest/8219.js", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8219.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8219.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8219.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,9 +22,10 @@ function start(mode, type, selection) {\n     }\n     if (status == 0)\n             qm.sendAcceptDecline(\"The time is now, kid. We have all the preparations complete to further research for why all these oddities have been happening lately. I also must introduce you to my brother, Jack. \");\n-    if (status == 1){\n+    else if (status == 1){\n             qm.sendOk(\"He is currently wandering around the Crimsonwood Mountain, past the sinister Phantom Forest, in the track to the Crimsonwood Keep. Your next destination is there, may your journey be a safe one.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n@@ -48,14 +49,15 @@ function end(mode, type, selection) {\n \t}\n \telse if (status == 2){\n \t\tif(qm.canHold(3992040, 1)) {\n+                    qm.forceCompleteQuest();\n                     qm.gainItem(3992040, 1);\n                     qm.gainExp(175000);\n-                    qm.forceCompleteQuest();\n+                    qm.dispose();\n                 }\n \t\telse {\n                     qm.sendOk(\"Hey, you don't have a slot in your SETUP inventory for what I have to give to you. Solve that minor issue of yours then talk to me.\");\n                 }\n-                \n+\t} else if (status == 3) {\n                 qm.dispose();\n-\t}\n+        }\n }"}, {"sha": "21a1976bc47dfee26e4f76bd7ebf26ca16cdf40e", "filename": "scripts/quest/8221.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8221.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8221.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8221.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -26,6 +26,7 @@ function start(mode, type, selection) {\n \telse if (status == 1){\n \t\tqm.sendOk(\"Okay, I need you to have these items on hand first: #b10 #t4010006##k, #b4 #t4032005##k and #b1 #t4004000##k. Go!\");\n \t\tqm.forceStartQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }"}, {"sha": "da61f86149d52d5683e68da49a2bfc2fd27f7dfb", "filename": "scripts/quest/8223.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8223.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8223.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8223.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -22,9 +22,10 @@ function start(mode, type, selection) {\n \t}\n \tif (status == 0)\n \t\tqm.sendAcceptDecline(\"Oh, Jack sent you here? Good timing, I'm planning alongside Jack and others to storm the Keep and retake it from the Twisted Masters what is ours by right. You seem ready to fight alongside us, right?\");\n-\tif (status == 1){\n+\telse if (status == 1){\n \t\tqm.sendOk(\"Great! Your mission now is to rack down some numbers of their army and weaken their defenses by all effects. Defeat 75 of each: Windraider, Firebrand and Nightshadow, then return to me to report.\");\n \t\tqm.forceStartQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }"}, {"sha": "95844d8e56ef6c5bddae33f4250a3e853140df09", "filename": "scripts/quest/8224.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8224.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8224.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8224.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,6 +25,7 @@ function start(mode, type, selection) {\n     else if (status == 1){\n             qm.sendOk(\"Ok. I need you to hunt down #bthose fake trees#k in the forest, and collect 50 of their drops as proof that you made your part on this.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }"}, {"sha": "90fadcfb700e82ecbb59c302a11b1a815af5ebe9", "filename": "scripts/quest/8225.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8225.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8225.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8225.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,6 +25,7 @@ function start(mode, type, selection) {\n \telse if (status == 1){\n \t\tqm.sendOk(\"Very well. To prove your valor among our ranks, you must first pass on a little challenge: you have to be able to move extraordinaly well around here, known of all secrets these woods holds. Trace a #bmap of the Phantom Forest#k, then come talk to me. I shall then evaluate if you're worth to be with us.\");\n \t\tqm.forceStartQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }"}, {"sha": "3c4fb90ae10e9b70a5b0d5041a27d6fda57c3247", "filename": "scripts/quest/8226.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8226.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8226.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8226.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,6 +25,7 @@ function start(mode, type, selection) {\n \telse if (status == 1){\n \t\tqm.sendOk(\"Your next mission is: defeat the Elderwraiths that roam this forest. These are a tough bunch though, so stay alert. I need you to bring me 100 #t4032010# as proof of your duty.\");\n \t\tqm.forceStartQuest();\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 2) {\n+                qm.dispose();\n+        }\n }"}, {"sha": "ab61a188d1650aa5065f44b95e48e8ba7089072e", "filename": "scripts/quest/8227.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8227.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8227.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8227.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,7 +30,7 @@ function start(mode, type, selection) {\n         } else {\n             qm.sendOk(\"Hey. There's no slot on your ETC.\");\n         }\n-\n+    } else if (status == 2) {\n         qm.dispose();\n     }\n }\n@@ -53,7 +53,7 @@ function end(mode, type, selection) {\n         } else {\n             qm.sendOk(\"You don't brought the coded letter Jack said? Come on, kid, we need that to decipher our enemies' next step!\");\n         }\n-\n+    } else if (status == 1){\n         qm.dispose();\n     }\n }"}, {"sha": "ef54ea70ae12fdfe667a7f699fabe9c9af273ece", "filename": "scripts/quest/8228.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8228.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8228.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8228.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,7 +30,7 @@ function start(mode, type, selection) {\n             } else {\n                 qm.sendOk(\"Hey. There's no slot on your ETC.\");\n             }\n-\n+\t} else if (status == 2){\n             qm.dispose();\n \t}\n }\n@@ -53,7 +53,7 @@ function end(mode, type, selection) {\n         } else {\n             qm.sendOk(\"I'm afraid you don't have the letter you claimed to have with you.\");\n         }\n-\n+    } else if (status == 1) {\n         qm.dispose();\n     }\n }"}, {"sha": "f1983e82d43059872d1852448f6074679847ee57", "filename": "scripts/quest/8230.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8230.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8230.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8230.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,6 +25,7 @@ function start(mode, type, selection) {\n     else if (status == 1) {\n             qm.sendOk(\"That's the thing: the Twisted Masters, great figures that currently holds seize of the Crimsonwood Keep, have planned a large-scale attack to the New Leaf City, that may be happening on the next few days. I can't just stay here observing while they prepare for this attack. However, I can't just leave this position, I must keep an eye on their moves at all costs. There's where you enter: go find Lukan, knight of the past Crimsonwood Keep, that is currently wandering around the woods, and receive from him further orders, he knows what to do.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n@@ -41,7 +42,7 @@ function end(mode, type, selection) {\n \t\t} else {\n \t\t\tqm.sendOk(\"The folks back there on the city are counting on you on this one. Please hurry up.\");\n \t\t}\n-\t\n-\t\tqm.dispose();\n-\t}\n+\t} else if (status == 1) {\n+                qm.dispose();\n+        }\n }\n\\ No newline at end of file"}, {"sha": "8d339bb87e6d2f5e62d118d4e538a04bb0c3047f", "filename": "scripts/quest/8231.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8231.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8231.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8231.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r30 #t4032031##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "8d339bb87e6d2f5e62d118d4e538a04bb0c3047f", "filename": "scripts/quest/8232.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8232.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8232.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8232.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r30 #t4032031##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "40ff75b5ea289b7c9d5442a072a2d37c6673cacb", "filename": "scripts/quest/8233.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8233.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8233.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8233.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r30 #t4032011##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "40ff75b5ea289b7c9d5442a072a2d37c6673cacb", "filename": "scripts/quest/8234.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8234.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8234.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8234.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r30 #t4032011##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "1ea6062dd99f13131e4f36e8c9f9afe64c659d54", "filename": "scripts/quest/8235.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8235.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8235.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8235.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r1 #t4031903##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "1ea6062dd99f13131e4f36e8c9f9afe64c659d54", "filename": "scripts/quest/8236.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8236.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8236.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8236.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r1 #t4031903##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "d47ec715ec9b222697998520f13812b8c061dc04", "filename": "scripts/quest/8237.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8237.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8237.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8237.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r1 #t4032013##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "d47ec715ec9b222697998520f13812b8c061dc04", "filename": "scripts/quest/8238.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8238.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/quest/8238.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/8238.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@ function start(mode, type, selection) {\n             var reqs = \"#r1 #t4032013##k\";\n             qm.sendOk(\"Very well. Get me #r\" + reqs + \"#k, asap. The NLC is counting on you.\");\n             qm.forceStartQuest();\n+    } else if (status == 2) {\n             qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "da63c803c2440e726c95fe07b5c7651ab1aeb580", "filename": "scripts/reactor/2008007.js", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/reactor/2008007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/scripts/reactor/2008007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2008007.js?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,29 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+ * \n+ * 2008007.js: OrbisPQ jail obstacle trigger\n+*/\n+\n+function hit() {\n+    var map = rm.getMap();\n+    map.moveEnvironment(\"trap\" + rm.getReactor().getName()[5], 1);\n+}\n\\ No newline at end of file"}, {"sha": "da70aa96376d1108fcfc9f89f51c5a47f8d73428", "filename": "sql/db_database.sql", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -12828,7 +12828,7 @@ CREATE TABLE IF NOT EXISTS `dueypackages` (\n   `SenderName` varchar(13) NOT NULL,\n   `Mesos` int(10) unsigned DEFAULT '0',\n   `TimeStamp` timestamp NOT NULL DEFAULT '2015-01-01 05:00:00',\n-  `Message` varchar(200) NOT NULL DEFAULT \"\",\n+  `Message` varchar(200) NULL,\n   `Checked` tinyint(1) unsigned DEFAULT '1',\n   `Type` tinyint(1) unsigned DEFAULT '0',\n   PRIMARY KEY (`PackageId`)"}, {"sha": "bfa645f25a024c0842a1eb4ebf4bc578c7849d9e", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 69, "deletions": 15, "changes": 84, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -168,6 +168,7 @@\n import net.server.audit.locks.MonitoredLockType;\n import net.server.audit.locks.factory.MonitoredReentrantLockFactory;\n import org.apache.mina.util.ConcurrentHashSet;\n+import scripting.quest.QuestActionManager;\n import server.maps.FieldLimit;\n \n public class MapleCharacter extends AbstractMapleCharacterObject {\n@@ -305,6 +306,7 @@\n     private List<Integer> viptrockmaps = new ArrayList<>();\n     private Map<String, MapleEvents> events = new LinkedHashMap<>();\n     private PartyQuest partyQuest = null;\n+    private List<Pair<DelayedQuestUpdate, Object[]>> npcUpdateQuests = new LinkedList<>();\n     private MapleDragon dragon = null;\n     private MapleRing marriageRing;\n     private int marriageItemid = -1;\n@@ -1173,7 +1175,13 @@ public synchronized void changeJob(MapleJob newJob) {\n             if (this.isCygnus()) {\n                 gainAp(7, true);\n             } else {\n-                gainAp(5, true);\n+                if (ServerConstants.USE_STARTING_AP_4 || newJob.getId() % 10 >= 1) {\n+                    gainAp(5, true);\n+                }\n+            }\n+        } else {    // thanks Periwinks for noticing an AP shortage from lower levels\n+            if (ServerConstants.USE_STARTING_AP_4 && newJob.getId() % 1000 >= 1) {\n+                gainAp(4, true);\n             }\n         }\n         \n@@ -3877,10 +3885,8 @@ private boolean cancelEffect(MapleStatEffect effect, boolean overwrite, long sta\n         \n         List<Pair<MapleBuffStat, MapleBuffStatValueHolder>> toCancel = deregisterBuffStats(buffstats);\n         if (effect.isMonsterRiding()) {\n-            if (effect.getSourceId() != Corsair.BATTLE_SHIP) {\n-                this.getClient().getWorldServer().unregisterMountHunger(this);\n-                this.getMount().setActive(false);\n-            }\n+            this.getClient().getWorldServer().unregisterMountHunger(this);\n+            this.getMount().setActive(false);\n         }\n         \n         if (!overwrite) {\n@@ -6168,7 +6174,7 @@ private int getChangedJobSp(MapleJob newJob) {\n             spGain += (expectedSp - curSp);\n         }\n         \n-        return getSpGain(spGain, curSp, job);\n+        return getSpGain(spGain, curSp, newJob);\n     }\n     \n     private int getUsedSp(MapleJob job) {\n@@ -7391,7 +7397,7 @@ public void updateQuestMobCount(int id) {\n                         continue;\n                     }\n                     if (q.progress(id)) {\n-                        client.announce(MaplePacketCreator.updateQuest(q, false));\n+                        announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, false);\n                     }\n                 }\n             }\n@@ -7400,8 +7406,9 @@ public void updateQuestMobCount(int id) {\n         }\n     }\n \n-    public void mount(int id, int skillid) {\n+    public MapleMount mount(int id, int skillid) {\n         maplemount = new MapleMount(this, id, skillid);\n+        return maplemount;\n     }\n \n     private void playerDead() {\n@@ -9632,9 +9639,9 @@ public void updateQuestInfo(int quest, String info) {\n             quests.put(q.getId(), qs);\n         }\n \n-        announce(MaplePacketCreator.updateQuest(qs, false));\n+        announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n         if (qs.getQuest().getInfoNumber() > 0) {\n-            announce(MaplePacketCreator.updateQuest(qs, true));\n+            announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n         }\n         announce(MaplePacketCreator.updateQuestInfo((short) qs.getQuest().getId(), qs.getNpc()));\n     }\n@@ -9657,14 +9664,61 @@ public void awardQuestPoint(int awardedPoints) {\n         }\n     }\n     \n+    public enum DelayedQuestUpdate {    // quest updates allow player actions during NPC talk...\n+        UPDATE, FORFEIT, COMPLETE\n+    }\n+    \n+    private void announceUpdateQuestInternal(Pair<DelayedQuestUpdate, Object[]> questUpdate) {\n+        Object[] objs = questUpdate.getRight();\n+        \n+        switch (questUpdate.getLeft()) {\n+            case UPDATE:\n+                announce(MaplePacketCreator.updateQuest((MapleQuestStatus) objs[0], (Boolean) objs[1]));\n+                break;\n+                \n+            case FORFEIT:\n+                announce(MaplePacketCreator.forfeitQuest((Short) objs[0]));\n+                break;\n+                \n+            case COMPLETE:\n+                announce(MaplePacketCreator.completeQuest((Short) objs[0], (Long) objs[1]));\n+                break;\n+        }\n+    }\n+    \n+    public void announceUpdateQuest(DelayedQuestUpdate questUpdateType, Object... params) {\n+        Pair<DelayedQuestUpdate, Object[]> p = new Pair<>(questUpdateType, params);\n+        MapleClient c = this.getClient();\n+        if (c.getQM() != null || c.getCM() != null) {\n+            synchronized (npcUpdateQuests) {\n+                npcUpdateQuests.add(p);\n+            }\n+        } else {\n+            announceUpdateQuestInternal(p);\n+        }\n+    }\n+    \n+    public void flushDelayedUpdateQuests() {\n+        List<Pair<DelayedQuestUpdate, Object[]>> qmQuestUpdateList;\n+        \n+        synchronized (npcUpdateQuests) {\n+            qmQuestUpdateList = new ArrayList<>(npcUpdateQuests);\n+            npcUpdateQuests.clear();\n+        }\n+        \n+        for (Pair<DelayedQuestUpdate, Object[]> q : qmQuestUpdateList) {\n+            announceUpdateQuestInternal(q);\n+        }\n+    }\n+    \n     public void updateQuest(MapleQuestStatus quest) {\n         synchronized (quests) {\n             quests.put(quest.getQuestID(), quest);\n         }\n         if (quest.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-            announce(MaplePacketCreator.updateQuest(quest, false));\n+            announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, false);\n             if (quest.getQuest().getInfoNumber() > 0) {\n-                announce(MaplePacketCreator.updateQuest(quest, true));\n+                announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, true);\n             }\n             announce(MaplePacketCreator.updateQuestInfo((short) quest.getQuest().getId(), quest.getNpc()));\n         } else if (quest.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n@@ -9675,11 +9729,11 @@ public void updateQuest(MapleQuestStatus quest) {\n             }\n             quest.setCompleted(quest.getCompleted() + 1);   // count quest completed Jayd's idea\n             \n-            announce(MaplePacketCreator.completeQuest(questid, quest.getCompletionTime()));\n+            announceUpdateQuest(DelayedQuestUpdate.COMPLETE, questid, quest.getCompletionTime());\n         } else if (quest.getStatus().equals(MapleQuestStatus.Status.NOT_STARTED)) {\n-            announce(MaplePacketCreator.updateQuest(quest, false));\n+            announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, false);\n             if (quest.getQuest().getInfoNumber() > 0) {\n-                announce(MaplePacketCreator.updateQuest(quest, true));\n+                announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, true);\n             }\n         }\n     }"}, {"sha": "74d73f001bc26695999614c8fd86b51787b0b275", "filename": "src/client/creator/CharacterFactoryRecipe.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/creator/CharacterFactoryRecipe.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/creator/CharacterFactoryRecipe.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/creator/CharacterFactoryRecipe.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -23,6 +23,7 @@\n import client.Skill;\n import client.inventory.Item;\n import client.inventory.MapleInventoryType;\n+import constants.ServerConstants;\n import java.util.concurrent.atomic.AtomicInteger;\n import java.util.LinkedHashMap;\n import java.util.LinkedList;\n@@ -39,7 +40,7 @@\n     private int level, map, top, bottom, shoes, weapon;\n     private int str = 4, dex = 4, int_ = 4, luk = 4;\n     private int maxHp = 50, maxMp = 5;\n-    private int ap = 9, sp = 0;\n+    private int ap = 0, sp = 0;\n     private int meso = 0;\n     private List<Pair<Skill, Integer>> skills = new LinkedList<>();\n     \n@@ -54,6 +55,15 @@ public CharacterFactoryRecipe(MapleJob job, int level, int map, int top, int bot\n         this.bottom = bottom;\n         this.shoes = shoes;\n         this.weapon = weapon;\n+        \n+        if (!ServerConstants.USE_STARTING_AP_4) {\n+            if (ServerConstants.USE_AUTOASSIGN_STARTERS_AP) {\n+                str = 12;\n+                dex = 5;\n+            } else {\n+                ap = 9;\n+            }\n+        }\n     }\n     \n     public void setStr(int v) {"}, {"sha": "d629e565c29f4b439387a8c9d3df18bac373cee8", "filename": "src/client/processor/DueyProcessor.java", "status": "modified", "additions": 9, "deletions": 13, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/processor/DueyProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/client/processor/DueyProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/DueyProcessor.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -60,6 +60,7 @@\n public class DueyProcessor {\n     \n     public enum Actions {\n+        TOSERVER_RECV_ITEM(0x00),\n         TOSERVER_SEND_ITEM(0x02),\n         TOSERVER_CLAIM_PACKAGE(0x04),\n         TOSERVER_REMOVE_PACKAGE(0x05),\n@@ -113,15 +114,6 @@ public byte getCode() {\n         return null;\n     }\n     \n-    private static Timestamp getCurrentDate(boolean quick) {\n-        Calendar cal = Calendar.getInstance();\n-        if (!quick) {\n-            cal.add(Calendar.DATE, 1);\n-        }\n-        \n-        return new Timestamp(cal.getTime().getTime());\n-    }\n-    \n     private static void showDueyNotification(MapleClient c, MapleCharacter player) {\n         Connection con = null;\n         PreparedStatement ps = null;\n@@ -204,7 +196,7 @@ private static DueyPackage getPackageFromDB(ResultSet rs) {\n             \n             dueypack.setSender(rs.getString(\"SenderName\"));\n             dueypack.setMesos(rs.getInt(\"Mesos\"));\n-            dueypack.setSentTime(rs.getTimestamp(\"TimeStamp\"));\n+            dueypack.setSentTime(rs.getTimestamp(\"TimeStamp\"), rs.getBoolean(\"Type\"));\n             dueypack.setMessage(rs.getString(\"Message\"));\n             \n             return dueypack;\n@@ -250,7 +242,7 @@ private static int createPackage(int mesos, String message, String sender, int t\n                 ps.setInt(1, toCid);\n                 ps.setString(2, sender);\n                 ps.setInt(3, mesos);\n-                ps.setTimestamp(4, getCurrentDate(quick));\n+                ps.setTimestamp(4, new Timestamp(System.currentTimeMillis()));\n                 ps.setString(5, message);\n                 ps.setInt(6, quick ? 1 : 0);\n \n@@ -515,15 +507,19 @@ public static void dueySendTalk(MapleClient c, boolean quickDelivery) {\n                 }\n                 c.getPlayer().setNpcCooldown(timeNow);\n                 \n-                c.announce(MaplePacketCreator.sendDuey(quickDelivery ? 0x1A : 0x8, loadPackages(c.getPlayer())));\n+                if (quickDelivery) {\n+                    c.announce(MaplePacketCreator.sendDuey(0x1A, null));\n+                } else {\n+                    c.announce(MaplePacketCreator.sendDuey(0x8, loadPackages(c.getPlayer())));\n+                }\n             } finally {\n                 c.releaseClient();\n             }\n         }\n     }\n     \n     public static void dueyCreatePackage(Item item, int mesos, String sender, int recipientCid) {\n-        int packageId = createPackage(mesos, \"\", sender, recipientCid, false);\n+        int packageId = createPackage(mesos, null, sender, recipientCid, false);\n         if (packageId != -1) {\n             insertPackageItem(packageId, item);\n         }"}, {"sha": "a869edb18b9dbe042980a6641973b7307dce61ff", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -7,9 +7,16 @@\n import java.util.Map;\n import client.MapleJob;\n import constants.skills.Aran;\n+import java.io.File;\n import java.text.DecimalFormat;\n import java.text.NumberFormat;\n import java.util.Locale;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataFileEntry;\n+import provider.MapleDataProvider;\n+import provider.MapleDataProviderFactory;\n+import provider.MapleDataTool;\n import server.maps.MapleMap;\n import server.maps.FieldLimit;\n import server.quest.MapleQuest;\n@@ -38,6 +45,8 @@\n     public static final MapleDisease[] CPQ_DISEASES = {MapleDisease.SLOW, MapleDisease.SEDUCE, MapleDisease.STUN, MapleDisease.POISON,\n                                                        MapleDisease.SEAL, MapleDisease.DARKNESS, MapleDisease.WEAKEN, MapleDisease.CURSE};\n     \n+    public static final int MAX_FIELD_MOB_DAMAGE = getMaxObstacleMobDamageFromWz() * 2;\n+    \n     public static int getPlayerBonusDropRate(int slot) {\n         return(DROP_RATE_GAIN[slot]);\n     }\n@@ -672,4 +681,32 @@ public synchronized static Number parseNumber(String value) {\n             return 0.0f;\n         }\n     }\n+    \n+    private static int getMaxObstacleMobDamageFromWz() {\n+        MapleDataProvider mapSource = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Map.wz\"));\n+        int maxMobDmg = 0;\n+        \n+        MapleDataDirectoryEntry root = mapSource.getRoot();\n+        for (MapleDataDirectoryEntry objData : root.getSubdirectories()) {\n+            if (!objData.getName().contentEquals(\"Obj\")) {\n+                continue;\n+            }\n+            \n+            for (MapleDataFileEntry obj : objData.getFiles()) {\n+                for (MapleData l0 : mapSource.getData(objData.getName() + \"/\" + obj.getName()).getChildren()) {\n+                    for (MapleData l1 : l0.getChildren()) {\n+                        for (MapleData l2 : l1.getChildren()) {\n+                            int objDmg = MapleDataTool.getIntConvert(\"s1/mobdamage\", l2, 0);\n+                            if (maxMobDmg < objDmg) {\n+                                maxMobDmg = objDmg;\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+        \n+        return maxMobDmg;\n+    }\n+    \n }"}, {"sha": "b037901aecc39a2dbf260e8affc35945113299a2", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -80,6 +80,7 @@\n     public static final boolean USE_PARTY_FOR_STARTERS = true;      //Players level 10 or below can create/invite other players on the given level range.\n     public static final boolean USE_AUTOASSIGN_STARTERS_AP = false; //Beginners level 10 or below have their AP autoassigned (they can't choose to levelup a stat). Set true ONLY if the localhost doesn't support AP assigning for beginners level 10 or below.\n     public static final boolean USE_AUTOASSIGN_SECONDARY_CAP = true;//Prevents AP autoassign from spending on secondary stats after the player class' cap (defined on the autoassign handler) has been reached.\n+    public static final boolean USE_STARTING_AP_4 = true;           //Use early-GMS 4/4/4/4 starting stats. To overcome AP shortage, this gives 4AP/5AP at 1st/2nd job advancements.\n     public static final boolean USE_AUTOBAN = false;                //Commands the server to detect infractors automatically.\n     public static final boolean USE_AUTOBAN_LOG = true;             //Log autoban related messages. Still logs even with USE_AUTOBAN disabled.\n     public static final boolean USE_AUTOSAVE = true;                //Enables server autosaving feature (saves characters to DB each 1 hour)."}, {"sha": "16d7accdc30d84009d0afb75d629157294206811", "filename": "src/net/PacketProcessor.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/PacketProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/PacketProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/PacketProcessor.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -245,6 +245,7 @@ public void reset(int channel) {\n             registerHandler(RecvOpcode.PLAYER_MAP_TRANSFER, new PlayerMapTransitionHandler());\n             registerHandler(RecvOpcode.USE_MAPLELIFE, new UseMapleLifeHandler());\n             registerHandler(RecvOpcode.USE_CATCH_ITEM, new UseCatchItemHandler());\n+            registerHandler(RecvOpcode.FIELD_DAMAGE_MOB, new FieldDamageMobHandler());\n             registerHandler(RecvOpcode.MOB_DAMAGE_MOB_FRIENDLY, new MobDamageMobFriendlyHandler());\n             registerHandler(RecvOpcode.PARTY_SEARCH_REGISTER, new PartySearchRegisterHandler());\n             registerHandler(RecvOpcode.PARTY_SEARCH_START, new PartySearchStartHandler());"}, {"sha": "e357620210d6e176e9369b3adbe12639e0b95142", "filename": "src/net/opcodes/RecvOpcode.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/opcodes/RecvOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/opcodes/RecvOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/RecvOpcode.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -170,6 +170,7 @@\n     MOVE_DRAGON(0xB5),\n     MOVE_LIFE(0xBC),\n     AUTO_AGGRO(0xBD),\n+    FIELD_DAMAGE_MOB(0xBF),\n     MOB_DAMAGE_MOB_FRIENDLY(0xC0),\n     MONSTER_BOMB(0xC1),\n     MOB_DAMAGE_MOB(0xC2),"}, {"sha": "94537cb291f70fe0d01b069e487d7cd6de59bab3", "filename": "src/net/server/Server.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1868,12 +1868,12 @@ private synchronized void shutdownInternal(boolean restart) {\n             }\n         }\n \n-        resetServerWorlds();\n-\n         ThreadManager.getInstance().stop();\n         TimerManager.getInstance().purge();\n         TimerManager.getInstance().stop();\n-\n+        \n+        resetServerWorlds();\n+        \n         System.out.println(\"Worlds + Channels are offline.\");\n         acceptor.unbind();\n         acceptor = null;"}, {"sha": "7172750966dee5fc719dd20067b3efdd6013ea44", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -321,8 +321,9 @@ public void run() {\n                         Skill steal = SkillFactory.getSkill(Bandit.STEAL);\n                         if (monster.getStolen().size() < 1) { // One steal per mob <3\n                             if (steal.getEffect(player.getSkillLevel(steal)).makeChanceResult()) {\n-                                MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n+                                monster.addStolen(0);\n                                 \n+                                MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n                                 List<Integer> dropPool = mi.retrieveDropPool(monster.getId());\n                                 if(!dropPool.isEmpty()) {\n                                     Integer rndPool = (int) Math.floor(Math.random() * dropPool.get(dropPool.size() - 1));\n@@ -441,11 +442,13 @@ public void run() {\n                             } else {\n                                 mortalBlow = SkillFactory.getSkill(Sniper.MORTAL_BLOW);\n                             }\n-                            if (player.getSkillLevel(mortalBlow) > 0) {\t                    \t\t\n-                                MapleStatEffect mortal = mortalBlow.getEffect(player.getSkillLevel(mortalBlow));\n+                            \n+                            int skillLevel = player.getSkillLevel(mortalBlow);\n+                            if (skillLevel > 0) {\n+                                MapleStatEffect mortal = mortalBlow.getEffect(skillLevel);\n                                 if (monster.getHp() <= (monster.getStats().getHp() * mortal.getX()) / 100) {\n                                     if (Randomizer.rand(1, 100) <= mortal.getY()) {\n-                                        monster.getMap().killMonster(monster, player, true);\n+                                        map.damageMonster(player, monster, Integer.MAX_VALUE);  // thanks Conrad for noticing reduced EXP gain from skill kill\n                                     }\n                                 }\n                             }"}, {"sha": "9f6e9d697add0f1a5c2e3eaaa04aa4e86b8b44cb", "filename": "src/net/server/channel/handlers/CashShopSurpriseHandler.java", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/CashShopSurpriseHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/CashShopSurpriseHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CashShopSurpriseHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -40,12 +40,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             Pair<Item, Item> cssResult = cs.openCashShopSurprise();\n             \n             if(cssResult != null) {\n-                //Item cssItem = cssResult.getLeft(), cssBox = cssResult.getRight();\n-                //c.announce(MaplePacketCreator.onCashGachaponOpenSuccess(c.getAccID(), cssBox.getSN(), cssBox.getQuantity(), cssItem, cssItem.getItemId(), cssItem.getQuantity(), true));\n-                c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xA4));\n+                Item cssItem = cssResult.getLeft(), cssBox = cssResult.getRight();\n+                c.announce(MaplePacketCreator.onCashGachaponOpenSuccess(c.getAccID(), cssBox.getSN(), cssBox.getQuantity(), cssItem, cssItem.getItemId(), cssItem.getQuantity(), true));\n             } else {\n-                //c.announce(MaplePacketCreator.onCashItemGachaponOpenFailed());\n-                c.announce(MaplePacketCreator.showCashShopMessage((byte) 0x00));\n+                c.announce(MaplePacketCreator.onCashItemGachaponOpenFailed());\n             }\n         }\n     }"}, {"sha": "89fc361282740e396258d02e5b339bb7f8393f58", "filename": "src/net/server/channel/handlers/DueyHandler.java", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/DueyHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/DueyHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DueyHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -37,16 +37,18 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             c.announce(MaplePacketCreator.enableActions());\n             return;\n     \t}\n-            \n+        \n         byte operation = slea.readByte();\n-        if (operation == DueyProcessor.Actions.TOSERVER_SEND_ITEM.getCode()) {\n+        if (operation == DueyProcessor.Actions.TOSERVER_RECV_ITEM.getCode()) { // on click 'O' Button, thanks inhyuk\n+            DueyProcessor.dueySendTalk(c, false);\n+        } else if (operation == DueyProcessor.Actions.TOSERVER_SEND_ITEM.getCode()) {\n             byte inventId = slea.readByte();\n             short itemPos = slea.readShort();\n             short amount = slea.readShort();\n             int mesos = slea.readInt();\n             String recipient = slea.readMapleAsciiString();\n             boolean quick = slea.readByte() != 0;\n-            String message = quick ? slea.readMapleAsciiString() : \"\";\n+            String message = quick ? slea.readMapleAsciiString() : null;\n             \n             DueyProcessor.dueySendItem(c, inventId, itemPos, amount, mesos, message, recipient, quick);\n         } else if (operation == DueyProcessor.Actions.TOSERVER_REMOVE_PACKAGE.getCode()) {"}, {"sha": "4ae3153e96249010dbb16236a05b8f84ddc28ee3", "filename": "src/net/server/channel/handlers/FieldDamageMobHandler.java", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/FieldDamageMobHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/FieldDamageMobHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/FieldDamageMobHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,59 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.channel.handlers;\n+\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import constants.GameConstants;\n+import net.AbstractMaplePacketHandler;\n+import server.life.MapleMonster;\n+import server.life.MapleMonsterInformationProvider;\n+import server.maps.MapleMap;\n+import tools.FilePrinter;\n+import tools.MaplePacketCreator;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+public class FieldDamageMobHandler extends AbstractMaplePacketHandler {\n+    \n+    @Override\n+    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n+        int mobOid = slea.readInt();    // packet structure found thanks to Darter (Rajan)\n+        int dmg = slea.readInt();\n+        \n+        MapleCharacter chr = c.getPlayer();\n+        MapleMap map = chr.getMap();\n+        \n+        if (map.getEnvironment().isEmpty()) {   // no environment objects activated to actually hit the mob\n+            FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use an obstacle on mapid \" + map.getId() + \" to attack.\");\n+            return;\n+        }\n+        \n+        MapleMonster mob = map.getMonsterByOid(mobOid);\n+        if (mob != null) {\n+            if (dmg < 0 || dmg > GameConstants.MAX_FIELD_MOB_DAMAGE) {\n+                FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use an obstacle on mapid \" + map.getId() + \" to attack \" + MapleMonsterInformationProvider.getInstance().getMobNameFromId(mob.getId()) + \" with damage \" + dmg);\n+                return;\n+            }\n+            \n+            map.broadcastMessage(chr, MaplePacketCreator.damageMonster(mobOid, dmg), true);\n+            map.damageMonster(chr, mob, dmg);\n+        }\n+    }\n+}"}, {"sha": "35ab9233d0f4c6ebd06cb5628059c7b788957aba", "filename": "src/net/server/channel/handlers/HealOvertimeHandler.java", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/HealOvertimeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/HealOvertimeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/HealOvertimeHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,10 +25,9 @@\n import client.MapleClient;\n import client.autoban.AutobanFactory;\n import client.autoban.AutobanManager;\n-import constants.GameConstants;\n import net.AbstractMaplePacketHandler;\n import net.server.Server;\n-import server.maps.MapleMapFactory;\n+import server.maps.MapleMap;\n import tools.data.input.SeekableLittleEndianAccessor;\n import tools.MaplePacketCreator;\n \n@@ -47,7 +46,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             abm.setTimestamp(8, timestamp, 28);  // thanks Vcoc & Thora for pointing out d/c happening here\n             if ((abm.getLastSpam(0) + 1500) > timestamp) AutobanFactory.FAST_HP_HEALING.addPoint(abm, \"Fast hp healing\");\n             \n-            int abHeal = (int)(77 * MapleMapFactory.getMapRecoveryRate(chr.getMapId()) * 1.5); // thanks Ari for noticing players not getting healed in sauna in certain cases\n+            MapleMap map = chr.getMap();\n+            int abHeal = (int)(77 * map.getRecovery() * 1.5); // thanks Ari for noticing players not getting healed in sauna in certain cases\n             if (healHP > abHeal) {\n                 AutobanFactory.HIGH_HP_HEALING.autoban(chr, \"Healing: \" + healHP + \"; Max is \" + abHeal + \".\");\n                 return;\n@@ -60,7 +60,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         short healMP = slea.readShort();\n         if (healMP != 0 && healMP < 1000) {\n             abm.setTimestamp(9, timestamp, 28);\n-            if ((abm.getLastSpam(1) + 1500) > timestamp) AutobanFactory.FAST_MP_HEALING.addPoint(abm, \"Fast mp healing\");\n+            if ((abm.getLastSpam(1) + 1500) > timestamp) {\n+                AutobanFactory.FAST_MP_HEALING.addPoint(abm, \"Fast mp healing\");\n+                return;     // thanks resinate for noticing mp being gained even after detection\n+            }\n             chr.addMP(healMP);\n             abm.spam(1, timestamp);\n         }"}, {"sha": "ab3a75e6e1828e6fd02787657cc0324026f472e0", "filename": "src/net/server/channel/handlers/HiredMerchantRequest.java", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/HiredMerchantRequest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/HiredMerchantRequest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/HiredMerchantRequest.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -27,8 +27,12 @@\n import java.util.Arrays;\n import client.MapleClient;\n import constants.GameConstants;\n+import java.awt.Point;\n import net.AbstractMaplePacketHandler;\n+import server.MaplePortal;\n+import server.maps.MapleMapObject;\n import server.maps.MapleMapObjectType;\n+import server.maps.MaplePlayerShop;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -40,7 +44,34 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleCharacter chr = c.getPlayer();\n-        if (chr.getMap().getMapObjectsInRange(chr.getPosition(), 23000, Arrays.asList(MapleMapObjectType.HIRED_MERCHANT)).isEmpty() && (GameConstants.isFreeMarketRoom(chr.getMapId()))) {\n+        \n+        try {\n+            for (MapleMapObject mmo : chr.getMap().getMapObjectsInRange(chr.getPosition(), 23000, Arrays.asList(MapleMapObjectType.HIRED_MERCHANT, MapleMapObjectType.PLAYER))) {\n+                if (mmo instanceof MapleCharacter) {\n+                    MapleCharacter mc = (MapleCharacter) mmo;\n+\n+                    MaplePlayerShop shop = mc.getPlayerShop();\n+                    if (shop != null && shop.isOwner(mc)) {\n+                        chr.announce(MaplePacketCreator.getMiniRoomError(13));\n+                        return;\n+                    }\n+                } else {\n+                    chr.announce(MaplePacketCreator.getMiniRoomError(13));\n+                    return;\n+                }\n+            }\n+\n+            Point cpos = chr.getPosition();\n+            MaplePortal portal = chr.getMap().findClosestTeleportPortal(cpos);\n+            if (portal != null && portal.getPosition().distance(cpos) < 120.0) {\n+                chr.announce(MaplePacketCreator.getMiniRoomError(10));\n+                return;\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+        \n+        if (GameConstants.isFreeMarketRoom(chr.getMapId())) {\n             if (!chr.hasMerchant()) {\n                 try {\n                     if (ItemFactory.MERCHANT.loadItems(chr.getId(), false).isEmpty() && chr.getMerchantMeso() == 0) {"}, {"sha": "372fa4293d57ec8dca00be3f50757dc998a91270", "filename": "src/net/server/channel/handlers/NPCAnimationHandler.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/NPCAnimationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/NPCAnimationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/NPCAnimationHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,6 +30,10 @@\n public final class NPCAnimationHandler extends AbstractMaplePacketHandler {\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n+        if (c.getPlayer().isChangingMaps()) {   // possible cause of error 38 in some map transition scenarios, thanks Arnah\n+            return;\n+        }\n+        \n         MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n         int length = (int) slea.available();\n         if (length == 6) { // NPC Talk"}, {"sha": "463dcb4f182fe6e731034e7cbcc59bd9beed2c06", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 43, "deletions": 7, "changes": 50, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -34,11 +34,13 @@\n \n import net.AbstractMaplePacketHandler;\n import server.MapleItemInformationProvider;\n+import server.MaplePortal;\n import server.MapleTrade;\n import constants.GameConstants;\n import server.maps.FieldLimit;\n import server.maps.MapleHiredMerchant;\n import server.maps.MapleMapObject;\n+import server.maps.MapleMapObjectType;\n import server.maps.MapleMiniGame;\n import server.maps.MapleMiniGame.MiniGameType;\n import server.maps.MaplePlayerShop;\n@@ -49,6 +51,7 @@\n \n import java.awt.Point;\n import java.sql.SQLException;\n+import java.util.Arrays;\n \n /**\n  *\n@@ -237,13 +240,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         return;\n                     }\n                     \n-                    try {\n-                        Point cpos = chr.getPosition();\n-                        if (chr.getMap().findClosestWarpPortal(cpos).getPosition().distance(cpos) < 120.0) {\n-                            chr.getClient().announce(MaplePacketCreator.getMiniRoomError(10));\n-                            return;\n-                        }\n-                    } catch (NullPointerException npe) {}\n+                    if (!canPlaceStore(chr)) {\n+                        return;\n+                    }\n                     \n                     String desc = slea.readMapleAsciiString();\n                     slea.skip(3);\n@@ -362,6 +361,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     \n                     c.announce(MaplePacketCreator.hiredMerchantOwnerMaintenanceLeave());\n                 }\n+                \n+                if (!canPlaceStore(chr)) {    // thanks Ari for noticing player shops overlapping on opening time\n+                    return;\n+                }\n \n                 MaplePlayerShop shop = chr.getPlayerShop();\n                 MapleHiredMerchant merchant = chr.getHiredMerchant();\n@@ -797,4 +800,37 @@ private static boolean isTradeOpen(MapleCharacter chr) {\n         \n         return false;\n     }\n+    \n+    private static boolean canPlaceStore(MapleCharacter chr) {\n+        try {\n+            for (MapleMapObject mmo : chr.getMap().getMapObjectsInRange(chr.getPosition(), 23000, Arrays.asList(MapleMapObjectType.HIRED_MERCHANT, MapleMapObjectType.PLAYER))) {\n+                if (mmo instanceof MapleCharacter) {\n+                    MapleCharacter mc = (MapleCharacter) mmo;\n+                    if (mc.getId() == chr.getId()) {\n+                        continue;\n+                    }\n+\n+                    MaplePlayerShop shop = mc.getPlayerShop();\n+                    if (shop != null && shop.isOwner(mc)) {\n+                        chr.announce(MaplePacketCreator.getMiniRoomError(13));\n+                        return false;\n+                    }\n+                } else {\n+                    chr.announce(MaplePacketCreator.getMiniRoomError(13));\n+                    return false;\n+                }\n+            }\n+\n+            Point cpos = chr.getPosition();\n+            MaplePortal portal = chr.getMap().findClosestTeleportPortal(cpos);\n+            if (portal != null && portal.getPosition().distance(cpos) < 120.0) {\n+                chr.announce(MaplePacketCreator.getMiniRoomError(10));\n+                return false;\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+        \n+        return true;\n+    }\n }"}, {"sha": "e0d602d94165f7770f4e73a338e3640c8f271ae0", "filename": "src/net/server/channel/handlers/RaiseUIStateHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/RaiseUIStateHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/channel/handlers/RaiseUIStateHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RaiseUIStateHandler.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,10 +1,10 @@\n package net.server.channel.handlers;\n \n+import client.MapleCharacter.DelayedQuestUpdate;\n import client.MapleClient;\n import client.MapleQuestStatus;\n import net.AbstractMaplePacketHandler;\n import server.quest.MapleQuest;\n-import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n /**\n@@ -25,7 +25,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     quest.forceStart(c.getPlayer(), 22000);\n                     c.getPlayer().updateQuestInfo(quest.getId(), \"0\"); \n                 } else if (mqs.getStatus() == MapleQuestStatus.Status.STARTED) {\n-                    c.announce(MaplePacketCreator.updateQuest(mqs, false));\n+                    c.getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, mqs, false);\n                 } else {\n                     //c.announce(MaplePacketCreator.updateQuestInfo(mqs.getQuestID(), 22000, \"0\"));\n                 }"}, {"sha": "f5eda668fa1dfe868def8c11b8d7ffe169e0782d", "filename": "src/net/server/worker/RespawnWorker.java", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/worker/RespawnWorker.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/net/server/worker/RespawnWorker.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/worker/RespawnWorker.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1,7 +1,9 @@\n package net.server.worker;\n \n+import net.server.PlayerStorage;\n import net.server.Server;\n import net.server.channel.Channel;\n+import server.maps.MapleMapManager;\n \n /**\n  * @author Resinate\n@@ -11,8 +13,14 @@\n     @Override\n     public void run() {\n         for (Channel ch : Server.getInstance().getAllChannels()) {\n-            if (!ch.getPlayerStorage().getAllCharacters().isEmpty()) {\n-                ch.getMapFactory().updateMaps();\n+            PlayerStorage ps = ch.getPlayerStorage();\n+            if (ps != null) {\n+                if (!ps.getAllCharacters().isEmpty()) {\n+                    MapleMapManager mapManager = ch.getMapFactory();\n+                    if (mapManager != null) {\n+                        mapManager.updateMaps();\n+                    }\n+                }\n             }\n         }\n     }"}, {"sha": "1aea5383434143b123af1294924a9decc5110ef8", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -53,6 +53,7 @@\n import server.quest.MapleQuest;\n import tools.MaplePacketCreator;\n import client.MapleCharacter;\n+import client.MapleCharacter.DelayedQuestUpdate;\n import client.MapleClient;\n import client.MapleQuestStatus;\n import client.SkillFactory;\n@@ -468,12 +469,12 @@ public String getStringQuestProgress(int qid, int pid) {\n         \n         public void resetAllQuestProgress(int qid) {\n                 getPlayer().getQuest(MapleQuest.getInstance(qid)).resetAllProgress();\n-                getClient().announce(MaplePacketCreator.updateQuest(getPlayer().getQuest(MapleQuest.getInstance(qid)), false));\n+                getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, getPlayer().getQuest(MapleQuest.getInstance(qid)), false);\n         }\n         \n         public void resetQuestProgress(int qid, int pid) {\n                 getPlayer().getQuest(MapleQuest.getInstance(qid)).resetProgress(pid);\n-                getClient().announce(MaplePacketCreator.updateQuest(getPlayer().getQuest(MapleQuest.getInstance(qid)), false));\n+                getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, getPlayer().getQuest(MapleQuest.getInstance(qid)), false);\n         }\n         \n         public boolean forceStartQuest(int id) {"}, {"sha": "beacea5784430f64851d672e63648631571bbcfb", "filename": "src/scripting/AbstractScriptManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/AbstractScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/AbstractScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractScriptManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -70,7 +70,7 @@ protected NashornScriptEngine getScriptEngine(String path, MapleClient c) {\n         NashornScriptEngine engine = c.getScriptEngine(cachePath);\n \n         if (engine == null) {\n-            engine = getScriptEngine(cachePath);\n+            engine = getScriptEngine(path);\n             c.setScriptEngine(path, engine);\n         }\n "}, {"sha": "c2f89d3a5573580d6c777ea22a075a7c329780e5", "filename": "src/scripting/event/EventManager.java", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/event/EventManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/event/EventManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -347,6 +347,12 @@ private void setLockLobby(int lobbyId, boolean lock) {\n     private boolean startLobbyInstance(int lobbyId) {\n         lobbyLock.lock();\n         try {\n+            if (lobbyId < 0) {\n+                lobbyId = 0;\n+            } else if (lobbyId >= maxLobbys) {\n+                lobbyId = maxLobbys - 1;\n+            }\n+            \n             if(!openedLobbys.get(lobbyId)) {\n                 openedLobbys.set(lobbyId, true);\n                 return true;"}, {"sha": "b302cfe6948df45e2d232620468d1bb6db4956a5", "filename": "src/scripting/map/MapScriptMethods.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/map/MapScriptMethods.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/map/MapScriptMethods.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/map/MapScriptMethods.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -21,6 +21,7 @@\n  */\n package scripting.map;\n \n+import client.MapleCharacter.DelayedQuestUpdate;\n import client.MapleClient;\n import client.MapleQuestStatus;\n import scripting.AbstractPlayerInteraction;\n@@ -99,7 +100,7 @@ public void explorerQuest(short questid, String questName) {\n         }\n         String status = Integer.toString(q.getMedalProgress());\n         String infoex = quest.getInfoEx();\n-        getPlayer().announce(MaplePacketCreator.updateQuest(q, true));\n+        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, true);\n         StringBuilder smp = new StringBuilder();\n         StringBuilder etm = new StringBuilder();\n         if (status.equals(infoex)) {\n@@ -127,7 +128,7 @@ public void touchTheSky() { //29004\n             return;\n         }\n         String status = Integer.toString(q.getMedalProgress());\n-        getPlayer().announce(MaplePacketCreator.updateQuest(q, true));\n+        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, true);\n         getPlayer().announce(MaplePacketCreator.earnTitleMessage(status + \"/5 Completed\"));\n         getPlayer().announce(MaplePacketCreator.earnTitleMessage(\"The One Who's Touched the Sky title in progress.\"));\n         if (Integer.toString(q.getMedalProgress()).equals(quest.getInfoEx())) {"}, {"sha": "bee8cc60fc0916239f4a59280031a5d01481039e", "filename": "src/scripting/npc/NPCScriptManager.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/npc/NPCScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/npc/NPCScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/npc/NPCScriptManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -200,6 +200,8 @@ public void dispose(NPCConversationManager cm) {\n         } else {\n             resetContext(scriptFolder + \"/\" + cm.getNpc() + \".js\", c);\n         }\n+        \n+        c.getPlayer().flushDelayedUpdateQuests();\n     }\n \n     public void dispose(MapleClient c) {"}, {"sha": "97cbc75e6c4021799e9f9620b0dee05d89422b55", "filename": "src/scripting/quest/QuestScriptManager.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/quest/QuestScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/quest/QuestScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/quest/QuestScriptManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -163,6 +163,7 @@ public void dispose(QuestActionManager qm, MapleClient c) {\n \t\tscripts.remove(c);\n                 c.getPlayer().setNpcCooldown(System.currentTimeMillis());\n \t\tresetContext(\"quest/\" + qm.getQuest() + \".js\", c);\n+                c.getPlayer().flushDelayedUpdateQuests();\n \t}\n \n \tpublic void dispose(MapleClient c) {"}, {"sha": "cecac743610931dbda32ad3b54774278bf196258", "filename": "src/scripting/reactor/ReactorActionManager.java", "status": "modified", "additions": 60, "deletions": 30, "changes": 90, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/reactor/ReactorActionManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/scripting/reactor/ReactorActionManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/reactor/ReactorActionManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -30,6 +30,7 @@\n import constants.ServerConstants;\n import java.awt.Point;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n import java.util.concurrent.ScheduledFuture;\n import java.util.logging.Level;\n@@ -57,24 +58,70 @@\n  */\n public class ReactorActionManager extends AbstractPlayerInteraction {\n     private MapleReactor reactor;\n-    private MapleClient client;\n     private Invocable iv;\n     private ScheduledFuture<?> sprayTask = null;\n \n     public ReactorActionManager(MapleClient c, MapleReactor reactor, Invocable iv) {\n         super(c);\n         this.reactor = reactor;\n-        this.client = c;\n         this.iv = iv;\n     }\n \n     public void hitReactor() {\n-        reactor.hitReactor(client);\n+        reactor.hitReactor(c);\n     }\n     \n     public void destroyNpc(int npcId) {\n         reactor.getMap().destroyNPC(npcId);\n     }\n+    \n+    private static void sortDropEntries(List<ReactorDropEntry> from, List<ReactorDropEntry> item, List<ReactorDropEntry> visibleQuest, List<ReactorDropEntry> otherQuest, MapleCharacter chr) {\n+        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+        \n+        for(ReactorDropEntry mde : from) {\n+            if(!ii.isQuestItem(mde.itemId)) {\n+                item.add(mde);\n+            } else {\n+                if(chr.needQuestItem(mde.questid, mde.itemId)) {\n+                    visibleQuest.add(mde);\n+                } else {\n+                    otherQuest.add(mde);\n+                }\n+            }\n+        }\n+    }\n+    \n+    private static List<ReactorDropEntry> assembleReactorDropEntries(MapleCharacter chr, List<ReactorDropEntry> items) {\n+        final List<ReactorDropEntry> dropEntry = new ArrayList<>();\n+        final List<ReactorDropEntry> visibleQuestEntry = new ArrayList<>();\n+        final List<ReactorDropEntry> otherQuestEntry = new ArrayList<>();\n+        sortDropEntries(items, dropEntry, visibleQuestEntry, otherQuestEntry, chr);\n+        \n+        Collections.shuffle(dropEntry);\n+        Collections.shuffle(visibleQuestEntry);\n+        Collections.shuffle(otherQuestEntry);\n+        \n+        items.clear();\n+        items.addAll(dropEntry);\n+        items.addAll(visibleQuestEntry);\n+        items.addAll(otherQuestEntry);\n+        \n+        List<ReactorDropEntry> items1 = new ArrayList<>(items.size());\n+        List<ReactorDropEntry> items2 = new ArrayList<>(items.size() / 2);\n+        \n+        for (int i = 0; i < items.size(); i++) {\n+            if (i % 2 == 0) {\n+                items1.add(items.get(i));\n+            } else {\n+                items2.add(items.get(i));\n+            }\n+        }\n+        \n+        Collections.reverse(items1);\n+        items1.addAll(items2);\n+        \n+        return items1;\n+    }\n \n     public void sprayItems() {\n         sprayItems(false, 0, 0, 0, 0);\n@@ -109,10 +156,10 @@ public void dropItems(int posX, int posY, boolean meso, int mesoChance, int minM\n     }\n     \n     public void dropItems(boolean delayed, int posX, int posY, boolean meso, int mesoChance, final int minMeso, final int maxMeso, int minItems) {\n-        if(c.getPlayer() == null) return;\n-        \n-        List<ReactorDropEntry> items = generateDropList(getDropChances(), c.getPlayer().getDropRate(), meso, mesoChance, minItems);\n+        MapleCharacter chr = c.getPlayer();\n+        if(chr == null) return;\n         \n+        List<ReactorDropEntry> items = assembleReactorDropEntries(chr, generateDropList(getDropChances(), chr.getDropRate(), meso, mesoChance, minItems));\n         if(items.size() % 2 == 0) posX -= 12;\n         final Point dropPos = new Point(posX, posY);\n         \n@@ -127,8 +174,8 @@ public void dropItems(boolean delayed, int posX, int posY, boolean meso, int mes\n                 if (d.itemId == 0) {\n                     int range = maxMeso - minMeso;\n                     int displayDrop = (int) (Math.random() * range) + minMeso;\n-                    int mesoDrop = (displayDrop * client.getWorldServer().getMesoRate());\n-                    reactor.getMap().spawnMesoDrop(mesoDrop, reactor.getMap().calcDropPos(dropPos, reactor.getPosition()), reactor, client.getPlayer(), false, (byte) 2);\n+                    int mesoDrop = (displayDrop * c.getWorldServer().getMesoRate());\n+                    reactor.getMap().spawnMesoDrop(mesoDrop, reactor.getMap().calcDropPos(dropPos, reactor.getPosition()), reactor, c.getPlayer(), false, (byte) 2);\n                 } else {\n                     Item drop;\n                     \n@@ -142,10 +189,9 @@ public void dropItems(boolean delayed, int posX, int posY, boolean meso, int mes\n                 }\n             }\n         } else {\n-            final MapleCharacter chr = client.getPlayer();\n             final MapleReactor r = reactor;\n             final List<ReactorDropEntry> dropItems = items;\n-            final int worldMesoRate = client.getWorldServer().getMesoRate();\n+            final int worldMesoRate = c.getWorldServer().getMesoRate();\n             \n             dropPos.x -= (12 * items.size());\n             \n@@ -178,7 +224,7 @@ public void run() {\n                     \n                     dropPos.x += 25;\n                 }\n-            }, 100);\n+            }, 200);\n         }\n     }\n \n@@ -187,37 +233,21 @@ public void run() {\n     }\n     \n     private List<ReactorDropEntry> generateDropList(List<ReactorDropEntry> drops, int dropRate, boolean meso, int mesoChance, int minItems) {\n-        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        \n         List<ReactorDropEntry> items = new ArrayList<>();\n-        List<ReactorDropEntry> questItems = new ArrayList<>();\n-        int numItems = 0;\n-        \n         if (meso && Math.random() < (1 / (double) mesoChance)) {\n             items.add(new ReactorDropEntry(0, mesoChance, -1));\n         }\n         \n         for(ReactorDropEntry mde : drops) {\n             if (Math.random() < (dropRate / (double) mde.chance)) {\n-                if(!ii.isQuestItem(mde.itemId)) {\n-                    items.add(mde);\n-                } else {\n-                    questItems.add(mde);\n-                }\n-                \n-                numItems++;\n+                items.add(mde);\n             }\n         }\n         \n-        while (numItems < minItems) {\n+        while (items.size() < minItems) {\n             items.add(new ReactorDropEntry(0, mesoChance, -1));\n-            numItems++;\n         }\n         \n-        java.util.Collections.shuffle(items);\n-        java.util.Collections.shuffle(questItems);\n-        \n-        items.addAll(questItems);\n         return items;\n     }\n \n@@ -226,7 +256,7 @@ public void spawnMonster(int id) {\n     }\n \n     public void createMapMonitor(int mapId, String portal) {\n-        new MapMonitor(client.getChannelServer().getMapFactory().getMap(mapId), portal);\n+        new MapMonitor(c.getChannelServer().getMapFactory().getMap(mapId), portal);\n     }\n \n     public void spawnMonster(int id, int qty) {"}, {"sha": "acdd2ddc5f3619df3943bbb26662f1eba0e6e371", "filename": "src/server/CashShop.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/CashShop.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/CashShop.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/CashShop.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -157,7 +157,7 @@ public byte getInfo() {\n         private static final Map<Integer, CashItem> items = new HashMap<>();\n         private static final Map<Integer, List<Integer>> packages = new HashMap<>();\n         private static final List<SpecialCashItem> specialcashitems = new ArrayList<>();\n-        private static final List<Integer> randomitemids = new ArrayList<>();\n+        private static final List<Integer> randomitemsns = new ArrayList<>();\n \n         static {\n             MapleDataProvider etc = MapleDataProviderFactory.getDataProvider(new File(\"wz/Etc.wz\"));\n@@ -184,7 +184,7 @@ public byte getInfo() {\n             \n             for(Entry<Integer, CashItem> e : items.entrySet()) {\n                 if(e.getValue().isOnSale()) {\n-                    randomitemids.add(e.getKey());\n+                    randomitemsns.add(e.getKey());\n                 }\n             }\n             \n@@ -212,10 +212,10 @@ public byte getInfo() {\n         }\n \n         public static CashItem getRandomCashItem() {\n-            if(randomitemids.isEmpty()) return null;\n+            if(randomitemsns.isEmpty()) return null;\n             \n-            int rnd = (int)(Math.random() * randomitemids.size());\n-            return items.get(randomitemids.get(rnd));\n+            int rnd = (int)(Math.random() * randomitemsns.size());\n+            return items.get(randomitemsns.get(rnd));\n         }\n         \n         public static CashItem getItem(int sn) {"}, {"sha": "1b95a0250c25e7364e6032ff7a2e76f1646eeb15", "filename": "src/server/DueyPackage.java", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/DueyPackage.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/DueyPackage.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/DueyPackage.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -29,7 +29,7 @@\n     private String sender = null;\n     private Item item = null;\n     private int mesos = 0;\n-    private String message = \"\";\n+    private String message = null;\n     private Calendar timestamp;\n     private int packageId = 0;\n \n@@ -96,13 +96,15 @@ public boolean isDeliveringTime() {\n         }\n     }\n \n-    public void setSentTime(Timestamp ts) {\n+    public void setSentTime(Timestamp ts, boolean quick) {\n         Calendar cal = Calendar.getInstance();\n         cal.setTimeInMillis(ts.getTime());\n-        cal.set(Calendar.HOUR, 0);\n-        cal.set(Calendar.MINUTE, 0);\n-        cal.set(Calendar.SECOND, 0);\n-        cal.set(Calendar.MILLISECOND, 0);\n+        \n+        if (quick) {\n+            if (System.currentTimeMillis() - ts.getTime() < 24 * 60 * 60 * 1000) {  // thanks inhyuk for noticing quick delivery packages unavailable to retrieve from the get-go\n+                cal.add(Calendar.DATE, -1);\n+            }\n+        }\n         \n         this.timestamp = cal;\n     }"}, {"sha": "23ff66043b061bd097804bb6550aeec65a6e9863", "filename": "src/server/MaplePortal.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/MaplePortal.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/MaplePortal.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MaplePortal.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -25,6 +25,7 @@\n import client.MapleClient;\n \n public interface MaplePortal {\n+    public final int TELEPORT_PORTAL = 1;\n     public final int MAP_PORTAL = 2;\n     public final int DOOR_PORTAL = 6;\n     public static boolean OPEN = true;"}, {"sha": "a0c2dbac47aaf4aa99f06507116fcd3b5b53c356", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 6, "deletions": 21, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1288,6 +1288,7 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n             if (mount != null) {\n                 ridingMountId = mount.getItemId();\n             }\n+            \n             if (sourceid == Corsair.BATTLE_SHIP) {\n                 ridingMountId = 1932000;\n             } else if (sourceid == Beginner.SPACESHIP || sourceid == Noblesse.SPACESHIP) {\n@@ -1300,28 +1301,12 @@ private void applyBuffEffect(MapleCharacter applyfrom, MapleCharacter applyto, b\n                 ridingMountId = 1932005;\n             } else if (sourceid == Beginner.BALROG_MOUNT || sourceid == Noblesse.BALROG_MOUNT || sourceid == Legend.BALROG_MOUNT) {\n                 ridingMountId = 1932010;\n-            } else {\n-                if (applyto.getMount() == null) {\n-                    applyto.mount(ridingMountId, sourceid);\n-                }\n-\n-                applyto.getClient().getWorldServer().registerMountHunger(applyto);\n-            }\n-            if (sourceid == Corsair.BATTLE_SHIP) {\n-                givemount = new MapleMount(applyto, 1932000, sourceid);\n-            } else if (sourceid == Beginner.SPACESHIP || sourceid == Noblesse.SPACESHIP) {\n-                givemount = new MapleMount(applyto, 1932000 + applyto.getSkillLevel(sourceid), sourceid);\n-            } else if (sourceid == Beginner.YETI_MOUNT1 || sourceid == Noblesse.YETI_MOUNT1 || sourceid == Legend.YETI_MOUNT1) {\n-                givemount = new MapleMount(applyto, 1932003, sourceid);\n-            } else if (sourceid == Beginner.YETI_MOUNT2 || sourceid == Noblesse.YETI_MOUNT2 || sourceid == Legend.YETI_MOUNT2) {\n-                givemount = new MapleMount(applyto, 1932004, sourceid);\n-            } else if (sourceid == Beginner.WITCH_BROOMSTICK || sourceid == Noblesse.WITCH_BROOMSTICK || sourceid == Legend.WITCH_BROOMSTICK) {\n-                givemount = new MapleMount(applyto, 1932005, sourceid);\n-            } else if (sourceid == Beginner.BALROG_MOUNT || sourceid == Noblesse.BALROG_MOUNT || sourceid == Legend.BALROG_MOUNT) {\n-                givemount = new MapleMount(applyto, 1932010, sourceid);\n-            } else {\n-                givemount = applyto.getMount();\n             }\n+            \n+            // thanks inhyuk for noticing some skill mounts not acting properly for other players when changing maps\n+            givemount = applyto.mount(ridingMountId, sourceid);\n+            applyto.getClient().getWorldServer().registerMountHunger(applyto);\n+            \n             localDuration = sourceid;\n             localsourceid = ridingMountId;\n             localstatups = Collections.singletonList(new Pair<>(MapleBuffStat.MONSTER_RIDING, 0));"}, {"sha": "fac70f4ae33281e3f1a08354dcf22f1006d8c42d", "filename": "src/server/expeditions/MapleExpeditionBossLog.java", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/expeditions/MapleExpeditionBossLog.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/expeditions/MapleExpeditionBossLog.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpeditionBossLog.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -65,12 +65,9 @@ private BossLogEntry(int entries, int minChannel, int maxChannel, int timeLength\n         private static List<Pair<Timestamp, BossLogEntry>> getBossLogResetTimestamps(Calendar timeNow, boolean week) {\n             List<Pair<Timestamp, BossLogEntry>> resetTimestamps = new LinkedList<>();\n             \n+            Timestamp ts = new Timestamp(timeNow.getTime().getTime());  // reset all table entries actually, thanks Conrad\n             for (BossLogEntry b : BossLogEntry.values()) {\n                 if (b.week == week) {\n-                    Calendar c = (Calendar) timeNow.clone();\n-                    c.roll(Calendar.DAY_OF_MONTH, -1 * (week ? 7 : 1) * b.timeLength);\n-                    Timestamp ts = new Timestamp(c.getTime().getTime());\n-                    \n                     resetTimestamps.add(new Pair<>(ts, b));\n                 }\n             }"}, {"sha": "c65000697d3b77e723cb4367d20193365dc9cb94", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -97,7 +97,7 @@\n     private Set<Integer> usedAttacks = new HashSet<>();\n     private Set<Integer> calledMobOids = null;\n     private WeakReference<MapleMonster> callerMob = new WeakReference<>(null);\n-    private List<Integer> stolenItems = new ArrayList<>();\n+    private List<Integer> stolenItems = new ArrayList<>(5);\n     private int team;\n     private int parentMobOid = 0;\n     private final HashMap<Integer, AtomicLong> takenDamage = new HashMap<>();"}, {"sha": "f5c439433163e32e07bd9a99355f8663be5137a1", "filename": "src/server/life/MapleMonsterInformationProvider.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/life/MapleMonsterInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/life/MapleMonsterInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterInformationProvider.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -152,7 +152,7 @@ private void retrieveGlobal() {\n \n                     int rnd = Randomizer.rand(mde.Minimum, mde.Maximum);\n                     for (int i = 0; i < rnd - 1; i++) {\n-                        extra.add(mde);   // this passes copies of the equips' MDE with min/max quantity > 1, but idc it'll be unused anyways\n+                        extra.add(mde);   // this passes copies of the equips' MDE with min/max quantity > 1, but idc on equips they are unused anyways\n                     }\n                 }\n             }"}, {"sha": "e7503d2275addbe32c0a3483a1ce9f1eb19412ec", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 72, "deletions": 59, "changes": 131, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -137,6 +137,7 @@\n     private int timeLimit;\n     private long mapTimer;\n     private int decHP = 0;\n+    private float recovery = 1.0f;\n     private int protectItem = 0;\n     private boolean town;\n     private MapleOxQuiz ox;\n@@ -1408,81 +1409,85 @@ public void killMonster(final MapleMonster monster, final MapleCharacter chr, fi\n             }\n         } else {\n             if (removeKilledMonsterObject(monster)) {\n-                if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n-                    AutobanFactory.GENERAL.alert(chr, \" for killing a \" + monster.getName() + \" which is over 30 levels higher.\");\n-                }\n-                \n-                /*if (chr.getQuest(MapleQuest.getInstance(29400)).getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-                 if (chr.getLevel() >= 120 && monster.getStats().getLevel() >= 120) {\n-                 //FIX MEDAL SHET\n-                 } else if (monster.getStats().getLevel() >= chr.getLevel()) {\n-                 }\n-                 }*/\n-                \n-                if (monster.getCP() > 0 && chr.getMap().isCPQMap()) {\n-                    chr.gainCP(monster.getCP());\n-                }\n-                \n-                int buff = monster.getBuffToGive();\n-                if (buff > -1) {\n-                    MapleItemInformationProvider mii = MapleItemInformationProvider.getInstance();\n-                    for (MapleMapObject mmo : this.getPlayers()) {\n-                        MapleCharacter character = (MapleCharacter) mmo;\n-                        if (character.isAlive()) {\n-                            MapleStatEffect statEffect = mii.getItemEffect(buff);\n-                            character.getClient().announce(MaplePacketCreator.showOwnBuffEffect(buff, 1));\n-                            broadcastMessage(character, MaplePacketCreator.showBuffeffect(character.getId(), buff, 1), false);\n-                            statEffect.applyTo(character);\n-                        }\n+                try {\n+                    if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n+                        AutobanFactory.GENERAL.alert(chr, \" for killing a \" + monster.getName() + \" which is over 30 levels higher.\");\n                     }\n-                }\n-                \n-                if (monster.getId() >= 8800003 && monster.getId() <= 8800010) {\n-                    boolean makeZakReal = true;\n-                    Collection<MapleMapObject> objects = getMapObjects();\n-                    for (MapleMapObject object : objects) {\n-                        MapleMonster mons = getMonsterByOid(object.getObjectId());\n-                        if (mons != null) {\n-                            if (mons.getId() >= 8800003 && mons.getId() <= 8800010) {\n-                                makeZakReal = false;\n-                                break;\n+\n+                    /*if (chr.getQuest(MapleQuest.getInstance(29400)).getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                     if (chr.getLevel() >= 120 && monster.getStats().getLevel() >= 120) {\n+                     //FIX MEDAL SHET\n+                     } else if (monster.getStats().getLevel() >= chr.getLevel()) {\n+                     }\n+                     }*/\n+\n+                    if (monster.getCP() > 0 && chr.getMap().isCPQMap()) {\n+                        chr.gainCP(monster.getCP());\n+                    }\n+\n+                    int buff = monster.getBuffToGive();\n+                    if (buff > -1) {\n+                        MapleItemInformationProvider mii = MapleItemInformationProvider.getInstance();\n+                        for (MapleMapObject mmo : this.getPlayers()) {\n+                            MapleCharacter character = (MapleCharacter) mmo;\n+                            if (character.isAlive()) {\n+                                MapleStatEffect statEffect = mii.getItemEffect(buff);\n+                                character.getClient().announce(MaplePacketCreator.showOwnBuffEffect(buff, 1));\n+                                broadcastMessage(character, MaplePacketCreator.showBuffeffect(character.getId(), buff, 1), false);\n+                                statEffect.applyTo(character);\n                             }\n                         }\n                     }\n-                    if (makeZakReal) {\n-                        MapleMap map = chr.getMap();\n \n+                    if (monster.getId() >= 8800003 && monster.getId() <= 8800010) {\n+                        boolean makeZakReal = true;\n+                        Collection<MapleMapObject> objects = getMapObjects();\n                         for (MapleMapObject object : objects) {\n-                            MapleMonster mons = map.getMonsterByOid(object.getObjectId());\n+                            MapleMonster mons = getMonsterByOid(object.getObjectId());\n                             if (mons != null) {\n-                                if (mons.getId() == 8800000) {\n-                                    makeMonsterReal(mons);\n-                                    mons.aggroUpdateController();\n+                                if (mons.getId() >= 8800003 && mons.getId() <= 8800010) {\n+                                    makeZakReal = false;\n                                     break;\n                                 }\n                             }\n                         }\n+                        if (makeZakReal) {\n+                            MapleMap map = chr.getMap();\n+\n+                            for (MapleMapObject object : objects) {\n+                                MapleMonster mons = map.getMonsterByOid(object.getObjectId());\n+                                if (mons != null) {\n+                                    if (mons.getId() == 8800000) {\n+                                        makeMonsterReal(mons);\n+                                        mons.aggroUpdateController();\n+                                        break;\n+                                    }\n+                                }\n+                            }\n+                        }\n                     }\n-                }\n \n-                MapleCharacter dropOwner = monster.killBy(chr);\n-                if (withDrops && !monster.dropsDisabled()) {\n-                    if (dropOwner == null) {\n-                        dropOwner = chr;\n+                    MapleCharacter dropOwner = monster.killBy(chr);\n+                    if (withDrops && !monster.dropsDisabled()) {\n+                        if (dropOwner == null) {\n+                            dropOwner = chr;\n+                        }\n+                        dropFromMonster(dropOwner, monster, false);\n                     }\n-                    dropFromMonster(dropOwner, monster, false);\n-                }\n \n-                if (monster.hasBossHPBar()) {\n-                    for(MapleCharacter mc : this.getAllPlayers()) {\n-                        if(mc.getTargetHpBarHash() == monster.hashCode()) {\n-                            mc.resetPlayerAggro();\n+                    if (monster.hasBossHPBar()) {\n+                        for(MapleCharacter mc : this.getAllPlayers()) {\n+                            if(mc.getTargetHpBarHash() == monster.hashCode()) {\n+                                mc.resetPlayerAggro();\n+                            }\n                         }\n                     }\n+                } catch (Exception e) {\n+                    e.printStackTrace();\n+                } finally {     // thanks resinate for pointing out a memory leak possibly from an exception thrown\n+                    monster.dispatchMonsterKilled(true);\n+                    broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n                 }\n-\n-                monster.dispatchMonsterKilled(true);\n-                broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n             }\n         }\n     }\n@@ -2707,12 +2712,12 @@ public MaplePortal getRandomPlayerSpawnpoint() {\n         return portal != null ? portal : getPortal(0);\n     }\n     \n-    public MaplePortal findClosestWarpPortal(Point from) {\n+    public MaplePortal findClosestTeleportPortal(Point from) {\n         MaplePortal closest = null;\n         double shortestDistance = Double.POSITIVE_INFINITY;\n         for (MaplePortal portal : portals.values()) {\n             double distance = portal.getPosition().distanceSq(from);\n-            if (portal.getType() == MaplePortal.MAP_PORTAL && distance < shortestDistance && portal.getTargetMapId() == 999999999) {\n+            if (portal.getType() == MaplePortal.TELEPORT_PORTAL && distance < shortestDistance && portal.getTargetMapId() != 999999999) {\n                 closest = portal;\n                 shortestDistance = distance;\n             }\n@@ -3777,6 +3782,14 @@ public int getHPDecProtect() {\n     public void setHPDecProtect(int delta) {\n         this.protectItem = delta;\n     }\n+    \n+    public float getRecovery() {\n+        return recovery;\n+    }\n+\n+    public void setRecovery(float recRate) {\n+        recovery = recRate;\n+    }\n \n     private int hasBoat() {\n         return !boat ? 0 : (docked ? 1 : 2);"}, {"sha": "0c37f54d6ef405ee603c42d6aa267b6a016e1b51", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -31,7 +31,6 @@\n import java.util.HashMap;\n import java.util.LinkedList;\n import java.util.List;\n-import java.util.Map;\n import provider.MapleData;\n import provider.MapleDataProvider;\n import provider.MapleDataProviderFactory;\n@@ -49,8 +48,6 @@\n \n public class MapleMapFactory {\n \n-    private static Map<Integer, Float> mapRecoveryRateCache = new HashMap<>();\n-    \n     private static MapleData nameData;\n     private static MapleDataProvider mapSource;\n     \n@@ -336,11 +333,10 @@ public static MapleMap loadMapFromWz(int mapid, int world, int channel, EventIns\n         map.setTimeLimit(MapleDataTool.getIntConvert(\"timeLimit\", infoData, -1));\n         map.setFieldType(MapleDataTool.getIntConvert(\"fieldType\", infoData, 0));\n         map.setMobCapacity(MapleDataTool.getIntConvert(\"fixedMobCapacity\", infoData, 500));//Is there a map that contains more than 500 mobs?\n-\n+        \n         MapleData recData = infoData.getChildByPath(\"recovery\");\n         if (recData != null) {\n-            float recoveryRate = MapleDataTool.getFloat(recData);\n-            mapRecoveryRateCache.put(mapid, recoveryRate);\n+            map.setRecovery(MapleDataTool.getFloat(recData));\n         }\n \n         HashMap<Integer, Integer> backTypes = new HashMap<>();\n@@ -438,9 +434,5 @@ private static String getMapStringName(int mapid) {\n         builder.append(\"/\").append(mapid);\n         return builder.toString();\n     }\n-\n-    public static float getMapRecoveryRate(int mapid) {\n-        Float recRate = mapRecoveryRateCache.get(mapid);\n-        return recRate != null ? recRate : 1.0f;\n-    }\n+    \n }"}, {"sha": "db3df6d49ace1738f64b5a0d03814e83f9922d51", "filename": "src/server/maps/MapleMapManager.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMapManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/maps/MapleMapManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapManager.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -139,7 +139,4 @@ public void dispose() {\n         this.event = null;\n     }\n \n-    public static float getMapRecoveryRate(int mapid) {\n-        return MapleMapFactory.getMapRecoveryRate(mapid);\n-    }\n }"}, {"sha": "cf7e8f94f272281bca4d952d055670d1248ca9bd", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -28,6 +28,7 @@\n import java.util.List;\n import java.util.Map;\n import client.MapleCharacter;\n+import client.MapleCharacter.DelayedQuestUpdate;\n import client.MapleQuestStatus;\n import client.MapleQuestStatus.Status;\n import constants.ServerConstants;\n@@ -337,7 +338,7 @@ public boolean forceStart(MapleCharacter c, int npc) {\n                 if(pid >= 8200000 && pid <= 8200012) {\n                     String pr = StringUtil.getLeftPaddedStr(Integer.toString(setProg), '0', 3);\n                     newStatus.setProgress(pid, pr);\n-                    c.announce(MaplePacketCreator.updateQuest(newStatus, false));\n+                    c.announceUpdateQuest(DelayedQuestUpdate.UPDATE, newStatus, false);\n                 }\n             }\n         }"}, {"sha": "a4e2d0a21ee48f37782d400fd4f1ef573c597d51", "filename": "src/server/quest/actions/ItemAction.java", "status": "modified", "additions": 29, "deletions": 6, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/quest/actions/ItemAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/server/quest/actions/ItemAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/ItemAction.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -109,6 +109,7 @@ public void run(MapleCharacter chr, Integer extSelection) {\n \t\t\tif (!canGetItem(iEntry, chr)) {\n \t\t\t\tcontinue;\n \t\t\t}\n+                        \n \t\t\tif(iEntry.getProp() != null) {\n \t\t\t\tif(iEntry.getProp() == -1) {\n \t\t\t\t\tif(extSelection != extNum++)\n@@ -181,11 +182,11 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n                                 }\n \t\t\t\t\n \t\t\t} else {\n-                                if(item.getCount() > 0) {\n-                                        // Make sure they can hold the item.\n-                                        Item toItem = new Item(item.getId(), (short) 0, (short) item.getCount());\n-                                        gainList.add(new Pair<>(toItem, type));\n-                                } else {\n+                                // Make sure they can hold the item.\n+                                Item toItem = new Item(item.getId(), (short) 0, (short) item.getCount());\n+                                gainList.add(new Pair<>(toItem, type));\n+                            \n+                                if(item.getCount() < 0) {\n                                         // Make sure they actually have the item.\n                                         int quantity = item.getCount() * -1;\n                                         \n@@ -229,12 +230,34 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n                         gainList.add(selected);\n                 }\n                 \n-\t\tif (!MapleInventory.checkSpots(chr, gainList, allSlotUsed, false)) {\n+                if (!canHold(chr, gainList)) {\n \t\t\tchr.dropMessage(1, \"Please check if you have enough space in your inventory.\");\n \t\t\treturn false;\n \t\t}\n \t\treturn true;\n \t}\n+        \n+        private boolean canHold(MapleCharacter chr, List<Pair<Item, MapleInventoryType>> gainList) {\n+                List<Integer> toAddItemids = new LinkedList<>();\n+                List<Integer> toAddQuantity = new LinkedList<>();\n+                List<Integer> toRemoveItemids = new LinkedList<>();\n+                List<Integer> toRemoveQuantity = new LinkedList<>();\n+                \n+                for (Pair<Item, MapleInventoryType> item : gainList) {\n+                        Item it = item.getLeft();\n+\n+                        if (it.getQuantity() > 0) {\n+                                toAddItemids.add(it.getItemId());\n+                                toAddQuantity.add((int) it.getQuantity());\n+                        } else {\n+                                toRemoveItemids.add(it.getItemId());\n+                                toRemoveQuantity.add(-1 * ((int) it.getQuantity()));\n+                        }\n+                }\n+                \n+                // thanks onechord for noticing quests unnecessarily giving out \"full inventory\" from quests that also takes items from players\n+                return chr.getClient().getAbstractPlayerInteraction().canHoldAllAfterRemoving(toAddItemids, toAddQuantity, toRemoveItemids, toRemoveQuantity);\n+        }\n \t\n \tprivate boolean canGetItem(ItemData item, MapleCharacter chr) {\n \t\tif (item.getGender() != 2 && item.getGender() != chr.getGender()) {"}, {"sha": "6006443afac0607adc1154463cbdaf5822932a7f", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 15, "deletions": 20, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -1916,17 +1916,12 @@ private static void writeForeignBuffs(MaplePacketLittleEndianWriter mplew, Maple\n                 \n                 Integer bv = chr.getBuffedValue(MapleBuffStat.MONSTER_RIDING);\n                 if (bv != null) {\n-                        if(bv.equals(Corsair.BATTLE_SHIP)) {\n-                                mplew.writeInt(1932000);\n-                                mplew.writeInt(Corsair.BATTLE_SHIP);\n+                        MapleMount mount = chr.getMount();\n+                        if (mount != null) {\n+                                mplew.writeInt(mount.getItemId());\n+                                mplew.writeInt(mount.getSkillId());\n                         } else {\n-                                final Item mount = chr.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -18);\n-                                if(mount != null) {\n-                                        mplew.writeInt(mount.getItemId());\n-                                        mplew.writeInt(1004);\n-                                } else {\n-                                        mplew.writeLong(0);\n-                                }\n+                                mplew.writeLong(0);\n                         }\n                 } else {\n                         mplew.writeLong(0);\n@@ -6975,14 +6970,14 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n         public static byte[] onCashItemGachaponOpenFailed(){\n \t\tMaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n \t\tmplew.writeShort(SendOpcode.CASHSHOP_CASH_ITEM_GACHAPON_RESULT.getValue());\n-\t\tmplew.write(189);\n+\t\tmplew.write(0xE4);\n \t\treturn mplew.getPacket();\n \t}\n \n \tpublic static byte[] onCashGachaponOpenSuccess(int accountid, long sn, int remainingBoxes, Item item, int itemid, int nSelectedItemCount, boolean bJackpot){\n \t\tMaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n \t\tmplew.writeShort(SendOpcode.CASHSHOP_CASH_ITEM_GACHAPON_RESULT.getValue());\n-\t\tmplew.write(190);\n+\t\tmplew.write(0xE5);   // subopcode thanks to Ubaware\n \t\tmplew.writeLong(sn);// sn of the box used\n \t\tmplew.writeInt(remainingBoxes);\n \t\taddCashItemInformation(mplew, item, accountid);\n@@ -7253,15 +7248,15 @@ private static void getGuildInfo(final MaplePacketLittleEndianWriter mplew, Mapl\n                                 mplew.writeLong(getTime(dp.sentTimeInMilliseconds()));\n                                 \n                                 String msg = dp.getMessage();\n-                                if (!msg.isEmpty()) {\n-                                    mplew.writeInt(1);\n-                                    mplew.writeAsciiString(msg);\n-                                    for (int i = msg.length(); i < 200; i++) {\n-                                            mplew.write(0);\n-                                    }\n+                                if (msg != null) {\n+                                        mplew.writeInt(1);\n+                                        mplew.writeAsciiString(msg);\n+                                        for (int i = msg.length(); i < 200; i++) {\n+                                                mplew.write(0);\n+                                        }\n                                 } else {\n-                                    mplew.writeInt(0);\n-                                    mplew.skip(200);\n+                                        mplew.writeInt(0);\n+                                        mplew.skip(200);\n                                 }\n                                 \n                                 mplew.write(0);"}, {"sha": "4fd6a87372d9c2721635ba5b9681bddf929f1714", "filename": "tools/ScriptStaticMethodTracker/method_list.c", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_list.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_list.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/method_list.c?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,85 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+JavaMethod* createJavaMethod(const char *name) {\n+    JavaMethod* method = (JavaMethod *)malloc(sizeof(JavaMethod));\n+    method->name = (char *)malloc((strlen(name) + 1) * sizeof(char));\n+    strcpy(method->name, name);\n+    return method;\n+}\n+\n+void freeJavaMethod(JavaMethod *method) {\n+    free(method->name);\n+    free(method);\n+}\n+\n+JavaMethodList createJavaMethodList() {\n+    JavaMethodList list;\n+    list.size = 0;\n+\n+    JavaMethodListItem *item = (JavaMethodListItem *)malloc(sizeof(JavaMethodListItem));\n+    item->prox = NULL;\n+\n+    list.last = item;\n+    list.first = list.last;\n+\n+    return list;\n+}\n+\n+void insertJavaMethod(JavaMethodList *list, JavaMethod *method) {\n+    JavaMethodListItem *item = (JavaMethodListItem *)malloc(sizeof(JavaMethodListItem));\n+    item->prox = NULL;\n+\n+    list->last->method = method;\n+    list->last->prox = item;\n+\n+    list->last = item;\n+    list->size++;\n+}\n+\n+void freeJavaMethodList(JavaMethodList *list) {\n+    JavaMethodListItem *aux = list->first;\n+\n+    list->first = list->last;\n+    list->size = 0;\n+\n+    while (aux->prox != NULL) {\n+        JavaMethodListItem *aux2 = aux;\n+        aux = aux->prox;\n+\n+        freeJavaMethod(aux2->method);\n+        free(aux2);\n+    }\n+    free(aux);\n+}\n+\n+void resetJavaMethodCursor(JavaMethodList *list) {\n+    list->cursor = list->first;\n+}\n+\n+JavaMethod* readJavaMethod(JavaMethodList *list) {\n+    JavaMethodListItem *aux = list->cursor;\n+    if (aux->prox == NULL) {\n+        return NULL;\n+    }\n+\n+    list->cursor = aux->prox;\n+    return aux->method;\n+}"}, {"sha": "ae4fabed1de9b71c0d3937b2cd77992578562a7a", "filename": "tools/ScriptStaticMethodTracker/method_list.h", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_list.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_list.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/method_list.h?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,43 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#ifndef METHOD_LIST_H_\n+#define METHOD_LIST_H_\n+\n+typedef struct {\n+    char *name;\n+} JavaMethod;\n+\n+typedef struct JavaMethodListItem {\n+    JavaMethod *method;\n+    struct JavaMethodListItem *prox;\n+} JavaMethodListItem;\n+\n+typedef struct {\n+    JavaMethodListItem *first;\n+    JavaMethodListItem *last;\n+    JavaMethodListItem *cursor;\n+\n+    int size;\n+} JavaMethodList;\n+\n+#include \"method_list.c\"\n+\n+#endif /* METHOD_LIST_H_ */"}, {"sha": "63af248dec08a97eba8abd980d99e859b2f03b0c", "filename": "tools/ScriptStaticMethodTracker/method_tracker.c", "status": "added", "additions": 347, "deletions": 0, "changes": 347, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_tracker.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/method_tracker.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/method_tracker.c?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,347 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#include <stdlib.h>\n+#include <stdio.h>\n+#include <string.h>\n+#include <stdbool.h>\n+#include <pcre.h>\n+\n+#define SCRIPT_FILES_MAX_CONTENT_SIZE 1777777\n+\n+#include \"method_list.h\"\n+#include \"script_path.h\"\n+\n+JavaMethodList getBestSubstringsFromStringList(char *aStrRegex, JavaMethodList *lines, int lines_size) {\n+    JavaMethodList ret = createJavaMethodList();\n+\n+    // ------------ an adaptation from Mitch Richling's https://www.mitchr.me/SS/exampleCode/AUPG/pcre_example.c.html -----------\n+\n+    int subStrVec[30];\n+    int subStrVecLength = 30;\n+    const char *pcreErrorStr;\n+    int pcreErrorOffset;\n+\n+    pcre *reCompiled = pcre_compile(aStrRegex, 0, &pcreErrorStr, &pcreErrorOffset, NULL);\n+    if(reCompiled == NULL) {\n+        printf(\"ERROR: Could not compile '%s': %s\\n\", aStrRegex, pcreErrorStr);\n+        return ret;\n+    }\n+\n+    pcre_extra *pcreExtra = pcre_study(reCompiled, 0, &pcreErrorStr);\n+    if(pcreErrorStr != NULL) {\n+        printf(\"ERROR: Could not study '%s': %s\\n\", aStrRegex, pcreErrorStr);\n+        return ret;\n+    }\n+\n+    int i;\n+    for (i = 0; i < lines_size; i++) {\n+        JavaMethodList list = lines[i];\n+\n+        resetJavaMethodCursor(&list);\n+        while(true) {\n+            JavaMethod *method = readJavaMethod(&list);\n+            if (method == NULL) {\n+                break;\n+            }\n+\n+            char *str = method->name;\n+            int pcreExecRet = pcre_exec(reCompiled, pcreExtra, str, strlen(str), 0, 0, subStrVec, subStrVecLength);\n+            if(pcreExecRet < 0) {\n+                switch(pcreExecRet) {\n+                    //case PCRE_ERROR_NOMATCH      : printf(\"String did not match the pattern\\n\");        break;\n+                    case PCRE_ERROR_NULL         : printf(\"Something was null\\n\");                      break;\n+                    case PCRE_ERROR_BADOPTION    : printf(\"A bad option was passed\\n\");                 break;\n+                    case PCRE_ERROR_BADMAGIC     : printf(\"Magic number bad (compiled re corrupt?)\\n\"); break;\n+                    case PCRE_ERROR_UNKNOWN_NODE : printf(\"Something kooky in the compiled re\\n\");      break;\n+                    case PCRE_ERROR_NOMEMORY     : printf(\"Ran out of memory\\n\");                       break;\n+                    //default                      : printf(\"Unknown error\\n\");                           break;\n+                }\n+            } else {\n+                if(pcreExecRet == 0) {\n+                    printf(\"But too many substrings were found to fit in subStrVec!\\n\");\n+                    // Set rc to the max number of substring matches possible.\n+                    pcreExecRet = 30 / 3;\n+                }\n+\n+                const char *psubStrMatchStr;\n+                pcre_get_substring(str, subStrVec, pcreExecRet, 0, &(psubStrMatchStr));\n+\n+                insertJavaMethod(&ret, createJavaMethod(psubStrMatchStr));\n+                pcre_free_substring(psubStrMatchStr);\n+            }\n+        }\n+    }\n+\n+    pcre_free(reCompiled);\n+\n+    if(pcreExtra != NULL) {\n+        pcre_free(pcreExtra);\n+    }\n+\n+    return ret;\n+}\n+\n+char* extractStaticMethodName(const char *method_line) {\n+    char *aStrRegex = \"([A-Za-z0-9])+(\\\\s)*\\\\(\";\n+\n+    int lines_size = 1;\n+    JavaMethodList *lines = (JavaMethodList *)malloc(lines_size * sizeof(JavaMethodList));\n+\n+    int i;\n+    for (i = 0; i < lines_size; i++) {\n+        lines[i] = createJavaMethodList();\n+        insertJavaMethod(&(lines[i]), createJavaMethod(method_line));\n+    }\n+\n+    JavaMethodList subs = getBestSubstringsFromStringList(aStrRegex, lines, lines_size);\n+\n+    char *ret;\n+    if (subs.size > 0) {\n+        resetJavaMethodCursor(&subs);\n+        JavaMethod *method = readJavaMethod(&subs);\n+\n+        char *method_scoop = method->name;\n+        int i;\n+        for (i = 0; i < strlen(method_scoop) - 1; i++) {\n+            char ch = method_scoop[i];\n+            if (ch == '(' || ch == ' ' || ch == '\\t') {\n+                break;\n+            }\n+        }\n+        method->name[i] = 0;\n+\n+        ret = (char *)malloc((strlen(method->name) + 1) * sizeof(char));\n+        strcpy(ret, method->name);\n+    } else {\n+        ret = NULL;\n+    }\n+\n+    freeJavaMethodList(&subs);\n+\n+    for (i = 0; i < lines_size; i++) {\n+        freeJavaMethodList(&(lines[i]));\n+    }\n+\n+    free(lines);\n+\n+    return ret;\n+}\n+\n+JavaMethodList getStaticJavaMethodNames(char *aStrRegex, JavaMethodList *lines, int lines_size) {\n+    JavaMethodList subs = getBestSubstringsFromStringList(aStrRegex, lines, lines_size);\n+    JavaMethodList ret = createJavaMethodList();\n+\n+    resetJavaMethodCursor(&subs);\n+    while (true) {\n+        JavaMethod *method = readJavaMethod(&subs);\n+        if (method == NULL) {\n+            break;\n+        }\n+\n+        char *method_name = extractStaticMethodName(method->name);\n+        if (method_name != NULL) {\n+            insertJavaMethod(&ret, createJavaMethod(method_name));\n+            free(method_name);\n+        }\n+    }\n+\n+    freeJavaMethodList(&subs);\n+\n+    return ret;\n+}\n+\n+bool isIgnoreMethod(char *method_name) {\n+    const char * ignoreMethods[] = {\"getInstance\", \"toString\", NULL};\n+\n+    int i = 0;\n+    while(true) {\n+        const char *ign = ignoreMethods[i];\n+        if (ign == NULL) {\n+            break;\n+        }\n+\n+        if (!strcmp(method_name, ign)) {\n+            return true;\n+        }\n+\n+        i++;\n+    }\n+\n+    return false;\n+}\n+\n+JavaMethodList trackerFindSourceStaticMethods(JavaMethodList *lines, int lines_size) {\n+    char *aStrRegex = \"(public static\\\\s).*([A-Za-z0-9])+(\\\\s)*\\\\(.*\\\\{\";\n+    JavaMethodList ret = createJavaMethodList();\n+\n+    JavaMethodList list = getStaticJavaMethodNames(aStrRegex, lines, lines_size);\n+    resetJavaMethodCursor(&list);\n+    while(true) {\n+        JavaMethod *method = readJavaMethod(&list);\n+        if (method == NULL) {\n+            break;\n+        }\n+\n+        if (isIgnoreMethod(method->name)) {\n+            continue;\n+        }\n+\n+        //printf(\"Java Method: %s\\n\", method->name);\n+        insertJavaMethod(&ret, createJavaMethod(method->name));\n+    }\n+\n+    freeJavaMethodList(&list);\n+\n+    return ret;\n+}\n+\n+char *getContentFromFile(FILE *f) {\n+    char str[10240];\n+\n+    char *content = (char *)malloc(SCRIPT_FILES_MAX_CONTENT_SIZE * sizeof(char));\n+    content[0] = 0;\n+\n+    while (!feof(f)) {\n+        fgets(str, 10240, f);\n+        strcat(content, str);\n+    }\n+\n+    return content;\n+}\n+\n+bool locateMethodCall(const char *method_name, char *file_path) {\n+    FILE *f = fopen(file_path, \"r+t\");\n+\n+    char aStrRegex[1000];\n+    strcpy(aStrRegex, method_name);\n+    strcat(aStrRegex, \"(\\\\s)*\\\\(\");\n+\n+    JavaMethodList *file_content = (JavaMethodList *)malloc(sizeof(JavaMethodList));\n+    file_content[0] = createJavaMethodList();\n+\n+    char *content = getContentFromFile(f);\n+\n+    JavaMethod *method = createJavaMethod(content);\n+    insertJavaMethod(&(file_content[0]), method);\n+    free(content);\n+\n+    JavaMethodList list = getBestSubstringsFromStringList(aStrRegex, file_content, 1);\n+    bool found = (list.size > 0);\n+\n+    free(file_content);\n+    fclose(f);\n+\n+    return found;\n+}\n+\n+void locateMethodCalls(const char *method_name, char **file_paths, int file_paths_size) {\n+    int i;\n+    for (i = 0; i < file_paths_size; i++) {\n+        char *path = file_paths[i];\n+        if (locateMethodCall(method_name, path)) {\n+            printf(\"  %s : \\'%s\\'\\n\", path, method_name);\n+        }\n+    }\n+}\n+\n+int trackerLocateScriptsStaticCalls(JavaMethodList method_names) {\n+    ScriptFiles *files = createScriptFiles(\"../../HeavenMS/scripts\");\n+    if (files == NULL) {\n+        printf(\"ERROR: Could not initialize script files.\\n\");\n+        return -1;\n+    }\n+\n+    resetJavaMethodCursor(&method_names);\n+    while (true) {\n+        JavaMethod *method = readJavaMethod(&method_names);\n+        if (method == NULL) {\n+            break;\n+        }\n+\n+        locateMethodCalls(method->name, files->file_paths, files->file_paths_size);\n+    }\n+\n+    freeScriptFiles(files);\n+    return 0;\n+}\n+\n+typedef struct {\n+    JavaMethodList *file_content;\n+    int size;\n+} SourceFilesContent;\n+\n+SourceFilesContent* readSourceFileContents() {\n+    ScriptFiles *srcFilePaths = createScriptFiles(\"../../HeavenMS/src\");\n+\n+    SourceFilesContent *files = (SourceFilesContent *)malloc(sizeof(SourceFilesContent));\n+    files->file_content = (JavaMethodList *)malloc(srcFilePaths->file_paths_size * sizeof(JavaMethodList));\n+    files->size = srcFilePaths->file_paths_size;\n+\n+    //int max_len = 0;\n+    int i;\n+    for (i = 0; i < srcFilePaths->file_paths_size; i++) {\n+        files->file_content[i] = createJavaMethodList();\n+\n+        FILE *f = fopen(srcFilePaths->file_paths[i], \"r+t\");\n+        char *content = getContentFromFile(f);\n+\n+        //int this_len = strlen(content);\n+        //if (max_len < this_len) max_len = this_len;\n+\n+        fclose(f);\n+\n+        insertJavaMethod(&(files->file_content[i]), createJavaMethod(content));\n+    }\n+\n+    //printf(\"len: %d\\n\", max_len);\n+    freeScriptFiles(srcFilePaths);\n+\n+    return files;\n+}\n+\n+void freeSourceFileContents(SourceFilesContent *files) {\n+    int i;\n+    for (i = 0; i < files->size; i++) {\n+        freeJavaMethodList(&(files->file_content[i]));\n+    }\n+\n+    free(files->file_content);\n+    free(files);\n+}\n+\n+int main() {\n+    printf(\"Loading source files...\\n\");\n+    SourceFilesContent *src_contents = readSourceFileContents();\n+\n+    int lines_size = src_contents->size;\n+    JavaMethodList *lines = src_contents->file_content;\n+\n+    printf(\"Tracking static methods on source...\\n\");\n+    JavaMethodList method_names = trackerFindSourceStaticMethods(lines, lines_size);\n+    printf(\"Finding static methods calls on scripts...\\n\");\n+    trackerLocateScriptsStaticCalls(method_names);\n+    printf(\"Track complete!\\n\");\n+\n+    freeSourceFileContents(src_contents);\n+    freeJavaMethodList(&method_names);\n+\n+    return 0;\n+}"}, {"sha": "b5fd2a63785922c9898e7d25d9c50ef47524ba13", "filename": "tools/ScriptStaticMethodTracker/pcre3.dll", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/pcre3.dll", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/pcre3.dll", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/pcre3.dll?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a"}, {"sha": "aab9ddd1b8bdd0fa118fc28f5d3beaf3a82fad96", "filename": "tools/ScriptStaticMethodTracker/script_path.c", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/script_path.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/script_path.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/script_path.c?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,72 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#include <stdio.h>\n+#include <dirent.h>\n+#include <sys/types.h>\n+#include <sys/stat.h>\n+#include <unistd.h>\n+\n+void fetchScriptFilesFromDirectory(ScriptFiles *files, char *root_dir) {\n+    struct dirent *de;\n+    struct stat info;\n+    DIR *dir = opendir(root_dir);\n+    if (dir != NULL) {\n+        de = readdir(dir);  // skip .\n+        de = readdir(dir);  // skip ..\n+\n+        while ((de = readdir(dir)) != NULL) {\n+            char file_path[SCRIPT_FILES_MAX_PATH_SIZE];\n+            strcpy(file_path, root_dir);\n+            strcat(file_path, \"/\");\n+            strcat(file_path, de->d_name);\n+\n+            stat(file_path, &info);\n+            if (S_ISREG(info.st_mode)) {\n+                files->file_paths[files->file_paths_size] = (char *)malloc(SCRIPT_FILES_MAX_PATH_SIZE * sizeof(char));\n+                strcpy(files->file_paths[files->file_paths_size], file_path);\n+                files->file_paths_size++;\n+            } else {\n+                fetchScriptFilesFromDirectory(files, file_path);\n+            }\n+        }\n+    }\n+}\n+\n+ScriptFiles* createScriptFiles(char *root_dir) {\n+    ScriptFiles *files = (ScriptFiles *)malloc(sizeof(ScriptFiles));\n+\n+    files->file_paths = (char **)malloc(SCRIPT_FILES_MAX_COUNT * sizeof(char *));\n+    files->file_paths_size = 0;\n+\n+    fetchScriptFilesFromDirectory(files, root_dir);\n+\n+    return files;\n+}\n+\n+void freeScriptFiles(ScriptFiles *files) {\n+    int i;\n+    for (i = 0; i < files->file_paths_size; i++) {\n+        free(files->file_paths[i]);\n+    }\n+\n+    free(files->file_paths);\n+    free(files);\n+}"}, {"sha": "553d28d260eab2e1721e0ddf80a967dd893466a2", "filename": "tools/ScriptStaticMethodTracker/script_path.h", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/script_path.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f958624f6a2a9fa196ca67dfeafc577e9b93b83a/tools/ScriptStaticMethodTracker/script_path.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/script_path.h?ref=f958624f6a2a9fa196ca67dfeafc577e9b93b83a", "patch": "@@ -0,0 +1,34 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#ifndef SCRIPT_PATH_H_\n+#define SCRIPT_PATH_H_\n+\n+#define SCRIPT_FILES_MAX_COUNT 20000\n+#define SCRIPT_FILES_MAX_PATH_SIZE 1000\n+\n+typedef struct {\n+    char **file_paths;\n+    int file_paths_size;\n+} ScriptFiles;\n+\n+#include \"script_path.c\"\n+\n+#endif /* SCRIPT_PATH_H_ */"}]}]},
