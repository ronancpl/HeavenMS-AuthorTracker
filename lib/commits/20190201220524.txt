{"fetchDate": "2019-12-19", "content": [{"sha": "137e003d1dedd28846467c5c637d569ac9763f76", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MTM3ZTAwM2QxZGVkZDI4ODQ2NDY3YzVjNjM3ZDU2OWFjOTc2M2Y3Ng==", "commit": {"author": {"name": "MedicOP", "email": "MedicOP@users.noreply.github.com", "date": "2019-02-01T22:05:24Z"}, "committer": {"name": "Ronan Lana", "email": "rcpl2010@gmail.com", "date": "2019-02-01T22:05:24Z"}, "message": "Fix event system (#382)", "tree": {"sha": "a1e07cb1f9278f15c7f9fff7ec8527ec250c429f", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/a1e07cb1f9278f15c7f9fff7ec8527ec250c429f"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/137e003d1dedd28846467c5c637d569ac9763f76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/137e003d1dedd28846467c5c637d569ac9763f76", "html_url": "https://github.com/ronancpl/HeavenMS/commit/137e003d1dedd28846467c5c637d569ac9763f76", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/137e003d1dedd28846467c5c637d569ac9763f76/comments", "author": {"login": "MedicOP", "id": 18251099, "node_id": "MDQ6VXNlcjE4MjUxMDk5", "avatar_url": "https://avatars3.githubusercontent.com/u/18251099?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MedicOP", "html_url": "https://github.com/MedicOP", "followers_url": "https://api.github.com/users/MedicOP/followers", "following_url": "https://api.github.com/users/MedicOP/following{/other_user}", "gists_url": "https://api.github.com/users/MedicOP/gists{/gist_id}", "starred_url": "https://api.github.com/users/MedicOP/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MedicOP/subscriptions", "organizations_url": "https://api.github.com/users/MedicOP/orgs", "repos_url": "https://api.github.com/users/MedicOP/repos", "events_url": "https://api.github.com/users/MedicOP/events{/privacy}", "received_events_url": "https://api.github.com/users/MedicOP/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8120fe2c0487392bf727ca414e58420cf2b2dc52", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/8120fe2c0487392bf727ca414e58420cf2b2dc52", "html_url": "https://github.com/ronancpl/HeavenMS/commit/8120fe2c0487392bf727ca414e58420cf2b2dc52"}], "stats": {"total": 47, "additions": 21, "deletions": 26}, "files": [{"sha": "100c2eb35557d0cc542965bba870669530edfb5d", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/137e003d1dedd28846467c5c637d569ac9763f76/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/137e003d1dedd28846467c5c637d569ac9763f76/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=137e003d1dedd28846467c5c637d569ac9763f76", "patch": "@@ -6605,6 +6605,9 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                 }\n                 //ret.events = new MapleEvents(new RescueGaga(rs.getInt(\"rescuegaga\")), new ArtifactHunt(rs.getInt(\"artifacthunt\")));\n             }\n+            if (!ret.events.containsKey(\"rescueGaga\")) {\n+                ret.events.put(\"rescueGaga\", new RescueGaga(0));\n+            }\n             rs.close();\n             ps.close();\n             ret.cashshop = new CashShop(ret.accountid, ret.id, ret.getJobType());\n@@ -7945,6 +7948,17 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             ps.close();\n             \n             deleteWhereCharacterId(con, \"DELETE FROM eventstats WHERE characterid = ?\");\n+            ps = con.prepareStatement(\"INSERT INTO eventstats (characterid, name, info) VALUES (?, ?, ?)\");\n+            ps.setInt(1, id);\n+            \n+            for (Map.Entry<String, MapleEvents> entry : events.entrySet()) {\n+                ps.setString(2, entry.getKey());\n+                ps.setInt(3, entry.getValue().getInfo());\n+                ps.addBatch();\n+            }\n+            \n+            ps.executeBatch();\n+            ps.close();\n             \n             deleteQuestProgressWhereCharacterId(con, id);\n             "}, {"sha": "6c0fb043f7b81c7e7cad195e36a31af3907bf51a", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/137e003d1dedd28846467c5c637d569ac9763f76/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/137e003d1dedd28846467c5c637d569ac9763f76/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=137e003d1dedd28846467c5c637d569ac9763f76", "patch": "@@ -699,31 +699,6 @@ public String getName() {\n \t\treturn name;\n \t}\n \n-\tpublic void saveWinner(MapleCharacter chr) {\n-                String emName;\n-                sL.lock();\n-                try {\n-                       emName = em.getName();\n-                } finally {\n-                        sL.unlock();\n-                }\n-            \n-\t\ttry {\n-                        Connection con = DatabaseConnection.getConnection();\n-\t\t\ttry (PreparedStatement ps = con.prepareStatement(\"INSERT INTO eventstats (event, instance, characterid, channel) VALUES (?, ?, ?, ?)\")) {\n-\t\t\t\tps.setString(1, emName);\n-\t\t\t\tps.setString(2, getName());\n-\t\t\t\tps.setInt(3, chr.getId());\n-\t\t\t\tps.setInt(4, chr.getClient().getChannel());\n-\t\t\t\tps.executeUpdate();\n-\t\t\t}\n-                        \n-                        con.close();\n-\t\t} catch (SQLException ex) {\n-\t\t\tex.printStackTrace();\n-\t\t}\n-\t}\n-\n \tpublic MapleMap getMapInstance(int mapId) {\n \t\tMapleMap map = mapFactory.getMap(mapId);\n                 map.setEventInstance(this);"}, {"sha": "a964586f542936a9b4c22550d0627f29b29cc4ce", "filename": "src/server/events/MapleEvents.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/137e003d1dedd28846467c5c637d569ac9763f76/src/server/events/MapleEvents.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/137e003d1dedd28846467c5c637d569ac9763f76/src/server/events/MapleEvents.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/events/MapleEvents.java?ref=137e003d1dedd28846467c5c637d569ac9763f76", "patch": "@@ -25,8 +25,10 @@\n /**\n  * @author kevintjuh93\n  */\n-public class MapleEvents {\n+public abstract class MapleEvents {\n     public MapleEvents() {\n      \n     }\n+    \n+    public abstract int getInfo();\n }\n\\ No newline at end of file"}, {"sha": "b9dd84b4ab8028dae147911b03df74c22da89464", "filename": "src/server/events/RescueGaga.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/137e003d1dedd28846467c5c637d569ac9763f76/src/server/events/RescueGaga.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/137e003d1dedd28846467c5c637d569ac9763f76/src/server/events/RescueGaga.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/events/RescueGaga.java?ref=137e003d1dedd28846467c5c637d569ac9763f76", "patch": "@@ -42,6 +42,10 @@ public int getCompleted() {\n         public void complete() {\n             completed++;\n         }\n+        \n+        public int getInfo() {\n+            return getCompleted();\n+        }\n \n         public void giveSkill(MapleCharacter chr) {\n             int skillid = 0;"}]}]},
