{"fetchDate": "2019-12-19", "content": [{"sha": "0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MGQ0N2VkZjFhN2ZhOTdkMTZmODYzODU4NmY5ZDJhNmJhNjIxOTA0Yw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-08-18T14:38:55Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-08-18T14:38:55Z"}, "message": "Persistent diseases + PQ request system + GuildPQ fix\n\nImplemented persistent diseases. Players now keep their disease status when logging out the game.\nSolved several concurrent access issues in MapleMap and MapleMonster.\nImplemented an option where an account's character slots can be accounted either by each world or all-server range.\nFixed some issues with character slot count when entering/exiting Cash Shop.\nFixed an exploit with Papulatus, on where players could create cracks of dimension infinitely.\nSolved an issue with the \"reach\" command not working properly when the targeted player is on an event instance.\nDevised an advanced and secure \"PQ request\" system. The service revolves around expecting massive number of players requesting a \"pass\" simultaneously, and fairly & swiftly responsing as much people as possible.\nImproved overall Whisper handler performance.\nFixed GPQ Stage 1 statues not working as expected, which rendered the instance unplayable until now.\nAdded commands for start, complete and reset quests.", "tree": {"sha": "9c402f23763942be4f37d684500a76faf17c91d2", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/9c402f23763942be4f37d684500a76faf17c91d2"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "html_url": "https://github.com/ronancpl/HeavenMS/commit/0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cda4433d99b76cb54b0d9aff0d0822e890781456", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/cda4433d99b76cb54b0d9aff0d0822e890781456", "html_url": "https://github.com/ronancpl/HeavenMS/commit/cda4433d99b76cb54b0d9aff0d0822e890781456"}], "stats": {"total": 2299, "additions": 1596, "deletions": 703}, "files": [{"sha": "cfa63a92c87827d055f9b8e3a8f5a076cf6aed10", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -59,7 +59,7 @@ Although development is halted, support for fixing features that were implemente\n \n If you liked this project, please don't forget to __star__ the repo ;) .\n \n-It's never too much to tell this, even still thanks to everyone that have been contributing something for the continuous improvement of the server! Be it through bug reports, donation, code snippets and/or pull requests.\n+It's never enough to tell this, thanks to everyone that have been contributing something for the continuous improvement of the server! Be it through bug reports, donation, code snippets and/or pull requests.\n \n Our Discord channel is still available on: https://discord.gg/Q7wKxHX\n "}, {"sha": "c23548b2b3de0ba2d6b967f96d54a9b14967ded3", "filename": "docs/feature_list.md", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -116,6 +116,7 @@ Monsters, Maps & Reactors:\n \n PQ potentials:\n \n+* Advanced synchronization and smart management of the PQ registration system, as expected for a core server mechanic that is largely used by the players.\n * Lobby system - Multiple PQ instances on same channel.\n * Expedition system - Multiples parties can attempt on a same instance (lobbies and expeds are mutually-exclusive).\n * Guild queue system - Guilds can register themselves on a queue for the GPQ.\n@@ -129,6 +130,7 @@ Player potentials:\n * Gain fame by quests.\n * Pet evolutions functional (not GMS-like).\n * Reviewed keybinding system.\n+* Account's Character slots: either each world has it's own count or there's a shared value between all worlds.\n \n Server potentials:\n \n@@ -147,6 +149,7 @@ Server potentials:\n * Pet item pickup now gives preference to player attacks rather than forcing attack disables when automatically picking up.\n * Channel capacity bar functional and world servers with max capacity checks.\n * Disease status are now visible for other players, even when changing maps.\n+* Players keep their current disease status saved when exiting the game, returning with them on login.\n * Poison damage value are now visible for other players.\n * Mastery book announcer displays droppers of needed books of a player, by reading underlying DB.\n * Custom jail system (needs provided custom wz)."}, {"sha": "61a8b68f895cfba0de6ee9850e8c02366b3b416b", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1226,4 +1226,24 @@ Modificado algumas tabelas em ThreadTracker e World para usar Integer ao inv\u00e9s\n \n 07 Agosto 2018,\n Corrigido um bug na fase de login que nao construia corretamente overview de characters sem itens equipados, lancando excecoes posteriormente.\n-Revisado alguns casos de borda com doors levando as mesmas a nao sumirem imediatamente em certos cenarios.\n\\ No newline at end of file\n+Revisado alguns casos de borda com doors levando as mesmas a nao sumirem imediatamente em certos cenarios.\n+\n+08 - 10 Agosto 2018,\n+Adicionado registro de diseases na DB. Agora jogadores continuam com diseases ao voltar a logar no jogo.\n+Corrigido exploit com jogadores podendo visitar sua propria loja via owl.\n+Corrigido varios problemas de acesso concorrente e deadlocks em recursos do MapleMap e MapleMonster.\n+Implementado character slots para cobrir limite de personagens por conta (ao inves de 3 em cada mundo).\n+Corrigido diversos problemas com character slots ao entrar/sair do cash shop (erro ligado a alternancia de MapleClients).\n+Corrigido exploit com quest de Papulatus, onde jogadores poderiam gerar cracks of dimension por desistir de quests.\n+Corrigido jogadores podendo ser registrados em event instances mesmo quando estas ja estao liberadas (disposed).\n+Corrigido comando \"reach\" nao funcionando corretamente para casos que envolvam event instances.\n+Implementado um sistema avancado e seguro de escalonamento de requisicoes delegadas com iniciar nova PQs.\n+\n+13 - 14 Agosto 2018,\n+Corrigido quest \"Revealed Identity\" erroneamente requisitando itens de quest anteriores de jogadores, impossibilitando jogadores de comecar quests em certos casos.\n+Melhorado handler de whisper, agora buscando referencias a DB somente em casos onde o jogador eh GM.\n+Retirado campo de GM da tabela \"accounts\".\n+Corrigido estatuas do stage1 da GuildPQ nao funcionando corretamente.\n+Alterado varias strings de NPCs e de mensagens utilizando a palavra \"evento\" querendo dizer instancias (julgamento subjetivo).\n+Adicionado comandos para start, complete e reset quests.\n+Adicionado scripts para meteoritos de Omega Sector.\n\\ No newline at end of file"}, {"sha": "cd7cebb20d5f1bd42ee4971add837a403075cae8", "filename": "nbproject/project.properties", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/project.properties?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -30,10 +30,10 @@ endorsed.classpath=\n excludes=\n file.reference.HikariCP-java7-2.4.12.jar=cores/HikariCP-java7-2.4.12.jar\n file.reference.MapleSolaxia-src=src\n-file.reference.mina-core-2.0.7.jar=C:\\\\Users\\\\Tyler\\\\Desktop\\\\MoopleDev\\\\dist\\\\mina-core-2.0.7.jar\n-file.reference.mysql-connector-java-bin.jar=C:\\\\Users\\\\Tyler\\\\Desktop\\\\MoopleDev\\\\dist\\\\mysql-connector-java-bin.jar\n-file.reference.slf4j-api-1.6.6.jar=C:\\\\Users\\\\Tyler\\\\Desktop\\\\MoopleDev\\\\dist\\\\slf4j-api-1.6.6.jar\n-file.reference.slf4j-jdk14-1.7.5.jar=C:\\\\Users\\\\Tyler\\\\Desktop\\\\MoopleDev\\\\dist\\\\slf4j-jdk14-1.7.5.jar\n+file.reference.mina-core-2.0.7.jar=cores\\\\mina-core-2.0.7.jar\n+file.reference.mysql-connector-java-bin.jar=cores\\\\mysql-connector-java-bin.jar\n+file.reference.slf4j-api-1.6.6.jar=cores\\\\slf4j-api-1.6.6.jar\n+file.reference.slf4j-jdk14-1.7.5.jar=cores\\\\slf4j-jdk14-1.7.5.jar\n includes=**\n jar.archive.disabled=${jnlp.enabled}\n jar.compress=true"}, {"sha": "f1fc7fc43028d1562a612a4e9cdb22ff5bcb87ad", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -247,7 +247,7 @@ function changedMap(eim, player, mapid) {\n             end(eim);\n         }\n         else {\n-            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n             eim.unregisterPlayer(player);\n         }\n     } else {\n@@ -303,7 +303,7 @@ function playerRevive(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }\n@@ -315,7 +315,7 @@ function playerDisconnected(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }"}, {"sha": "d683de323e7b82230a604caeb973b81f83a82d4e", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -236,7 +236,7 @@ function changedMap(eim, player, mapid) {\n \n function afterChangedMap(eim, player, mapid) {\n         if (mapid == 990000100) {\n-                var texttt = \"So, here is the brief. You guys should be warned that, once out on the fortress outskirts, anyone that would not be equipping the #b#t1032033##k will die instantly due to the deteriorated state of the air around there. That being said, once your team moves out to the next stage, make sure to #bhit the glowing rocks#k in that region and #bequip the dropped item#k before advancing stages. That will protect you thoroughly from the air sickness. Good luck!\";\n+                var texttt = \"So, here is the brief. You guys should be warned that, once out on the fortress outskirts, anyone that would not be equipping the #b#t1032033##k will die instantly due to the deteriorated state of the air around there. That being said, once your team moves out, make sure to #bhit the glowing rocks#k in that region and #bequip the dropped item#k before advancing stages. That will protect you thoroughly from the air sickness. Good luck!\";\n                 player.getClient().getSession().write(Packages.tools.MaplePacketCreator.getNPCTalk(9040000, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n         }\n }"}, {"sha": "0be282d612e757983a62e51e59501dd299d2be70", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -132,7 +132,7 @@ function changedMap(eim, player, mapid) {\n             end(eim);\n         }\n         else {\n-            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n             eim.unregisterPlayer(player);\n         }\n     }\n@@ -149,7 +149,7 @@ function playerRevive(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }\n@@ -161,7 +161,7 @@ function playerDisconnected(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }"}, {"sha": "60089d57aec576f8166f48f16f4c20f61269a706", "filename": "scripts/event/ScargaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ScargaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ScargaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ScargaBattle.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -118,7 +118,7 @@ function changedMap(eim, player, mapid) {\n             end(eim);\n         }\n         else {\n-            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n             eim.unregisterPlayer(player);\n         }\n     }\n@@ -135,7 +135,7 @@ function playerRevive(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }\n@@ -147,7 +147,7 @@ function playerDisconnected(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }"}, {"sha": "1a637d67a84bcabddb8f9c84f214568200eb6c13", "filename": "scripts/event/ShowaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ShowaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ShowaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ShowaBattle.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -125,7 +125,7 @@ function changedMap(eim, player, mapid) {\n             end(eim);\n         }\n         else {\n-            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n             eim.unregisterPlayer(player);\n         }\n     }\n@@ -144,7 +144,7 @@ function playerRevive(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }\n@@ -156,7 +156,7 @@ function playerDisconnected(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }"}, {"sha": "7fc014adc3e0b3438a83bfcddf92dd5b6d5e8c27", "filename": "scripts/event/ZakumBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ZakumBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/event/ZakumBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumBattle.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -120,7 +120,7 @@ function changedMap(eim, player, mapid) {\n             end(eim);\n         }\n         else {\n-            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+            eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n             eim.unregisterPlayer(player);\n         }\n     }\n@@ -137,7 +137,7 @@ function playerRevive(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }\n@@ -149,7 +149,7 @@ function playerDisconnected(eim, player) {\n         end(eim);\n     }\n     else {\n-        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the event.\");\n+        eim.dropMessage(5, \"[Expedition] \" + player.getName() + \" has left the instance.\");\n         eim.unregisterPlayer(player);\n     }\n }"}, {"sha": "0ebfe3996671c8d1796943d6c5a79480b519e1d8", "filename": "scripts/npc/1012112.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012112.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012112.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012112.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -58,7 +58,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n \n-                                cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to redeem an event hat.\");\n+                                cm.sendSimple(\"#e#b<Party Quest: Primrose Hill>\\r\\n#k#n\" + em.getProperty(\"party\") + \"\\r\\n\\r\\nI'm Tory. Inside here is a beautiful hill where the primrose blooms. There's a tiger that lives in the hill, Growlie, and he seems to be looking for something to eat. Would you like to head over to the hill of primrose and join forces with your party members to help Growlie out?#b\\r\\n#L0#I want to participate in the party quest.\\r\\n#L1#I want to find party members.\\r\\n#L2#I would like to hear more details.\\r\\n#L3#I would like to redeem an instance hat.\");\n                         } else if (status == 1) {\n                                 if (selection == 0) {\n                                         if (cm.getParty() == null) {\n@@ -87,7 +87,7 @@ function action(mode, type, selection) {\n                                         cm.sendOk(\"#e#b<Party Quest: Primrose Hill>#k#n\\r\\nCollect primrose seeds from the flowers at the bottom part of the map and drop them by the platforms above the stage. Primrose seed color must match to grow the seeds, so test until you find the correct combination. When all the seeds have been planted, that is, starting second part of the mission, scout the Moon Bunny while it prepares Rice Cakes for the hungry Growlie. Once Growlie becomes satisfied, your mission is complete.\");\n                                         cm.dispose();\n                                 } else {\n-                                        cm.sendYesNo(\"So you want to exchange #b20 #b#t4001158##k for the event-designed hat?\");\n+                                        cm.sendYesNo(\"So you want to exchange #b20 #b#t4001158##k for the instance-designed hat?\");\n                                 }\n                         } else {\n                                 if(cm.hasItem(4001158, 20)) {"}, {"sha": "b6fad8a434038362572577f6110a6633f339ee04", "filename": "scripts/npc/1012118.js", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012118.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012118.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012118.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -22,18 +22,16 @@ function action(mode, type, selection) {\n                 cm.sendOk(\"This training ground is available only for those under level 20.\");\n                 cm.dispose();\n                 return;\n-        }\n-        \n-        if (cm.isQuestActive(22515) || cm.isQuestActive(22516) || cm.isQuestActive(22517) || cm.isQuestActive(22518)) {\n-\t\tcm.sendYesNo(\"Would you like to go in the special Spore Training Center?\");\n+        } else if (cm.isQuestActive(22515) || cm.isQuestActive(22516) || cm.isQuestActive(22517) || cm.isQuestActive(22518)) {\n+\t\tcm.sendYesNo(\"Would you like to go in the special Training Center?\");\n \t\tstatus = 1;\n-\t}\n-        \n-\tvar selStr = \"Would you like to go into the Training Center?\";\n-\tfor (var i = 0; i < num; i++) {\n-\t\tselStr += \"\\r\\n#b#L\" + i + \"#Training Center \" + i + \" (\" + cm.getPlayerCount(map + i) + \"/\" + maxp + \")#l#k\";\n-\t}\n-\tcm.sendSimple(selStr);\n+\t} else {\n+                var selStr = \"Would you like to go into the Training Center?\";\n+                for (var i = 0; i < num; i++) {\n+                        selStr += \"\\r\\n#b#L\" + i + \"#Training Center \" + i + \" (\" + cm.getPlayerCount(map + i) + \"/\" + maxp + \")#l#k\";\n+                }\n+                cm.sendSimple(selStr);\n+        }\n     } else if (status == 1) {\n \tif (selection < 0 || selection >= num) {\n \t\tcm.dispose();"}, {"sha": "652b65b62ea418985b4697eb376916b64d67f168", "filename": "scripts/npc/1012119.js", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012119.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1012119.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012119.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -22,21 +22,16 @@ function action(mode, type, selection) {\n                 cm.sendOk(\"This training ground is available only for those under level 20.\");\n                 cm.dispose();\n                 return;\n-        }\n-        \n-\telse if (cm.isQuestActive(22515) || cm.isQuestActive(22516) || cm.isQuestActive(22517) || cm.isQuestActive(22518)) {\n+        } else if (cm.isQuestActive(22515) || cm.isQuestActive(22516) || cm.isQuestActive(22517) || cm.isQuestActive(22518)) {\n \t\tcm.sendYesNo(\"Would you like to enter the special Training Center?\");\n \t\tstatus = 1;\n-\t}\n-\n-else {\n-        \n-\tvar selStr = \"Would you like to go into the Training Center?\";\n-\tfor (var i = 0; i < num; i++) {\n-\t\tselStr += \"\\r\\n#b#L\" + i + \"#Training Center \" + i + \" (\" + cm.getPlayerCount(map + i) + \"/\" + maxp + \")#l#k\";\n-\t}\n-\tcm.sendSimple(selStr);\n-}\n+\t} else {\n+                var selStr = \"Would you like to go into the Training Center?\";\n+                for (var i = 0; i < num; i++) {\n+                        selStr += \"\\r\\n#b#L\" + i + \"#Training Center \" + i + \" (\" + cm.getPlayerCount(map + i) + \"/\" + maxp + \")#l#k\";\n+                }\n+                cm.sendSimple(selStr);\n+        }\n \n     } else if (status == 1) {\n \tif (selection < 0 || selection >= num) {"}, {"sha": "f8eb757c7eb0c7468280e1d65cede8d4a16cd874", "filename": "scripts/npc/1032004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1032004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1032004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1032004.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /* Shane 1032004\n- * By Moogra\n+ * @Author Moogra\n */\n \n function start() {"}, {"sha": "c6a83ff96b861ee3e4b84b0b5f87021eb7516233", "filename": "scripts/npc/1052013.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1052013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1052013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052013.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -61,10 +61,10 @@ function action(mode, type, selection) {\n                                                         cm.dispose();\n                                                         return;\n                                                 } else {\n-                                                        cm.sendYesNo(\"Your team must collect #r\" + couponsNeeded + \"#k coupons to complete this event. Talk to me when you have the right amount in hands... Or you want to #bquit now#k? Note that if you quit now #ryour team will be forced to quit#k as well.\");\n+                                                        cm.sendYesNo(\"Your team must collect #r\" + couponsNeeded + \"#k coupons to complete this instance. Talk to me when you have the right amount in hands... Or you want to #bquit now#k? Note that if you quit now #ryour team will be forced to quit#k as well.\");\n                                                 }\n                                         } else {\n-                                                cm.sendYesNo(\"Your team must collect #r\" + couponsNeeded + \"#k coupons to complete this event. Let your leader talk to me with the right amount in hands... Or you want to #bquit now#k? Note that if you quit now your team #rmay become undermanned#k to complete this event.\");\n+                                                cm.sendYesNo(\"Your team must collect #r\" + couponsNeeded + \"#k coupons to complete this instance. Let your leader talk to me with the right amount in hands... Or you want to #bquit now#k? Note that if you quit now your team #rmay become undermanned#k to further continue this instance.\");\n                                         }\n                                 } else {\n                                         if(!eim.giveEventReward(cm.getPlayer())) {"}, {"sha": "ab052815a33c3d50a2dbed74f9a5e2cdd3c23eea", "filename": "scripts/npc/1061012.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1061012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1061012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1061012.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -25,7 +25,7 @@ function start() {\n                 var eli = em.getEligibleParty(cm.getParty());\n                 if(eli.size() > 0) {\n                     if(!em.startInstance(cm.getParty(), cm.getPlayer().getMap(), 1)) {\n-                        cm.sendOk(\"A party in your name is already registered in this event.\");\n+                        cm.sendOk(\"A party in your name is already registered in this instance.\");\n                     }\n                 } else {\n                     cm.sendOk(\"You cannot start this party quest yet, because either your party is not in the range size, some of your party members are not eligible to attempt it or they are not in this map. If you're having trouble finding party members, try Party Search.\");"}, {"sha": "980e989ba89b75bdc76301e46955df2f13bc6f13", "filename": "scripts/npc/1103005.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1103005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/1103005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1103005.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -24,7 +24,7 @@\n  * @ID: 1103005\n  * @Map Id: 913040006\n  * @Function: Cygnus Creator\n- * @Author Jay (text)\n+ * @Author Jay <text>\n  * @Author David\n  */\n "}, {"sha": "77d0586a59c3f77ce38b3ff30e4715c9ac5669b3", "filename": "scripts/npc/2030013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2030013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2030013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2030013.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n */\n /*Adobis\n  *\n- *@author SharpAceX (Alan)\n+ *@author Alan (SharpAceX)\n  *@author Ronan\n  */\n importPackage(Packages.server.expeditions);"}, {"sha": "09ece3bdbfd1ba2a6ac2833a6c7b7f656a649085", "filename": "scripts/npc/2030013_old.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2030013_old.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2030013_old.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2030013_old.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n  */\n \n /* \n- * @Authors Stereo, xQuasar, <<XkelvinchiaX@Kelvin(For make it Fully Working.)>>\n+ * @Author Stereo, xQuasar, <<XkelvinchiaX@Kelvin(For make it Fully Working.)>>\n  * \n  * Adobis - El Nath: Entrance to Zakum Altar (211042400)\n  * \n@@ -80,7 +80,7 @@ function action(mode, type, selection) {\n                     else { // start Zakum Battle\n                         var eim = em.newInstance(\"Zakum\" + passwd);\n                         if(!em.startInstance(eim,cm.getPlayer().getName())) {\n-                            cm.sendOk(\"A party in your name is already registered in this event.\");\n+                            cm.sendOk(\"A party in your name is already registered in this instance.\");\n                             cm.dispose();\n                             return;\n                         }"}, {"sha": "1b6352a8ccdc10fab7dcbd58f45b724988ccdba0", "filename": "scripts/npc/2040030.js", "status": "modified", "additions": 127, "deletions": 126, "changes": 253, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2040030.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2040030.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2040030.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn(MapleSea Like)(Need to add creation of minigame)\n+/* Author: aaroncsn <(MapleSea Like)(Need to add creation of minigame)>\n \tNPC Name: \t\tWisp\n \tMap(s): \t\tLudibrium: Eos Tower Entrance(220000400)\n \tDescription: \t\tPet Master\n@@ -12,130 +12,131 @@ function start() {\n function action(mode, type, selection) {\n \n     if (mode == -1) {\n-        cm.dispose();\n-    } else {\n-        if (status >= 0 && mode == 0) {\n             cm.dispose();\n-            return;\n-        }\n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-\t\t\tif(status == 0){\n-\t\t\t\tcm.sendSimple(\"Hello there, I'm #bMar the Fairy#k of Victoria Island's main disciple. Mar the Fairy summoned me here to see if the pets are being taken care of here in Ludibrium. What can I do for you? \\r\\n#L0##bMy pet has turned back into a doll\\r\\nPlease help me make it move again!#k#l \\r\\n#L1##bTell me more about Pets.#k#l \\r\\n#L2##bHow do I raise Pets?#k#l \\r\\n#L3##bDo Pets die too?#k#l \\r\\n#L4##bWhat are the commands for brown and black kitty?#k#l \\r\\n#L5##bWhat are the commands for brown puppy?#k#l \\r\\n#L6##bWhat are the commands for pink and white bunny?#k#l \\r\\n#L7##bWhat are the commands for Mini Cargo?#k#l \\r\\n#L8##bWhat are the commands for Husky?#k#l \\r\\n#L9##bWhat are the commands for Black Pig?#k#l \\r\\n#L10##bWhat are the commands for Panda#k#l \\r\\n#L11##bWhat are the commands for Dino Boy & Girl?#k#l \\r\\n#L12##bWhat are the commands for Rudolph?#k#l \\r\\n#L13##bWhat are the commands for Monkey?#k#l \\r\\n#L14##bWhat are the commands for Robot?#k#l \\r\\n#L15##bWhat are the commands for Elephant?#k#l \\r\\n#L16##bWhat are the commands for Golden Pig?#k#l \\r\\n#L17##bWhat are the commands for Penguin?#k#l \\r\\n#L18##bWhat are the commands for Mini Yeti?#k#l \\r\\n#L19##bWhat are the commands for Jr. Balrog? \\r\\n#L20##bWhat are the commands for Baby Dragon?#k#l \\r\\n#L21##bWhat are the commands for Green/Red/Blue Dragon?#k#l \\r\\n#L22##bWhat are the commands for Black Dragon?#k#l \\r\\n#L23##bWhat are the commands for Snowman?#k#l \\r\\n#L24##bWhat are the commands for Sun Wu Kong?#k#l \\r\\n#L25##bWhat are the commands for Jr. Reaper?#k#l \\r\\n#L26##bWhat are the commands for Crystal Rudolph?#k#l \\r\\n#L27##bWhat are the commands for Kino?#k#l \\r\\n#L28##bWhat are the commands for White Duck?#k#l \\r\\n#L29##bWhat are the commands for Pink Bean?#k#l \\r\\n#L30##bWhat are the commands for Porcupine?#k#l\");\n-\t\t\t\t}\n-\t\t\telse if(status == 1){\n-\t\t\t\tif(selection == 0){\n-\t\t\t\t\tcm.sendNext(\"I'm Wisp, continuing on with the studies that my Master Mar the Fairy assigned me. There seems to be a lot of pets even her in Ludibrium. I need to get back to my studies, so if you'll excuse me...\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 1){\n-\t\t\t\t\tcm.sendNext(\"Hmmmm,you must have a lot of questions regarding the pets. Long ago, a person by the name #bCloy#k, sprayed Water of Life on it, and cast spell on it to create a magical animal. I know it sounds unbelievable, but it's a doll that became an actual living thing. They understand and follow people very well.\");\n-\t\t\t\t} else if(selection == 2){\n-\t\t\t\t\tcm.sendNext(\"Depending on the command you give, pets can love it, hate, and display other kinds of reactions to it. If you give the pet a command and it follows you well, your closeness goes up. Double click on the pet and you can check the closeness, level, fullness and etc...\");\n-\t\t\t\t} else if(selection == 3){\n-\t\t\t\t\tcm.sendNext(\"Dying... well, they aren't technically ALIVE per se, so I don't know if dying is the right term to use. They are dolls with my magical power and the power of Water of Life to become a live object. Of course while it's alive, it's just like a live animal...\");\n-\t\t\t\t} else if(selection == 4){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rBrown Kitty and Black Kitty#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bcutie#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 5){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rBrown Puppy#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, baddog, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpee#k (level 10 ~ 30)\\r\\n#btalk, say, chat, bark#k (level 10 ~ 30)\\r\\n#bdown#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 6){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rPink Bunny and White Bunny#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bup, stand#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bhug#k (level 10 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 7){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rMini Cargo#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bup, stand#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpee#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bthelook, charisma#k (level 10 ~ 30)\\r\\n#bgoodboy, good#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\t\t\t\t\n-\t\t\t\t} else if(selection == 8){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rHusky#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, baddog, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#bpee#k (level 1 ~ 30)\\r\\n#btalk, say, chat, bark#k (level 10 ~ 30)\\r\\n#bdown#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 9){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rBlack Pig#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bhand, up, stand#k (level 1 ~ 30)\\r\\n#btalk, say, chat, hug#k (level 10 ~ 30)\\r\\n#bsmile#k (level 10 ~ 30)\\r\\n#blaugh, smile#k (level 10 ~ 30)\\r\\n#bcharisma, sleep, sleepy, gotobed#k(level 20~30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 10){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rPanda#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#bpee#k(level 1 ~ 30)\\r\\n#bup, stand, hug#k (level 1 ~ 30)\\r\\n#btalk, chat#k (level 10 ~ 30)\\r\\n#bplay#k (level 20 ~ 30)\\r\\n#bmeh, bleh#k (level 10 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 11){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rDino Boy and Dino Girl#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no,, stupid, ihateyou, badboy, badgirl#k (evel 1 ~ 30)\\r\\n#biloveyou, dummy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, chat(level 10 ~ 30)\\r\\n#bsmile, laugh#k (level 1 ~ 30)\\r\\n#bcutie#k (level 10 ~ 30)\\r\\n#bsleep, nap, sleepy#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if(selection == 12){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rRudolph#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~30) \\r\\n#bbad, no, badgirl, badboy#k(level 1~30)\\r\\n#bup, stand#k(level 1 ~ 30) \\r\\n#bstupid, ihateyou, dummy#k(level 1 ~ 30) \\r\\n#bmerryxmas, merrychristmas#k(level 11 ~ 30)\\r\\n#biloveyou#k(level 1 ~ 30)\\r\\n#bpoop#k(level 1 ~ 30)\\r\\n#btalk, say, chat#k(level 11 ~ 30)\\r\\n#blonely, alone, down, rednose#k(level 11~30),\\r\\n#bcutie#k(level 11 ~ 30)\\r\\n#bmush, go#k(level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 13) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rMonkey#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, rest#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bup, stand#k(level 1 ~ 30)\\r\\n#biloveyou, pee#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 11 ~ 30)\\r\\n#bplay, melong#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 14) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rRobot#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, stand, rise#k (level 1 ~ 30)\\r\\n#battack, bad, no, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#biloveyou, good#k (level 1 ~ 30)\\r\\n#bspeak, disguise#k (level 11 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 15) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rElephant#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, rest#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bup, stand, rise#k(level 1 ~ 30)\\r\\n#biloveyou, pee#k (level 1 ~ 30)\\r\\n#btalk, say, chat, play#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 16) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rGolden Pig#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop, iloveyou#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 11 ~ 30)\\r\\n#bloveme, hugme#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\\r\\n#bimpressed, outofhere#k (level 21 ~ 30)\\r\\n#broll, showmethemoney#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 17) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rPenguin#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bup, stand, rise#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#btalk, chat, say#k (level 10 ~ 30)\\r\\n#bhug, hugme#k (level 10 ~ 30)\\r\\n#bwing, hand#k (level 10 ~ 30)\\r\\n#bsleep#k (level 20 ~ 30)\\r\\n#bkiss, smooch, muah#k (level 20 ~ 30)\\r\\n#bfly#k (level 20 ~ 30)\\r\\n#bcute, adorable#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 18) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rMini Yeti#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bdance, boogie, shakeit#k (level 1 ~ 30)\\r\\n#bcute, cutie, pretty, adorable#k (level 1 ~ 30)\\r\\n#biloveyou, likeyou, mylove#k (level 1 ~ 30)\\r\\n#btalk, chat, say#k (level 10 ~ 30)\\r\\n#bsleep, nap#k (level 10 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 19) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rJr. Balrog#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bliedown#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#biloveyou|mylove|likeyou#k (level 1 ~ 30)\\r\\n#bcute|cutie|pretty|adorable#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bsmirk|crooked|laugh#k (level 1 ~ 30)\\r\\n#bmelong#k (level 11 ~ 30)\\r\\n#bgood|thelook|charisma#k (level 11 ~ 30)\\r\\n#bspeak|talk|chat|say#k (level 11 ~ 30)\\r\\n#bsleep|nap|sleepy#k (level 11 ~ 30)\\r\\n#bgas#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 20) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rBaby Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#biloveyou|loveyou#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 1 ~ 30)\\r\\n#bcutie#k (level 11 ~ 30)\\r\\n#btalk|chat|say#k (level 11 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 11 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 21) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rGreen/Red/Blue Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 15 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 15 ~ 30)\\r\\n#biloveyou|loveyou#k (level 15 ~ 30)\\r\\n#bpoop#k (level 15 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 15 ~ 30)\\r\\n#btalk|chat|say#k (level 15 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 15 ~ 30)\\r\\n#bchange#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 22) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rBlack Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 15 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 15 ~ 30)\\r\\n#biloveyou|loveyou#k (level 15 ~ 30)\\r\\n#bpoop#k (level 15 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 15 ~ 30)\\r\\n#btalk|chat|say#k (level 15 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 15 ~ 30)\\r\\n#bcutie, change#k (level 21 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 23) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rSnowman#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#bloveyou, mylove, ilikeyou#k (level 1 ~ 30)\\r\\n#bmerrychristmas#k (level 1 ~ 30)\\r\\n#bcutie, adorable, cute, pretty#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#btalk, chat, say/sleep, sleepy, gotobed#k (level 10 ~ 30)\\r\\n#bchang#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 24) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rSun Wu Kong#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30)\\r\\n#bno,bad,badgirl,badboy#k(level 1 ~ 30) \\r\\n#bpoope#k(level 1 ~ 30) \\r\\n#bcutie,adorable,cute,pretty#k(level 1 ~ 30) \\r\\n#biloveyou,loveyou,luvyou,ilikeyou,mylove#k(level 1 ~ 30) \\r\\n#btalk,chat,say/sleep,sleepy,gotobed#k(level 10 ~ 30) \\r\\n#btransform#k(level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 25) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rJr. Reaper#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bplaydead, poop#k (level 1 ~ 30)\\r\\n#btalk|chat|say#k (level 1 ~ 30)\\r\\n#biloveyou, hug#k (level 1 ~ 30)\\r\\n#bsmellmyfeet, rockout, boo#k (level 1 ~ 30)\\r\\n#btrickortreat#k (level 1 ~ 30)\\r\\n#bmonstermash#k (level 1 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 26) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rCrystal Rudolph#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bbleh|joke#k(level 1~30)\\r\\n#bdisguise|transform#k(level 1 ~ 30) \\r\\n#bawesome|feelgood|lalala#k(level 1 ~ 30) \\r\\n#bloveyou|heybabe#k(level 1 ~ 30) \\r\\n#btalk|say|chat#k(level 10 ~ 30) \\r\\n#bsleep|sleepy|nap|gotobed#k(level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 27) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rKino#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad|no|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bsleep|nap|sleepy|gotobed#k(level 1 ~ 30) \\r\\n#btalk|say|chat#k(level 10 ~ 30) \\r\\n#biloveyou|mylove|likeyou#k(level 10 ~ 30) \\r\\n#bmeh|bleh#k(level 10 ~ 30) \\r\\n#bdisguise|change|transform#k(level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 28) {\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rWhite Duck#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30) \\r\\n#bbad|no|badgirl|badboy#k(level 1 ~ 30) \\r\\n#bup|stand#k(level 1 ~ 30) \\r\\n#bpoop#k(level 1 ~ 30) \\r\\n#btalk|chat|say#k(level 1 ~ 30) \\r\\n#bhug#k(level 1 ~ 30) \\r\\n#bloveyou#k(level 1 ~ 30) \\r\\n#bcutie#k(level 1 ~ 30) \\r\\n#bsleep#k(level 1 ~ 30) \\r\\n#bsmarty(level 10 ~ 30) \\r\\n#bdance#k (level 20 ~ 30) \\r\\n#bswan#k(level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 29){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rPink Bean#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30) \\r\\n#bbad|no|badgirl|badboy|poop#k(level 1 ~ 30) \\r\\n#blazy|dummy|ihateyoutalk|chat|say|mumbleiloveyou|hugme|loveyou|#k(level 1 ~ 30) \\r\\n#bshake|music|charmbleh|joke|boo#k(level 20 ~ 30) \\r\\n#bgotobed|sleep|sleepypoke|stinky|dummy|ihateyou#k(level 20 ~ 30)\\r\\n#bkongkong#k(level 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t} else if (selection == 30){\n-\t\t\t\t\tcm.sendNext(\"These are the commands for #rPorcupine#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bhugcushion|sleep|knit|poop#k (level 1 ~ 30)\\r\\n#bcomb|beach#k (level 10 ~ 30)\\r\\n#btreeninja|dart#k (level 20 ~ 30)\");\n-\t\t\t\t\tcm.dispose();\n-\t\t\t\t}\n-\t\t\t} else if(status == 2){\n-\t\t\t\tcm.sendNextPrev(\"But Water of Life only comes out little at the very bottom of the World Tree, so those babies can't be alive forever... I know, it's very unfortunate... but even if it becomes a doll again they can be brought back to life so be good to it while you're with it.\");\n-\t\t\t} else if(status == 3){\n-\t\t\t\tcm.sendNextPrev(\"Oh yeah, they'll react when you give them special commands. You can scold them, love them.. it all depends on how you take care of them. They are afraid to leave their masters so be nice to them, show them love. They can get sad and lonely fast..\");\n-\t\t\t\tcm.dispose();\n-\t\t\t} else if(status == 4){\n-\t\t\t\tcm.sendNextPrev(\"Talk to the pet, pay attention to it and its closeness level will go up and eventually his overall level will go up too. As the closeness rises, the pet's overall level will rise soon after. As the overall level rises, one day the pet may even talk like a person a little bit, so try hard raising it. Of course it won't be easy doing so...\");\n-\t\t\t} else if(status == 5){\n-\t\t\t\tcm.sendNextPrev(\"It may be a live doll but they also have life so they can feel the hunger too. #bFullness#k shows the level of hunger the pet's in. 100 is the max, and the lower it gets, it means that the pet is getting hungrier. After a while, it won't even follow your command and be on the offensive, so watch out over that.\");\n-\t\t\t} else if(status == 6){\n-\t\t\t\tcm.sendNextPrev(\"That's right! Pets can't eat the normal human food. Instead a teddy bear in Ludibrium called #bPatricia#k sells #bPet Food#k so if you need food for your pet, find #bPatricia#k It'll be a good idea to buy the food in advance and feed the pet before it gets really hungry.\");\n-\t\t\t} else if(status == 7){\n-\t\t\t\tcm.sendNextPrev(\"Oh, and if you don't feed the pet for a long period of time, it goes back home by itself. You can take it out of its home and feed it but it's not really good for the pet's health, so try feeding him on a regular basis so it doesn't go down to that level, alright? I think this will do.\");\n-\t\t\t\tcm.dispose();\n-\t\t\t} else if(status == 8){\n-\t\t\t\tcm.sendNextPrev(\"After some time... that's correct, they stop moving. They just turn back to being a doll, after the effect of magic dies down and Water of Life dries out. But that doesn't mean it's stopped forever, because once you pour Water of Life over, it's going to be back alive.\");\n-\t\t\t} else if(status == 9){\n-\t\t\t\tcm.sendNextPrev(\"Even if it someday moves again, it's sad to see them stop altogether. Please be nice to them while they are alive and moving. Feed them well, too. Isn't it nice to know that there's something alive that follows and listens to only you?\");\n-\t\t\t\tcm.dispose();\n-\t\t\t}\n-\t}\n+    } else {\n+            if (status >= 0 && mode == 0) {\n+                    cm.dispose();\n+                    return;\n+            }\n+            if (mode == 1)\n+                    status++;\n+            else\n+                    status--;\n+\n+            if(status == 0){\n+                    cm.sendSimple(\"Hello there, I'm #bMar the Fairy#k of Victoria Island's main disciple. Mar the Fairy summoned me here to see if the pets are being taken care of here in Ludibrium. What can I do for you? \\r\\n#L0##bMy pet has turned back into a doll\\r\\nPlease help me make it move again!#k#l \\r\\n#L1##bTell me more about Pets.#k#l \\r\\n#L2##bHow do I raise Pets?#k#l \\r\\n#L3##bDo Pets die too?#k#l \\r\\n#L4##bWhat are the commands for brown and black kitty?#k#l \\r\\n#L5##bWhat are the commands for brown puppy?#k#l \\r\\n#L6##bWhat are the commands for pink and white bunny?#k#l \\r\\n#L7##bWhat are the commands for Mini Cargo?#k#l \\r\\n#L8##bWhat are the commands for Husky?#k#l \\r\\n#L9##bWhat are the commands for Black Pig?#k#l \\r\\n#L10##bWhat are the commands for Panda#k#l \\r\\n#L11##bWhat are the commands for Dino Boy & Girl?#k#l \\r\\n#L12##bWhat are the commands for Rudolph?#k#l \\r\\n#L13##bWhat are the commands for Monkey?#k#l \\r\\n#L14##bWhat are the commands for Robot?#k#l \\r\\n#L15##bWhat are the commands for Elephant?#k#l \\r\\n#L16##bWhat are the commands for Golden Pig?#k#l \\r\\n#L17##bWhat are the commands for Penguin?#k#l \\r\\n#L18##bWhat are the commands for Mini Yeti?#k#l \\r\\n#L19##bWhat are the commands for Jr. Balrog? \\r\\n#L20##bWhat are the commands for Baby Dragon?#k#l \\r\\n#L21##bWhat are the commands for Green/Red/Blue Dragon?#k#l \\r\\n#L22##bWhat are the commands for Black Dragon?#k#l \\r\\n#L23##bWhat are the commands for Snowman?#k#l \\r\\n#L24##bWhat are the commands for Sun Wu Kong?#k#l \\r\\n#L25##bWhat are the commands for Jr. Reaper?#k#l \\r\\n#L26##bWhat are the commands for Crystal Rudolph?#k#l \\r\\n#L27##bWhat are the commands for Kino?#k#l \\r\\n#L28##bWhat are the commands for White Duck?#k#l \\r\\n#L29##bWhat are the commands for Pink Bean?#k#l \\r\\n#L30##bWhat are the commands for Porcupine?#k#l\");\n+            }\n+            else if(status == 1){\n+                    if(selection == 0){\n+                            cm.sendNext(\"I'm Wisp, continuing on with the studies that my Master Mar the Fairy assigned me. There seems to be a lot of pets even her in Ludibrium. I need to get back to my studies, so if you'll excuse me...\");\n+                            cm.dispose();\n+                    } else if(selection == 1){\n+                            cm.sendNext(\"Hmmmm,you must have a lot of questions regarding the pets. Long ago, a person by the name #bCloy#k, sprayed Water of Life on it, and cast spell on it to create a magical animal. I know it sounds unbelievable, but it's a doll that became an actual living thing. They understand and follow people very well.\");\n+                    } else if(selection == 2){\n+                            cm.sendNext(\"Depending on the command you give, pets can love it, hate, and display other kinds of reactions to it. If you give the pet a command and it follows you well, your closeness goes up. Double click on the pet and you can check the closeness, level, fullness and etc...\");\n+                    } else if(selection == 3){\n+                            cm.sendNext(\"Dying... well, they aren't technically ALIVE per se, so I don't know if dying is the right term to use. They are dolls with my magical power and the power of Water of Life to become a live object. Of course while it's alive, it's just like a live animal...\");\n+                    } else if(selection == 4){\n+                            cm.sendNext(\"These are the commands for #rBrown Kitty and Black Kitty#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bcutie#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 5){\n+                            cm.sendNext(\"These are the commands for #rBrown Puppy#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, baddog, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpee#k (level 10 ~ 30)\\r\\n#btalk, say, chat, bark#k (level 10 ~ 30)\\r\\n#bdown#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 6){\n+                            cm.sendNext(\"These are the commands for #rPink Bunny and White Bunny#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bup, stand#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bhug#k (level 10 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 7){\n+                            cm.sendNext(\"These are the commands for #rMini Cargo#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bup, stand#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpee#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 10 ~ 30)\\r\\n#bthelook, charisma#k (level 10 ~ 30)\\r\\n#bgoodboy, good#k (level 20 ~ 30)\");\n+                            cm.dispose();\t\t\t\t\n+                    } else if(selection == 8){\n+                            cm.sendNext(\"These are the commands for #rHusky#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, baddog, dummy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#bpee#k (level 1 ~ 30)\\r\\n#btalk, say, chat, bark#k (level 10 ~ 30)\\r\\n#bdown#k (level 10 ~ 30)\\r\\n#bup, stand, rise#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 9){\n+                            cm.sendNext(\"These are the commands for #rBlack Pig#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1~30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bhand, up, stand#k (level 1 ~ 30)\\r\\n#btalk, say, chat, hug#k (level 10 ~ 30)\\r\\n#bsmile#k (level 10 ~ 30)\\r\\n#blaugh, smile#k (level 10 ~ 30)\\r\\n#bcharisma, sleep, sleepy, gotobed#k(level 20~30)\");\n+                            cm.dispose();\n+                    } else if(selection == 10){\n+                            cm.sendNext(\"These are the commands for #rPanda#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#bpee#k(level 1 ~ 30)\\r\\n#bup, stand, hug#k (level 1 ~ 30)\\r\\n#btalk, chat#k (level 10 ~ 30)\\r\\n#bplay#k (level 20 ~ 30)\\r\\n#bmeh, bleh#k (level 10 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 11){\n+                            cm.sendNext(\"These are the commands for #rDino Boy and Dino Girl#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no,, stupid, ihateyou, badboy, badgirl#k (evel 1 ~ 30)\\r\\n#biloveyou, dummy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#btalk, chat(level 10 ~ 30)\\r\\n#bsmile, laugh#k (level 1 ~ 30)\\r\\n#bcutie#k (level 10 ~ 30)\\r\\n#bsleep, nap, sleepy#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if(selection == 12){\n+                            cm.sendNext(\"These are the commands for #rRudolph#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~30) \\r\\n#bbad, no, badgirl, badboy#k(level 1~30)\\r\\n#bup, stand#k(level 1 ~ 30) \\r\\n#bstupid, ihateyou, dummy#k(level 1 ~ 30) \\r\\n#bmerryxmas, merrychristmas#k(level 11 ~ 30)\\r\\n#biloveyou#k(level 1 ~ 30)\\r\\n#bpoop#k(level 1 ~ 30)\\r\\n#btalk, say, chat#k(level 11 ~ 30)\\r\\n#blonely, alone, down, rednose#k(level 11~30),\\r\\n#bcutie#k(level 11 ~ 30)\\r\\n#bmush, go#k(level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 13) {\n+                            cm.sendNext(\"These are the commands for #rMonkey#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, rest#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bup, stand#k(level 1 ~ 30)\\r\\n#biloveyou, pee#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 11 ~ 30)\\r\\n#bplay, melong#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 14) {\n+                            cm.sendNext(\"These are the commands for #rRobot#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, stand, rise#k (level 1 ~ 30)\\r\\n#battack, bad, no, badboy#k (level 1 ~ 30)\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#biloveyou, good#k (level 1 ~ 30)\\r\\n#bspeak, disguise#k (level 11 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 15) {\n+                            cm.sendNext(\"These are the commands for #rElephant#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit, rest#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bup, stand, rise#k(level 1 ~ 30)\\r\\n#biloveyou, pee#k (level 1 ~ 30)\\r\\n#btalk, say, chat, play#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 16) {\n+                            cm.sendNext(\"These are the commands for #rGolden Pig#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop, iloveyou#k (level 1 ~ 30)\\r\\n#btalk, say, chat#k (level 11 ~ 30)\\r\\n#bloveme, hugme#k (level 11 ~ 30)\\r\\n#bsleep, sleepy, gotobed#k (level 21 ~ 30)\\r\\n#bimpressed, outofhere#k (level 21 ~ 30)\\r\\n#broll, showmethemoney#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 17) {\n+                            cm.sendNext(\"These are the commands for #rPenguin#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bup, stand, rise#k (level 1 ~ 30)\\r\\n#biloveyou#k (level 1 ~ 30)\\r\\n#btalk, chat, say#k (level 10 ~ 30)\\r\\n#bhug, hugme#k (level 10 ~ 30)\\r\\n#bwing, hand#k (level 10 ~ 30)\\r\\n#bsleep#k (level 20 ~ 30)\\r\\n#bkiss, smooch, muah#k (level 20 ~ 30)\\r\\n#bfly#k (level 20 ~ 30)\\r\\n#bcute, adorable#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 18) {\n+                            cm.sendNext(\"These are the commands for #rMini Yeti#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad, no, badboy, badgirl#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bdance, boogie, shakeit#k (level 1 ~ 30)\\r\\n#bcute, cutie, pretty, adorable#k (level 1 ~ 30)\\r\\n#biloveyou, likeyou, mylove#k (level 1 ~ 30)\\r\\n#btalk, chat, say#k (level 10 ~ 30)\\r\\n#bsleep, nap#k (level 10 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 19) {\n+                            cm.sendNext(\"These are the commands for #rJr. Balrog#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bliedown#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#biloveyou|mylove|likeyou#k (level 1 ~ 30)\\r\\n#bcute|cutie|pretty|adorable#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bsmirk|crooked|laugh#k (level 1 ~ 30)\\r\\n#bmelong#k (level 11 ~ 30)\\r\\n#bgood|thelook|charisma#k (level 11 ~ 30)\\r\\n#bspeak|talk|chat|say#k (level 11 ~ 30)\\r\\n#bsleep|nap|sleepy#k (level 11 ~ 30)\\r\\n#bgas#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 20) {\n+                            cm.sendNext(\"These are the commands for #rBaby Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#biloveyou|loveyou#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 1 ~ 30)\\r\\n#bcutie#k (level 11 ~ 30)\\r\\n#btalk|chat|say#k (level 11 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 11 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 21) {\n+                            cm.sendNext(\"These are the commands for #rGreen/Red/Blue Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 15 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 15 ~ 30)\\r\\n#biloveyou|loveyou#k (level 15 ~ 30)\\r\\n#bpoop#k (level 15 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 15 ~ 30)\\r\\n#btalk|chat|say#k (level 15 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 15 ~ 30)\\r\\n#bchange#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 22) {\n+                            cm.sendNext(\"These are the commands for #rBlack Dragon#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 15 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 15 ~ 30)\\r\\n#biloveyou|loveyou#k (level 15 ~ 30)\\r\\n#bpoop#k (level 15 ~ 30)\\r\\n#bstupid|ihateyou|dummy#k (level 15 ~ 30)\\r\\n#btalk|chat|say#k (level 15 ~ 30)\\r\\n#bsleep|sleepy|gotobed#k (level 15 ~ 30)\\r\\n#bcutie, change#k (level 21 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 23) {\n+                            cm.sendNext(\"These are the commands for #rSnowman#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bstupid, ihateyou, dummy#k (level 1 ~ 30)\\r\\n#bloveyou, mylove, ilikeyou#k (level 1 ~ 30)\\r\\n#bmerrychristmas#k (level 1 ~ 30)\\r\\n#bcutie, adorable, cute, pretty#k (level 1 ~ 30)\\r\\n#bbad, no, badgirl, badboy#k (level 1 ~ 30)\\r\\n#btalk, chat, say/sleep, sleepy, gotobed#k (level 10 ~ 30)\\r\\n#bchang#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 24) {\n+                            cm.sendNext(\"These are the commands for #rSun Wu Kong#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30)\\r\\n#bno,bad,badgirl,badboy#k(level 1 ~ 30) \\r\\n#bpoope#k(level 1 ~ 30) \\r\\n#bcutie,adorable,cute,pretty#k(level 1 ~ 30) \\r\\n#biloveyou,loveyou,luvyou,ilikeyou,mylove#k(level 1 ~ 30) \\r\\n#btalk,chat,say/sleep,sleepy,gotobed#k(level 10 ~ 30) \\r\\n#btransform#k(level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 25) {\n+                            cm.sendNext(\"These are the commands for #rJr. Reaper#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bplaydead, poop#k (level 1 ~ 30)\\r\\n#btalk|chat|say#k (level 1 ~ 30)\\r\\n#biloveyou, hug#k (level 1 ~ 30)\\r\\n#bsmellmyfeet, rockout, boo#k (level 1 ~ 30)\\r\\n#btrickortreat#k (level 1 ~ 30)\\r\\n#bmonstermash#k (level 1 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 26) {\n+                            cm.sendNext(\"These are the commands for #rCrystal Rudolph#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bbleh|joke#k(level 1~30)\\r\\n#bdisguise|transform#k(level 1 ~ 30) \\r\\n#bawesome|feelgood|lalala#k(level 1 ~ 30) \\r\\n#bloveyou|heybabe#k(level 1 ~ 30) \\r\\n#btalk|say|chat#k(level 10 ~ 30) \\r\\n#bsleep|sleepy|nap|gotobed#k(level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 27) {\n+                            cm.sendNext(\"These are the commands for #rKino#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bbad|no|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bpoop#k (level 1 ~ 30)\\r\\n#bsleep|nap|sleepy|gotobed#k(level 1 ~ 30) \\r\\n#btalk|say|chat#k(level 10 ~ 30) \\r\\n#biloveyou|mylove|likeyou#k(level 10 ~ 30) \\r\\n#bmeh|bleh#k(level 10 ~ 30) \\r\\n#bdisguise|change|transform#k(level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 28) {\n+                            cm.sendNext(\"These are the commands for #rWhite Duck#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30) \\r\\n#bbad|no|badgirl|badboy#k(level 1 ~ 30) \\r\\n#bup|stand#k(level 1 ~ 30) \\r\\n#bpoop#k(level 1 ~ 30) \\r\\n#btalk|chat|say#k(level 1 ~ 30) \\r\\n#bhug#k(level 1 ~ 30) \\r\\n#bloveyou#k(level 1 ~ 30) \\r\\n#bcutie#k(level 1 ~ 30) \\r\\n#bsleep#k(level 1 ~ 30) \\r\\n#bsmarty(level 10 ~ 30) \\r\\n#bdance#k (level 20 ~ 30) \\r\\n#bswan#k(level 20 ~ 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 29){\n+                            cm.sendNext(\"These are the commands for #rPink Bean#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k(level 1 ~ 30) \\r\\n#bbad|no|badgirl|badboy|poop#k(level 1 ~ 30) \\r\\n#blazy|dummy|ihateyoutalk|chat|say|mumbleiloveyou|hugme|loveyou|#k(level 1 ~ 30) \\r\\n#bshake|music|charmbleh|joke|boo#k(level 20 ~ 30) \\r\\n#bgotobed|sleep|sleepypoke|stinky|dummy|ihateyou#k(level 20 ~ 30)\\r\\n#bkongkong#k(level 30)\");\n+                            cm.dispose();\n+                    } else if (selection == 30){\n+                            cm.sendNext(\"These are the commands for #rPorcupine#k. The level mentioned next to the command shows the pet level required for it to respond.\\r\\n#bsit#k (level 1 ~ 30)\\r\\n#bno|bad|badgirl|badboy#k (level 1 ~ 30)\\r\\n#bhugcushion|sleep|knit|poop#k (level 1 ~ 30)\\r\\n#bcomb|beach#k (level 10 ~ 30)\\r\\n#btreeninja|dart#k (level 20 ~ 30)\");\n+                            cm.dispose();\n+                    }\n+            } else if(status == 2){\n+                    cm.sendNextPrev(\"But Water of Life only comes out little at the very bottom of the World Tree, so those babies can't be alive forever... I know, it's very unfortunate... but even if it becomes a doll again they can be brought back to life so be good to it while you're with it.\");\n+            } else if(status == 3){\n+                    cm.sendNextPrev(\"Oh yeah, they'll react when you give them special commands. You can scold them, love them.. it all depends on how you take care of them. They are afraid to leave their masters so be nice to them, show them love. They can get sad and lonely fast..\");\n+                    cm.dispose();\n+            } else if(status == 4){\n+                    cm.sendNextPrev(\"Talk to the pet, pay attention to it and its closeness level will go up and eventually his overall level will go up too. As the closeness rises, the pet's overall level will rise soon after. As the overall level rises, one day the pet may even talk like a person a little bit, so try hard raising it. Of course it won't be easy doing so...\");\n+            } else if(status == 5){\n+                    cm.sendNextPrev(\"It may be a live doll but they also have life so they can feel the hunger too. #bFullness#k shows the level of hunger the pet's in. 100 is the max, and the lower it gets, it means that the pet is getting hungrier. After a while, it won't even follow your command and be on the offensive, so watch out over that.\");\n+            } else if(status == 6){\n+                    cm.sendNextPrev(\"That's right! Pets can't eat the normal human food. Instead a teddy bear in Ludibrium called #bPatricia#k sells #bPet Food#k so if you need food for your pet, find #bPatricia#k It'll be a good idea to buy the food in advance and feed the pet before it gets really hungry.\");\n+            } else if(status == 7){\n+                    cm.sendNextPrev(\"Oh, and if you don't feed the pet for a long period of time, it goes back home by itself. You can take it out of its home and feed it but it's not really good for the pet's health, so try feeding him on a regular basis so it doesn't go down to that level, alright? I think this will do.\");\n+                    cm.dispose();\n+            } else if(status == 8){\n+                    cm.sendNextPrev(\"After some time... that's correct, they stop moving. They just turn back to being a doll, after the effect of magic dies down and Water of Life dries out. But that doesn't mean it's stopped forever, because once you pour Water of Life over, it's going to be back alive.\");\n+            } else if(status == 9){\n+                    cm.sendNextPrev(\"Even if it someday moves again, it's sad to see them stop altogether. Please be nice to them while they are alive and moving. Feed them well, too. Isn't it nice to know that there's something alive that follows and listens to only you?\");\n+                    cm.dispose();\n+            }\n+    }\n }\n\\ No newline at end of file"}, {"sha": "3a90542a8ccb4c8e5c991810c56a4c60849194c0", "filename": "scripts/npc/2041023.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2041023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2041023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2041023.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -19,7 +19,7 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-//First version by Moogra\n+//First version thanks to Moogra\n \n /**\n  * @author: Ronan"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050014.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050014.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050014.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050014.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050015.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050015.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050015.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050015.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050016.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050016.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050017.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050017.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050018.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050018.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "480336712623fa9f10db7877e9a4bf337e119cf9", "filename": "scripts/npc/2050019.js", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2050019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050019.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,60 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Meteorite\n+\t@Author RonanLana (Ronan)\n+ */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        if(cm.isQuestStarted(3421)) {\n+                                var meteoriteId = cm.getNpc() - 2050014;\n+                                \n+                                var progress = cm.getQuestProgress(3421, 0);\n+                                if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n+                                        progress |= (1 << meteoriteId);\n+                                        \n+                                        cm.gainItem(4031117, 1);\n+                                        cm.setQuestProgress(3421, 0, progress);\n+                                }\n+                        }\n+                        \n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "d709f1787e746e529d2a5ee84b1e9cb944553c0e", "filename": "scripts/npc/2081005.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2081005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2081005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2081005.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -19,7 +19,7 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-//Fixed by Moogra, Ronan\n+//@Author Moogra, Ronan\n //Fixed grammar, javascript syntax\n \n importPackage(Packages.client);"}, {"sha": "f7d3e7e96c49bfbc89b625601ec1427d290a2222", "filename": "scripts/npc/2083001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2083001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2083001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2083001.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -96,7 +96,7 @@ function action(mode, type, selection) {\n                         }\n                 } else {\n                         if(!cm.isEventLeader()) {\n-                                cm.sendOk(\"Only your event leader is allowed to interact with the Schedule.\");\n+                                cm.sendOk(\"Only your party leader is allowed to interact with the Schedule.\");\n                         } else if(cm.getMapId() == 240050100) {\n                                 if(cm.haveItem(4001087) && cm.haveItem(4001088) && cm.haveItem(4001089) && cm.haveItem(4001090) && cm.haveItem(4001091)) {\n                                         cm.gainItem(4001087, -1);"}, {"sha": "6194b60125fdb6ae2cb64a956ea03bdd88e8ddff", "filename": "scripts/npc/2083004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2083004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2083004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2083004.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n */\n /*Mark of the Squad\n  *\n- *@author SharpAceX (Alan)\n+ *@author Alan (SharpAceX)\n  *@author Ronan\n  */\n importPackage(Packages.server.expeditions);"}, {"sha": "e7dc6ff8e0cfd3624680c458ffcb3850655ede1e", "filename": "scripts/npc/2090004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2090004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2090004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2090004.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* @author aaroncsn(MapleSea Like)\n+/* @author aaroncsn <MapleSea Like>\n  * @author Ronan\n \tNPC Name: \t\tMr. Do\n \tMap(s): \t\tMu Lung: Mu Lung(2500000000)"}, {"sha": "e29288247e223a17826a3d60ff99ff51ce6e7615", "filename": "scripts/npc/2094002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2094002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2094002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2094002.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -29,7 +29,7 @@ function action(mode, type, selection) {\n         var eim = cm.getEventInstance();\n         if (eim == null) {\n             cm.warp(251010404,0);\n-            cm.sendNext(\"How are you even here without being registered on an event?\");\n+            cm.sendNext(\"How are you even here without being registered on an instance?\");\n             cm.dispose();\n             return;\n         }"}, {"sha": "c1143ca4b3933bd9f16ea32c323a153a9afee538", "filename": "scripts/npc/2100001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100001.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tMuhammad\n \tMap(s): \t\tAriant:The Town of Ariant(260000200)\n \tDescription: \tJewel Refiner"}, {"sha": "2319919aa920a2e442ab0af0065dd5e0eb5b7af8", "filename": "scripts/npc/2100005.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100005.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tShati\n \tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n \tDescription: \tAssistant Hairdresser"}, {"sha": "54e0e80a1dd830014464c7addd52ead3d809c0ea", "filename": "scripts/npc/2100006.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100006.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tMazra\n \tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n \tDescription: \tHair Salon Owner"}, {"sha": "baa30118f5f44d063c5f37e9070d88740fba4d58", "filename": "scripts/npc/2100007.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100007.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)(Incomplete- Needs skin id)\n+/* Author: aaroncsn <(MapleSea Like)(Incomplete- Needs skin id)>\n \tNPC Name: \t\tLaila\n \tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n \tDescription: \tSkin Care Specialist"}, {"sha": "8f54c40b88d9968d4f7a27d25f3fa6192edfb38b", "filename": "scripts/npc/2100008.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100008.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tBadr\n \tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n \tDescription: \tAriant Plastic Surgery"}, {"sha": "394a5e73f537d8a09ea8fe09eccfe0fe73aaa144", "filename": "scripts/npc/2100009.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2100009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2100009.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn (MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tAldin\n \tMap(s): \t\tThe Burning Road: Ariant(2600000000)\n \tDescription: \tAriant Plastic Surgery"}, {"sha": "d1e2e42606088b6115bab96031c14f481768a890", "filename": "scripts/npc/2101013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2101013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2101013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2101013.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn(MapleSea Like)\n+/* Author: aaroncsn <MapleSea Like>\n \tNPC Name: \t\tKarcasa\n \tMap(s): \t\tThe Burning Sands: Tents of the Entertainers(260010600)\n \tDescription: \t\tWarps to Victoria Island"}, {"sha": "5c3c3de3636861857df0d1e06153eb0ecbd510e2", "filename": "scripts/npc/2110005.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2110005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2110005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2110005.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,7 +23,7 @@\n -- Odin JavaScript --------------------------------------------------------------------------------\n     Camel Cab - Magatia (GMS Like)\n -- Version Info -----------------------------------------------------------------------------------\n-    1.3 - Actually fixed by SharpAceX (Alan)\n+    1.3 - Actually fixed by Alan (SharpAceX)\n     1.2 - Fixed and recoded by Moogra\n     1.1 - Shortened by Moogra\n     1.0 - First Version by Maple4U, who actually can't code at all"}, {"sha": "d66fdcd8be217981ec295a0a3311eb8816053868", "filename": "scripts/npc/2131000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2131000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2131000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2131000.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn(MapleSea Like)(Incomplete)\n+/* Author: aaroncsn <(MapleSea Like)(Incomplete)>\n \tNPC Name: \t\tAthena Pierce\n \tMap(s): \t\tAltair Camp: Conference Hall(300000010)\n \tDescription: \t\tUnknown"}, {"sha": "297be8edcff9ad863607de306cee602a41cfba0a", "filename": "scripts/npc/2131002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2131002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2131002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2131002.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn(MapleSea Like)(Incomplete)\n+/* Author: aaroncsn <(MapleSea Like)(Incomplete)>\n \tNPC Name: \t\tEuryth\n \tMap(s): \t\tElin Forest:Altair Camp(300000000)\n \tDescription: \t\tUnknown"}, {"sha": "ca0dfa95b2abc2c5c95fd7284088c3b59ffd8f85", "filename": "scripts/npc/2132000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2132000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2132000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2132000.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,4 +1,4 @@\n-/* Author: aaroncsn(MapleSea Like)(Incomplete)\n+/* Author: aaroncsn <(MapleSea Like)(Incomplete)>\n \tNPC Name: \t\tKanderun\n \tMap(s): \t\tElin Forest:Entrance to Rocky Mountain(300010400)\n \tDescription: \t\tUnknown"}, {"sha": "8506642d0fb731cfb4372f6f4dd28813d928c316", "filename": "scripts/npc/2141002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2141002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/2141002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2141002.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -43,7 +43,7 @@ function action(mode, type, selection) {\n                     cm.warp(270050000);\n                 }\n                 else {\n-                    cm.sendOk(\"You cannot receive an event prize without having an empty room in your EQUIP, USE, SET-UP and ETC inventory.\");\n+                    cm.sendOk(\"You cannot receive an instance prize without having an empty room in your EQUIP, USE, SET-UP and ETC inventory.\");\n                 }\n                 \n                 cm.dispose();"}, {"sha": "880fef9c347baf7143c426b5f49c508e7af260fb", "filename": "scripts/npc/9000037.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9000037.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9000037.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9000037.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -89,7 +89,7 @@ function action(mode, type, selection) {\n                                         cm.sendOk(\"Your party completed such an astounding feat coming this far, #byou have defeated all the bosses#k, congratulations! Now I will be handing your reward as you are being transported out...\");\n                                 }\n                                 else {\n-                                        cm.sendOk(\"For #bdefeating all bosses#k in this event, congratulations! You will now receive a prize that matches your performance here as I warp you out.\");\n+                                        cm.sendOk(\"For #bdefeating all bosses#k in this instance, congratulations! You will now receive a prize that matches your performance here as I warp you out.\");\n                                 }\n                         }\n                         else if(state == 2) {\n@@ -109,7 +109,7 @@ function action(mode, type, selection) {\n                                         return;\n                                 }\n                         } else if(state == 1) {\n-                                cm.sendYesNo(\"Do you wish to abandon this event?\");\n+                                cm.sendYesNo(\"Do you wish to abandon this instance?\");\n                         }\n                         else {\n                                 em = cm.getEventManager(\"BossRushPQ\");\n@@ -174,7 +174,7 @@ function action(mode, type, selection) {\n                                         cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n                                         cm.dispose();\n                                 } else {\n-                                        cm.sendOk(\"#e#b<Party Quest: Boss Rush>#k#n\\r\\nBrave adventurers from all over the places travels here to test their skills and abilities in combat, as they face even more powerful bosses from MapleStory. Join forces with fellow adventurers or face all the burden by yourself and receive all the glory, it is up to you. REWARDS are given accordingly to how far the adventurers reach and extra prizes may are given to a random member of the party, all attributed at the end of an expedition.\\r\\n\\r\\nThis event also supports #bmultiple lobbies for matchmaking several ranges of team levels#k at once: team up with players with lower level if you want better chances to swiftly set up a boss rush for your team.\");\n+                                        cm.sendOk(\"#e#b<Party Quest: Boss Rush>#k#n\\r\\nBrave adventurers from all over the places travels here to test their skills and abilities in combat, as they face even more powerful bosses from MapleStory. Join forces with fellow adventurers or face all the burden by yourself and receive all the glory, it is up to you. REWARDS are given accordingly to how far the adventurers reach and extra prizes may are given to a random member of the party, all attributed at the end of an expedition.\\r\\n\\r\\nThis instance also supports #bmultiple lobbies for matchmaking several ranges of team levels#k at once: team up with players with lower level if you want better chances to swiftly set up a boss rush for your team.\");\n                                         cm.dispose();\n                                 }\n                         }"}, {"sha": "81c853e49cc43657e5da3e2447c1634b12e3d8dd", "filename": "scripts/npc/9001108.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9001108.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9001108.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9001108.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n /**\n-* @Author : iAkira/Kevintjuh93\n+* @Author : iAkira, Kevintjuh93\n **/\n var status = 0; \n var selected = 0;"}, {"sha": "9d5c33b8f5709f99fcbe4bb1aba596d7d928d22f", "filename": "scripts/npc/9040009.js", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9040009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9040009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9040009.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -66,14 +66,13 @@ function action(mode, type, selection) {\n                         } else {\n                             stage = parseInt(eim.getProperty(\"stage1phase\"));\n                         }\n+                        \n                         if (stage == 1) {\n                             cm.sendOk(\"In this challenge, I shall show a pattern on the statues around me. When I give the word, repeat the pattern to me to proceed.\");\n-                        }\n-                        else {\n+                        } else {\n                             cm.sendOk(\"I shall now present a more difficult puzzle for you. Good luck.\");\n                         }\n-                    }\n-                    else if (eim.getProperty(\"stage1status\").equals(\"active\")) {\n+                    } else if (eim.getProperty(\"stage1status\").equals(\"active\")) {\n                         stage = parseInt(eim.getProperty(\"stage1phase\"));\n                         \n                         if (eim.getProperty(\"stage1combo\").equals(eim.getProperty(\"stage1guess\"))) {\n@@ -97,8 +96,7 @@ function action(mode, type, selection) {\n                         }\n                         eim.setProperty(\"stage1status\", \"waiting\");\n                         cm.dispose();\n-                    }\n-                    else {\n+                    } else {\n                         cm.sendOk(\"The statues are working on the pattern. Please wait.\");\n                         cm.dispose();\n                     }\n@@ -116,7 +114,7 @@ function action(mode, type, selection) {\n                     cm.dispose();\n                 }\n             } else {\n-                cm.sendOk(\"I need the leader of this event to speak with me, nobody else.\");\n+                cm.sendOk(\"I need the leader of this instance to speak with me, nobody else.\");\n                 cm.dispose();\n             }\n         }\n@@ -134,7 +132,7 @@ function getReactors() {\n             reactors.push(mo.getObjectId());\n         }\n     }\n-        \n+    \n     return reactors;\n }\n "}, {"sha": "802ea6f6286ed0da2503c13cf82f19e01a9dc5c2", "filename": "scripts/npc/9040010.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9040010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9040010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9040010.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -43,7 +43,7 @@ function start() {\n             }\n         }\n         else {\n-            cm.sendOk(\"This is your final challenge. Defeat the evil lurking within the Rubian and let your event leader return it to me. That is all.\");\n+            cm.sendOk(\"This is your final challenge. Defeat the evil lurking within the Rubian and let your instance leader return it to me. That is all.\");\n         }\n     }\n     else"}, {"sha": "eadcf5837e29a11428972820d5375754e7186b7f", "filename": "scripts/npc/9103000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9103000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9103000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9103000.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -54,7 +54,7 @@ function action(mode, type, selection) {\n                 if (status == 0) {\n                         if(cm.isEventLeader()) {\n                                 if(!cm.getEventInstance().isEventTeamTogether()) {\n-                                        cm.sendOk(\"One or more event team members is missing, please wait for them to reach here first.\");\n+                                        cm.sendOk(\"One or more instance team members is missing, please wait for them to reach here first.\");\n                                         cm.dispose();\n                                 }\n                                 else if(cm.hasItem(4001106, 30)) {"}, {"sha": "d884e0b67b8fa9f39377db989ce3d92049f747c2", "filename": "scripts/npc/9201042.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201042.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201042.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201042.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -74,7 +74,7 @@ function action(mode, type, selection) {\n                 advance = true;\n     \n                 if(status == 0) {\n-                        cm.sendNext(\"Hi there, how is it going? Since you're passing by Amoria, have you heard about the event my brother Amos is hosting? It is the #bAmorian Challenge#k, an event for everyone above level 40.\\r\\n\\r\\nThere, you may find the #i4031543# #i4031544# #i4031545# #bWish Tickets#k that can be brought here to redeem prizes.\");\n+                        cm.sendNext(\"Hi there, how is it going? Since you're passing by Amoria, have you heard about the instance my brother Amos is hosting? It is the #bAmorian Challenge#k, an instance for everyone above level 40.\\r\\n\\r\\nThere, you may find the #i4031543# #i4031544# #i4031545# #bWish Tickets#k that can be brought here to redeem prizes.\");\n                 } else if(status == 1) {\n                         var listStr = \"\";\n                         for(var i = 0; i < wishPrizes.length; i++) {"}, {"sha": "d1b674291eef3bc5853d3c96dd5073d7ecd6bd6c", "filename": "scripts/npc/9201048.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201048.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201048.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201048.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -83,7 +83,7 @@ function action(mode, type, selection) {\n                                 cm.sendOk(\"Try using a Super Megaphone or asking your buddies or guild to join!\");\n                                 cm.dispose();\n                         } else {\n-                                cm.sendOk(\"#e#b<Party Quest: Amorian Challenge>#k#n\\r\\nI am Amos, hoster of the well-round famed Amorian Challenge. The event consist of many team puzzles, where cooperation is the fundamental key for progress. Team up with other players to attempt for the bonus stage, where many goodies can be obtained at the end of the event. If an all-couple party is formed, they can get even better prizes on the extra bonus stage.\");\n+                                cm.sendOk(\"#e#b<Party Quest: Amorian Challenge>#k#n\\r\\nI am Amos, hoster of the well-round famed Amorian Challenge. The instance consist of many team puzzles, where cooperation is the fundamental key for progress. Team up with other players to attempt for the bonus stage, where many goodies can be obtained at the end of the instance. If an all-couple party is formed, they can get even better prizes on the extra bonus stage.\");\n                                 cm.dispose();\n                         }\n                 }"}, {"sha": "d513e4e4fb0e5d1da3e29c33201a9f9ca187e88b", "filename": "scripts/npc/9201113.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201113.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201113.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201113.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n */\n /*Jack\n  *\n- *@author SharpAceX (Alan)\n+ *@author Alan (SharpAceX)\n  *@author Ronan\n  */\n importPackage(Packages.server.expeditions);"}, {"sha": "d88c282fb8f6a79e01ed3a4560246681b8e7a087", "filename": "scripts/npc/9201123.js", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201123.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201123.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201123.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,11 +23,13 @@\n \n     Version\n     |- 1.0 by Jayd\n+    |- 1.1 by Ronan (check job requirements)\n  */\n \n var status;\n var map = 102000003;\n var job = \"Warrior\";\n+var jobType = 1;\n var no = \"Come back to me if you decided to be a #b\"+job+\"#k.\";\n \n function start() {\n@@ -52,7 +54,12 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if (cm.getJob() == \"BEGINNER\") {\n-                cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType)) {\n+                    cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                } else {\n+                    cm.sendOk(\"If you want to be a #b\"+job+\"#k, train yourself further until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k.\");\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"You're much stronger now. Keep training!\");\n                 cm.dispose();"}, {"sha": "8a88f420d960b68269eced340a5593e9863e20db", "filename": "scripts/npc/9201124.js", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201124.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201124.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201124.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,11 +23,14 @@\n \n     Version\n     |- 1.0 by Jayd\n+    |- 1.1 by Ronan (check job requirements)\n  */\n \n var status;\n var map = 100000201;\n var job = \"Bowman\";\n+var jobType = 3;\n+var no = \"Come back to me if you decided to be a #b\"+job+\"#k.\";\n \n function start() {\n     status = -1;\n@@ -36,10 +39,11 @@ function start() {\n \n function action(mode, type, selection) {\n     if (mode == -1) {\n+        cm.sendOk(no);\n         cm.dispose();\n     } else {\n         if (mode == 0 && type > 0) {\n-            cm.sendOk(\"Come back to me if you decided to be a #b\"+job+\"#k.\");\n+            cm.sendOk(no);\n             cm.dispose();\n         }\n \n@@ -50,7 +54,12 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if (cm.getJob() == \"BEGINNER\") {\n-                cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType)) {\n+                    cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                } else {\n+                    cm.sendOk(\"If you want to be a #b\"+job+\"#k, train yourself further until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k.\");\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"You're much stronger now. Keep training!\");\n                 cm.dispose();"}, {"sha": "043316878bf7155fe715984bdcee991e2ca1e4da", "filename": "scripts/npc/9201125.js", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201125.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201125.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201125.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,11 +23,13 @@\n \n     Version\n     |- 1.0 by Jayd\n+    |- 1.1 by Ronan (check job requirements)\n  */\n \n var status;\n var map = 101000003;\n var job = \"Magician\";\n+var jobType = 2;\n var no = \"Come back to me if you decided to be a #b\"+job+\"#k.\";\n \n function start() {\n@@ -52,7 +54,12 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if (cm.getJob() == \"BEGINNER\") {\n-                cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                if (cm.getLevel() >= 8 && cm.canGetFirstJob(jobType)) {\n+                    cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                } else {\n+                    cm.sendOk(\"If you want to be a #b\"+job+\"#k, train yourself further until you reach #blevel 8, \" + cm.getFirstJobStatRequirement(jobType) + \"#k.\");\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"You're much stronger now. Keep training!\");\n                 cm.dispose();"}, {"sha": "98e4a1cd2069bb8065b6473b1237c887c628faf9", "filename": "scripts/npc/9201126.js", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201126.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201126.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201126.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,11 +23,13 @@\n \n     Version\n     |- 1.0 by Jayd\n+    |- 1.1 by Ronan (check job requirements)\n  */\n \n var status;\n var map = 103000003;\n var job = \"Thief\";\n+var jobType = 4;\n var no = \"Come back to me if you decided to be a #b\"+job+\"#k.\";\n \n function start() {\n@@ -52,7 +54,12 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if (cm.getJob() == \"BEGINNER\") {\n-                cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType)) {\n+                    cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                } else {\n+                    cm.sendOk(\"If you want to be a #b\"+job+\"#k, train yourself further until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k.\");\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"You're much stronger now. Keep training!\");\n                 cm.dispose();"}, {"sha": "273a394437310ad5122b2a10250ab0975b8f74e7", "filename": "scripts/npc/9201127.js", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201127.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9201127.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201127.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,11 +23,13 @@\n \n     Version\n     |- 1.0 by Jayd\n+    |- 1.1 by Ronan (check job requirements)\n  */\n \n var status;\n var map = 120000101;\n var job = \"Pirate\";\n+var jobType = 5;\n var no = \"Come back to me if you decided to be a #b\"+job+\"#k.\";\n \n function start() {\n@@ -52,7 +54,12 @@ function action(mode, type, selection) {\n \n         if(status == 0) {\n             if (cm.getJob() == \"BEGINNER\") {\n-                cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                if (cm.getLevel() >= 10 && cm.canGetFirstJob(jobType)) {\n+                    cm.sendYesNo(\"Hey #h #, I can send you to #b#m\"+map+\"##k if you want to be a #b\"+job+\"#k. Do you want to go now?\");\n+                } else {\n+                    cm.sendOk(\"If you want to be a #b\"+job+\"#k, train yourself further until you reach #blevel 10, \" + cm.getFirstJobStatRequirement(jobType) + \"#k.\");\n+                    cm.dispose();\n+                }\n             } else {\n                 cm.sendOk(\"You're much stronger now. Keep training!\");\n                 cm.dispose();"}, {"sha": "a84ced3482d07f6419c7bcc3114ab95e7ad61894", "filename": "scripts/npc/9270047.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9270047.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9270047.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9270047.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -20,7 +20,7 @@\n */\n /*Aldol\n  *\n- *@author SharpAceX (Alan)\n+ *@author Alan (SharpAceX)\n  *@author Ronan\n  */\n importPackage(Packages.server.expeditions);"}, {"sha": "fa84fbf5111e9038c56538e6ff11f0bb7977ea76", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -41,7 +41,7 @@ function addFeature(feature) {\n function writeFeatureTab_PQs() {\n         addFeature(\"HPQ/KPQ/LPQ/LMPQ/OPQ/APQ/EllinPQ/PiratePQ.\");\n         addFeature(\"RnJPQ/HorntailPQ/TreasurePQ/ElnathPQ/HolidayPQ.\");\n-        addFeature(\"CWKPQ as Expedition-based event.\");\n+        addFeature(\"CWKPQ as Expedition-based instance.\");\n         addFeature(\"Scarga/Horntail/Showa/Balrog/Zakum/Pinkbean.\");\n         addFeature(\"GuildPQ & queue with multi-lobby systems available.\");\n         addFeature(\"Brand-new PQs: BossRushPQ, CafePQ.\");\n@@ -131,6 +131,7 @@ function writeFeatureTab_MonstersMapsReactors() {\n }\n \n function writeFeatureTab_PQpotentials() {\n+        addFeature(\"Advanced and well-safe PQ registration system.\");\n         addFeature(\"Lobby system: Same channel, multiple PQ instances.\");\n         addFeature(\"Exped system: Many parties can join a same instance.\");\n         addFeature(\"Guild queue: guild registration for the GPQ.\");\n@@ -144,6 +145,7 @@ function writeFeatureTab_Playerpotentials() {\n         addFeature(\"Gain fame by quests.\");\n         addFeature(\"Pet evolutions functional (not GMS-like).\");\n         addFeature(\"Reviewed keybinding system.\");\n+        addFeature(\"Character slots per world/server-wide.\");\n }\n \n function writeFeatureTab_Serverpotentials() {\n@@ -162,6 +164,7 @@ function writeFeatureTab_Serverpotentials() {\n         addFeature(\"Pet pickup gives preference to player attacks.\");\n         addFeature(\"Channel capacity bar and worlds with capacity check.\");\n         addFeature(\"Diseases visible for others, even after changing maps.\");\n+        addFeature(\"Persistent diseases. Players keep their status on login.\");\n         addFeature(\"Poison damage value visible for other players.\");\n         addFeature(\"M. book announcer displays info based on demand.\");\n         addFeature(\"Custom jail system.\");"}, {"sha": "6a3c5f3c0abc28fae66e3882bf0c5b6f5d4c5d83", "filename": "scripts/npc/commands.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/commands.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/commands.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/commands.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -162,6 +162,9 @@ function writeHeavenMSCommandsLv3() {    //GM\n         addCommand(\"npc\", \"\");\n         addCommand(\"face\", \"\");\n         addCommand(\"hair\", \"\");\n+        addCommand(\"startquest\", \"\");\n+        addCommand(\"completequest\", \"\");\n+        addCommand(\"resetquest\", \"\");\n }\n \n function writeHeavenMSCommandsLv2() {    //JrGM"}, {"sha": "ac94890497c017ef3cb4917a16504e89e2c60817", "filename": "scripts/npc/credits.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/credits.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/npc/credits.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/credits.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -36,6 +36,7 @@ function writeServerStaff_MapleNext() {\n function writeServerStaff_HeavenMS() {\n         addPerson(\"Ronan\", \"Developer\");\n         addPerson(\"Vcoc\", \"Freelance Developer\");\n+        addPerson(\"Thora\", \"Contributor\");\n         \n         setHistory(2015, 2018);\n }"}, {"sha": "382fab3263c8cff3aae8d7e0f41349d2b813a6b8", "filename": "scripts/portal/TD_neo_inTree.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/portal/TD_neo_inTree.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/portal/TD_neo_inTree.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_neo_inTree.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1,7 +1,7 @@\n function enter(pi) {\n     var nex = pi.getEventManager(\"GuardianNex\");\n     if(nex == null) {\n-        pi.message(\"Guardian Nex event encontered an error and is unavailable.\");\n+        pi.message(\"Guardian Nex challenge encountered an error and is unavailable.\");\n         return false;\n     }\n     "}, {"sha": "024677c1869a3a4a411140978dceed510471f4df", "filename": "scripts/portal/raid_rest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/portal/raid_rest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/portal/raid_rest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/raid_rest.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -37,7 +37,7 @@ function enter(pi) {\n                 return true;\n         }\n         else {\n-                pi.message(\"Make a room available on all EQUIP, USE, SET-UP and ETC inventory to claim an event prize.\");\n+                pi.message(\"Make a room available on all EQUIP, USE, SET-UP and ETC inventory to claim an instance prize.\");\n                 return false;\n         }\n }\n\\ No newline at end of file"}, {"sha": "e7a4a892424571985a4aa3db31c7aca8b993b5e7", "filename": "scripts/quest/1021.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/quest/1021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/quest/1021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/1021.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -19,7 +19,7 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-/* Author: Xterminator (Modified by XxOsirisxX)\n+/* Author: Xterminator <Modified by XxOsirisxX>\n \tNPC Name: \t\tRoger\n \tMap(s): \t\tMaple Road : Lower level of the Training Camp (2)\n \tDescription: \t\tQuest - Roger's Apple"}, {"sha": "a9a4a35dad4e0a272b608cadf73bed4f74587348", "filename": "scripts/quest/7103.js", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/quest/7103.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/quest/7103.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/7103.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -0,0 +1,64 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Papulatus - 7103\n+ */\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    if (mode == -1) {\n+        qm.sendOk(\"Oh really. Do you need more time? I'm fully confident that you'll help me out before the Time Sphere is formed.\");\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.sendOk(\"Oh really. Do you need more time? I'm fully confident that you'll help me out before the Time Sphere is formed.\");\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendYesNo(\"Only thing we have to do now ...is to make #o8500002# disappear forever... are you ready?\");\n+        } else if (status == 1) {\n+            qm.sendNext(\"I'll explain to you what you need to do from here on out. \\r\\nTo enter the power-generating room, you'll need to pass either #bForgotten Passage#k or the #bWarped Passage#k. Once you defeat whichever monster that is guarding the passage, you can obtain #b#t4031172:##k, which is needed to enter the power-generating room.\");\n+        } else if (status == 2) {\n+            qm.sendNextPrev(\"Then enter the room through the door in the middle. It's going to be MUCH quieter than you imagined. The Time Sphere should be hidden in a state undetectable in our eyes... but if you seal up the crack in dimension, the #o8500002#, panicking because its exit route is sealed up, will make its appearance there.\");\n+        } else if (status == 3) {\n+            if (!qm.haveItem(4031179, 1)) {\n+                if (!qm.canHold(4031179, 1)) {\n+                    qm.sendOk(\"Please have an #rETC slot available#k to start this quest.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+                \n+                qm.gainItem(4031179, 1);\n+            }\n+            \n+            qm.sendAcceptDecline(\"Drop the #b#t4031179:##k that I returned to you to seal up whatever crack you see that #o8500002# may have used to enter this dimension in the first place. Then it'll come out of the Time Sphere and show everyone its true appearance. Please, please kill it and then come back. \\r\\n\\r\\nCollect #r1 #t4031172:##k\\r\\nEliminate #r#o8500001##k\");\n+        } else if (status == 4) {\n+            qm.forceStartQuest();\n+            qm.dispose();\n+        }\n+    }\n+}"}, {"sha": "0293f00842a679669967beff0fb21c9da019df8b", "filename": "scripts/reactor/9208000.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9208000.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -40,7 +40,7 @@ function act() {\n                 if(!rm.getReactor().isRecentHitFromAttack()) {\n                     var prevCombo = eim.getProperty(\"stage1combo\");\n \n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevCombo += padWithZeroes(n, 3);\n \n                     eim.setProperty(\"stage1combo\",prevCombo);\n@@ -53,7 +53,7 @@ function act() {\n             } else { //active\n                 var prevGuess = \"\" + eim.getProperty(\"stage1guess\");\n                 if (prevGuess.length != (3 * (stage + 3))) {\n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevGuess += padWithZeroes(n, 3);\n                     \n                     eim.setProperty(\"stage1guess\",prevGuess);"}, {"sha": "92f8b02a655576fd94427e6b3823b863cd8fea5d", "filename": "scripts/reactor/9208001.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9208001.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -42,7 +42,7 @@ function act() {\n                 if(!rm.getReactor().isRecentHitFromAttack()) {\n                     var prevCombo = eim.getProperty(\"stage1combo\");\n \n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevCombo += padWithZeroes(n, 3);\n \n                     eim.setProperty(\"stage1combo\",prevCombo);\n@@ -55,7 +55,7 @@ function act() {\n             } else { //active\n                 var prevGuess = \"\" + eim.getProperty(\"stage1guess\");\n                 if (prevGuess.length != (3 * (stage + 3))) {\n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevGuess += padWithZeroes(n, 3);\n                     \n                     eim.setProperty(\"stage1guess\",prevGuess);"}, {"sha": "ee570945dde3b9928ea6fdde0add86773468d0cc", "filename": "scripts/reactor/9208002.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/scripts/reactor/9208002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/9208002.js?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -39,7 +39,7 @@ function act() {\n             if (status.equals(\"display\")) {\n                 if(!rm.getReactor().isRecentHitFromAttack()) {\n                     var prevCombo = eim.getProperty(\"stage1combo\");\n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevCombo += padWithZeroes(n, 3);\n \n                     eim.setProperty(\"stage1combo\",prevCombo);\n@@ -52,7 +52,7 @@ function act() {\n             } else { //active\n                 var prevGuess = \"\" + eim.getProperty(\"stage1guess\");\n                 if (prevGuess.length != (3 * (stage + 3))) {\n-                    var n = \"\" + rm.getReactor().getObjectId();\n+                    var n = \"\" + (rm.getReactor().getObjectId() % 1000);\n                     prevGuess += padWithZeroes(n, 3);\n                 \n                     eim.setProperty(\"stage1guess\",prevGuess);"}, {"sha": "f5192881d44f4498bdcc32808a4388dad06eac50", "filename": "sql/db_database.sql", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -25,7 +25,6 @@ CREATE TABLE IF NOT EXISTS `accounts` (\n   `birthday` date NOT NULL DEFAULT '0000-00-00',\n   `banned` tinyint(1) NOT NULL DEFAULT '0',\n   `banreason` text,\n-  `gm` tinyint(1) NOT NULL DEFAULT '0',\n   `macs` tinytext,\n   `nxCredit` int(11) DEFAULT NULL,\n   `maplePoint` int(11) DEFAULT NULL,\n@@ -16474,6 +16473,16 @@ CREATE TABLE IF NOT EXISTS `petignores` (\n   PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n+CREATE TABLE IF NOT EXISTS `playerdiseases` (\n+  `id` int(11) NOT NULL AUTO_INCREMENT,\n+  `charid` int(11) NOT NULL,\n+  `disease` int(11) NOT NULL,\n+  `mobskillid` int(11) NOT NULL,\n+  `mobskilllv` int(11) NOT NULL,\n+  `length` int(11) NOT NULL DEFAULT '1',\n+  PRIMARY KEY (`id`)\n+) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+\n CREATE TABLE IF NOT EXISTS `playernpcs` (\n   `id` int(11) NOT NULL AUTO_INCREMENT,\n   `name` varchar(13) NOT NULL,"}, {"sha": "994d42e23dca0ad88784accfd95328f79d34c992", "filename": "sql/db_drops.sql", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -19823,6 +19823,11 @@ USE `heavenms`;\n (1110100, 4001369, 1, 1, 28259, 40000),\n (1210101, 4001370, 1, 1, 28260, 40000),\n (1110101, 4001371, 1, 1, 28261, 40000),\n+(2130100, 4001368, 1, 1, 28262, 40000),\n+(2110200, 4001369, 1, 1, 28262, 40000),\n+(1110100, 4001370, 1, 1, 28262, 40000),\n+(1210101, 4001371, 1, 1, 28262, 40000),\n+(1110101, 4001367, 1, 1, 28262, 40000),\n (3300003, 4001317, 1, 1, 2326, 20000),\n (1210102, 4001364, 1, 1, 28192, 80000),\n (1120100, 4001365, 1, 1, 28192, 80000),"}, {"sha": "7c2a820088d6de3125f748563c84634d34a43503", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 111, "deletions": 24, "changes": 135, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -155,6 +155,7 @@\n import constants.skills.ThunderBreaker;\n import net.server.channel.handlers.PartyOperationHandler;\n import scripting.item.ItemScriptManager;\n+import server.life.MobSkillFactory;\n import server.maps.MapleMapItem;\n import net.server.audit.locks.MonitoredLockType;\n import net.server.audit.locks.factory.MonitoredReentrantLockFactory;\n@@ -1370,6 +1371,35 @@ public void changeMap(final MapleMap target, final Point pos) {\n         eventAfterChangedMap(this.getMapId());\n     }\n     \n+    public void forceChangeMap(final MapleMap target, final MaplePortal pto) {\n+        // will actually enter the map given as parameter, regardless of being an eventmap or whatnot\n+        \n+        canWarpCounter++;\n+        eventChangedMap(999999999);\n+        \n+        EventInstanceManager mapEim = target.getEventInstance();\n+        if(mapEim != null) {\n+            EventInstanceManager playerEim = this.getEventInstance();\n+            if(playerEim != null) {\n+                playerEim.exitPlayer(this);\n+                if(playerEim.getPlayerCount() == 0) {\n+                    playerEim.dispose();\n+                }\n+            }\n+            \n+            mapEim.registerPlayer(this);\n+        }\n+        \n+        MapleMap to = getWarpMap(target.getId());\n+        changeMapInternal(to, pto.getPosition(), MaplePacketCreator.getWarpToMap(to, pto.getId(), this));\n+        canWarpMap = false;\n+        \n+        canWarpCounter--;\n+        if(canWarpCounter == 0) canWarpMap = true;\n+        \n+        eventAfterChangedMap(this.getMapId());\n+    }\n+    \n     private boolean buffMapProtection() {\n         effLock.lock();\n         chrLock.lock();\n@@ -2073,6 +2103,10 @@ public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n                             ps.setInt(1, cid);\n                             ps.executeUpdate();\n                     }\n+                    try (PreparedStatement ps = con.prepareStatement(\"DELETE FROM playerdiseases WHERE charid = ?\")) {\n+                            ps.setInt(1, cid);\n+                            ps.executeUpdate();\n+                    }\n                     try (PreparedStatement ps = con.prepareStatement(\"DELETE FROM area_info WHERE charid = ?\")) {\n                             ps.setInt(1, cid);\n                             ps.executeUpdate();\n@@ -2359,31 +2393,34 @@ public void silentApplyDiseases(Map<MapleDisease, Pair<Long, MobSkill>> diseaseM\n                 long expTime = curTime + di.getValue().getLeft();\n                 \n                 diseaseExpires.put(di.getKey(), expTime);\n-                diseases.put(di.getKey(), new Pair<>(new MapleDiseaseValueHolder(curTime, expTime), di.getValue().getRight()));\n+                diseases.put(di.getKey(), new Pair<>(new MapleDiseaseValueHolder(curTime, di.getValue().getLeft()), di.getValue().getRight()));\n             }\n         } finally {\n             chrLock.unlock();\n         }\n     }\n     \n-    public void announceDiseases(MapleClient c) {\n+    public void announceDiseases() {\n+        Set<Entry<MapleDisease, Pair<MapleDiseaseValueHolder, MobSkill>>> chrDiseases;\n+        \n         chrLock.lock();\n         try {\n             // Poison damage visibility and diseases status visibility, extended through map transitions thanks to Ronan\n-            \n             if(!this.isLoggedinWorld()) return;\n             \n-            for(Entry<MapleDisease, Pair<MapleDiseaseValueHolder, MobSkill>> di : diseases.entrySet()) {\n-                MapleDisease disease = di.getKey();\n-                MobSkill skill = di.getValue().getRight();\n-                final List<Pair<MapleDisease, Integer>> debuff = Collections.singletonList(new Pair<>(disease, Integer.valueOf(skill.getX())));\n-                \n-                if(disease != MapleDisease.SLOW) c.announce(MaplePacketCreator.giveForeignDebuff(id, debuff, skill));\n-                else c.announce(MaplePacketCreator.giveForeignSlowDebuff(id, debuff, skill));\n-            }\n+            chrDiseases = new LinkedHashSet<>(diseases.entrySet());\n         } finally {\n             chrLock.unlock();\n         }\n+        \n+        for(Entry<MapleDisease, Pair<MapleDiseaseValueHolder, MobSkill>> di : chrDiseases) {\n+            MapleDisease disease = di.getKey();\n+            MobSkill skill = di.getValue().getRight();\n+            final List<Pair<MapleDisease, Integer>> debuff = Collections.singletonList(new Pair<>(disease, Integer.valueOf(skill.getX())));\n+\n+            if(disease != MapleDisease.SLOW) map.broadcastMessage(MaplePacketCreator.giveForeignDebuff(id, debuff, skill));\n+            else map.broadcastMessage(MaplePacketCreator.giveForeignSlowDebuff(id, debuff, skill));\n+        }\n     }\n     \n     public void giveDebuff(final MapleDisease disease, MobSkill skill) {\n@@ -6276,11 +6313,14 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n             }\n             rs.close();\n             ps.close();\n-            ps = con.prepareStatement(\"SELECT name FROM accounts WHERE id = ?\", Statement.RETURN_GENERATED_KEYS);\n+            ps = con.prepareStatement(\"SELECT name, characterslots FROM accounts WHERE id = ?\", Statement.RETURN_GENERATED_KEYS);\n             ps.setInt(1, ret.accountid);\n             rs = ps.executeQuery();\n             if (rs.next()) {\n-                ret.getClient().setAccountName(rs.getString(\"name\"));\n+                MapleClient retClient = ret.getClient();\n+                \n+                retClient.setAccountName(rs.getString(\"name\"));\n+                retClient.setCharacterSlots(rs.getByte(\"characterslots\"));\n             }\n             rs.close();\n             ps.close();\n@@ -6348,7 +6388,9 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                     try (ResultSet rsProgress = pse.executeQuery()) {\n                         while(rsProgress.next()) {\n                             MapleQuestStatus status = loadedQuestStatus.get(rsProgress.getInt(\"queststatusid\"));\n-                            status.setProgress(rsProgress.getInt(\"progressid\"), rsProgress.getString(\"progress\"));\n+                            if(status != null) {\n+                                status.setProgress(rsProgress.getInt(\"progressid\"), rsProgress.getString(\"progress\"));\n+                            }\n                         }\n                     }\n                 }\n@@ -6358,7 +6400,9 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                     try (ResultSet rsMedalMaps = pse.executeQuery()) {\n                         while(rsMedalMaps.next()) {\n                             MapleQuestStatus status = loadedQuestStatus.get(rsMedalMaps.getInt(\"queststatusid\"));\n-                            status.addMedalMap(rsMedalMaps.getInt(\"mapid\"));\n+                            if(status != null) {\n+                                status.addMedalMap(rsMedalMaps.getInt(\"mapid\"));\n+                            }\n                         }\n                     }\n                 }\n@@ -6391,6 +6435,29 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                 ps.setInt(1, ret.getId());\n                 ps.executeUpdate();\n                 ps.close();\n+                Map<MapleDisease, Pair<Long, MobSkill>> loadedDiseases = new LinkedHashMap<>();\n+                ps = con.prepareStatement(\"SELECT * FROM playerdiseases WHERE charid = ?\");\n+                ps.setInt(1, ret.getId());\n+                rs = ps.executeQuery();\n+                while (rs.next()) {\n+                    final MapleDisease disease = MapleDisease.ordinal(rs.getInt(\"disease\"));\n+                    if(disease == MapleDisease.NULL) continue;\n+                    \n+                    final int skillid = rs.getInt(\"mobskillid\"), skilllv = rs.getInt(\"mobskilllv\");\n+                    final long length = rs.getInt(\"length\");\n+                    \n+                    MobSkill ms = MobSkillFactory.getMobSkill(skillid, skilllv);\n+                    if(ms != null) {\n+                        loadedDiseases.put(disease, new Pair<>(length, ms));\n+                    }\n+                }\n+                rs.close();\n+                ps.close();\n+                ps = con.prepareStatement(\"DELETE FROM playerdiseases WHERE charid = ?\");\n+                ps.setInt(1, ret.getId());\n+                ps.executeUpdate();\n+                ps.close();\n+                if(!loadedDiseases.isEmpty()) Server.getInstance().getPlayerBuffStorage().addDiseasesToStorage(ret.id, loadedDiseases);\n                 ps = con.prepareStatement(\"SELECT * FROM skillmacros WHERE characterid = ?\");\n                 ps.setInt(1, charid);\n                 rs = ps.executeQuery();\n@@ -6921,8 +6988,8 @@ public void resetEnteredScript(String script) {\n \n     public synchronized void saveCooldowns() {\n         List<PlayerCoolDownValueHolder> listcd = getAllCooldowns();\n-                \n-        if (listcd.size() > 0) {\n+        \n+        if (!listcd.isEmpty()) {\n             try {\n                 Connection con = DatabaseConnection.getConnection();\n                 deleteWhereCharacterId(con, \"DELETE FROM cooldowns WHERE charid = ?\");\n@@ -6942,6 +7009,33 @@ public synchronized void saveCooldowns() {\n                 se.printStackTrace();\n             }\n         }\n+        \n+        Map<MapleDisease, Pair<Long, MobSkill>> listds = getAllDiseases();\n+        if (!listds.isEmpty()) {\n+            try {\n+                Connection con = DatabaseConnection.getConnection();\n+                deleteWhereCharacterId(con, \"DELETE FROM playerdiseases WHERE charid = ?\");\n+                try (PreparedStatement ps = con.prepareStatement(\"INSERT INTO playerdiseases (charid, disease, mobskillid, mobskilllv, length) VALUES (?, ?, ?, ?, ?)\")) {\n+                    ps.setInt(1, getId());\n+                    \n+                    for (Entry<MapleDisease, Pair<Long, MobSkill>> e : listds.entrySet()) {\n+                        ps.setInt(2, e.getKey().ordinal());\n+                        \n+                        MobSkill ms = e.getValue().getRight();\n+                        ps.setInt(3, ms.getSkillId());\n+                        ps.setInt(4, ms.getSkillLevel());\n+                        ps.setInt(5, e.getValue().getLeft().intValue());\n+                        ps.addBatch();\n+                    }\n+                    \n+                    ps.executeBatch();\n+                }\n+                \n+                con.close();\n+            } catch (SQLException se) {\n+                se.printStackTrace();\n+            }\n+        }\n     }\n \n     public void saveGuildStatus() {\n@@ -7454,13 +7548,6 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             psf.close();\n             ps.close();\n             \n-            ps = con.prepareStatement(\"UPDATE accounts SET gm = ? WHERE id = ?\");\n-            ps.setInt(1, gmLevel > 1 ? 1 : 0);\n-            ps.setInt(2, client.getAccID());\n-            ps.executeUpdate();\n-            ps.close();\n-            \n-\t    \n             con.commit();\n             con.setAutoCommit(true);\n \t    "}, {"sha": "874f633a0f560d6fd8bc7e08ec956fb9cf023e2a", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -516,13 +516,13 @@ public int login(String login, String pwd) {\n \t\tResultSet rs = null;\n \t\ttry {\n \t\t\tcon = DatabaseConnection.getConnection();\n-\t\t\tps = con.prepareStatement(\"SELECT id, password, salt, gender, banned, gm, pin, pic, characterslots, tos FROM accounts WHERE name = ?\");\n+\t\t\tps = con.prepareStatement(\"SELECT id, password, salt, gender, banned, pin, pic, characterslots, tos FROM accounts WHERE name = ?\");\n \t\t\tps.setString(1, login);\n \t\t\trs = ps.executeQuery();\n \t\t\tif (rs.next()) {\n \t\t\t\tboolean banned = (rs.getByte(\"banned\") == 1);\n \t\t\t\taccId = rs.getInt(\"id\");\n-\t\t\t\tgmlevel = rs.getInt(\"gm\");\n+\t\t\t\tgmlevel = 0;\n \t\t\t\tpin = rs.getString(\"pin\");\n \t\t\t\tpic = rs.getString(\"pic\");\n \t\t\t\tgender = rs.getByte(\"gender\");\n@@ -796,7 +796,6 @@ private void removePlayer() {\n                         player.setDisconnectedFromChannelWorld();\n                         player.notifyMapTransferToPartner(-1);\n                         player.cancelAllBuffs(true);\n-                        player.cancelAllDebuffs();\n                         \n                         player.closePlayerInteractions();\n                         QuestScriptManager.getInstance().dispose(this);\n@@ -845,6 +844,7 @@ public final synchronized void disconnect(boolean shutdown, boolean cashshop) {/\n                                 removePlayer();\n                                 \n                                 player.saveCooldowns();\n+                                player.cancelAllDebuffs();\n                                 player.saveCharToDB(true);\n                                 \n                                 clear();\n@@ -927,6 +927,7 @@ public final synchronized void disconnect(boolean shutdown, boolean cashshop) {/\n                                         //getChannelServer().removePlayer(player); already being done\n                                         \n                                         player.saveCooldowns();\n+                                        player.cancelAllDebuffs();\n                                         player.saveCharToDB(true);\n \t\t\t\t\tif (player != null) {//no idea, occur :(\n \t\t\t\t\t\tplayer.empty(false);\n@@ -936,6 +937,7 @@ public final synchronized void disconnect(boolean shutdown, boolean cashshop) {/\n                                         getChannelServer().removePlayer(player);\n \n                                         player.saveCooldowns();\n+                                        player.cancelAllDebuffs();\n                                         player.saveCharToDB();\n                                 }\n \t\t\t}\n@@ -1191,9 +1193,21 @@ private static boolean checkHash(String hash, String type, String password) {\n \t\t}\n \t}\n \n+        public short getAvailableCharacterSlots() {\n+                return (short) Math.max(0, characterSlots - Server.getInstance().getAccountCharacterCount(accId));\n+\t}\n+        \n+        public short getAvailableCharacterWorldSlots() {\n+                return (short) Math.max(0, characterSlots - Server.getInstance().getAccountWorldCharacterCount(accId, world));\n+\t}\n+        \n \tpublic short getCharacterSlots() {\n \t\treturn characterSlots;\n \t}\n+        \n+        public void setCharacterSlots(byte slots) {\n+                characterSlots = slots;\n+\t}\n \n \tpublic synchronized boolean gainCharacterSlot() {\n \t\tif (characterSlots < 15) {"}, {"sha": "784be02d6e32d9993d2644c235c1962a15374d26", "filename": "src/client/MapleDisease.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleDisease.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/MapleDisease.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleDisease.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -21,6 +21,9 @@\n */\n package client;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n public enum MapleDisease {\n     NULL(0x0),\n     SLOW(0x1),\n@@ -55,5 +58,12 @@ public long getValue() {\n     public boolean isFirst() {\n             return first;\n     }\n-\t\n+    \n+    public static MapleDisease ordinal(int ord) {\n+        try {\n+            return MapleDisease.values()[ord];\n+        } catch (IndexOutOfBoundsException io) {\n+            return NULL;\n+        }\n+    }\n }"}, {"sha": "566d1ea2d0c5562e2ecaead7638842cf311cfa0f", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 67, "deletions": 1, "changes": 68, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -1201,7 +1201,7 @@ else if (type.equals(\"cash\")) {\n                                         player.dropMessage(5, \"Player '\" + victim.getName() + \"' is at channel \" + victim.getClient().getChannel() + \".\");\n                                 } else {\n                                         MapleMap map = victim.getMap();\n-                                        player.changeMap(map, map.findClosestPortal(victim.getPosition()));\n+                                        player.forceChangeMap(map, map.findClosestPortal(victim.getPosition()));\n                                 }\n                         } else {\n                                 player.dropMessage(6, \"Unknown player.\");\n@@ -2417,6 +2417,72 @@ public void run() {\n                         } catch(Exception e) {}\n \t\t\tbreak;\n                     \n+                case \"startquest\":\n+                        if (sub.length < 2){\n+\t\t\t\tplayer.yellowMessage(\"Syntax: !startquest <questid>\");\n+\t\t\t\tbreak;\n+\t\t\t}\n+                        \n+                        int questid = Integer.parseInt(sub[1]);\n+                        \n+                        if (player.getQuestStatus(questid) == 0) {\n+                                MapleQuest quest = MapleQuest.getInstance(questid);\n+                                if (quest != null) {\n+                                        int npcid = quest.getNpcRequirement(false);\n+                                        quest.forceStart(player, npcid);\n+                                        player.dropMessage(5, \"QUEST \" + questid + \" started.\");\n+                                } else {\n+                                        player.dropMessage(5, \"QUESTID \" + questid + \" is invalid.\");\n+                                }\n+                        } else {\n+                                player.dropMessage(5, \"QUESTID \" + questid + \" already started/completed.\");\n+                        }\n+                        \n+                        break;\n+                \n+                case \"completequest\":\n+                        if (sub.length < 2){\n+\t\t\t\tplayer.yellowMessage(\"Syntax: !completequest <questid>\");\n+\t\t\t\tbreak;\n+\t\t\t}\n+                    \n+                        int questId = Integer.parseInt(sub[1]);\n+                        \n+                        if (player.getQuestStatus(questId) == 1) {\n+                                MapleQuest quest = MapleQuest.getInstance(questId);\n+                                if (quest != null) {\n+                                        int npcid = quest.getNpcRequirement(true);\n+                                        quest.forceComplete(player, npcid);\n+                                        player.dropMessage(5, \"QUEST \" + questId + \" completed.\");\n+                                } else {    // should not occur\n+                                        player.dropMessage(5, \"QUESTID \" + questId + \" is invalid.\");\n+                                }\n+                        } else {\n+                                player.dropMessage(5, \"QUESTID \" + questId + \" not started or already completed.\");\n+                        }\n+                        \n+                        break;\n+                    \n+                case \"resetquest\":\n+                        if (sub.length < 2){\n+\t\t\t\tplayer.yellowMessage(\"Syntax: !resetquest <questid>\");\n+\t\t\t\tbreak;\n+\t\t\t}\n+                    \n+                        int questid_ = Integer.parseInt(sub[1]);\n+                        \n+                        if (player.getQuestStatus(questid_) != 0) {\n+                                MapleQuest quest = MapleQuest.getInstance(questid_);\n+                                if (quest != null) {\n+                                        quest.reset(player);\n+                                        player.dropMessage(5, \"QUEST \" + questid_ + \" reseted.\");\n+                                } else {    // should not occur\n+                                        player.dropMessage(5, \"QUESTID \" + questid_ + \" is invalid.\");\n+                                }\n+                        }\n+                        \n+                        break;\n+                    \n                 default:\n                         return false;\n                 }"}, {"sha": "a5ebb12579ff54fd75d3553f88b1170d968c82e4", "filename": "src/client/creator/CharacterFactory.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/creator/CharacterFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/creator/CharacterFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/creator/CharacterFactory.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -25,6 +25,7 @@\n import client.inventory.Item;\n import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n+import constants.ServerConstants;\n import net.server.Server;\n import server.MapleItemInformationProvider;\n import tools.MaplePacketCreator;\n@@ -36,6 +37,10 @@\n public abstract class CharacterFactory {\n         \n         protected synchronized static int createNewCharacter(MapleClient c, String name, int face, int hair, int skin, int gender, CharacterFactoryRecipe recipe) {\n+                if (ServerConstants.COLLECTIVE_CHARSLOT ? c.getAvailableCharacterSlots() <= 0 : c.getAvailableCharacterWorldSlots() <= 0) {\n+                        return -3;\n+                }\n+            \n                 if (!MapleCharacter.canCreateChar(name)) {\n                         return -1;\n                 }"}, {"sha": "e8395e281907c83046b5a884b537627b6f93e495", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -470,7 +470,7 @@ private void gainLevel(MapleClient c) {\n             lvupStr += \"+UPGSLOT \";\n         }\n         \n-        showLevelupMessage(showStr, c); // thx to Polaris dev team !\n+        showLevelupMessage(showStr, c); // thanks to Polaris dev team !\n         c.getPlayer().dropMessage(6, lvupStr);\n         \n         c.announce(MaplePacketCreator.showEquipmentLevelUp());"}, {"sha": "f0362a8401519521996dcda3d576ff129c99b12f", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -32,6 +32,7 @@\n     \n     public static final boolean AUTOMATIC_REGISTER = true;      //Automatically register players when they login with a nonexistent username.\n     public static final boolean BCRYPT_MIGRATION = true;        //Performs a migration from old SHA-1 and SHA-512 password to bcrypt.\n+    public static final boolean COLLECTIVE_CHARSLOT = false;     //Available character slots are contabilized globally rather than per world server.\n     \n     //Ip Configuration\n     public static String HOST;"}, {"sha": "fcf767795b913bbe91d9ab27e386cb41aca395e8", "filename": "src/net/server/Server.java", "status": "modified", "additions": 44, "deletions": 7, "changes": 51, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -100,6 +100,7 @@\n     private final Properties subnetInfo = new Properties();\n     private static Server instance = null;\n     private final Map<Integer, Set<Integer>> accountChars = new HashMap<>();\n+    private final Map<Integer, Short> accountCharacterCount = new HashMap<>();\n     private final Map<Integer, Integer> worldChars = new HashMap<>();\n     private final Map<String, Integer> transitioningChars = new HashMap<>();\n     private List<Pair<Integer, String>> worldRecommendedList = new LinkedList<>();\n@@ -601,9 +602,7 @@ public void runAnnouncePlayerDiseasesSchedule() {\n             MapleClient c = processDiseaseAnnounceClients.remove(0);\n             MapleCharacter player = c.getPlayer();\n             if(player != null && player.isLoggedinWorld()) {\n-                for(MapleCharacter chr : player.getMap().getCharacters()) {\n-                    chr.announceDiseases(c);\n-                }\n+                player.announceDiseases();\n             }\n         }\n         \n@@ -1089,6 +1088,32 @@ public boolean haveCharacterEntry(Integer accountid, Integer chrid) {\n         }\n     }\n     \n+    public short getAccountCharacterCount(Integer accountid) {\n+        lgnRLock.lock();\n+        try {\n+            return accountCharacterCount.get(accountid);\n+        } finally {\n+            lgnRLock.unlock();\n+        }\n+    }\n+    \n+    public short getAccountWorldCharacterCount(Integer accountid, Integer worldid) {\n+        lgnRLock.lock();\n+        try {\n+            short count = 0;\n+            \n+            for(Integer chr : accountChars.get(accountid)) {\n+                if(worldChars.get(chr).equals(worldid)) {\n+                    count++;\n+                }\n+            }\n+            \n+            return count;\n+        } finally {\n+            lgnRLock.unlock();\n+        }\n+    }\n+    \n     private Set<Integer> getAccountCharacterEntries(Integer accountid) {\n         lgnRLock.lock();\n         try {\n@@ -1115,6 +1140,8 @@ public void createCharacterEntry(MapleCharacter chr) {\n         \n         lgnWLock.lock();\n         try {\n+            accountCharacterCount.put(accountid, (short)(accountCharacterCount.get(accountid) + 1));\n+            \n             Set<Integer> accChars = accountChars.get(accountid);\n             accChars.add(chrid);\n             \n@@ -1132,6 +1159,8 @@ public void createCharacterEntry(MapleCharacter chr) {\n     public void deleteCharacterEntry(Integer accountid, Integer chrid) {\n         lgnWLock.lock();\n         try {\n+            accountCharacterCount.put(accountid, (short)(accountCharacterCount.get(accountid) - 1));\n+            \n             Set<Integer> accChars = accountChars.get(accountid);\n             accChars.remove(chrid);\n             \n@@ -1169,6 +1198,7 @@ public void transferWorldCharacterEntry(MapleCharacter chr, Integer toWorld) { /\n     public void deleteAccountEntry(Integer accountid) { is this even a thing?\n         lgnWLock.lock();\n         try {\n+            accountCharacterCount.remove(accountid);\n             accountChars.remove(accountid);\n         } finally {\n             lgnWLock.unlock();\n@@ -1190,6 +1220,7 @@ public void deleteAccountEntry(Integer accountid) { is this even a thing?\n                 List<MapleCharacter> wchars = w.getAccountCharactersView(accountId);\n                 if(wchars == null) {\n                     if(!accountChars.containsKey(accountId)) {\n+                        accountCharacterCount.put(accountId, (short) 0);\n                         accountChars.put(accountId, new HashSet<Integer>());    // not advisable at all to write on the map on a read-protected environment\n                     }                                                           // yet it's known there's no problem since no other point in the source does\n                 } else if(!wchars.isEmpty()) {                                  // this action.\n@@ -1206,7 +1237,8 @@ public void deleteAccountEntry(Integer accountid) { is this even a thing?\n         return new Pair<>(new Pair<>(chrTotal, lastwchars), accChars);\n     }\n     \n-    private static List<List<MapleCharacter>> loadAccountCharactersViewFromDb(int accId, int wlen) {\n+    private static Pair<Short, List<List<MapleCharacter>>> loadAccountCharactersViewFromDb(int accId, int wlen) {\n+        short characterCount = 0;\n         List<List<MapleCharacter>> wchars = new ArrayList<>(wlen);\n         for(int i = 0; i < wlen; i++) wchars.add(i, new LinkedList<MapleCharacter>());\n         \n@@ -1231,8 +1263,10 @@ public void deleteAccountEntry(Integer accountid) { is this even a thing?\n                 ps.setInt(1, accId);\n                 try (ResultSet rs = ps.executeQuery()) {\n                     while (rs.next()) {\n+                        characterCount++;\n+                        \n                         int cworld = rs.getByte(\"world\");\n-                        if(cworld >= wlen) break;\n+                        if(cworld >= wlen) continue;\n \n                         if(cworld > curWorld) {\n                             wchars.add(curWorld, chars);\n@@ -1253,7 +1287,7 @@ public void deleteAccountEntry(Integer accountid) { is this even a thing?\n             sqle.printStackTrace();\n         }\n         \n-        return wchars;\n+        return new Pair<>(characterCount, wchars);\n     }\n     \n     public void loadAccountCharacters(MapleClient c) {\n@@ -1300,10 +1334,13 @@ public void loadAccountCharacters(MapleClient c) {\n     \n     private int loadAccountCharactersView(Integer accId, int gmLevel, int fromWorldid) {    // returns the maximum gmLevel found\n         List<World> wlist = this.getWorlds();\n-        List<List<MapleCharacter>> accChars = loadAccountCharactersViewFromDb(accId, wlist.size());\n+        Pair<Short, List<List<MapleCharacter>>> accCharacters = loadAccountCharactersViewFromDb(accId, wlist.size());\n         \n         lgnWLock.lock();\n         try {\n+            List<List<MapleCharacter>> accChars = accCharacters.getRight();\n+            accountCharacterCount.put(accId, accCharacters.getLeft());\n+            \n             Set<Integer> chars = accountChars.get(accId);\n             if(chars == null) {\n                 chars = new HashSet<>(5);"}, {"sha": "a12d435f0ac607fa3daf87ee06e776f399e36f37", "filename": "src/net/server/audit/locks/MonitoredLockType.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/audit/locks/MonitoredLockType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/audit/locks/MonitoredLockType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredLockType.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -75,6 +75,7 @@\n     EM_LOBBY,\n     EM_QUEUE,\n     EM_SCHDL,\n+    EM_START,\n     CASHSHOP,\n     VISITOR_PSHOP,\n     STORAGE,"}, {"sha": "f8be4608e0944b03bf649d1f39a2c2402edd0d23", "filename": "src/net/server/channel/handlers/OwlWarpHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/OwlWarpHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/OwlWarpHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/OwlWarpHandler.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -37,6 +37,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         int ownerid = slea.readInt();\n         int mapid = slea.readInt();\n         \n+        if(ownerid == c.getPlayer().getId()) {\n+            c.announce(MaplePacketCreator.serverNotice(1, \"You cannot visit your own shop.\"));\n+            return;\n+        }\n+        \n         MapleHiredMerchant hm = c.getWorldServer().getHiredMerchant(ownerid);   // if both hired merchant and player shop is on the same map\n         MaplePlayerShop ps;\n         if(hm == null || hm.getMapId() != mapid || !hm.hasItem(c.getPlayer().getOwlSearch())) {"}, {"sha": "f8b5ac56734c3826c9a7116178a29664530134b8", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 21, "deletions": 10, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -27,6 +27,7 @@\n import java.sql.SQLException;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Map.Entry;\n \n import net.AbstractMaplePacketHandler;\n import net.server.PlayerBuffValueHolder;\n@@ -90,6 +91,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 e.printStackTrace();\n             }\n         } else {\n+            c.setCharacterSlots((byte) player.getClient().getCharacterSlots());\n             player.newClient(c);\n         }\n         if (player == null) { //If you are still getting null here then please just uninstall the game >.>, we dont need you fucking with the logs\n@@ -275,16 +277,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         c.announce(MaplePacketCreator.enableReport());\n         player.changeSkillLevel(SkillFactory.getSkill(10000000 * player.getJobType() + 12), (byte) (player.getLinkedLevel() / 10), 20, -1);\n         player.checkBerserk(player.isHidden());\n-        player.buffExpireTask();\n-        player.diseaseExpireTask();\n-        player.skillCooldownTask();\n-        player.expirationTask();\n-        player.questExpirationTask();\n-        if (GameConstants.hasSPTable(player.getJob()) && player.getJob().getId() != 2001) {\n-                player.createDragon();\n-        }\n-        \n-        player.commitExcludedItems();\n         \n         if (newcomer){\n             /*\n@@ -295,12 +287,31 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (player.isGM()){\n             \tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.earnTitleMessage((player.gmLevel() < 6 ? \"GM \" : \"Admin \") + player.getName() + \" has logged in\"));\n             }\n+            \n+            if(diseases != null) {\n+                for(Entry<MapleDisease, Pair<Long, MobSkill>> e : diseases.entrySet()) {\n+                    final List<Pair<MapleDisease, Integer>> debuff = Collections.singletonList(new Pair<>(e.getKey(), Integer.valueOf(e.getValue().getRight().getX())));\n+                    c.announce(MaplePacketCreator.giveDebuff(debuff, e.getValue().getRight()));\n+                }\n+                \n+                player.announceDiseases();\n+            }\n         } else {\n             if(player.isRidingBattleship()) {\n                 player.announceBattleshipHp();\n             }\n         }\n         \n+        player.buffExpireTask();\n+        player.diseaseExpireTask();\n+        player.skillCooldownTask();\n+        player.expirationTask();\n+        player.questExpirationTask();\n+        if (GameConstants.hasSPTable(player.getJob()) && player.getJob().getId() != 2001) {\n+            player.createDragon();\n+        }\n+        \n+        player.commitExcludedItems();\n         showDueyNotification(c, player);\n         \n         if (player.getMap().getHPDec() > 0) player.resetHpDecreaseTask();"}, {"sha": "10e4df956395e340f4e48dda87cc6979b5f43c02", "filename": "src/net/server/channel/handlers/ScriptedItemHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/ScriptedItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/ScriptedItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScriptedItemHandler.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -39,8 +39,8 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        slea.readInt(); // trash stamp (thx rmzero)\n-        short itemSlot = slea.readShort(); // item sl0t (thx rmzero)\n+        slea.readInt(); // trash stamp (thanks rmzero)\n+        short itemSlot = slea.readShort(); // item slot (thanks rmzero)\n         int itemId = slea.readInt(); // itemId\n         scriptedItem info = ii.getScriptedItemInfo(itemId);\n         if (info == null) return;"}, {"sha": "ee5db198be48facf6d25240693777d21fae6be00", "filename": "src/net/server/channel/handlers/ScrollHandler.java", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/ScrollHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/ScrollHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScrollHandler.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -34,6 +34,7 @@\n import constants.ItemConstants;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Map;\n import net.AbstractMaplePacketHandler;\n import client.inventory.manipulator.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n@@ -72,10 +73,17 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         Item scroll = useInventory.getItem(slot);\n         Item wscroll = null;\n \n-        if (((Equip) toScroll).getUpgradeSlots() < 1 && !ItemConstants.isCleanSlate(scroll.getItemId())) {\n+        if (ItemConstants.isCleanSlate(scroll.getItemId())) {\n+            Map<String, Integer> eqStats = ii.getEquipStats(scroll.getItemId());\n+            if (eqStats == null || eqStats.get(\"tuc\") == 0) {\n+                c.announce(MaplePacketCreator.getInventoryFull());\n+                return;\n+            }\n+        } else if (((Equip) toScroll).getUpgradeSlots() < 1) {\n             c.announce(MaplePacketCreator.getInventoryFull());\n             return;\n         }\n+        \n         List<Integer> scrollReqs = ii.getScrollReqs(scroll.getItemId());\n         if (scrollReqs.size() > 0 && !scrollReqs.contains(toScroll.getItemId())) {\n             c.announce(MaplePacketCreator.getInventoryFull());"}, {"sha": "90449fab7771e9577919058c8537bfbf3c9ebdf4", "filename": "src/net/server/channel/handlers/WhisperHandler.java", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/WhisperHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/channel/handlers/WhisperHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/WhisperHandler.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -27,7 +27,6 @@\n \n import net.AbstractMaplePacketHandler;\n import net.server.world.World;\n-import tools.LogHelper;\n import tools.DatabaseConnection;\n import tools.FilePrinter;\n import tools.MaplePacketCreator;\n@@ -42,7 +41,8 @@\n  * @author Matze\n  */\n public final class WhisperHandler extends AbstractMaplePacketHandler {\n-\t\n+    \n+    @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         byte mode = slea.readByte();\n         if (mode == 6) { // whisper\n@@ -92,7 +92,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 } else {\n                     c.announce(MaplePacketCreator.getFindReply(victim.getName(), victim.getMap().getId(), 1));\n                 }\n-            } else { // not found\n+            } else if (c.getPlayer().gmLevel() > 1) { // not found\n                 try {\n                     Connection con = DatabaseConnection.getConnection();\n                     PreparedStatement ps = con.prepareStatement(\"SELECT gm FROM characters WHERE name = ?\");\n@@ -116,6 +116,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 } catch (SQLException e) {\n                     e.printStackTrace();\n                 }\n+            } else {\n+                c.announce(MaplePacketCreator.getWhisperReply(recipient, (byte) 0));\n             }\n         } else if (mode == 0x44) {\n             //Buddy find?"}, {"sha": "6bd23b913d201e2e4367512b1462343cdebc45a1", "filename": "src/net/server/guild/MapleGuild.java", "status": "modified", "additions": 36, "deletions": 25, "changes": 61, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/guild/MapleGuild.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/net/server/guild/MapleGuild.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleGuild.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -117,14 +117,16 @@ public void buildNotifications() {\n             return;\n         }\n         Set<Integer> chs = Server.getInstance().getOpenChannels(world);\n-        if (notifications.keySet().size() != chs.size()) {\n-            notifications.clear();\n-            for (Integer ch : chs) {\n-                notifications.put(ch, new LinkedList<Integer>());\n-            }\n-        } else {\n-            for (List<Integer> l : notifications.values()) {\n-                l.clear();\n+        synchronized (notifications) {\n+            if (notifications.keySet().size() != chs.size()) {\n+                notifications.clear();\n+                for (Integer ch : chs) {\n+                    notifications.put(ch, new LinkedList<Integer>());\n+                }\n+            } else {\n+                for (List<Integer> l : notifications.values()) {\n+                    l.clear();\n+                }\n             }\n         }\n         \n@@ -134,7 +136,11 @@ public void buildNotifications() {\n                 if (!mgc.isOnline()) {\n                     continue;\n                 }\n-                List<Integer> chl = notifications.get(mgc.getChannel());\n+                \n+                List<Integer> chl;\n+                synchronized (notifications) {\n+                    chl = notifications.get(mgc.getChannel());\n+                }\n                 if (chl != null) chl.add(mgc.getId());\n                 //Unable to connect to Channel... error was here\n             }\n@@ -279,26 +285,31 @@ public void broadcast(final byte[] packet, int exception) {\n     }\n \n     public void broadcast(final byte[] packet, int exceptionId, BCOp bcop) {\n-        synchronized (notifications) {\n-            if (bDirty) {\n-                buildNotifications();\n-            }\n-            try {\n-                for (Integer b : Server.getInstance().getOpenChannels(world)) {\n-                    if (notifications.get(b).size() > 0) {\n-                        if (bcop == BCOp.DISBAND) {\n-                            Server.getInstance().getWorld(world).setGuildAndRank(notifications.get(b), 0, 5, exceptionId);\n-                        } else if (bcop == BCOp.EMBLEMCHANGE) {\n-                            Server.getInstance().getWorld(world).changeEmblem(this.id, notifications.get(b), new MapleGuildSummary(this));\n-                        } else {\n-                            Server.getInstance().getWorld(world).sendPacket(notifications.get(b), packet, exceptionId);\n+        membersLock.lock(); // membersLock awareness thanks to ProjectNano dev team\n+        try {\n+            synchronized (notifications) {\n+                if (bDirty) {\n+                    buildNotifications();\n+                }\n+                try {\n+                    for (Integer b : Server.getInstance().getOpenChannels(world)) {\n+                        if (notifications.get(b).size() > 0) {\n+                            if (bcop == BCOp.DISBAND) {\n+                                Server.getInstance().getWorld(world).setGuildAndRank(notifications.get(b), 0, 5, exceptionId);\n+                            } else if (bcop == BCOp.EMBLEMCHANGE) {\n+                                Server.getInstance().getWorld(world).changeEmblem(this.id, notifications.get(b), new MapleGuildSummary(this));\n+                            } else {\n+                                Server.getInstance().getWorld(world).sendPacket(notifications.get(b), packet, exceptionId);\n+                            }\n                         }\n                     }\n+                } catch (Exception re) {\n+                    re.printStackTrace();\n+                    System.out.println(\"Failed to contact channel(s) for broadcast.\");//fu?\n                 }\n-            } catch (Exception re) {\n-                re.printStackTrace();\n-                System.out.println(\"Failed to contact channel(s) for broadcast.\");//fu?\n             }\n+        } finally {\n+            membersLock.unlock();\n         }\n     }\n "}, {"sha": "dd5e2a4462801d02ef87b91a199245d1f03c49c9", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -224,14 +224,18 @@ public void giveEventPlayersMeso(int gain, int mapId) {\n                 \n \t}\n \n-\tpublic void registerPlayer(MapleCharacter chr) {\n-\t\tif (chr == null || !chr.isLoggedin()){\n+\tpublic synchronized void registerPlayer(MapleCharacter chr) {\n+\t\tif (chr == null || !chr.isLoggedinWorld() || disposed) {\n \t\t\treturn;\n \t\t}\n                 \n                 try {\n                         wL.lock();\n                         try {\n+                                if(chars.containsKey(chr.getId())) {\n+                                        return;\n+                                }\n+                                \n                                 chars.put(chr.getId(), chr);\n                                 chr.setEventInstance(this);\n                         } finally {\n@@ -249,7 +253,7 @@ public void registerPlayer(MapleCharacter chr) {\n \t\t}\n \t}  \n         \n-        public void exitPlayer(MapleCharacter chr) {    //unused\n+        public void exitPlayer(MapleCharacter chr) {\n \t\tif (chr == null || !chr.isLoggedin()){\n \t\t\treturn;\n \t\t}\n@@ -299,7 +303,7 @@ public void run() {\n                                                 sL.unlock();\n                                         }\n                                 } catch (ScriptException | NoSuchMethodException ex) {\n-                                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, \"Event '\" + em.getName() + \"' does not implement scheduledTimeout function.\", ex);\n                                 }\n                         }\n                 }, time);\n@@ -324,7 +328,7 @@ public void run() {\n                                                                 sL.unlock();\n                                                         }\n                                                 } catch (ScriptException | NoSuchMethodException ex) {\n-                                                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                                                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, \"Event '\" + em.getName() + \"' does not implement scheduledTimeout function.\", ex);\n                                                 }\n                                         }\n                                 }, nextTime);\n@@ -397,7 +401,7 @@ public void unregisterPlayer(MapleCharacter chr) {\n                                 sL.unlock();\n                         }\n                 } catch (ScriptException | NoSuchMethodException ex) {\n-                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, \"Event '\" + em.getName() + \"' does not implement playerUnregistered function.\", ex);\n                 }\n                         \n                 wL.lock();"}, {"sha": "ba20128fd137616f1bf3192c9eed569d635f4aee", "filename": "src/scripting/event/EventManager.java", "status": "modified", "additions": 232, "deletions": 122, "changes": 354, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/event/EventManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/event/EventManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventManager.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -48,10 +48,14 @@\n import server.life.MapleLifeFactory;\n import server.quest.MapleQuest;\n \n-import java.util.List;\n import java.util.ArrayList;\n+import java.util.HashSet;\n import java.util.LinkedList;\n+import java.util.List;\n import java.util.Queue;\n+import java.util.Set;\n+import java.util.concurrent.Semaphore;\n+import java.util.concurrent.TimeUnit;\n import net.server.audit.LockCollector;\n import net.server.audit.locks.MonitoredLockType;\n import net.server.audit.locks.MonitoredReentrantLock;\n@@ -74,12 +78,16 @@\n     private final Map<Integer, Integer> queuedGuildLeaders = new HashMap<>();\n     private List<Boolean> openedLobbys;\n     private List<EventInstanceManager> readyInstances = new LinkedList<>();\n-    private Integer readyId = 0;\n+    private Integer readyId = 0, onLoadInstances = 0;\n     private Properties props = new Properties();\n     private String name;\n     private MonitoredReentrantLock lobbyLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.EM_LOBBY);\n     private MonitoredReentrantLock queueLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.EM_QUEUE);\n-\n+    private MonitoredReentrantLock startLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.EM_START);\n+    \n+    private Set<Integer> playerPermit = new HashSet<>();\n+    private Semaphore startSemaphore = new Semaphore(7);\n+    \n     private static final int maxLobbys = 8;     // an event manager holds up to this amount of concurrent lobbys\n     \n     public EventManager(Channel cserv, Invocable iv, String name) {\n@@ -114,6 +122,7 @@ public void cancel() {  // make sure to only call this when there are NO PLAYERS\n         try {\n             readyEims = new ArrayList<>(readyInstances);\n             readyInstances.clear();\n+            onLoadInstances = Integer.MIN_VALUE / 2;\n         } finally {\n             queueLock.unlock();\n         }\n@@ -143,6 +152,7 @@ public void run() {\n     private void emptyLocks() {\n         lobbyLock = lobbyLock.dispose();\n         queueLock = queueLock.dispose();\n+        startLock = startLock.dispose();\n     }\n     \n     private static List<Integer> convertToIntegerArray(List<Double> list) {\n@@ -333,33 +343,50 @@ public boolean startInstance(int lobbyId, MapleExpedition exped) {\n     //Expedition method: starts an expedition\n     public boolean startInstance(int lobbyId, MapleExpedition exped, MapleCharacter leader) {\n         try {\n-            if(lobbyId == -1) {\n-                lobbyId = availableLobbyInstance();\n-                if(lobbyId == -1) return false;\n-            }\n-            else {\n-                if(!startLobbyInstance(lobbyId)) return false;\n-            }\n-            \n-            EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", leader.getClient().getChannel()));\n-            if(eim == null) {\n-                if(lobbyId > -1) {\n-                    setLockLobby(lobbyId, false);\n+            if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n+                playerPermit.add(leader.getId());\n+                \n+                startLock.lock();\n+                try {\n+                    try {\n+                        if(lobbyId == -1) {\n+                            lobbyId = availableLobbyInstance();\n+                            if(lobbyId == -1) return false;\n+                        }\n+                        else {\n+                            if(!startLobbyInstance(lobbyId)) return false;\n+                        }\n+                        \n+                        EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", leader.getClient().getChannel()));\n+                        if(eim == null) {\n+                            if(lobbyId > -1) {\n+                                setLockLobby(lobbyId, false);\n+                            }\n+                            return false;\n+                        }\n+                        instanceLocks.put(eim.getName(), lobbyId);\n+                        eim.setLeader(leader);\n+\n+                        exped.start();\n+                        eim.registerExpedition(exped);\n+\n+                        eim.startEvent();\n+                    } catch (ScriptException | NoSuchMethodException ex) {\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                    }\n+\n+                    return true;\n+                } finally {\n+                    startLock.unlock();\n+                    playerPermit.remove(leader.getId());\n+                    startSemaphore.release();\n                 }\n-                return false;\n             }\n-            instanceLocks.put(eim.getName(), lobbyId);\n-            eim.setLeader(leader);\n-            \n-            exped.start();\n-            eim.registerExpedition(exped);\n-            \n-            eim.startEvent();\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+        } catch(InterruptedException ie) {\n+            playerPermit.remove(leader.getId());\n         }\n         \n-        return true;\n+        return false;\n     }\n \n     //Regular method: player \n@@ -373,36 +400,53 @@ public boolean startInstance(int lobbyId, MapleCharacter leader) {\n     \n     public boolean startInstance(int lobbyId, MapleCharacter chr, MapleCharacter leader, int difficulty) {\n         try {\n-            if(lobbyId == -1) {\n-                lobbyId = availableLobbyInstance();\n-                if(lobbyId == -1) {\n-                    return false;\n-                }\n-            }\n-            else {\n-                if(!startLobbyInstance(lobbyId)) {\n-                    return false;\n-                }\n-            }\n-            \n-            EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", difficulty, (lobbyId > -1) ? lobbyId : leader.getId()));\n-            if(eim == null) {\n-                if(lobbyId > -1) {\n-                    setLockLobby(lobbyId, false);\n+            if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n+                playerPermit.add(leader.getId());\n+                \n+                startLock.lock();\n+                try {\n+                    try {\n+                        if(lobbyId == -1) {\n+                            lobbyId = availableLobbyInstance();\n+                            if(lobbyId == -1) {\n+                                return false;\n+                            }\n+                        }\n+                        else {\n+                            if(!startLobbyInstance(lobbyId)) {\n+                                return false;\n+                            }\n+                        }\n+                        \n+                        EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", difficulty, (lobbyId > -1) ? lobbyId : leader.getId()));\n+                        if(eim == null) {\n+                            if(lobbyId > -1) {\n+                                setLockLobby(lobbyId, false);\n+                            }\n+                            return false;\n+                        }\n+                        instanceLocks.put(eim.getName(), lobbyId);\n+                        eim.setLeader(leader);\n+\n+                        if(chr != null) eim.registerPlayer(chr);\n+\n+                        eim.startEvent();\n+                    } catch (ScriptException | NoSuchMethodException ex) {\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                    }\n+\n+                    return true;\n+                } finally {\n+                    startLock.unlock();\n+                    playerPermit.remove(leader.getId());\n+                    startSemaphore.release();\n                 }\n-                return false;\n             }\n-            instanceLocks.put(eim.getName(), lobbyId);\n-            eim.setLeader(leader);\n-            \n-            if(chr != null) eim.registerPlayer(chr);\n-            \n-            eim.startEvent();\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+        } catch(InterruptedException ie) {\n+            playerPermit.remove(leader.getId());\n         }\n         \n-        return true;\n+        return false;\n     }    \n     \n     //PQ method: starts a PQ\n@@ -416,33 +460,50 @@ public boolean startInstance(int lobbyId, MapleParty party, MapleMap map) {\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, MapleCharacter leader) {\n         try {\n-            if(lobbyId == -1) {\n-                lobbyId = availableLobbyInstance();\n-                if(lobbyId == -1) return false;\n-            }\n-            else {\n-                if(!startLobbyInstance(lobbyId)) return false;\n-            }\n-            \n-            EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", (Object) null));\n-            if(eim == null) {\n-                if(lobbyId > -1) {\n-                    setLockLobby(lobbyId, false);\n+            if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n+                playerPermit.add(leader.getId());\n+                \n+                startLock.lock();\n+                try {\n+                    try {\n+                        if(lobbyId == -1) {\n+                            lobbyId = availableLobbyInstance();\n+                            if(lobbyId == -1) return false;\n+                        }\n+                        else {\n+                            if(!startLobbyInstance(lobbyId)) return false;\n+                        }\n+                        \n+                        EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", (Object) null));\n+                        if(eim == null) {\n+                            if(lobbyId > -1) {\n+                                setLockLobby(lobbyId, false);\n+                            }\n+                            return false;\n+                        }\n+                        instanceLocks.put(eim.getName(), lobbyId);\n+                        eim.setLeader(leader);\n+\n+                        eim.registerParty(party, map);\n+                        party.setEligibleMembers(null);\n+\n+                        eim.startEvent();\n+                    } catch (ScriptException | NoSuchMethodException ex) {\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                    }\n+\n+                    return true;\n+                } finally {\n+                    startLock.unlock();\n+                    playerPermit.remove(leader.getId());\n+                    startSemaphore.release();\n                 }\n-                return false;\n             }\n-            instanceLocks.put(eim.getName(), lobbyId);\n-            eim.setLeader(leader);\n-            \n-            eim.registerParty(party, map);\n-            party.setEligibleMembers(null);\n-            \n-            eim.startEvent();\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+        } catch(InterruptedException ie) {\n+            playerPermit.remove(leader.getId());\n         }\n         \n-        return true;\n+        return false;\n     }\n     \n     //PQ method: starts a PQ with a difficulty level, requires function setup(difficulty, leaderid) instead of setup()\n@@ -456,33 +517,50 @@ public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, int di\n     \n     public boolean startInstance(int lobbyId, MapleParty party, MapleMap map, int difficulty, MapleCharacter leader) {\n         try {\n-            if(lobbyId == -1) {\n-                lobbyId = availableLobbyInstance();\n-                if(lobbyId == -1) return false;\n-            }\n-            else {\n-                if(!startLobbyInstance(lobbyId)) return false;\n-            }\n-            \n-            EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", difficulty, (lobbyId > -1) ? lobbyId : party.getLeaderId()));\n-            if(eim == null) {\n-                if(lobbyId > -1) {\n-                    setLockLobby(lobbyId, false);\n+            if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n+                playerPermit.add(leader.getId());\n+                \n+                startLock.lock();\n+                try {\n+                    try {\n+                        if(lobbyId == -1) {\n+                            lobbyId = availableLobbyInstance();\n+                            if(lobbyId == -1) return false;\n+                        }\n+                        else {\n+                            if(!startLobbyInstance(lobbyId)) return false;\n+                        }\n+                        \n+                        EventInstanceManager eim = (EventInstanceManager) (iv.invokeFunction(\"setup\", difficulty, (lobbyId > -1) ? lobbyId : party.getLeaderId()));\n+                        if(eim == null) {\n+                            if(lobbyId > -1) {\n+                                setLockLobby(lobbyId, false);\n+                            }\n+                            return false;\n+                        }\n+                        instanceLocks.put(eim.getName(), lobbyId);\n+                        eim.setLeader(leader);\n+\n+                        eim.registerParty(party, map);\n+                        party.setEligibleMembers(null);\n+\n+                        eim.startEvent();\n+                    } catch (ScriptException | NoSuchMethodException ex) {\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                    }\n+\n+                    return true;\n+                } finally {\n+                    startLock.unlock();\n+                    playerPermit.remove(leader.getId());\n+                    startSemaphore.release();\n                 }\n-                return false;\n             }\n-            instanceLocks.put(eim.getName(), lobbyId);\n-            eim.setLeader(leader);\n-            \n-            eim.registerParty(party, map);\n-            party.setEligibleMembers(null);\n-            \n-            eim.startEvent();\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+        } catch(InterruptedException ie) {\n+            playerPermit.remove(leader.getId());\n         }\n         \n-        return true;\n+        return false;\n     }\n \n     //non-PQ method for starting instance\n@@ -500,32 +578,49 @@ public boolean startInstance(int lobbyId, EventInstanceManager eim, String ldr)\n     \n     public boolean startInstance(int lobbyId, EventInstanceManager eim, String ldr, MapleCharacter leader) {\n         try {\n-            if(lobbyId == -1) {\n-                lobbyId = availableLobbyInstance();\n-                if(lobbyId == -1) return false;\n-            }\n-            else {\n-                if(!startLobbyInstance(lobbyId)) return false;\n-            }\n-            \n-            if(eim == null) {\n-                if(lobbyId > -1) {\n-                    setLockLobby(lobbyId, false);\n+            if(!playerPermit.contains(leader.getId()) && startSemaphore.tryAcquire(7777, TimeUnit.MILLISECONDS)) {\n+                playerPermit.add(leader.getId());\n+                \n+                startLock.lock();\n+                try {\n+                    try {\n+                        if(lobbyId == -1) {\n+                            lobbyId = availableLobbyInstance();\n+                            if(lobbyId == -1) return false;\n+                        }\n+                        else {\n+                            if(!startLobbyInstance(lobbyId)) return false;\n+                        }\n+\n+                        if(eim == null) {\n+                            if(lobbyId > -1) {\n+                                setLockLobby(lobbyId, false);\n+                            }\n+                            return false;\n+                        }\n+                        instanceLocks.put(eim.getName(), lobbyId);\n+                        eim.setLeader(leader);\n+                        \n+                        iv.invokeFunction(\"setup\", eim);\n+                        eim.setProperty(\"leader\", ldr);\n+\n+                        eim.startEvent();\n+                    } catch (ScriptException | NoSuchMethodException ex) {\n+                        Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+                    }\n+\n+                    return true;\n+                } finally {\n+                    startLock.unlock();\n+                    playerPermit.remove(leader.getId());\n+                    startSemaphore.release();\n                 }\n-                return false;\n             }\n-            instanceLocks.put(eim.getName(), lobbyId);\n-            eim.setLeader(leader);\n-            \n-            iv.invokeFunction(\"setup\", eim);\n-            eim.setProperty(\"leader\", ldr);\n-            \n-            eim.startEvent();\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n+        } catch(InterruptedException ie) {\n+            playerPermit.remove(leader.getId());\n         }\n         \n-        return true;\n+        return false;\n     }\n     \n     public List<MaplePartyCharacter> getEligibleParty(MapleParty party) {\n@@ -713,16 +808,31 @@ private EventInstanceManager getReadyInstance() {\n     }\n     \n     private void instantiateQueuedInstance() {\n+        int nextEventId;\n         queueLock.lock();\n         try {\n-            if(readyInstances.size() >= Math.ceil((double)maxLobbys / 3.0)) return;\n+            if(onLoadInstances <= -1000 || readyInstances.size() + onLoadInstances >= Math.ceil((double)maxLobbys / 3.0)) return;\n             \n-            readyInstances.add(new EventInstanceManager(this, \"sampleName\" + readyId));\n+            onLoadInstances++;\n+            nextEventId = readyId;\n             readyId++;\n         } finally {\n             queueLock.unlock();\n         }\n         \n+        EventInstanceManager eim = new EventInstanceManager(this, \"sampleName\" + nextEventId);\n+        queueLock.lock();\n+        try {\n+            if(onLoadInstances <= -1000) {  // EM already disposed\n+                return;\n+            }\n+            \n+            readyInstances.add(eim);\n+            onLoadInstances--;\n+        } finally {\n+            queueLock.unlock();\n+        }\n+        \n         instantiateQueuedInstance();    // keep filling the queue until reach threshold.\n     }\n     "}, {"sha": "69f59294e0c447b5cf62bfcb0ecb598f441ff45e", "filename": "src/scripting/npc/NPCConversationManager.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/npc/NPCConversationManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/scripting/npc/NPCConversationManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/npc/NPCConversationManager.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -344,7 +344,9 @@ public void resetMap(int mapid) {\n \n \tpublic void gainCloseness(int closeness) {\n \t\tfor (MaplePet pet : getPlayer().getPets()) {\n-                        if(pet != null) pet.gainClosenessFullness(getPlayer(), closeness, 0, 0);\n+                        if(pet != null) {\n+                                pet.gainClosenessFullness(getPlayer(), closeness, 0, 0);\n+                        }\n \t\t}\n \t}\n "}, {"sha": "3aefc4378a3923badbbc39e097bf0c8c78a04ac5", "filename": "src/server/expeditions/MapleExpedition.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/expeditions/MapleExpedition.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/expeditions/MapleExpedition.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpedition.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -38,7 +38,7 @@\n \n /**\n  *\n- * @author SharpAceX(Alan)\n+ * @author Alan (SharpAceX)\n  */\n public class MapleExpedition {\n "}, {"sha": "8bc09105e9b08e8060e562351afb42551a06c7fc", "filename": "src/server/expeditions/MapleExpeditionType.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/expeditions/MapleExpeditionType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/expeditions/MapleExpeditionType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpeditionType.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -26,7 +26,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public enum MapleExpeditionType {"}, {"sha": "e053d1a5f524884b3a37124d9403fa4b155732f0", "filename": "src/server/gachapon/Ellinia.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Ellinia.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Ellinia.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/Ellinia.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class Ellinia extends GachaponItems {"}, {"sha": "d850c41997f26625f94cb333a731d54b212b8368", "filename": "src/server/gachapon/GachaponItems.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/GachaponItems.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/GachaponItems.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/GachaponItems.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -24,7 +24,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public abstract class GachaponItems {"}, {"sha": "8e28f8f0a5ef1466a55d34e5942fbf3a98f5edb9", "filename": "src/server/gachapon/Global.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Global.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Global.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/Global.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class Global extends GachaponItems {"}, {"sha": "2b31cccb520b1d6bae1c3a79bcff6287c898886c", "filename": "src/server/gachapon/Henesys.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Henesys.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Henesys.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/Henesys.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class Henesys extends GachaponItems {"}, {"sha": "26f0f77c32d6c5fbf4078ce6fc6a3e5bbab199fa", "filename": "src/server/gachapon/KerningCity.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/KerningCity.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/KerningCity.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/KerningCity.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class KerningCity extends GachaponItems {"}, {"sha": "8154bb1790de803de725a47a0594318f3496bcc2", "filename": "src/server/gachapon/MapleGachapon.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/MapleGachapon.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/MapleGachapon.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/MapleGachapon.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -25,7 +25,7 @@\n \n /**\n  *\n- * @author SharpAceX(Alan)\n+ * @author Alan (SharpAceX)\n  */\n public class MapleGachapon {\n "}, {"sha": "b34c69c3dd445f4e1aeac74024c31c0ac99dcfd1", "filename": "src/server/gachapon/MushroomShrine.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/MushroomShrine.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/MushroomShrine.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/MushroomShrine.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class MushroomShrine extends GachaponItems {"}, {"sha": "9477ac325df11b7ae36fd25772eb63bec93b831b", "filename": "src/server/gachapon/NautilusHarbor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/NautilusHarbor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/NautilusHarbor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/NautilusHarbor.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class NautilusHarbor extends GachaponItems {"}, {"sha": "10bfad789e584ba6013c47f8be5243aae6684364", "filename": "src/server/gachapon/NewLeafCity.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/NewLeafCity.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/NewLeafCity.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/NewLeafCity.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class NewLeafCity extends GachaponItems {"}, {"sha": "a1600c3a5d6125d91c82980c6cfc5a1c4185ae58", "filename": "src/server/gachapon/Perion.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Perion.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Perion.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/Perion.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class Perion extends GachaponItems {"}, {"sha": "ba4a9fcf6deb35443e08f9ff586b6d2acbde73d9", "filename": "src/server/gachapon/ShowaSpaFemale.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/ShowaSpaFemale.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/ShowaSpaFemale.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/ShowaSpaFemale.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class ShowaSpaFemale extends GachaponItems {"}, {"sha": "d55f802cb9fe34c82f9eaf704bc85c7696b5c60d", "filename": "src/server/gachapon/ShowaSpaMale.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/ShowaSpaMale.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/ShowaSpaMale.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/ShowaSpaMale.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class ShowaSpaMale extends GachaponItems {"}, {"sha": "0205674bf5b865c400249a89b14f325d8c162870", "filename": "src/server/gachapon/Sleepywood.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Sleepywood.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/gachapon/Sleepywood.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/gachapon/Sleepywood.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -2,7 +2,7 @@\n \n /**\n *\n-* @author SharpAceX(Alan)\n+* @author Alan (SharpAceX)\n */\n \n public class Sleepywood extends GachaponItems {"}, {"sha": "987acefae9a311e6f89223906e11a67d54258162", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 67, "deletions": 7, "changes": 74, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -156,7 +156,8 @@ public int getHp() {\n         return hp.get();\n     }\n     \n-    public void addHp(int hp) {\n+    public synchronized void addHp(int hp) {\n+        if(this.hp.get() <= 0) return;\n         this.hp.addAndGet(hp);\n     }\n     \n@@ -287,6 +288,10 @@ public synchronized Integer applyAndGetHpDamage(int delta, boolean stayAlive) {\n         }\n     }\n     \n+    public synchronized void disposeMapObject() {     // mob is no longer associated with the map it was in\n+        hp.set(-1);\n+    }\n+    \n     public void broadcastMobHpBar(MapleCharacter from) {\n         if (hasBossHPBar()) {\n             from.setPlayerAggro(this.hashCode());\n@@ -307,13 +312,58 @@ public void broadcastMobHpBar(MapleCharacter from) {\n         }\n     }\n     \n+    public boolean damage(MapleCharacter attacker, int damage, boolean stayAlive) {\n+        boolean lastHit = false;\n+        \n+        this.lockMonster();\n+        try {\n+            if (!this.isAlive()) {\n+                return false;\n+            }\n+\n+            /* pyramid not implemented\n+            Pair<Integer, Integer> cool = this.getStats().getCool();\n+            if (cool != null) {\n+                Pyramid pq = (Pyramid) chr.getPartyQuest();\n+                if (pq != null) {\n+                    if (damage > 0) {\n+                        if (damage >= cool.getLeft()) {\n+                            if ((Math.random() * 100) < cool.getRight()) {\n+                                pq.cool();\n+                            } else {\n+                                pq.kill();\n+                            }\n+                        } else {\n+                            pq.kill();\n+                        }\n+                    } else {\n+                        pq.miss();\n+                    }\n+                    killed = true;\n+                }\n+            }\n+            */\n+\n+            if (damage > 0) {\n+                this.applyDamage(attacker, damage, stayAlive);\n+                if (!this.isAlive()) {  // monster just died\n+                    lastHit = true;\n+                }\n+            }\n+        } finally {\n+            this.unlockMonster();\n+        }\n+        \n+        return lastHit;\n+    }\n+    \n     /**\n      *\n      * @param from the player that dealt the damage\n      * @param damage\n      * @param stayAlive\n      */\n-    public synchronized void damage(MapleCharacter from, int damage, boolean stayAlive) {\n+    private void applyDamage(MapleCharacter from, int damage, boolean stayAlive) {\n         Integer trueDamage = applyAndGetHpDamage(damage, stayAlive);\n         if (trueDamage == null) {\n             return;\n@@ -628,10 +678,8 @@ private void dispatchUpdateQuestMobCount() {\n         }\n     }\n     \n-    public synchronized void dispatchMonsterKilled(boolean hasKiller) {\n-        if(!hasKiller) {\n-            dispatchUpdateQuestMobCount();\n-        }\n+    public void dispatchMonsterKilled(boolean hasKiller) {\n+        processMonsterKilled(hasKiller);\n         \n         EventInstanceManager eim = getMap().getEventInstance();\n         if (eim != null) {\n@@ -641,6 +689,12 @@ public synchronized void dispatchMonsterKilled(boolean hasKiller) {\n                 eim.friendlyKilled(this, hasKiller);\n             }\n         }\n+    }\n+    \n+    private synchronized void processMonsterKilled(boolean hasKiller) {\n+        if(!hasKiller) {\n+            dispatchUpdateQuestMobCount();\n+        }\n         \n         MonsterListener[] listenersList;\n         statiLock.lock();\n@@ -1321,7 +1375,13 @@ public void run() {\n                 }\n             }\n             if (damage > 0) {\n-                damage(chr, damage, true);\n+                lockMonster();\n+                try {\n+                    applyDamage(chr, damage, true);\n+                } finally {\n+                    unlockMonster();\n+                }\n+                \n                 if (type == 1) {\n                     map.broadcastMessage(MaplePacketCreator.damageMonster(getObjectId(), damage), getPosition());\n                 } else if (type == 2) {"}, {"sha": "5ebe8131b0f7c71a41f7c6a2356f9a5664f0bc8b", "filename": "src/server/life/SpawnPoint.java", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/life/SpawnPoint.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/life/SpawnPoint.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/SpawnPoint.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -24,6 +24,7 @@\n import client.MapleCharacter;\n import java.awt.Point;\n import java.util.concurrent.atomic.AtomicInteger;\n+import net.server.Server;\n \n public class SpawnPoint {\n     private int monster, mobTime, team, fh, f;\n@@ -42,7 +43,7 @@ public SpawnPoint(final MapleMonster monster, Point pos, boolean immobile, int m\n         this.f = monster.getF();\n         this.immobile = immobile;\n         this.mobInterval = mobInterval;\n-        this.nextPossibleSpawn = System.currentTimeMillis();\n+        this.nextPossibleSpawn = Server.getInstance().getCurrentTime();\n     }\n     \n     public int getSpawned() {\n@@ -61,7 +62,7 @@ public boolean shouldSpawn() {\n     \tif (denySpawn || mobTime < 0 || spawnedMonsters.get() > 0) {\n             return false;\n         }\n-        return nextPossibleSpawn <= System.currentTimeMillis();\n+        return nextPossibleSpawn <= Server.getInstance().getCurrentTime();\n     }\n \n     public boolean shouldForceSpawn() {\n@@ -82,7 +83,7 @@ public MapleMonster getMonster() {\n         mob.addListener(new MonsterListener() {\n             @Override\n             public void monsterKilled(int aniTime) {\n-                nextPossibleSpawn = System.currentTimeMillis();\n+                nextPossibleSpawn = Server.getInstance().getCurrentTime();\n                 if (mobTime > 0) {\n                     nextPossibleSpawn += mobTime * 1000;\n                 } else {\n@@ -98,7 +99,7 @@ public void monsterDamaged(MapleCharacter from, int trueDmg) {}\n             public void monsterHealed(int trueHeal) {}\n         });\n         if (mobTime == 0) {\n-            nextPossibleSpawn = System.currentTimeMillis() + mobInterval;\n+            nextPossibleSpawn = Server.getInstance().getCurrentTime() + mobInterval;\n         }\n         return mob;\n     }"}, {"sha": "f59bcd3e8328bd995159ced16430d2944945492e", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 124, "deletions": 160, "changes": 284, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -295,28 +295,21 @@ public void setTimeLimit(int timeLimit) {\n     public int getTimeLeft() {\n         return (int) ((timeLimit - System.currentTimeMillis()) / 1000);\n     }\n-\n+    \n     public void setReactorState() {\n-        chrRLock.lock();\n-        objectRLock.lock();\n-        try {\n-            for (MapleMapObject o : mapobjects.values()) {\n-                if (o.getType() == MapleMapObjectType.REACTOR) {\n-                    if (((MapleReactor) o).getState() < 1) {\n-                        MapleReactor mr = (MapleReactor) o;\n-                        mr.lockReactor();\n-                        try {\n-                            mr.resetReactorActions(1);\n-                            broadcastMessage(MaplePacketCreator.triggerReactor((MapleReactor) o, 1));\n-                        } finally {\n-                            mr.unlockReactor();\n-                        }\n+        for (MapleMapObject o : getMapObjects()) {\n+            if (o.getType() == MapleMapObjectType.REACTOR) {\n+                if (((MapleReactor) o).getState() < 1) {\n+                    MapleReactor mr = (MapleReactor) o;\n+                    mr.lockReactor();\n+                    try {\n+                        mr.resetReactorActions(1);\n+                        broadcastMessage(MaplePacketCreator.triggerReactor((MapleReactor) o, 1));\n+                    } finally {\n+                        mr.unlockReactor();\n                     }\n                 }\n             }\n-        } finally {\n-            objectRLock.unlock();\n-            chrRLock.unlock();\n         }\n     }\n     \n@@ -1191,45 +1184,7 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n             }\n         }\n         if (monster.isAlive()) {\n-            boolean killed = false;\n-            monster.lockMonster();\n-            try {\n-                if (!monster.isAlive()) {\n-                    return false;\n-                }\n-                \n-                /* pyramid not implemented\n-                Pair<Integer, Integer> cool = monster.getStats().getCool();\n-                if (cool != null) {\n-                    Pyramid pq = (Pyramid) chr.getPartyQuest();\n-                    if (pq != null) {\n-                        if (damage > 0) {\n-                            if (damage >= cool.getLeft()) {\n-                                if ((Math.random() * 100) < cool.getRight()) {\n-                                    pq.cool();\n-                                } else {\n-                                    pq.kill();\n-                                }\n-                            } else {\n-                                pq.kill();\n-                            }\n-                        } else {\n-                            pq.miss();\n-                        }\n-                        killed = true;\n-                    }\n-                }\n-                */\n-                \n-                if (damage > 0) {\n-                    monster.damage(chr, damage, false);\n-                    if (!monster.isAlive()) {  // monster just died\n-                        killed = true;\n-                    }\n-                }\n-            } finally {\n-                monster.unlockMonster();\n-            }\n+            boolean killed = monster.damage(chr, damage, false);\n             if (monster.getStats().selfDestruction() != null && monster.getStats().selfDestruction().getHp() > -1) {// should work ;p\n                 if (monster.getHp() <= monster.getStats().selfDestruction().getHp()) {\n                     killMonster(monster, chr, true, monster.getStats().selfDestruction().getAction());\n@@ -1268,6 +1223,23 @@ public void broadcastPinkBeanVictory(int channel) {\n         Server.getInstance().getWorld(world).dropMessage(6, \"[VICTORY] In a swift stroke of sorts, the crew that has attempted Pink Bean at channel \" + channel + \" has ultimately defeated it. The Temple of Time shines radiantly once again, the day finally coming back, as the crew that managed to finally conquer it returns victoriously from the battlefield!!\");\n     }\n     \n+    private boolean removeKilledMonsterObject(MapleMonster monster) {\n+        monster.lockMonster();\n+        try {\n+            if(monster.getHp() < 0) {\n+                return false;\n+            }\n+            \n+            spawnedMonstersOnMap.decrementAndGet();\n+            removeMapObject(monster);\n+            monster.disposeMapObject();\n+            \n+            return true;\n+        } finally {\n+            monster.unlockMonster();\n+        }\n+    }\n+    \n     public void killMonster(final MapleMonster monster, final MapleCharacter chr, final boolean withDrops) {\n         killMonster(monster, chr, withDrops, 1);\n     }\n@@ -1276,93 +1248,89 @@ public void killMonster(final MapleMonster monster, final MapleCharacter chr, fi\n         if(monster == null) return;\n         \n         if (chr == null) {\n-            spawnedMonstersOnMap.decrementAndGet();\n-            monster.setHpZero();\n-            removeMapObject(monster);\n-            \n-            monster.dispatchMonsterKilled(false);\n-            broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n-            return;\n-        }\n-        if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n-            AutobanFactory.GENERAL.alert(chr, \" for killing a \" + monster.getName() + \" which is over 30 levels higher.\");\n-        }\n-        /*if (chr.getQuest(MapleQuest.getInstance(29400)).getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-         if (chr.getLevel() >= 120 && monster.getStats().getLevel() >= 120) {\n-         //FIX MEDAL SHET\n-         } else if (monster.getStats().getLevel() >= chr.getLevel()) {\n-         }\n-         }*/\n-        int buff = monster.getBuffToGive();\n-        if (buff > -1) {\n-            MapleItemInformationProvider mii = MapleItemInformationProvider.getInstance();\n-            for (MapleMapObject mmo : this.getPlayers()) {\n-                MapleCharacter character = (MapleCharacter) mmo;\n-                if (character.isAlive()) {\n-                    MapleStatEffect statEffect = mii.getItemEffect(buff);\n-                    character.getClient().announce(MaplePacketCreator.showOwnBuffEffect(buff, 1));\n-                    broadcastMessage(character, MaplePacketCreator.showBuffeffect(character.getId(), buff, 1), false);\n-                    statEffect.applyTo(character);\n-                }\n-            }\n-        }\n-        \n-        spawnedMonstersOnMap.decrementAndGet();\n-        monster.setHpZero();\n-        removeMapObject(monster);\n-        \n-        if (monster.getCP() > 0 && chr.getCarnival() != null) {\n-            chr.getCarnivalParty().addCP(chr, monster.getCP());\n-            chr.announce(MaplePacketCreator.updateCP(chr.getCP(), chr.getObtainedCP()));\n-            broadcastMessage(MaplePacketCreator.updatePartyCP(chr.getCarnivalParty()));\n-            //they drop items too ):\n-        }\n-        if (monster.getId() >= 8800003 && monster.getId() <= 8800010) {\n-            boolean makeZakReal = true;\n-            Collection<MapleMapObject> objects = getMapObjects();\n-            for (MapleMapObject object : objects) {\n-                MapleMonster mons = getMonsterByOid(object.getObjectId());\n-                if (mons != null) {\n-                    if (mons.getId() >= 8800003 && mons.getId() <= 8800010) {\n-                        makeZakReal = false;\n-                        break;\n+            if(removeKilledMonsterObject(monster)) {\n+                monster.dispatchMonsterKilled(false);\n+                broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n+            }\n+        } else {\n+            if(removeKilledMonsterObject(monster)) {\n+                if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n+                    AutobanFactory.GENERAL.alert(chr, \" for killing a \" + monster.getName() + \" which is over 30 levels higher.\");\n+                }\n+                /*if (chr.getQuest(MapleQuest.getInstance(29400)).getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                 if (chr.getLevel() >= 120 && monster.getStats().getLevel() >= 120) {\n+                 //FIX MEDAL SHET\n+                 } else if (monster.getStats().getLevel() >= chr.getLevel()) {\n+                 }\n+                 }*/\n+                int buff = monster.getBuffToGive();\n+                if (buff > -1) {\n+                    MapleItemInformationProvider mii = MapleItemInformationProvider.getInstance();\n+                    for (MapleMapObject mmo : this.getPlayers()) {\n+                        MapleCharacter character = (MapleCharacter) mmo;\n+                        if (character.isAlive()) {\n+                            MapleStatEffect statEffect = mii.getItemEffect(buff);\n+                            character.getClient().announce(MaplePacketCreator.showOwnBuffEffect(buff, 1));\n+                            broadcastMessage(character, MaplePacketCreator.showBuffeffect(character.getId(), buff, 1), false);\n+                            statEffect.applyTo(character);\n+                        }\n                     }\n                 }\n-            }\n-            if (makeZakReal) {\n-                MapleMap map = chr.getMap();\n-                \n-                for (MapleMapObject object : objects) {\n-                    MapleMonster mons = map.getMonsterByOid(object.getObjectId());\n-                    if (mons != null) {\n-                        if (mons.getId() == 8800000) {\n-                            makeMonsterReal(mons);\n-                            updateMonsterController(mons);\n-                            break;\n+\n+                if (monster.getCP() > 0 && chr.getCarnival() != null) {\n+                    chr.getCarnivalParty().addCP(chr, monster.getCP());\n+                    chr.announce(MaplePacketCreator.updateCP(chr.getCP(), chr.getObtainedCP()));\n+                    broadcastMessage(MaplePacketCreator.updatePartyCP(chr.getCarnivalParty()));\n+                    //they drop items too ):\n+                }\n+                if (monster.getId() >= 8800003 && monster.getId() <= 8800010) {\n+                    boolean makeZakReal = true;\n+                    Collection<MapleMapObject> objects = getMapObjects();\n+                    for (MapleMapObject object : objects) {\n+                        MapleMonster mons = getMonsterByOid(object.getObjectId());\n+                        if (mons != null) {\n+                            if (mons.getId() >= 8800003 && mons.getId() <= 8800010) {\n+                                makeZakReal = false;\n+                                break;\n+                            }\n+                        }\n+                    }\n+                    if (makeZakReal) {\n+                        MapleMap map = chr.getMap();\n+\n+                        for (MapleMapObject object : objects) {\n+                            MapleMonster mons = map.getMonsterByOid(object.getObjectId());\n+                            if (mons != null) {\n+                                if (mons.getId() == 8800000) {\n+                                    makeMonsterReal(mons);\n+                                    updateMonsterController(mons);\n+                                    break;\n+                                }\n+                            }\n                         }\n                     }\n                 }\n-            }\n-        }\n-        \n-        MapleCharacter dropOwner = monster.killBy(chr);\n-        if (withDrops && !monster.dropsDisabled()) {\n-            if (dropOwner == null) {\n-                dropOwner = chr;\n-            }\n-            dropFromMonster(dropOwner, monster, false);\n-        }\n-        \n-        if (monster.hasBossHPBar()) {\n-            for(MapleCharacter mc : this.getAllPlayers()) {\n-                if(mc.getTargetHpBarHash() == monster.hashCode()) {\n-                    mc.resetPlayerAggro();\n+\n+                MapleCharacter dropOwner = monster.killBy(chr);\n+                if (withDrops && !monster.dropsDisabled()) {\n+                    if (dropOwner == null) {\n+                        dropOwner = chr;\n+                    }\n+                    dropFromMonster(dropOwner, monster, false);\n                 }\n+\n+                if (monster.hasBossHPBar()) {\n+                    for(MapleCharacter mc : this.getAllPlayers()) {\n+                        if(mc.getTargetHpBarHash() == monster.hashCode()) {\n+                            mc.resetPlayerAggro();\n+                        }\n+                    }\n+                }\n+\n+                monster.dispatchMonsterKilled(true);\n+                broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n             }\n         }\n-        \n-        monster.dispatchMonsterKilled(true);\n-        broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n     }\n \n     public void killFriendlies(MapleMonster mob) {\n@@ -1407,11 +1375,9 @@ public void softKillAllMonsters() {\n                 continue;\n             }\n             \n-            spawnedMonstersOnMap.decrementAndGet();\n-            monster.setHpZero();\n-            removeMapObject(monster);\n-            \n-            monster.dispatchMonsterKilled(false);\n+            if(removeKilledMonsterObject(monster)) {\n+                monster.dispatchMonsterKilled(false);\n+            }\n         }\n     }\n \n@@ -2228,33 +2194,31 @@ public void searchItemReactors(final MapleReactor react) {\n             int reactItem = reactProp.getLeft(), reactQty = reactProp.getRight();\n             Rectangle reactArea = react.getArea();\n             \n-            List<MapleMapItem> list = new ArrayList<>();\n+            List<MapleMapItem> list;\n             objectRLock.lock();\n             try {\n-                for(MapleMapItem mmi : droppedItems.keySet()) {\n-                    mmi.lockItem();\n-                    try {\n-                        if(!mmi.isPickedUp()) {\n-                            list.add(mmi);\n-                        }\n-                    } finally {\n-                        mmi.unlockItem();\n-                    }\n-                }\n+                list = new ArrayList<>(droppedItems.keySet());\n             } finally {\n                 objectRLock.unlock();\n             }\n             \n             for(final MapleMapItem drop : list) {\n-                final Item item = drop.getItem();\n-            \n-                if (item != null && reactItem == item.getItemId() && reactQty == item.getQuantity()) {\n-                    if (reactArea.contains(drop.getPosition())) {\n-                        MapleClient owner = drop.getOwnerClient();\n-                        if(owner != null) {\n-                            registerMapSchedule(new ActivateItemReactor(drop, react, owner), 5000);\n+                drop.lockItem();\n+                try {\n+                    if(!drop.isPickedUp()) {\n+                        final Item item = drop.getItem();\n+                        \n+                        if (item != null && reactItem == item.getItemId() && reactQty == item.getQuantity()) {\n+                            if (reactArea.contains(drop.getPosition())) {\n+                                MapleClient owner = drop.getOwnerClient();\n+                                if(owner != null) {\n+                                    registerMapSchedule(new ActivateItemReactor(drop, react, owner), 5000);\n+                                }\n+                            }\n                         }\n                     }\n+                } finally {\n+                    drop.unlockItem();\n                 }\n             }\n         }\n@@ -2365,7 +2329,7 @@ public void addPlayer(final MapleCharacter chr) {\n         try {\n             characters.add(chr);\n             chrSize = characters.size();\n-                    \n+            \n             addPartyMemberInternal(chr);\n             itemMonitorTimeout = 1;\n         } finally {"}, {"sha": "853a038c1e856822aa82a0fe69214cb36ae649c5", "filename": "src/server/maps/MapleMiniDungeonInfo.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/maps/MapleMiniDungeonInfo.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/maps/MapleMiniDungeonInfo.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMiniDungeonInfo.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -23,7 +23,7 @@\n \n /**\n  *\n- * @author SharpAceX(Alan)\n+ * @author Alan (SharpAceX)\n  */\n \n public enum MapleMiniDungeonInfo {"}, {"sha": "f066d7474039dfa80c71b416ae0ac91f9555b05d", "filename": "src/server/partyquest/MonsterCarnivalParty.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/partyquest/MonsterCarnivalParty.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/partyquest/MonsterCarnivalParty.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/partyquest/MonsterCarnivalParty.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -7,7 +7,7 @@\n import tools.MaplePacketCreator;\n \n /**\n- * @author Rob //Thanks :3  - LOST MOTIVATION >=(\n+ * @author Rob\n  */\n public class MonsterCarnivalParty {\n "}, {"sha": "30895ffa6e3de285ac147c69aa0653ebe098b5e6", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -540,6 +540,17 @@ public int getMedalRequirement() {\n                 return medalid != null ? medalid : -1;\n         }\n         \n+        public int getNpcRequirement(boolean complete) {\n+                Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !complete ? startReqs : completeReqs;\n+                \n+                MapleQuestRequirement mqr = reqs.get(MapleQuestRequirementType.NPC);\n+                if (mqr != null) {\n+                        return ((NpcRequirement) mqr).get();\n+                } else {\n+                        return -1;\n+                }\n+        }\n+        \n \tpublic static void loadAllQuest() {\n \t\tquestInfo = questData.getData(\"QuestInfo.img\");\n \t\tquestReq = questData.getData(\"Check.img\");"}, {"sha": "1e7317d05ff742eec3a2be8439114df9979fab17", "filename": "src/server/quest/requirements/NpcRequirement.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/requirements/NpcRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/requirements/NpcRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/NpcRequirement.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -49,4 +49,8 @@ public void processData(MapleData data) {\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n \t\treturn npcid != null && npcid == reqNPC;\n \t}\n+        \n+        public int get() {\n+                return reqNPC;\n+        }\n }"}, {"sha": "e44e9c3111b1a5c913878aee371f17b76c15611e", "filename": "src/server/quest/requirements/PetRequirement.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/requirements/PetRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/server/quest/requirements/PetRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/PetRequirement.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -55,6 +55,8 @@ public void processData(MapleData data) {\n \t@Override\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n \t\tfor(MaplePet pet : chr.getPets()) {\n+                        if(pet == null) continue;   // thanks Arufonsu for showing a NPE occurring here\n+                        \n \t\t\tif(petIDs.contains(pet.getItemId()))\n \t\t\t\treturn true;\n \t\t}"}, {"sha": "389d15952316f0b7608d1e97e95697a1f2c5f116", "filename": "src/tools/MapleLogger.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/tools/MapleLogger.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/tools/MapleLogger.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MapleLogger.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -29,7 +29,7 @@\n /**\n  * Logs packets to console and file.\n  *\n- * @author SharpAceX (Alan)\n+ * @author Alan (SharpAceX)\n  */\n \n public class MapleLogger {"}, {"sha": "88ce4697d50ff6397f7b67f1217577f23e84bf9f", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -863,11 +863,11 @@ private static void addMonsterBookInfo(final MaplePacketLittleEndianWriter mplew\n                 List<MapleCharacter> chars = c.loadCharacters(serverId);\n                 mplew.write((byte) chars.size());\n                 for (MapleCharacter chr : chars) {\n-                        addCharEntry(mplew, chr, false);      \n+                        addCharEntry(mplew, chr, false);\n                 }\n \n                 mplew.write(ServerConstants.ENABLE_PIC ? (c.getPic() == null ? 0 : 1) : 2);\n-                mplew.writeInt(c.getCharacterSlots());\n+                mplew.writeInt(ServerConstants.COLLECTIVE_CHARSLOT ? chars.size() + c.getAvailableCharacterSlots() : c.getCharacterSlots());\n                 return mplew.getPacket();\n         }\n \n@@ -2812,7 +2812,7 @@ private static int doubleToShortBits(double d) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.GIVE_FOREIGN_BUFF.getValue());\n                 mplew.writeInt(cid);\n-                mplew.writeLong(MapleBuffStat.MONSTER_RIDING.getValue()); //Thanks?\n+                mplew.writeLong(MapleBuffStat.MONSTER_RIDING.getValue());\n                 mplew.writeLong(0);\n                 mplew.writeShort(0);\n                 mplew.writeInt(mount.getItemId());\n@@ -6079,14 +6079,14 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] enableReport() { // by snow\n+        public static byte[] enableReport() { // thanks to snow\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter(3);\n                 mplew.writeShort(SendOpcode.CLAIM_STATUS_CHANGED.getValue());\n                 mplew.write(1);\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] giveFinalAttack(int skillid, int time) {//packets found by lailainoob\n+        public static byte[] giveFinalAttack(int skillid, int time) { // packets found thanks to lailainoob\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.GIVE_BUFF.getValue());\n                 mplew.writeLong(0);"}, {"sha": "b179c0e3b59ac9d3a5296a4f980749653569a659", "filename": "wz/Quest.wz/Act.img.xml", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Act.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Act.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Act.img.xml?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -15965,12 +15965,6 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"exp\" value=\"2000\"/>\n-      <imgdir name=\"item\">\n-        <imgdir name=\"0\">\n-          <int name=\"id\" value=\"4001368\"/>\n-          <int name=\"count\" value=\"-1\"/>\n-        </imgdir>\n-      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"28259\">\n@@ -37379,12 +37373,6 @@\n   </imgdir>\n   <imgdir name=\"7103\">\n     <imgdir name=\"0\">\n-      <imgdir name=\"item\">\n-        <imgdir name=\"0\">\n-          <int name=\"id\" value=\"4031179\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"exp\" value=\"78000\"/>"}, {"sha": "cc9c94ab8f2df76dd0ccbb3f0211dd034a3d8c83", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 47, "deletions": 46, "changes": 93, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -32009,6 +32009,28 @@\n   <imgdir name=\"28262\">\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"1061011\"/>\n+      <imgdir name=\"item\">\n+        <imgdir name=\"0\">\n+          <int name=\"id\" value=\"4001371\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+        <imgdir name=\"1\">\n+          <int name=\"id\" value=\"4001367\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+        <imgdir name=\"2\">\n+          <int name=\"id\" value=\"4001368\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+        <imgdir name=\"3\">\n+          <int name=\"id\" value=\"4001369\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+        <imgdir name=\"4\">\n+          <int name=\"id\" value=\"4001370\"/>\n+          <int name=\"count\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"1061011\"/>\n@@ -32034,28 +32056,6 @@\n           <int name=\"state\" value=\"2\"/>\n         </imgdir>\n       </imgdir>\n-      <imgdir name=\"item\">\n-        <imgdir name=\"0\">\n-          <int name=\"id\" value=\"4001371\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-        <imgdir name=\"1\">\n-          <int name=\"id\" value=\"4001367\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-        <imgdir name=\"2\">\n-          <int name=\"id\" value=\"4001368\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-        <imgdir name=\"3\">\n-          <int name=\"id\" value=\"4001369\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-        <imgdir name=\"4\">\n-          <int name=\"id\" value=\"4001370\"/>\n-          <int name=\"count\" value=\"1\"/>\n-        </imgdir>\n-      </imgdir>\n       <imgdir name=\"job\">\n         <int name=\"0\" value=\"100\"/>\n         <int name=\"1\" value=\"110\"/>\n@@ -60894,6 +60894,7 @@\n           <int name=\"state\" value=\"2\"/>\n         </imgdir>\n       </imgdir>\n+      <string name=\"startscript\" value=\"q7103s\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2041021\"/>\n@@ -62678,30 +62679,6 @@\n           <int name=\"id\" value=\"4000176\"/>\n           <int name=\"count\" value=\"2\"/>\n         </imgdir>\n-        <imgdir name=\"10\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000413\"/>\n-        </imgdir>\n-        <imgdir name=\"11\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000414\"/>\n-        </imgdir>\n-        <imgdir name=\"12\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4031901\"/>\n-        </imgdir>\n-        <imgdir name=\"13\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000224\"/>\n-        </imgdir>\n-        <imgdir name=\"14\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000235\"/>\n-        </imgdir>\n-        <imgdir name=\"15\">\n-          <int name=\"count\" value=\"2\"/>\n-          <int name=\"id\" value=\"4000243\"/>\n-        </imgdir>\n         <imgdir name=\"16\">\n           <int name=\"id\" value=\"4000175\"/>\n           <int name=\"count\" value=\"2\"/>\n@@ -62822,6 +62799,30 @@\n           <int name=\"id\" value=\"1072169\"/>\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n+        <imgdir name=\"10\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000413\"/>\n+        </imgdir>\n+        <imgdir name=\"11\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000414\"/>\n+        </imgdir>\n+        <imgdir name=\"12\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4031901\"/>\n+        </imgdir>\n+        <imgdir name=\"13\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000224\"/>\n+        </imgdir>\n+        <imgdir name=\"14\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000235\"/>\n+        </imgdir>\n+        <imgdir name=\"15\">\n+          <int name=\"count\" value=\"2\"/>\n+          <int name=\"id\" value=\"4000243\"/>\n+        </imgdir>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"0\">"}, {"sha": "f1684c735d55f0202b487721a09ea84b103da6a5", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0d47edf1a7fa97d16f8638586f9d2a6ba621904c/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=0d47edf1a7fa97d16f8638586f9d2a6ba621904c", "patch": "@@ -41215,15 +41215,6 @@\n   </imgdir>\n   <imgdir name=\"7103\">\n     <imgdir name=\"0\">\n-      <string name=\"0\" value=\"Only thing we have to do now ...is to make #o8500002# disappear forever... are you ready?\"/>\n-      <imgdir name=\"yes\">\n-        <string name=\"0\" value=\"I&apos;ll explain to you what you need to do from here on out. \\nTo enter the power-generating room, you&apos;ll need to pass either #bForgotten Passage#k or the #bWarped Passage#k. Once you defeat whichever monster that is guarding the passage, you can obtain #b#t4031172:##k, which is needed to enter the power-generating room.\"/>\n-        <string name=\"1\" value=\"Then enter the room through the door in the middle. It&apos;s going to be MUCH quieter than you imagined. The Time Sphere should be hidden in a state undetectable in our eyes... but if you seal up the crack in dimension, the #o8500002#, panicking because its exit route is sealed up, will make its appearance there.\"/>\n-        <string name=\"2\" value=\"Drop the #b#t4031179:##k that I returned to you to seal up whatever crack you see that #o8500002# may have used to enter this dimension in the first place. Then it&apos;ll come out of the Time Sphere and show everyone its true appearance. Please, please kill it and then come back. \\n\\nCollect #r1 #t4031172:##k\\nEliminate #r#o8500001##k\"/>\n-      </imgdir>\n-      <imgdir name=\"no\">\n-        <string name=\"0\" value=\"Oh really. Do you need more time? I&apos;m fully confident that you&apos;ll help me out before the Time Sphere is formed.\"/>\n-      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n       <string name=\"0\" value=\"The Time Sphere is almost complete. Have you eliminated the #o8500002#?\"/>"}]}]},
