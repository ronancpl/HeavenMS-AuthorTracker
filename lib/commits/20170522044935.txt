{"fetchDate": "2019-12-19", "content": [{"sha": "53927576e757571be899ef0f34d4d6bbb64a0aeb", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6NTM5Mjc1NzZlNzU3NTcxYmU4OTllZjBmMzRkNGQ2YmJiNjRhMGFlYg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-22T04:49:35Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-22T04:49:35Z"}, "message": "Scrolls for spike/cold protection + quest completion with equipped items\n\nAdded mechanic for the scrolls for spikes on shoes and cold protection\non capes. Fixed an issue where equipped items were being counted towards\nmaterials for quests, therefore showing odds behaviours when completing\nit. Fixed some minor issues on the dollhouse quest/event.", "tree": {"sha": "9763239e91da7813e039ec92fddba1cf08be3a40", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/9763239e91da7813e039ec92fddba1cf08be3a40"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/53927576e757571be899ef0f34d4d6bbb64a0aeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/53927576e757571be899ef0f34d4d6bbb64a0aeb", "html_url": "https://github.com/ronancpl/HeavenMS/commit/53927576e757571be899ef0f34d4d6bbb64a0aeb", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/53927576e757571be899ef0f34d4d6bbb64a0aeb/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "514656d238f7d0bcd0d5ce92b4e0cccef8a5e254", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/514656d238f7d0bcd0d5ce92b4e0cccef8a5e254", "html_url": "https://github.com/ronancpl/HeavenMS/commit/514656d238f7d0bcd0d5ce92b4e0cccef8a5e254"}], "stats": {"total": 267, "additions": 152, "deletions": 115}, "files": [{"sha": "d6efc59b57468cec2667c757e25fe6a46b883be2", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -239,4 +239,7 @@ Corre\n 21 Maio 2017,\n Refatora\ufffd\ufffdo de c\ufffddigo referente ao m\ufffdtodos de coleta de item pelos jogadores.\n Retiradas inconsist\ufffdncias entre infos de mobbook e \"cart\ufffdo-de-visitas\" do jogador.\n-Foi retirado o gargalo no sistema sempre que jogador incorpora um novo card ao mobbook.\n\\ No newline at end of file\n+Foi retirado o gargalo no sistema sempre que jogador incorpora um novo card ao mobbook.\n+Consertado bug em potencial ao tentar completar quest que requer item equipado.\n+Adi\ufffd\ufffdo de scrolls: Scroll for cold protection, Scroll for spike for shoes.\n+Consertado quest-evento Dollhouse.\n\\ No newline at end of file"}, {"sha": "fa073e16d3573508a448fa811e5fbb7f0fefd6fb", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 31, "deletions": 2, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -3,8 +3,37 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/ItemPickupHandler.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/tools/MaplePacketCreator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/command/Commands.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/HiredMerchant.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleStatEffect.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/AbstractPlayerInteraction.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040020.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040002.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PlayerInteractionHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleItemInformationProvider.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/StorageHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/UseCashItemHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/inventory/Equip.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/event/EventInstanceManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleBuffStat.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleMap.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/MapleCharacter.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2040028.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/PlayerLoggedinHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/EllinPQ.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/constants/ItemConstants.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleReactor.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/MapleDragon.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/npc/world0/2133000.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/client/inventory/MapleInventory.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/scripts/event/DollHouse.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/net/server/channel/handlers/ScrollHandler.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/maps/AbstractMapleMapObject.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/quest/MapleQuestRequirementType.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/scripting/npc/NPCConversationManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/MapleInventoryManipulator.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/quest/actions/PetSkillAction.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/MapleSolaxiaV2/src/server/quest/MapleQuest.java</file>\n         </group>\n     </open-files>\n </project-private>"}, {"sha": "7df693d36a327370f183b3aad7c00cb284fd2128", "filename": "scripts/event/DollHouse.js", "status": "modified", "additions": 25, "deletions": 38, "changes": 63, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/scripts/event/DollHouse.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/scripts/event/DollHouse.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/DollHouse.js?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -24,68 +24,55 @@\n **/\n importPackage(Packages.tools);\n \n-var returnMap;\n-var map;\n+var entryMap = 922000010;\n+var exitMap = 221024400;\n+var eventTime = 10; //10 minutes\n var eim;\n \n function init() {\n     em.setProperty(\"noEntry\",\"false\");\n }\n \n function playerEntry(eim, player) {\n-    returnMap = em.getChannelServer().getMapFactory().getMap(221024400);\n-    eim = em.getInstance(\"DollHouse\");\n-    map = eim.getMapFactory().getMap(922000010);\n-    player.changeMap(map, map.getPortal(0));\n-    map.shuffleReactors();\n+    eim.getInstanceMap(entryMap).shuffleReactors();\n+    eim.setExclusiveItems([4031094]);\n+    \n+    player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n-    em.schedule(\"timeOut\", 600000);\n-    player.getClient().getSession().write(MaplePacketCreator.getClock(600));\n+    \n+    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    eim.startEventTimer(eventTime * 60000);\n }\n \n-\n-\n function playerExit(eim, player) {\n-    em.setProperty(\"noEntry\",\"false\");\n-    player.changeMap(returnMap, returnMap.getPortal(4));\n-    //eim.unregisterPlayer(player);\tneeded no more\n-    em.cancel();\n-    em.disposeInstance(\"DollHouse\");\n+    eim.unregisterPlayer(player);\n     eim.dispose();\n+    em.setProperty(\"noEntry\",\"false\");\n }\n \n-function timeOut() {\n-    em.setProperty(\"noEntry\",\"false\");\n+function scheduledTimeout(eim) {\n     var player = eim.getPlayers().get(0);\n-    player.changeMap(returnMap, returnMap.getPortal(4));\n-    //eim.unregisterPlayer(player);\n-    em.cancel();\n-    em.disposeInstance(\"DollHouse\");\n-    eim.dispose();\n+    playerExit(eim, eim.getPlayers().get(0));\n+    player.changeMap(exitMap, 4);\n }\n \n function playerDisconnected(eim, player) {\n-    em.setProperty(\"noEntry\",\"false\");\n-    player.getMap().removePlayer(player);\n-    player.setMap(returnMap);\n-    //eim.unregisterPlayer(player);\n-    em.cancel();\n-    em.disposeInstance(\"DollHouse\");\n-    eim.dispose();\n+    playerExit(eim, player);\n }\n \n function clear(eim) {\n-    em.setProperty(\"noEntry\",\"false\");\n     var player = eim.getPlayers().get(0);\n-    player.changeMap(returnMap, returnMap.getPortal(4));\n-    //eim.unregisterPlayer(player);\n-    em.cancel();\n-    em.disposeInstance(\"DollHouse\");\n+    eim.unregisterPlayer(player);\n+    player.changeMap(exitMap, 4);\n+    \n     eim.dispose();\n+    em.setProperty(\"noEntry\",\"false\");\n }\n \n-function cancelSchedule() {\n+function changedMap(eim, chr, mapid) {\n+    if(mapid != entryMap) playerExit(eim, chr);\n }\n \n-function dispose() {\n-}\n+function cancelSchedule() {}\n+\n+function dispose() {}"}, {"sha": "fe92011bf5e104cb4fe96f758a8dab907695342e", "filename": "scripts/npc/world0/2040028.js", "status": "modified", "additions": 29, "deletions": 14, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/scripts/npc/world0/2040028.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/scripts/npc/world0/2040028.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2040028.js?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -24,24 +24,39 @@\n */\n \n var greeting;\n+var status;\n \n function start() {\n-    var greeting = \"Thank you for finding the pendulum. Are you ready to return to Eos Tower?\";\n-    if (cm.isQuestStarted(3230)) {\n-        if (cm.haveItem(4031094)) {\n-            cm.completeQuest(3230);\n-            cm.gainItem(4031094, -1);\n-        } else\n-            greeting = \"You haven't found the pendulum yet. Do you want to go back to Eos Tower?\";\n-    }\n-    cm.sendYesNo(greeting);\n+    status = -1;\n+    action(1, 0, 0);\n }\n \n function action(mode, type, selection) {\n-    if (mode > 0) {\n-        var em = cm.getEventManager(\"DollHouse\");\n-        var eim = em.getInstance(\"DollHouse\");\n-        eim.exitPlayer(cm.getPlayer());\n+    if (mode == -1) {\n+        cm.dispose();\n+    } else {\n+        if (mode == 0 && status == 0) {\n+            cm.dispose();\n+            return;\n+        }\n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if(status == 0) {\n+            var greeting = \"Thank you for finding the pendulum. Are you ready to return to Eos Tower?\";\n+            if (cm.isQuestStarted(3230)) {\n+                if (cm.haveItem(4031094)) {\n+                    cm.completeQuest(3230);\n+                    cm.gainItem(4031094, -1);\n+                } else\n+                    greeting = \"You haven't found the pendulum yet. Do you want to go back to Eos Tower?\";\n+            }\n+            cm.sendYesNo(greeting);\n+        } else if(status == 1) {\n+            cm.warp(221024400, 4);\n+            cm.dispose();\n+        }\n     }\n-    cm.dispose();\n }\n\\ No newline at end of file"}, {"sha": "aa77d42c0a13d67ee2e9aecb65a21b19a6899f59", "filename": "sql/db_shopupdate.sql", "status": "modified", "additions": 46, "deletions": 45, "changes": 91, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/sql/db_shopupdate.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/sql/db_shopupdate.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_shopupdate.sql?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -35,49 +35,50 @@ INSERT IGNORE INTO `shopitems` (`shopitemid`, `shopid`, `itemid`, `price`, `pitc\n (995055, 9201082, 2043001, 520000, 0, 24),\n (995056, 9201082, 2043801, 520000, 0, 25),\n (995057, 9201082, 2044601, 520000, 0, 26),\n-(995058, 9201082, 2040727, 10000, 0, 27),\n-(995059, 9201082, 2040807, 1000000, 0, 28),\n-(995060, 9201082, 2040026, 15000, 0, 29),\n-(995061, 9201082, 2040031, 15000, 0, 30),\n-(995062, 9201082, 2040302, 25000, 0, 31),\n-(995063, 9201082, 2040318, 25000, 0, 32),\n-(995064, 9201082, 2040323, 25000, 0, 33),\n-(995065, 9201082, 2040412, 20000, 0, 34),\n-(995066, 9201082, 2040419, 20000, 0, 35),\n-(995067, 9201082, 2040502, 25000, 0, 36),\n-(995068, 9201082, 2040514, 25000, 0, 37),\n-(995069, 9201082, 2040517, 25000, 0, 38),\n-(995070, 9201082, 2040534, 25000, 0, 39),\n-(995071, 9201082, 2040612, 20000, 0, 40),\n-(995072, 9201082, 2040702, 20000, 0, 41),\n-(995073, 9201082, 2040705, 25000, 0, 42),\n-(995074, 9201082, 2040805, 100000, 0, 43),\n-(995075, 9201082, 2040915, 55000, 0, 44),\n-(995076, 9201082, 2040920, 55000, 0, 45),\n-(995077, 9201082, 2041014, 30000, 0, 46),\n-(995078, 9201082, 2041017, 30000, 0, 47),\n-(995079, 9201082, 2041020, 30000, 0, 48),\n-(995080, 9201082, 2041023, 30000, 0, 49),\n-(995081, 9201082, 2044902, 50000, 0, 50),\n-(995082, 9201082, 2044702, 50000, 0, 51),\n-(995083, 9201082, 2043002, 50000, 0, 52),\n-(995084, 9201082, 2043802, 50000, 0, 53),\n-(995085, 9201082, 2044602, 50000, 0, 54),\n-(996000, 9201082, 2049200, 170000, 0, 55),\n-(996001, 9201082, 2049201, 220000, 0, 56),\n-(996002, 9201082, 2049202, 170000, 0, 57),\n-(996003, 9201082, 2049203, 220000, 0, 58),\n-(996004, 9201082, 2049204, 170000, 0, 59),\n-(996005, 9201082, 2049205, 220000, 0, 60),\n-(996006, 9201082, 2049206, 170000, 0, 61),\n-(996007, 9201082, 2049207, 220000, 0, 62),\n-(996008, 9201082, 2049208, 140000, 0, 63),\n-(996009, 9201082, 2049209, 170000, 0, 64),\n-(996010, 9201082, 2049210, 140000, 0, 65),\n-(996011, 9201082, 2049211, 170000, 0, 66),\n-(996196, 9201082, 2070016, 120000000, 0, 67),\n-(996197, 9201082, 2070018, 190000000, 0, 68),\n-(994782, 9201082, 2030007, 1800000, 0, 69),\n-(994783, 9201082, 4001017, 60000000, 0, 70);\n+(995058, 9201082, 2040727, 50000, 0, 27),\n+(995059, 9201082, 2041058, 50000, 0, 28),\n+(995060, 9201082, 2040807, 1000000, 0, 29),\n+(995061, 9201082, 2040026, 15000, 0, 30),\n+(995062, 9201082, 2040031, 15000, 0, 31),\n+(995063, 9201082, 2040302, 25000, 0, 32),\n+(995064, 9201082, 2040318, 25000, 0, 33),\n+(995065, 9201082, 2040323, 25000, 0, 34),\n+(995066, 9201082, 2040412, 20000, 0, 35),\n+(995067, 9201082, 2040419, 20000, 0, 36),\n+(995068, 9201082, 2040502, 25000, 0, 37),\n+(995069, 9201082, 2040514, 25000, 0, 38),\n+(995070, 9201082, 2040517, 25000, 0, 39),\n+(995071, 9201082, 2040534, 25000, 0, 40),\n+(995072, 9201082, 2040612, 20000, 0, 41),\n+(995073, 9201082, 2040702, 20000, 0, 42),\n+(995074, 9201082, 2040705, 25000, 0, 43),\n+(995075, 9201082, 2040805, 100000, 0, 44),\n+(995076, 9201082, 2040915, 55000, 0, 45),\n+(995077, 9201082, 2040920, 55000, 0, 46),\n+(995078, 9201082, 2041014, 30000, 0, 47),\n+(995079, 9201082, 2041017, 30000, 0, 48),\n+(995080, 9201082, 2041020, 30000, 0, 49),\n+(995081, 9201082, 2041023, 30000, 0, 50),\n+(995082, 9201082, 2044902, 50000, 0, 51),\n+(995083, 9201082, 2044702, 50000, 0, 52),\n+(995084, 9201082, 2043002, 50000, 0, 53),\n+(995085, 9201082, 2043802, 50000, 0, 54),\n+(995086, 9201082, 2044602, 50000, 0, 55),\n+(996000, 9201082, 2049200, 170000, 0, 56),\n+(996001, 9201082, 2049201, 220000, 0, 57),\n+(996002, 9201082, 2049202, 170000, 0, 58),\n+(996003, 9201082, 2049203, 220000, 0, 59),\n+(996004, 9201082, 2049204, 170000, 0, 60),\n+(996005, 9201082, 2049205, 220000, 0, 61),\n+(996006, 9201082, 2049206, 170000, 0, 62),\n+(996007, 9201082, 2049207, 220000, 0, 63),\n+(996008, 9201082, 2049208, 140000, 0, 64),\n+(996009, 9201082, 2049209, 170000, 0, 65),\n+(996010, 9201082, 2049210, 140000, 0, 66),\n+(996011, 9201082, 2049211, 170000, 0, 67),\n+(996196, 9201082, 2070016, 120000000, 0, 68),\n+(996197, 9201082, 2070018, 190000000, 0, 69),\n+(994782, 9201082, 2030007, 1800000, 0, 70),\n+(994783, 9201082, 4001017, 60000000, 0, 71);\n \n-UPDATE shopitems SET price = 11*price WHERE (`position` >= 27 and `position` <= 66 and `shopid` = 9201082);\n\\ No newline at end of file\n+UPDATE shopitems SET price = 11*price WHERE (`position` >= 27 and `position` <= 67 and `shopid` = 9201082);\n\\ No newline at end of file"}, {"sha": "a7467e5552feb16ceb228fd02b24a322a6d052b0", "filename": "src/client/MapleBuffStat.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/client/MapleBuffStat.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/client/MapleBuffStat.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleBuffStat.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -111,7 +111,7 @@\n     SMART_KNOCKBACK(0x10000000000L, true),\n     PYRAMID_PQ(0x20000000000L, true),\n     ENERGY_CHARGE(0x4000000000000L, true),\n-\tDASH2(0x8000000000000L, true), // correct (speed)\n+    DASH2(0x8000000000000L, true), // correct (speed)\n     DASH(0x10000000000000L, true), // correct (jump)\n     MONSTER_RIDING(0x20000000000000L, true),    \n     SPEED_INFUSION(0x40000000000000L, true),"}, {"sha": "e5bb21b0cb404a3926c7b43f64c2598ee637dca9", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -1197,6 +1197,10 @@ private boolean buffMapProtection() {\n             }\n         }\n         \n+        for(Item it: this.getInventory(MapleInventoryType.EQUIPPED).list()) {\n+            if((it.getFlag() & ItemConstants.COLD) == ItemConstants.COLD && map.getReturnMapId() == 211000000) return(true);       //protection from cold\n+        }\n+        \n         return false;\n     }\n     "}, {"sha": "f280905046150993b26e14dbfdc7e6d13be679d1", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -415,7 +415,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (chr.getTrade() != null) {\n                 if ((quantity <= item.getQuantity() && quantity >= 0) || ItemConstants.isRechargable(item.getItemId())) {\n                     if (ii.isDropRestricted(item.getItemId())) { // ensure that undroppable items do not make it to the trade window\n-                        if (!((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA || (item.getFlag() & ItemConstants.SPIKES) == ItemConstants.SPIKES)) {\n+                        if (!((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA)) {\n                             c.announce(MaplePacketCreator.enableActions());\n                             return;\n                         }"}, {"sha": "8549b334401d5e5bc5b6faa3960354106db23e8e", "filename": "src/net/server/channel/handlers/ScrollHandler.java", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/ScrollHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/ScrollHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScrollHandler.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -30,6 +30,7 @@\n import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import client.inventory.ModifyInventory;\n+import constants.ItemConstants;\n import java.util.ArrayList;\n import java.util.List;\n import net.AbstractMaplePacketHandler;\n@@ -97,7 +98,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         ScrollResult scrollSuccess = Equip.ScrollResult.FAIL; // fail\n         if (scrolled == null) {\n             scrollSuccess = Equip.ScrollResult.CURSE;\n-        } else if (scrolled.getLevel() > oldLevel || (isCleanSlate(scroll.getItemId()) && scrolled.getUpgradeSlots() == oldSlots + 1)) {\n+        } else if (scrolled.getLevel() > oldLevel || (isCleanSlate(scroll.getItemId()) && scrolled.getUpgradeSlots() == oldSlots + 1) || isFlagModifier(scroll.getItemId(), scrolled.getFlag())) {\n             scrollSuccess = Equip.ScrollResult.SUCCESS;\n         }\n         MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, scroll.getPosition(), (short) 1, false);\n@@ -123,6 +124,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n     }\n \n+    private boolean isFlagModifier(int scrollId, byte flag) {\n+        if(scrollId == 2041058 && ((flag & ItemConstants.COLD) == ItemConstants.COLD)) return true;\n+        if(scrollId == 2040727 && ((flag & ItemConstants.SPIKES) == ItemConstants.SPIKES)) return true;\n+        return false;\n+    }\n+    \n     private boolean isCleanSlate(int scrollId) {\n         return scrollId > 2048999 && scrollId < 2049004;\n     }"}, {"sha": "2f4134bcdb77734d069444c6cd5343b5e0796ef7", "filename": "src/net/server/channel/handlers/StorageHandler.java", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/StorageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/StorageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/StorageHandler.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -82,8 +82,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\t\tFilePrinter.printError(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" took out \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\t\t\t\n \t\t\t\t\tif ((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA) {\n \t\t\t\t\t\titem.setFlag((byte) (item.getFlag() ^ ItemConstants.KARMA)); //items with scissors of karma used on them are reset once traded\n-\t\t\t\t\t} else if (item.getType() == 2 && (item.getFlag() & ItemConstants.SPIKES) == ItemConstants.SPIKES){\n-\t\t\t\t\t\titem.setFlag((byte) (item.getFlag() ^ ItemConstants.SPIKES));\n \t\t\t\t\t}\n \t\t\t\t\tMapleInventoryManipulator.addFromDrop(c, item, false);\n \t\t\t\t\tstorage.sendTakenOut(c, ii.getInventoryType(item.getItemId()));"}, {"sha": "87b2ce556aef592a194dda9575006be68c9fdd0c", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -490,9 +490,7 @@ public void run() {\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n-            if (type.equals(MapleInventoryType.USE)) {\n-                item.setFlag((byte) ItemConstants.SPIKES);\n-            } else {\n+            if (!type.equals(MapleInventoryType.USE)) {\n                 item.setFlag((byte) ItemConstants.KARMA);\n             }\n "}, {"sha": "b1e52e6b9bf527cfff4187323d38f77649a94b72", "filename": "src/server/MapleTrade.java", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/MapleTrade.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/MapleTrade.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleTrade.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -88,10 +88,8 @@ private void complete2() {\n         for (Item item : exchangeItems) {\n             if ((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA) \n                 item.setFlag((byte) (item.getFlag() ^ ItemConstants.KARMA)); //items with scissors of karma used on them are reset once traded\n-            else if (item.getType() == 2 && (item.getFlag() & ItemConstants.SPIKES) == ItemConstants.SPIKES)\n-                item.setFlag((byte) (item.getFlag() ^ ItemConstants.SPIKES));\n \n-                MapleInventoryManipulator.addFromDrop(chr.getClient(), item, true);\n+            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, true);\n         }\n         if (exchangeMeso > 0) {\n             chr.gainMeso(exchangeMeso - getFee(exchangeMeso), true, true, true);"}, {"sha": "0849fc58301c5609bf36506fe61d8d19a14ef855", "filename": "src/server/maps/HiredMerchant.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/maps/HiredMerchant.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/maps/HiredMerchant.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/HiredMerchant.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -143,9 +143,6 @@ public void buy(MapleClient c, int item, short quantity) {\n             if ((newItem.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA) {\n                 newItem.setFlag((byte) (newItem.getFlag() ^ ItemConstants.KARMA));\n             }\n-            if (newItem.getType() == 2 && (newItem.getFlag() & ItemConstants.SPIKES) == ItemConstants.SPIKES) {\n-                newItem.setFlag((byte) (newItem.getFlag() ^ ItemConstants.SPIKES));\n-            }\n             if (quantity < 1 || pItem.getBundles() < 1 || !pItem.isExist() || pItem.getBundles() < quantity) {\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;"}, {"sha": "1e9351b4046a79bf8465dec1f3e23a6378af2506", "filename": "src/server/quest/requirements/ItemRequirement.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/quest/requirements/ItemRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/53927576e757571be899ef0f34d4d6bbb64a0aeb/src/server/quest/requirements/ItemRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/ItemRequirement.java?ref=53927576e757571be899ef0f34d4d6bbb64a0aeb", "patch": "@@ -73,7 +73,7 @@ public boolean check(MapleCharacter chr, Integer npcid) {\n \t\t\t\tcount += item.getQuantity();\n \t\t\t}\n \t\t\t//Weird stuff, nexon made some quests only available when wearing gm clothes. This enables us to accept it ><\n-\t\t\tif (iType.equals(MapleInventoryType.EQUIP)) {\n+\t\t\tif (iType.equals(MapleInventoryType.EQUIP) && chr.isGM()) {\n \t\t\t\tfor (Item item : chr.getInventory(MapleInventoryType.EQUIPPED).listById(itemId)) {\n \t\t\t\t\tcount += item.getQuantity();\n \t\t\t\t}"}]}]},
