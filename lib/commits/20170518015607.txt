{"fetchDate": "2019-12-19", "content": [{"sha": "39a53e88fdb11239d2092b899ccf5df632843cfc", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MzlhNTNlODhmZGIxMTIzOWQyMDkyYjg5OWNjZjVkZjYzMjg0M2NmYw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-18T01:56:07Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-05-18T01:56:07Z"}, "message": "Minor Cash Shop + cash items fixes\n\nFixed minor issues regarding the Cash Shop not selling items and usable\ncash items.", "tree": {"sha": "911b943c35a7569a11beadc44cf2626685155bad", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/911b943c35a7569a11beadc44cf2626685155bad"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/39a53e88fdb11239d2092b899ccf5df632843cfc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/39a53e88fdb11239d2092b899ccf5df632843cfc", "html_url": "https://github.com/ronancpl/HeavenMS/commit/39a53e88fdb11239d2092b899ccf5df632843cfc", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/39a53e88fdb11239d2092b899ccf5df632843cfc/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d736d00964c20e835d71ed4e7af309f463ab6c84", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/d736d00964c20e835d71ed4e7af309f463ab6c84", "html_url": "https://github.com/ronancpl/HeavenMS/commit/d736d00964c20e835d71ed4e7af309f463ab6c84"}], "stats": {"total": 59, "additions": 37, "deletions": 22}, "files": [{"sha": "b7f7db9c0435cecfe3a24a9cd1d80f84ea71357f", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -1330,6 +1330,19 @@ public void controlMonster(MapleMonster monster, boolean aggro) {\n     public int countItem(int itemid) {\n         return inventory[MapleItemInformationProvider.getInstance().getInventoryType(itemid).ordinal()].countById(itemid);\n     }\n+    \n+    public boolean canHold(int itemid) {\n+        return canHold(itemid, 1);\n+    }\n+        \n+    public boolean canHold(int itemid, int quantity) {\n+        if(haveItem(itemid)) {\n+            if(getItemQuantity(itemid, false) + quantity <= MapleItemInformationProvider.getInstance().getSlotMax(client, itemid))\n+                return true;\n+        }\n+\n+        return getInventory(MapleItemInformationProvider.getInstance().getInventoryType(itemid)).getNextFreeSlot() > -1;\n+    }\n \n     public void decreaseBattleshipHp(int decrease) {\n         this.battleshipHp -= decrease;"}, {"sha": "63eead3e349d9762b69c6ebbc0c14f8e6e99d29b", "filename": "src/net/server/channel/handlers/CashOperationHandler.java", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/CashOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/CashOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CashOperationHandler.java?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -38,6 +38,7 @@\n import server.CashShop.CashItemFactory;\n import server.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n+import tools.FilePrinter;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -53,12 +54,14 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             return;\n         }\n         final int action = slea.readByte();\n+        \n         if (action == 0x03 || action == 0x1E) {\n             slea.readByte();\n             final int useNX = slea.readInt();\n             final int snCS = slea.readInt();\n             CashItem cItem = CashItemFactory.getItem(snCS);\n             if (cItem == null || !cItem.isOnSale() || cs.getCash(useNX) < cItem.getPrice()) {\n+                FilePrinter.printError(FilePrinter.ITEM, \"Denied to sell cash item with SN \" + cItem.getSN());\n                 return;\n             }\n             if (action == 0x03) { // Item\n@@ -185,17 +188,18 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (chr.getInventory(MapleItemInformationProvider.getInstance().getInventoryType(item.getItemId())).addItem(item) != -1) {\n                 cs.removeFromInventory(item);\n                 c.announce(MaplePacketCreator.takeFromCashInventory(item));\n-\t\t\t\tif(item instanceof Equip) {\n-\t\t\t\t\tEquip equip = (Equip) item;\n- \t\t\t\t\tif(equip.getRingId() >= 0) {\n-\t\t\t\t\t\tMapleRing ring = MapleRing.loadFromDb(equip.getRingId());\n-\t\t\t\t\t\tif (ring.getItemId() > 1112012) {\n-                            chr.addFriendshipRing(ring);\n-                        } else {\n-                            chr.addCrushRing(ring);\n+                \n+                if(item instanceof Equip) {\n+                        Equip equip = (Equip) item;\n+                        if(equip.getRingId() >= 0) {\n+                                MapleRing ring = MapleRing.loadFromDb(equip.getRingId());\n+                                if (ring.getItemId() > 1112012) {\n+                                        chr.addFriendshipRing(ring);\n+                                } else {\n+                                        chr.addCrushRing(ring);\n+                                }\n                         }\n-\t\t\t\t\t}\n-\t\t\t\t}\n+                }\n             }\n         } else if (action == 0x0E) { // Put into Cash Inventory\n             int cashId = slea.readInt();\n@@ -250,8 +254,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             c.announce(MaplePacketCreator.showCash(c.getPlayer()));\n         } else if (action == 0x20) { // everything is 1 meso...\n             int itemId = CashItemFactory.getItem(slea.readInt()).getItemId();\n+            \n             if (chr.getMeso() > 0) {\n-                if (itemId == 4031180 || itemId == 4031192 || itemId == 4031191) {\n+                if (chr.canHold(itemId)) {\n                     chr.gainMeso(-1, false);\n                     MapleInventoryManipulator.addById(c, itemId, (short) 1);\n                     c.announce(MaplePacketCreator.showBoughtQuestItem(itemId));"}, {"sha": "b04800c741f18f5788303b0ba10f9f619bc976c7", "filename": "src/net/server/channel/handlers/SpecialMoveHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/SpecialMoveHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/SpecialMoveHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/SpecialMoveHandler.java?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -124,7 +124,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (skill.getId() != Priest.MYSTIC_DOOR || chr.canDoor()) {\n                 skill.getEffect(skillLevel).applyTo(c.getPlayer(), pos);\n             } else {\n-                chr.message(\"Please wait 5 seconds before casting Mystic Door again\");\n+                chr.message(\"Please wait 5 seconds before casting Mystic Door again.\");\n                 c.announce(MaplePacketCreator.enableActions());\n             }\n         } else {"}, {"sha": "f0312fda52dab0d6af9bae73d75ccee3f3dea9a6", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -58,6 +58,8 @@\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleCharacter player = c.getPlayer();\n         if (System.currentTimeMillis() - player.getLastUsedCashItem() < 3000) {\n+            player.dropMessage(1, \"You have used a cash item recently. Wait a moment and try again.\");\n+            c.announce(MaplePacketCreator.enableActions());\n             return;\n         }\n         player.setLastUsedCashItem(System.currentTimeMillis());"}, {"sha": "d4233e875250c243178fa784f1a8b97e4d23665b", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -188,17 +188,12 @@ public int getItemQuantity(int itemid) {\n         }\n \n \tpublic boolean canHold(int itemid) {\n-            return canHold(itemid, 1);\n-\t}\n+                return canHold(itemid, 1);\n+        }\n         \n         public boolean canHold(int itemid, int quantity) {\n-            if(haveItem(itemid)) {\n-                if(getPlayer().getItemQuantity(itemid, false) + quantity <= MapleItemInformationProvider.getInstance().getSlotMax(c, itemid))\n-                    return true;\n-            }\n-            \n-            return getPlayer().getInventory(MapleItemInformationProvider.getInstance().getInventoryType(itemid)).getNextFreeSlot() > -1;\n-\t}\n+                return getPlayer().canHold(itemid, quantity);\n+        }\n      \n         //---- \\/ \\/ \\/ \\/ \\/ \\/ \\/  NOT TESTED  \\/ \\/ \\/ \\/ \\/ \\/ \\/ \\/ \\/ ----\n         "}, {"sha": "4fbc9f16caa460393f246690fec99a6460c8f887", "filename": "wz/Etc.wz/Commodity.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/39a53e88fdb11239d2092b899ccf5df632843cfc/wz/Etc.wz/Commodity.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/39a53e88fdb11239d2092b899ccf5df632843cfc/wz/Etc.wz/Commodity.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Etc.wz/Commodity.img.xml?ref=39a53e88fdb11239d2092b899ccf5df632843cfc", "patch": "@@ -6200,7 +6200,7 @@\n     <int name=\"Period\" value=\"90\"/>\n     <int name=\"Priority\" value=\"9\"/>\n     <int name=\"Gender\" value=\"2\"/>\n-    <int name=\"OnSale\" value=\"0\"/>\n+    <int name=\"OnSale\" value=\"1\"/>\n     <int name=\"Class\" value=\"2\"/>\n   </imgdir>\n   <imgdir name=\"616\">"}]}]},
