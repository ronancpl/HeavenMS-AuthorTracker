{"fetchDate": "2019-12-19", "content": [{"sha": "c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YzJmYTc4ODNmZWQ1MmM2ZGZhOWQyYmY0ZDRiNTIyY2RlNmQwODU2OQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-05-02T14:02:07Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-05-02T14:02:07Z"}, "message": "Several PQ platform patches + Quest complete count + Fast meso drop\n\nImplemented CPQ challenges using the matching system.\nFixed LanguageConstants statically acting for all players.\nFixed OPQ's <On the Way Up> stage sometimes leading players to unexpected platforms.\nFixed EllinPQ fountain not giving Altaire Fragment to players.\nFixed \"Lab - Unit\" stage on RnJPQ, now using correlated sequences between the units.\nFixed Fredrick handing out negative values of mesos to players.\nImproved \"goto\" command info.\nImplemented quest complete count.\nFixed mobs still being \"controlled\" by players even though it's already dead.\nConcurrently protected adding items into inventory.\nConcurrently protected EXP gain through Writs of Solomon.\nAdjusted smoothly respawn rate of mobs in map (solo players in a map now experiences 75% of mobs spawned).\nFixed mesos not being able to drop so frequently (prior 200ms threshold between drops).\nTweaked matchchecking so that match checking doesn't outright dispose matching members on dismissal (match still sticks to the player until they answer or timeout).\nFixed a dupe case within storage's item store.\nAdded any-NPC scriptable to the source.", "tree": {"sha": "aa848a5d3f665d48bccf35eb9ecaccd5957291cd", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/aa848a5d3f665d48bccf35eb9ecaccd5957291cd"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "html_url": "https://github.com/ronancpl/HeavenMS/commit/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b6a91c523fae668eb785c2fb61933a4ebe862bc3", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b6a91c523fae668eb785c2fb61933a4ebe862bc3", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b6a91c523fae668eb785c2fb61933a4ebe862bc3"}], "stats": {"total": 2061, "additions": 1452, "deletions": 609}, "files": [{"sha": "db23594d4c1ab437d3daa03b8460597b0c712473", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -103,6 +103,10 @@\n /tools/MapleReactorDropFetcher/dist/\n /tools/MapleReactorDropFetcher/nbproject/\n \n+/tools/MapleSkillbookStackUpdate/build/\n+/tools/MapleSkillbookStackUpdate/dist/\n+/tools/MapleSkillbookStackUpdate/nbproject/\n+\n /tools/MapleSkillMakerFetcher/build/\n /tools/MapleSkillMakerFetcher/dist/\n /tools/MapleSkillMakerFetcher/nbproject/"}, {"sha": "f20ff2a3da474f415a2faf57b3ed834a9ea2e04f", "filename": "README.md", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1,4 +1,4 @@\n-<img src=\"https://heavenmssurveyhome.files.wordpress.com/2018/12/heavenmslogo.png\"  width=\"370\" height=\"auto\">\n+\ufeff<img src=\"https://heavenmssurveyhome.files.wordpress.com/2018/12/heavenmslogo.png\"  width=\"370\" height=\"auto\">\n \n ## Head developer: Ronan C. P. Lana\n \n@@ -56,7 +56,7 @@ Java7 SDK: https://www.oracle.com/technetwork/java/javase/downloads/java-archive\n ---\n ### Open-source client development - HeavenClient\n \n-Continuing from where **SYJourney**'s JourneyClient has finished contributions (as of 5 Jul 2016), an open-source delevopment of a software artifact designed to handle both gaming operations and interactions with the server is being conducted.\n+Continuing from where **SYJourney**'s JourneyClient has finished contributions (as of 5 Jul 2016), an open-source development of a software artifact designed to handle both gaming operations and interactions with the server is being conducted.\n \n Newer implementations are being maintained by **\u983c\u664f (ryantpayton)** and aims to offer higher display resolution, bring recent UI contents for the pre-BB gameplay and incremental support on overall gaming perspective.\n \n@@ -84,16 +84,20 @@ By taking the v83 MapleStory as the angular stone, incrementally look forward to\n \n #### Announcements\n \n-HeavenMS development achieved an acceptable state-of-the-art and will get into a halt. A heartfelt thanks for everyone that contributed in some way for the progress of this server!\n+HeavenMS development as we can see right now achieved an acceptable state-of-the-art. A heartfelt thanks for everyone that contributed in some way for the progress of this server!\n \n-Although development is halted, support for fixing features that were implemented here is still up. You can still actively help us improve the server by issuing pull requests with informative details about what's changing.\n+As development and support for fixing features that were implemented here is still up, with **your** help we can improve it even further! Please help where you can to better the server for everyone.\n+\n+Furthermore, you can actively help improving the server by issuing pull requests with informative details about what's changing.\n+\n+Note for anyone up to contribute further pull requests: make awareness to use __english language__ in codes and messages, as usage of any other languages will render it open to faculty of whether this content will be ready to be accepted or *further changes are going to be requested* before it becomes apt to merge.\n+\n+#### Support HeavenMS\n \n If you liked this project, please don't forget to __star__ the repo ;) .\n \n It's never enough to tell this, thanks to everyone that have been contributing something for the continuous improvement of the server! Be it through bug reports, donation, code snippets and/or pull requests.\n \n-Note for anyone up to contribute further pull requests: make awareness to use __english language__ in codes and messages, as usage of any other languages will render it open to faculty of whether this content will be ready to be accepted or *further changes are going to be requested* before it becomes apt to merge.\n-\n Our Discord channel is still available on: https://discord.gg/Q7wKxHX\n \n <hr id=\"donate\" />\n@@ -110,7 +114,7 @@ Paypal: https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3K8\n \n * HeavenMS staff has __no current intention__ to publicly open a server with this source, if that ever comes to happen this note will be lifted. __Don't be scammed!__\n \n-* This server source is __NOT intended to be stable__ as is. Proper deadlock review and other maintenance checks are needed in order to make it suitable for production use.\n+* This server source is __NOT intended to be stable__ as is. Proper deadlock review and other maintenance contributions are needed in order to make it steps ahead on viability.\n \n ---\n ### Preparing the ambient "}, {"sha": "bdb3c8686eba3dbf87ac975712f6da12bd5b4509", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 29, "deletions": 2, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1798,10 +1798,18 @@ Corrigido cooldown de skills de mob n\u00e3o atuando adequadamente.\n \n 08 - 09 Abril 2019,\n Resolvido problema de deadlock envolvendo acesso a valores de stats de jogadores e diversas opera\u00e7\u00f5es de despacho de update de stats.\n+Implementado envio de desafio na CPQ utilizando o sistema de matching.\n+Corrigido LanguageConstants atuando estaticamente para todos os jogadores.\n Corrigido mob skills que n\u00e3o se encontram dispon\u00edveis sendo passados para o cliente para serem usados. Resultado disso era efeito visual de skill sendo mostrado ao usu\u00e1rio, habilidade sem ser aplicada em sequ\u00eancia.\n+Corrigido portais do stage \"<On the Way Up>\" da OPQ levando jogadores incorretamente para a pr\u00f3xima plataforma.\n+Corrigido portais do stage \"<On the Way Up>\" da OPQ retornando jogadores \u00e0 plataforma inicial, ao inv\u00e9s de retornar a uma plataforma \"checkpoint\".\n+Corrigido fonte da EllinPQ n\u00e3o atribuindo corretamente \"Altaire Fragment\" aos jogadores.\n+Implementado gera\u00e7\u00e3o de sequ\u00eancias com rela\u00e7\u00e3o entre as mesmas, utilizadas no est\u00e1gio \"Lab - Unit\" da RnJPQ.\n \n 12 Abril 2019,\n+Corrigido limites de mapas nos eventos de RockSpirit.\n Corrigido ganho visual do EXP de party ocasionalmente mostrando EXP em amarelo ao jogador em party solo.\n+Corrigido battleship setando HP inicial menor que o esperado pela skill para jogadores de n\u00edvel menor que 120.\n \n 15 Abril 2019,\n Iniciado opera\u00e7\u00e3o de introdu\u00e7\u00e3o da AriantPQ no fonte, a partir do pull request feito pelo Dragohe4rt.\n@@ -1817,7 +1825,26 @@ Ajustado drops de mobs, agora sendo buscado na DB.\n Ajustado diversas mec\u00e2nicas da AriantPQ, tais como update visual da pontua\u00e7\u00e3o de jogadores (ao dropar itens, ganhar itens, acessar mapa de evento), pontos de batalha persistindo na DB, etc.\n \n 21 Abril 2019,\n-Adicionado debug de packets descrito pelo Atoot.Adicionado debug de packets descrito pelo Atoot.\n+Adicionado debug de packets descrito pelo Atoot.\n \n 22 Abril 2019,\n-Revisado refatora\u00e7\u00e3o recente em acesso a valores de stats de jogadores levando a inconsist\u00eancia nos valores dos mesmos ao coloc\u00e1-los para rodar em uma nova thread sem prote\u00e7\u00e3o concorrente.\n\\ No newline at end of file\n+Corrigido Fredrick retornando valores negativos de mesos ao retornar esp\u00f3lios de mercantes aos jogadores.\n+Adicionado informa\u00e7\u00e3o aprimorada em comando \"goto\".\n+Adicionado contagem de quests completadas de mesmo id.\n+Corrigido problema de visibilidade latente com mobs que j\u00e1 foram derrotados aparecendo num flicker ao realizar certas a\u00e7\u00f5es (tal como mudar de mapas).\n+Nova ferramenta: MapleSkillbookStackUpdate. Livros de skill e melhorias agora levam quantidade de stack padr\u00e3o (100 unidades).\n+Protegido concorrentemente adi\u00e7\u00e3o de itens ao invent\u00e1rio. Checagens de posi\u00e7\u00e3o e inser\u00e7\u00e3o ocorrem atomicamente.\n+Protegido concorrentemente e revisado m\u00f3dulos de ganho de EXP do Writs of Solomon (gachapon EXP).\n+Revisado refatora\u00e7\u00e3o recente em acesso a valores de stats de jogadores levando a inconsist\u00eancia nos valores dos mesmos ao coloc\u00e1-los para rodar em uma nova thread sem prote\u00e7\u00e3o concorrente.\n+\n+24 - 26 Abril 2019,\n+Ajustado levemente taxa de respawn de mobs quando n\u00e3o se est\u00e1 usando a flag de respawn completo.\n+Ajustado ganhos de stats de ataque ao passar de n\u00edvel weapons, ganha-se menos do stat que n\u00e3o \u00e9 a afinidade (watk/matk).\n+Corrigido drops de mesos sendo bloqueados para drops r\u00e1pidos de mesos, indevidamente dificultando jogabilidade para certas classes.\n+Corrigido caso de XML parser em MapleSkillBookInformationParser n\u00e3o lidando com terminadores \"/>\" corretamente.\n+\n+01 - 02 Maio 2019,\n+Corrigido jogadores podendo explorar mec\u00e2nica de checagem de match, n\u00e3o respondendo ao match e sendo permitido se registrar em um novo sem ter respondido ao anterior.\n+Corrigido caso de dupe com itens ao serem colocados no storage.\n+Adicionado sistema de \"qualquer NPC script\u00e1vel\", com apoio do GabrielSin.\n+Adicionado server flag para checagem de IP's ao logar jogadores.\n\\ No newline at end of file"}, {"sha": "cd366824edd0e76f4a516c0c9736ed0b85a8d246", "filename": "scripts/event/3rdJob_mount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/3rdJob_mount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/3rdJob_mount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_mount.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -92,7 +92,7 @@ function playerEntry(eim, player) {\n function playerUnregistered(eim, player) {}\n \n function playerExit(eim, player) {\n-    var api = player.getClient().getAbstractPlayerInteraction();\n+    var api = player.getAbstractPlayerInteraction();\n     api.removeAll(4031507);\n     api.removeAll(4031508);\n     "}, {"sha": "d4d3fa00f849ea8618e51310b4a15e84ef32f7cd", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -237,7 +237,7 @@ function changedMap(eim, player, mapid) {\n function afterChangedMap(eim, player, mapid) {\n         if (mapid == 990000100) {\n                 var texttt = \"So, here is the brief. You guys should be warned that, once out on the fortress outskirts, anyone that would not be equipping the #b#t1032033##k will die instantly due to the deteriorated state of the air around there. That being said, once your team moves out, make sure to #bhit the glowing rocks#k in that region and #bequip the dropped item#k before advancing stages. That will protect you thoroughly from the air sickness. Good luck!\";\n-                player.getClient().getAbstractPlayerInteraction().npcTalk(9040000, texttt);\n+                player.getAbstractPlayerInteraction().npcTalk(9040000, texttt);\n         }\n }\n "}, {"sha": "01ddf963f9b5262a14cbc9d78d4513b387c26db5", "filename": "scripts/event/MK_PrimeMinister.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MK_PrimeMinister.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MK_PrimeMinister.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -52,7 +52,7 @@ function primeMinisterCheck(eim) {\n         var pIter = map.getAllPlayers().iterator();\n         while (pIter.hasNext()) {\n                 var player = pIter.next();\n-                if (player.getQuestStatus(2333) == 1 && player.getClient().getAbstractPlayerInteraction().getQuestProgress(2333, mobId) == 0) {\n+                if (player.getQuestStatus(2333) == 1 && player.getAbstractPlayerInteraction().getQuestProgress(2333, mobId) == 0) {\n                         return true;\n                 }\n         }"}, {"sha": "312980d2a87171e27db2c3afcf111a54f3a4f2a3", "filename": "scripts/event/MagatiaPQ_A.js", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MagatiaPQ_A.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MagatiaPQ_A.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MagatiaPQ_A.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -176,6 +176,33 @@ function shuffle(array) {\n     return array;\n }\n \n+function generateStg6Combo(eim) {  // thanks Chloek3, seth1 for stating generated sequences are supposed to be linked\n+        var matrix = [];\n+        \n+        for (var i = 0; i < 4; i++) {\n+                matrix.push([]);\n+        }\n+        \n+        for (var j = 0; j < 10; j++) {\n+                var array = [0, 1, 2, 3];\n+                array = shuffle(array);\n+                \n+                for (var i = 0; i < 4; i++) {\n+                        matrix[i].push(array[i]);\n+                }\n+        }\n+        \n+        for (var i = 0; i < 4; i++) {\n+                var comb = \"\";\n+                for(var j = 0; j < 10; j++) {\n+                    var r = matrix[i][j];\n+                    comb += r.toString();\n+                }\n+                \n+                eim.setProperty(\"stage6_comb\" + (i + 1), comb);\n+        }\n+}\n+\n function afterSetup(eim) {\n         eim.setIntProperty(\"escortFail\", 0);    // refresh friendly status\n     \n@@ -390,6 +417,7 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.giveEventPlayersStageReward(5);\n                         \n+                        generateStg6Combo(eim);\n                         map.getReactorByName(\"jnr6_out\").forceHitReactor(1);\n                 }\n         } else if(mob.getId() == 9300151 || mob.getId() == 9300152) {"}, {"sha": "fe88d4af3dfaf7a680f88b1fd3e22e8a77efb48d", "filename": "scripts/event/MagatiaPQ_Z.js", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MagatiaPQ_Z.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/MagatiaPQ_Z.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MagatiaPQ_Z.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -176,6 +176,33 @@ function shuffle(array) {\n     return array;\n }\n \n+function generateStg6Combo(eim) {\n+        var matrix = [];\n+        \n+        for (var i = 0; i < 4; i++) {\n+                matrix.push([]);\n+        }\n+        \n+        for (var j = 0; j < 10; j++) {\n+                var array = [0, 1, 2, 3];\n+                array = shuffle(array);\n+                \n+                for (var i = 0; i < 4; i++) {\n+                        matrix[i].push(array[i]);\n+                }\n+        }\n+        \n+        for (var i = 0; i < 4; i++) {\n+                var comb = \"\";\n+                for(var j = 0; j < 10; j++) {\n+                    var r = matrix[i][j];\n+                    comb += r.toString();\n+                }\n+                \n+                eim.setProperty(\"stage6_comb\" + (i + 1), comb);\n+        }\n+}\n+\n function afterSetup(eim) {\n         eim.setIntProperty(\"escortFail\", 0);    // refresh friendly status\n     \n@@ -390,6 +417,7 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.giveEventPlayersStageReward(5);\n                         \n+                        generateStg6Combo(eim);\n                         map.getReactorByName(\"rnj6_out\").forceHitReactor(1);\n                 }\n         } else if(mob.getId() == 9300139 || mob.getId() == 9300140) {"}, {"sha": "397e205a5b5a57a0452208677fa0fda0998d5474", "filename": "scripts/event/OrbisPQ.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/OrbisPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/OrbisPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/OrbisPQ.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -180,7 +180,7 @@ function playerEntry(eim, player) {\n         player.changeMap(map, map.getPortal(0));\n         \n         var texttt = \"Hi, my name is Eak, the Chamberlain of the Goddess. Don't be alarmed; you won't be able to see me right now. Back when the Goddess turned into a block of stone, I simultaneously lost my own power. If you gather up the power of the Magic Cloud of Orbis, however, then I'll be able to recover my body and re-transform back to my original self. Please collect #b20#k Magic Clouds and bring them back to me. Right now, you'll only see me as a tiny, flickering light.\";\n-        player.getClient().getAbstractPlayerInteraction().npcTalk(2013001, texttt);\n+        player.getAbstractPlayerInteraction().npcTalk(2013001, texttt);\n }\n \n function scheduledTimeout(eim) {"}, {"sha": "149ced9bd13d3e5a748ee626b8791177f85ea794", "filename": "scripts/event/RockSpirit.js", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/RockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/RockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpirit.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -21,9 +21,13 @@\n \n importPackage(Packages.tools);\n \n-var exitMap;\n var entryMap;\n+var exitMap;\n var otherMap;\n+\n+var minMapId = 103040410;\n+var maxMapId = 103040460;\n+\n var minPlayers = 1;\n var fightTime = 60;\n var timer = 1000 * 60 * fightTime;\n@@ -80,7 +84,7 @@ function playerDisconnected(eim, player) {\n }\n \n function changedMap(eim, player, mapid) {\n-    if(mapid == exitMap.getId()) {\n+    if (mapid < minMapId || mapid > maxMapId) {\n         if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n             eim.unregisterPlayer(player);\n             end(eim);"}, {"sha": "0d2ecba42568c80050a743a0792fcf155889ec7c", "filename": "scripts/event/RockSpiritVIP.js", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/RockSpiritVIP.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/RockSpiritVIP.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpiritVIP.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -21,9 +21,13 @@\n \n importPackage(Packages.tools);\n \n-var exitMap;\n var entryMap;\n+var exitMap;\n var otherMap;\n+\n+var minMapId = 103040410;\n+var maxMapId = 103040460;\n+\n var minPlayers = 1;\n var fightTime = 30;\n var timer = 1000 * 60 * fightTime;\n@@ -80,7 +84,7 @@ function playerDisconnected(eim, player) {\n }\n \n function changedMap(eim, player, mapid) {\n-    if(mapid == exitMap.getId()) {\n+    if (mapid < minMapId || mapid > maxMapId) {\n         if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n             eim.unregisterPlayer(player);\n             end(eim);"}, {"sha": "2bf92e039ae1e5b15388c53e9271852811aa0ac7", "filename": "scripts/event/WeddingCathedral.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/WeddingCathedral.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/WeddingCathedral.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/WeddingCathedral.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -110,7 +110,7 @@ function respawnStages(eim) {\n function playerEntry(eim, player) {\n         eim.setProperty(\"giftedItemG\" + player.getId(), \"0\");\n         eim.setProperty(\"giftedItemB\" + player.getId(), \"0\");\n-        player.getClient().getAbstractPlayerInteraction().gainItem(4000313, 1);\n+        player.getAbstractPlayerInteraction().gainItem(4000313, 1);\n         \n         var map = eim.getMapInstance(entryMap);\n         player.changeMap(map, map.getPortal(0));"}, {"sha": "37a44bd9536208e062956f6823ee138740c48cd7", "filename": "scripts/event/WeddingChapel.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/WeddingChapel.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/event/WeddingChapel.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/WeddingChapel.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -110,7 +110,7 @@ function respawnStages(eim) {\n function playerEntry(eim, player) {\n         eim.setProperty(\"giftedItemG\" + player.getId(), \"0\");\n         eim.setProperty(\"giftedItemB\" + player.getId(), \"0\");\n-        player.getClient().getAbstractPlayerInteraction().gainItem(4000313, 1);\n+        player.getAbstractPlayerInteraction().gainItem(4000313, 1);\n         \n         var map = eim.getMapInstance(entryMap);\n         player.changeMap(map, map.getPortal(0));"}, {"sha": "d9cf1d2b6e67a49870ed8be4b86e9748bc5fbcb5", "filename": "scripts/npc/2042004.js", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2042004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2042004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2042004.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -8,9 +8,23 @@ function start() {\n \n \n function action(mode, type, selection) {\n-    cm.warpParty(980000000);\n-    cm.cancelCPQLobby();\n-    cm.dispose();\n+    if (mode == -1) {\n+        cm.dispose();\n+    } else {\n+        if (mode == 0 && status == 0) {\n+            cm.dispose();\n+            return;\n+        }\n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        if (status == 0) {\n+            cm.warpParty(980000000);\n+            cm.cancelCPQLobby();\n+            cm.dispose();\n+        }\n+    }\n }\n \n "}, {"sha": "71a0f0755ac12b649fe1558ae8f9eeb990b0ede4", "filename": "scripts/npc/2112000.js", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2112000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2112000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2112000.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -69,9 +69,13 @@ function action(mode, type, selection) {\n                                 if(state == -1) {\n                                     cm.sendOk(\"Heh, it seems you guys have company. Have fun with them, as I politely request my leave.\");\n \n-                                } else if (playersTooClose() || eim.getIntProperty(\"npcShocked\") == 0) {\n+                                } else if (playersTooClose()) {\n                                     cm.sendOk(\"Oh, hello there. I have been #bmonitoring your moves#k since you guys entered this perimeter. Quite the feat reaching here, I commend all of you. Now, now, look at the time, I've got an appointment right now, I'm afraid I will need to request my leave. But worry not, my #raccessors#k will deal with all of you. Now, if you permit me, I'm leaving now.\");\n \n+                                    eim.setIntProperty(\"yuleteTalked\", -1);\n+                                } else if (eim.getIntProperty(\"npcShocked\") == 0) {\n+                                    cm.sendOk(\"Ho~ Aren't you quite the sneaky one? Well, it matters not. I have been #bmonitoring your moves#k since you guys entered this perimeter. Quite the feat reaching here, I commend all of you. Now, now, look at the time, I've got an appointment right now, I'm afraid I will need to request my leave. But worry not, my #raccessors#k will deal with all of you. Now, if you permit me, I'm leaving now.\");\n+\n                                     eim.setIntProperty(\"yuleteTalked\", -1);\n                                 } else {\n                                     cm.sendOk(\"... Hah! What, wh-- How did you get here?! I though I had sealed all paths here! No matter, this situation will be resolved soon. Guys: DEPLOY the #rmaster weapon#k!! You! Yes, you. Don't you think this ends here, look back at your companions, they need some help! I'll be retreating for now.\");"}, {"sha": "3d6d4cb89576567e6aa7b8450c637243d980bf7c", "filename": "scripts/npc/2112010.js", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2112010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/2112010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2112010.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -69,9 +69,13 @@ function action(mode, type, selection) {\n                                 if(state == -1) {\n                                     cm.sendOk(\"Heh, it seems you guys have company. Have fun with them, as I politely request my leave.\");\n \n-                                } else if (playersTooClose() || eim.getIntProperty(\"npcShocked\") == 0) {\n+                                } else if (playersTooClose()) {\n                                     cm.sendOk(\"Oh, hello there. I have been #bmonitoring your moves#k since you guys entered this perimeter. Quite the feat reaching here, I commend all of you. Now, now, look at the time, I've got an appointment right now, I'm afraid I will need to request my leave. But worry not, my #raccessors#k will deal with all of you. Now, if you permit me, I'm leaving now.\");\n \n+                                    eim.setIntProperty(\"yuleteTalked\", -1);\n+                                } else if (eim.getIntProperty(\"npcShocked\") == 0) {\n+                                    cm.sendOk(\"Ho~ Aren't you quite the sneaky one? Well, it matters not. I have been #bmonitoring your moves#k since you guys entered this perimeter. Quite the feat reaching here, I commend all of you. Now, now, look at the time, I've got an appointment right now, I'm afraid I will need to request my leave. But worry not, my #raccessors#k will deal with all of you. Now, if you permit me, I'm leaving now.\");\n+\n                                     eim.setIntProperty(\"yuleteTalked\", -1);\n                                 } else {\n                                     cm.sendOk(\"... Hah! What, wh-- How did you get here?! I though I had sealed all paths here! No matter, this situation will be resolved soon. Guys: DEPLOY the #rmaster weapon#k!! You! Yes, you. Don't you think this ends here, look back at your companions, they need some help! I'll be retreating for now.\");"}, {"sha": "8a9341aa87b6d5f532ca4edad67c57d2e1eea874", "filename": "scripts/npc/9201002.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201002.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -344,7 +344,7 @@ function action(mode, type, selection) {\n                                             cm.sendOk(\"You have already confirmed your vows. All that is left is for your partner to confirm now.\");\n                                         } else {\n                                             eim.setIntProperty(\"weddingStage\", 3);\n-                                            var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n+                                            var cmPartner = partner.getAbstractPlayerInteraction();\n \n                                             var playerItemId = detectPlayerItemid(player);\n                                             var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;"}, {"sha": "354076b11211041651e42bd8a57cdf366c51c26c", "filename": "scripts/npc/9201005.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201005.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -159,7 +159,7 @@ function action(mode, type, selection) {\n                                         return;\n                                     }\n                                     \n-                                    if(!cm.getUnclaimedMarriageGifts().isEmpty() || !partner.getClient().getAbstractPlayerInteraction().getUnclaimedMarriageGifts().isEmpty()) {\n+                                    if(!cm.getUnclaimedMarriageGifts().isEmpty() || !partner.getAbstractPlayerInteraction().getUnclaimedMarriageGifts().isEmpty()) {\n                                         cm.sendOk(\"Eerhm... I'm sorry, something doesn't seem right according to the Amoria's Wedding Gift Registry reserve. Please check in the situation with #b#p9201014##k.\");\n                                         cm.dispose();\n                                         return;\n@@ -178,7 +178,7 @@ function action(mode, type, selection) {\n \n                                             var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n                                             cm.gainItem(weddingSendTicket,15,false,true,expirationTime);\n-                                            partner.getClient().getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n+                                            partner.getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n \n                                             var placeTime = cserv.getWeddingReservationTimeLeft(weddingId);\n "}, {"sha": "077c98b2b4b8e4f39bd4afe3e2103cfda00f6391", "filename": "scripts/npc/9201007.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201007.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -111,7 +111,7 @@ function action(mode, type, selection) {\n     } else if (status == 1) {\n         var cmPartner;\n         try {\n-            cmPartner = cm.getMap().getCharacterById(cm.getPlayer().getPartnerId()).getClient().getAbstractPlayerInteraction();\n+            cmPartner = cm.getMap().getCharacterById(cm.getPlayer().getPartnerId()).getAbstractPlayerInteraction();\n         } catch(err) {\n             cmPartner = null;\n         }"}, {"sha": "b13337fc78301d8482e7bbfa6391980cc7cddaa9", "filename": "scripts/npc/9201008.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201008.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -159,7 +159,7 @@ function action(mode, type, selection) {\n                                         return;\n                                     }\n                                     \n-                                    if(!cm.getUnclaimedMarriageGifts().isEmpty() || !partner.getClient().getAbstractPlayerInteraction().getUnclaimedMarriageGifts().isEmpty()) {\n+                                    if(!cm.getUnclaimedMarriageGifts().isEmpty() || !partner.getAbstractPlayerInteraction().getUnclaimedMarriageGifts().isEmpty()) {\n                                         cm.sendOk(\"Eerhm... I'm sorry, something doesn't seem right according to the Amoria's Wedding Gift Registry reserve. Please check in the situation with #b#p9201014##k.\");\n                                         cm.dispose();\n                                         return;\n@@ -178,7 +178,7 @@ function action(mode, type, selection) {\n \n                                             var expirationTime = cserv.getRelativeWeddingTicketExpireTime(resStatus);\n                                             cm.gainItem(weddingSendTicket,15,false,true,expirationTime);\n-                                            partner.getClient().getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n+                                            partner.getAbstractPlayerInteraction().gainItem(weddingSendTicket,15,false,true,expirationTime);\n \n                                             var placeTime = cserv.getWeddingReservationTimeLeft(weddingId);\n "}, {"sha": "815aa0ad92a288ab4b6bfe498a21fbcb11e66136", "filename": "scripts/npc/9201009.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201009.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -111,7 +111,7 @@ function action(mode, type, selection) {\n     } else if (status == 1) {\n         var cmPartner;\n         try {\n-            cmPartner = cm.getMap().getCharacterById(cm.getPlayer().getPartnerId()).getClient().getAbstractPlayerInteraction();\n+            cmPartner = cm.getMap().getCharacterById(cm.getPlayer().getPartnerId()).getAbstractPlayerInteraction();\n         } catch(err) {\n             cmPartner = null;\n         }"}, {"sha": "b81902eab3c75e9e3db2d35b35a479a7ace2e67e", "filename": "scripts/npc/9201011.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9201011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201011.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -214,7 +214,7 @@ function action(mode, type, selection) {\n                                         cm.sendOk(\"You have already confirmed your vows. All that is left is for your partner to confirm now.\");\n                                     } else {\n                                         eim.setIntProperty(\"weddingStage\", 3);\n-                                        var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n+                                        var cmPartner = partner.getAbstractPlayerInteraction();\n \n                                         var playerItemId = detectPlayerItemid(player);\n                                         var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;"}, {"sha": "ab64b59dad836e12a7f13f2f6e7e426bfe66f533", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -47,7 +47,7 @@ function writeFeatureTab_PQs() {\n         addFeature(\"Brand-new PQs: BossRushPQ, CafePQ.\");\n         addFeature(\"Mu Lung Dojo.\");\n         addFeature(\"Monster Carnival 1 & 2 - thanks Dragohe4rt & Jayd!\");\n-        addFeature(\"AriantPQ - thanks Dragohe4rt!\");\n+        addFeature(\"AriantPQ - thanks Dragohe4rt & Jayd!\");\n         addFeature(\"Capt. Latanica with party fighting the boss.\");\n         addFeature(\"Filled up missing obligatory event script methods.\");\n         addFeature(\"Secured uniquety of active lobby-name instances.\");\n@@ -222,6 +222,7 @@ function writeFeatureTab_Serverpotentials() {\n         addFeature(\"SP cap past tier-level, recovered after job upgrade.\");\n         addFeature(\"Bypassable PIN/PIC system for authenticated users.\");\n         addFeature(\"Automatic account registration - thanks shavit!\");\n+        addFeature(\"Any NPC scriptable - thanks GabrielSin!\");\n }\n \n function writeFeatureTab_Commands() {"}, {"sha": "1be873d4696a5ec6e3fc773a9ab7afad152d988b", "filename": "scripts/npc/cpqchallenge.js", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/cpqchallenge.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/cpqchallenge.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/cpqchallenge.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -18,10 +18,12 @@ function start(chrs) {\n \n function action(mode, type, selection) {\n     if (mode == -1) {\n+        cm.answerCPQChallenge(false);\n         cm.getChar().setChallenged(false);\n         cm.dispose();\n     } else {\n         if (mode == 0) {\n+            cm.answerCPQChallenge(false);\n             cm.getChar().setChallenged(false);\n             cm.dispose();\n             return;\n@@ -43,16 +45,16 @@ function action(mode, type, selection) {\n                     snd += \"#bName: \" + party.get(i).getName() + \" / (Level: \" + party.get(i).getLevel() + \") / \" + GameConstants.getJobName(party.get(i).getJobId()) + \"#k\\r\\n\\r\\n\";\n                 cm.sendAcceptDecline(snd + \"Would you like to fight this party at the Monster Carnival?\");\n             } else {\n-                return;\n+                cm.answerCPQChallenge(false);\n+                cm.getChar().setChallenged(false);\n+                cm.dispose();\n             }\n         } else if (status == 1) {\n-            var ch = cm.getChrById(party.get(0).getId());\n             if (party.size() == cm.getParty().getMembers().size()) {\n-                cm.startCPQ(ch, ch.getMapId() + 1);\n-                ch.getParty().setEnemy(cm.getPlayer().getParty());\n-                cm.getChar().getParty().setEnemy(ch.getParty());\n-                cm.getChar().setChallenged(false);\n+                cm.answerCPQChallenge(true);\n             } else {\n+                cm.answerCPQChallenge(false);\n+                cm.getChar().setChallenged(false);\n                 cm.sendOk(\"The number of players between the teams is not the same.\");\n             }\n             cm.dispose();"}, {"sha": "1be873d4696a5ec6e3fc773a9ab7afad152d988b", "filename": "scripts/npc/cpqchallenge2.js", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/cpqchallenge2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/npc/cpqchallenge2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/cpqchallenge2.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -18,11 +18,12 @@ function start(chrs) {\n \n function action(mode, type, selection) {\n     if (mode == -1) {\n+        cm.answerCPQChallenge(false);\n         cm.getChar().setChallenged(false);\n         cm.dispose();\n     } else {\n         if (mode == 0) {\n-            cm.sendOk(\"Come back once you have thought about it some more.\");\n+            cm.answerCPQChallenge(false);\n             cm.getChar().setChallenged(false);\n             cm.dispose();\n             return;\n@@ -44,14 +45,18 @@ function action(mode, type, selection) {\n                     snd += \"#bName: \" + party.get(i).getName() + \" / (Level: \" + party.get(i).getLevel() + \") / \" + GameConstants.getJobName(party.get(i).getJobId()) + \"#k\\r\\n\\r\\n\";\n                 cm.sendAcceptDecline(snd + \"Would you like to fight this party at the Monster Carnival?\");\n             } else {\n-                return;\n+                cm.answerCPQChallenge(false);\n+                cm.getChar().setChallenged(false);\n+                cm.dispose();\n             }\n         } else if (status == 1) {\n-            var ch = cm.getChrById(party.get(0).getId());\n-            cm.startCPQ2(ch, ch.getMapId() + 1);\n-            ch.getParty().setEnemy(cm.getPlayer().getParty());\n-            cm.getChar().getParty().setEnemy(ch.getParty());\n-            cm.getChar().setChallenged(false);\n+            if (party.size() == cm.getParty().getMembers().size()) {\n+                cm.answerCPQChallenge(true);\n+            } else {\n+                cm.answerCPQChallenge(false);\n+                cm.getChar().setChallenged(false);\n+                cm.sendOk(\"The number of players between the teams is not the same.\");\n+            }\n             cm.dispose();\n         }\n     }"}, {"sha": "be984738d49f1a9f0b49346037c0b3d7181e431a", "filename": "scripts/portal/TD_MC_enterboss2.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/TD_MC_enterboss2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/TD_MC_enterboss2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_MC_enterboss2.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -35,7 +35,7 @@ function enter(pi) {\n                 return false;\n             }\n         } else {\n-            if (em.startInstance(pi.getPlayer(), pi.getMap())) {\n+            if (em.startInstance(pi.getPlayer())) { // thanks RedHat for noticing an issue here\n                 pi.playPortalSound();\n                 return true;\n             } else {\n@@ -57,7 +57,7 @@ function enter(pi) {\n                 return false;\n             }\n         } else {\n-            if (em.startInstance(pi.getPlayer(), pi.getMap())) {\n+            if (em.startInstance(pi.getPlayer())) {\n                 pi.playPortalSound();\n                 return true;\n             } else {"}, {"sha": "b9d7a2a5d4c387e36f5f5b350b378ee81a0a4eee", "filename": "scripts/portal/party3_r6pt.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/party3_r6pt.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/party3_r6pt.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party3_r6pt.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -43,11 +43,11 @@ function enter(pi) {\n     var pRow = Math.floor(portalId / 10);\n     var pCol = portalId % 10;\n     \n-\n     if (pCol == parseInt(comb.substring(pRow, pRow + 1), 10)) {    //climb\n         pi.playPortalSound(); pi.warp(pi.getMapId(), (pRow % 4 != 0) ? pi.getPortal().getId() + 4 : (pRow / 4));\n     } else {    //fail\n-        pi.playPortalSound(); pi.warp(pi.getMapId(), 5);\n+        pRow--;\n+        pi.playPortalSound(); pi.warp(pi.getMapId(), (pRow / 4) > 1 ? (pRow / 4) : 5);  // thanks Chloek3, seth1 for noticing next plaform issues\n     }\n     \n     return true;"}, {"sha": "e80f27a744799280bd7b1d81025b57b79503eacc", "filename": "scripts/portal/party6_stage800.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/party6_stage800.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/party6_stage800.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/party6_stage800.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -5,7 +5,8 @@ function enter(pi) {\n     pi.removeAll(4001169);\n     pi.removeAll(2270004);\n     \n-    if(pi.getMap().getReactorByName(\"\") != null && pi.getMap().getReactorByName(\"\").getState() == 1) {\n+    var spring = pi.getMap().getReactorById(3008000);  // thanks Chloek3, seth1 for noticing fragments not being awarded properly\n+    if(spring != null && spring.getState() > 0) {\n         if(!pi.canHold(4001198, 1)) {\n             pi.playerMessage(5, \"Check for a free space on your ETC inventory before entering this portal.\");\n             return false;"}, {"sha": "3dbaf071215d872ac89d49ec54a68f123c858ef9", "filename": "scripts/portal/rnj5_rp.js", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/rnj5_rp.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/portal/rnj5_rp.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/rnj5_rp.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -25,17 +25,6 @@ function enter(pi) {\n     var mapplayer = \"stage6_comb\" + (pi.getMapId() % 10);\n     var eim = pi.getEventInstance();\n     \n-    if(eim.getProperty(mapplayer) == null) {\n-        var comb = \"\";\n-\n-        for(var i = 0; i < 10; i++) {\n-            var r = Math.floor((Math.random() * 4));\n-            comb += r.toString();\n-        }\n-        \n-        eim.setProperty(mapplayer, comb);\n-    }\n-\n     var comb = eim.getProperty(mapplayer);\n     \n     var name = pi.getPortal().getName().substring(2, 4);"}, {"sha": "d6116bd8c226156c53e480ae8c20df0f94e1186a", "filename": "scripts/quest/21703.js", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/quest/21703.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/quest/21703.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21703.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -67,10 +67,9 @@ function end(mode, type, selection) {\n \t    qm.teachSkill(21000000, qm.getPlayer().getSkillLevel(21000000), 10, -1);   // Combo Ability Skill\n \t    qm.gainExp(2800);\n \t}\n-\t\tqm.sendNext(\"(You remembered the #bCombo Ability#k skill! You were skeptical of the training at first, since the old man suffers from Alzheimer's and all, but boy, was it effective!)\", 2);\n-\t\tqm.showInfo(\"Effect/BasicEff.img/AranGetSkill\");\n+        qm.sendNext(\"(You remembered the #bCombo Ability#k skill! You were skeptical of the training at first, since the old man suffers from Alzheimer's and all, but boy, was it effective!)\", 2);\n     } else if (status == 4) {\n-\t\tqm.sendPrev(\"Now report back to #p1201000#. I know she'll be ecstatic when she sees the progress you've made!\");\n-\t\tqm.dispose();\n+        qm.sendPrev(\"Now report back to #p1201000#. I know she'll be ecstatic when she sees the progress you've made!\");\n+        qm.dispose();\n     }\n }\n\\ No newline at end of file"}, {"sha": "e054020f21183de6782cc8818878a28cf39d07e7", "filename": "scripts/quest/21720.js", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/quest/21720.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/scripts/quest/21720.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21720.js?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -39,7 +39,6 @@ function end(mode, type, selection) {\n \t    qm.teachSkill(21001003, qm.getPlayer().getSkillLevel(21001003), 20, -1);\n \t    qm.gainExp(3900);\n \t}\n-        qm.showIntro(\"Effect/BasicEff.img/AranGetSkill\");\n         qm.sendNext('#b(You remembered the Polearm Booster skill!)#k', 2);\n     } else if (status == 8) {\n     \tqm.sendNextPrev(\"This skill was found in an ancient incomprehensible script. I had a hunch it might be a skill you used in the past, and I think I was right. You're not as strong as you used to be, but you'll get there, in time.\", 8);"}, {"sha": "888edc4d4b10f8a79880f27f48577ae2e597cf15", "filename": "sql/db_database.sql", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -12794,7 +12794,8 @@ INSERT INTO `drop_data_global` (`id`, `continent`, `itemid`, `minimum_quantity`,\n (2, -1, 4031866, 1, 1, 0, 20000, 'NX Card 250 PTS'),\n (3, -1, 4001126, 1, 2, 0, 8000, 'Maple Leaves'),\n (4, -1, 2049100, 1, 1, 0, 1200, 'Chaos Scroll 60%'),\n-(5, -1, 4001006, 1, 1, 0, 10000, 'Flaming Feather');\n+(5, -1, 2340000, 1, 1, 0, 1200, 'White Scroll'),\n+(6, -1, 4001006, 1, 1, 0, 10000, 'Flaming Feather');\n \n CREATE TABLE IF NOT EXISTS `dueyitems` (\n   `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n@@ -16461,7 +16462,6 @@ INSERT INTO `nxcoupons` (`id`, `couponid`, `rate`, `activeday`, `starthour`, `en\n (39,5360008,2,254,6,10),\n (40,5360042,2,254,0,24);\n \n-\n CREATE TABLE IF NOT EXISTS `pets` (\n   `petid` int(10) unsigned NOT NULL AUTO_INCREMENT,\n   `name` varchar(13) DEFAULT NULL,\n@@ -16583,6 +16583,7 @@ CREATE TABLE IF NOT EXISTS `queststatus` (\n   `time` int(11) NOT NULL DEFAULT '0',\n   `expires` bigint(20) NOT NULL DEFAULT '0',\n   `forfeited` int(11) NOT NULL DEFAULT '0',\n+  `completed` int(11) NOT NULL DEFAULT '0',\n   `info` tinyint(3) NOT NULL DEFAULT '0',\n   PRIMARY KEY (`queststatusid`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;"}, {"sha": "118123834252171d98337cd4f382ff1fc7b71592", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 26, "deletions": 21, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -64,6 +64,7 @@\n import net.server.world.MaplePartyCharacter;\n import net.server.world.PartyOperation;\n import net.server.world.World;\n+import scripting.AbstractPlayerInteraction;\n import scripting.event.EventInstanceManager;\n import server.CashShop;\n import server.MapleItemInformationProvider;\n@@ -199,7 +200,7 @@\n     private int expRate = 1, mesoRate = 1, dropRate = 1, expCoupon = 1, mesoCoupon = 1, dropCoupon = 1;\n     private int omokwins, omokties, omoklosses, matchcardwins, matchcardties, matchcardlosses;\n     private int owlSearch;\n-    private long lastfametime, lastUsedCashItem, lastExpression = 0, lastHealed, lastBuyback = 0, lastDeathtime, lastMesoDrop = -1, jailExpiration = -1;\n+    private long lastfametime, lastUsedCashItem, lastExpression = 0, lastHealed, lastBuyback = 0, lastDeathtime, jailExpiration = -1;\n     private transient int localstr, localdex, localluk, localint_, localmagic, localwatk;\n     private transient int equipmaxhp, equipmaxmp, equipstr, equipdex, equipluk, equipint_, equipmagic, equipwatk, localchairhp, localchairmp;\n     private int localchairrate;\n@@ -2954,22 +2955,24 @@ public void forceUpdateItem(Item item) {\n \n     public void gainGachaExp() {\n         int expgain = 0;\n-        int currentgexp = gachaexp.get();\n+        long currentgexp = gachaexp.get();\n         if ((currentgexp + exp.get()) >= ExpTable.getExpNeededForLevel(level)) {\n             expgain += ExpTable.getExpNeededForLevel(level) - exp.get();\n+            \n             int nextneed = ExpTable.getExpNeededForLevel(level + 1);\n-            if ((currentgexp - expgain) >= nextneed) {\n+            if (currentgexp - expgain >= nextneed) {\n                 expgain += nextneed;\n             }\n-            this.gachaexp.set(currentgexp - expgain);\n+            \n+            this.gachaexp.set((int) (currentgexp - expgain));\n         } else {\n             expgain = this.gachaexp.getAndSet(0);\n         }\n-        gainExp(expgain, false, false);\n+        gainExp(expgain, false, true);\n         updateSingleStat(MapleStat.GACHAEXP, this.gachaexp.get());\n     }\n \n-    public void gainGachaExp(int gain) {\n+    public void addGachaExp(int gain) {\n         updateSingleStat(MapleStat.GACHAEXP, gachaexp.addAndGet(gain));\n     }\n     \n@@ -4296,6 +4299,10 @@ public MapleClient getClient() {\n         return client;\n     }\n     \n+    public AbstractPlayerInteraction getAbstractPlayerInteraction() {\n+        return client.getAbstractPlayerInteraction();\n+    }\n+    \n     public final List<MapleQuestStatus> getCompletedQuests() {\n         synchronized (quests) {\n             List<MapleQuestStatus> ret = new LinkedList<>();\n@@ -4930,8 +4937,9 @@ public int getMerchantNetMeso() {\n         \n         if (elapsedDays > 100) elapsedDays = 100;\n         \n-        int netMeso = (merchantmeso * (100 - elapsedDays)) / 100;\n-        return netMeso;\n+        long netMeso = (long) merchantmeso; // negative mesos issues found thanks to Flash, Vcoc\n+        netMeso = (netMeso * (100 - elapsedDays)) / 100;\n+        return (int) netMeso;\n     }\n \n     public int getMesosTraded() {\n@@ -6906,6 +6914,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                     }\n \n                     status.setForfeited(rs.getInt(\"forfeited\"));\n+                    status.setCompleted(rs.getInt(\"completed\"));\n                     ret.quests.put(q.getId(), status);\n                     loadedQuestStatus.put(rs.getInt(\"queststatusid\"), status);\n                 }\n@@ -7665,7 +7674,8 @@ public synchronized void resetStats() {\n     }\n     \n     public void resetBattleshipHp() {\n-        this.battleshipHp = 400 * getSkillLevel(SkillFactory.getSkill(Corsair.BATTLE_SHIP)) + ((getLevel() - 120) * 200);\n+        int bshipLevel = Math.max(getLevel() - 120, 0);  // thanks alex12 for noticing battleship HP issues for low-level players\n+        this.battleshipHp = 400 * getSkillLevel(SkillFactory.getSkill(Corsair.BATTLE_SHIP)) + (bshipLevel * 200);\n     }\n     \n     public void resetEnteredScript() {\n@@ -8254,7 +8264,7 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n             \n             deleteQuestProgressWhereCharacterId(con, id);\n             \n-            ps = con.prepareStatement(\"INSERT INTO queststatus (`queststatusid`, `characterid`, `quest`, `status`, `time`, `expires`, `forfeited`) VALUES (DEFAULT, ?, ?, ?, ?, ?, ?)\", Statement.RETURN_GENERATED_KEYS);\n+            ps = con.prepareStatement(\"INSERT INTO queststatus (`queststatusid`, `characterid`, `quest`, `status`, `time`, `expires`, `forfeited`, `completed`) VALUES (DEFAULT, ?, ?, ?, ?, ?, ?, ?)\", Statement.RETURN_GENERATED_KEYS);\n             PreparedStatement psf;\n             try (PreparedStatement pse = con.prepareStatement(\"INSERT INTO questprogress VALUES (DEFAULT, ?, ?, ?, ?)\")) {\n                 psf = con.prepareStatement(\"INSERT INTO medalmaps VALUES (DEFAULT, ?, ?, ?)\");\n@@ -8267,6 +8277,7 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n                         ps.setInt(4, (int) (q.getCompletionTime() / 1000));\n                         ps.setLong(5, q.getExpirationTime());\n                         ps.setInt(6, q.getForfeited());\n+                        ps.setInt(7, q.getCompleted());\n                         ps.executeUpdate();\n                         try (ResultSet rs = ps.getGeneratedKeys()) {\n                             rs.next();\n@@ -8549,8 +8560,10 @@ public void setMerchantMeso(int set) {\n     \n     public synchronized void withdrawMerchantMesos() {\n         int merchantMeso = this.getMerchantNetMeso();\n+        int playerMeso = this.getMeso();\n+        \n         if (merchantMeso > 0) {\n-            int possible = Integer.MAX_VALUE - merchantMeso;\n+            int possible = Integer.MAX_VALUE - playerMeso;\n             \n             if (possible > 0) {\n                 if (possible < merchantMeso) {\n@@ -8562,7 +8575,6 @@ public synchronized void withdrawMerchantMesos() {\n                 }\n             }\n         } else {\n-            int playerMeso = this.getMeso();\n             int nextMeso = playerMeso + merchantMeso;\n             \n             if (nextMeso < 0) {\n@@ -9401,9 +9413,10 @@ public void updateQuest(MapleQuestStatus quest) {\n         } else if (quest.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n             MapleQuest mquest = quest.getQuest();\n             short questid = mquest.getId();\n-            if(!mquest.isSameDayRepeatable() && !MapleQuest.isExploitableQuest(questid)) {\n+            if (!mquest.isSameDayRepeatable() && !MapleQuest.isExploitableQuest(questid)) {\n                 awardQuestPoint(ServerConstants.QUEST_POINT_PER_QUEST_COMPLETE);\n             }\n+            quest.setCompleted(quest.getCompleted() + 1);   // count quest completed Jayd's idea\n             \n             announce(MaplePacketCreator.completeQuest(questid, quest.getCompletionTime()));\n         } else if (quest.getStatus().equals(MapleQuestStatus.Status.NOT_STARTED)) {\n@@ -10040,14 +10053,6 @@ public void toggleWhiteChat() {\n         whiteChat = !whiteChat;\n     }\n \n-    public boolean canDropMeso() {\n-        if (System.currentTimeMillis() - lastMesoDrop >= 200 || lastMesoDrop == -1) { //About 200 meso drops a minute\n-            lastMesoDrop = System.currentTimeMillis();\n-            return true;\n-        }\n-        return false;\n-    }\n-\n     // These need to be renamed, but I am too lazy right now to go through the scripts and rename them...\n     public String getPartyQuestItems() {\n         return dataString;"}, {"sha": "4af9f01cb3043c548d044da445e534c6b39dbb84", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 3, "deletions": 13, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -888,7 +888,6 @@ private void removePlayer(World wserv, boolean serverTransition) {\n                         player.cancelAllBuffs(true);\n                         \n                         player.closePlayerInteractions();\n-                        QuestScriptManager.getInstance().dispose(this);\n                         \n                         if (!serverTransition) {    // thanks MedicOP for detecting an issue with party leader change on changing channels\n                                 removePartyPlayer(wserv);\n@@ -1463,18 +1462,8 @@ public void changeChannel(int channel) {\n \t\t\treturn;\n                 }\n                 \n-\t\tif (player.getTrade() != null) {\n-\t\t\tMapleTrade.cancelTrade(getPlayer(), MapleTrade.TradeResult.PARTNER_CANCEL);\n-\t\t}\n-\n-\t\tMapleHiredMerchant merchant = player.getHiredMerchant();\n-\t\tif (merchant != null) {\n-\t\t\tif (merchant.isOwner(getPlayer())) {\n-\t\t\t\tmerchant.setOpen(true);\n-\t\t\t} else {\n-\t\t\t\tmerchant.removeVisitor(getPlayer());\n-\t\t\t}\n-\t\t}\n+\t\tplayer.closePlayerInteractions();\n+                \n                 player.unregisterChairBuff();\n \t\tserver.getPlayerBuffStorage().addBuffsToStorage(player.getId(), player.getAllBuffs());\n                 server.getPlayerBuffStorage().addDiseasesToStorage(player.getId(), player.getAllDiseases());\n@@ -1540,6 +1529,7 @@ public void requestedServerlist(int worlds) {\n         public void closePlayerScriptInteractions() {\n                 this.removeClickedNPC();\n                 NPCScriptManager.getInstance().dispose(this);\n+                QuestScriptManager.getInstance().dispose(this);\n         }\n         \n         public boolean attemptCsCoupon() {"}, {"sha": "9e0ccc9dd164cbf3183f88783add6472158fcdf2", "filename": "src/client/MapleQuestStatus.java", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleQuestStatus.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/MapleQuestStatus.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleQuestStatus.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -65,7 +65,7 @@ public static Status getById(int id) {\n     private final List<Integer> medalProgress = new LinkedList<Integer>();\n     private int npc;\n     private long completionTime, expirationTime;\n-    private int forfeited = 0;\n+    private int forfeited = 0, completed = 0;\n     private String customData;\n \n     public MapleQuestStatus(MapleQuest quest, Status status) {\n@@ -214,6 +214,10 @@ public int getForfeited() {\n         return forfeited;\n     }\n     \n+    public int getCompleted() {\n+        return completed;\n+    }\n+    \n     public String getInfo() {\n         if(!progress.containsKey(0) && !getMedalMaps().isEmpty()) {\n             return Integer.toString(getMedalProgress());\n@@ -233,6 +237,14 @@ public void setForfeited(int forfeited) {\n             throw new IllegalArgumentException(\"Can't set forfeits to something lower than before.\");\n         }\n     }\n+    \n+    public void setCompleted(int completed) {\n+        if (completed >= this.completed) {\n+            this.completed = completed;\n+        } else {\n+            throw new IllegalArgumentException(\"Can't set completes to something lower than before.\");\n+        }\n+    }\n \n     public final void setCustomData(final String customData) {\n         this.customData = customData;"}, {"sha": "98be5949095d6c6372cda20deb85eb84ed8e7231", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -204,6 +204,8 @@ private void registerLv0Commands(){\n         addCommand(\"enableauth\", EnableAuthCommand.class);\n         addCommand(\"toggleexp\", ToggleExpCommand.class);\n         addCommand(\"mylawn\", MapOwnerClaimCommand.class);\n+        addCommand(\"bosshp\", BossHpCommand.class);\n+        addCommand(\"mobhp\", MobHpCommand.class);\n         \n         commandsNameDesc.add(levelCommandsCursor);\n     }\n@@ -212,8 +214,6 @@ private void registerLv0Commands(){\n     private void registerLv1Commands() {\n         levelCommandsCursor = new Pair<>((List<String>) new ArrayList<String>(), (List<String>) new ArrayList<String>());\n         \n-        addCommand(\"bosshp\", 1, BossHpCommand.class);\n-        addCommand(\"mobhp\", 1, MobHpCommand.class);\n         addCommand(\"whatdropsfrom\", 1, WhatDropsFromCommand.class);\n         addCommand(\"whodrops\", 1, WhoDropsCommand.class);\n         addCommand(\"buffme\", 1, BuffMeCommand.class);\n@@ -291,7 +291,6 @@ private void registerLv3Commands() {\n         addCommand(\"givevp\", 3, GiveVpCommand.class);\n         addCommand(\"givems\", 3, GiveMesosCommand.class);\n         addCommand(\"giverp\", 3, GiveRpCommand.class);\n-        addCommand(\"id\", 3, IdCommand.class);\n         addCommand(\"expeds\", 3, ExpedsCommand.class);\n         addCommand(\"kill\", 3, KillCommand.class);\n         addCommand(\"seed\", 3, SeedCommand.class);\n@@ -307,7 +306,6 @@ private void registerLv3Commands() {\n         addCommand(\"startmapevent\", 3, StartMapEventCommand.class);\n         addCommand(\"stopmapevent\", 3, StopMapEventCommand.class);\n         addCommand(\"online2\", 3, OnlineTwoCommand.class);\n-        addCommand(\"warpsnowball\", 3, WarpSnowBallCommand.class);\n         addCommand(\"ban\", 3, BanCommand.class);\n         addCommand(\"unban\", 3, UnBanCommand.class);\n         addCommand(\"healmap\", 3, HealMapCommand.class);\n@@ -339,6 +337,7 @@ private void registerLv4Commands(){\n         addCommand(\"exprate\", 4, ExpRateCommand.class);\n         addCommand(\"mesorate\", 4, MesoRateCommand.class);\n         addCommand(\"droprate\", 4, DropRateCommand.class);\n+        addCommand(\"bossdroprate\", 4, BossDropRateCommand.class);\n         addCommand(\"questrate\", 4, QuestRateCommand.class);\n         addCommand(\"travelrate\", 4, TravelRateCommand.class);\n         addCommand(\"fishrate\", 4, FishingRateCommand.class);"}, {"sha": "282492943510ead8a3f5316dcbac5de6b934b266", "filename": "src/client/command/commands/gm1/GotoCommand.java", "status": "modified", "additions": 49, "deletions": 2, "changes": 51, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm1/GotoCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm1/GotoCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/GotoCommand.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -27,23 +27,64 @@\n import client.command.Command;\n import client.MapleClient;\n import constants.GameConstants;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import net.server.Server;\n import server.MaplePortal;\n import server.maps.FieldLimit;\n import server.maps.MapleMap;\n+import server.maps.MapleMapFactory;\n import server.maps.MapleMiniDungeonInfo;\n \n+import java.util.Comparator;\n import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n \n public class GotoCommand extends Command {\n+    \n     {\n         setDescription(\"\");\n+        \n+        MapleMapFactory mapFactory = Server.getInstance().getWorlds().get(0).getChannels().get(0).getMapFactory();\n+        \n+        List<Entry<String, Integer>> towns = new ArrayList<>(GameConstants.GOTO_TOWNS.entrySet());\n+        sortGotoEntries(towns);\n+        for (Map.Entry<String, Integer> e : towns) {\n+            GOTO_TOWNS_INFO += (\"'\" + e.getKey() + \"' - #b\" + (mapFactory.getMap(e.getValue()).getMapName()) + \"#k\\r\\n\");\n+        }\n+        \n+        List<Entry<String, Integer>> areas = new ArrayList<>(GameConstants.GOTO_AREAS.entrySet());\n+        sortGotoEntries(areas);\n+        for (Map.Entry<String, Integer> e : areas) {\n+            GOTO_AREAS_INFO += (\"'\" + e.getKey() + \"' - #b\" + (mapFactory.getMap(e.getValue()).getMapName()) + \"#k\\r\\n\");\n+        }\n+    }\n+    \n+    public static String GOTO_TOWNS_INFO = \"\";\n+    public static String GOTO_AREAS_INFO = \"\";\n+    \n+    private static void sortGotoEntries(List<Entry<String, Integer>> listEntries) {\n+        Collections.sort(listEntries, new Comparator<Entry<String, Integer>>() {\n+            @Override\n+            public int compare(Entry<String, Integer> e1, Entry<String, Integer> e2)\n+            {\n+                return e1.getValue().compareTo(e2.getValue());\n+            }\n+        });\n     }\n \n     @Override\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         if (params.length < 1){\n-            player.yellowMessage(\"Syntax: @goto <map name>\");\n+            String sendStr = \"Syntax: #b@goto <map name>#k. Available areas:\\r\\n\\r\\n#rTowns:#k\\r\\n\" + GOTO_TOWNS_INFO;\n+            if (player.isGM()) {\n+                sendStr += (\"\\r\\n#rAreas:#k\\r\\n\" + GOTO_AREAS_INFO);\n+            }\n+            \n+            player.getAbstractPlayerInteraction().npcTalk(9000020, sendStr);\n             return;\n         }\n         \n@@ -74,7 +115,13 @@ public void execute(MapleClient c, String[] params) {\n             player.saveLocationOnWarp();\n             player.changeMap(target, targetPortal);\n         } else {\n-            player.dropMessage(5, \"Area '\" + params[0] + \"' is not registered.\");\n+            // detailed info on goto available areas suggested thanks to Vcoc\n+            String sendStr = \"Area '#r\" + params[0] + \"#k' is not available. Available areas:\\r\\n\\r\\n#rTowns:#k\" + GOTO_TOWNS_INFO;\n+            if (player.isGM()) {\n+                sendStr += (\"\\r\\n#rAreas:#k\\r\\n\" + GOTO_AREAS_INFO);\n+            }\n+            \n+            player.getAbstractPlayerInteraction().npcTalk(9000020, sendStr);\n         }\n     }\n }"}, {"sha": "1ef0f045be82a7e2ea288abac494939905ee2839", "filename": "src/client/command/commands/gm1/WhatDropsFromCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm1/WhatDropsFromCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm1/WhatDropsFromCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhatDropsFromCommand.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -62,7 +62,7 @@ public void execute(MapleClient c, String[] params) {\n                         if (name == null || name.equals(\"null\") || drop.chance == 0){\n                             continue;\n                         }\n-                        float chance = 1000000 / drop.chance / (!MapleMonsterInformationProvider.getInstance().isBoss(mobId) ? player.getDropRate() : player.getBossDropRate());\n+                        float chance = Math.max(1000000 / drop.chance / (!MapleMonsterInformationProvider.getInstance().isBoss(mobId) ? player.getDropRate() : player.getBossDropRate()), 1);\n                         output += \"- \" + name + \" (1/\" + (int) chance + \")\\r\\n\";\n                     } catch (Exception ex){\n                         ex.printStackTrace();"}, {"sha": "c19bee6714e74ee54d321925417ec1be8d932182", "filename": "src/client/command/commands/gm3/IdCommand.java", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b6a91c523fae668eb785c2fb61933a4ebe862bc3/src/client/command/commands/gm3/IdCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b6a91c523fae668eb785c2fb61933a4ebe862bc3/src/client/command/commands/gm3/IdCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm3/IdCommand.java?ref=b6a91c523fae668eb785c2fb61933a4ebe862bc3", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.gm3;\n-\n-import client.command.Command;\n-import client.MapleClient;\n-import client.MapleCharacter;\n-\n-import java.io.BufferedReader;\n-import java.io.InputStreamReader;\n-import java.net.URL;\n-\n-public class IdCommand extends Command {\n-    {\n-        setDescription(\"\");\n-    }\n-\n-    @Override\n-    public void execute(MapleClient c, String[] params) {\n-        MapleCharacter player = c.getPlayer();\n-        if (params.length < 1) {\n-            player.yellowMessage(\"Syntax: !id <id>\");\n-            return;\n-        }\n-        try {\n-            try (BufferedReader dis = new BufferedReader(new InputStreamReader(new URL(\"http://www.mapletip.com/search_java.php?search_value=\" + params[0] + \"&check=true\").openConnection().getInputStream()))) {\n-                String s;\n-                while ((s = dis.readLine()) != null) {\n-                    player.dropMessage(s);\n-                }\n-            }\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-        }\n-    }\n-}"}, {"sha": "afd12a2e67a92303ff83686e4fda0c27e94dadd6", "filename": "src/client/command/commands/gm4/BossDropRateCommand.java", "status": "renamed", "additions": 15, "deletions": 13, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm4/BossDropRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm4/BossDropRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/BossDropRateCommand.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1,5 +1,5 @@\n /*\n-    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    This file is part of the HeavenMS MapleStory Server\n     Copyleft (L) 2016 - 2018 RonanLana\n \n     This program is free software: you can redistribute it and/or modify\n@@ -17,30 +17,32 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n-package client.command.commands.gm3;\n+package client.command.commands.gm4;\n \n import client.command.Command;\n import client.MapleClient;\n import client.MapleCharacter;\n+import tools.MaplePacketCreator;\n \n-import java.util.List;\n-\n-public class WarpSnowBallCommand extends Command {\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class BossDropRateCommand extends Command {\n     {\n         setDescription(\"\");\n     }\n \n     @Override\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n-        List<MapleCharacter> chars = player.getMap().getAllPlayers();\n-        for (MapleCharacter chr : chars) {\n-            chr.saveLocationOnWarp();\n-            chr.changeMap(109060000, chr.getTeam());\n+        if (params.length < 1) {\n+            player.yellowMessage(\"Syntax: !bossdroprate <newrate>\");\n+            return;\n         }\n+\n+        int bossdroprate = Math.max(Integer.parseInt(params[0]), 1);\n+        c.getWorldServer().setBossDropRate(bossdroprate);\n+        c.getWorldServer().broadcastPacket(MaplePacketCreator.serverNotice(6, \"[Rate] Boss Drop Rate has been changed to \" + bossdroprate + \"x.\"));\n     }\n }", "previous_filename": "src/client/command/commands/gm3/WarpSnowBallCommand.java"}, {"sha": "3561b23d5ce37fd2f68614b18a2a52938b8ff668", "filename": "src/client/command/commands/gm4/MesoRateCommand.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm4/MesoRateCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/command/commands/gm4/MesoRateCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/MesoRateCommand.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -44,6 +44,5 @@ public void execute(MapleClient c, String[] params) {\n         int mesorate = Math.max(Integer.parseInt(params[0]), 1);\n         c.getWorldServer().setMesoRate(mesorate);\n         c.getWorldServer().broadcastPacket(MaplePacketCreator.serverNotice(6, \"[Rate] Meso Rate has been changed to \" + mesorate + \"x.\"));\n-\n     }\n }"}, {"sha": "ec5c6941aeb81791bc834c52a57a2affe799c2ec", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -24,6 +24,7 @@\n import client.MapleClient;\n import constants.ServerConstants;\n import constants.ExpTable;\n+import constants.ItemConstants;\n import java.util.HashMap;\n import java.util.LinkedList;\n import java.util.List;\n@@ -302,10 +303,33 @@ private static int randomizeStatUpgrade(int top) {\n         return stat;\n     }\n     \n+    private static boolean isPhysicalWeapon(int itemid) {\n+        Equip eqp = (Equip) MapleItemInformationProvider.getInstance().getEquipById(itemid);\n+        return eqp.getWatk() >= eqp.getMatk();\n+    }\n+    \n+    private boolean isNotWeaponAffinity(StatUpgrade name) {\n+        // WATK/MATK expected gains lessens outside of weapon affinity (physical/magic): Vcoc's idea\n+        \n+        if (ItemConstants.isWeapon(this.getItemId())) {\n+            if (name.equals(StatUpgrade.incPAD)) {\n+                if (!isPhysicalWeapon(this.getItemId())) {\n+                    return true;\n+                }\n+            } else if (name.equals(StatUpgrade.incMAD)) {\n+                if (isPhysicalWeapon(this.getItemId())) {\n+                    return true;\n+                }\n+            }\n+        }\n+        \n+        return false;\n+    }\n+    \n     private void getUnitStatUpgrade(List<Pair<StatUpgrade, Integer>> stats, StatUpgrade name, int curStat, boolean isAttribute) {\n         isUpgradeable = true;\n         \n-        int maxUpgrade = randomizeStatUpgrade((int)(1 + (curStat / getStatModifier(isAttribute))));\n+        int maxUpgrade = randomizeStatUpgrade((int)(1 + (curStat / (getStatModifier(isAttribute) * (isNotWeaponAffinity(name) ? 2.7 : 1)))));\n         if(maxUpgrade == 0) return;\n             \n         stats.add(new Pair<>(name, maxUpgrade));"}, {"sha": "af689f2a5790cd6771d502ee36b8b4c5a1f89983", "filename": "src/client/inventory/manipulator/MapleInventoryManipulator.java", "status": "modified", "additions": 49, "deletions": 9, "changes": 58, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/inventory/manipulator/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/inventory/manipulator/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleInventoryManipulator.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -69,10 +69,29 @@ public static boolean addById(MapleClient c, int itemId, short quantity, String\n     }\n \n     public static boolean addById(MapleClient c, int itemId, short quantity, String owner, int petid, byte flag, long expiration) {\n-        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        MapleInventoryType type = ItemConstants.getInventoryType(itemId);\n         MapleCharacter chr = c.getPlayer();\n-        MapleInventory inv = chr.getInventory(type);\n+        MapleInventoryType type = ItemConstants.getInventoryType(itemId);\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                MapleInventory inv = chr.getInventory(type);\n+                inv.lockInventory();\n+                try {\n+                    return addByIdInternal(c, chr, type, inv, itemId, quantity, owner, petid, flag, expiration);\n+                } finally {\n+                    inv.unlockInventory();\n+                }\n+            } finally {\n+                c.releaseClient();\n+            }\n+        } else {\n+            c.announce(MaplePacketCreator.enableActions());\n+            return false;\n+        }\n+    }\n+    \n+    private static boolean addByIdInternal(MapleClient c, MapleCharacter chr, MapleInventoryType type, MapleInventory inv, int itemId, short quantity, String owner, int petid, byte flag, long expiration) {\n+        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         if (!type.equals(MapleInventoryType.EQUIP)) {\n             short slotMax = ii.getSlotMax(c, itemId);\n             List<Item> existing = inv.listById(itemId);\n@@ -166,15 +185,36 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show) {\n \n     public static boolean addFromDrop(MapleClient c, Item item, boolean show, int petId) {\n         MapleCharacter chr = c.getPlayer();\n-        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         MapleInventoryType type = item.getInventoryType();\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                MapleInventory inv = chr.getInventory(type);\n+                inv.lockInventory();\n+                try {\n+                    return addFromDropInternal(c, chr, type, inv, item, show, petId);\n+                } finally {\n+                    inv.unlockInventory();\n+                }\n+            } finally {\n+                c.releaseClient();\n+            }\n+        } else {\n+            c.announce(MaplePacketCreator.enableActions());\n+            return false;\n+        }\n+    }\n+    \n+    private static boolean addFromDropInternal(MapleClient c, MapleCharacter chr, MapleInventoryType type, MapleInventory inv, Item item, boolean show, int petId) {\n+        MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+        \n         if (ii.isPickupRestricted(item.getItemId()) && chr.haveItemWithId(item.getItemId(), true)) {\n             c.announce(MaplePacketCreator.getInventoryFull());\n             c.announce(MaplePacketCreator.showItemUnavailable());\n             return false;\n         }\n         short quantity = item.getQuantity();\n-        MapleInventory inv = chr.getInventory(type);\n+\n         if (!type.equals(MapleInventoryType.EQUIP)) {\n             short slotMax = ii.getSlotMax(c, item.getItemId());\n             List<Item> existing = inv.listById(item.getItemId());\n@@ -214,13 +254,13 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show, int pe\n                     nItem.setPosition(newSlot);\n                     item.setPosition(newSlot);\n                     c.announce(MaplePacketCreator.modifyInventory(true, Collections.singletonList(new ModifyInventory(0, nItem))));\n-                    if(MapleInventoryManipulator.isSandboxItem(nItem)) chr.setHasSandboxItem();\n+                    if (MapleInventoryManipulator.isSandboxItem(nItem)) chr.setHasSandboxItem();\n                 }\n             } else {\n                 Item nItem = new Item(item.getItemId(), (short) 0, quantity, petId);\n                 nItem.setExpiration(item.getExpiration());\n                 nItem.setFlag(item.getFlag());\n-                \n+\n                 short newSlot = inv.addItem(nItem);\n                 if (newSlot == -1) {\n                     c.announce(MaplePacketCreator.getInventoryFull());\n@@ -230,7 +270,7 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show, int pe\n                 nItem.setPosition(newSlot);\n                 item.setPosition(newSlot);\n                 c.announce(MaplePacketCreator.modifyInventory(true, Collections.singletonList(new ModifyInventory(0, nItem))));\n-                if(MapleInventoryManipulator.isSandboxItem(nItem)) chr.setHasSandboxItem();\n+                if (MapleInventoryManipulator.isSandboxItem(nItem)) chr.setHasSandboxItem();\n                 c.announce(MaplePacketCreator.enableActions());\n             }\n         } else if (quantity == 1) {\n@@ -242,7 +282,7 @@ public static boolean addFromDrop(MapleClient c, Item item, boolean show, int pe\n             }\n             item.setPosition(newSlot);\n             c.announce(MaplePacketCreator.modifyInventory(true, Collections.singletonList(new ModifyInventory(0, item))));\n-            if(MapleInventoryManipulator.isSandboxItem(item)) chr.setHasSandboxItem();\n+            if (MapleInventoryManipulator.isSandboxItem(item)) chr.setHasSandboxItem();\n         } else {\n             FilePrinter.printError(FilePrinter.ITEM, \"Tried to pickup Equip id \" + item.getItemId() + \" containing more than 1 quantity --> \" + quantity);\n             c.announce(MaplePacketCreator.getInventoryFull());"}, {"sha": "59672063b9d0750b3b1666de3afdfe03655ab545", "filename": "src/client/processor/StorageProcessor.java", "status": "modified", "additions": 34, "deletions": 22, "changes": 56, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/processor/StorageProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/client/processor/StorageProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/StorageProcessor.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -40,6 +40,7 @@\n /**\n  *\n  * @author Matze\n+ * @author Ronan - inventory concurrency protection on storing items\n  */\n public class StorageProcessor {\n     \n@@ -97,15 +98,15 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                         short slot = slea.readShort();\n                                         int itemId = slea.readInt();\n                                         short quantity = slea.readShort();\n-                                        MapleInventoryType slotType = ItemConstants.getInventoryType(itemId);\n-                                        MapleInventory Inv = chr.getInventory(slotType);\n-                                        if (slot < 1 || slot > Inv.getSlotLimit()) { //player inv starts at one\n+                                        MapleInventoryType invType = ItemConstants.getInventoryType(itemId);\n+                                        MapleInventory inv = chr.getInventory(invType);\n+                                        if (slot < 1 || slot > inv.getSlotLimit()) { //player inv starts at one\n                                                 AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n                                                 FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to store item at slot \" + slot);\n                                                 c.disconnect(true, false);\n                                                 return;\n                                         }\n-                                        if (quantity < 1 || chr.getItemQuantity(itemId, false) < quantity) {\n+                                        if (quantity < 1) {\n                                                 c.announce(MaplePacketCreator.enableActions());\n                                                 return;\n                                         }\n@@ -118,28 +119,39 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                                         if (chr.getMeso() < storeFee) {\n                                                 c.announce(MaplePacketCreator.getStorageError((byte) 0x0B));\n                                         } else {\n-                                                MapleInventoryType invType = ItemConstants.getInventoryType(itemId);\n-                                                Item item = chr.getInventory(invType).getItem(slot).copy();\n-                                                if (item != null && item.getItemId() == itemId && (item.getQuantity() >= quantity || ItemConstants.isRechargeable(itemId))) {\n-                                                        if (ItemConstants.isWeddingRing(itemId) || ItemConstants.isWeddingToken(itemId)) {\n+                                                Item item;\n+                                                \n+                                                inv.lockInventory();    // thanks imbee for pointing a dupe within storage\n+                                                try {\n+                                                        item = inv.getItem(slot);\n+                                                        if (item != null && item.getItemId() == itemId && (item.getQuantity() >= quantity || ItemConstants.isRechargeable(itemId))) {\n+                                                                if (ItemConstants.isWeddingRing(itemId) || ItemConstants.isWeddingToken(itemId)) {\n+                                                                        c.announce(MaplePacketCreator.enableActions());\n+                                                                        return;\n+                                                                }\n+                                                                \n+                                                                if (ItemConstants.isRechargeable(itemId)) {\n+                                                                        quantity = item.getQuantity();\n+                                                                }\n+                                                                \n+                                                                MapleInventoryManipulator.removeFromSlot(c, invType, slot, quantity, false);\n+                                                        } else {\n                                                                 c.announce(MaplePacketCreator.enableActions());\n                                                                 return;\n                                                         }\n-                                                    \n-                                                        if (ItemConstants.isRechargeable(itemId)) {\n-                                                                quantity = item.getQuantity();\n-                                                        }\n-\n-                                                        chr.gainMeso(-storeFee, false, true, false);\n-                                                        MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n-                                                        MapleInventoryManipulator.removeFromSlot(c, invType, slot, quantity, false);\n-                                                        item.setQuantity(quantity);\n-                                                        storage.store(item);\n-                                                        storage.sendStored(c, ItemConstants.getInventoryType(itemId));\n-                                                        String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\");\n-                                                        chr.setUsedStorage();\n+                                                } finally {\n+                                                        inv.unlockInventory();\n                                                 }\n+                                                \n+                                                chr.gainMeso(-storeFee, false, true, false);\n+                                                \n+                                                MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n+                                                item.setQuantity(quantity);\n+                                                storage.store(item);\n+                                                storage.sendStored(c, ItemConstants.getInventoryType(itemId));\n+                                                String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n+                                                FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\");\n+                                                chr.setUsedStorage();\n                                         }\n                                 } else if (mode == 6) { // arrange items\n                                         if(ServerConstants.USE_STORAGE_ITEM_SORT) storage.arrangeItems(c);"}, {"sha": "45ab0fe9a26da873dfbd18a684cf285df565df42", "filename": "src/constants/LanguageConstants.java", "status": "modified", "additions": 81, "deletions": 58, "changes": 139, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/LanguageConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/LanguageConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/LanguageConstants.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -8,66 +8,89 @@\n  */\n public class LanguageConstants {\n     \n-    public static String CPQBlue;\n-    public static String CPQError;\n-    public static String CPQEntry;\n-    public static String CPQFindError;\n-    public static String CPQRed;\n-    public static String CPQPlayerExit;\n-    public static String CPQEntryLobby;\n-    public static String CPQPickRoom;\n-    public static String CPQExtendTime;\n-    public static String CPQLeaderNotFound;\n-    public static String CPQChallengeRoomAnswer;\n-    public static String CPQChallengeRoomSent;\n-\n-    public static LanguageConstants Languages(MapleCharacter chr) {\n-        if (chr.getLanguage() == 0) {\n-            LanguageConstants.CPQBlue = \"Maple Azul\";\n-            LanguageConstants.CPQRed = \"Maple Vermelho\";\n-            LanguageConstants.CPQExtendTime = \"O tempo foi estendido.\";\n-            LanguageConstants.CPQPlayerExit = \" deixou o Carnaval de Monstros.\";\n-            LanguageConstants.CPQError = \"Ocorreu um problema. Favor recriar a sala.\";\n-            LanguageConstants.CPQLeaderNotFound = \"Nao foi possivel encontrar o Lider.\";\n-            LanguageConstants.CPQPickRoom = \"Inscreva-se no Festival de Monstros!\\r\\n\";            \n-            LanguageConstants.CPQChallengeRoomAnswer = \"O grupo esta respondendo um desafio no momento.\";\n-            LanguageConstants.CPQChallengeRoomSent = \"Um desafio foi enviado para o grupo na sala. Aguarde um momento.\";\n-            LanguageConstants.CPQFindError = \"Nao foi possivel encontrar um grupo nesta sala.\\r\\nProvavelmente o grupo foi desfeito dentro da sala!\";\n-            LanguageConstants.CPQEntryLobby = \"Agora voce ira receber desafios de outros grupos. Se voce nao aceitar um desafio em 3 minutos, voce sera levado para fora.\";\n-            LanguageConstants.CPQEntry = \"Voce pode selecionar \\\"Invocar Monstros\\\", \\\"Habilidade\\\", ou \\\"Protetor\\\" como sua tatica durante o Carnaval dos Monstros. Use Tab a F1~F12 para acesso rapido!\";\n+    enum Language {\n+        LANG_PRT(0),\n+        LANG_ESP(1),\n+        LANG_ENG(2);\n+        \n+        int lang;\n+        \n+        private Language(int lang) {\n+            this.lang = lang;\n+        }\n+        \n+        private int getValue() {\n+            return this.lang;\n+        }\n+        \n+    }\n+    \n+    public static String CPQBlue[] = new String[3];\n+    public static String CPQError[] = new String[3];\n+    public static String CPQEntry[] = new String[3];\n+    public static String CPQFindError[] = new String[3];\n+    public static String CPQRed[] = new String[3];\n+    public static String CPQPlayerExit[] = new String[3];\n+    public static String CPQEntryLobby[] = new String[3];\n+    public static String CPQPickRoom[] = new String[3];\n+    public static String CPQExtendTime[] = new String[3];\n+    public static String CPQLeaderNotFound[] = new String[3];\n+    public static String CPQChallengeRoomAnswer[] = new String[3];\n+    public static String CPQChallengeRoomSent[] = new String[3];\n+    public static String CPQChallengeRoomDenied[] = new String[3];\n+    \n+    static {\n+        int lang;\n+        \n+        lang = Language.LANG_PRT.getValue();\n+        LanguageConstants.CPQBlue[lang] = \"Maple Azul\";\n+        LanguageConstants.CPQRed[lang] = \"Maple Vermelho\";\n+        LanguageConstants.CPQExtendTime[lang] = \"O tempo foi estendido.\";\n+        LanguageConstants.CPQPlayerExit[lang] = \" deixou o Carnaval de Monstros.\";\n+        LanguageConstants.CPQError[lang] = \"Ocorreu um problema. Favor recriar a sala.\";\n+        LanguageConstants.CPQLeaderNotFound[lang] = \"Nao foi possivel encontrar o Lider.\";\n+        LanguageConstants.CPQPickRoom[lang] = \"Inscreva-se no Festival de Monstros!\\r\\n\";            \n+        LanguageConstants.CPQChallengeRoomAnswer[lang] = \"O grupo esta respondendo um desafio no momento.\";\n+        LanguageConstants.CPQChallengeRoomSent[lang] = \"Um desafio foi enviado para o grupo na sala. Aguarde um momento.\";\n+        LanguageConstants.CPQChallengeRoomDenied[lang] = \"O grupo na sala cancelou seu desafio.\";\n+        LanguageConstants.CPQFindError[lang] = \"Nao foi possivel encontrar um grupo nesta sala.\\r\\nProvavelmente o grupo foi desfeito dentro da sala!\";\n+        LanguageConstants.CPQEntryLobby[lang] = \"Agora voce ira receber desafios de outros grupos. Se voce nao aceitar um desafio em 3 minutos, voce sera levado para fora.\";\n+        LanguageConstants.CPQEntry[lang] = \"Voce pode selecionar \\\"Invocar Monstros\\\", \\\"Habilidade\\\", ou \\\"Protetor\\\" como sua tatica durante o Carnaval dos Monstros. Use Tab a F1~F12 para acesso rapido!\";\n \n+        lang = Language.LANG_ESP.getValue();\n+        LanguageConstants.CPQBlue[lang] = \"Maple Azul\";\n+        LanguageConstants.CPQRed[lang] = \"Maple Rojo\";\n+        LanguageConstants.CPQExtendTime[lang] = \"El tiempo se ha ampliado.\";\n+        LanguageConstants.CPQPlayerExit[lang] = \" ha dejado el Carnaval de Monstruos.\";\n+        LanguageConstants.CPQLeaderNotFound[lang] = \"No se pudo encontrar el Lider.\";\n+        LanguageConstants.CPQPickRoom[lang] = \"!Inscribete en el Festival de Monstruos!\\r\\n\";\n+        LanguageConstants.CPQError[lang] = \"Se ha producido un problema. Por favor, volver a crear una sala.\";\n+        LanguageConstants.CPQChallengeRoomAnswer[lang] = \"El grupo esta respondiendo un desafio en el momento.\";\n+        LanguageConstants.CPQChallengeRoomSent[lang] = \"Un desafio fue enviado al grupo en la sala. Espera un momento.\";\n+        LanguageConstants.CPQChallengeRoomDenied[lang] = \"El grupo en la sala cancelo su desafio.\";\n+        LanguageConstants.CPQFindError[lang] = \"No se pudo encontrar un grupo en esta sala.\\r\\nProbablemente el grupo fue deshecho dentro de la sala!\";\n+        LanguageConstants.CPQEntryLobby[lang] = \"Ahora usted recibira los retos de otros grupos. Si usted no acepta un desafio en 3 minutos, usted sera llevado hacia fuera.\";\n+        LanguageConstants.CPQEntry[lang] = \"Usted puede seleccionar \\\"Invocar Monstruos\\\", \\\"Habilidad\\\", o \\\"Protector\\\" como su tactica durante el Carnaval de los Monstruos. Utilice Tab y F1 ~ F12 para acceso rapido!\";\n+        \n+        lang = Language.LANG_ENG.getValue();\n+        LanguageConstants.CPQBlue[lang] = \"Maple Blue\";\n+        LanguageConstants.CPQRed[lang] = \"Maple Red\";\n+        LanguageConstants.CPQPlayerExit[lang] = \" left the Carnival of Monsters.\";\n+        LanguageConstants.CPQExtendTime[lang] = \"The time has been extended.\";\n+        LanguageConstants.CPQLeaderNotFound[lang] = \"Could not find the Leader.\";\n+        LanguageConstants.CPQError[lang] = \"There was a problem. Please re-create a room.\";\n+        LanguageConstants.CPQPickRoom[lang] = \"Sign up for the Monster Festival!\\r\\n\";\n+        LanguageConstants.CPQChallengeRoomAnswer[lang] = \"The group is currently facing a challenge.\";\n+        LanguageConstants.CPQChallengeRoomSent[lang] = \"A challenge has been sent to the group in the room. Please wait a while.\";\n+        LanguageConstants.CPQChallengeRoomDenied[lang] = \"The group in the room canceled your challenge.\";\n+        LanguageConstants.CPQFindError[lang] = \"We could not find a group in this room.\\r\\nProbably the group was scrapped inside the room!\";\n+        LanguageConstants.CPQEntryLobby[lang] = \"You will now receive challenges from other groups. If you do not accept a challenge within 3 minutes, you will be taken out.\";\n+        LanguageConstants.CPQEntry[lang] = \"You can select \\\"Summon Monsters\\\", \\\"Ability\\\", or \\\"Protector\\\" as your tactic during the Monster Carnival. Use Tab and F1 ~ F12 for quick access!\";\n             \n-            \n-        } else if (chr.getLanguage() == 1) {\n-            LanguageConstants.CPQBlue = \"Maple Azul\";\n-            LanguageConstants.CPQRed = \"Maple Rojo\";\n-            LanguageConstants.CPQExtendTime = \"El tiempo se ha ampliado.\";\n-            LanguageConstants.CPQPlayerExit = \" ha dejado el Carnaval de Monstruos.\";\n-            LanguageConstants.CPQLeaderNotFound = \"No se pudo encontrar el Lider.\";\n-            LanguageConstants.CPQPickRoom = \"!Inscribete en el Festival de Monstruos!\\r\\n\";\n-            LanguageConstants.CPQError = \"Se ha producido un problema. Por favor, volver a crear una sala.\";\n-            LanguageConstants.CPQChallengeRoomAnswer = \"El grupo esta respondiendo un desafio en el momento.\";\n-            LanguageConstants.CPQChallengeRoomSent = \"Un desafio fue enviado al grupo en la sala. Espera un momento.\";\n-            LanguageConstants.CPQFindError = \"No se pudo encontrar un grupo en esta sala.\\r\\nProbablemente el grupo fue deshecho dentro de la sala!\";\n-            LanguageConstants.CPQEntryLobby = \"Ahora usted recibira los retos de otros grupos. Si usted no acepta un desafio en 3 minutos, usted sera llevado hacia fuera.\";\n-            LanguageConstants.CPQEntry = \"Usted puede seleccionar \\\"Invocar Monstruos \\\", \\\"Habilidad \\\", o \\\"Protector \\\" como su tactica durante el Carnaval de los Monstruos. Utilice Tab y F1 ~ F12 para acceso rapido!\";\n+        \n+    }\n \n-            \n-        } else if (chr.getLanguage() == 2) {\n-            LanguageConstants.CPQBlue = \"Maple Blue\";\n-            LanguageConstants.CPQRed = \"Maple Red\";\n-            LanguageConstants.CPQPlayerExit = \" left the Carnival of Monsters.\";\n-            LanguageConstants.CPQExtendTime = \"The time has been extended.\";\n-            LanguageConstants.CPQLeaderNotFound = \"Could not find the Leader.\";\n-            LanguageConstants.CPQError = \"There was a problem. Please re-create a room.\";\n-            LanguageConstants.CPQPickRoom = \"Sign up for the Monster Festival!\\r\\n\";\n-            LanguageConstants.CPQChallengeRoomAnswer = \"The group is currently facing a challenge.\";\n-            LanguageConstants.CPQChallengeRoomSent = \"A challenge has been sent to the group in the room. Please wait a while.\";\n-            LanguageConstants.CPQFindError = \"We could not find a group in this room.\\r\\nProbably the group was scrapped inside the room!\";\n-            LanguageConstants.CPQEntryLobby = \"You will now receive challenges from other groups. If you do not accept a challenge within 3 minutes, you will be taken out.\";\n-            LanguageConstants.CPQEntry = \"You can select \\\"Summon Monsters \\\", \\\"Ability \\\", or \\\"Protector \\\" as your tactic during the Monster Carnival. Use Tab and F1 ~ F12 for quick access!\";\n-            \n-        }\n-        return null;\n+    public static String getMessage(MapleCharacter chr, String[] message) {\n+        return message[chr.getLanguage()];\n     }\n }"}, {"sha": "d5eb2e4eca7b5ec841fd1ce367894babf9f5043d", "filename": "src/constants/ScriptableNPCConstants.java", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/ScriptableNPCConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/ScriptableNPCConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ScriptableNPCConstants.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -0,0 +1,23 @@\n+package constants;\n+ \n+/**\n+ * @brief ScriptableNPCConstants\n+ * @author GabrielSin <gabrielsin@playellin.net>\n+ * @date   16/09/2018\n+ * \n+ * Adaptations to use Pair and Set, in order to suit a one-packet marshall,\n+ * by Ronan\n+ */\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+import tools.Pair;\n+\n+public class ScriptableNPCConstants {\n+    \n+    public static final Set<Pair<Integer, String>> SCRIPTABLE_NPCS = new HashSet<Pair<Integer, String>>(){{\n+        add(new Pair<>(9200000, \"Cody\"));\n+    }};\n+    \n+}\n+ \n\\ No newline at end of file"}, {"sha": "317f45679fecd692fbc9bd8629430eb760545b60", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -64,6 +64,7 @@\n     public static       boolean USE_DEBUG_SHOW_RCVD_MVLIFE = false; //Prints on the cmd all received move life content.\n     public static final boolean USE_DEBUG_SHOW_PACKET = false;\n     public static       boolean USE_SUPPLY_RATE_COUPONS = true;     //Allows rate coupons to be sold through the Cash Shop.\n+    public static final boolean USE_IP_VALIDATION = true;           //Enables IP checking when logging in.\n     \n     public static final boolean USE_MAXRANGE = true;                //Will send and receive packets from all events on a map, rather than those of only view range.\n     public static final boolean USE_MAXRANGE_ECHO_OF_HERO = true;\n@@ -112,6 +113,7 @@\n     public static final boolean USE_REBIRTH_SYSTEM = false;         //Flag to enable/disable rebirth system\n     public static final boolean USE_MAP_OWNERSHIP_SYSTEM = true;    //Flag to enable/disable map ownership system\n     public static final boolean USE_FISHING_SYSTEM = true;          //Flag to enable/disable fishing system\n+    public static final boolean USE_NPCS_SCRIPTABLE = true;         //Flag to enable/disable serverside predefined script NPCs.\n     \n     //Events/PQs Configuration\n     public static final boolean USE_OLD_GMS_STYLED_PQ_NPCS = true;  //Enables PQ NPCs with similar behaviour to old GMS style, that skips info about the PQs and immediately tries to register the party in.\n@@ -164,6 +166,7 @@\n     public static final long PET_LOOT_UPON_ATTACK = (long)(0.7 * 1000); //Time the pet must wait before trying to pick items up.\n     public static final int TOT_MOB_QUEST_REQUIREMENT = 77;             //Overwrites old 999-mobs requirement for the ToT questline with new requirement value, set 0 for default.\n     public static final int MOB_REACTOR_REFRESH_TIME = 30 * 1000;       //Overwrites refresh time for those reactors oriented to inflict damage to bosses (Ice Queen, Riche), set 0 for default.\n+    public static final int PARTY_SEARCH_REENTRY_LIMIT = 10;            //Max amount of times a party leader is allowed to persist on the Party Search before entry expiration (thus needing to manually restart the Party Search to be able to search for members).\n     \n     //Dangling Items/Locks Configuration\n     public static final int ITEM_EXPIRE_TIME  = 3 * 60 * 1000;  //Time before items start disappearing. Recommended to be set up to 3 minutes."}, {"sha": "42e14c9b8fcbb43b029411aeb213810458fcffda", "filename": "src/net/opcodes/SendOpcode.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/opcodes/SendOpcode.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/opcodes/SendOpcode.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/opcodes/SendOpcode.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -266,6 +266,7 @@\n     REMOVE_NPC(0x102),\n     SPAWN_NPC_REQUEST_CONTROLLER(0x103),\n     NPC_ACTION(0x104),\n+    SET_NPC_SCRIPTABLE(0x107),\n     SPAWN_HIRED_MERCHANT(0x109),\n     DESTROY_HIRED_MERCHANT(0x10A),\n     UPDATE_HIRED_MERCHANT(0x10B),"}, {"sha": "8aa00f8810a034e8739f21fc4330daeed462cd3a", "filename": "src/net/server/Server.java", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1648,6 +1648,10 @@ public void setCharacteridInTransition(IoSession session, int charId) {\n     }\n     \n     public boolean validateCharacteridInTransition(IoSession session, int charId) {\n+        if (!ServerConstants.USE_IP_VALIDATION) {\n+            return true;\n+        }\n+        \n         String remoteIp = getRemoteIp(session);\n         \n         lgnWLock.lock();\n@@ -1660,6 +1664,10 @@ public boolean validateCharacteridInTransition(IoSession session, int charId) {\n     }\n     \n     public Integer freeCharacteridInTransition(IoSession session) {\n+        if (!ServerConstants.USE_IP_VALIDATION) {\n+            return null;\n+        }\n+        \n         String remoteIp = getRemoteIp(session);\n         \n         lgnWLock.lock();\n@@ -1671,6 +1679,10 @@ public Integer freeCharacteridInTransition(IoSession session) {\n     }\n     \n     public boolean hasCharacteridInTransition(IoSession session) {\n+        if (!ServerConstants.USE_IP_VALIDATION) {\n+            return true;\n+        }\n+        \n         String remoteIp = getRemoteIp(session);\n         \n         lgnRLock.lock();"}, {"sha": "50d86fcbfc99f08be3c0a3a69dc8c0ed43597cd1", "filename": "src/net/server/audit/locks/MonitoredLockType.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/audit/locks/MonitoredLockType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/audit/locks/MonitoredLockType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/audit/locks/MonitoredLockType.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -64,6 +64,8 @@\n     GUILD,\n     PARTY,\n     WORLD_PARTY,\n+    WORLD_PARTY_SEARCH_ECHELON,\n+    WORLD_PARTY_SEARCH_STORAGE,\n     WORLD_SRVMESSAGES,\n     WORLD_PETS,\n     WORLD_CHARS,"}, {"sha": "71ab69ea0e08a5805a812b1f088a65dd84384b38", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -296,17 +296,22 @@ private void emptyLocks() {\n     }\n     \n     private void closeAllMerchants() {\n-        merchWlock.lock();\n         try {\n-            final Iterator<MapleHiredMerchant> hmit = hiredMerchants.values().iterator();\n-            while (hmit.hasNext()) {\n-                hmit.next().forceClose();\n-                hmit.remove();\n+            List<MapleHiredMerchant> merchs;\n+            \n+            merchWlock.lock();\n+            try {\n+                merchs = new ArrayList<>(hiredMerchants.values());\n+                hiredMerchants.clear();\n+            } finally {\n+                merchWlock.unlock();\n+            }\n+\n+            for (MapleHiredMerchant merch : merchs) {\n+                merch.forceClose();\n             }\n         } catch (Exception e) {\n-\t\te.printStackTrace();\n-        } finally {\n-                merchWlock.unlock();\n+            e.printStackTrace();\n         }\n     }\n     "}, {"sha": "38ab0d121808e384600939a5a2c51d9a422cde59", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -273,6 +273,17 @@ else if(attack.skill == Shadower.BOOMERANG_STEP)\n                     \n                     int totDamageToOneMonster = 0;\n                     List<Integer> onedList = attack.allDamage.get(oned);\n+                    \n+                    if (attack.magic) { // thanks BHB, Alex (CanIGetaPR) for noticing no immunity status check here\n+                        if (monster.isBuffed(MonsterStatus.MAGIC_IMMUNITY)) {\n+                            Collections.fill(onedList, 1);\n+                        }\n+                    } else {\n+                        if (monster.isBuffed(MonsterStatus.WEAPON_IMMUNITY)) {\n+                            Collections.fill(onedList, 1);\n+                        }\n+                    }\n+                    \n                     for (Integer eachd : onedList) {\n                         if(eachd < 0) eachd += Integer.MAX_VALUE;\n                         totDamageToOneMonster += eachd;\n@@ -453,7 +464,7 @@ public void run() {\n                                     int skillLv = player.getSkillLevel(threeSnailsId);\n \n                                     if(skillLv > 0) {\n-                                        AbstractPlayerInteraction api = player.getClient().getAbstractPlayerInteraction();\n+                                        AbstractPlayerInteraction api = player.getAbstractPlayerInteraction();\n \n                                         int shellId;\n                                         switch(skillLv) {"}, {"sha": "7d3667873025138622b39778b9aa2c7257810217", "filename": "src/net/server/channel/handlers/GuildOperationHandler.java", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/GuildOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/GuildOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/GuildOperationHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -77,7 +77,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 \n                 Set<MapleCharacter> eligibleMembers = new HashSet<>(MapleGuild.getEligiblePlayersForGuild(mc));\n                 if (eligibleMembers.size() < ServerConstants.CREATE_GUILD_MIN_PARTNERS) {\n-                    mc.dropMessage(1, \"The Guild you are trying to create don't meet the minimum criteria of number of founders.\");\n+                    if (mc.getMap().getAllPlayers().size() < ServerConstants.CREATE_GUILD_MIN_PARTNERS) {\n+                        mc.dropMessage(1, \"The Guild you are trying to create don't meet the minimum criteria of number of founders.\");\n+                    } else {\n+                        // players may be unaware of not belonging on a party in order to become eligible, thanks Hair (Legalize) for pointing this out\n+                        mc.dropMessage(1, \"Please make sure everyone you are trying to invite is neither on a guild nor on a party.\");\n+                    }\n+                    \n                     return;\n                 }\n                 \n@@ -91,7 +97,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     eligibleCids.add(chr.getId());\n                 }\n                 \n-                c.getWorldServer().getMatchCheckerCoordinator().createMatchConfirmation(MatchCheckerType.GUILD_CREATION, c.getWorld(), mc.getId(), eligibleCids, guildName);                \n+                c.getWorldServer().getMatchCheckerCoordinator().createMatchConfirmation(MatchCheckerType.GUILD_CREATION, c.getWorld(), mc.getId(), eligibleCids, guildName);\n                 break;\n             case 0x05:\n                 if (mc.getGuildId() <= 0 || mc.getGuildRank() > 2) {\n@@ -246,12 +252,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 int leaderid = wserv.getMatchCheckerCoordinator().getMatchConfirmationLeaderid(mc.getId());\n                 if (leaderid != -1) {\n                     boolean result = slea.readByte() != 0;\n-                    if (result) {\n+                    if (result && wserv.getMatchCheckerCoordinator().isMatchConfirmationActive(mc.getId())) {\n                         MapleCharacter leader = wserv.getPlayerStorage().getCharacterById(leaderid);\n                         if (leader != null) {\n                             int partyid = leader.getPartyId();\n                             if (partyid != -1) {\n-                                MapleParty.joinParty(mc, partyid, true);\n+                                MapleParty.joinParty(mc, partyid, true);    // GMS gimmick \"party to form guild\" recalled thanks to Vcoc\n                             }\n                         }\n                     }"}, {"sha": "a7c5bfed43c196f817875b238bc02993163ddab2", "filename": "src/net/server/channel/handlers/MesoDropHandler.java", "status": "modified", "additions": 27, "deletions": 17, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/MesoDropHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/MesoDropHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MesoDropHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -30,29 +30,39 @@\n /**\n  *\n  * @author Matze\n+ * @author Ronan - concurrency protection\n  */\n public final class MesoDropHandler extends AbstractMaplePacketHandler {\n         @Override\n         public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-                MapleCharacter player = c.getPlayer();\n-                if (!player.isAlive()) {\n+            MapleCharacter player = c.getPlayer();\n+            if (!player.isAlive()) {\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+            slea.skip(4);\n+            int meso = slea.readInt();\n+\n+            if (c.tryacquireClient()) {     // thanks imbee for noticing players not being able to throw mesos too fast, dampening gameplay of some classes\n+                try {\n+                    if (meso <= player.getMeso() && meso > 9 && meso < 50001) {\n+                        player.gainMeso(-meso, false, true, false);\n+                    } else {\n                         c.announce(MaplePacketCreator.enableActions());\n                         return;\n+                    }\n+                } finally {\n+                    c.releaseClient();\n                 }\n-                if (!player.canDropMeso()){\n-                        player.announce(MaplePacketCreator.serverNotice(5, \"Fast meso drop has been patched, cut that out. ;)\"));\n-                        return;\n-                }\n-                slea.skip(4);\n-                int meso = slea.readInt();\n-                if (meso <= player.getMeso() && meso > 9 && meso < 50001) {\n-                        player.gainMeso(-meso, false, true, false);\n-                        \n-                        if (player.attemptCatchFish(meso)) {\n-                                player.getMap().disappearingMesoDrop(meso, player, player, player.getPosition());\n-                        } else {\n-                                player.getMap().spawnMesoDrop(meso, player.getPosition(), player, player, true, (byte) 2);\n-                        }\n-                }\n+            } else {\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+\n+            if (player.attemptCatchFish(meso)) {\n+                player.getMap().disappearingMesoDrop(meso, player, player, player.getPosition());\n+            } else {\n+                player.getMap().spawnMesoDrop(meso, player.getPosition(), player, player, true, (byte) 2);\n+            }\n         }\n }\n\\ No newline at end of file"}, {"sha": "126deb16f5929f1e4571619d7a6488af4152b27d", "filename": "src/net/server/channel/handlers/NewYearCardHandler.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/NewYearCardHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/NewYearCardHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/NewYearCardHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -67,8 +67,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                                 NewYearCardRecord.saveNewYearCard(newyear);\n                                 player.addNewYearRecord(newyear);\n \n-                                player.getClient().getAbstractPlayerInteraction().gainItem(2160101, (short)-1);\n-                                player.getClient().getAbstractPlayerInteraction().gainItem(4300000, (short) 1);\n+                                player.getAbstractPlayerInteraction().gainItem(2160101, (short)-1);\n+                                player.getAbstractPlayerInteraction().gainItem(4300000, (short) 1);\n \n                                 Server.getInstance().setNewYearCard(newyear);\n                                 newyear.startNewYearCardTask();\n@@ -99,7 +99,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         newyear.stopNewYearCardTask();\n                         NewYearCardRecord.updateNewYearCard(newyear);\n \n-                        player.getClient().getAbstractPlayerInteraction().gainItem(4301000, (short)1);\n+                        player.getAbstractPlayerInteraction().gainItem(4301000, (short)1);\n                         if(!newyear.getMessage().isEmpty()) player.dropMessage(6, \"[New Year] \" + newyear.getSenderName() + \": \" + newyear.getMessage());\n \n                         player.addNewYearRecord(newyear);"}, {"sha": "0583e56408ef6f97faa71733fb21ab310bb38cac", "filename": "src/net/server/channel/handlers/PartyOperationHandler.java", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PartyOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PartyOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PartyOperationHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -34,14 +34,9 @@\n import net.server.coordinator.MapleInviteCoordinator;\n import net.server.coordinator.MapleInviteCoordinator.InviteResult;\n import net.server.coordinator.MapleInviteCoordinator.InviteType;\n-import net.server.coordinator.MapleMatchCheckerCoordinator;\n-import net.server.coordinator.matchchecker.MatchCheckerListenerFactory.MatchCheckerType;\n-import scripting.event.EventInstanceManager;\n-import server.maps.MapleMap;\n import tools.Pair;\n \n import java.util.List;\n-import server.partyquest.MonsterCarnival;\n \n public final class PartyOperationHandler extends AbstractMaplePacketHandler {\n     "}, {"sha": "9281dd3f66f6cab372234ce137cdc172b0b348a7", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -572,11 +572,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n \n                 short perBundle = slea.readShort();\n-\n+                \n                 if (ItemConstants.isRechargeable(ivItem.getItemId())) {\n                     perBundle = 1;\n                     bundles = 1;\n-                } else if (chr.getItemQuantity(ivItem.getItemId(), false) < perBundle * bundles) {\n+                } else if (ivItem.getQuantity() < (bundles * perBundle)) {     // thanks GabrielSin for finding a dupe here\n                     c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n                     c.announce(MaplePacketCreator.enableActions());\n                     return;"}, {"sha": "223149d23e193cdd059586ee0257bcc30d255753", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -58,6 +58,7 @@\n import client.inventory.MapleInventoryType;\n import client.inventory.MaplePet;\n import constants.GameConstants;\n+import constants.ScriptableNPCConstants;\n import constants.ServerConstants;\n import java.util.Collections;\n import java.util.Comparator;\n@@ -404,6 +405,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         eim.registerPlayer(player);\n                     }\n                 }\n+                \n+                if (ServerConstants.USE_NPCS_SCRIPTABLE) {\n+                    c.announce(MaplePacketCreator.setNPCScriptable(ScriptableNPCConstants.SCRIPTABLE_NPCS));\n+                }\n             } finally {\n                 c.releaseClient();\n             }"}, {"sha": "17d3b65ce2fe59b06e17e55cbdd302af8d00dbaa", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 23, "deletions": 14, "changes": 37, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -212,22 +212,31 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             chr.getAutobanManager().resetMisses();\n         }\n         if (damage > 0 && !chr.isHidden()) {\n-            if (attacker != null && damagefrom == -1 && chr.getBuffedValue(MapleBuffStat.POWERGUARD) != null) { // PG works on bosses, but only at half of the rate.\n-                int bouncedamage = (int) (damage * (chr.getBuffedValue(MapleBuffStat.POWERGUARD).doubleValue() / (attacker.isBoss() ? 200 : 100)));\n-                bouncedamage = Math.min(bouncedamage, attacker.getMaxHp() / 10);\n-                damage -= bouncedamage;\n-                map.damageMonster(chr, attacker, bouncedamage);\n-                map.broadcastMessage(chr, MaplePacketCreator.damageMonster(oid, bouncedamage), false, true);\n-                attacker.aggroMonsterDamage(chr, bouncedamage);\n-            }\n-            if (attacker != null && damagefrom == -1 && chr.getBuffedValue(MapleBuffStat.BODY_PRESSURE) != null) {\n-                Skill skill = SkillFactory.getSkill(Aran.BODY_PRESSURE);\n-                final MapleStatEffect eff = skill.getEffect(chr.getSkillLevel(skill));\n-                if (!attacker.alreadyBuffedStats().contains(MonsterStatus.NEUTRALISE)) {\n-                    if (!attacker.isBoss() && eff.makeChanceResult()) {\n-                    \tattacker.applyStatus(chr, new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.NEUTRALISE, 1), skill, null, false), false, (eff.getDuration()/10) * 2, false);\n+            if (attacker != null) {\n+                if (damagefrom == -1) {\n+                    if (chr.getBuffedValue(MapleBuffStat.POWERGUARD) != null) { // PG works on bosses, but only at half of the rate.\n+                        int bouncedamage = (int) (damage * (chr.getBuffedValue(MapleBuffStat.POWERGUARD).doubleValue() / (attacker.isBoss() ? 200 : 100)));\n+                        bouncedamage = Math.min(bouncedamage, attacker.getMaxHp() / 10);\n+                        damage -= bouncedamage;\n+                        map.damageMonster(chr, attacker, bouncedamage);\n+                        map.broadcastMessage(chr, MaplePacketCreator.damageMonster(oid, bouncedamage), false, true);\n+                        attacker.aggroMonsterDamage(chr, bouncedamage);\n+                    }\n+                    MapleStatEffect bPressure = chr.getBuffEffect(MapleBuffStat.COMBO_BARRIER);\n+                    if (bPressure != null) {\n+                        Skill skill = SkillFactory.getSkill(Aran.BODY_PRESSURE);\n+                        if (!attacker.alreadyBuffedStats().contains(MonsterStatus.NEUTRALISE)) {\n+                            if (!attacker.isBoss() && bPressure.makeChanceResult()) {\n+                                attacker.applyStatus(chr, new MonsterStatusEffect(Collections.singletonMap(MonsterStatus.NEUTRALISE, 1), skill, null, false), false, (bPressure.getDuration() / 10) * 2, false);\n+                            }\n+                        }\n                     }\n                 }\n+                \n+                MapleStatEffect cBarrier = chr.getBuffEffect(MapleBuffStat.COMBO_BARRIER);  // thanks BHB for noticing Combo Barrier buff not working\n+                if (cBarrier != null) {\n+                    damage *= (cBarrier.getX() / 1000.0);\n+                }\n             }\n             if (damagefrom != -3 && damagefrom != -4) {\n                 int achilles = 0;"}, {"sha": "514539d67eb5bbb73f4e9f5d8bb9ff7cbdfad2f4", "filename": "src/net/server/channel/handlers/UseGachaExpHandler.java", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseGachaExpHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseGachaExpHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseGachaExpHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -30,14 +30,24 @@\n \n /**\n  *\n- * @author kevintjuh93\n+ * @author kevintjuh93; modified by Ronan\n  */\n public class UseGachaExpHandler extends AbstractMaplePacketHandler {\n+    \n+    @Override\n     public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        if (c.getPlayer().getGachaExp() == 0) {\n-            AutobanFactory.GACHA_EXP.autoban(c.getPlayer(), \"Player tried to redeem GachaEXP, but had none to redeem.\");\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                if (c.getPlayer().getGachaExp() <= 0) {\n+                    AutobanFactory.GACHA_EXP.autoban(c.getPlayer(), \"Player tried to redeem GachaEXP, but had none to redeem.\");\n+                }\n+                c.getPlayer().gainGachaExp();\n+            } finally {\n+                c.releaseClient();\n+            }\n         }\n-        c.getPlayer().gainGachaExp();\n+        \n         c.announce(MaplePacketCreator.enableActions());\n     }\n }"}, {"sha": "a626d5ec1c90a090ab997b17e360d329a7f85f70", "filename": "src/net/server/channel/handlers/UseMountFoodHandler.java", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseMountFoodHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseMountFoodHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseMountFoodHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -31,6 +31,7 @@\n import net.AbstractMaplePacketHandler;\n import client.inventory.manipulator.MapleInventoryManipulator;\n import tools.MaplePacketCreator;\n+import tools.Pair;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n /**\n@@ -50,6 +51,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         if (c.tryacquireClient()) {\n             try {\n+                Boolean mountLevelup = null;\n+                \n                 useInv.lockInventory();\n                 try {\n                     Item item = useInv.getItem(pos);\n@@ -67,14 +70,19 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             if (levelup) {\n                                 mount.setLevel(level + 1);\n                             }\n-                            chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, levelup));\n+                            \n+                            mountLevelup = levelup;\n                         }\n \n                         MapleInventoryManipulator.removeById(c, MapleInventoryType.USE, itemid, 1, true, false);\n                     }\n                 } finally {\n                     useInv.unlockInventory();\n                 }\n+                \n+                if (mountLevelup != null) {\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, mountLevelup));\n+                }\n             } finally {\n                 c.releaseClient();\n             }"}, {"sha": "68a89f3d11b387b89db120d0c705fd7a1798c2ef", "filename": "src/net/server/channel/handlers/UseSolomonHandler.java", "status": "modified", "additions": 31, "deletions": 10, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseSolomonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/channel/handlers/UseSolomonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseSolomonHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -21,7 +21,9 @@\n  */\n package net.server.channel.handlers;\n \n+import client.MapleCharacter;\n import client.MapleClient;\n+import client.inventory.MapleInventory;\n import client.inventory.Item;\n import client.inventory.MapleInventoryType;\n import net.AbstractMaplePacketHandler;\n@@ -32,7 +34,7 @@\n \n /**\n  *\n- * @author XoticStory; modified by kevintjuh93\n+ * @author XoticStory; modified by kevintjuh93, Ronan\n  */\n public final class UseSolomonHandler extends AbstractMaplePacketHandler {\n \n@@ -42,16 +44,35 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         short slot = slea.readShort();\n         int itemId = slea.readInt();\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        Item slotItem = c.getPlayer().getInventory(MapleInventoryType.USE).getItem(slot);\n-        int gachaexp = ii.getExpById(itemId);\n-        if (c.getPlayer().getInventory(MapleInventoryType.USE).countById(itemId) <= 0 || slotItem.getItemId() != itemId || c.getPlayer().getLevel() > ii.getMaxLevelById(itemId)) {\n-            return;\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                MapleCharacter chr = c.getPlayer();\n+                MapleInventory inv = chr.getInventory(MapleInventoryType.USE);\n+                inv.lockInventory();\n+                try {\n+                    Item slotItem = inv.getItem(slot);\n+                    if (slotItem == null) {\n+                        return;\n+                    }\n+                    \n+                    long gachaexp = ii.getExpById(itemId);\n+                    if (slotItem.getItemId() != itemId || slotItem.getQuantity() <= 0 || chr.getLevel() > ii.getMaxLevelById(itemId)) {\n+                        return;\n+                    }\n+                    if (gachaexp + chr.getGachaExp() > Integer.MAX_VALUE) {\n+                        return;\n+                    }\n+                    chr.addGachaExp((int) gachaexp);\n+                    MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n+                } finally {\n+                    inv.unlockInventory();\n+                }\n+            } finally {\n+                c.releaseClient();\n+            }\n         }\n-        if ((c.getPlayer().getGachaExp() + gachaexp) > Integer.MAX_VALUE) {\n-            return;\n-        }\n-        c.getPlayer().gainGachaExp(gachaexp);\n-        MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n+        \n         c.announce(MaplePacketCreator.enableActions());\n     }\n }"}, {"sha": "1caa9747bf5a348f72d2952cc1c1a40e40903a68", "filename": "src/net/server/coordinator/MapleMatchCheckerCoordinator.java", "status": "modified", "additions": 73, "deletions": 12, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/MapleMatchCheckerCoordinator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/MapleMatchCheckerCoordinator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/MapleMatchCheckerCoordinator.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -29,6 +29,7 @@\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.Map;\n+import java.util.Map.Entry;\n import java.util.Set;\n \n import java.util.concurrent.Semaphore;\n@@ -76,6 +77,7 @@ private boolean getAccept() {\n         \n         private Map<Integer, MapleMatchCheckingEntry> confirmingMembers = new HashMap<>();\n         private int confirmCount;\n+        private boolean active = true;\n         \n         private String message;\n         \n@@ -108,10 +110,30 @@ private boolean acceptEntry(int cid) {\n             return false;\n         }\n         \n+        private boolean isMatchActive() {\n+            return active;\n+        }\n+        \n+        private void setMatchActive(boolean a) {\n+            active = a;\n+        }\n+        \n         private Set<Integer> getMatchPlayers() {\n             return confirmingMembers.keySet();\n         }\n         \n+        private Set<Integer> getAcceptedMatchPlayers() {\n+            Set<Integer> s = new HashSet<>();\n+            \n+            for (Entry<Integer, MapleMatchCheckingEntry> e : confirmingMembers.entrySet()) {\n+                if (e.getValue().getAccept()) {\n+                    s.add(e.getKey());\n+                }\n+            }\n+            \n+            return s;\n+        }\n+        \n         private Set<MapleCharacter> getMatchCharacters() {\n             Set<MapleCharacter> players = new HashSet<>();\n             \n@@ -197,6 +219,20 @@ private boolean isMatchingAvailable(Set<Integer> matchPlayers) {\n         return true;\n     }\n     \n+    private void reenablePlayerMatching(Set<Integer> matchPlayers) {\n+        for (Integer cid : matchPlayers) {\n+            MapleMatchCheckingElement mmce = matchEntries.get(cid);\n+            \n+            if (mmce != null) {\n+                synchronized (mmce) {\n+                    if (!mmce.isMatchActive()) {\n+                        matchEntries.remove(cid);\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    \n     public int getMatchConfirmationLeaderid(int cid) {\n         MapleMatchCheckingElement mmce = matchEntries.get(cid);\n         if (mmce != null) {\n@@ -215,6 +251,15 @@ public MatchCheckerType getMatchConfirmationType(int cid) {\n         }\n     }\n     \n+    public boolean isMatchConfirmationActive(int cid) {\n+        MapleMatchCheckingElement mmce = matchEntries.get(cid);\n+        if (mmce != null) {\n+            return mmce.active;\n+        } else {\n+            return false;\n+        }\n+    }\n+    \n     private void createMatchConfirmationInternal(MatchCheckerType matchType, int world, int leaderCid, AbstractMatchCheckerListener leaderListener, Set<Integer> players, String message) {\n         MapleMatchCheckingElement mmce = new MapleMatchCheckingElement(matchType, leaderCid, world, leaderListener, players, message);\n         \n@@ -224,9 +269,7 @@ private void createMatchConfirmationInternal(MatchCheckerType matchType, int wor\n         \n         mmce.dispatchMatchCreated();\n         \n-        if (mmce.acceptEntry(leaderCid)) {\n-            acceptMatchElement(mmce, leaderCid);\n-        }\n+        acceptMatchElement(mmce, leaderCid);\n     }\n     \n     public boolean createMatchConfirmation(MatchCheckerType matchType, int world, int leaderCid, Set<Integer> players, String message) {\n@@ -239,6 +282,8 @@ public boolean createMatchConfirmation(MatchCheckerType matchType, int world, in\n                             AbstractMatchCheckerListener leaderListener = matchType.getListener();\n                             createMatchConfirmationInternal(matchType, world, leaderCid, leaderListener, players, message);\n                             return true;\n+                        } else {\n+                            reenablePlayerMatching(players);\n                         }\n                     } finally {\n                         unpoolMatchPlayers(players);\n@@ -255,7 +300,7 @@ public boolean createMatchConfirmation(MatchCheckerType matchType, int world, in\n     }\n     \n     private void disposeMatchElement(MapleMatchCheckingElement mmce) {\n-        Set<Integer> matchPlayers = mmce.getMatchPlayers();\n+        Set<Integer> matchPlayers = mmce.getAcceptedMatchPlayers();\n         while (!poolMatchPlayers(matchPlayers)) {\n             try {\n                 Thread.sleep(1000);\n@@ -288,6 +333,8 @@ private void denyMatchElement(MapleMatchCheckingElement mmce, int cid) {\n     }\n     \n     private void dismissMatchElement(MapleMatchCheckingElement mmce, int cid) {\n+        mmce.setMatchActive(false);\n+        \n         unpoolMatchPlayer(cid);\n         disposeMatchElement(mmce);\n         \n@@ -302,14 +349,22 @@ public boolean answerMatchConfirmation(int cid, boolean accept) {\n                     if (poolMatchPlayer(cid)) {\n                         try {\n                             MapleMatchCheckingElement mmce = matchEntries.get(cid);\n-\n+                            \n                             if (mmce != null) {\n-                                if (accept) {\n-                                    acceptMatchElement(mmce, cid);\n-                                } else {\n-                                    denyMatchElement(mmce, cid);\n+                                synchronized (mmce) {\n+                                    if (!mmce.isMatchActive()) {    // thanks Alex (CanIGetaPR) for noticing that exploiters could stall on match checking\n+                                        matchEntries.remove(cid);\n+                                        return false;\n+                                    }\n+                                    \n+                                    if (accept) {\n+                                        acceptMatchElement(mmce, cid);\n+                                    } else {\n+                                        denyMatchElement(mmce, cid);\n+                                        matchEntries.remove(cid);\n+                                    }\n                                 }\n-\n+                                \n                                 return true;\n                             }\n                         } finally {\n@@ -337,8 +392,14 @@ public boolean dismissMatchConfirmation(int cid) {\n                             MapleMatchCheckingElement mmce = matchEntries.get(cid);\n \n                             if (mmce != null) {\n-                                dismissMatchElement(mmce, cid);\n-                                return true;\n+                                synchronized (mmce) {\n+                                    if (!mmce.isMatchActive()) {\n+                                        return false;\n+                                    }\n+                                    \n+                                    dismissMatchElement(mmce, cid);\n+                                    return true;\n+                                }\n                             }\n                         } finally {\n                             unpoolMatchPlayer(cid);"}, {"sha": "1b3ad471ae94d2d2ebea492886b00fa714895807", "filename": "src/net/server/coordinator/MapleSessionCoordinator.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/MapleSessionCoordinator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/MapleSessionCoordinator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/MapleSessionCoordinator.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -305,12 +305,12 @@ public boolean canStartLoginSession(IoSession session) {\n     }\n     \n     public void closeLoginSession(IoSession session) {\n-        String remoteIp = getSessionRemoteAddress(session);\n-        Set<IoSession> lrh = loginRemoteHosts.get(remoteIp);\n+        String remoteHost = getSessionRemoteAddress(session);\n+        Set<IoSession> lrh = loginRemoteHosts.get(remoteHost);\n         if (lrh != null) {\n             lrh.remove(session);\n             if (lrh.isEmpty()) {\n-                loginRemoteHosts.remove(remoteIp);\n+                loginRemoteHosts.remove(remoteHost);\n             }\n         }\n         "}, {"sha": "941fcd41862ec99bcfaed41aa6391fc7306c4d5d", "filename": "src/net/server/coordinator/matchchecker/MatchCheckerListenerFactory.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/MatchCheckerListenerFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/MatchCheckerListenerFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/matchchecker/MatchCheckerListenerFactory.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -20,6 +20,7 @@\n package net.server.coordinator.matchchecker;\n \n import net.server.coordinator.matchchecker.listener.MatchCheckerGuildCreation;\n+import net.server.coordinator.matchchecker.listener.MatchCheckerCPQChallenge;\n \n /**\n  *\n@@ -29,7 +30,8 @@\n     \n     public enum MatchCheckerType {\n         \n-        GUILD_CREATION(MatchCheckerGuildCreation.loadListener());\n+        GUILD_CREATION(MatchCheckerGuildCreation.loadListener()),\n+        CPQ_CHALLENGE(MatchCheckerCPQChallenge.loadListener());\n         \n         private final AbstractMatchCheckerListener listener;\n         "}, {"sha": "b0c9cf07389b00afbfcc48e51ac3a86026887cf9", "filename": "src/net/server/coordinator/matchchecker/listener/MatchCheckerCPQChallenge.java", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/listener/MatchCheckerCPQChallenge.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/listener/MatchCheckerCPQChallenge.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/matchchecker/listener/MatchCheckerCPQChallenge.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -0,0 +1,119 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package net.server.coordinator.matchchecker.listener;\n+\n+import client.MapleCharacter;\n+import constants.LanguageConstants;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Set;\n+import net.server.coordinator.matchchecker.AbstractMatchCheckerListener;\n+import net.server.coordinator.matchchecker.MatchCheckerListenerRecipe;\n+import net.server.world.MaplePartyCharacter;\n+import scripting.npc.NPCConversationManager;\n+import scripting.npc.NPCScriptManager;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class MatchCheckerCPQChallenge implements MatchCheckerListenerRecipe {\n+    \n+    public static AbstractMatchCheckerListener loadListener() {\n+        return (new MatchCheckerCPQChallenge()).getListener();\n+    }\n+    \n+    private static MapleCharacter getChallenger(int leaderid, Set<MapleCharacter> matchPlayers) {\n+        MapleCharacter leader = null;\n+        for (MapleCharacter chr : matchPlayers) {\n+            if (chr.getId() == leaderid && chr.getClient() != null) {\n+                leader = chr;\n+                break;\n+            }\n+        }\n+        \n+        return leader;\n+    }\n+    \n+    @Override\n+    public AbstractMatchCheckerListener getListener() {\n+        return new AbstractMatchCheckerListener() {\n+            \n+            @Override\n+            public void onMatchCreated(MapleCharacter leader, Set<MapleCharacter> nonLeaderMatchPlayers, String message) {\n+                NPCConversationManager cm = leader.getClient().getCM();\n+                int npcid = cm.getNpc();\n+                \n+                MapleCharacter ldr = null;\n+                for (MapleCharacter chr : nonLeaderMatchPlayers) {\n+                    ldr = chr;\n+                    break;\n+                }\n+                \n+                MapleCharacter chr = leader;\n+                \n+                List<MaplePartyCharacter> chrMembers = new LinkedList<>();\n+                for (MaplePartyCharacter mpc : chr.getParty().getMembers()) {\n+                    chrMembers.add(mpc);\n+                }\n+                \n+                if (message.contentEquals(\"cpq1\")) {\n+                    NPCScriptManager.getInstance().start(\"cpqchallenge\", ldr.getClient(), npcid, chrMembers);\n+                } else {\n+                    NPCScriptManager.getInstance().start(\"cpqchallenge2\", ldr.getClient(), npcid, chrMembers);\n+                }\n+                \n+                cm.sendOk(LanguageConstants.getMessage(chr, LanguageConstants.CPQChallengeRoomSent));\n+            }\n+            \n+            @Override\n+            public void onMatchAccepted(int leaderid, Set<MapleCharacter> matchPlayers, String message) {\n+                MapleCharacter chr = getChallenger(leaderid, matchPlayers);\n+                \n+                MapleCharacter ldr = null;\n+                for (MapleCharacter ch : matchPlayers) {\n+                    if (ch != chr) {\n+                        ldr = ch;\n+                        break;\n+                    }\n+                }\n+                \n+                if (message.contentEquals(\"cpq1\")) {\n+                    ldr.getClient().getCM().startCPQ(chr, ldr.getMapId() + 1);\n+                } else {\n+                    ldr.getClient().getCM().startCPQ2(chr, ldr.getMapId() + 1);\n+                }\n+                \n+                ldr.getParty().setEnemy(chr.getParty());\n+                chr.getParty().setEnemy(ldr.getParty());\n+                chr.setChallenged(false);\n+            }\n+            \n+            @Override\n+            public void onMatchDeclined(int leaderid, Set<MapleCharacter> matchPlayers, String message) {\n+                MapleCharacter chr = getChallenger(leaderid, matchPlayers);\n+                chr.dropMessage(5, LanguageConstants.getMessage(chr, LanguageConstants.CPQChallengeRoomDenied));\n+            }\n+            \n+            @Override\n+            public void onMatchDismissed(int leaderid, Set<MapleCharacter> matchPlayers, String message) {}\n+        };\n+    }\n+}"}, {"sha": "ed235a00d9880dd61aab2dbbc237725119409a6f", "filename": "src/net/server/coordinator/matchchecker/listener/MatchCheckerGuildCreation.java", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/listener/MatchCheckerGuildCreation.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/coordinator/matchchecker/listener/MatchCheckerGuildCreation.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/coordinator/matchchecker/listener/MatchCheckerGuildCreation.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -166,13 +166,29 @@ public void onMatchDeclined(int leaderid, Set<MapleCharacter> matchPlayers, Stri\n             \n             @Override\n             public void onMatchDismissed(int leaderid, Set<MapleCharacter> matchPlayers, String message) {\n+                \n+                MapleCharacter leader = null;\n+                for (MapleCharacter chr : matchPlayers) {\n+                    if (chr.getId() == leaderid) {\n+                        leader = chr;\n+                        break;\n+                    }\n+                }\n+                \n+                String msg;\n+                if (leader != null && leader.getParty() == null) {\n+                    msg = \"The Guild creation has been dismissed since the leader left the founding party.\";\n+                } else {\n+                    msg = \"The Guild creation has been dismissed since a member was already in a party when they answered.\";\n+                }\n+                \n                 for (MapleCharacter chr : matchPlayers) {\n                     if (chr.getId() == leaderid && chr.getClient() != null) {\n                         MapleParty.leaveParty(chr.getParty(), chr.getClient());\n                     }\n                     \n                     if (chr.isLoggedinWorld()) {\n-                        chr.message(\"All cofounders must not be in a party when performing the Guild creation.\");\n+                        chr.message(msg);\n                     }\n                 }\n             }"}, {"sha": "f544f6e55cdab6be3b5d0a8ece007a4df71a5278", "filename": "src/net/server/guild/MapleGuild.java", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/guild/MapleGuild.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/guild/MapleGuild.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleGuild.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -50,6 +50,7 @@\n import net.server.coordinator.MapleInviteCoordinator;\n import net.server.coordinator.MapleInviteCoordinator.InviteType;\n import net.server.coordinator.MapleInviteCoordinator.InviteResult;\n+import net.server.coordinator.MapleMatchCheckerCoordinator;\n \n public class MapleGuild {\n     \n@@ -752,8 +753,9 @@ public static boolean answerInvitation(int targetId, String targetName, int guil\n         Set<MapleCharacter> guildMembers = new HashSet<>();\n         guildMembers.add(guildLeader);\n         \n+        MapleMatchCheckerCoordinator mmce = guildLeader.getWorldServer().getMatchCheckerCoordinator();\n         for (MapleCharacter chr : guildLeader.getMap().getAllPlayers()) {\n-            if (chr.getParty() == null && chr.getGuild() == null) {\n+            if (chr.getParty() == null && chr.getGuild() == null && mmce.getMatchConfirmationLeaderid(chr.getId()) == -1) {\n                 guildMembers.add(chr);\n             }\n         }\n@@ -765,7 +767,7 @@ public static void displayGuildRanks(MapleClient c, int npcid) {\n         try {\n             ResultSet rs;\n             Connection con = DatabaseConnection.getConnection();\n-            try (PreparedStatement ps = con.prepareStatement(\"SELECT `name`, `GP`, `logoBG`, `logoBGColor`, `logo`, `logoColor` FROM guilds WHERE NOT `guildid` = '1' ORDER BY `GP` DESC LIMIT 50\")) {\n+            try (PreparedStatement ps = con.prepareStatement(\"SELECT `name`, `GP`, `logoBG`, `logoBGColor`, `logo`, `logoColor` FROM guilds ORDER BY `GP` DESC LIMIT 50\")) {\n                 rs = ps.executeQuery();\n                 c.announce(MaplePacketCreator.showGuildRanks(npcid, rs));\n             }"}, {"sha": "3a2041d510100efdd8d792d50ad74427019e38ca", "filename": "src/net/server/handlers/login/LoginPasswordHandler.java", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/handlers/login/LoginPasswordHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/handlers/login/LoginPasswordHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/LoginPasswordHandler.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -64,15 +64,17 @@ private static String getRemoteIp(IoSession session) {\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         String remoteHost = getRemoteIp(c.getSession());\n         if (!remoteHost.contentEquals(\"null\")) {\n-            if (remoteHost.startsWith(\"127.\")) {\n-                if (!ServerConstants.LOCALSERVER) { // thanks Mills for noting HOST can also have a field named \"localhost\"\n-                    c.announce(MaplePacketCreator.getLoginFailed(13));  // cannot login as localhost if it's not a local server\n-                    return;\n-                }\n-            } else {\n-                if (ServerConstants.LOCALSERVER) {\n-                    c.announce(MaplePacketCreator.getLoginFailed(13));  // cannot login as non-localhost if it's a local server\n-                    return;\n+            if (ServerConstants.USE_IP_VALIDATION) {    // thanks Alex (CanIGetaPR) for suggesting IP validation as a server flag\n+                if (remoteHost.startsWith(\"127.\")) {\n+                    if (!ServerConstants.LOCALSERVER) { // thanks Mills for noting HOST can also have a field named \"localhost\"\n+                        c.announce(MaplePacketCreator.getLoginFailed(13));  // cannot login as localhost if it's not a local server\n+                        return;\n+                    }\n+                } else {\n+                    if (ServerConstants.LOCALSERVER) {\n+                        c.announce(MaplePacketCreator.getLoginFailed(13));  // cannot login as non-localhost if it's a local server\n+                        return;\n+                    }\n                 }\n             }\n         } else {"}, {"sha": "2dec908d1c4c79ed6f9cf548259d5d951982ddab", "filename": "src/net/server/world/MapleParty.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/world/MapleParty.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/net/server/world/MapleParty.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/MapleParty.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -334,7 +334,7 @@ public static boolean createParty(MapleCharacter player, boolean silentCheck) {\n                 player.dropMessage(5, \"You cannot request a party creation while participating the Ariant Battle Arena.\");\n                 return false;\n             }\n-\n+            \n             MaplePartyCharacter partyplayer = new MaplePartyCharacter(player);\n             party = player.getWorldServer().createParty(partyplayer);\n             player.setParty(party);\n@@ -343,6 +343,7 @@ public static boolean createParty(MapleCharacter player, boolean silentCheck) {\n             player.silentPartyUpdate();\n \n             player.partyOperationUpdate(party, null);\n+            \n             player.announce(MaplePacketCreator.partyCreated(party, partyplayer.getId()));\n             \n             return true;\n@@ -365,7 +366,7 @@ public static boolean joinParty(MapleCharacter player, int partyid, boolean sile\n                 if (party.getMembers().size() < 6) {\n                     MaplePartyCharacter partyplayer = new MaplePartyCharacter(player);\n                     player.getMap().addPartyMember(player);\n-\n+                    \n                     world.updateParty(party.getId(), PartyOperation.JOIN, partyplayer);\n                     player.receivePartyMemberHP();\n                     player.updatePartyMemberHP();"}, {"sha": "695e4d4962f2b8239c5b4ae836a48c6c77a581b1", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -943,7 +943,7 @@ public Integer getClearStageMeso(int stage) {   //stage counts from ONE.\n         }\n         \n         private void dropExclusiveItems(MapleCharacter chr) {\n-                AbstractPlayerInteraction api = chr.getClient().getAbstractPlayerInteraction();\n+                AbstractPlayerInteraction api = chr.getAbstractPlayerInteraction();\n                 \n                 for(Integer item: exclusiveItems) {\n                         api.removeAll(item);\n@@ -1051,7 +1051,7 @@ public final boolean giveEventReward(MapleCharacter player, int eventLevel) {\n \n                 if(!hasRewardSlot(player, eventLevel)) return false;\n \n-                AbstractPlayerInteraction api = player.getClient().getAbstractPlayerInteraction();\n+                AbstractPlayerInteraction api = player.getAbstractPlayerInteraction();\n                 int rnd = (int)Math.floor(Math.random() * rewardsSet.size());\n \n                 api.gainItem(rewardsSet.get(rnd), rewardsQty.get(rnd).shortValue());"}, {"sha": "b8c1dedeefbefd9a9fb5c0d7bc5b96d83404b149", "filename": "src/scripting/npc/NPCConversationManager.java", "status": "modified", "additions": 35, "deletions": 27, "changes": 62, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/scripting/npc/NPCConversationManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/scripting/npc/NPCConversationManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/npc/NPCConversationManager.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -62,6 +62,7 @@\n import constants.LanguageConstants;\n import net.server.PlayerStorage;\n import net.server.channel.Channel;\n+import net.server.coordinator.matchchecker.MatchCheckerListenerFactory.MatchCheckerType;\n import server.MapleSkillbookInformationProvider;\n import server.MapleSkillbookInformationProvider.SkillBookEntry;\n import server.TimerManager;\n@@ -76,8 +77,9 @@\n import java.awt.Point;\n import java.util.Arrays;\n import java.util.Collections;\n-import java.util.LinkedList;\n+import java.util.HashSet;\n import java.util.List;\n+import java.util.Set;\n import server.MapleMarriage;\n \n /**\n@@ -633,7 +635,7 @@ public int cpqCalcAvgLvl(int map) {\n         }\n \n         public boolean sendCPQMapLists() {\n-            String msg = LanguageConstants.Languages(getPlayer()).CPQPickRoom;\n+            String msg = LanguageConstants.getMessage(getPlayer(), LanguageConstants.CPQPickRoom);\n             int msgLen = msg.length();\n             for (int i = 0; i < 6; i++) {\n                 if (fieldTaken(i)) {\n@@ -696,7 +698,7 @@ public void cpqLobby(int field) {\n                     mc = ps.getCharacterById(mpc.getId());\n                     if (mc != null) {\n                         mc.changeMap(map, map.getPortal(0));\n-                        mc.announce(MaplePacketCreator.serverNotice(6, LanguageConstants.Languages(mc).CPQEntryLobby));\n+                        mc.announce(MaplePacketCreator.serverNotice(6, LanguageConstants.getMessage(mc, LanguageConstants.CPQEntryLobby)));\n                         TimerManager tMan = TimerManager.getInstance();\n                         tMan.schedule(new Runnable() {\n                             @Override\n@@ -850,7 +852,7 @@ public void run() {\n         }\n \n         public boolean sendCPQMapLists2() {\n-            String msg = LanguageConstants.Languages(getPlayer()).CPQPickRoom;\n+            String msg = LanguageConstants.getMessage(getPlayer(), LanguageConstants.CPQPickRoom);\n             int msgLen = msg.length();\n             for (int i = 0; i < 3; i++) {\n                 if (fieldTaken2(i)) {\n@@ -913,7 +915,7 @@ public void cpqLobby2(int field) {\n                     mc = ps.getCharacterById(mpc.getId());\n                     if (mc != null) {\n                         mc.changeMap(map, map.getPortal(0));\n-                        mc.announce(MaplePacketCreator.serverNotice(6, LanguageConstants.Languages(mc).CPQEntryLobby));\n+                        mc.announce(MaplePacketCreator.serverNotice(6, LanguageConstants.getMessage(mc, LanguageConstants.CPQEntryLobby)));\n                         TimerManager tMan = TimerManager.getInstance();\n                         tMan.schedule(new Runnable() {\n                             @Override\n@@ -934,14 +936,30 @@ public void run() {\n                 ex.printStackTrace();\n             }\n         }\n-\n+        \n+        public void mapClock(int time) {\n+            getPlayer().getMap().broadcastMessage(MaplePacketCreator.getClock(time));\n+        }\n+        \n+        private boolean sendCPQChallenge(String cpqType, int leaderid) {\n+            Set<Integer> cpqLeaders = new HashSet<>();\n+            cpqLeaders.add(leaderid);\n+            cpqLeaders.add(getPlayer().getId());\n+            \n+            return c.getWorldServer().getMatchCheckerCoordinator().createMatchConfirmation(MatchCheckerType.CPQ_CHALLENGE, c.getWorld(), getPlayer().getId(), cpqLeaders, cpqType);\n+        }\n+        \n+        public void answerCPQChallenge(boolean accept) {\n+            c.getWorldServer().getMatchCheckerCoordinator().answerMatchConfirmation(getPlayer().getId(), accept);\n+        }\n+        \n         public void challengeParty2(int field) {\n             MapleCharacter leader = null;\n             MapleMap map = c.getChannelServer().getMapFactory().getMap(980031000 + 1000 * field);\n             for (MapleMapObject mmo : map.getAllPlayer()) {\n                 MapleCharacter mc = (MapleCharacter) mmo;\n                 if (mc.getParty() == null) {\n-                    sendOk(LanguageConstants.Languages(mc).CPQFindError);\n+                    sendOk(LanguageConstants.getMessage(mc, LanguageConstants.CPQFindError));\n                     return;\n                 }\n                 if (mc.getParty().getLeader().getId() == mc.getId()) {\n@@ -951,23 +969,17 @@ public void challengeParty2(int field) {\n             }\n             if (leader != null) {\n                 if (!leader.isChallenged()) {\n-                    List<MaplePartyCharacter> members = new LinkedList<>();\n-                    for (MaplePartyCharacter fucker : c.getPlayer().getParty().getMembers()) {\n-                        members.add(fucker);\n+                    if (!sendCPQChallenge(\"cpq2\", leader.getId())) {\n+                        sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQChallengeRoomAnswer));\n                     }\n-                    NPCScriptManager.getInstance().start(\"cpqchallenge2\", leader.getClient(), npc, members);\n                 } else {\n-                    sendOk(LanguageConstants.Languages(leader).CPQChallengeRoomAnswer);\n+                    sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQChallengeRoomAnswer));\n                 }\n             } else {\n-                sendOk(LanguageConstants.Languages(leader).CPQLeaderNotFound);\n+                sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQLeaderNotFound));\n             }\n         }\n-\n-        public void mapClock(int time) {\n-            getPlayer().getMap().broadcastMessage(MaplePacketCreator.getClock(time));\n-        }\n-\n+        \n         public void challengeParty(int field) {\n             MapleCharacter leader = null;\n             MapleMap map = c.getChannelServer().getMapFactory().getMap(980000100 + 100 * field);\n@@ -978,7 +990,7 @@ public void challengeParty(int field) {\n             for (MapleMapObject mmo : map.getAllPlayer()) {\n                 MapleCharacter mc = (MapleCharacter) mmo;\n                 if (mc.getParty() == null) {\n-                    sendOk(LanguageConstants.Languages(mc).CPQFindError);\n+                    sendOk(LanguageConstants.getMessage(mc, LanguageConstants.CPQFindError));\n                     return;\n                 }\n                 if (mc.getParty().getLeader().getId() == mc.getId()) {\n@@ -988,18 +1000,14 @@ public void challengeParty(int field) {\n             }\n             if (leader != null) {\n                 if (!leader.isChallenged()) {\n-                    List<MaplePartyCharacter> members = new LinkedList<>();\n-                    for (MaplePartyCharacter mpc : c.getPlayer().getParty().getMembers()) {\n-                        members.add(mpc);\n+                    if (!sendCPQChallenge(\"cpq1\", leader.getId())) {\n+                        sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQChallengeRoomAnswer));\n                     }\n-                    \n-                    NPCScriptManager.getInstance().start(\"cpqchallenge\", leader.getClient(), npc, members);\n-                    sendOk(LanguageConstants.Languages(leader).CPQChallengeRoomSent);\n                 } else {\n-                    sendOk(LanguageConstants.Languages(leader).CPQChallengeRoomAnswer);\n+                    sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQChallengeRoomAnswer));\n                 }\n             } else {\n-                sendOk(LanguageConstants.Languages(leader).CPQLeaderNotFound);\n+                sendOk(LanguageConstants.getMessage(leader, LanguageConstants.CPQLeaderNotFound));\n             }\n         }\n         "}, {"sha": "5aa0184832ae1526904dfe50e7a223e1acc061c8", "filename": "src/server/MapleSkillbookInformationProvider.java", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/MapleSkillbookInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/MapleSkillbookInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleSkillbookInformationProvider.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -141,7 +141,7 @@ private static void simpleToken(String token) {\n         if(token.contains(\"/imgdir\")) {\n             status -= 1;\n         }\n-        else if(token.contains(\"imgdir\")) {\n+        else if(token.contains(\"imgdir\") && !token.endsWith(\"/>\")) {    // '\\>' XML node description not being accounted, issue found thanks to Robin Schulz, CanIGetaPR\n             status += 1;\n         }\n     }\n@@ -182,7 +182,7 @@ private static void readItemToken(String token) {\n             currentItemid = 0;\n             currentCount = 0;\n         }\n-        else if(token.contains(\"imgdir\")) {\n+        else if(token.contains(\"imgdir\") && !token.endsWith(\"/>\")) {\n             status += 1;\n         }\n         else {\n@@ -203,7 +203,7 @@ private static void translateActToken(String token) {\n         if(token.contains(\"/imgdir\")) {\n             status -= 1;\n         }\n-        else if(token.contains(\"imgdir\")) {\n+        else if(token.contains(\"imgdir\") && !token.endsWith(\"/>\")) {\n             if(status == 1) {           //getting QuestId\n                 d = getName(token);\n                 questId = Integer.parseInt(d);\n@@ -228,19 +228,22 @@ else if(status == 3) {\n     }\n     \n     private static void fetchSkillbooksFromQuests() {\n-        String line;\n+        String line = \"\";\n+        int lineNumber = 0; // add line number, thanks to Alex (CanIGetaPR)\n+        \n         try {\n             fileReader = new InputStreamReader(new FileInputStream(wzPath + \"/Quest.wz/Act.img.xml\"), \"UTF-8\");\n             bufferedReader = new BufferedReader(fileReader);\n \n             while((line = bufferedReader.readLine()) != null) {\n+                lineNumber++;\n                 translateActToken(line);\n             }\n \n             bufferedReader.close();\n             fileReader.close();\n         } catch(IOException ioe) {\n-            System.out.println(\"Failed to read Quest.wz file.\");\n+            System.out.println(\"Failed to read Quest.wz file. Line \" + lineNumber + \": \" + line);\n             ioe.printStackTrace();\n         }\n     }"}, {"sha": "62fcb526e4b3899212d26c5ffddb1f705baad261", "filename": "src/server/MapleStatEffect.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/MapleStatEffect.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/MapleStatEffect.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleStatEffect.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -805,7 +805,7 @@ private boolean applyTo(MapleCharacter applyfrom, MapleCharacter applyto, boolea\n         int mpchange = calcMPChange(applyfrom, primary);\n         if (primary) {\n             if (itemConNo != 0) {\n-                if (!applyto.getClient().getAbstractPlayerInteraction().hasItem(itemCon, itemConNo)) {\n+                if (!applyto.getAbstractPlayerInteraction().hasItem(itemCon, itemConNo)) {\n                     applyto.announce(MaplePacketCreator.enableActions());\n                     return false;\n                 }"}, {"sha": "31a6f28b54450137336a24016db812901312645f", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1750,6 +1750,8 @@ public final void changeDifficulty(final int difficulty, boolean pqMob) {\n         changeLevelByDifficulty(difficulty, pqMob);\n     }\n     \n+    // ---------------------------------------------------------------------------------\n+    \n     private boolean isPuppetInVicinity(MapleSummon summon) {\n         return summon.getPosition().distanceSq(this.getPosition()) < 177777;\n     }"}, {"sha": "c7c909cad1d8afce386afa93d787f57bb5ca3810", "filename": "src/server/maps/MapleHiredMerchant.java", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleHiredMerchant.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleHiredMerchant.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleHiredMerchant.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -34,6 +34,7 @@\n import constants.ServerConstants;\n import java.sql.Connection;\n import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n import java.sql.SQLException;\n import java.util.ArrayList;\n import java.util.Collections;\n@@ -297,8 +298,20 @@ public void buy(MapleClient c, int item, short quantity) {\n                         try {\n                             Connection con = DatabaseConnection.getConnection();\n                             \n-                            try (PreparedStatement ps = con.prepareStatement(\"UPDATE characters SET MerchantMesos = MerchantMesos + \" + price + \" WHERE id = ?\", Statement.RETURN_GENERATED_KEYS)) {\n+                            long merchantMesos = 0;\n+                            try (PreparedStatement ps = con.prepareStatement(\"SELECT MerchantMesos FROM characters WHERE id = ?\")) {\n                                 ps.setInt(1, ownerId);\n+                                try (ResultSet rs = ps.executeQuery()) {\n+                                    if (rs.next()) {\n+                                        merchantMesos = rs.getInt(1);\n+                                    }\n+                                }\n+                            }\n+                            merchantMesos += price;\n+                            \n+                            try (PreparedStatement ps = con.prepareStatement(\"UPDATE characters SET MerchantMesos = ? WHERE id = ?\", Statement.RETURN_GENERATED_KEYS)) {\n+                                ps.setInt(1, (int) Math.min(merchantMesos, Integer.MAX_VALUE));\n+                                ps.setInt(2, ownerId);\n                                 ps.executeUpdate();\n                             }\n                             "}, {"sha": "990e306413d4c4578a299d86f3f28f79b80b2764", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -1380,12 +1380,13 @@ public void killMonster(final MapleMonster monster, final MapleCharacter chr, fi\n         }\n         \n         if (chr == null) {\n-            if(removeKilledMonsterObject(monster)) {\n+            if (removeKilledMonsterObject(monster)) {\n                 monster.dispatchMonsterKilled(false);\n                 broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n+                monster.aggroSwitchController(null, false);\n             }\n         } else {\n-            if(removeKilledMonsterObject(monster)) {\n+            if (removeKilledMonsterObject(monster)) {\n                 if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n                     AutobanFactory.GENERAL.alert(chr, \" for killing a \" + monster.getName() + \" which is over 30 levels higher.\");\n                 }\n@@ -3676,7 +3677,7 @@ public SpawnPoint findClosestSpawnpoint(Point from) {\n     }\n \n     private static double getCurrentSpawnRate(int numPlayers) {\n-        return 0.550 + (0.075 * Math.min(6, numPlayers));\n+        return 0.70 + (0.05 * Math.min(6, numPlayers));\n     }\n     \n     private int getNumShouldSpawn(int numPlayers) {"}, {"sha": "af9c2a8f87ad8bfcd0bbb4086c78d54ae5caf23d", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -110,7 +110,7 @@ private void loadLifeFromWz(MapleMap map, MapleData mapData) {\n             int y = MapleDataTool.getInt(life.getChildByPath(\"y\"));\n             int hide = MapleDataTool.getInt(\"hide\", life, 0);\n             int mobTime = MapleDataTool.getInt(\"mobTime\", life, 0);\n-\n+            \n             loadLifeRaw(map, Integer.parseInt(id), type, cy, f, fh, rx0, rx1, x, y, hide, mobTime, team);\n         }\n     }"}, {"sha": "02d2d71e2786c1d6fc42e2778b0639cb1aedf583", "filename": "src/server/partyquest/AriantColiseum.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/partyquest/AriantColiseum.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/partyquest/AriantColiseum.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/partyquest/AriantColiseum.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -193,7 +193,7 @@ private synchronized void leaveArenaInternal(MapleCharacter chr) {\n                 chr.setAriantColiseum(null);\n                 \n                 int shards = chr.countItem(4031868);\n-                chr.getClient().getAbstractPlayerInteraction().removeAll(4031868);\n+                chr.getAbstractPlayerInteraction().removeAll(4031868);\n                 chr.updateAriantScore(shards);\n             }\n         }"}, {"sha": "aed6f96219cc50ce5f5216af22d5b193db45dbc1", "filename": "src/server/partyquest/MonsterCarnival.java", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/partyquest/MonsterCarnival.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/partyquest/MonsterCarnival.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/partyquest/MonsterCarnival.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -59,7 +59,7 @@ public MonsterCarnival(MapleParty p1, MapleParty p2, int mapid, boolean cpq1, in\n                     mc.setTeam(0);\n                     mc.setFestivalPoints(0);\n                     mc.forceChangeMap(map, map.getPortal(redPortal));\n-                    mc.dropMessage(6, LanguageConstants.Languages(mc).CPQEntry);\n+                    mc.dropMessage(6, LanguageConstants.getMessage(mc, LanguageConstants.CPQEntry));\n                     if (p1.getLeader().getId() == mc.getId()) {\n                         leader1 = mc;\n                     }\n@@ -73,7 +73,7 @@ public MonsterCarnival(MapleParty p1, MapleParty p2, int mapid, boolean cpq1, in\n                     mc.setTeam(1);\n                     mc.setFestivalPoints(0);\n                     mc.forceChangeMap(map, map.getPortal(bluePortal));\n-                    mc.dropMessage(6, LanguageConstants.Languages(mc).CPQEntry);\n+                    mc.dropMessage(6, LanguageConstants.getMessage(mc, LanguageConstants.CPQEntry));\n                     if (p2.getLeader().getId() == mc.getId()) {\n                         leader2 = mc;\n                     }\n@@ -82,10 +82,10 @@ public MonsterCarnival(MapleParty p1, MapleParty p2, int mapid, boolean cpq1, in\n             }\n             if (Grupo1 == null || Grupo2 == null) {\n                 for (MaplePartyCharacter mpc : p2.getMembers()) {\n-                    mpc.getPlayer().dropMessage(5, LanguageConstants.Languages(mpc.getPlayer()).CPQError);\n+                    mpc.getPlayer().dropMessage(5, LanguageConstants.getMessage(mpc.getPlayer(), LanguageConstants.CPQError));\n                 }\n                 for (MaplePartyCharacter mpc : p2.getMembers()) {\n-                    mpc.getPlayer().dropMessage(5, LanguageConstants.Languages(mpc.getPlayer()).CPQError);\n+                    mpc.getPlayer().dropMessage(5, LanguageConstants.getMessage(mpc.getPlayer(), LanguageConstants.CPQError));\n                 }\n                 return;\n             }\n@@ -140,13 +140,13 @@ public void playerDisconnected(int charid) {\n             String teamS = \"\";\n             switch (team) {\n                 case 0:\n-                    teamS = LanguageConstants.Languages(chrMap).CPQRed;\n+                    teamS = LanguageConstants.getMessage(chrMap, LanguageConstants.CPQRed);\n                     break;\n                 case 1:\n-                    teamS = LanguageConstants.Languages(chrMap).CPQBlue;\n+                    teamS = LanguageConstants.getMessage(chrMap, LanguageConstants.CPQBlue);\n                     break;\n             }\n-            chrMap.dropMessage(5, teamS + LanguageConstants.Languages(chrMap).CPQPlayerExit);\n+            chrMap.dropMessage(5, teamS + LanguageConstants.getMessage(chrMap, LanguageConstants.CPQPlayerExit));\n         }\n         earlyFinish();\n     }\n@@ -353,7 +353,7 @@ public int getTimeLeftSeconds() {\n \n     private void extendTime() {\n         for (MapleCharacter chrMap : map.getAllPlayers()) {\n-            chrMap.dropMessage(5, LanguageConstants.Languages(chrMap).CPQExtendTime);\n+            chrMap.dropMessage(5, LanguageConstants.getMessage(chrMap, LanguageConstants.CPQExtendTime));\n         }\n         startTime = System.currentTimeMillis() + 3 * 60 * 1000;\n         "}, {"sha": "48b1131c4a087b74b731a30b98a90316c2cc6a35", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -321,6 +321,7 @@ public void forfeit(MapleCharacter c) {\n     public boolean forceStart(MapleCharacter c, int npc) {\n         MapleQuestStatus newStatus = new MapleQuestStatus(this, MapleQuestStatus.Status.STARTED, npc);\n         newStatus.setForfeited(c.getQuest(this).getForfeited());\n+        newStatus.setCompleted(c.getQuest(this).getCompleted());\n \n         if (timeLimit > 0) {\n             newStatus.setExpirationTime(System.currentTimeMillis() + (timeLimit * 1000));\n@@ -355,6 +356,7 @@ public boolean forceComplete(MapleCharacter c, int npc) {\n         \n         MapleQuestStatus newStatus = new MapleQuestStatus(this, MapleQuestStatus.Status.COMPLETED, npc);\n         newStatus.setForfeited(c.getQuest(this).getForfeited());\n+        newStatus.setCompleted(c.getQuest(this).getCompleted());\n         newStatus.setCompletionTime(System.currentTimeMillis());\n         c.updateQuest(newStatus);\n         "}, {"sha": "a445e713ffc71a123a319e7856b86c2537c5377f", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -7902,4 +7902,18 @@ public static void addCashItemInformation(final MaplePacketLittleEndianWriter mp\n                 mplew.writeInt(transition);\n                 return mplew.getPacket();\n         }\n+        \n+        public static byte[] setNPCScriptable(Set<Pair<Integer, String>> scriptNpcDescriptions) {  // thanks to GabrielSin\n+                MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n+                mplew.writeShort(SendOpcode.SET_NPC_SCRIPTABLE.getValue());\n+                mplew.write(scriptNpcDescriptions.size());\n+                for (Pair<Integer, String> p : scriptNpcDescriptions) {\n+                        mplew.writeInt(p.getLeft());\n+                        mplew.writeMapleAsciiString(p.getRight());\n+                        mplew.writeInt(0); // start time\n+                        mplew.writeInt(Integer.MAX_VALUE); // end time\n+                }\n+                return mplew.getPacket();\n+        }\n+        \n }\n\\ No newline at end of file"}, {"sha": "e4569ad261b3edb2a241ed4d058a3dd40912ec3a", "filename": "src/tools/packets/Fishing.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/tools/packets/Fishing.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/src/tools/packets/Fishing.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/packets/Fishing.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -108,7 +108,7 @@ public static void doFishing(MapleCharacter chr, int baitLevel, double yearLikel\n                     rewardStr = \"a(n) \" + MapleItemInformationProvider.getInstance().getName(itemid) + \".\";\n                     \n                     if (chr.canHold(itemid)) {\n-                        chr.getClient().getAbstractPlayerInteraction().gainItem(itemid, true);\n+                        chr.getAbstractPlayerInteraction().gainItem(itemid, true);\n                     } else {\n                         chr.showHint(\"Couldn't catch a(n) #r\" + MapleItemInformationProvider.getInstance().getName(itemid) + \"#k due to #e#b\" + ItemConstants.getInventoryType(itemid) + \"#k#n inventory limit.\");\n                         rewardStr += \".. but has goofed up due to full inventory.\";"}, {"sha": "95b8f765aef124ff8de243d146f5b6e2ad6bd791", "filename": "tools/MapleSkillbookStackUpdate/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookStackUpdate/build.xml?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleSkillbookStackUpdate\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleSkillbookStackUpdate.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleSkillbookStackUpdate-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleSkillbookStackUpdate/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookStackUpdate/manifest.mf?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "f6004cdcae8286c6aa3a24253c4de7e47a276022", "filename": "tools/MapleSkillbookStackUpdate/src/mapleskillbookstackupdate/MapleSkillbookStackUpdate.java", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/src/mapleskillbookstackupdate/MapleSkillbookStackUpdate.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/tools/MapleSkillbookStackUpdate/src/mapleskillbookstackupdate/MapleSkillbookStackUpdate.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleSkillbookStackUpdate/src/mapleskillbookstackupdate/MapleSkillbookStackUpdate.java?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -0,0 +1,187 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package mapleskillbookstackupdate;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.sql.Connection;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ * \n+ * This application parses skillbook XMLs, filling up stack amount of those\n+ * items to 100 (eliminating limitations on held skillbooks, now using\n+ * default stack quantity expected by USE items).\n+ * \n+ * Estimated parse time: 10 seconds\n+ */\n+public class MapleSkillbookStackUpdate {\n+    \n+    static String wzPath = \"../../wz\";\n+    static String outputWzPath = \"lib\";\n+    \n+\n+    static Connection con = null;\n+    static PrintWriter printWriter = null;\n+    static InputStreamReader fileReader = null;\n+    static BufferedReader bufferedReader = null;\n+    \n+    static int initialLength = 200;\n+    static int initialStringLength = 50;\n+    static boolean displayExtraInfo = true;     // display items with zero quantity over the quest act WZ\n+    \n+    static int status = 0;\n+    \n+    private static boolean isSkillMasteryBook(int itemid) {\n+        return itemid >= 2280000 && itemid < 2300000;\n+    }\n+    \n+    private static String getName(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+        \n+        i = token.lastIndexOf(\"name\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        if(j < i) return \"0\";           //node value containing 'name' in it's scope, cheap fix since we don't deal with strings anyway\n+        \n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static String getValue(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+\n+        i = token.lastIndexOf(\"value\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static void forwardCursor(int st) {\n+        String line = null;\n+\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                simpleToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+\n+    private static void simpleToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+        }\n+        printWriter.println(token);\n+    }\n+    \n+    private static void translateItemToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+            \n+            if(status == 2) {      //itemid\n+                int itemid = Integer.valueOf(getName(token));\n+                \n+                if (!isSkillMasteryBook(itemid)) {\n+                    printWriter.println(token);\n+                    forwardCursor(status);\n+                    return;\n+                }\n+            }\n+        } else {\n+            if(status == 3) {\n+                if (getName(token).contentEquals(\"slotMax\")) {\n+                    printWriter.println(\"      <int name=\\\"slotMax\\\" value=\\\"100\\\"/>\");\n+                    return;\n+                }\n+            }\n+        }\n+        \n+        printWriter.println(token);\n+    }\n+    \n+    private static void parseItemFile(File file, String outputName) {\n+        // This will reference one line at a time\n+        String line = null;\n+        \n+        try {\n+            printWriter = new PrintWriter(outputName);\n+            fileReader = new InputStreamReader(new FileInputStream(file), \"UTF-8\");\n+            bufferedReader = new BufferedReader(fileReader);\n+\n+            while((line = bufferedReader.readLine()) != null) {\n+                translateItemToken(line);\n+            }\n+            \n+            bufferedReader.close();\n+            fileReader.close();\n+            printWriter.close();\n+        }\n+        catch(IOException ex) {\n+            System.out.println(\"Error reading file '\" + file.getName() + \"'\");\n+        }\n+        \n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void parseItemDirectory(String wzPath, String outputPath) {\n+        File wzDir = new File(wzPath);\n+        \n+        for (File f : wzDir.listFiles()) {\n+            parseItemFile(f, outputPath + f.getName());\n+        }\n+        \n+    }\n+    \n+    public static void main(String[] args) {\n+        System.out.println(\"Reading item files...\");\n+        parseItemDirectory(wzPath + \"/Item.wz/Consume/\", outputWzPath + \"/\");\n+        System.out.println(\"Done!\");\n+    }\n+    \n+}"}, {"sha": "c605159bae062f3a841fc3be360aa8551e8c6559", "filename": "wz/Item.wz/Consume/0228.img.xml", "status": "modified", "additions": 26, "deletions": 26, "changes": 52, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Item.wz/Consume/0228.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Item.wz/Consume/0228.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Consume/0228.img.xml?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -8,7 +8,7 @@\n       <canvas name=\"iconRaw\" width=\"29\" height=\"32\">\n         <vector name=\"origin\" x=\"-2\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -27,7 +27,7 @@\n       <canvas name=\"iconRaw\" width=\"28\" height=\"25\">\n         <vector name=\"origin\" x=\"-2\" y=\"28\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -46,7 +46,7 @@\n       <canvas name=\"iconRaw\" width=\"20\" height=\"26\">\n         <vector name=\"origin\" x=\"-5\" y=\"29\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -77,7 +77,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -108,7 +108,7 @@\n       <canvas name=\"iconRaw\" width=\"31\" height=\"22\">\n         <vector name=\"origin\" x=\"0\" y=\"24\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -127,7 +127,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -149,7 +149,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -172,7 +172,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -194,7 +194,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -215,7 +215,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -235,7 +235,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -255,7 +255,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -275,7 +275,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -296,7 +296,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -317,7 +317,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -338,7 +338,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -359,7 +359,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -380,7 +380,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -400,7 +400,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -420,7 +420,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -440,7 +440,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -460,7 +460,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -480,7 +480,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -500,7 +500,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -520,7 +520,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n@@ -540,7 +540,7 @@\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n         <int name=\"z\" value=\"0\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"only\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>"}, {"sha": "722a3dd5e3ee1ec4f49cb9802c23a3f4e98b5183", "filename": "wz/Item.wz/Consume/0229.img.xml", "status": "modified", "additions": 139, "deletions": 139, "changes": 278, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Item.wz/Consume/0229.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Item.wz/Consume/0229.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Consume/0229.img.xml?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -8,7 +8,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"reqSkillLevel\" value=\"5\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n@@ -28,7 +28,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -48,7 +48,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -68,7 +68,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -88,7 +88,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -108,7 +108,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -128,7 +128,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -148,7 +148,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -168,7 +168,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -186,7 +186,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -204,7 +204,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -222,7 +222,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -240,7 +240,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -258,7 +258,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -276,7 +276,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -295,7 +295,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -314,7 +314,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -332,7 +332,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -350,7 +350,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -368,7 +368,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -386,7 +386,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -404,7 +404,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -422,7 +422,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -440,7 +440,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -458,7 +458,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -478,7 +478,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -498,7 +498,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -518,7 +518,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -538,7 +538,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -558,7 +558,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -578,7 +578,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -596,7 +596,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -614,7 +614,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -632,7 +632,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -650,7 +650,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -668,7 +668,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -686,7 +686,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -704,7 +704,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -722,7 +722,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -740,7 +740,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -758,7 +758,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -776,7 +776,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -794,7 +794,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -812,7 +812,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -830,7 +830,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -848,7 +848,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -866,7 +866,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -884,7 +884,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -902,7 +902,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -920,7 +920,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -938,7 +938,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -957,7 +957,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -976,7 +976,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -995,7 +995,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1014,7 +1014,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1032,7 +1032,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1050,7 +1050,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1068,7 +1068,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1086,7 +1086,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1104,7 +1104,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1122,7 +1122,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1140,7 +1140,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1158,7 +1158,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1176,7 +1176,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1194,7 +1194,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1212,7 +1212,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1230,7 +1230,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1248,7 +1248,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1266,7 +1266,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1284,7 +1284,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1302,7 +1302,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1320,7 +1320,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1338,7 +1338,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1356,7 +1356,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1374,7 +1374,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1393,7 +1393,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1412,7 +1412,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1431,7 +1431,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1450,7 +1450,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1469,7 +1469,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1488,7 +1488,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1507,7 +1507,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1526,7 +1526,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1544,7 +1544,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1562,7 +1562,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1580,7 +1580,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1598,7 +1598,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1616,7 +1616,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1634,7 +1634,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1652,7 +1652,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1670,7 +1670,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1688,7 +1688,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1706,7 +1706,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1724,7 +1724,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1742,7 +1742,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1772,7 +1772,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1790,7 +1790,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1808,7 +1808,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1826,7 +1826,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1844,7 +1844,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1862,7 +1862,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1880,7 +1880,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1898,7 +1898,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1916,7 +1916,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1934,7 +1934,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1952,7 +1952,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -1970,7 +1970,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -1988,7 +1988,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2006,7 +2006,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2024,7 +2024,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2042,7 +2042,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2060,7 +2060,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2078,7 +2078,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2096,7 +2096,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2114,7 +2114,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2132,7 +2132,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2150,7 +2150,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2168,7 +2168,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2186,7 +2186,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2204,7 +2204,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2222,7 +2222,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2240,7 +2240,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2258,7 +2258,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2276,7 +2276,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2294,7 +2294,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2324,7 +2324,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2342,7 +2342,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2360,7 +2360,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2378,7 +2378,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2396,7 +2396,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2414,7 +2414,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2432,7 +2432,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2450,7 +2450,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2468,7 +2468,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2486,7 +2486,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2504,7 +2504,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2522,7 +2522,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>\n@@ -2540,7 +2540,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"20\"/>\n       <int name=\"success\" value=\"70\"/>\n@@ -2558,7 +2558,7 @@\n       <canvas name=\"iconRaw\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>\n       </canvas>\n-      <int name=\"slotMax\" value=\"1\"/>\n+      <int name=\"slotMax\" value=\"100\"/>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"masterLevel\" value=\"30\"/>\n       <int name=\"success\" value=\"50\"/>"}, {"sha": "886894009502fc8794957209073b2d82ea401f76", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -34753,7 +34753,6 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9201031\"/>\n       <int name=\"lvmin\" value=\"23\"/>\n-      <string name=\"end\" value=\"2010010100\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"28333\">"}, {"sha": "7a2dae9b20dc9bdb9d8c78f26f7fa2bccdd16660", "filename": "wz/String.wz/Consume.img.xml", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/String.wz/Consume.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569/wz/String.wz/Consume.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Consume.img.xml?ref=c2fa7883fed52c6dfa9d2bf4d4b522cde6d08569", "patch": "@@ -130,7 +130,7 @@\n   </imgdir>\n   <imgdir name=\"2002009\">\n     <string name=\"name\" value=\"Dexterity Pill\"/>\n-    <string name=\"desc\" value=\"A pill of concentrated dexterity potion. Avoidablity + 10 for 10 minutes\"/>\n+    <string name=\"desc\" value=\"A pill of concentrated dexterity potion. Avoidability + 10 for 10 minutes\"/>\n   </imgdir>\n   <imgdir name=\"2002010\">\n     <string name=\"name\" value=\"Speed Pill\"/>\n@@ -338,7 +338,7 @@\n   </imgdir>\n   <imgdir name=\"2020020\">\n     <string name=\"name\" value=\"Wedding Cake\"/>\n-    <string name=\"desc\" value=\"A Wedding cake that coming  Recovers 2000 HP and MP.\"/>\n+    <string name=\"desc\" value=\"A Wedding cake that coming. Recovers 2000 HP and MP.\"/>\n   </imgdir>\n   <imgdir name=\"2020021\">\n     <string name=\"name\" value=\"Nemi&apos;s Lunch Box\"/>\n@@ -778,7 +778,7 @@\n   </imgdir>\n   <imgdir name=\"2022112\">\n     <string name=\"name\" value=\"Baby Witch\"/>\n-    <string name=\"desc\" value=\"Weapon Attack +20, Magic Attack +30 nfor 15 minutes.\"/>\n+    <string name=\"desc\" value=\"Weapon Attack +20, Magic Attack +30 for 15 minutes.\"/>\n   </imgdir>\n   <imgdir name=\"2022113\">\n     <string name=\"name\" value=\"Pumpkin Pie\"/>\n@@ -798,7 +798,7 @@\n   </imgdir>\n   <imgdir name=\"2022119\">\n     <string name=\"name\" value=\"Tree Ornament\"/>\n-    <string name=\"desc\" value=\"Weapon Attack +20, Magic Attack +30 forn15 minutes.\"/>\n+    <string name=\"desc\" value=\"Weapon Attack +20, Magic Attack +30 for 15 minutes.\"/>\n   </imgdir>\n   <imgdir name=\"2022120\">\n     <string name=\"name\" value=\"Christmas Melon\"/>\n@@ -2301,7 +2301,7 @@\n   </imgdir>\n   <imgdir name=\"2040800\">\n     <string name=\"name\" value=\"Scroll for Gloves for DEX\"/>\n-    <string name=\"desc\" value=\"Improves dexterity on gloves.\\nSuccess rate:100%, accurcacy +1\"/>\n+    <string name=\"desc\" value=\"Improves dexterity on gloves.\\nSuccess rate:100%, accuracy +1\"/>\n   </imgdir>\n   <imgdir name=\"2040801\">\n     <string name=\"name\" value=\"Scroll for Gloves for DEX\"/>\n@@ -3545,7 +3545,7 @@\n   </imgdir>\n   <imgdir name=\"2044905\">\n     <string name=\"name\" value=\"[4yrAnniv] Gun for Attack 40%\"/>\n-    <string name=\"desc\" value=\"Improves the attact on Maple Canon Shooter. nSuccess rate:40%, weapon att.+3,naccuracy+2nIf failed, the item will be destroyed at a 30% rate.\"/>\n+    <string name=\"desc\" value=\"Improves the attact on Maple Canon Shooter. nSuccess rate:40%, weapon att.+3, accuracy+2nIf failed, the item will be destroyed at a 30% rate.\"/>\n   </imgdir>\n   <imgdir name=\"2048000\">\n     <string name=\"name\" value=\"Scroll for Pet Equip. for Speed\"/>\n@@ -5225,7 +5225,7 @@\n   </imgdir>\n   <imgdir name=\"2382068\">\n     <string name=\"name\" value=\"Moon Bunny Card\"/>\n-    <string name=\"desc\" value=\"A card that features Moon Bnny.n#cIf hunting at the Black MountainnJump +1#\"/>\n+    <string name=\"desc\" value=\"A card that features Moon Bunny.n#cIf hunting at the Black MountainnJump +1#\"/>\n   </imgdir>\n   <imgdir name=\"2382069\">\n     <string name=\"name\" value=\"Iron Boar Card\"/>\n@@ -5273,7 +5273,7 @@\n   </imgdir>\n   <imgdir name=\"2383006\">\n     <string name=\"name\" value=\"Jar Card\"/>\n-    <string name=\"desc\" value=\"A card that features Jar.n#cIf hunting at Herb Townn\uc18c\ube44Item drop rates are increased#\"/>\n+    <string name=\"desc\" value=\"A card that features Jar.n#cIf hunting at Herb Townn#cItem drop rates are increased#\"/>\n   </imgdir>\n   <imgdir name=\"2383007\">\n     <string name=\"name\" value=\"Mithril Mutae Card\"/>\n@@ -5289,7 +5289,7 @@\n   </imgdir>\n   <imgdir name=\"2383010\">\n     <string name=\"name\" value=\"Ginseng Jar\"/>\n-    <string name=\"desc\" value=\"A card that features Ginseng Jar.n#cIf hunting at Herb Townnthe &quot;Use&quot; item drop rates are increased#\"/>\n+    <string name=\"desc\" value=\"A card that features Ginseng Jar.n#cIf hunting at Herb TownnThe &quot;Use&quot; item drop rates are increased#\"/>\n   </imgdir>\n   <imgdir name=\"2383011\">\n     <string name=\"name\" value=\"Chief Grey Card\"/>\n@@ -5328,8 +5328,8 @@\n     <string name=\"desc\" value=\"A card that features Croco.n#cIf hunting at the SwampnAvoidability +2#\"/>\n   </imgdir>\n   <imgdir name=\"2383020\">\n-    <string name=\"name\" value=\"Luster Pixe Card\"/>\n-    <string name=\"desc\" value=\"A card that features Luster Pixe.n#cIf hunting at Cloud ParknAccuracy +2#\"/>\n+    <string name=\"name\" value=\"Luster Pixie Card\"/>\n+    <string name=\"desc\" value=\"A card that features Luster Pixie.n#cIf hunting at Cloud ParknAccuracy +2#\"/>\n   </imgdir>\n   <imgdir name=\"2383021\">\n     <string name=\"name\" value=\"Cellion Card\"/>\n@@ -6697,7 +6697,7 @@\n   </imgdir>\n   <imgdir name=\"2210017\">\n     <string name=\"name\" value=\"Moon Photo\"/>\n-    <string name=\"desc\" value=\"The more you look at it, the more you feel lightheaded\u2026 and you feel closer to the moon.\"/>\n+    <string name=\"desc\" value=\"The more you look at it, the more you feel lightheaded... and you feel closer to the moon.\"/>\n   </imgdir>\n   <imgdir name=\"2210018\">\n     <string name=\"name\" value=\"Sweet Rice Cake\"/>\n@@ -6737,7 +6737,7 @@\n   </imgdir>\n   <imgdir name=\"2388046\">\n     <string name=\"name\" value=\"Mu Gong Card\"/>\n-    <string name=\"desc\" value=\"A card with a drawing of Moo Gong on it.n#cWhen hunting in Mu Lungnincrease Item/Meso drop rate.#\"/>\n+    <string name=\"desc\" value=\"A card with a drawing of Moo Gong on it.n#cWhen hunting in Mu LungnIncreases Item/Meso drop rate.#\"/>\n   </imgdir>\n   <imgdir name=\"2430004\">\n     <string name=\"name\" value=\"Richie Gold&apos;s Random Key Pot\"/>\n@@ -7073,7 +7073,7 @@\n   </imgdir>\n   <imgdir name=\"2022542\">\n     <string name=\"name\" value=\"Little Lamb&apos;s Surprise Attack\"/>\n-    <string name=\"desc\" value=\"Attacks a Wolf&apos;s back, temporarily immobolizing it.\"/>\n+    <string name=\"desc\" value=\"Attacks a Wolf&apos;s back, temporarily immobilizing it.\"/>\n   </imgdir>\n   <imgdir name=\"2022543\">\n     <string name=\"name\" value=\"Great Confusion\"/>\n@@ -7141,7 +7141,7 @@\n   </imgdir>\n   <imgdir name=\"2040731\">\n     <string name=\"name\" value=\"Balrog&apos;s DEX Scroll 30%\"/>\n-    <string name=\"desc\" value=\"Improves DEX on Balrog Leather Shoes. nSucess rate: 30%, DEX +2\"/>\n+    <string name=\"desc\" value=\"Improves DEX on Balrog Leather Shoes. nSuccess rate: 30%, DEX +2\"/>\n   </imgdir>\n   <imgdir name=\"2040732\">\n     <string name=\"name\" value=\"Balrog&apos;s HP Scroll 30%\"/>\n@@ -7349,7 +7349,7 @@\n   </imgdir>\n   <imgdir name=\"2049106\">\n     <string name=\"name\" value=\"[6th Anniversary] Dark Scroll for Gloves for ATT 30%\"/>\n-    <string name=\"desc\" value=\"Improves ATT on Gloves. nSucces rate: 30%, Weapons ATT +2nIf unsuccessful, item has an 80% chance of being destroyed.\"/>\n+    <string name=\"desc\" value=\"Improves ATT on Gloves. nSuccess rate: 30%, Weapons ATT +2nIf unsuccessful, item has an 80% chance of being destroyed.\"/>\n   </imgdir>\n   <imgdir name=\"2049107\">\n     <string name=\"name\" value=\"[6th Anniversary] Dark Scroll for Gloves for STR 70%   [\"/>\n@@ -7493,7 +7493,7 @@\n   </imgdir>\n   <imgdir name=\"2210030\">\n     <string name=\"name\" value=\"Geppetto Transformation\"/>\n-    <string name=\"desc\" value=\"You&apos;ve entered a fable and transformed into Geppetto. You\u2019re feel a bit sluggish, but do your best to leave the dungeon with your party members.\"/>\n+    <string name=\"desc\" value=\"You&apos;ve entered a fable and transformed into Geppetto. You feel a bit sluggish, but do your best to leave the dungeon with your party members.\"/>\n   </imgdir>\n   <imgdir name=\"2210034\">\n     <string name=\"name\" value=\"Alien Gray Transformation\"/>\n@@ -8153,15 +8153,15 @@\n   </imgdir>\n   <imgdir name=\"2388052\">\n     <string name=\"name\" value=\"Giant Centipede Card\"/>\n-    <string name=\"desc\" value=\"A card that features Giant Centipede.\\n#ctem drop rates are increased at Herb Town#\"/>\n+    <string name=\"desc\" value=\"A card that features Giant Centipede.\\n#cItem drop rates are increased at Herb Town#\"/>\n   </imgdir>\n   <imgdir name=\"2388053\">\n     <string name=\"name\" value=\"Blue Mushmom Card\"/>\n-    <string name=\"desc\" value=\"A card that features Blue Mushmom.\\n#c#tem drop rates are increased at Korean Folk Town#\"/>\n+    <string name=\"desc\" value=\"A card that features Blue Mushmom.\\n#cItem drop rates are increased at Korean Folk Town#\"/>\n   </imgdir>\n   <imgdir name=\"2388054\">\n     <string name=\"name\" value=\"Snack Bar Card\"/>\n-    <string name=\"desc\" value=\"A card that features Snack Bar.\\n#ctem drop rates are increased at Drake&apos;s area#\"/>\n+    <string name=\"desc\" value=\"A card that features Snack Bar.\\n#cItem drop rates are increased at Drake&apos;s area#\"/>\n   </imgdir>\n   <imgdir name=\"2388067\">\n     <string name=\"name\" value=\"Gray Yeti and King Pepe Card\"/>\n@@ -8177,7 +8177,7 @@\n   </imgdir>\n   <imgdir name=\"2388070\">\n     <string name=\"name\" value=\"Prime Minister Mushroom Card\"/>\n-    <string name=\"desc\" value=\"A card featuring the Prime Minister Mushroom.\\n\\cIncreases the item/meso drop rate when used inside the Mushroom Castle.#\"/>\n+    <string name=\"desc\" value=\"A card featuring the Prime Minister Mushroom.\\n#cIncreases the item/meso drop rate when used inside the Mushroom Castle.#\"/>\n   </imgdir>\n   <imgdir name=\"2430013\">\n     <string name=\"name\" value=\"Peng Peng Popsicle\"/>\n@@ -8657,7 +8657,7 @@\n   </imgdir>\n   <imgdir name=\"2290020\">\n     <string name=\"name\" value=\"[Mastery Book] Heaven&apos;s Hammer\"/>\n-    <string name=\"desc\" value=\"This increases the master level of #cHeaven&apos;s Hammer# up to 20 with 70% of chance.\\r\\nClass : Paldain\\r\\nCondition : Skill level above 5\"/>\n+    <string name=\"desc\" value=\"This increases the master level of #cHeaven&apos;s Hammer# up to 20 with 70% of chance.\\r\\nClass : Paladin\\r\\nCondition : Skill level above 5\"/>\n   </imgdir>\n   <imgdir name=\"2290021\">\n     <string name=\"name\" value=\"[Mastery Book] Heaven&apos;s Hammer\"/>"}]}]},
