{"fetchDate": "2019-12-19", "content": [{"sha": "7ee947b4041852b33832d856b464abfe0ceafb8e", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6N2VlOTQ3YjQwNDE4NTJiMzM4MzJkODU2YjQ2NGFiZmUwY2VhZmI4ZQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-10-03T23:01:09Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-10-03T23:01:09Z"}, "message": "Quest progress overview + Raise UI scripting + Shelved events loadout\n\nPerformed a syllabus over quest progress tracking. Quests that were supposed to show up as startable/completable upon achieved progress should be able to do so. Reviewed progress tracking on scripts to adequate to this scenario.\nFixed some scenarios on where quest dialog popups would appear when updating a quest progress.\nFixed some scripts not using updated package addresses after the recent package refactor.\nReviewed Raise UI, no longer rendering players unable to access CS/MTS in certain scenarios.\nFixed a check of available space in inventory, when trying to obtain items from quests, not informing the player it happened due to a one-of-a-kind item already present.\nFixed quest dialog (feature present in many quests) not showing to players when completing it.\nFixed several issues with the Cygnus 1st job advancement quests.\nAdded scripting within Raise UI open action. Mimiana egg uses this to keep track of player's EXP progress.\nFixed pets not getting despawned as expiration takes place.\nFixed hidden players being able to control mobs when either entering map or hidden state.\nFixed estimated HP/MP alert not taking bonuses (such as from buffs or equipments) into account.\nFixed Energy Charge refreshing buff time upon touching mobs, skewing the  uptime of the skill's stat buffs.\nSwitched SnakeYaml for YamlBeans, which makes up for a single JAR artifact.\nRefactored a channel's event scripts loadout, now taking place after the server bootup phase.", "tree": {"sha": "47ad01ccfc74c849cc076ac667cc4f30b9951657", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/47ad01ccfc74c849cc076ac667cc4f30b9951657"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/7ee947b4041852b33832d856b464abfe0ceafb8e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7ee947b4041852b33832d856b464abfe0ceafb8e", "html_url": "https://github.com/ronancpl/HeavenMS/commit/7ee947b4041852b33832d856b464abfe0ceafb8e", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7ee947b4041852b33832d856b464abfe0ceafb8e/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eae6dccbc038c9b0f1556691e1f28dbc370da589", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/eae6dccbc038c9b0f1556691e1f28dbc370da589", "html_url": "https://github.com/ronancpl/HeavenMS/commit/eae6dccbc038c9b0f1556691e1f28dbc370da589"}], "stats": {"total": 5137, "additions": 3269, "deletions": 1868}, "files": [{"sha": "314d71997238ae29062c9d8d49fcefaaf83e76b1", "filename": "config.yaml", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/config.yaml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/config.yaml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/config.yaml?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -174,11 +174,11 @@ server:\n     CHANNEL_LOAD: 100                   #Max players per channel (limit actually used to calculate the World server capacity).\n     CHANNEL_LOCKS: 20                   #Total number of structure management locks each channel has.\n \n-    RESPAWN_INTERVAL: 10000\t  #10 seconds, 10000.\n-    PURGING_INTERVAL: 300000     #5 minutes, 300000.\n-    RANKING_INTERVAL: 3600000\t  #60 minutes, 3600000.\n-    COUPON_INTERVAL: 3600000\t  #60 minutes, 3600000.\n-    UPDATE_INTERVAL: 777              #Dictates the frequency on which the \"centralized server time\" is updated.\n+    RESPAWN_INTERVAL: 10000             #10 seconds, 10000.\n+    PURGING_INTERVAL: 300000            #5 minutes, 300000.\n+    RANKING_INTERVAL: 3600000           #60 minutes, 3600000.\n+    COUPON_INTERVAL: 3600000            #60 minutes, 3600000.\n+    UPDATE_INTERVAL: 777                #Dictates the frequency on which the \"centralized server time\" is updated.\n \n     ENABLE_PIC: false               #Pick true/false to enable or disable Pic. Delete character requires PIC available.\n     ENABLE_PIN: false               #Pick true/false to enable or disable Pin."}, {"sha": "8e059d9711b815b02a6968b893052d86d5a40816", "filename": "cores/jackson-annotations-2.9.9.jar", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-annotations-2.9.9.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-annotations-2.9.9.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/jackson-annotations-2.9.9.jar?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589"}, {"sha": "02bd446ddfb024ea1f49a597984b306e39f661a2", "filename": "cores/jackson-core-2.9.9.jar", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-core-2.9.9.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-core-2.9.9.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/jackson-core-2.9.9.jar?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589"}, {"sha": "5bf4ba88d17e4b4885ff24c9904f392d314b1558", "filename": "cores/jackson-databind-2.9.9.3.jar", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-databind-2.9.9.3.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-databind-2.9.9.3.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/jackson-databind-2.9.9.3.jar?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589"}, {"sha": "36829fc6f902eb9d3d619086381b1afbf1e1392c", "filename": "cores/jackson-dataformat-yaml-2.9.9.jar", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-dataformat-yaml-2.9.9.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/jackson-dataformat-yaml-2.9.9.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/jackson-dataformat-yaml-2.9.9.jar?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589"}, {"sha": "00049850591bb5daded1d3c8b53363eb0db31806", "filename": "cores/snakeyaml-1.25.jar", "status": "removed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/snakeyaml-1.25.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/cores/snakeyaml-1.25.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/snakeyaml-1.25.jar?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589"}, {"sha": "45cac40fe90077e1de3a21d9ed83521876ddc678", "filename": "cores/yamlbeans-1.13.jar", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/cores/yamlbeans-1.13.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/cores/yamlbeans-1.13.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/cores/yamlbeans-1.13.jar?ref=7ee947b4041852b33832d856b464abfe0ceafb8e"}, {"sha": "22b9a22d826cb025768fe64d6f9c1b9d5077b80a", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 38, "deletions": 1, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -2143,4 +2143,41 @@ Adicionado checagem no uso de autopots ao usar HP/MP, limites s\u00e3o calculados ba\n 20 Setembro 2019,\n Adicionado update de macros ao usar SP reset.\n Refatorado v\u00e1rios pacotes Java contendo classes diversificadas.\n-Corrigido nomenclatura err\u00f4nea de \"worker\" introduzida, querendo significar \"task\".\n\\ No newline at end of file\n+Corrigido nomenclatura err\u00f4nea de \"worker\" introduzida, querendo significar \"task\".\n+\n+21 - 24 Setembro 2019,\n+Corrigido ferramenta detectora de m\u00e9todos est\u00e1ticos n\u00e3o realizando varredura completa em arquivos, parando em casos onde um m\u00e9todo est\u00e1tico \u00e9 encontrado em cada.\n+Implementado ferramenta detectora de scripts de quest que estiveram sendo usados como paliativo.\n+Refatorado amplamente m\u00e9todos que lidam com atribui\u00e7\u00e3o de progresso de quests.\n+Revisado uso de v\u00e1rios scripts de quest que estiveram sendo usados como paliativo.\n+Alterado declara\u00e7\u00e3o de \"MapleCharacter c\", considerado amb\u00edguo \u00e0 de MapleClient.\n+Revisado uso de progresso de quests feito pelos scripts, de forma a parear com o novo modelo.\n+\n+26 - 28 Setembro 2019,\n+Corrigido casos no novo modelo onde algumas quests utilizando informa\u00e7\u00f5es de progresso n\u00e3o conseguiriam ser completadas.\n+Corrigido uso envio desnecess\u00e1rio de pacote ao atualizar progresso de quest causando popup inesperado de mensagens de quests para jogadores.\n+Corrigido alguns scripts n\u00e3o levando a atualiza\u00e7\u00e3o dos endere\u00e7os dos pacotes alterados na \u00faltima refatora\u00e7\u00e3o.\n+Corrigido script de quest de Magatia checando errado quantidade de livros adquiridos pelo jogador no progresso de quest.\n+\n+29 Setembro 2019,\n+Revisado Raise UI, agora utilizando o novo sistema de progress\u00e3o.\n+Corrigido checagem por espa\u00e7o no invent\u00e1rio, ao tentar ganhar itens via quest, n\u00e3o informando o jogador adequadamente sobre itens one-of-a-kind.\n+Corrigido uso de itens na Raise UI, quando n\u00e3o atualizando progresso algum (nenhum pacote enviado ao jogador), n\u00e3o permitindo jogador acesso a certos recursos (como Cash Shop/MTS).\n+Revisado aplica\u00e7\u00e3o geral do novo modelo de progress\u00e3o de quests implementado.\n+\n+01 - 02 Outubro 2019,\n+Corrigido caso de exce\u00e7\u00e3o de modifica\u00e7\u00e3o concorrente dentro de m\u00f3dulo de incremento de progresso de mob em quests.\n+Corrigido caixa de di\u00e1logo com conte\u00fado extra, ao terminar uma quest, n\u00e3o sendo enviada ao jogador.\n+Corrigido retransmiss\u00e3o de pacotes de movimentos com sequ\u00eancia vazia crashando outros jogadores.\n+Refatorado checagem por pacotes de movimentos com sequ\u00eancia vazia, agora atuando no m\u00f3dulo abstrato.\n+Corrigido progresso de mobs em quests n\u00e3o atualizando o infoex devidamente ao jogador, levando \u00e0 falta do bal\u00e3o de \"quest completa\".\n+Corrigido quest de 1o job de Cygnus permitindo retornar para estado que tenta concluir quest, permitindo assim m\u00faltiplas inst\u00e2ncias de conclus\u00e3o da mesma.\n+Adicionado scripting atuante ao abrir Raise UI, permitindo assim utilizar a\u00e7\u00f5es elaboradas, tais como EXP de combate para Mimiana.\n+Corrigido pets n\u00e3o sendo despawnados assim que se d\u00e1 o tempo de expira\u00e7\u00e3o.\n+Corrigido jogadores com \"hide\" controlando mobs em certas situa\u00e7\u00f5es.\n+Corrigido an\u00e1lise de alerta de HP/MP lado-servidor n\u00e3o contando com os atributos de HP/MP de equipamentos e buffs.\n+\n+03 Outubro 2019,\n+Corrigido skill \"Energy Charge\" levando atualiza\u00e7\u00e3o de buff ao tocar em mobs, levando a casos onde o buff nos stats poderia inesperadamente ficar retido al\u00e9m do tempo de atua\u00e7\u00e3o previsto.\n+Substitu\u00eddo utiliza\u00e7\u00e3o de \"Jackson annotations + SnakeYaml\" por \"YamlBeans\", utilizando-se assim menos artefatos JARs no processo (anteriormente 5, agora somente 1). Nota: na transi\u00e7\u00e3o, fora constatado que a utiliza\u00e7\u00e3o da tecnologia anterior era mais permissiva perante o arquivo de configura\u00e7\u00f5es, por\u00e9m estrutura do novo arquivo foi normalizado e est\u00e1 agora funcional.\n+Refatorado inicializa\u00e7\u00e3o de eventos ao iniciar o servidor, em busca de melhorar o tempo de startup.\n\\ No newline at end of file"}, {"sha": "4188fc88d476ecf1b0f441ef3e020c1d23ebf261", "filename": "nbproject/project.properties", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/project.properties?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -29,16 +29,12 @@ dist.javadoc.dir=${dist.dir}/javadoc\n endorsed.classpath=\n excludes=\n file.reference.HikariCP-java7-2.4.13.jar=cores/HikariCP-java7-2.4.13.jar\n-file.reference.jackson-annotations-2.9.9.jar=cores/jackson-annotations-2.9.9.jar\n-file.reference.jackson-core-2.9.9.jar=cores/jackson-core-2.9.9.jar\n-file.reference.jackson-databind-2.9.9.3.jar=cores/jackson-databind-2.9.9.3.jar\n-file.reference.jackson-dataformat-yaml-2.9.9.jar=cores/jackson-dataformat-yaml-2.9.9.jar\n file.reference.MapleSolaxia-src=src\n file.reference.mina-core-2.0.19.jar=cores/mina-core-2.0.19.jar\n file.reference.mysql-connector-java-bin.jar=cores/mysql-connector-java-bin.jar\n file.reference.slf4j-api-1.7.21.jar=cores/slf4j-api-1.7.21.jar\n file.reference.slf4j-jdk14-1.7.5.jar=cores/slf4j-jdk14-1.7.5.jar\n-file.reference.snakeyaml-1.25.jar=cores/snakeyaml-1.25.jar\n+file.reference.yamlbeans-1.13.jar=cores/yamlbeans-1.13.jar\n includes=**\n jar.archive.disabled=${jnlp.enabled}\n jar.compress=true\n@@ -49,11 +45,7 @@ javac.classpath=\\\n     ${file.reference.HikariCP-java7-2.4.13.jar}:\\\n     ${file.reference.mysql-connector-java-bin.jar}:\\\n     ${file.reference.slf4j-jdk14-1.7.5.jar}:\\\n-    ${file.reference.jackson-annotations-2.9.9.jar}:\\\n-    ${file.reference.jackson-core-2.9.9.jar}:\\\n-    ${file.reference.jackson-databind-2.9.9.3.jar}:\\\n-    ${file.reference.jackson-dataformat-yaml-2.9.9.jar}:\\\n-    ${file.reference.snakeyaml-1.25.jar}\n+    ${file.reference.yamlbeans-1.13.jar}\n # Space-separated list of extra javac options\n javac.compilerargs=\n javac.deprecation=false"}, {"sha": "33c7422eabc21b9b6baffa26c666d9db5884f8fd", "filename": "scripts/event/BalrogBattle.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/BalrogBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/BalrogBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogBattle.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -244,8 +244,8 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.clearPQ();\n \n-                        eim.dispatchUpdateQuestMobCount(bossMobId, entryMap);\n-                        eim.dispatchUpdateQuestMobCount(9101003, entryMap); // thanks Atoot for noticing quest not getting updated after boss kill\n+                        eim.dispatchRaiseQuestMobCount(bossMobId, entryMap);\n+                        eim.dispatchRaiseQuestMobCount(9101003, entryMap); // thanks Atoot for noticing quest not getting updated after boss kill\n                         mob.getMap().broadcastBalrogVictory(eim.getLeader().getName());\n                 } else {\n                         if(count == 1) {"}, {"sha": "a2b6c03f14a5628782eb1d1b6408fa57884b78b5", "filename": "scripts/event/BalrogBattle_Easy.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/BalrogBattle_Easy.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/BalrogBattle_Easy.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogBattle_Easy.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -244,7 +244,7 @@ function monsterKilled(mob, eim) {\n                         eim.showClearEffect();\n                         eim.clearPQ();\n \n-                        eim.dispatchUpdateQuestMobCount(bossMobId, entryMap);\n+                        eim.dispatchRaiseQuestMobCount(bossMobId, entryMap);\n                         mob.getMap().broadcastBalrogVictory(eim.getLeader().getName());\n                 } else {\n                         if(count == 1) {"}, {"sha": "433d2362416cd889c40f25e8e19a68b80ab1d82a", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -214,7 +214,7 @@ function monsterKilled(mob, eim) {\n         eim.showClearEffect(mob.getMap().getId());\n         eim.clearPQ();\n         \n-        eim.dispatchUpdateQuestMobCount(8810018, 240060200);\n+        eim.dispatchRaiseQuestMobCount(8810018, 240060200);\n         mob.getMap().broadcastHorntailVictory();\n     } else if(isHorntailHead(mob)) {\n         var killed = eim.getIntProperty(\"defeatedHead\");"}, {"sha": "0ef72ad21d733d4fe84857fd2c51a14957581c9d", "filename": "scripts/event/MK_PrimeMinister.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/MK_PrimeMinister.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/event/MK_PrimeMinister.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -52,7 +52,7 @@ function primeMinisterCheck(eim) {\n         var pIter = map.getAllPlayers().iterator();\n         while (pIter.hasNext()) {\n                 var player = pIter.next();\n-                if (player.getQuestStatus(2333) == 1 && player.getAbstractPlayerInteraction().getQuestProgress(2333, mobId) == 0) {\n+                if (player.getQuestStatus(2333) == 1 && player.getAbstractPlayerInteraction().getQuestProgressInt(2333, mobId) == 0) {\n                         return true;\n                 }\n         }"}, {"sha": "f789e5ab3b00019190d37a391649441844f9a5ea", "filename": "scripts/map/onUserEnter/130030000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/130030000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/130030000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/130030000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,5 +21,5 @@\n */\n \n function start(ms) {   \t       \n-\tms.getPlayer().updateQuestInfo(20010, \"1\");\n+\tms.setQuestProgress(20010, 20022, 1);\n }\n\\ No newline at end of file"}, {"sha": "f789e5ab3b00019190d37a391649441844f9a5ea", "filename": "scripts/map/onUserEnter/130030001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/130030001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/130030001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/130030001.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,5 +21,5 @@\n */\n \n function start(ms) {   \t       \n-\tms.getPlayer().updateQuestInfo(20010, \"1\");\n+\tms.setQuestProgress(20010, 20022, 1);\n }\n\\ No newline at end of file"}, {"sha": "51e18daa4b13ef6eca111e778a63316a8819a549", "filename": "scripts/map/onUserEnter/910510000.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/910510000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/910510000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/910510000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,11 +5,11 @@ function start(ms){\n         var map = player.getMap();\n         \n \tif(player.isCygnus()) {\n-                if(ms.isQuestStarted(20730) && ms.getQuestProgress(20730, 9300285) == 0) {\n+                if(ms.isQuestStarted(20730) && ms.getQuestProgressInt(20730, 9300285) == 0) {\n                         map.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(9300285), new java.awt.Point(680, 258));\n                 }\n         } else {\n-                if(ms.isQuestStarted(21731) && ms.getQuestProgress(21731, 9300344) == 0) {\n+                if(ms.isQuestStarted(21731) && ms.getQuestProgressInt(21731, 9300344) == 0) {\n                         map.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(9300344), new java.awt.Point(680, 258));\n                 }\n         }"}, {"sha": "108f8c451c8e0875d77bc6ab24c0dc72382b6d84", "filename": "scripts/map/onUserEnter/914000100.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/914000100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/914000100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/914000100.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,5 +21,5 @@\n */\n \n function start(ms) {   \t       \n-\tms.getPlayer().updateQuestInfo(21000, \"1\");\n+\tms.setQuestProgress(21000, 21002, 1);\n }\n\\ No newline at end of file"}, {"sha": "738b9c75ac7422465059a552eadbf1f36a42035f", "filename": "scripts/map/onUserEnter/925040100.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/925040100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/map/onUserEnter/925040100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onUserEnter/925040100.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -4,7 +4,7 @@ function start(ms){\n         var player = ms.getPlayer();\n         var map = player.getMap();\n         \n-        if(ms.isQuestStarted(21747) && ms.getQuestProgress(21747, 9300351) == 0) {\n+        if(ms.isQuestStarted(21747) && ms.getQuestProgressInt(21747, 9300351) == 0) {\n                 map.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(9300351), new java.awt.Point(897, 51));\n         }\n }\n\\ No newline at end of file"}, {"sha": "5d44d1e5f14dc41e0dbffa6f055908f0757acafb", "filename": "scripts/npc/1012100.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1012100.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1012100.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1012100.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -34,7 +34,7 @@ spawnPnpcFee = 7000000;\n jobType = 3;\n \n function start() {\n-    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -93,7 +93,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "ccea9025d845e49de531f6ec133fd56655b33d19", "filename": "scripts/npc/1022000.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1022000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1022000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1022000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -35,7 +35,7 @@ spawnPnpcFee = 7000000;\n jobType = 1;\n \n function start() {\n-    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -94,7 +94,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "c10656286cbeb0c97bbf89e901242d29981148a3", "filename": "scripts/npc/1032001.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1032001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1032001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1032001.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -35,7 +35,7 @@ spawnPnpcFee = 7000000;\n jobType = 2;\n \n function start() {\n-    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -94,7 +94,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "9ab5b9f37df3637b56c88d5e1605f2998d530f80", "filename": "scripts/npc/1052001.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1052001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1052001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052001.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -34,7 +34,7 @@ spawnPnpcFee = 7000000;\n jobType = 4;\n \n function start() {\n-    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -95,7 +95,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "282cc42fe04dd9066347166d1379cfc7a4f63001", "filename": "scripts/npc/1063012.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1063012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1063012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1063012.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -22,11 +22,11 @@\n var status = -1;\n \n function activateShamanRock(slot,progress) {\n-    var active = (progress >> slot) % 2;\n-    if(!active) {\n-        progress |= (1 << slot);\n+    var ch = progress[slot];\n+    if(ch == '0') {\n+        var nextProgress = progress.substr(0, slot) + '1' + progress.substr(slot + 1);\n         \n-        cm.updateQuest(2236, progress);\n+        cm.setQuestProgress(2236, nextProgress);\n         cm.gainItem(4032263, -1);\n         cm.sendOk(\"The seal took it's place, repelling the evil in the area.\");\n         return 1;\n@@ -45,7 +45,11 @@ function start() {\n         else if(map == 105070000) activateShamanRock(2,progress);\n         \n         else if(map == 105090000) { // workaround... TWO SAME NPC ID ON SAME MAP\n-            if(!activateShamanRock(3,progress)) {\n+            var npcOid = cm.getQuestProgressInt(2236, 1);\n+            if (npcOid == 0) {\n+                activateShamanRock(3,progress);\n+                cm.setQuestProgress(2236, 1, cm.getNpcObjectId());\n+            } else if (cm.getNpcObjectId() != npcOid) {\n                 activateShamanRock(4,progress);\n             }\n         }"}, {"sha": "282cc42fe04dd9066347166d1379cfc7a4f63001", "filename": "scripts/npc/1063013.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1063013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1063013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1063013.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -22,11 +22,11 @@\n var status = -1;\n \n function activateShamanRock(slot,progress) {\n-    var active = (progress >> slot) % 2;\n-    if(!active) {\n-        progress |= (1 << slot);\n+    var ch = progress[slot];\n+    if(ch == '0') {\n+        var nextProgress = progress.substr(0, slot) + '1' + progress.substr(slot + 1);\n         \n-        cm.updateQuest(2236, progress);\n+        cm.setQuestProgress(2236, nextProgress);\n         cm.gainItem(4032263, -1);\n         cm.sendOk(\"The seal took it's place, repelling the evil in the area.\");\n         return 1;\n@@ -45,7 +45,11 @@ function start() {\n         else if(map == 105070000) activateShamanRock(2,progress);\n         \n         else if(map == 105090000) { // workaround... TWO SAME NPC ID ON SAME MAP\n-            if(!activateShamanRock(3,progress)) {\n+            var npcOid = cm.getQuestProgressInt(2236, 1);\n+            if (npcOid == 0) {\n+                activateShamanRock(3,progress);\n+                cm.setQuestProgress(2236, 1, cm.getNpcObjectId());\n+            } else if (cm.getNpcObjectId() != npcOid) {\n                 activateShamanRock(4,progress);\n             }\n         }"}, {"sha": "2255ae3b3c6af2b02838b109ab12aaaa9793c6b6", "filename": "scripts/npc/1090000.js", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1090000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1090000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1090000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -39,8 +39,7 @@ function start() {\n         if (cm.getEventInstance() != null) {    // missing script for skill test found thanks to Lost(tm)\n             advQuest = 5;                       // string visibility thanks to iPunchEm & Glvelturall\n             cm.sendNext(\"Not bad at all. Let's discuss this outside!\");\n-            cm.setQuestProgress(6330, 0, 1);\n-        } else if (cm.getQuestProgress(6330, 0) == 0) {\n+        } else if (cm.getQuestProgressInt(6330, 6331) == 0) {\n             advQuest = 1;\n             cm.sendNext(\"You're ready, right? Now try to withstand my attacks for 2 minutes. I won't go easy on you. Good luck, because you will need it.\");\n         } else {\n@@ -54,8 +53,7 @@ function start() {\n         if (cm.getEventInstance() != null) {\n             advQuest = 6;\n             cm.sendNext(\"Not bad at all. Let's discuss this outside!\");\n-            cm.setQuestProgress(6370, 0, 1);\n-        } else if (cm.getQuestProgress(6370, 0) == 0) {\n+        } else if (cm.getQuestProgressInt(6370, 6371) == 0) {\n             advQuest = 2;\n             cm.sendNext(\"You're ready, right? Now try to withstand my attacks for 2 minutes. I won't go easy on you. Good luck, because you will need it.\");\n         } else {\n@@ -65,7 +63,7 @@ function start() {\n             \n             cm.sendNext(\"Congratulations. You have managed to pass my test. I'll teach you a new skill called \\\"Battleship\\\".\\r\\n\\r\\n  #s5221006#    #b#q5221006##k\");\n         }\n-    } else if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    } else if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -126,6 +124,12 @@ function action(mode, type, selection) {\n                     cm.sendOk(\"Unlike most of the other skills you used as a Pirate, this one definitely is different. You can actually ride the 'Battleship' and attack enemies with it. Your DEF level will increase for the time you're on board, so that'll help you tremendously in combat situations. May you become the best Gunslinger out there...\");\n                 }\n             } else {\n+                if (advQuest < 6) {\n+                    cm.setQuestProgress(6330, 6331, 2);\n+                } else {\n+                    cm.setQuestProgress(6370, 6371, 2);\n+                }\n+\n                 cm.warp(120000101);\n             }\n             \n@@ -138,7 +142,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "ecc9910a7115ad2a45dc2c21142829dbad242ca7", "filename": "scripts/npc/1092019.js", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092019.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -64,7 +64,7 @@ function action(mode, type, selection) {\n                                 cm.sendOk(\"Who are you talking to me? If you're just bored, go bother somebody else.\");\n                                 cm.dispose();\n                         } else {\n-                                seagullProgress = cm.getQuestProgress(6400, 0);\n+                                seagullProgress = cm.getQuestProgressInt(6400, 1);\n                             \n                                 if (seagullProgress == 0) {\n                                         seagullIdx = Math.floor(Math.random() * seagullQuestion.length);\n@@ -90,7 +90,7 @@ function action(mode, type, selection) {\n                                 var answer = cm.getText();\n                                 if (answer == seagullAnswer[seagullIdx]) {\n                                         cm.sendNext(\"What! I can't believe how incredibly smart you are! Incredible! In the seagull world, that kind of intellingence would give you a Ph.D. and then some. You're really amazing... I can't believe it... I simply can't believe it!\");\n-                                        cm.setQuestProgress(6400, 0, 1);\n+                                        cm.setQuestProgress(6400, 1, 1);\n                                         cm.dispose();\n                                 } else {\n                                         cm.sendOk(\"Hmm, that's not quite how I recall it. Try again!\");\n@@ -99,9 +99,11 @@ function action(mode, type, selection) {\n                         } else if (seagullProgress != 2) {\n                                 cm.sendNextPrev(\"Anyway, only one of 9 Barts is the real Bart. You know that Pirates are known for the strength of their friendships and camaraderie with their fellow pirates. If you're a true pirate, you should be able to find your own mate with ease. Alright then, I'll send you to the room where Bart is.\");\n                         } else {\n-                                cm.gainExp(1000000);\n-                                cm.teachSkill(5221003, 0, 10, -1);\n-                                cm.forceCompleteQuest(6400);\n+                                //cm.gainExp(1000000);\n+                                //cm.teachSkill(5221003, 0, 10, -1);\n+                                //cm.forceCompleteQuest(6400);\n+\n+                                cm.sendNextPrev(\"You have met all my challenges, and passed! Good job!\");\n                                 cm.dispose();\n                         }\n                 } else if (status == 3) {"}, {"sha": "6b1cde8950c8a3cc80009838557f6b8f225353de", "filename": "scripts/npc/1092090.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092090.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092090.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092090.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,7 +21,7 @@\n */\n \n function start() {\n-    if(cm.getQuestProgress(2180, 0) == 1) {\n+    if(cm.getQuestProgressInt(2180, 1) == 1) {\n         cm.sendNext(\"You have taken milk from this cow recently, check another cow.\");\n         cm.dispose();\n         return;\n@@ -32,19 +32,19 @@ function start() {\n         cm.gainItem(4031847, -1);\n         cm.gainItem(4031848, 1);\n         \n-        cm.setQuestProgress(2180, 0, 1);\n+        cm.setQuestProgress(2180, 1, 1);\n     } else if (cm.canHold(4031849, 1) && cm.haveItem(4031848)) {\n         cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n         cm.gainItem(4031848, -1);\n         cm.gainItem(4031849, 1);\n         \n-        cm.setQuestProgress(2180, 0, 1);\n+        cm.setQuestProgress(2180, 1, 1);\n     } else if (cm.canHold(4031850) && cm.haveItem(4031849)) {\n         cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n         cm.gainItem(4031849, -1);\n         cm.gainItem(4031850, 1);\n         \n-        cm.setQuestProgress(2180, 0, 1);\n+        cm.setQuestProgress(2180, 1, 1);\n     } else {\n         cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n     }"}, {"sha": "ec40aff0a804a7879f0f1f29aa6216fc28d98dea", "filename": "scripts/npc/1092091.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092091.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1092091.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092091.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,7 +21,7 @@\n */\n \n function start() {\n-    if(cm.getQuestProgress(2180, 0) == 2) {\n+    if(cm.getQuestProgressInt(2180, 1) == 2) {\n         cm.sendNext(\"You have taken milk from this cow recently, check another cow.\");\n         cm.dispose();\n         return;\n@@ -32,19 +32,19 @@ function start() {\n         cm.gainItem(4031847, -1);\n         cm.gainItem(4031848, 1);\n         \n-        cm.setQuestProgress(2180, 0, 2);\n+        cm.setQuestProgress(2180, 1, 2);\n     } else if(cm.canHold(4031849) && cm.haveItem(4031848)){\n         cm.sendNext(\"Now filling up the bottle with milk. The bottle is now 2/3 full of milk.\");\n         cm.gainItem(4031848, -1);\n         cm.gainItem(4031849, 1);\n         \n-        cm.setQuestProgress(2180, 0, 2);\n+        cm.setQuestProgress(2180, 1, 2);\n     } else if(cm.canHold(4031850) && cm.haveItem(4031849)){\n         cm.sendNext(\"Now filling up the bottle with milk. The bottle is now completely full of milk.\");\n         cm.gainItem(4031849, -1);\n         cm.gainItem(4031850, 1);\n         \n-        cm.setQuestProgress(2180, 0, 2);\n+        cm.setQuestProgress(2180, 1, 2);\n     } else {\n         cm.sendNext(\"Your inventory is full, and there's no room for a milk bottle.\");\n     }"}, {"sha": "138d8718530c5faf9de3f8ce66aedc003fcf99c5", "filename": "scripts/npc/1101001.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1101001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1101001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1101001.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -3,7 +3,7 @@\n \tMap(s): \t\tErev\n \tDescription: \t\t3rd job KoC Buff\n */\n-importPackage(Packages.constants);\n+importPackage(Packages.constants.game);\n \n function start() {\n     if (cm.getPlayer().isCygnus() && GameConstants.getJobBranch(cm.getJob()) > 2) {"}, {"sha": "cdeacbd9e725b756b856b3f12cf62c76529d5ba4", "filename": "scripts/npc/1102003.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1102003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1102003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1102003.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -31,7 +31,7 @@ var maxJobType = 15;\n \n function start() {\n     var jobType = parseInt(cm.getJobId() / 100);\n-    if (jobType >= minJobType && jobType <= maxJobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (jobType >= minJobType && jobType <= maxJobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -62,7 +62,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "5a993b03bc7d3e84f7e01a31e99384c23e591cd6", "filename": "scripts/npc/1104201.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1104201.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1104201.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1104201.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -39,7 +39,7 @@ function action(mode, type, selection) {\n                         status--;\n     \n                 if(status == 0) {\n-                        if (!(cm.isQuestCompleted(20407) || cm.isQuestStarted(20407) && cm.getQuestProgress(20407, 9001010) != 0) && cm.getMap().countMonster(9001010) == 0 && cm.getMap().getNPCById(1104002) == null) {\n+                        if (!(cm.isQuestCompleted(20407) || cm.isQuestStarted(20407) && cm.getQuestProgressInt(20407, 9001010) != 0) && cm.getMap().countMonster(9001010) == 0 && cm.getMap().getNPCById(1104002) == null) {\n                                 cm.sendOk(\"... Hnngh... #b#h0##k, is that you...? #r#p1104002##k... She's already here... #b#h0##k, I'm truly sorry I can't help you right now in this state, just when a bigger threat appeared I could do nothing for my people.... Please I beg you, please defeat her, #b#h0##k!! ....\");\n                                 cm.spawnNpc(1104002, new java.awt.Point(850, 0), cm.getMap());\n                         } else {"}, {"sha": "0978526cdfb32ee29029eac76cc7f3f44c9d7d43", "filename": "scripts/npc/1202010.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1202010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1202010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1202010.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,7 +5,7 @@ var spawnPnpcFee = 7000000;\n var jobType = 21;\n \n function start() {\n-    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n+    if (parseInt(cm.getJobId() / 100) == jobType && cm.canSpawnPlayerNpc(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()))) {\n         spawnPnpc = true;\n         \n         var sendStr = \"You have walked a long way to reach the power, wisdom and courage you hold today, haven't you? What do you say about having right now #ra NPC on the Hall of Fame holding the current image of your character#k? Do you like it?\";\n@@ -36,7 +36,7 @@ function action(mode, type, selection) {\n                     return;\n                 }\n                 \n-                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n+                if(Packages.server.life.MaplePlayerNPC.spawnPlayerNPC(Packages.constants.game.GameConstants.getHallOfFameMapid(cm.getJob()), cm.getPlayer())) {\n                     cm.sendOk(\"There you go! Hope you will like it.\");\n                     cm.gainMeso(-spawnPnpcFee);\n                 } else {"}, {"sha": "1856337261995a9df2e56ab660bdd1192af69b26", "filename": "scripts/npc/1209000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1209000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1209000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1209000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -46,7 +46,7 @@ function action(mode, type, selection) {\n \t} else if (status == 2) {\n \t\tcm.sendNext(\"The other heroes? They've left to fight the Black Mage. They're buying us time to escape. What? You want to fight with them? No! You can't! You're hurt. You must leave with us!\");\n \t} else if (status == 3) {\n-\t\tcm.updateQuest(21002, \"1\");\n+\t\t//cm.setQuestProgress(21002, 1);\n \t\tcm.showIntro(\"Effect/Direction1.img/aranTutorial/Trio\");\n \t\tcm.dispose();\n \t}"}, {"sha": "56a7be723b8334c458949924a4379beee394d1ec", "filename": "scripts/npc/1300013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1300013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/1300013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1300013.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -62,7 +62,7 @@ function action(mode, type, selection){\n                         }\n                 }\n         } else {\n-                var questProgress = cm.getQuestProgress(2330, 3300005) + cm.getQuestProgress(2330, 3300006) + cm.getQuestProgress(2330, 3300007); //3 Yetis\n+                var questProgress = cm.getQuestProgressInt(2330, 3300005) + cm.getQuestProgressInt(2330, 3300006) + cm.getQuestProgressInt(2330, 3300007); //3 Yetis\n                 if (!(cm.isQuestStarted(2330) && questProgress < 3)) {  // thanks Vcoc for finding an exploit with boss entry through NPC\n                         cm.dispose();\n                         return;"}, {"sha": "84081ee49cbb4eeb439d1a82601609927ca6bdba", "filename": "scripts/npc/2012027.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012027.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012027.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012027.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);  // infoEx without infoNumber, must use one progress only, critical hit!\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "800c32ada33f412fae02049d8d9a8baa2cc61195", "filename": "scripts/npc/2012028.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012028.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012028.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012028.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "a21b84d4e7fd8bb430086477635a28de83dc8680", "filename": "scripts/npc/2012029.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012029.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012029.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012029.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "e421c02582b58ac579f537ac13b888e20cd54bbc", "filename": "scripts/npc/2012030.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012030.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012030.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012030.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "6f30b9c1510226407c98214975b9912c0782cf34", "filename": "scripts/npc/2012031.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012031.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012031.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012031.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "52e985a9934b1a65dd32980d92812788813fe5f8", "filename": "scripts/npc/2012032.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012032.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012032.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012032.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "aa9ac0d73c0a80282894bdd07ccd33782c29835d", "filename": "scripts/npc/2012033.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012033.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2012033.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2012033.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -50,13 +50,13 @@ function action(mode, type, selection) {\n                         cm.getMap().broadcastMessage(MaplePacketCreator.playSound(\"orbis/\" + harpSounds[cm.getNpc() - 2012027]));\n                         \n                         if(cm.isQuestStarted(3114)) {\n-                                var idx = cm.getQuestProgress(3114, 7777);\n+                                var idx = -1 * cm.getQuestProgressInt(3114);\n                                 \n-                                if(idx != -1) {\n+                                if(idx > -1) {\n                                         var nextNote = harpSong[idx];\n                                         \n                                         if(harpNote != nextNote) {\n-                                                cm.setQuestProgress(3114, 7777, 0);\n+                                                cm.setQuestProgress(3114, 0);\n \n                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/wrong_kor\"));\n                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Failed\"));\n@@ -70,7 +70,7 @@ function action(mode, type, selection) {\n \n                                                         if(idx == 45) {     // finished lullaby\n                                                                 cm.message(\"Twinkle, twinkle, little star, how I wonder what you are.\");\n-                                                                cm.setQuestProgress(3114, 7777, -1);\n+                                                                cm.setQuestProgress(3114, 42);\n \n                                                                 cm.getPlayer().announce(MaplePacketCreator.showEffect(\"quest/party/clear\"));\n                                                                 cm.getPlayer().announce(MaplePacketCreator.playSound(\"Party1/Clear\"));\n@@ -88,7 +88,7 @@ function action(mode, type, selection) {\n                                                         }\n                                                 }\n \n-                                                cm.setQuestProgress(3114, 7777, idx + 1);\n+                                                cm.setQuestProgress(3114, -1 * (idx + 1));\n                                         }\n                                 }\n                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050014.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050014.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050014.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050014.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050015.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050015.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050015.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050015.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050016.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050016.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050017.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050017.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050018.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050018.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "ea93a0b9f853aa250675f51b711247b7aeae4aee", "filename": "scripts/npc/2050019.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2050019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2050019.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,13 +45,13 @@ function action(mode, type, selection) {\n                         if(cm.isQuestStarted(3421)) {\n                                 var meteoriteId = cm.getNpc() - 2050014;\n                                 \n-                                var progress = cm.getQuestProgress(3421, 0);\n+                                var progress = cm.getQuestProgressInt(3421, 1);\n                                 if((progress >> meteoriteId) % 2 == 0 || (progress == 63 && !cm.haveItem(4031117, 6))) {\n                                         if (cm.canHold(4031117, 1)) {\n                                                 progress |= (1 << meteoriteId);\n                                                 \n                                                 cm.gainItem(4031117, 1);\n-                                                cm.setQuestProgress(3421, 0, progress);\n+                                                cm.setQuestProgress(3421, 1, progress);\n                                         } else {\n                                                 cm.getPlayer().dropMessage(1, \"Have a ETC slot available for this item.\");\n                                         }"}, {"sha": "c5d24d199af96a06ae996a2d2e511f92e42236ef", "filename": "scripts/npc/2071012.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2071012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2071012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2071012.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -23,7 +23,7 @@ function action(mode, type, selection) {\n                 status--;\n \n             if(status == 0) {\n-                if(cm.getQuestProgress(23647, 0) != 0) {\n+                if(cm.getQuestProgressInt(23647, 1) != 0) {\n                     cm.dispose();\n                     return;\n                 }\n@@ -39,7 +39,7 @@ function action(mode, type, selection) {\n                 cm.sendNext(\"Teehehee~ That's your reward for taking it from me, serves you well.\");\n                 cm.gainItem(4031793, -1);\n                 cm.gainFame(-5);\n-                cm.setQuestProgress(23647, 0, 1);\n+                cm.setQuestProgress(23647, 1, 1);\n                 \n                 cm.dispose();\n             }"}, {"sha": "d49ae9513ac8822cc44b89859d9811e6b0ee4c38", "filename": "scripts/npc/2081009.js", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2081009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2081009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2081009.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -36,7 +36,7 @@ function action(mode, type, selection) {\n     \n     status++;\n     if(status == 0) {\n-        if(cm.isQuestStarted(6180)) {\n+        if(cm.isQuestStarted(6180) && cm.getQuestProgressInt(6180, 9300096) < 200) {\n             cm.sendYesNo(\"Pay attention: during the time you stay inside the training ground make sure you #bhave equipped your #t1092041##k, it is of the utmost importance. Are you ready to proceed to the training area?\");\n         }\n         \n@@ -47,10 +47,15 @@ function action(mode, type, selection) {\n     }\n     \n     else if(status == 1) {\n-\tcm.warp(924000001, 0);\n-\tcm.sendOk(\"Have your shield equipped until the end of the quest, or else you will need to start all over again!\");\n-        \n-        cm.resetQuestProgress(6180,9300096);\n+        if (cm.getPlayer().haveItemEquipped(1092041)) {\n+            cm.sendNext(\"Have your shield equipped until the end of the quest, or else you will need to start all over again!\");\n+        } else {\n+            cm.sendOk(\"Please equip the #r#t1092041##k before entering the training ground.\");\n+            cm.dispose();\n+        }\n+    }\n+    else {\n+        cm.warp(924000001, 0);\n         cm.dispose();\n     }\n }"}, {"sha": "c72fb2ca9be33e46b7f03ab0d5bb8110d549b032", "filename": "scripts/npc/2091009.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2091009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2091009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2091009.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -27,10 +27,10 @@ function action(mode, type, selection){\n                         return;\n                 }\n \t\tif(cm.getText() == \"Actions speak louder than words\"){\n-\t\t\tif(cm.isQuestStarted(21747) && cm.getQuestProgress(21747, 9300351) == 0)\n+\t\t\tif(cm.isQuestStarted(21747) && cm.getQuestProgressInt(21747, 9300351) == 0)\n \t\t\t\tcm.warp(925040100, 0);\n                         else\n-                                cm.playerMessage(5, \"Although you said the right answer, some mysterious forces is blocking the way in.\");\n+                                cm.playerMessage(5, \"Although you said the right answer, some mysterious forces are blocking the way in.\");\n \n \t\t\tcm.dispose();\n \t\t}"}, {"sha": "035e2e0b94c8f6c60fc2f05b5ab829f8f6392408", "filename": "scripts/npc/2101017.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2101017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2101017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2101017.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -115,7 +115,7 @@ function action(mode, type, selection) {\n                     status = 2;\n                 }\n             }\n-        } else if (Packages.constants.GameConstants.isAriantColiseumArena(cm.getPlayer().getMapId())) {\n+        } else if (Packages.constants.game.GameConstants.isAriantColiseumArena(cm.getPlayer().getMapId())) {\n             if (cm.getPlayer().getMapId() == 980010101) {\n                 exped = MapleExpeditionType.ARIANT;\n                 expedicao = cm.getExpedition(exped);"}, {"sha": "16cde87e598b6626bd2a3c142cd2c82735f703f0", "filename": "scripts/npc/2103000.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,9 +40,9 @@ function action(mode, type, selection) {\n         else\n             status--;\n         if (status == 0 && mode == 1) {\n-                if(cm.isQuestStarted(3900) && cm.getPlayer().getQuestInfo(3900) != 5) {\n+                if(cm.isQuestStarted(3900) && cm.getQuestProgressInt(3900) != 5) {\n                         cm.sendOk(\"#b(You drink the water from the oasis and feel refreshed.)\", 2);\n-                        cm.getPlayer().updateQuestInfo(3900, \"5\");\n+                        cm.setQuestProgress(3900, 5);\n                 } else if(cm.isQuestCompleted(3938)) {\n                         if(cm.canHold(2210005)) {\n                                 if(!cm.haveItem(2210005) && !isTigunMorphed(cm.getPlayer())) {"}, {"sha": "a5a382dfaa11337ac159dc47d0ef6a851192c0f3", "filename": "scripts/npc/2103003.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103003.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3929)) {\n-                            if(cm.getQuestProgress(3929, 0) != 1) {\n-                                if(cm.haveItem(4031580)) {\n-                                    cm.gainItem(4031580, -1);\n-                                    cm.setQuestProgress(3929, 0, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3929);\n+                            var slot = 0;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031580, -1);\n+                                cm.setQuestProgress(3929, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "f78baaaa7e7cef7fb41908ea7a2c39cadca91990", "filename": "scripts/npc/2103004.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103004.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3929)) {\n-                            if(cm.getQuestProgress(3929, 2) != 1) {\n-                                if(cm.haveItem(4031580)) {\n-                                    cm.gainItem(4031580, -1);\n-                                    cm.setQuestProgress(3929, 2, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3929);\n+                            var slot = 2;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031580, -1);\n+                                cm.setQuestProgress(3929, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "1f4915029003520c7f343ccc886e6ab46f7af235", "filename": "scripts/npc/2103005.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103005.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3929)) {\n-                            if(cm.getQuestProgress(3929, 1) != 1) {\n-                                if(cm.haveItem(4031580)) {\n-                                    cm.gainItem(4031580, -1);\n-                                    cm.setQuestProgress(3929, 1, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3929);\n+                            var slot = 1;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031580, -1);\n+                                cm.setQuestProgress(3929, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "d3bddd3a85be393ed8728730f823e38a9ac099c6", "filename": "scripts/npc/2103006.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103006.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3929)) {\n-                            if(cm.getQuestProgress(3929, 3) != 1) {\n-                                if(cm.haveItem(4031580)) {\n-                                    cm.gainItem(4031580, -1);\n-                                    cm.setQuestProgress(3929, 3, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3929);\n+                            var slot = 3;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031580, -1);\n+                                cm.setQuestProgress(3929, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "c8f6c4778793cf2f0564524bee3500869cbe9952", "filename": "scripts/npc/2103009.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103009.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3926)) {\n-                            if(cm.getQuestProgress(3926, 0) != 1) {\n-                                if(cm.haveItem(4031579)) {\n-                                    cm.gainItem(4031579, -1);\n-                                    cm.setQuestProgress(3926, 0, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3926);\n+                            var slot = 0;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031579, -1);\n+                                cm.setQuestProgress(3926, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "9fff919dea64712881eb68f0e491ef943094999a", "filename": "scripts/npc/2103010.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103010.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3926)) {\n-                            if(cm.getQuestProgress(3926, 2) != 1) {\n-                                if(cm.haveItem(4031579)) {\n-                                    cm.gainItem(4031579, -1);\n-                                    cm.setQuestProgress(3926, 2, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3926);\n+                            var slot = 2;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031579, -1);\n+                                cm.setQuestProgress(3926, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "9321a46dc60fa51baa887f630031b5489c1144c9", "filename": "scripts/npc/2103011.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103011.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3926)) {\n-                            if(cm.getQuestProgress(3926, 1) != 1) {\n-                                if(cm.haveItem(4031579)) {\n-                                    cm.gainItem(4031579, -1);\n-                                    cm.setQuestProgress(3926, 1, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3926);\n+                            var slot = 1;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031579, -1);\n+                                cm.setQuestProgress(3926, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "a4f3b17617624d918b9f7786d2cbecdbea8b0e4c", "filename": "scripts/npc/2103012.js", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103012.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,11 +43,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3926)) {\n-                            if(cm.getQuestProgress(3926, 3) != 1) {\n-                                if(cm.haveItem(4031579)) {\n-                                    cm.gainItem(4031579, -1);\n-                                    cm.setQuestProgress(3926, 3, 1);\n-                                }\n+                            var progress = cm.getQuestProgress(3926);\n+                            var slot = 3;\n+                            \n+                            var ch = progress[slot];\n+                            if(ch == '2') {\n+                                var nextProgress = progress.substr(0, slot) + '3' + progress.substr(slot + 1);\n+\n+                                cm.gainItem(4031579, -1);\n+                                cm.setQuestProgress(3926, nextProgress);\n                             }\n                         }\n                     "}, {"sha": "9eddad86c09bdead8416b69fca775d33d071bd16", "filename": "scripts/npc/2103013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2103013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2103013.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -66,7 +66,7 @@ function action(mode, type, selection) {\n \t\t\t} else if (selection == 4) {\n \t\t\t\tcm.sendNext(\"Inside Pharaoh Yeti's Tomb, you can acquire a #e#b#t2022613##k#n by proving yourself capable of defeating the #bPharaoh Jr. Yeti#k, the Pharaoh's clone. Inside that box lies a very special treasure. It is the #e#b#t1132012##k#n.\\r\\n#i1132012:# #t1132012#\\r\\n\\r\\n And if you are somehow able to survive Hell Mode, you will receive the #e#b#t1132013##k#n.\\r\\n\\r\\n#i1132013:# #t1132013#\\r\\n\\r\\n Though, of course, Nett won't allow that to happen.\");\n \t\t\t} else if (selection == 5) {\n-\t\t\t\tvar progress = cm.getQuestProgress(29932);\n+\t\t\t\tvar progress = cm.getQuestProgressInt(29932);\n \t\t\t\tif (progress >= 50000)\n \t\t\t\t\tcm.dispose();\n \t\t\t\telse"}, {"sha": "8b8b43f8de8f4ec14129c66aa1714037b0e7a7b8", "filename": "scripts/npc/2111011.js", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111011.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,25 @@\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "8b8b43f8de8f4ec14129c66aa1714037b0e7a7b8", "filename": "scripts/npc/2111012.js", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111012.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111012.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111012.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,25 @@\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "ab3289b9fff7fbd95c0fa88ad429ce7a617d654c", "filename": "scripts/npc/2111013.js", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111013.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,7 +40,17 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3311)) {\n-                                cm.setQuestProgress(3311, 0, 1);\n+                                var slot = 2;\n+                                var progress = cm.getQuestProgressInt(3311);\n+                                \n+                                if (progress == 4) {\n+                                        progress = 7;\n+                                } else {\n+                                        progress = 5;\n+                                }\n+                                \n+                                cm.setQuestProgress(3311, progress);\n+                                \n                                 cm.sendOk(\"This is a mug picture of Dr. De Lang. It seems he is adorning a locket with the emblem of the Alcadno academy, he is a retainer of the Alcadno society.\", 2);\n                         }\n                     "}, {"sha": "cadbec00ea39725bfe0e452616eec9155ce5bc69", "filename": "scripts/npc/2111014.js", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111014.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111014.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111014.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,7 +40,17 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3311)) {\n-                                cm.setQuestProgress(3311, 1, 1);\n+                                var slot = 0;\n+                                var progress = cm.getQuestProgressInt(3311);\n+                                \n+                                if (progress == 4) {\n+                                        progress = 7;\n+                                } else {\n+                                        progress = 5;\n+                                }\n+                                \n+                                cm.setQuestProgress(3311, progress);\n+                                \n                                 cm.sendOk(\"The diary of Dr. De Lang. A lot of formulas and pompous scientific texts can be found all way through the pages, but it is worth noting that in the last entry (3 weeks ago), it is written that he concluded the researches on an improvement on the blueprints for the Neo Huroids, thus making the last preparations to show it to the 'society'... No words after this...\", 2);\n                         } else if(cm.isQuestStarted(3322) && !cm.haveItem(4031697, 1)) {\n                                 if(cm.canHold(4031697, 1))"}, {"sha": "8b8b43f8de8f4ec14129c66aa1714037b0e7a7b8", "filename": "scripts/npc/2111016.js", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111016.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,25 @@\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.dispose();\n+                }\n+        }\n+}\n\\ No newline at end of file"}, {"sha": "26b4ef159ad5e9c401697d0200d1e78ac3f30541", "filename": "scripts/npc/2111017.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111017.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111017.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111017.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,15 +40,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3339)) {\n-                                var progress = cm.getQuestProgress(3339, 0);\n+                                var progress = cm.getQuestProgressInt(23339, 1);\n                             \n                                 if(progress == 3) {\n                                         cm.sendGetText(\"The pipe reacts as the water starts flowing. A secret compartment with a keypad shows up. #bPassword#k!\");\n                                 } else if(progress == 0) {\n-                                        cm.setQuestProgress(3339, 0, 1);\n+                                        cm.setQuestProgress(23339, 1, 1);\n                                         cm.dispose();\n                                 } else if(progress < 3) {\n-                                        cm.setQuestProgress(3339, 0, 0);\n+                                        cm.setQuestProgress(23339, 1, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.warp(261000001, 1);\n@@ -63,7 +63,7 @@ function action(mode, type, selection) {\n                         }\n                 } else if(status == 1) {\n                         if(cm.getText() == \"my love Phyllia\") {\n-                                cm.setQuestProgress(3339, 0, 4);\n+                                cm.setQuestProgress(23339, 1, 4);\n                                 cm.warp(261000001, 1);\n                                 cm.dispose();\n                         }"}, {"sha": "7bd135dd29aeda8ce9f5c9c6ec6af5d641a4f9c9", "filename": "scripts/npc/2111018.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111018.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,15 +40,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3339)) {\n-                                var progress = cm.getQuestProgress(3339, 0);\n+                                var progress = cm.getQuestProgressInt(23339, 1);\n                             \n                                 if(progress == 3) {\n                                         cm.sendGetText(\"The pipe reacts as the water starts flowing. A secret compartment with a keypad shows up. #bPassword#k!\");\n                                 } else if(progress == 2) {\n-                                        cm.setQuestProgress(3339, 0, 3);\n+                                        cm.setQuestProgress(23339, 1, 3);\n                                         cm.sendGetText(\"The pipe reacts as the water starts flowing. A secret compartment with a keypad shows up. #bPassword#k!\");\n                                 } else if(progress < 3) {\n-                                        cm.setQuestProgress(3339, 0, 0);\n+                                        cm.setQuestProgress(23339, 1, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.warp(261000001, 1);\n@@ -63,7 +63,7 @@ function action(mode, type, selection) {\n                         }\n                 } else if(status == 1) {\n                         if(cm.getText() == \"my love Phyllia\") {\n-                                cm.setQuestProgress(3339, 0, 4);\n+                                cm.setQuestProgress(23339, 1, 4);\n                                 cm.warp(261000001, 1);\n                                 cm.dispose();\n                         }"}, {"sha": "fbceccde4c02e4ee49a16cf7f7717986089b47cd", "filename": "scripts/npc/2111019.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111019.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111019.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111019.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,15 +40,15 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3339)) {\n-                                var progress = cm.getQuestProgress(3339, 0);\n+                                var progress = cm.getQuestProgressInt(23339, 1);\n                             \n                                 if(progress == 3) {\n                                         cm.sendGetText(\"The pipe reacts as the water starts flowing. A secret compartment with a keypad shows up. #bPassword#k!\");\n                                 } else if(progress == 1) {\n-                                        cm.setQuestProgress(3339, 0, 2);\n+                                        cm.setQuestProgress(23339, 1, 2);\n                                         cm.dispose();\n                                 } else if(progress < 3) {\n-                                        cm.setQuestProgress(3339, 0, 0);\n+                                        cm.setQuestProgress(23339, 1, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.warp(261000001, 1);\n@@ -63,7 +63,7 @@ function action(mode, type, selection) {\n                         }\n                 } else if(status == 1) {\n                         if(cm.getText() == \"my love Phyllia\") {\n-                                cm.setQuestProgress(3339, 0, 4);\n+                                cm.setQuestProgress(23339, 1, 4);\n                                 cm.warp(261000001, 1);\n                                 cm.dispose();\n                         }"}, {"sha": "1695c57816ac7a5166891525d097ab53e9cba1b7", "filename": "scripts/npc/2111020.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111020.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111020.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111020.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,13 +40,13 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3345)) {\n-                                var progress = cm.getQuestProgress(3345, 0);\n+                                var progress = cm.getQuestProgressInt(3345);\n                             \n                                 if(progress == 0) {\n-                                        cm.setQuestProgress(3345, 0, 1);\n+                                        cm.setQuestProgress(3345, 1);\n                                         cm.dispose();\n                                 } else if(progress < 4) {\n-                                        cm.setQuestProgress(3345, 0, 0);\n+                                        cm.setQuestProgress(3345, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.dispose();"}, {"sha": "897ab669500c4c0dc0a80a42753c5d217cbc0d39", "filename": "scripts/npc/2111021.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111021.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,13 +40,13 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3345)) {\n-                                var progress = cm.getQuestProgress(3345, 0);\n+                                var progress = cm.getQuestProgressInt(3345);\n                             \n                                 if(progress == 1) {\n-                                        cm.setQuestProgress(3345, 0, 2);\n+                                        cm.setQuestProgress(3345, 2);\n                                         cm.dispose();\n                                 } else if(progress < 4) {\n-                                        cm.setQuestProgress(3345, 0, 0);\n+                                        cm.setQuestProgress(3345, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.dispose();"}, {"sha": "2984e6b75690307361d9c70142d8536f2e0b4bf7", "filename": "scripts/npc/2111022.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111022.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111022.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111022.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,13 +40,13 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3345)) {\n-                                var progress = cm.getQuestProgress(3345, 0);\n+                                var progress = cm.getQuestProgressInt(3345);\n                             \n                                 if(progress == 2) {\n-                                        cm.setQuestProgress(3345, 0, 3);\n+                                        cm.setQuestProgress(3345, 3);\n                                         cm.dispose();\n                                 } else if(progress < 4) {\n-                                        cm.setQuestProgress(3345, 0, 0);\n+                                        cm.setQuestProgress(3345, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.dispose();"}, {"sha": "6daefb0316e32cce5c5dc669ebb7e1e8259f3bbc", "filename": "scripts/npc/2111023.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111023.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2111023.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2111023.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -40,18 +40,18 @@ function action(mode, type, selection) {\n     \n                 if(status == 0) {\n                         if(cm.isQuestStarted(3345)) {\n-                                var progress = cm.getQuestProgress(3345, 0);\n+                                var progress = cm.getQuestProgressInt(3345);\n                             \n                                 if(progress == 3 && cm.haveItem(4031739, 1) && cm.haveItem(4031740, 1) && cm.haveItem(4031741, 1)) {\n-                                        cm.setQuestProgress(3345, 0, 4);\n+                                        cm.setQuestProgress(3345, 4);\n                                         cm.gainItem(4031739, -1);\n                                         cm.gainItem(4031740, -1);\n                                         cm.gainItem(4031741, -1);\n                     \n                                         cm.sendOk(\"(As you place the shards a light shines over the circle, repelling whatever omens were brewing inside the artifact.)\", 2);\n                                         cm.dispose();\n                                 } else if(progress < 4) {\n-                                        cm.setQuestProgress(3345, 0, 0);\n+                                        cm.setQuestProgress(3345, 0);\n                                         cm.dispose();\n                                 } else {\n                                         cm.dispose();"}, {"sha": "3106645572c44966c4857e2204a8083f06efd7f7", "filename": "scripts/npc/2112016.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2112016.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/2112016.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2112016.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -26,15 +26,15 @@\n \n function start() {\n     if(cm.isQuestStarted(3367)) {\n-        var c = cm.getQuestProgress(3367, 30);\n-        if(c == 30) {\n+        var c = cm.getQuestProgressInt(3367, 30);\n+        if(c >= 30) {\n             cm.sendNext(\"(All files have been organized. Report the found files to Yulete.)\", 2);\n             cm.dispose();\n             return;\n         }\n         \n         var book = (cm.getNpcObjectId() % 30);\n-        var prog = cm.getQuestProgress(3367, book);\n+        var prog = cm.getQuestProgressInt(3367, book);\n         if(prog == 0) {\n             c++;\n             \n@@ -45,7 +45,7 @@ function start() {\n                     return;\n                 } else {\n                     cm.gainItem(4031797, 1);\n-                    cm.setQuestProgress(3367, 31, cm.getQuestProgress(3367, 31) + 1);\n+                    cm.setQuestProgress(3367, 31, cm.getQuestProgressInt(3367, 31) + 1);\n                 }\n             }\n             "}, {"sha": "2f30233c038de12abccb6d324723ffa108199975", "filename": "scripts/npc/9201003.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/9201003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/9201003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201003.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -63,7 +63,7 @@ function action(mode, type, selection) {\n                 cm.sendOk(\"Hello we're Mom and Dad...\");\n                 cm.dispose();\n             } else {\n-                if (cm.getQuestProgress(100400, 1) == 0) {\n+                if (cm.getQuestProgressInt(100400, 1) == 0) {\n                     cm.sendNext(\"Mom, dad, I have a request to do to both of you... I wanna know more about the path you've already been walking since always, the path of loving and caring for someone dear to me.\", 2);\n                 } else {\n                     if(!hasProofOfLoves(cm.getPlayer())) {"}, {"sha": "6990389bcdd19473f01a2d6cc9dc72c092b3cc8c", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -77,6 +77,7 @@ function writeFeatureTab_Quests() {\n         addFeature(\"3rd job quiz with all 40-question pool available.\");\n         addFeature(\"Item raising functional.\");\n         addFeature(\"Cleared issue with player movement during NPC talk.\");\n+        addFeature(\"Reviewed usage of quest progress data as requirement.\");\n }\n \n function writeFeatureTab_PlayerSocialNetwork() {"}, {"sha": "eaab5b7a195bca8b455daeb752a84329d37eb546", "filename": "scripts/npc/MagatiaPassword.js", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/MagatiaPassword.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/MagatiaPassword.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/MagatiaPassword.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -19,9 +19,10 @@ function action(mode, type, selection){\n                 cm.sendGetText(\"The door reacts to the entry pass inserted. #bPassword#k!\");\n \t}\n \telse if(status == 1){\n-                if(cm.getText() == cm.getStringQuestProgress(3360, 0)){\n-                        cm.setQuestProgress(3360, 1, 1);\n-                        cm.warp((cm.getMapId() == 261010000) ? 261020200 : 261010000, \"secret00\");\n+                if(cm.getText() == cm.getQuestProgress(3360)){\n+                        cm.setQuestProgress(3360, 1);\n+                        cm.getPlayer().announce(Packages.tools.MaplePacketCreator.playPortalSound());\n+                        cm.warp(261030000, \"sp_\" + ((cm.getMapId() == 261010000) ? \"jenu\" : \"alca\"));\n                 }\n                 else {\n \t\t\tcm.sendOk(\"#rWrong!\");"}, {"sha": "8d3ca921368986a41f2122f92397172d3f99e6cc", "filename": "scripts/npc/PupeteerPassword.js", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/PupeteerPassword.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/PupeteerPassword.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/PupeteerPassword.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -20,7 +20,7 @@ function action(mode, type, selection){\n \tif(status == 0){\n                 if(cm.isQuestStarted(21728)) {\n                         cm.sendOk(\"You search for any hints of the Puppeteer, but it seems a powerful force blocks the path... Better return to #b#p1061019##k.\");\n-                        cm.setQuestProgress(21728, 0, 1);\n+                        cm.setQuestProgress(21728, 21761, 0);\n                         cm.dispose();\n                         return;\n                 }\n@@ -29,12 +29,12 @@ function action(mode, type, selection){\n \t}\n \telse if(status == 1){\n                 if(cm.getText() == \"Francis is a genius Puppeteer!\"){\n-\t\t\tif(cm.isQuestStarted(20730) && cm.getQuestProgress(20730, 9300285) == 0)\n+\t\t\tif(cm.isQuestStarted(20730) && cm.getQuestProgressInt(20730, 9300285) == 0)\n \t\t\t\tcm.warp(910510001, 1);\n-                        else if(cm.isQuestStarted(21731) && cm.getQuestProgress(21731, 9300346) == 0)\n+                        else if(cm.isQuestStarted(21731) && cm.getQuestProgressInt(21731, 9300346) == 0)\n \t\t\t\tcm.warp(910510001, 1);\n \t\t\telse\n-                                cm.playerMessage(5, \"Although you said the right answer, some mysterious forces is blocking the way in.\");\n+                                cm.playerMessage(5, \"Although you said the right answer, some mysterious forces are blocking the way in.\");\n \n \t\t\tcm.dispose();\n \t\t}"}, {"sha": "c55c99071754db3babc9f2ec853da61a1c5e94d3", "filename": "scripts/npc/cpqchallenge.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/cpqchallenge.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/cpqchallenge.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/cpqchallenge.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,7 +5,7 @@\n ---------------------------------------------------------------------------------------------------\n **/\n \n-importPackage(Packages.constants);\n+importPackage(Packages.constants.game);\n \n var status = 0;\n var party;"}, {"sha": "c55c99071754db3babc9f2ec853da61a1c5e94d3", "filename": "scripts/npc/cpqchallenge2.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/cpqchallenge2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/cpqchallenge2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/cpqchallenge2.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,7 +5,7 @@\n ---------------------------------------------------------------------------------------------------\n **/\n \n-importPackage(Packages.constants);\n+importPackage(Packages.constants.game);\n \n var status = 0;\n var party;"}, {"sha": "29db73a8fc2f7c4b20495ac883ab2ece74fd9866", "filename": "scripts/npc/credits.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/credits.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/credits.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/credits.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -93,6 +93,9 @@ function writeServerStaff_OdinMS() {\n }\n \n function writeServerStaff_Contributors() {\n+        addPerson(\"IxianMace\", \"Contributor\");\n+        addPerson(\"Conrad\", \"Contributor\");\n+        addPerson(\"inhyuk\", \"Contributor\");\n         addPerson(\"Jayd\", \"Contributor\");\n         addPerson(\"Dragohe4rt\", \"Contributor\");\n         addPerson(\"Jvlaple\", \"Contributor\");"}, {"sha": "f9587485356f36c648f2c3ff47eacd6fd70af1ed", "filename": "scripts/npc/rank_user.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/rank_user.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/npc/rank_user.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/rank_user.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,7 +21,7 @@\n  * @Author Ronan\n  * Player NPC Ranking System */\n \n-importPackage(Packages.constants);\n+importPackage(Packages.constants.game);\n \n var status;\n  "}, {"sha": "260a8cb2b4ef0dd8a7d67c02067dfbaf02ac7590", "filename": "scripts/portal/TD_MC_enterboss1.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/TD_MC_enterboss1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/TD_MC_enterboss1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_MC_enterboss1.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1,5 +1,5 @@\n function enter(pi) {\n-\tvar questProgress = pi.getQuestProgress(2330, 3300005) + pi.getQuestProgress(2330, 3300006) + pi.getQuestProgress(2330, 3300007); //3 Yetis\n+\tvar questProgress = pi.getQuestProgressInt(2330, 3300005) + pi.getQuestProgressInt(2330, 3300006) + pi.getQuestProgressInt(2330, 3300007); //3 Yetis\n \n \tif(pi.isQuestStarted(2330) && questProgress < 3){\n \t\tpi.openNpc(1300013);"}, {"sha": "0ee32c0ac8f0dde5dfd5750e6d546430fb0fc896", "filename": "scripts/portal/TD_neo_inTree.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/TD_neo_inTree.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/TD_neo_inTree.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_neo_inTree.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -10,7 +10,7 @@ function enter(pi) {\n     \n     for(var i = 0; i < quests.length; i++) {\n         if (pi.isQuestActive(quests[i])) {\n-            if(pi.getQuestProgress(quests[i], mobs[i]) != 0) {\n+            if(pi.getQuestProgressInt(quests[i], mobs[i]) != 0) {\n                 pi.message(\"You already faced Nex. Complete your mission.\");\n                 return false;\n             }"}, {"sha": "466f53f0cd25c24517063422f9ace06b032befbb", "filename": "scripts/portal/enterInfo.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterInfo.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterInfo.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/enterInfo.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1,7 +1,8 @@\n function enter(pi) {\n     var mapobj = pi.getWarpMap(104000004);\n-    if(pi.isQuestActive(21733) && pi.getQuestProgress(21733, 9300345) == 0 && mapobj.countMonsters() == 0) {\n+    if(pi.isQuestActive(21733) && pi.getQuestProgressInt(21733, 9300345) == 0 && mapobj.countMonsters() == 0) {\n         mapobj.spawnMonsterOnGroundBelow(Packages.server.life.MapleLifeFactory.getMonster(9300345), new java.awt.Point(0, 0));\n+        pi.setQuestProgress(21733, 21762, 2);\n     }\n     \n     pi.playPortalSound();"}, {"sha": "e121cc1b5f1fb3dedab7b03f8f497a3ca95acd94", "filename": "scripts/portal/enterMCave.js", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterMCave.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterMCave.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/enterMCave.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -9,8 +9,7 @@ function enter(pi) {\n \t\t\t\n \t\t\tpi.playPortalSound();\n \t\t\tpi.warp(i, \"out00\");\n-\t\t\tpi.getPlayer().updateQuestInfo(21202, \"0\");\n-\t\t\t//pi.getPlayer().announce(Packages.tools.MaplePacketCreator.questProgress(21203, \"21203\"));\n+\t\t\tpi.setQuestProgress(21202, 21203, 0);\n \t\t\treturn true;\n \t\t}\n \t\tpi.message(\"The mirror is blank due to many players recalling their memories. Please wait and try again.\");\n@@ -24,7 +23,7 @@ function enter(pi) {\n \t\t\tspawnMob(-210, 454, 9001013, map);\n \t\t\t\n \t\t\tpi.playPortalSound();\n-\t\t\tpi.getPlayer().updateQuestInfo(21203, \"1\");\n+\t\t\tpi.setQuestProgress(21303, 21203, 1);\n \t\t\tpi.warp(108010701, \"out00\");\n \t\t\treturn true;\n \t\t}"}, {"sha": "e79056d85c75bfb4bac7a912215615d02e6fced1", "filename": "scripts/portal/enterPort.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterPort.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/enterPort.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/enterPort.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -22,7 +22,7 @@\n importPackage(Packages.server.life);\n \n function enter(pi) {\n-\tif(pi.isQuestStarted(21301) && pi.getQuestProgress(21301, 9001013) == 0) {\n+\tif(pi.isQuestStarted(21301) && pi.getQuestProgressInt(21301, 9001013) == 0) {\n \t\tif(pi.getPlayerCount(108010700) != 0) {\n \t\t\tpi.message(\"The portal is blocked from the other side. I wonder if someone is already fighting the Thief Crow?\");\n \t\t\treturn false;"}, {"sha": "67d59554f47efde771cd011f8357406104cbacaf", "filename": "scripts/portal/out_pepeking.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/out_pepeking.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/out_pepeking.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/out_pepeking.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,7 +5,7 @@ function enter(pi) {\n                 eim.dispose();\n         }\n \t\n-\tvar questProgress = pi.getQuestProgress(2330, 3300005) + pi.getQuestProgress(2330, 3300006) + pi.getQuestProgress(2330, 3300007); //3 Yetis\n+\tvar questProgress = pi.getQuestProgressInt(2330, 3300005) + pi.getQuestProgressInt(2330, 3300006) + pi.getQuestProgressInt(2330, 3300007); //3 Yetis\n  \tif(questProgress == 3 && !pi.hasItem(4032388)) {\n  \t\tif(pi.canHold(4032388)){\n  \t\t\tpi.getPlayer().message(\"You have aquired a key to the Wedding Hall. King Pepe must have dropped it.\");"}, {"sha": "983233576998d4e2c0a47bded7e0a823123836a7", "filename": "scripts/portal/q3367in.js", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/q3367in.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/q3367in.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/q3367in.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -19,8 +19,11 @@\n */\n function enter(pi) {\n         if(pi.isQuestStarted(3367)) {\n-                if(pi.getQuestProgress(3367, 31) < pi.getItemQuantity(4031797)) {\n-                    pi.gainItem(4031797, pi.getQuestProgress(3367, 31) - pi.getItemQuantity(4031797));\n+                var booksDone = pi.getQuestProgressInt(3367, 31);\n+                var booksInv = pi.getItemQuantity(4031797);\n+\n+                if(booksInv < booksDone) {\n+                    pi.gainItem(4031797, booksDone - booksInv);\n                 }\n                 \n                 pi.playPortalSound(); pi.warp(926130102, 0);"}, {"sha": "6b8343b7ae73a77d9d1d49e601ccf450b2e74d5c", "filename": "scripts/portal/s4mind_end.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/s4mind_end.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/s4mind_end.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/s4mind_end.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -23,7 +23,7 @@ function enter(pi) {\n         return false;\n     } else {\n         if (pi.isQuestStarted(6410)) {\n-            pi.setQuestProgress(6410, 0, 1);\n+            pi.setQuestProgress(6410, 6411, \"p2\");\n         }\n         \n         pi.playPortalSound();"}, {"sha": "392ec72f4d3d09c1fae8ce20420309576abc659f", "filename": "scripts/portal/secretDoor.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/secretDoor.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/portal/secretDoor.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/secretDoor.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -30,7 +30,8 @@ function enter(pi) {\n         if(pi.isQuestCompleted(3360)) {\n                 return doorCross(pi);\n         } else if(pi.isQuestStarted(3360)) {\n-                if(pi.getQuestProgress(3360, 1) == 0) {\n+                var pw = pi.getQuestProgress(3360);\n+                if(pw.length() > 1) {\n                         pi.openNpc(2111024, \"MagatiaPassword\");\n                         return false;\n                 } else {"}, {"sha": "b43519b843ebdacb76a233a4de734e65252eb620", "filename": "scripts/quest/1021.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/1021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/1021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/1021.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,7 +43,7 @@ function start(mode, type, selection) {\n             status--;\n         \n         if (status == 0)\n-            qm.sendNext(\"Hey, Man~ What's up? Haha! I am Roger who can teach you adorable new Maplers lots of information.\");\n+            qm.sendNext(\"Hey, \" + (qm.getPlayer().getGender() == 0 ? \"Man\" : \"Miss\") + \"~ What's up? Haha! I am Roger who can teach you adorable new Maplers lots of information.\");\n         else if (status == 1)\n             qm.sendNextPrev(\"You are asking who made me do this? Ahahahaha!\\r\\nMyself! I wanted to do this and just be kind to you new travellers.\");\n         else if (status == 2)\n@@ -60,7 +60,7 @@ function start(mode, type, selection) {\n             qm.forceStartQuest();\n             qm.sendNext(\"Surprised? If HP becomes 0, then you are in trouble. Now, I will give you #rRoger's Apple#k. Please take it. You will feel stronger. Open the Item window and double click to consume. Hey, it's very simple to open the Item window. Just press #bI#k on your keyboard.\");\n         } else if (status == 4) {\n-            qm.sendNextPrev(\"Please take all Roger's Apples that I gave you. You will be able to see the HP bar increasing. Please talk to me again when you recover your HP 100%.\");\n+            qm.sendPrev(\"Please take all Roger's Apples that I gave you. You will be able to see the HP bar increasing. Please talk to me again when you recover your HP 100%.\");\n         } else if (status == 5) {\n             qm.showInfo(\"UI/tutorial.img/28\");\n             qm.dispose();\n@@ -91,7 +91,7 @@ function end(mode, type, selection) {\n         else if (status == 1)\n             qm.sendNextPrev(\"Alright! Now that you have learned alot, I will give you a present. This is a must for your travel in Maple World, so thank me! Please use this under emergency cases!\");\n         else if (status == 2)\n-            qm.sendNextPrev(\"Okay, this is all I can teach you. I know it's sad but it is time to say good bye. Well take care if yourself and Good luck my friend!\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n#v2010000# 3 #t2010000#\\r\\n#v2010009# 3 #t2010009#\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 10 exp\");\n+            qm.sendPrev(\"Okay, this is all I can teach you. I know it's sad but it is time to say good bye. Well take care if yourself and Good luck my friend!\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0#\\r\\n#v2010000# 3 #t2010000#\\r\\n#v2010009# 3 #t2010009#\\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 10 exp\");\n         else if (status == 3) {\n             if(qm.isQuestCompleted(1021))\n                 qm.dropMessage(1,\"Unknown Error\");"}, {"sha": "e68d48f35f074c59d42822be22e19a56922f7367", "filename": "scripts/quest/20010.js", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20010.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -5,6 +5,12 @@ function start(mode, type, selection) {\n         qm.sendNext(\"Whoa, whoa! Are you really declining my offer? Well, you'll be able to #blevel-up quicker #kwith our help, so let me know if you change your mind. Even if you've declined a Quest, you can receive the Quest again if you just come and talk to me.\");\n         qm.dispose();\n     } else {\n+        if(mode == 0 && type > 0) {\n+            qm.sendNext(\"Whoa, whoa! Are you really declining my offer? Well, you'll be able to #blevel-up quicker #kwith our help, so let me know if you change your mind. Even if you've declined a Quest, you can receive the Quest again if you just come and talk to me.\");\n+            qm.dispose();\n+            return;\n+        }\n+\n         if (mode == 1)\n             status++;\n         else\n@@ -14,7 +20,7 @@ function start(mode, type, selection) {\n         } else if (status == 1) {\n             qm.sendNextPrev(\"If you want to officially become a part of Cygnus Knights, you must first meet the Empress. She's at the center of this island, accompained by Shinsoo. My brothers and I would like to share with you a few things that are considered #bBasic Knowledge#k in Maple World before you go. Would that be okay?\");\n         } else if (status == 2) {\n-            qm.sendOk(\"Oh, let me warn you that this is a Quest. You may have noticed that NPCs around Maple World occasionally ask you for various favors. A favor of that sort is called a #bQuest#k. You will receive reward items or EXP upon completing Quests, so I strongly suggest you diligently fulfill the favors of Maple NPCs.\");\n+            qm.sendNextPrev(\"Oh, let me warn you that this is a Quest. You may have noticed that NPCs around Maple World occasionally ask you for various favors. A favor of that sort is called a #bQuest#k. You will receive reward items or EXP upon completing Quests, so I strongly suggest you diligently fulfill the favors of Maple NPCs.\");\n         } else if (status == 3) {\n             qm.sendAcceptDecline(\"Would you like to meet #bKizan#k, who can tell you about hunting? You can find Kizan by following the arrow to the left.\");\n         } else if (status == 4) {\n@@ -31,7 +37,7 @@ function end(mode, type, selection) {\n         qm.dispose();\n     } else {\n         if (status == 0) {\n-            qm.sendNext(\"Are you the Noblesse my brother Kimu sent? Nice to meet you! I'm Kizan. I'll give you the reward Kimu asked me to give you. Remember, you can check your Inventory by pressing the #bI key#k. Red potions help you recover HP, and blue ones help recover MP. It's a good idea to learn how to use them beforehand so you'll be ready with them when you're in danger. \\r\\n\\r\\n#fUI/UIWindow.img/Quest/reward# \\r\\n\\r\\n#v2000020# #z2000020# \\r\\n#v2000021# #z2000021# \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0#15 exp\");\n+            qm.sendOk(\"Are you the Noblesse my brother Kimu sent? Nice to meet you! I'm Kizan. I'll give you the reward Kimu asked me to give you. Remember, you can check your Inventory by pressing the #bI key#k. Red potions help you recover HP, and blue ones help recover MP. It's a good idea to learn how to use them beforehand so you'll be ready with them when you're in danger. \\r\\n\\r\\n#fUI/UIWindow.img/Quest/reward# \\r\\n\\r\\n#v2000020# #z2000020# \\r\\n#v2000021# #z2000021# \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0#15 exp\");\n         } else if (status == 1) {\n             if(qm.canHold(2000022) && qm.canHold(2000023)){\n                 if(!qm.isQuestCompleted(21010)) {\t\t"}, {"sha": "be08d1c3fab4671ffe0340f8ce0c555049c7bd95", "filename": "scripts/quest/20011.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20011.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -48,7 +48,7 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendNext(\"Ah, it seems like you've successfully hunted a #o100120#. Pretty simple, right? Regular Attacks may be easy to use, but they are pretty weak. Don't worry, though. #p1102006# will teach you how to use more powerful skills. Wait, let me give you a well-deserved quest reward before you go.\");\n     } else if (status == 1) {\n-    \tqm.sendNextPrev(\"This equipment is for Noblesses. It's much cooler than what you're wearing right now, isn't it? Follow the arrows to your left to meet my younger brother #b#p1102006##k. How about you change into your new Noblesse outfit before you go? \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#i1002869# #t1002869# - 1 \\r\\n#i1052177# #t1052177# - 1 \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 30 exp\");\n+    \tqm.sendPrev(\"This equipment is for Noblesses. It's much cooler than what you're wearing right now, isn't it? Follow the arrows to your left to meet my younger brother #b#p1102006##k. How about you change into your new Noblesse outfit before you go? \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#i1002869# #t1002869# - 1 \\r\\n#i1052177# #t1052177# - 1 \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 30 exp\");\n     } else if (status == 2) {\n         qm.gainItem(1002869, 1);\n         qm.gainItem(1052177, 1);"}, {"sha": "6742172b5e9b34cfefcf74375c1285091501029a", "filename": "scripts/quest/20013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20013.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -52,7 +52,7 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendNext(\"Did you bring me a Building Stone and a Drape? Let's see. Ah, these are just what I need! They indeed are a #t4032267# and a #t4032268#! I'll make you a Chair right away.\");\n     } else if (status == 1) {\n-    \tqm.sendNextPrev(\"Here it is, a #t3010060#. What do you think? Nifty, huh? You can #bquickly recover your HP by sitting in this Chair#k. It will be stored in the #bSet-up#k window in your Inventory, so confirm that you've received the chair and head over to #b#p1102008##k. You'll see him if you keep following the arrow to the left. \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#i3010060# 1 #t3010060# \\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 95 exp\");\n+    \tqm.sendPrev(\"Here it is, a #t3010060#. What do you think? Nifty, huh? You can #bquickly recover your HP by sitting in this Chair#k. It will be stored in the #bSet-up#k window in your Inventory, so confirm that you've received the chair and head over to #b#p1102008##k. You'll see him if you keep following the arrow to the left. \\r\\n\\r\\n#fUI/UIWindow.img/QuestIcon/4/0# \\r\\n#i3010060# 1 #t3010060# \\r\\n#fUI/UIWindow.img/QuestIcon/8/0# 95 exp\");\n     } else if (status == 2) {\n         qm.gainItem(4032267, -1);\n         qm.gainItem(4032268, -1);"}, {"sha": "03e87a5f2fcbcb966328bdd719df2b68b849bae2", "filename": "scripts/quest/20020.js", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20020.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20020.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20020.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,38 @@\n+/*\n+\tNPC Name: \t\tNineheart\n+\tDescription: \t\tQuest - Cygnus movie Intro\n+*/\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    if (mode == -1) {\n+        qm.sendOk(\"Talk to me after you have decided what you really want to do. Whatever you choose, you will not miss out or lose privileges, so don't take this too seriously...\");\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0 || selection == 1) {\n+            qm.sendOk(\"Talk to me after you have decided what you really want to do. Whatever you choose, you will not miss out or lose privileges, so don't take this too seriously...\");\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"I can tell you've worked really hard by seeing that you're already at Level 10. I think it's time now for you to break out as a Nobless and officially become the Knight-in-Training. Before doing that, however, I want to ask you one thing. Have you decided which Knight you'd want to beome?\");\n+        } else if (status == 1) {\n+            qm.sendNextPrev(\"There isn't a single path to becoming a Knight. In fact, there are five of them laid out for you. It's up to you to choose which path you'd like to take, but it should definitely be something you will not regret. That's why... I am offering to show you what you'll look like once you become a Knight.\");\n+        } else if (status == 2) {\n+            qm.sendSimple(\"What do you think? Are you interested in seeing yourself as the leader of the Knights? If you have already decided what kind of Knight you'd like to become, then you won't necessarily have to look at it...\\r\\n\\r\\n#b#L0#Show me how I'd look like as the leader of the Knights.#l ..#b#L1#No, I'm okay.\");\n+        } else if (status == 3) {\n+            qm.sendYesNo(\"Would you like to see for it yourself right now? A short clip will come out soon. Be prepared for what you are about to witness.\");\n+        } else if (status == 4) {\n+            qm.forceStartQuest();\n+            qm.forceCompleteQuest();\n+            //qm.warp(913040100, 0);\n+            qm.dispose();\n+        }\n+    }\n+}"}, {"sha": "a53b48f168d1cba41ce02e509cd2c48b6c825f05", "filename": "scripts/quest/20101.js", "status": "modified", "additions": 24, "deletions": 20, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20101.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6,6 +6,7 @@ importPackage(Packages.client);\n \n var status = -1;\n var jobType = 1;\n+var canTryFirstJob = true;\n \n function end(mode, type, selection) {\n     if (mode == 0) {\n@@ -21,32 +22,35 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Dawn Warrior?\");\n     } else if (status == 1) {\n-        if(!qm.canGetFirstJob(jobType)) {\n-            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rDawn Warrior#k.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (!(qm.canHoldAll([1302077, 1142066]))) {\n-            qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n-            qm.dispose();\n-            return;\n+        if (canTryFirstJob) {\n+            canTryFirstJob = false;\n+            if (qm.getPlayer().getJob().getId() != 1100) {\n+                if(!qm.canGetFirstJob(jobType)) {\n+                    qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rDawn Warrior#k.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                if (!(qm.canHoldAll([1302077, 1142066]))) {\n+                    qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                qm.gainItem(1302077, 1);\n+                qm.gainItem(1142066, 1);\n+                qm.changeJob(MapleJob.DAWNWARRIOR1);\n+                qm.getPlayer().resetStats();\n+            }\n+            qm.forceCompleteQuest();\n         }\n-        \n-    \tqm.sendNext(\"I have just molded your body to make it perfect for a Dawn Warrior. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n-\tif (qm.getPlayer().getJob().getId() != 1100) {\n-\t    qm.gainItem(1302077, 1);\n-\t    qm.gainItem(1142066, 1);\n-\t    qm.changeJob(MapleJob.DAWNWARRIOR1);\n-\t    qm.getPlayer().resetStats();\n-\t}\n-\tqm.forceCompleteQuest();\n+        qm.sendNext(\"I have just molded your body to make it perfect for a Dawn Warrior. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n     } else if (status == 2) {\n     \tqm.sendNextPrev(\"I have also expanded your inventory slot counts for your equipment and etc. inventory. Use those slots wisely and fill them up with items required for Knights to carry.\");\n     } else if (status == 3) {\n     \tqm.sendNextPrev(\"I have also given you a hint of #bSP#k, so open the #bSkill Menu#k to acquire new skills. Of course, you can't raise them at all once, and there are some skills out there where you won't be able to acquire them unless you master the basic skills first.\");\n     } else if (status == 4) {\n-    \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Dawn Warrior, you will lost a portion of your EXP when you run out of HP, okay?\");\n+    \tqm.sendNextPrev(\"Unlike your time as a Noblesse, once you become the Dawn Warrior, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n     } else if (status == 6) {"}, {"sha": "fec8015c50fc1caf6a5bea8c9fab4e9d56243db7", "filename": "scripts/quest/20102.js", "status": "modified", "additions": 24, "deletions": 20, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20102.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20102.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20102.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6,6 +6,7 @@ importPackage(Packages.client);\n \n var status = -1;\n var jobType = 2;\n+var canTryFirstJob = true;\n \n function end(mode, type, selection) {\n     if (mode == 0) {\n@@ -21,32 +22,35 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Blaze Wizard?\");\n     } else if (status == 1) {\n-        if(!qm.canGetFirstJob(jobType)) {\n-            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rBlaze Wizard#k.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (!(qm.canHoldAll([1372043, 1142066]))) {\n-            qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n-            qm.dispose();\n-            return;\n+        if (canTryFirstJob) {\n+            canTryFirstJob = false;\n+            if (qm.getPlayer().getJob().getId() != 1200) {\n+                if(!qm.canGetFirstJob(jobType)) {\n+                    qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rBlaze Wizard#k.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                if (!(qm.canHoldAll([1372043, 1142066]))) {\n+                    qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                qm.gainItem(1372043, 1);\n+                qm.gainItem(1142066, 1);\n+                qm.changeJob(MapleJob.BLAZEWIZARD1);\n+                qm.getPlayer().resetStats();\n+            }\n+            qm.forceCompleteQuest();\n         }\n-        \n-    \tqm.sendNext(\"I have just molded your body to make it perfect for a Blaze Wizard. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n-\tif (qm.getPlayer().getJob().getId() != 1200) {\n-\t    qm.gainItem(1372043, 1);\n-\t    qm.gainItem(1142066, 1);\n-\t    qm.changeJob(MapleJob.BLAZEWIZARD1);\n-\t    qm.getPlayer().resetStats();\n-\t}\n-\tqm.forceCompleteQuest();\n+        qm.sendNext(\"I have just molded your body to make it perfect for a Blaze Wizard. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n     } else if (status == 2) {\n     \tqm.sendNextPrev(\"I have also expanded your inventory slot counts for your equipment and etc. inventory. Use those slots wisely and fill them up with items required for Knights to carry.\");\n     } else if (status == 3) {\n     \tqm.sendNextPrev(\"I have also given you a hint of #bSP#k, so open the #bSkill Menu#k to acquire new skills. Of course, you can't raise them at all once, and there are some skills out there where you won't be able to acquire them unless you master the basic skills first.\");\n     } else if (status == 4) {\n-    \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Blaze Wizard, you will lost a portion of your EXP when you run out of HP, okay?\");\n+    \tqm.sendNextPrev(\"Unlike your time as a Noblesse, once you become the Blaze Wizard, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n     } else if (status == 6) {"}, {"sha": "8aadf16618d69f913387ac6955b23a86bd4ed5d2", "filename": "scripts/quest/20103.js", "status": "modified", "additions": 25, "deletions": 21, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20103.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20103.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20103.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6,6 +6,7 @@ importPackage(Packages.client);\n \n var status = -1;\n var jobType = 3;\n+var canTryFirstJob = true;\n \n function end(mode, type, selection) {\n     if (mode == 0) {\n@@ -21,33 +22,36 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Wind Archer?\");\n     } else if (status == 1) {\n-        if(!qm.canGetFirstJob(jobType)) {\n-            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rWind Archer#k.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (!(qm.canHoldAll([1452051, 1142066]) && qm.canHold(2070000))) {\n-            qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n-            qm.dispose();\n-            return;\n+        if (canTryFirstJob) {\n+            canTryFirstJob = false;\n+            if (qm.getPlayer().getJob().getId() != 1300) {\n+                if(!qm.canGetFirstJob(jobType)) {\n+                    qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rWind Archer#k.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                if (!(qm.canHoldAll([1452051, 1142066]) && qm.canHold(2070000))) {\n+                    qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                qm.gainItem(2060000, 2000);\n+                qm.gainItem(1452051, 1);\n+                qm.gainItem(1142066, 1);\n+                qm.changeJob(MapleJob.WINDARCHER1);\n+                qm.getPlayer().resetStats();\n+            }\n+            qm.forceCompleteQuest();\n         }\n-        \n-    \tqm.sendNext(\"I have just molded your body to make it perfect for a Wind Archer. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n-\tif (qm.getPlayer().getJob().getId() != 1300) {\n-\t    qm.gainItem(2060000, 2000);\n-\t    qm.gainItem(1452051, 1);\n-\t    qm.gainItem(1142066, 1);\n-\t    qm.changeJob(MapleJob.WINDARCHER1);\n-\t    qm.getPlayer().resetStats();\n-\t}\n-\tqm.forceCompleteQuest();\n+        qm.sendNext(\"I have just molded your body to make it perfect for a Wind Archer. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n     } else if (status == 2) {\n     \tqm.sendNextPrev(\"I have also expanded your inventory slot counts for your equipment and etc. inventory. Use those slots wisely and fill them up with items required for Knights to carry.\");\n     } else if (status == 3) {\n     \tqm.sendNextPrev(\"I have also given you a hint of #bSP#k, so open the #bSkill Menu#k to acquire new skills. Of course, you can't raise them at all once, and there are some skills out there where you won't be able to acquire them unless you master the basic skills first.\");\n     } else if (status == 4) {\n-    \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Wind Archer, you will lost a portion of your EXP when you run out of HP, okay?\");\n+    \tqm.sendNextPrev(\"Unlike your time as a Noblesse, once you become the Wind Archer, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n     } else if (status == 6) {"}, {"sha": "2f4ee320c70bb6bd8ea54d7238ac1c3e2afcd9ff", "filename": "scripts/quest/20104.js", "status": "modified", "additions": 25, "deletions": 21, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20104.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20104.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20104.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6,6 +6,7 @@ importPackage(Packages.client);\n \n var status = -1;\n var jobType = 4;\n+var canTryFirstJob = true;\n \n function end(mode, type, selection) {\n     if (mode == 0) {\n@@ -21,33 +22,36 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Night Walker?\");\n     } else if (status == 1) {\n-        if(!qm.canGetFirstJob(jobType)) {\n-            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rNight Walker#k.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (!(qm.canHoldAll([1472061, 1142066]) && qm.canHold(2070000))) {\n-            qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n-            qm.dispose();\n-            return;\n+        if (canTryFirstJob) {\n+            canTryFirstJob = false;\n+            if (qm.getPlayer().getJob().getId() != 1400) {\n+                if(!qm.canGetFirstJob(jobType)) {\n+                    qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rNight Walker#k.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                if (!(qm.canHoldAll([1472061, 1142066]) && qm.canHold(2070000))) {\n+                    qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                qm.gainItem(1472061, 1);\n+                qm.gainItem(2070000, 800);\n+                qm.gainItem(1142066, 1);\n+                qm.changeJob(MapleJob.NIGHTWALKER1);\n+                qm.getPlayer().resetStats();\n+            }\n+            qm.forceCompleteQuest();\n         }\n-        \n-    \tqm.sendNext(\"I have just molded your body to make it perfect for a Night Walker. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n-\tif (qm.getPlayer().getJob().getId() != 1400) {\n-\t    qm.gainItem(1472061, 1);\n-\t    qm.gainItem(2070000, 800);\n-\t    qm.gainItem(1142066, 1);\n-\t    qm.changeJob(MapleJob.NIGHTWALKER1);\n-\t    qm.getPlayer().resetStats();\n-\t}\n-\tqm.forceCompleteQuest();\n+        qm.sendNext(\"I have just molded your body to make it perfect for a Night Walker. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n     } else if (status == 2) {\n     \tqm.sendNextPrev(\"I have also expanded your inventory slot counts for your equipment and etc. inventory. Use those slots wisely and fill them up with items required for Knights to carry.\");\n     } else if (status == 3) {\n     \tqm.sendNextPrev(\"I have also given you a hint of #bSP#k, so open the #bSkill Menu#k to acquire new skills. Of course, you can't raise them at all once, and there are some skills out there where you won't be able to acquire them unless you master the basic skills first.\");\n     } else if (status == 4) {\n-    \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Night Walker, you will lost a portion of your EXP when you run out of HP, okay?\");\n+    \tqm.sendNextPrev(\"Unlike your time as a Noblesse, once you become the Night Walker, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n     } else if (status == 6) {"}, {"sha": "03e933f0191cfdb8f46d399033f64c643e199894", "filename": "scripts/quest/20105.js", "status": "modified", "additions": 24, "deletions": 20, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20105.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20105.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20105.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6,6 +6,7 @@ importPackage(Packages.client);\n \n var status = -1;\n var jobType = 5;\n+var canTryFirstJob = true;\n \n function end(mode, type, selection) {\n     if (mode == 0) {\n@@ -21,32 +22,35 @@ function end(mode, type, selection) {\n     if (status == 0) {\n     \tqm.sendYesNo(\"Have you made your decision? The decision will be final, so think carefully before deciding what to do. Are you sure you want to become a Thunder Breaker?\");\n     } else if (status == 1) {\n-        if(!qm.canGetFirstJob(jobType)) {\n-            qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rThunder Breaker#k.\");\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (!(qm.canHoldAll([1482014, 1142066]))) {\n-            qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n-            qm.dispose();\n-            return;\n+        if (canTryFirstJob) {\n+            canTryFirstJob = false;\n+            if (qm.getPlayer().getJob().getId() != 1500) {\n+                if(!qm.canGetFirstJob(jobType)) {\n+                    qm.sendOk(\"Train a bit more until you reach #blevel 10, \" + qm.getFirstJobStatRequirement(jobType) + \"#k and I can show you the way of the #rThunder Breaker#k.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                if (!(qm.canHoldAll([1482014, 1142066]))) {\n+                    qm.sendOk(\"Make some room in your inventory and talk back to me.\");\n+                    qm.dispose();\n+                    return;\n+                }\n+\n+                qm.gainItem(1482014, 1);\n+                qm.gainItem(1142066, 1);\n+                qm.getPlayer().changeJob(MapleJob.THUNDERBREAKER1);\n+                qm.getPlayer().resetStats();\n+            }\n+            qm.forceCompleteQuest();\n         }\n-        \n-    \tqm.sendNext(\"I have just molded your body to make it perfect for a Thunder Breaker. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n-\tif (qm.getPlayer().getJob().getId() != 1500) {\n-\t    qm.gainItem(1482014, 1);\n-\t    qm.gainItem(1142066, 1);\n-\t    qm.getPlayer().changeJob(MapleJob.THUNDERBREAKER1);\n-\t    qm.getPlayer().resetStats();\n-\t}\n-\tqm.forceCompleteQuest();\n+        qm.sendNext(\"I have just molded your body to make it perfect for a Thunder Breaker. If you wish to become more powerful, use Stat Window (S) to raise the appropriate stats. If you aren't sure what to raise, just click on #bAuto#k.\");\n     } else if (status == 2) {\n     \tqm.sendNextPrev(\"I have also expanded your inventory slot counts for your equipment and etc. inventory. Use those slots wisely and fill them up with items required for Knights to carry.\");\n     } else if (status == 3) {\n     \tqm.sendNextPrev(\"I have also given you a hint of #bSP#k, so open the #bSkill Menu#k to acquire new skills. Of course, you can't raise them at all once, and there are some skills out there where you won't be able to acquire them unless you master the basic skills first.\");\n     } else if (status == 4) {\n-    \tqm.sendNextPrev(\"Unlike your time as a Nobless, once you become the Thunder Breaker, you will lost a portion of your EXP when you run out of HP, okay?\");\n+    \tqm.sendNextPrev(\"Unlike your time as a Noblesse, once you become the Thunder Breaker, you will lost a portion of your EXP when you run out of HP, okay?\");\n     } else if (status == 5) {\n     \tqm.sendNextPrev(\"Now... I want you to go out there and show the world how the Knights of Cygnus operate.\");\n     } else if (status == 6) {"}, {"sha": "045fadc608b94b75270693b48ee9508cc526751d", "filename": "scripts/quest/20514.js", "status": "added", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20514.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/20514.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/20514.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,52 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+// @Author Ronan\n+\n+importPackage(Packages.constants.game);\n+importPackage(Packages.server);\n+\n+function raiseOpen() {\n+    var chr = qm.getPlayer();\n+    var questStatus = chr.getQuestStatus(qm.getQuest());\n+\n+    if (questStatus == 0) {\n+        qm.setQuestProgress(20515, 0, chr.getLevel());\n+        qm.setQuestProgress(20515, 1, chr.getExp());\n+    } else if (questStatus == 1) {  // update mimiana progress...\n+        var diffExp = chr.getExp() - qm.getQuestProgressInt(20515, 1);\n+\n+        var initLevel = qm.getQuestProgressInt(20515, 0);\n+        for (var i = initLevel; i < chr.getLevel(); i++) {\n+            diffExp += ExpTable.getExpNeededForLevel(i);\n+        }\n+        \n+        if (diffExp > 0) {  // thanks IxianMace for noticing Mimiana egg not following progress by EXP\n+            var consItem = MapleItemInformationProvider.getInstance().getQuestConsumablesInfo(4220137);\n+            var exp = consItem.exp;\n+            var grade = consItem.grade;\n+            \n+            qm.setQuestProgress(20514, 0, Math.min(diffExp, exp * grade));\n+        }\n+    }\n+\n+    qm.dispose();\n+}\n+"}, {"sha": "41e90b07a022d8fd33f2e078ad24244a6cded340", "filename": "scripts/quest/2236.js", "status": "removed", "additions": 0, "deletions": 63, "changes": 63, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/2236.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/2236.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2236.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,63 +0,0 @@\n-/* ===========================================================\n-\t\t\tRonan Lana\n-\tNPC Name: \t\tChrishrama\n-\tDescription: \tQuest -  How to Shoo Away the Evil\n-=============================================================\n-Version 1.0 - Script Done.(20/3/2017)\n-=============================================================\n-*/\n-\n-var status = -1;\n-var canStart;\n-\n-function start(mode, type, selection) {\n-    status++;\n-\tif (mode != 1) {\n-\t    if(type == 1 && mode == 0)\n-\t\t    status -= 2;\n-\t\telse{\n-\t\t\tqm.sendOk(\"If we don't place these Charms on the Shaman Rocks, evil might awaken...\");\n-                        canStart = false;\n-                        status = 0;\n-\t\t\treturn;\n-\t\t}\n-\t}\n-\tif (status == 0) {\n-\t\tqm.sendAcceptDecline(\"I can feel the forces of evil. They're deep inside the dungeon and they're very, very powerful. If we want to drive the evil away from this place, we must place Charms on the Shaman Rocks inside the dungeon. Will you do that for me?\");\n-                canStart = true;\n-\t} else if (status == 1) {\n-                if (canStart) {\n-                        qm.sendOk(\"Take these Charms and place them on the Shaman Rocks in the dungeon. I'm giving you a total of 6 Charms.\");\n-                } else {\n-                        qm.dispose();\n-                }\n-\t} else {\n-                qm.forceStartQuest();\n-                \n-                if(qm.haveItem(4032263)) qm.gainItem(4032263, -6);\n-\t\tqm.gainItem(4032263, 6);\n-                \n-\t\tqm.dispose();\n-        }\n-}\n-\n-function end(mode, type, selection) {\n-\tstatus++;\n-\n-\tif(status == 0) {\n-\t\tif(qm.getQuestProgress(2236) == 63) {\t//111111\n-\t\t\tqm.sendOk(\"I, too, felt it. The force of the Shaman Rocks began to overpower the forces of evil. I think Sleepywood is safe now. The evil has been eliminated.\");\n-\t\t\tqm.gainExp(60000);\n-\t\t\tqm.forceCompleteQuest();\n-\t\t}\n-\t\telse {\n-\t\t\tif(qm.haveItem(4032263)) qm.gainItem(4032263, -6);\n-\t\t\tqm.gainItem(4032263, 6);\n-\n-\t\t\tqm.sendOk(\"Oh, not good. I still sense bad omens coming from the interior. Here, take these charms and seal them at the Shaman Rocks. We are counting on you.\");\n-\t\t\tqm.updateQuest(2236, 0);\n-\t\t}\n-\t} else if (status == 1) {\n-\t\tqm.dispose();\n-        }\n-}\n\\ No newline at end of file"}, {"sha": "e3e02b116f899717e30e17f738aa4e24adf88d0a", "filename": "scripts/quest/2251.js", "status": "removed", "additions": 0, "deletions": 38, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/2251.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/2251.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2251.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,38 +0,0 @@\n-/*\n-\tAuthor: Kevin\n-\tQuest: Zombie Mushroom Signal 3 (2251)\n-\tNPC: The Rememberer (1061011)\n-\tItem: Recording Charm (4032399)\n-*/\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            if(!qm.haveItem(4032399, 20)) {\n-                qm.sendOk(\"Please bring me 20 #b#t4032399##k...  #i4032399#\");\n-            }\n-            else {\n-                qm.gainItem(4032399, -20);\n-                qm.sendOk(\"Oh, you brought 20 #b#t4032399##k! Thank you.\");\n-                qm.gainExp(8000);\n-                qm.forceCompleteQuest();\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n-        }\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "6a99207e6d3238f88a6a4813943bb3f53db43f35", "filename": "scripts/quest/2260.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/2260.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/2260.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/2260.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -18,7 +18,7 @@\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n \n-importPackage(Packages.constants);\n+importPackage(Packages.constants.game);\n \n var status = -1;\n "}, {"sha": "46883d9ee5e4bc58dd42a64d6f973ef7a99f17bc", "filename": "scripts/quest/3114.js", "status": "removed", "additions": 0, "deletions": 62, "changes": 62, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3114.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3114.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3114.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,62 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            if(qm.getQuestProgress(3114, 7777) != -1) {\n-                if(!qm.haveItem(4161036, 1)) {\n-                    if(qm.canHold(4161036, 1)) {\n-                        qm.gainItem(4161036, 1);\n-                        qm.sendNext(\"Seems you lost a book with the notes to Little Star. Here is another one. Please play it for me.\", 9);\n-                    } else {\n-                        qm.sendNext(\"Seems you lost a book with the notes to Little Star, but you don't have an ETC available. Please free some room.\", 9);\n-                    }\n-                } else {\n-                    qm.sendNext(\".....\", 9);\n-                }\n-                \n-                qm.dispose();\n-                return;\n-            }\n-            \n-            qm.sendNext(\"(Eliza seems to be in deep sleep.)\", 3);\n-        } else if (status == 1) {\n-            qm.gainFame(20);\n-            \n-            qm.forceCompleteQuest();\n-            qm.dispose();\n-        }\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "572eb80bc424d67a97fcc52978909d225f83e8f7", "filename": "scripts/quest/3311.js", "status": "removed", "additions": 0, "deletions": 49, "changes": 49, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3311.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3311.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3311.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,49 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            if(qm.getQuestProgress(3311, 0) == 1 && qm.getQuestProgress(3311, 1) == 1) {\n-                qm.sendNext(\"Hmm, so the Alcadno doctor wrote something about researching some vanguardist Neo Huroid machine, that could beat by far the existing one, and was about to prepare the last steps of his rehearsal? We don't have a word about him for about three weeks now, something must have gone wrong...\");\n-                qm.gainExp(60000);\n-                qm.forceCompleteQuest();\n-            } else {\n-                qm.sendNext(\"Found nothing yet? Please check out Dr. De Lang's house properly, something there may give out a clue about what is going on.\");\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n-        }\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "78496c6381b70c4f8d14ac81b3c2e9847dae2a4b", "filename": "scripts/quest/3360.js", "status": "modified", "additions": 4, "deletions": 24, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3360.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3360.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3360.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -24,6 +24,7 @@\n \tDescription: \t\tQuest - Verifying the password\n */\n var status = -1;\n+var pass;\n \n function start(mode, type, selection) {\n     if (mode == -1) {\n@@ -47,37 +48,16 @@ function start(mode, type, selection) {\n \t} else if (status == 1) {\n \t    qm.sendAcceptDecline(\"All right, now, this key is very long and complex. I need you to memorize it very well. I won't say again, so you'd better write it down somewhere. Are you ready?\");\n \t} else if (status == 2) {\n-\t    var pass = generateString();\n+\t    pass = generateString();\n \t    qm.sendOk(\"The key code is #b\" + pass + \"#k. Got that? Put the key into the door of the secret passage, and you will be able to walk around the passage freely.\");\n-\t    qm.forceStartQuest();\n-            qm.setStringQuestProgress(3360, 0, pass);\n \t} else if (status == 3) {\n+            qm.forceStartQuest();\n+            qm.setQuestProgress(3360, pass);\n \t    qm.dispose();\n \t}\n     }\n }\n \n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-\tqm.dispose();\n-    } else {\n-\tif (mode == 1)\n-\t    status++;\n-\telse\n-\t    status--;\n-\tif (status == 0) {\n-            if(qm.getQuestProgress(3360, 1) == 0) {\n-                qm.sendNext(\"What's up? You haven't opened the Secret Passage yet?\");\n-            } else {\n-                qm.forceCompleteQuest();\n-                qm.dispose();\n-            }\n-\t} else if (status == 1) {\n-            qm.dispose();\n-        }\n-    }\n-}\n-\n function generateString() {\n     var thestring = \"\";\n     var chars = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";"}, {"sha": "4f8ab2905d1532b7d4f905f3dc6356474bcd3233", "filename": "scripts/quest/3523.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3523.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3523.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3523.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1); // thanks resinate for pointing out uncompletable quest due to non-updated progress\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "4b740dd36b18c84fa464451ac52fd6951e613adc", "filename": "scripts/quest/3524.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3524.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3524.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3524.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "97bbae92c7ce8e702f420dbbdc144097ff147331", "filename": "scripts/quest/3525.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3525.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3525.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3525.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "77b49a7ce107915898a38d19b3044025fba8ea03", "filename": "scripts/quest/3526.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3526.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3526.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3526.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "ce28f770f0ffad7c104ed96b4b9b3f08bb6d4344", "filename": "scripts/quest/3527.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3527.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3527.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3527.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "0c7d0eccef0dbc045e4eda50fb5fabb48160d935", "filename": "scripts/quest/3529.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3529.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3529.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3529.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -36,8 +36,9 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n-        } else if (status == 1) {\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.forceCompleteQuest();\n+        } else if (status == 1) {\n             qm.dispose();\n         }\n     }"}, {"sha": "ce28f770f0ffad7c104ed96b4b9b3f08bb6d4344", "filename": "scripts/quest/3539.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3539.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/3539.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3539.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,7 +41,7 @@ function start(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.startQuest();\n-            //qm.getPlayer().updateQuestInfo(3507, \"1\");\n+            qm.setQuestProgress(3507, 7081, 1);\n             qm.completeQuest();\n             qm.sendOk(\"You have regained your memories, talk to #b#p2140001##k to get the pass.\");\n         } else if (status == 1) {"}, {"sha": "dce1ce974a5eb9811b5d6514f0184c80c262e81a", "filename": "scripts/quest/3926.js", "status": "removed", "additions": 0, "deletions": 59, "changes": 59, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3926.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3926.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3926.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,59 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-/* Screwing the Red Scorpions\n- */\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            var c = 0;\n-            \n-            for(var i = 0; i < 4; i++) {\n-                if(qm.getQuestProgress(3926, i) == 1) {\n-                    c++;\n-                }\n-            }\n-            \n-            if(c == 4) {\n-                qm.sendNext(\"You delivered all the jewels, well done!\");\n-                qm.gainExp(6500);\n-                qm.forceCompleteQuest();\n-            } else {\n-                qm.sendNext(\"Have you brought all the jewels from the Red Scorpions? They have to be delivered to the Residential areas of the Sand Bandits.\");\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n-        }\n-    }\n-}"}, {"sha": "5fb43191803d585e7b1fac8a81a8374cf4733935", "filename": "scripts/quest/3927.js", "status": "removed", "additions": 0, "deletions": 71, "changes": 71, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3927.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3927.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3927.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,71 +0,0 @@\n-/*\n-\tThis file is part of the OdinMS Maple Story Server\n-    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n-\t\t       Matthias Butz <matze@odinms.de>\n-\t\t       Jan Christian Meyer <vimes@odinms.de>\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-/*\t\n-\tAuthor : Ronan Lana\n-*/\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if (mode == 0 && status == 0) {\n-            qm.dispose();\n-            return;\n-        }\n-\n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        \n-        if(qm.getQuestProgress(3927) == 0) {    // didn't find the wall yet, eh?\n-            qm.sendOk(\"Did you find the wall? Look closely, the wall is more near than you think!\");\n-            qm.dispose();\n-            return;\n-        }\n-\n-        if (status == 0) {\n-            qm.sendSimple(\"Did you find the wall?\\r\\n#L0##b I did, but... I have no idea what it's talking about.#l\");\n-        } else if (status == 1) {\n-            qm.sendSimple(\"What did it say?\\r\\n#L0##b 'If I had an iron hammer and a dagger, a bow and an arrow...'#l\\r\\n#L1# 'Byron S2 Sirin'#l\\r\\n#L2# 'Ahhh I forgot.'\");\n-        } else if (status == 2) {\n-            if(selection == 0) {\n-                qm.sendOk(\"If I had an iron hammer and a dagger... a bow and an arrow... what does that mean? Do you want me to tell you? I don't know myself. It's something you should think about. If you need a clue... it would go something like... a weapon is just an item... until someone uses it...?\");\n-            } else if(selection == 1) {\n-                qm.sendOk(\"Man, Jiyur wrote on the wall again! Arrgh!!\");\n-                qm.dispose();\n-                return;\n-            } else {\n-                qm.sendOk(\"What? You forgot? Do you remember where it was written?\");\n-                qm.dispose();\n-                return;\n-            }\n-        } else if (status == 3) {\n-            qm.gainExp(1000);\n-            qm.forceCompleteQuest();\n-            qm.dispose();\n-        }\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "26b254eba33caab547b0f69fbc5c47ef771fff3e", "filename": "scripts/quest/3929.js", "status": "removed", "additions": 0, "deletions": 70, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3929.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/3929.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/3929.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,70 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-/* Sejan's Test\n-\tFood delivery on Ariant\n- */\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            var c = 0;\n-            \n-            for(var i = 0; i < 4; i++) {\n-                if(qm.getQuestProgress(3929, i) == 1) {\n-                    c++;\n-                }\n-            }\n-            \n-            if(c == 4) {\n-                qm.sendNext(\"You delivered all the food, good.\");\n-                qm.gainExp(2000);\n-                qm.forceCompleteQuest();\n-            } else {\n-                var missed = (4 - qm.getItemQuantity(4031580)) - c;\n-                if(missed > 0) {\n-                    if(qm.canHold(4031580, missed)) {\n-                        qm.gainItem(4031580, missed);\n-                        qm.sendNext(\"Hey, what are you trying to pull on? To pass my test you must deliver all the foods to the Residential areas.\");\n-                    } else {\n-                        qm.sendNext(\"You don't completed the task, neither has slots available on the inventory to get the food. Free a slot on your ETC please.\");\n-                    }\n-                } else {\n-                    qm.sendNext(\"Hey, what are you trying to pull on? To pass my test you must to deliver all the foods to the Residential areas.\");\n-                }\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n-        }\n-    }\n-}"}, {"sha": "8016d8279b6ae482f0c1fb715fc6c1b8b498921a", "filename": "scripts/quest/6033.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/6033.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/quest/6033.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/6033.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,8 +41,8 @@ function end(mode, type, selection) {\n         if (status == 0) {\n             qm.sendNext(\"Hm, so you claim to have brought the #b#t4260003##k? Ok, let's take a look into it.\");\n         } else if (status == 1) {\n-            if(qm.getQuestProgress(6033) == 1 && qm.haveItem(4260003, 1)) {\n-                qm.sendNext(\"You indeed have crafted a fine piece of Monster Crystal, I see. You passed! Now, I shall teach you the next steps of the Maker skill. Keep the monster crystal with you as well, it's your work.\");\n+            if(qm.getQuestProgressInt(6033) == 1 && qm.haveItem(4260003, 1)) {\n+                qm.sendNextPrev(\"You indeed have crafted a fine piece of Monster Crystal, I see. You passed! Now, I shall teach you the next steps of the Maker skill. Keep the monster crystal with you as well, it's your work.\");\n             } else {\n                 qm.sendNext(\"Hey, what's wrong? I did tell you to make a monster crystal to pass my test, didn't I? Buying one or crafting before the start of the test is NOT part of the deal. Go craft me an #b#t4260003##k.\");\n                 qm.dispose();"}, {"sha": "cf9ae4054a1809af99c7bcaa8efdd22e31b7882f", "filename": "scripts/quest/6410.js", "status": "removed", "additions": 0, "deletions": 57, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/6410.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/eae6dccbc038c9b0f1556691e1f28dbc370da589/scripts/quest/6410.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/6410.js?ref=eae6dccbc038c9b0f1556691e1f28dbc370da589", "patch": "@@ -1,57 +0,0 @@\n-/*\n-    This file is part of the HeavenMS MapleStory Server\n-    Copyleft (L) 2016 - 2018 RonanLana\n-\n-    This program is free software: you can redistribute it and/or modify\n-    it under the terms of the GNU Affero General Public License as\n-    published by the Free Software Foundation version 3 as published by\n-    the Free Software Foundation. You may not use, modify or distribute\n-    this program under any other version of the GNU Affero General Public\n-    License.\n-\n-    This program is distributed in the hope that it will be useful,\n-    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-    GNU Affero General Public License for more details.\n-\n-    You should have received a copy of the GNU Affero General Public License\n-    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-*/\n-/* \n-\tHypnotize skill quest\n- */\n-\n-var status = -1;\n-\n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            if (qm.getQuestProgress(6410, 0) == 0) {\n-                qm.sendOk(\"You must save #r#p2095000##k first!\");\n-                qm.dispose();\n-            } else {\n-                qm.sendNext(\"Again, thank you so much for rescuing me. I don't know how to repay you for all this... both Shulynch and you are the nicest people I have encountered. If you approach the mobs the same way you approached me, they may all end up becoming friends with you, as well. Please never lose the kindness you have in you.\");\n-            }\n-        } else if (status == 1) {\n-            qm.sendNext(\"(Friends with the mobs... never lose the kindness.)\\r\\n\\r\\n  #s5221009#    #b#q5221009##k\");\n-        } else if (status == 2) {\n-            qm.gainExp(1200000);\n-            qm.teachSkill(5221009, 0, 10, -1);\n-            \n-            qm.forceCompleteQuest();\n-            qm.dispose();\n-        }\n-    }\n-}\n\\ No newline at end of file"}, {"sha": "915458338b4886ebda4848f7679130af1547bc34", "filename": "scripts/reactor/1209000.js", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/reactor/1209000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/scripts/reactor/1209000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1209000.js?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -24,6 +24,10 @@\n */\n \n function act() {    // string visibility thanks to ProXAIMeRx & Glvelturall\n-    if (rm.isQuestStarted(6400)) rm.setQuestProgress(6400, 0, 2);\n-    rm.message(\"Real Bart has found. Return to Jonathan through portal.\");\n+    if (rm.isQuestStarted(6400)) {\n+        rm.setQuestProgress(6400, 1, 2);\n+        rm.setQuestProgress(6400, 6401, \"q3\");\n+    }\n+    \n+    rm.message(\"Real Bart has been found. Return to Jonathan through the portal.\");\n }\n\\ No newline at end of file"}, {"sha": "43ad05aaeb035b44213cc09221757dc1fe4a563f", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 122, "deletions": 123, "changes": 245, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -946,6 +946,11 @@ public void Hide(boolean hide, boolean login) {\n                 for(MapleSummon ms: this.getSummonsValues()) {\n                     getMap().broadcastNONGMMessage(this, MaplePacketCreator.spawnSummon(ms, false), false);\n                 }\n+                \n+                for (MapleMapObject mo : this.getMap().getMonsters()) {\n+                    MapleMonster m = (MapleMonster) mo;\n+                    m.aggroUpdateController();\n+                }\n             } else {\n                 this.hidden = true;\n                 announce(MaplePacketCreator.getGMEffect(0x10, (byte) 1));\n@@ -3050,6 +3055,11 @@ public void run() {\n                                         deletedCoupon = true;\n                                     }\n                                 } else {\n+                                    MaplePet pet = item.getPet();   // thanks Lame for noticing pets not getting despawned after expiration time\n+                                    if (pet != null) {\n+                                        unequipPet(pet, true);\n+                                    }\n+                                    \n                                     if (ItemConstants.isExpirablePet(item.getItemId())) {\n                                         client.announce(MaplePacketCreator.itemExpired(item.getItemId()));\n                                         toberemove.add(item);\n@@ -4711,17 +4721,21 @@ public AbstractPlayerInteraction getAbstractPlayerInteraction() {\n         return client.getAbstractPlayerInteraction();\n     }\n     \n-    public final List<MapleQuestStatus> getCompletedQuests() {\n+    private List<MapleQuestStatus> getQuests() {\n         synchronized (quests) {\n-            List<MapleQuestStatus> ret = new LinkedList<>();\n-            for (MapleQuestStatus q : quests.values()) {\n-                if (q.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n-                    ret.add(q);\n-                }\n+            return new ArrayList<>(quests.values());\n+        }\n+    }\n+    \n+    public final List<MapleQuestStatus> getCompletedQuests() {\n+        List<MapleQuestStatus> ret = new LinkedList<>();\n+        for (MapleQuestStatus qs : getQuests()) {\n+            if (qs.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n+                ret.add(qs);\n             }\n-            \n-            return Collections.unmodifiableList(ret);\n         }\n+\n+        return Collections.unmodifiableList(ret);\n     }\n     \n     public List<MapleRing> getCrushRings() {\n@@ -5780,19 +5794,19 @@ public final byte getQuestStatus(final int quest) {\n         }\n     }\n     \n-    public final MapleQuestStatus getMapleQuestStatus(final int quest) {\n-        synchronized (quests) {\n-            MapleQuestStatus mqs = quests.get((short) quest);\n-            return mqs;\n-        }\n+    public MapleQuestStatus getQuest(final int quest) {\n+        return getQuest(MapleQuest.getInstance(quest));\n     }\n-\n+    \n     public MapleQuestStatus getQuest(MapleQuest quest) {\n         synchronized (quests) {\n-            if (!quests.containsKey(quest.getId())) {\n-                return new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n+            short questid = quest.getId();\n+            MapleQuestStatus qs = quests.get(questid);\n+            if (qs == null) {\n+                qs = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n+                quests.put(questid, qs);\n             }\n-            return quests.get(quest.getId());\n+            return qs;\n         }\n     }\n     \n@@ -5928,32 +5942,15 @@ public int getSlot() {\n     }\n \n     public final List<MapleQuestStatus> getStartedQuests() {\n-        synchronized (quests) {\n-            List<MapleQuestStatus> ret = new LinkedList<>();\n-            for (MapleQuestStatus q : quests.values()) {\n-                if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-                    ret.add(q);\n-                }\n+        List<MapleQuestStatus> ret = new LinkedList<>();\n+        for (MapleQuestStatus qs : getQuests()) {\n+            if (qs.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                ret.add(qs);\n             }\n-            return Collections.unmodifiableList(ret);\n         }\n+        return Collections.unmodifiableList(ret);\n     }\n-\n-    public final int getStartedQuestsSize() {\n-        synchronized (quests) {\n-            int i = 0;\n-            for (MapleQuestStatus q : quests.values()) {\n-                if (q.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-                    if (q.getQuest().getInfoNumber() > 0) {\n-                        i++;\n-                    }\n-                    i++;\n-                }\n-            }\n-            return i;\n-        }\n-    }\n-\n+    \n     public MapleStatEffect getStatForBuff(MapleBuffStat effect) {\n         effLock.lock();\n         chrLock.lock();\n@@ -7491,7 +7488,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n     }\n     \n     public void reloadQuestExpirations() {\n-        for(MapleQuestStatus mqs: quests.values()) {\n+        for(MapleQuestStatus mqs: getQuests()) {\n             if(mqs.getExpirationTime() > 0) {\n                 questTimeLimit2(mqs.getQuest(), mqs.getExpirationTime());\n             }\n@@ -7545,31 +7542,31 @@ public void yellowMessage(String m) {\n         announce(MaplePacketCreator.sendYellowTip(m));\n     }\n \n-    public void updateQuestMobCount(int id) {\n+    public void raiseQuestMobCount(int id) {\n         // It seems nexon uses monsters that don't exist in the WZ (except string) to merge multiple mobs together for these 3 monsters.\n         // We also want to run mobKilled for both since there are some quest that don't use the updated ID...\n         if (id == 1110100 || id == 1110130) {\n-            updateQuestMobCount(9101000);\n+            raiseQuestMobCount(9101000);\n         } else if (id == 2230101 || id == 2230131) {\n-            updateQuestMobCount(9101001);\n+            raiseQuestMobCount(9101001);\n         } else if (id == 1140100 || id == 1140130) {\n-            updateQuestMobCount(9101002);\n+            raiseQuestMobCount(9101002);\n         }\n         \n         int lastQuestProcessed = 0;\n         try {\n             synchronized (quests) {\n-                for (MapleQuestStatus q : quests.values()) {\n-                    lastQuestProcessed = q.getQuest().getId();\n-                    if (q.getStatus() == MapleQuestStatus.Status.COMPLETED || q.getQuest().canComplete(this, null)) {\n+                for (MapleQuestStatus qs : getQuests()) {\n+                    lastQuestProcessed = qs.getQuest().getId();\n+                    if (qs.getStatus() == MapleQuestStatus.Status.COMPLETED || qs.getQuest().canComplete(this, null)) {\n                         continue;\n                     }\n-                    String progress = q.getProgress(id);\n-                    if (!progress.isEmpty() && Integer.parseInt(progress) >= q.getQuest().getMobAmountNeeded(id)) {\n-                        continue;\n-                    }\n-                    if (q.progress(id)) {\n-                        announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, false);\n+                    \n+                    if (qs.progress(id)) {\n+                        announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n+                        if (qs.getInfoNumber() > 0) {\n+                            announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n+                        }\n                     }\n                 }\n             }\n@@ -8692,36 +8689,33 @@ public synchronized void saveCharToDB(boolean notAutosave) {\n                 psf = con.prepareStatement(\"INSERT INTO medalmaps VALUES (DEFAULT, ?, ?, ?)\");\n                 ps.setInt(1, id);\n                 \n-                synchronized (quests) {\n-                    for (MapleQuestStatus q : quests.values()) {\n-                        ps.setInt(2, q.getQuest().getId());\n-                        ps.setInt(3, q.getStatus().getId());\n-                        ps.setInt(4, (int) (q.getCompletionTime() / 1000));\n-                        ps.setLong(5, q.getExpirationTime());\n-                        ps.setInt(6, q.getForfeited());\n-                        ps.setInt(7, q.getCompleted());\n-                        ps.executeUpdate();\n-                        try (ResultSet rs = ps.getGeneratedKeys()) {\n-                            rs.next();\n-                            for (int mob : q.getProgress().keySet()) {\n-                                pse.setInt(1, id);\n-                                pse.setInt(2, rs.getInt(1));\n-                                pse.setInt(3, mob);\n-                                pse.setString(4, q.getProgress(mob));\n-                                pse.addBatch();\n-                            }\n-                            for (int i = 0; i < q.getMedalMaps().size(); i++) {\n-                                psf.setInt(1, id);\n-                                psf.setInt(2, rs.getInt(1));\n-                                psf.setInt(3, q.getMedalMaps().get(i));\n-                                psf.addBatch();\n-                            }\n-                            pse.executeBatch();\n-                            psf.executeBatch();\n+                for (MapleQuestStatus qs : getQuests()) {\n+                    ps.setInt(2, qs.getQuest().getId());\n+                    ps.setInt(3, qs.getStatus().getId());\n+                    ps.setInt(4, (int) (qs.getCompletionTime() / 1000));\n+                    ps.setLong(5, qs.getExpirationTime());\n+                    ps.setInt(6, qs.getForfeited());\n+                    ps.setInt(7, qs.getCompleted());\n+                    ps.executeUpdate();\n+                    try (ResultSet rs = ps.getGeneratedKeys()) {\n+                        rs.next();\n+                        for (int mob : qs.getProgress().keySet()) {\n+                            pse.setInt(1, id);\n+                            pse.setInt(2, rs.getInt(1));\n+                            pse.setInt(3, mob);\n+                            pse.setString(4, qs.getProgress(mob));\n+                            pse.addBatch();\n                         }\n+                        for (int i = 0; i < qs.getMedalMaps().size(); i++) {\n+                            psf.setInt(1, id);\n+                            psf.setInt(2, rs.getInt(1));\n+                            psf.setInt(3, qs.getMedalMaps().get(i));\n+                            psf.addBatch();\n+                        }\n+                        pse.executeBatch();\n+                        psf.executeBatch();\n                     }\n                 }\n-                \n             }\n             psf.close();\n             ps.close();\n@@ -9149,7 +9143,7 @@ public boolean applyHpMpChange(int hpCon, int hpchange, int mpchange) {\n             MapleKeyBinding autohpPot = this.getKeymap().get(91);\n             if (autohpPot != null) {\n                 int autohpItemid = autohpPot.getAction();\n-                if (((float) this.getHp()) / this.getMaxHp() <= this.getAutopotHpAlert()) { // try within user settings... thanks Lame, Optimist, Stealth2800\n+                if (((float) this.getHp()) / this.getCurrentMaxHp() <= this.getAutopotHpAlert()) { // try within user settings... thanks Lame, Optimist, Stealth2800\n                     Item autohpItem = this.getInventory(MapleInventoryType.USE).findById(autohpItemid);\n                     if (autohpItem != null) {\n                         PetAutopotProcessor.runAutopotAction(client, autohpItem.getPosition(), autohpItemid);\n@@ -9162,7 +9156,7 @@ public boolean applyHpMpChange(int hpCon, int hpchange, int mpchange) {\n             MapleKeyBinding autompPot = this.getKeymap().get(92);\n             if (autompPot != null) {\n                 int autompItemid = autompPot.getAction();\n-                if (((float) this.getMp()) / this.getMaxMp() <= this.getAutopotMpAlert()) {\n+                if (((float) this.getMp()) / this.getCurrentMaxMp() <= this.getAutopotMpAlert()) {\n                     Item autompItem = this.getInventory(MapleInventoryType.USE).findById(autompItemid);\n                     if (autompItem != null) {\n                         PetAutopotProcessor.runAutopotAction(client, autompItem.getPosition(), autompItemid);\n@@ -9845,26 +9839,23 @@ private void updatePartyMemberHPInternal() {\n             }\n         }\n     }\n-\n-    public String getQuestInfo(int quest) {\n-        MapleQuestStatus qs = getQuest(MapleQuest.getInstance(quest));\n-        return qs.getInfo();\n-    }\n-\n-    public void updateQuestInfo(int quest, String info) {\n-        MapleQuest q = MapleQuest.getInstance(quest);\n+    \n+    public void setQuestProgress(int id, int infoNumber, String progress) {\n+        MapleQuest q = MapleQuest.getInstance(id);\n         MapleQuestStatus qs = getQuest(q);\n-        qs.setInfo(info);\n-\n-        synchronized (quests) {\n-            quests.put(q.getId(), qs);\n+        \n+        if (qs.getInfoNumber() == infoNumber && infoNumber > 0) {\n+            MapleQuest iq = MapleQuest.getInstance(infoNumber);\n+            MapleQuestStatus iqs = getQuest(iq);\n+            iqs.setProgress(0, progress);\n+        } else {\n+            qs.setProgress(infoNumber, progress);   // quest progress is thoroughly a string match, infoNumber is actually another questid\n         }\n \n         announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n-        if (qs.getQuest().getInfoNumber() > 0) {\n+        if (qs.getInfoNumber() > 0) {\n             announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n         }\n-        announce(MaplePacketCreator.updateQuestInfo((short) qs.getQuest().getId(), qs.getNpc()));\n     }\n     \n     public void awardQuestPoint(int awardedPoints) {\n@@ -9886,15 +9877,15 @@ public void awardQuestPoint(int awardedPoints) {\n     }\n     \n     public enum DelayedQuestUpdate {    // quest updates allow player actions during NPC talk...\n-        UPDATE, FORFEIT, COMPLETE\n+        UPDATE, FORFEIT, COMPLETE, INFO\n     }\n     \n-    private void announceUpdateQuestInternal(Pair<DelayedQuestUpdate, Object[]> questUpdate) {\n+    private void announceUpdateQuestInternal(MapleCharacter chr, Pair<DelayedQuestUpdate, Object[]> questUpdate) {\n         Object[] objs = questUpdate.getRight();\n         \n         switch (questUpdate.getLeft()) {\n             case UPDATE:\n-                announce(MaplePacketCreator.updateQuest((MapleQuestStatus) objs[0], (Boolean) objs[1]));\n+                announce(MaplePacketCreator.updateQuest(chr, (MapleQuestStatus) objs[0], (Boolean) objs[1]));\n                 break;\n                 \n             case FORFEIT:\n@@ -9904,6 +9895,11 @@ private void announceUpdateQuestInternal(Pair<DelayedQuestUpdate, Object[]> ques\n             case COMPLETE:\n                 announce(MaplePacketCreator.completeQuest((Short) objs[0], (Long) objs[1]));\n                 break;\n+                \n+            case INFO:\n+                MapleQuestStatus qs = (MapleQuestStatus) objs[0];\n+                announce(MaplePacketCreator.updateQuestInfo(qs.getQuest().getId(), qs.getNpc()));\n+                break;\n         }\n     }\n     \n@@ -9915,7 +9911,7 @@ public void announceUpdateQuest(DelayedQuestUpdate questUpdateType, Object... pa\n                 npcUpdateQuests.add(p);\n             }\n         } else {\n-            announceUpdateQuestInternal(p);\n+            announceUpdateQuestInternal(this, p);\n         }\n     }\n     \n@@ -9928,49 +9924,52 @@ public void flushDelayedUpdateQuests() {\n         }\n         \n         for (Pair<DelayedQuestUpdate, Object[]> q : qmQuestUpdateList) {\n-            announceUpdateQuestInternal(q);\n+            announceUpdateQuestInternal(this, q);\n         }\n     }\n     \n-    public void updateQuest(MapleQuestStatus quest) {\n+    public void updateQuestStatus(MapleQuestStatus qs) {\n         synchronized (quests) {\n-            quests.put(quest.getQuestID(), quest);\n+            quests.put(qs.getQuestID(), qs);\n         }\n-        if (quest.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n-            announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, false);\n-            if (quest.getQuest().getInfoNumber() > 0) {\n-                announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, true);\n+        if (qs.getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+            announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n+            if (qs.getInfoNumber() > 0) {\n+                announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n             }\n-            announce(MaplePacketCreator.updateQuestInfo((short) quest.getQuest().getId(), quest.getNpc()));\n-        } else if (quest.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n-            MapleQuest mquest = quest.getQuest();\n+            announceUpdateQuest(DelayedQuestUpdate.INFO, qs);\n+        } else if (qs.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n+            MapleQuest mquest = qs.getQuest();\n             short questid = mquest.getId();\n             if (!mquest.isSameDayRepeatable() && !MapleQuest.isExploitableQuest(questid)) {\n                 awardQuestPoint(YamlConfig.config.server.QUEST_POINT_PER_QUEST_COMPLETE);\n             }\n-            quest.setCompleted(quest.getCompleted() + 1);   // count quest completed Jayd's idea\n+            qs.setCompleted(qs.getCompleted() + 1);   // count quest completed Jayd's idea\n             \n-            announceUpdateQuest(DelayedQuestUpdate.COMPLETE, questid, quest.getCompletionTime());\n-        } else if (quest.getStatus().equals(MapleQuestStatus.Status.NOT_STARTED)) {\n-            announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, false);\n-            if (quest.getQuest().getInfoNumber() > 0) {\n-                announceUpdateQuest(DelayedQuestUpdate.UPDATE, quest, true);\n+            announceUpdateQuest(DelayedQuestUpdate.COMPLETE, questid, qs.getCompletionTime());\n+            announceUpdateQuest(DelayedQuestUpdate.INFO, qs);\n+        } else if (qs.getStatus().equals(MapleQuestStatus.Status.NOT_STARTED)) {\n+            announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n+            if (qs.getInfoNumber() > 0) {\n+                announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n             }\n         }\n     }\n-\n+    \n     private void expireQuest(MapleQuest quest) {\n-        if(getQuestStatus(quest.getId()) == MapleQuestStatus.Status.COMPLETED.getId()) {\n+        MapleQuestStatus mqs = getQuest(quest);\n+        if(mqs.getStatus().equals(MapleQuestStatus.Status.COMPLETED)) {\n             return;\n         }\n-        if(System.currentTimeMillis() < getMapleQuestStatus(quest.getId()).getExpirationTime()) {\n+        \n+        if(System.currentTimeMillis() < mqs.getExpirationTime()) {\n             return;\n         }\n         \n         announce(MaplePacketCreator.questExpire(quest.getId()));\n         MapleQuestStatus newStatus = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n-        newStatus.setForfeited(getQuest(quest).getForfeited() + 1);\n-        updateQuest(newStatus);\n+        newStatus.setForfeited(mqs.getForfeited() + 1);\n+        updateQuestStatus(newStatus);\n     }\n     \n     public void cancelQuestExpirationTask() {\n@@ -11016,7 +11015,7 @@ public static boolean doWorldTransfer(Connection con, int characterId, int oldWo\n         }\n         try (PreparedStatement ps = con.prepareStatement(\"UPDATE characters SET world = ?, meso = ?, guildid = ?, guildrank = ? WHERE id = ?\")) {\n             ps.setInt(1, newWorld);\n-            ps.setInt(2, Math.min(mesos, 1000000)); //might want a limit in YamlConfig.config.server.for this\n+            ps.setInt(2, Math.min(mesos, 1000000)); // might want a limit in \"YamlConfig.config.server\" for this\n             ps.setInt(3, 0);\n             ps.setInt(4, 5);\n             ps.setInt(5, characterId);"}, {"sha": "887f225e9ecb90c1c36e5240056e5a17513fb4cf", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1002,7 +1002,7 @@ private void disconnectInternal(boolean shutdown, boolean cashshop) {//once per\n                                                                 if (quest.getTimeLimit() > 0) {\n                                                                         MapleQuestStatus newStatus = new MapleQuestStatus(quest, MapleQuestStatus.Status.NOT_STARTED);\n                                                                         newStatus.setForfeited(player.getQuest(quest).getForfeited() + 1);\n-                                                                        player.updateQuest(newStatus);\n+                                                                        player.updateQuestStatus(newStatus);\n                                                                 }\n                                                         }\t                   \n                                                         if (guild != null) {"}, {"sha": "e7ce741d57928328a765afc8f72dcaf6cba66761", "filename": "src/client/MapleQuestStatus.java", "status": "modified", "additions": 42, "deletions": 28, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleQuestStatus.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/MapleQuestStatus.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleQuestStatus.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -151,14 +151,20 @@ public int getMedalProgress() {\n     }\n \n     public boolean progress(int id) {\n-        if (progress.get(id) != null) {\n-            int current = Integer.parseInt(progress.get(id));\n-            String str = StringUtil.getLeftPaddedStr(Integer.toString(current + 1), '0', 3);\n-            progress.put(id, str);\n-            //this.setUpdated();\n-            return true;\n+        String currentStr = progress.get(id);\n+        if (currentStr == null) {\n+            return false;\n         }\n-        return false;\n+        \n+        int current = Integer.parseInt(currentStr);\n+        if (current >= this.getQuest().getMobAmountNeeded(id)) {\n+            return false;\n+        }\n+        \n+        String str = StringUtil.getLeftPaddedStr(Integer.toString(++current), '0', 3);\n+        progress.put(id, str);\n+        //this.setUpdated();\n+        return true;\n     }\n \n     public void setProgress(int id, String pr) {\n@@ -169,15 +175,14 @@ public void setProgress(int id, String pr) {\n     public boolean madeProgress() {\n         return progress.size() > 0;\n     }\n-\n-    public Integer getAnyProgressKey() {\n-        if (!progress.isEmpty()) return progress.entrySet().iterator().next().getKey();\n-        return 0;\n-    }\n     \n     public String getProgress(int id) {\n-        if (progress.get(id) == null) return \"\";\n-        return progress.get(id);\n+        String ret = progress.get(id);\n+        if (ret == null) {\n+            return \"\";\n+        } else {\n+            return ret;\n+        }\n     }\n     \n     public void resetProgress(int id) {\n@@ -193,6 +198,27 @@ public void resetAllProgress() {\n     public Map<Integer, String> getProgress() {\n         return Collections.unmodifiableMap(progress);\n     }\n+    \n+    public short getInfoNumber() {\n+        MapleQuest q = this.getQuest();\n+        Status s = this.getStatus();\n+        \n+        return q.getInfoNumber(s);\n+    }\n+    \n+    public String getInfoEx(int index) {\n+        MapleQuest q = this.getQuest();\n+        Status s = this.getStatus();\n+        \n+        return q.getInfoEx(s, index);\n+    }\n+    \n+    public List<String> getInfoEx() {\n+        MapleQuest q = this.getQuest();\n+        Status s = this.getStatus();\n+        \n+        return q.getInfoEx(s);\n+    }\n \n     public long getCompletionTime() {\n         return completionTime;\n@@ -217,18 +243,6 @@ public int getForfeited() {\n     public int getCompleted() {\n         return completed;\n     }\n-    \n-    public String getInfo() {\n-        if(!progress.containsKey(0) && !getMedalMaps().isEmpty()) {\n-            return Integer.toString(getMedalProgress());\n-        }\n-        return getProgress(0);\n-    }\n-    \n-    public void setInfo(String newInfo) {\n-        progress.put(0, newInfo);\n-        //this.setUpdated();\n-    }\n \n     public void setForfeited(int forfeited) {\n         if (forfeited >= this.forfeited) {\n@@ -254,11 +268,11 @@ public final String getCustomData() {\n         return customData;\n     }\n     \n-    public String getQuestData() {\n+    public String getProgressData() {\n         StringBuilder str = new StringBuilder();\n         for (String ps : progress.values()) {\n             str.append(ps);\n         }\n         return str.toString();\n     }\n-}\n\\ No newline at end of file\n+}"}, {"sha": "898e8f6b7b0d305b36fc56b8bb708d0c05bf4e9b", "filename": "src/client/command/commands/gm5/SetCommand.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/command/commands/gm5/SetCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/client/command/commands/gm5/SetCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm5/SetCommand.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -25,7 +25,7 @@\n \n import client.command.Command;\n import client.MapleClient;\n-import config.YamlConfig;\n+import constants.net.ServerConstants;\n \n public class SetCommand extends Command {\n     {\n@@ -35,7 +35,7 @@\n     @Override\n     public void execute(MapleClient c, String[] params) {\n         for (int i = 0; i < params.length; i++) {\n-            YamlConfig.config.server.DEBUG_VALUES[i] = Integer.parseInt(params[i]);\n+            ServerConstants.DEBUG_VALUES[i] = Integer.parseInt(params[i]);\n         }\n     }\n }"}, {"sha": "ccc0a8f7c86992733fd1ceacb6fe7667a43813b2", "filename": "src/config/ServerConfig.java", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/config/ServerConfig.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/config/ServerConfig.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/config/ServerConfig.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -301,6 +301,4 @@\n     //Event End Timestamp\n     public long EVENT_END_TIMESTAMP;\n \n-    //Debug Variables\n-    public int DEBUG_VALUES[];\n }"}, {"sha": "c8adc338d1453096e65428147bb9edc5dcd3936d", "filename": "src/config/YamlConfig.java", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/config/YamlConfig.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/config/YamlConfig.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/config/YamlConfig.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1,24 +1,26 @@\n package config;\n \n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import com.esotericsoftware.yamlbeans.YamlReader;\n \n-import java.io.File;\n import java.io.FileNotFoundException;\n+import java.io.FileReader;\n import java.io.IOException;\n import java.util.List;\n \n \n public class YamlConfig {\n \n     public static final YamlConfig config = fromFile(\"config.yaml\");\n+    \n     public List<WorldConfig> worlds;\n     public ServerConfig server;\n \n     public static YamlConfig fromFile(String filename) {\n-        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n         try {\n-            return mapper.readValue(new File(filename), YamlConfig.class);\n+            YamlReader reader = new YamlReader(new FileReader(filename));\n+            YamlConfig config = reader.read(YamlConfig.class);\n+            reader.close();\n+            return config;\n         } catch (FileNotFoundException e) {\n             String message = \"Could not read config file \" + filename + \": \" + e.getMessage();\n             throw new RuntimeException(message);"}, {"sha": "869a135f5db639cb741d9903d6c3eedd8214bd3c", "filename": "src/constants/net/ServerConstants.java", "status": "modified", "additions": 2, "deletions": 299, "changes": 301, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/constants/net/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/constants/net/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/net/ServerConstants.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1,313 +1,16 @@\n package constants.net;\n \n public class ServerConstants {\n+    \n     //Server Version\n     public static short VERSION = 83;\n \n     //Java Configuration\n     public static final boolean JAVA_8 = getJavaVersion() >= 8;         //Max amount of times a party leader is allowed to persist on the Party Search before entry expiration (thus needing to manually restart the Party Search to be able to search for members).\n-\n-    //Login Configuration\n-    public static final int WLDLIST_SIZE = 21;                  //Max possible worlds on the server.\n-    public static final int CHANNEL_SIZE = 20;                  //Max possible channels per world (which is 20, based on the channel list on login phase).\n-    public static final int CHANNEL_LOAD = 100;                 //Max players per channel (limit actually used to calculate the World server capacity).\n-    public static final int CHANNEL_LOCKS = 20;                 //Total number of structure management locks each channel has.\n-    \n-    public static final long RESPAWN_INTERVAL = 10 * 1000;\t//10 seconds, 10000.\n-    public static final long PURGING_INTERVAL = 5 * 60 * 1000;\n-    public static final long RANKING_INTERVAL = 60 * 60 * 1000;\t//60 minutes, 3600000.\n-    public static final long  COUPON_INTERVAL = 60 * 60 * 1000;\t//60 minutes, 3600000.\n-    public static final long  UPDATE_INTERVAL = 777;            //Dictates the frequency on which the \"centralized server time\" is updated.\n-    \n-    public static final boolean ENABLE_PIC = false;             //Pick true/false to enable or disable Pic. Delete character requires PIC available.\n-    public static final boolean ENABLE_PIN = false;             //Pick true/false to enable or disable Pin.\n-    \n-    public static final int BYPASS_PIC_EXPIRATION = 20;         //Enables PIC bypass, which will remain active for that account by that client machine for N minutes. Set 0 to disable.\n-    public static final int BYPASS_PIN_EXPIRATION = 15;         //Enables PIN bypass, which will remain active for that account by that client machine for N minutes. Set 0 to disable.\n-    \n-    public static final boolean AUTOMATIC_REGISTER = true;      //Automatically register players when they login with a nonexistent username.\n-    public static final boolean BCRYPT_MIGRATION = true;        //Performs a migration from old SHA-1 and SHA-512 password to bcrypt.\n-    public static final boolean COLLECTIVE_CHARSLOT = false;    //Available character slots are contabilized globally rather than per world server.\n-    public static final boolean DETERRED_MULTICLIENT = false;   //Enables detection of multi-client and suspicious remote IP on the login system.\n-    \n-    //Besides blocking logging in with several client sessions on the same machine, this also blocks suspicious login attempts for players that tries to login on an account using several diferent remote addresses.\n-    \n-    //Multiclient Coordinator Configuration\n-    public static final int MAX_ALLOWED_ACCOUNT_HWID = 4;       //Allows up to N concurrent HWID's for an account. HWID's remains linked to an account longer the more times it's used to login.\n-    public static final int MAX_ACCOUNT_LOGIN_ATTEMPT = 15;     //After N tries on an account, login on that account gets disabled for a short period.\n-    public static final int LOGIN_ATTEMPT_DURATION = 120;       //Period in seconds the login attempt remains registered on the system.\n-    \n-    //Ip Configuration\n-    public static String HOST;\n-    public static boolean LOCALSERVER;\n-\n-    //Other Configuration\n-    public static boolean SHUTDOWNHOOK;\n-    \n-    //Server Flags\n-    public static final boolean USE_CUSTOM_KEYSET = true;           //Enables auto-setup of the HeavenMS's custom keybindings when creating characters.\n-    public static final boolean USE_DEBUG = false;                  //Will enable some text prints on the client, oriented for debugging purposes.\n-    public static final boolean USE_DEBUG_SHOW_INFO_EQPEXP = false; //Prints on the cmd all equip exp gain info.\n-    public static       boolean USE_DEBUG_SHOW_RCVD_PACKET = false; //Prints on the cmd all received packet ids.\n-    public static       boolean USE_DEBUG_SHOW_RCVD_MVLIFE = false; //Prints on the cmd all received move life content.\n-    public static final boolean USE_DEBUG_SHOW_PACKET = false;\n-    public static       boolean USE_SUPPLY_RATE_COUPONS = true;     //Allows rate coupons to be sold through the Cash Shop.\n-    public static final boolean USE_IP_VALIDATION = true;           //Enables IP checking when logging in.\n-    \n-    public static final boolean USE_MAXRANGE = true;                //Will send and receive packets from all events on a map, rather than those of only view range.\n-    public static final boolean USE_MAXRANGE_ECHO_OF_HERO = true;\n-    public static final boolean USE_MTS = false;\n-    public static final boolean USE_CPQ = true;                     //Renders the CPQ available or not.\n-    public static final boolean USE_AUTOHIDE_GM = false;            //When enabled, GMs are automatically hidden when joining. Thanks to Steven Deblois (steven1152).\n-    public static final boolean USE_BUYBACK_SYSTEM = true;          //Enables the HeavenMS-builtin buyback system, to be used by dead players when clicking the MTS button.\n-    public static final boolean USE_FIXED_RATIO_HPMP_UPDATE = true; //Enables the HeavenMS-builtin HPMP update based on the current pool to max pool ratio.\n-    public static final boolean USE_FAMILY_SYSTEM = true;\n-    public static final boolean USE_DUEY = true;\n-    public static final boolean USE_RANDOMIZE_HPMP_GAIN = true;     //Enables randomizing on MaxHP/MaxMP gains and INT accounting for the MaxMP gain on level up.\n-    public static final boolean USE_STORAGE_ITEM_SORT = true;       //Enables storage \"Arrange Items\" feature.\n-    public static final boolean USE_ITEM_SORT = true;               //Enables inventory \"Item Sort/Merge\" feature.\n-    public static final boolean USE_ITEM_SORT_BY_NAME = false;      //Item sorting based on name rather than id.\n-    public static final boolean USE_PARTY_FOR_STARTERS = true;      //Players level 10 or below can create/invite other players on the given level range.\n-    public static final boolean USE_AUTOASSIGN_STARTERS_AP = false; //Beginners level 10 or below have their AP autoassigned (they can't choose to levelup a stat). Set true ONLY if the localhost doesn't support AP assigning for beginners level 10 or below.\n-    public static final boolean USE_AUTOASSIGN_SECONDARY_CAP = true;//Prevents AP autoassign from spending on secondary stats after the player class' cap (defined on the autoassign handler) has been reached.\n-    public static final boolean USE_STARTING_AP_4 = true;           //Use early-GMS 4/4/4/4 starting stats. To overcome AP shortage, this gives 4AP/5AP at 1st/2nd job advancements.\n-    public static final boolean USE_AUTOBAN = false;                //Commands the server to detect infractors automatically.\n-    public static final boolean USE_AUTOBAN_LOG = true;             //Log autoban related messages. Still logs even with USE_AUTOBAN disabled.\n-    public static final boolean USE_AUTOSAVE = true;                //Enables server autosaving feature (saves characters to DB each 1 hour).\n-    public static final boolean USE_SERVER_AUTOASSIGNER = true;     //HeavenMS-builtin autoassigner, uses algorithm based on distributing AP accordingly with required secondary stat on equipments.\n-    public static final boolean USE_REFRESH_RANK_MOVE = true;\n-    public static final boolean USE_ENFORCE_ADMIN_ACCOUNT = false;  //Forces accounts having GM characters to be treated as a \"GM account\" by the client (localhost). Some of the GM account perks is the ability to FLY, but unable to TRADE.\n-    public static final boolean USE_ENFORCE_NOVICE_EXPRATE = false; //Hardsets experience rate 1x for beginners level 10 or under. Ideal for roaming on novice areas without caring too much about losing some stats.\n-    public static final boolean USE_ENFORCE_HPMP_SWAP = false;      //Forces players to reuse stats (via AP Resetting) located on HP/MP pool only inside the HP/MP stats.\n-    public static final boolean USE_ENFORCE_MOB_LEVEL_RANGE = true; //Players N levels below the killed mob will gain no experience from defeating it.\n-    public static final boolean USE_ENFORCE_JOB_LEVEL_RANGE = false;//Caps the player level on the minimum required to advance their current jobs.\n-    public static final boolean USE_ENFORCE_JOB_SP_RANGE = false;   //Caps the player SP level on the total obtainable by their current jobs. After changing jobs, missing SP will be retrieved.\n-    public static final boolean USE_ENFORCE_ITEM_SUGGESTION = false;//Forces the Owl of Minerva and the Cash Shop to always display the defined item array instead of those featured by the players.\n-    public static final boolean USE_ENFORCE_UNMERCHABLE_CASH = true;//Forces players to not sell CASH items via merchants, drops of it disappears.\n-    public static final boolean USE_ENFORCE_UNMERCHABLE_PET = true; //Forces players to not sell pets via merchants, drops of it disappears. (since non-named pets gets dirty name and other possible DB-related issues)\n-    public static final boolean USE_ENFORCE_MERCHANT_SAVE = true;   //Forces automatic DB save on merchant owners, at every item movement on shop.\n-    public static final boolean USE_ENFORCE_MDOOR_POSITION = false; //Forces mystic door to be spawned near spawnpoints.\n-    public static final boolean USE_SPAWN_CLEAN_MDOOR = false;       //Makes mystic doors to be spawned without deploy animation. This clears disconnecting issues that may happen when trying to cancel doors a couple seconds after deployment.\n-    public static final boolean USE_SPAWN_LOOT_ON_ANIMATION = false;//Makes loot appear some time after the mob has been killed (following the mob death animation, instead of instantly).\n-    public static final boolean USE_SPAWN_RELEVANT_LOOT = true;     //Forces to only spawn loots that are collectable by the player or any of their party members.\n-    public static final boolean USE_ERASE_PERMIT_ON_OPENSHOP = true;//Forces \"shop permit\" item to be consumed when player deploy his/her player shop.\n-    public static final boolean USE_ERASE_UNTRADEABLE_DROP = true;  //Forces flagged untradeable items to disappear when dropped.\n-    public static final boolean USE_ERASE_PET_ON_EXPIRATION = false;//Forces pets to be removed from inventory when expire time comes, rather than converting it to a doll.\n-    public static final boolean USE_BUFF_MOST_SIGNIFICANT = true;   //When applying buffs, the player will stick with the highest stat boost among the listed, rather than overwriting stats.\n-    public static final boolean USE_BUFF_EVERLASTING = false;       //Every applied buff on players holds expiration time so high it'd be considered permanent. Suggestion thanks to Vcoc.\n-    public static final boolean USE_MULTIPLE_SAME_EQUIP_DROP = true;//Enables multiple drops by mobs of the same equipment, number of possible drops based on the quantities provided at the drop data.\n-    public static final boolean USE_BANISHABLE_TOWN_SCROLL = true;  //Enables town scrolls to act as if it's a \"player banish\", rendering the antibanish scroll effect available.\n-    public static final boolean USE_ENABLE_FULL_RESPAWN = true;     //At respawn task, always respawn missing mobs when they're available. Spawn count doesn't depend on how many players are currently there.\n-    public static final boolean USE_ENABLE_CHAT_LOG = false;        //Write in-game chat to log\n-    public static final boolean USE_REBIRTH_SYSTEM = false;         //Flag to enable/disable rebirth system\n-    public static final boolean USE_MAP_OWNERSHIP_SYSTEM = true;    //Flag to enable/disable map ownership system\n-    public static final boolean USE_FISHING_SYSTEM = true;          //Flag to enable/disable custom fishing system\n-    public static final boolean USE_NPCS_SCRIPTABLE = true;         //Flag to enable/disable serverside predefined script NPCs.\n-    \n-    //Events/PQs Configuration\n-    public static final boolean USE_OLD_GMS_STYLED_PQ_NPCS = true;   //Enables PQ NPCs with similar behaviour to old GMS style, that skips info about the PQs and immediately tries to register the party in.\n-    public static final boolean USE_ENABLE_SOLO_EXPEDITIONS = true;  //Enables start expeditions with any number of players. This will also bypass all the Zakum prequest.\n-    public static final boolean USE_ENABLE_DAILY_EXPEDITIONS = false;//Enables daily entry limitations in expeditions.\n-    public static final boolean USE_ENABLE_RECALL_EVENT = false;      //Enables a disconnected player to reaccess the last event instance they were in before logging out. Recall only works if the event isn't cleared or disposed yet. Suggestion thanks to Alisson (Goukken).\n-    \n-    //Announcement Configuration\n-    public static final boolean USE_ANNOUNCE_SHOPITEMSOLD = false;  //Automatic message sent to owner when an item from the Player Shop or Hired Merchant is sold.\n-    public static final boolean USE_ANNOUNCE_CHANGEJOB = false;     //Automatic message sent to acquantainces when changing jobs.\n-    \n-    //Cash Shop Configuration\n-    public static final boolean USE_JOINT_CASHSHOP_INVENTORY = true;//Enables usage of a same cash shop inventory for explorers, cygnus and legends. Items from exclusive cash shop inventories won't show up on the shared inventory, though.\n-    public static final boolean USE_CLEAR_OUTDATED_COUPONS = true;  //Enables deletion of older code coupon registry from the DB, freeing so-long irrelevant data.\n-    public static final boolean ALLOW_CASHSHOP_NAME_CHANGE = true;  //Allows players to buy name changes in the cash shop.\n-    public static final boolean ALLOW_CASHSHOP_WORLD_TRANSFER =true;//Allows players to buy world transfers in the cash shop.\n-    \n-    //Maker Configuration\n-    public static final boolean USE_MAKER_PERMISSIVE_ATKUP = true;  //Allows players to use attack-based strengthening gems on non-weapon items.\n-    public static final boolean USE_MAKER_FEE_HEURISTICS = true;    //Apply compiled values for stimulants and reagents into the Maker fee calculations (max error revolves around 50k mesos). Set false to use basic constant values instead (results are never higher than requested by the client-side).\n-    \n-    //Custom Configuration\n-    public static final boolean USE_ENABLE_CUSTOM_NPC_SCRIPT = true;//Enables usage of custom HeavenMS NPC scripts (Agent E, Coco, etc). Will not disable Abdula (it's actually useful for the gameplay) or quests.\n-    public static final boolean USE_STARTER_MERGE = false;          //Allows any players to use the Equipment Merge custom mechanic (as opposed to the high-level, Maker lv3 requisites).\n-    \n-    //Commands Configuration\n-    public static final boolean BLOCK_GENERATE_CASH_ITEM = false;   //Prevents creation of cash items with the item/drop command.\n-    public static final boolean USE_WHOLE_SERVER_RANKING = false;   //Enables a ranking pool made from every character registered on the server for the \"ranks\" command, instead of separated by worlds.\n-    \n-    //Server Rates And Experience\n-    public static final int EXP_RATE = 10;                          //NOTE: World-specific rates within \"world.ini\" OVERRIDES the default rates from here.\n-    public static final int MESO_RATE = 10;\n-    public static final int DROP_RATE = 10;\n-    public static final int BOSS_DROP_RATE = 10;                    //NOTE: Boss drop rate OVERRIDES common drop rate, for bosses-only.\n-    public static final int QUEST_RATE = 5;                         //Multiplier for Exp & Meso gains when completing a quest. Only available when USE_QUEST_RATE is true. Stacks with server Exp & Meso rates.\n-    public static final int FISHING_RATE = 10;                      //Multiplier for success likelihood on meso thrown during fishing.\n-    public static final int TRAVEL_RATE = 10;                       //Means of transportation rides/departs using 1/N of the default time.\n-    \n-    public static final double EQUIP_EXP_RATE = 1.0;                //Rate for equipment exp gain, grows linearly. Set 1.0 for default (about 100~200 same-level range mobs killed to pass equip from level 1 to 2).\n-    public static final double PQ_BONUS_EXP_RATE = 0.5;             //Rate for the PQ exp reward.\n-    \n-    public static final byte EXP_SPLIT_LEVEL_INTERVAL = 5;          //Non-contributing players must be within N level between the mob to receive EXP.\n-    public static final byte EXP_SPLIT_LEECH_INTERVAL = 5;          //Non-contributing players must be within N level between any contributing party member to receive EXP.\n-    public static final float EXP_SPLIT_MVP_MOD = 0.2f;\n-    public static final float EXP_SPLIT_COMMON_MOD = 0.8f;\n-    public static final float PARTY_BONUS_EXP_RATE = 1.0f;          //Rate for the party exp bonus reward.\n-    \n-    //Miscellaneous Configuration\n-    public static String TIMEZONE = \"GMT-3\";\n-    public static boolean USE_DISPLAY_NUMBERS_WITH_COMMA = true;        //Enforce comma on displayed strings (use this when USE_UNITPRICE_WITH_COMMA is active and you still want to display comma-separated values).\n-    public static boolean USE_UNITPRICE_WITH_COMMA = true;              //Set this accordingly with the layout of the unitPrices on Item.wz XML's, whether it's using commas or dots to represent fractions.\n-    public static final byte MAX_MONITORED_BUFFSTATS = 5;               //Limits accounting for \"dormant\" buff effects, that should take place when stronger stat buffs expires.\n-    public static final int MAX_AP = 32767;                             //Max AP allotted on the auto-assigner.\n-    public static final int MAX_EVENT_LEVELS = 8;                       //Event has different levels of rewarding system.\n-    public static final long BLOCK_NPC_RACE_CONDT = (long)(0.5 * 1000); //Time the player client must wait before reopening a conversation with an NPC.\n-    public static final long PET_LOOT_UPON_ATTACK = (long)(0.7 * 1000); //Time the pet must wait before trying to pick items up.\n-    public static final int TOT_MOB_QUEST_REQUIREMENT = 77;             //Overwrites old 999-mobs requirement for the ToT questline with new requirement value, set 0 for default.\n-    public static final int MOB_REACTOR_REFRESH_TIME = 30 * 1000;       //Overwrites refresh time for those reactors oriented to inflict damage to bosses (Ice Queen, Riche), set 0 for default.\n-    public static final int PARTY_SEARCH_REENTRY_LIMIT = 10;            //Max amount of times a party leader is allowed to persist on the Party Search before entry expiration (thus needing to manually restart the Party Search to be able to search for members).\n-    public static final int NAME_CHANGE_COOLDOWN = 30*24*60*60*1000;    //Cooldown for name changes, default (GMS) is 30 days.\n-    public static final int WORLD_TRANSFER_COOLDOWN=NAME_CHANGE_COOLDOWN;//Cooldown for world tranfers, default is same as name change (30 days).\n-    public static final boolean INSTANT_NAME_CHANGE = false;            //Whether or not to wait for server restart to apply name changes. Does on reconnect otherwise (requires queries on every login).\n-    \n-    //Dangling Items/Locks Configuration\n-    public static final int ITEM_EXPIRE_TIME  = 3 * 60 * 1000;  //Time before items start disappearing. Recommended to be set up to 3 minutes.\n-    public static final int KITE_EXPIRE_TIME  = 60 * 60 * 1000; //Time before kites (cash item) disappears.\n-    public static final int ITEM_MONITOR_TIME = 5 * 60 * 1000;  //Interval between item monitoring tasks on maps, which checks for dangling (null) item objects on the map item history.\n-    public static final int LOCK_MONITOR_TIME = 30 * 1000;      //Waiting time for a lock to be released. If it reaches timeout, a critical server deadlock has made present.\n-    \n-    //Map Monitor Configuration\n-    public static final int ITEM_EXPIRE_CHECK = 10 * 1000;      //Interval between item expiring tasks on maps, which checks and makes disappear expired items.\n-    public static final int ITEM_LIMIT_ON_MAP = 200;            //Max number of items allowed on a map.\n-    public static final int MAP_VISITED_SIZE = 5;               //Max length for last mapids visited by a player. This is used to recover and update drops on these maps accordingly with player actions.\n-    public static final int MAP_DAMAGE_OVERTIME_INTERVAL = 5000;//Interval in milliseconds between map environment damage (e.g. El Nath and Aqua Road surrondings).\n     \n-    //Channel Mob Disease Monitor Configuration\n-    public static final int MOB_STATUS_MONITOR_PROC = 200;      //Frequency in milliseconds between each proc on the mob disease monitor schedule.\n-    public static final int MOB_STATUS_MONITOR_LIFE = 84;       //Idle proc count the mob disease monitor is allowed to be there before closing it due to inactivity.\n-    public static final int MOB_STATUS_AGGRO_PERSISTENCE = 2;   //Idle proc count on aggro update for a mob to keep following the current controller, given him/her is the leading damage dealer.\n-    public static final int MOB_STATUS_AGGRO_INTERVAL = 5000;   //Interval in milliseconds between aggro logistics update.\n-    \n-    //Some Gameplay Enhancing Configurations\n-    //Scroll Configuration\n-    public static final boolean USE_PERFECT_GM_SCROLL = true;   //Scrolls from GMs never uses up slots nor fails.\n-    public static final boolean USE_PERFECT_SCROLLING = true;   //Scrolls doesn't use slots upon failure.\n-    public static final boolean USE_ENHANCED_CHSCROLL = true;   //Equips even more powerful with chaos upgrade.\n-    public static final boolean USE_ENHANCED_CRAFTING = true;   //Apply chaos scroll on every equip crafted.\n-    public static final boolean USE_ENHANCED_CLNSLATE = true;   //Clean slates can be applied to recover successfully used slots as well.\n-    public static final int SCROLL_CHANCE_ROLLS = 10;           //Number of rolls for success on a scroll, set 1 for default.\n-    public static final int CHSCROLL_STAT_ROLLS = 3;            //Number of rolls of stat upgrade on a successfully applied chaos scroll, set 1 for default.\n-    public static final int CHSCROLL_STAT_RANGE = 6;            //Stat upgrade range (-N, N) on chaos scrolls.\n-    \n-    //Beginner Skills Configuration\n-    public static final boolean USE_ULTRA_NIMBLE_FEET = true;   //Massive speed & jump upgrade.\n-    public static final boolean USE_ULTRA_RECOVERY = true;      //Massive recovery amounts overtime.\n-    public static final boolean USE_ULTRA_THREE_SNAILS = true;  //Massive damage on shell toss.\n-    \n-    //Other Skills Configuration\n-    public static final boolean USE_FULL_ARAN_SKILLSET = false; //Enables starter availability to all Aran job skills. Suggestion thanks to Masterrulax.\n-    public static final boolean USE_FAST_REUSE_HERO_WILL = true;//Greatly reduce cooldown on Hero's Will.\n-    public static final boolean USE_ANTI_IMMUNITY_CRASH = true; //Crash skills additionally removes the mob's invincibility buffs. Suggestion thanks to Celestial.\n-    public static final boolean USE_UNDISPEL_HOLY_SHIELD = true;//Holy shield buff also prevents players from suffering dispel from mobs.\n-    public static final boolean USE_FULL_HOLY_SYMBOL = true;    //Holy symbol doesn't require EXP sharers to work in full.\n-    \n-    //Character Configuration\n-    public static final boolean USE_ADD_SLOTS_BY_LEVEL = true;  //Slots are added each 20 levels.\n-    public static final boolean USE_ADD_RATES_BY_LEVEL = true;  //Rates are added each 20 levels.\n-    public static final boolean USE_STACK_COUPON_RATES = false; //Multiple coupons effects builds up together.\n-    public static final boolean USE_PERFECT_PITCH = true;       //For lvl 30 or above, each lvlup grants player 1 perfect pitch.\n-    \n-    //Quest Configuration\n-    public static final boolean USE_QUEST_RATE = false;         //Exp/Meso gained by quests uses fixed server exp/meso rate times quest rate as multiplier, instead of player rates.\n-    \n-    //Quest Points Configuration\n-    public static final int QUEST_POINT_REPEATABLE_INTERVAL = 24;//Minimum interval between repeatable quest completions for quest points to be awarded.\n-    public static final int QUEST_POINT_REQUIREMENT = 16;        //Exchange factor between N quest points to +1 fame, set 0 to disable the entire quest point mechanism.\n-    public static final int QUEST_POINT_PER_QUEST_COMPLETE = 4;  //Each completed quest awards N quest points, set 0 to disable.\n-    public static final int QUEST_POINT_PER_EVENT_CLEAR = 1;     //Each completed event instance awards N quest points, set 0 to disable.\n-    \n-    //Guild Configuration\n-    public static final int CREATE_GUILD_MIN_PARTNERS = 6;       //Minimum number of members on Guild Headquarters to establish a new guild.\n-    public static final int CREATE_GUILD_COST = 1500000;\n-    public static final int CHANGE_EMBLEM_COST = 5000000;\n-    public static final int EXPAND_GUILD_BASE_COST = 500000;\n-    public static final int EXPAND_GUILD_TIER_COST = 1000000;\n-    public static final int EXPAND_GUILD_MAX_COST = 5000000;\n-    \n-    //Family Configuration\n-    public static final int FAMILY_REP_PER_KILL = 4;             //Amount of rep gained per monster kill.\n-    public static final int FAMILY_REP_PER_BOSS_KILL = 20;       //Amount of rep gained per boss kill.\n-    public static final int FAMILY_REP_PER_LEVELUP = 200;        //Amount of rep gained upon leveling up.\n-    public static final int FAMILY_MAX_GENERATIONS = 1000;       //Maximum depth of family tree. (Distance from leader to farthest junior)\n-\n-    //Equipment Configuration\n-    public static final boolean USE_EQUIPMNT_LVLUP_SLOTS = true;//Equips can upgrade slots at level up.\n-    public static final boolean USE_EQUIPMNT_LVLUP_POWER = true;//Enable more powerful stat upgrades at equip level up.\n-    public static final boolean USE_EQUIPMNT_LVLUP_CASH = true; //Enable equip leveling up on cash equipments as well.\n-    public static final boolean USE_SPIKES_AVOID_BANISH = true; //Shoes equipped with spikes prevents mobs from banishing wearer.\n-    public static final int MAX_EQUIPMNT_LVLUP_STAT_UP = 10000; //Max stat upgrade an equipment can have on a levelup.\n-    public static final int MAX_EQUIPMNT_STAT = 32767;          //Max stat on an equipment by leveling up.\n-    public static final int USE_EQUIPMNT_LVLUP = 7;             //All equips lvlup at max level of N, set 1 to disable.\n-    \n-    //Map-Chair Configuration\n-    public static final boolean USE_CHAIR_EXTRAHEAL = true;     //Enable map chairs to further recover player's HP and MP (player must have the Chair Mastery skill).\n-    public static final byte CHAIR_EXTRA_HEAL_MULTIPLIER = 10;  //Due to only being able to be send up-to-255 heal values, values being actually updated is the one displayed times this.\n-    public static final int CHAIR_EXTRA_HEAL_MAX_DELAY = 21;    //Players are expected to recover fully after using this skill for N seconds.\n-    \n-    //Player NPC Configuration\n-    public static final int PLAYERNPC_INITIAL_X = 262;          //Map frame width for putting PlayerNPCs.\n-    public static final int PLAYERNPC_INITIAL_Y = 262;          //Map frame height for putting PlayerNPCs.\n-    public static final int PLAYERNPC_AREA_X = 320;             //Initial width gap between PlayerNPCs.\n-    public static final int PLAYERNPC_AREA_Y = 160;             //Initial height gap between PlayerNPCs.\n-    public static final int PLAYERNPC_AREA_STEPS = 4;           //Max number of times gap is shortened to comport PlayerNPCs.\n-    public static final boolean PLAYERNPC_ORGANIZE_AREA = true; //Automatically rearranges PlayerNPCs on the map if there is no space set the new NPC. Current distance gap between NPCs is decreased to solve this issue.\n-    public static final boolean PLAYERNPC_AUTODEPLOY = true;    //Makes PlayerNPC automatically deployed on the Hall of Fame at the instant one reaches max level. If false, eligible players must talk to 1st job instructor to deploy a NPC.\n-    \n-    //Pet Auto-Pot Configuration\n-    public static final boolean USE_COMPULSORY_AUTOPOT = true;  //Pets will consume as many potions as needed to fulfill the AUTOHP/MP ratio threshold.\n-    public static final boolean USE_EQUIPS_ON_AUTOPOT = true;   //Player MaxHP and MaxMP check values on autopot handler will be updated by the HP/MP bonuses on equipped items.\n-    public static final double PET_AUTOHP_RATIO = 0.99;         //Will automatically consume potions until given ratio of the MaxHP/MaxMP is reached.\n-    public static final double PET_AUTOMP_RATIO = 0.99;\n-    \n-    //Pet & Mount Configuration\n-    public static final byte PET_EXHAUST_COUNT = 3;             //Number of proc counts (1 per minute) on the exhaust schedule for fullness.\n-    public static final byte MOUNT_EXHAUST_COUNT = 1;           //Number of proc counts (1 per minute) on the exhaust schedule for tiredness.\n-    \n-    //Pet Hunger Configuration\n-    public static final boolean PETS_NEVER_HUNGRY = false;      //If true, pets and mounts will never grow hungry.\n-    public static final boolean GM_PETS_NEVER_HUNGRY = true;    //If true, pets and mounts owned by GMs will never grow hungry.\n-    \n-    //Event Configuration\n-    public static final int EVENT_MAX_GUILD_QUEUE = 10;         //Max number of guilds in queue for GPQ.\n-    public static final long EVENT_LOBBY_DELAY = 10;            //Cooldown duration in seconds before reopening an event lobby.\n-    \n-    //Dojo Configuration\n-    public static final boolean USE_FAST_DOJO_UPGRADE = true;   //Reduced Dojo training points amount required for a belt upgrade.\n-    public static final boolean USE_DEADLY_DOJO = false;        //Should bosses really use 1HP,1MP attacks in dojo?\n-    public static final int DOJO_ENERGY_ATK = 100;              //Dojo energy gain when deal attack\n-    public static final int DOJO_ENERGY_DMG =  20;              //Dojo energy gain when recv attack\n-    \n-    //Wedding Configuration\n-    public static final int WEDDING_RESERVATION_DELAY = 3;      //Minimum idle slots before processing a wedding reservation.\n-    public static final int WEDDING_RESERVATION_TIMEOUT = 10;   //Limit time in minutes for the couple to show up before cancelling the wedding reservation.\n-    public static final int WEDDING_RESERVATION_INTERVAL = 60;  //Time between wedding starts in minutes.\n-    public static final int WEDDING_BLESS_EXP = 30000;          //Exp gained per bless count.\n-    public static final int WEDDING_GIFT_LIMIT = 1;             //Max number of gifts per person to same wishlist on marriage instances.\n-    public static final boolean WEDDING_BLESSER_SHOWFX = true;  //Pops bubble sprite effect on players blessing the couple. Setting this false shows the blessing effect on the couple instead.\n-\n-    //Buyback Configuration\n-    public static final boolean USE_BUYBACK_WITH_MESOS = true;  //Enables usage of either mesos or NX for the buyback fee.\n-    public static final float BUYBACK_FEE = 77.70f;             //Sets the base amount needed to buyback (level 30 or under will use the base value).\n-    public static final float BUYBACK_LEVEL_STACK_FEE = 85.47f; //Sets the level-stacking portion of the amount needed to buyback (fee will sum up linearly until level 120, when it reaches the peak).\n-    public static final int BUYBACK_MESO_MULTIPLIER = 1000;     //Sets a multiplier for the fee when using meso as the charge unit.\n-    public static final int BUYBACK_RETURN_MINUTES = 1;         //Sets the maximum amount of time the player can wait before decide to buyback.\n-    public static final int BUYBACK_COOLDOWN_MINUTES = 7;       //Sets the time the player must wait before using buyback again.\n-    \n-    // Login timeout by shavit\n-    public static long TIMEOUT_DURATION = 3600000L;             // Kicks clients who don't send any packet to the game server in due time (in millisseconds).\n-    \n-    //Event End Timestamp\n-    public static final long EVENT_END_TIMESTAMP = 1428897600000L;\n-\n     //Debug Variables\n     public static int DEBUG_VALUES[] = new int[10];             // Field designed for packet testing purposes\n-\n+    \n     // https://github.com/openstreetmap/josm/blob/a3a6e8a6b657cf4c5b4c64ea14d6e87be6280d65/src/org/openstreetmap/josm/tools/Utils.java#L1566-L1585\n     /**\n      * Returns the Java version as an int value."}, {"sha": "b62b90208c0e320be10a370e2d0333119962c6f1", "filename": "src/constants/skills/FPWizard.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/constants/skills/FPWizard.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/constants/skills/FPWizard.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/skills/FPWizard.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -29,5 +29,6 @@\n     public static final int MP_EATER = 2100000;\n     public static final int MEDITATION = 2101001;\n     public static final int SLOW = 2101003;\n+    public static final int FIRE_ARROW = 2101004;\n     public static final int POISON_BREATH = 2101005;\n }"}, {"sha": "9ca9dfdf392bf1613e28836a74cfdf944ca1be86", "filename": "src/net/server/Server.java", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -862,7 +862,7 @@ public void init() {\n         }\n         applyAllNameChanges(); //name changes can be missed by INSTANT_NAME_CHANGE\n         applyAllWorldTransfers();\n-        MaplePet.clearMissingPetsFromDb();\n+        //MaplePet.clearMissingPetsFromDb();    // thanks Optimist for noticing this taking too long to run\n         MapleCashidGenerator.loadExistentCashIdsFromDb();\n         \n         IoBuffer.setUseDirectBuffer(false);\n@@ -877,17 +877,17 @@ public void init() {\n         disconnectIdlesOnLoginTask();\n         \n         long timeLeft = getTimeLeftForNextHour();\n-        tMan.register(new CharacterDiseaseTask(), ServerConstants.UPDATE_INTERVAL, ServerConstants.UPDATE_INTERVAL);\n+        tMan.register(new CharacterDiseaseTask(), YamlConfig.config.server.UPDATE_INTERVAL, YamlConfig.config.server.UPDATE_INTERVAL);\n         tMan.register(new ReleaseLockTask(), 2 * 60 * 1000, 2 * 60 * 1000);\n-        tMan.register(new CouponTask(), ServerConstants.COUPON_INTERVAL, timeLeft);\n+        tMan.register(new CouponTask(), YamlConfig.config.server.COUPON_INTERVAL, timeLeft);\n         tMan.register(new RankingCommandTask(), 5 * 60 * 1000, 5 * 60 * 1000);\n-        tMan.register(new RankingLoginTask(), ServerConstants.RANKING_INTERVAL, timeLeft);\n+        tMan.register(new RankingLoginTask(), YamlConfig.config.server.RANKING_INTERVAL, timeLeft);\n         tMan.register(new LoginCoordinatorTask(), 60 * 60 * 1000, timeLeft);\n         tMan.register(new EventRecallCoordinatorTask(), 60 * 60 * 1000, timeLeft);\n         tMan.register(new LoginStorageTask(), 2 * 60 * 1000, 2 * 60 * 1000);\n         tMan.register(new DueyFredrickTask(), 60 * 60 * 1000, timeLeft);\n         tMan.register(new InvitationTask(), 30 * 1000, 30 * 1000);\n-        tMan.register(new RespawnTask(), ServerConstants.RESPAWN_INTERVAL, ServerConstants.RESPAWN_INTERVAL);\n+        tMan.register(new RespawnTask(), YamlConfig.config.server.RESPAWN_INTERVAL, YamlConfig.config.server.RESPAWN_INTERVAL);\n         \n         timeLeft = getTimeLeftForNextDay();\n         MapleExpeditionBossLog.resetBossLogTable();\n@@ -952,6 +952,10 @@ public void init() {\n         MapleSkillbookInformationProvider.getInstance();\n         OpcodeConstants.generateOpcodeNames();\n         CommandsExecutor.getInstance();\n+        \n+        for (Channel ch : this.getAllChannels()) {\n+            ch.reloadEventScriptManager();\n+        }\n     }\n \n     public static void main(String args[]) {"}, {"sha": "13542c73b2e96dab46d1a8011dc3c762f8657ab9", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,13 +21,6 @@\n  */\n package net.server.channel;\n \n-import net.server.channel.task.FaceExpressionScheduler;\n-import net.server.channel.task.MobMistScheduler;\n-import net.server.channel.task.OverallScheduler;\n-import net.server.channel.task.MobAnimationScheduler;\n-import net.server.channel.task.MobStatusScheduler;\n-import net.server.channel.task.MobClearSkillScheduler;\n-import net.server.channel.task.EventScheduler;\n import java.io.File;\n import java.net.InetSocketAddress;\n import java.util.ArrayList;\n@@ -57,6 +50,7 @@\n \n import net.server.PlayerStorage;\n import net.server.Server;\n+import net.server.channel.task.*;\n \n import net.server.world.World;\n import net.server.world.MapleParty;\n@@ -84,7 +78,6 @@\n import tools.Pair;\n import client.MapleCharacter;\n import client.status.MonsterStatusEffect;\n-import constants.net.ServerConstants;\n import server.maps.MapleMiniDungeonInfo;\n \n public final class Channel {\n@@ -148,7 +141,6 @@ public Channel(final int world, final int channel, long startTime) {\n         this.ongoingStartTime = startTime + 10000;  // rude approach to a world's last channel boot time, placeholder for the 1st wedding reservation ever\n         this.mapManager = new MapleMapManager(null, world, channel);\n         try {\n-            eventSM = new EventScriptManager(this, getEvents());\n             port = 7575 + this.channel - 1;\n             port += (world * 100);\n             ip = YamlConfig.config.server.HOST + \":\" + port;\n@@ -163,7 +155,14 @@ public Channel(final int world, final int channel, long startTime) {\n             for (MapleExpeditionType exped : MapleExpeditionType.values()) {\n             \texpedType.add(exped);\n             }\n-            eventSM.init();\n+            \n+            if (Server.getInstance().isOnline()) {  // postpone event loading to improve boot time... thanks Riizade, daronhudson for noticing slow startup times\n+                eventSM = new EventScriptManager(this, getEvents());\n+                eventSM.init();\n+            } else {\n+                String[] ev = {};\n+                eventSM = new EventScriptManager(null, ev);\n+            }\n             \n             dojoStage = new int[20];\n             dojoFinishTime = new long[20];\n@@ -493,6 +492,11 @@ public boolean isConnected(String name) {\n         return getPlayerStorage().getCharacterByName(name) != null;\n     }\n     \n+    public boolean isActive() {\n+        EventScriptManager esm = this.getEventSM();\n+        return esm != null && esm.isActive();\n+    }\n+    \n     public boolean finishedShutdown() {\n         return finishedShutdown;\n     }"}, {"sha": "cee5019ea56191b36c7d62251d9d0c386c89f9fb", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -163,9 +163,11 @@ protected void applyAttack(AttackInfo attack, final MapleCharacter player, int a\n                 int mobCount = attackEffect.getMobCount();\n                 if (attack.skill != Cleric.HEAL) {\n                     if (player.isAlive()) {\n-                        if(attack.skill == NightWalker.POISON_BOMB) {// Poison Bomb\n+                        if(attack.skill == Aran.BODY_PRESSURE || attack.skill == Marauder.ENERGY_CHARGE || attack.skill == ThunderBreaker.ENERGY_CHARGE) {  // thanks IxianMace for noticing Energy Charge skills refreshing on touch, leading to misleading buff applies\n+                            // prevent touch dmg skills refreshing\n+                        } else if(attack.skill == NightWalker.POISON_BOMB) {// Poison Bomb\n                             attackEffect.applyTo(player, new Point(attack.position.x, attack.position.y));\n-                        } else if(attack.skill != Aran.BODY_PRESSURE) {// prevent BP refreshing\n+                        } else {\n                             attackEffect.applyTo(player);\n                             \n                             if (attack.skill == DawnWarrior.FINAL_ATTACK || attack.skill == Page.FINAL_ATTACK_BW || attack.skill == Page.FINAL_ATTACK_SWORD || attack.skill == Fighter.FINAL_ATTACK_SWORD"}, {"sha": "621946e15dedbe7f57a6b75058df717d3fe18495", "filename": "src/net/server/channel/handlers/AbstractMovementPacketHandler.java", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/AbstractMovementPacketHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/AbstractMovementPacketHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractMovementPacketHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -34,10 +34,11 @@\n import server.movement.RelativeLifeMovement;\n import server.movement.TeleportMovement;\n import tools.data.input.LittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n public abstract class AbstractMovementPacketHandler extends AbstractMaplePacketHandler {\n \n-    protected List<LifeMovementFragment> parseMovement(LittleEndianAccessor lea) {\n+    protected List<LifeMovementFragment> parseMovement(LittleEndianAccessor lea) throws EmptyMovementException {\n         List<LifeMovementFragment> res = new ArrayList<>();\n         byte numCommands = lea.readByte();\n         for (byte i = 0; i < numCommands; i++) {\n@@ -138,15 +139,20 @@\n                 }\n                 default:\n                     System.out.println(\"Unhandled Case:\" + command);\n-                    return null;\n+                    throw new EmptyMovementException(lea);\n             }\n         }\n+        \n+        if (res.isEmpty()) {\n+            throw new EmptyMovementException(lea);\n+        }\n         return res;\n     }\n     \n-    protected void updatePosition(LittleEndianAccessor lea, AnimatedMapleMapObject target, int yOffset) {\n+    protected void updatePosition(LittleEndianAccessor lea, AnimatedMapleMapObject target, int yOffset) throws EmptyMovementException {\n     \t\n         byte numCommands = lea.readByte();\n+        if (numCommands < 1) throw new EmptyMovementException(lea);\n         for (byte i = 0; i < numCommands; i++) {\n             byte command = lea.readByte();\n             switch (command) {\n@@ -233,6 +239,5 @@ protected void updatePosition(LittleEndianAccessor lea, AnimatedMapleMapObject t\n                     return;\n             }\n         }\n-        return;\n     }\n }"}, {"sha": "0e9e67cf20e7e886be71406d270da31a08daa8f7", "filename": "src/net/server/channel/handlers/BBSOperationHandler.java", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/BBSOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/BBSOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/BBSOperationHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -149,8 +149,8 @@ private static void newBBSReply(MapleClient c, int localthreadid, String text) {\n     }\n \n     private static void editBBSThread(MapleClient client, String title, String text, int icon, int localthreadid) {\n-        MapleCharacter c = client.getPlayer();\n-        if (c.getGuildId() < 1) {\n+        MapleCharacter chr = client.getPlayer();\n+        if (chr.getGuildId() < 1) {\n             return;\n         }\n         try {\n@@ -160,10 +160,10 @@ private static void editBBSThread(MapleClient client, String title, String text,\n                 ps.setLong(2, currentServerTime());\n                 ps.setInt(3, icon);\n                 ps.setString(4, text);\n-                ps.setInt(5, c.getGuildId());\n+                ps.setInt(5, chr.getGuildId());\n                 ps.setInt(6, localthreadid);\n-                ps.setInt(7, c.getId());\n-                ps.setBoolean(8, c.getGuildRank() < 3);\n+                ps.setInt(7, chr.getId());\n+                ps.setBoolean(8, chr.getGuildRank() < 3);\n                 ps.execute();\n             }\n             con.close();\n@@ -174,8 +174,8 @@ private static void editBBSThread(MapleClient client, String title, String text,\n     }\n \n     private static void newBBSThread(MapleClient client, String title, String text, int icon, boolean bNotice) {\n-        MapleCharacter c = client.getPlayer();\n-        if (c.getGuildId() <= 0) {\n+        MapleCharacter chr = client.getPlayer();\n+        if (chr.getGuildId() <= 0) {\n             return;\n         }\n         int nextId = 0;\n@@ -184,20 +184,20 @@ private static void newBBSThread(MapleClient client, String title, String text,\n             PreparedStatement ps;\n             if (!bNotice) {\n                 ps = con.prepareStatement(\"SELECT MAX(localthreadid) AS lastLocalId FROM bbs_threads WHERE guildid = ?\");\n-                ps.setInt(1, c.getGuildId());\n+                ps.setInt(1, chr.getGuildId());\n                 try (ResultSet rs = ps.executeQuery()) {\n                     rs.next();\n                     nextId = rs.getInt(\"lastLocalId\") + 1;\n                 }\n                 ps.close();\n             }\n             ps = con.prepareStatement(\"INSERT INTO bbs_threads \" + \"(`postercid`, `name`, `timestamp`, `icon`, `startpost`, \" + \"`guildid`, `localthreadid`) \" + \"VALUES(?, ?, ?, ?, ?, ?, ?)\");\n-            ps.setInt(1, c.getId());\n+            ps.setInt(1, chr.getId());\n             ps.setString(2, title);\n             ps.setLong(3, currentServerTime());\n             ps.setInt(4, icon);\n             ps.setString(5, text);\n-            ps.setInt(6, c.getGuildId());\n+            ps.setInt(6, chr.getGuildId());\n             ps.setInt(7, nextId);\n             ps.execute();\n             ps.close();"}, {"sha": "3a8e812b64faf9c7291db4b1bd90b64a93c89051", "filename": "src/net/server/channel/handlers/MagicDamageHandler.java", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MagicDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MagicDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MagicDamageHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -30,7 +30,6 @@\n import client.MapleClient;\n import client.Skill;\n import client.SkillFactory;\n-import constants.net.ServerConstants;\n import constants.skills.Bishop;\n import constants.skills.Evan;\n import constants.skills.FPArchMage;\n@@ -63,13 +62,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         c.announce(MaplePacketCreator.getEnergy(\"energy\", chr.getDojoEnergy()));\n                 }\n \n-                byte[] packet;\n-                if ((attack.skill == Evan.FIRE_BREATH || attack.skill == Evan.ICE_BREATH || attack.skill == FPArchMage.BIG_BANG || attack.skill == ILArchMage.BIG_BANG || attack.skill == Bishop.BIG_BANG)) {\n-                        packet = MaplePacketCreator.magicAttack(chr, attack.skill, attack.skilllevel, attack.stance, attack.numAttackedAndDamage, attack.allDamage, attack.charge, attack.speed, attack.direction, attack.display);\n-                } else {\n-                        packet = MaplePacketCreator.closeRangeAttack(chr, attack.skill, attack.skilllevel, attack.stance, attack.numAttackedAndDamage, attack.allDamage, attack.speed, attack.direction, attack.display);\n-                }\n-                \n+                int charge = (attack.skill == Evan.FIRE_BREATH || attack.skill == Evan.ICE_BREATH || attack.skill == FPArchMage.BIG_BANG || attack.skill == ILArchMage.BIG_BANG || attack.skill == Bishop.BIG_BANG) ? attack.charge : -1;\n+                byte[] packet = MaplePacketCreator.magicAttack(chr, attack.skill, attack.skilllevel, attack.stance, attack.numAttackedAndDamage, attack.allDamage, charge, attack.speed, attack.direction, attack.display);\n+\t\t\n \t\tchr.getMap().broadcastMessage(chr, packet, false, true);\n \t\tMapleStatEffect effect = attack.getAttackEffect(chr, null);\n \t\tSkill skill = SkillFactory.getSkill(attack.skill);"}, {"sha": "d66e0abac0addd8cc73365d96d0aade0f8d4bf26", "filename": "src/net/server/channel/handlers/MoveDragonHandler.java", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveDragonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveDragonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveDragonHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -28,26 +28,28 @@\n import server.maps.MapleDragon;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n \n public class MoveDragonHandler extends AbstractMovementPacketHandler {\n     @Override\n     public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         final MapleCharacter chr = c.getPlayer();\n         final Point startPos = new Point(slea.readShort(), slea.readShort());\n-        long movementDataStart = slea.getPosition();\n         final MapleDragon dragon = chr.getDragon();\n         if (dragon != null) {\n-            updatePosition(slea, dragon, 0);\n-            long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n-            if (movementDataLength > 0) {\n+            try {\n+                long movementDataStart = slea.getPosition();\n+                updatePosition(slea, dragon, 0);\n+                long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n                 slea.seek(movementDataStart);\n+                \n                 if (chr.isHidden()) {\n                     chr.getMap().broadcastGMMessage(chr, MaplePacketCreator.moveDragon(dragon, startPos, slea, movementDataLength));\n                 } else {\n                     chr.getMap().broadcastMessage(chr, MaplePacketCreator.moveDragon(dragon, startPos, slea, movementDataLength), dragon.getPosition());\n                 }\n-            }\n+            } catch (EmptyMovementException e) {}\n         }\n     }\n }\n\\ No newline at end of file"}, {"sha": "3097dffbfc3506b0b745e7ccfade39132f065f8d", "filename": "src/net/server/channel/handlers/MoveLifeHandler.java", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveLifeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveLifeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveLifeHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -41,6 +41,7 @@\n import tools.Pair;\n import tools.Randomizer;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n /**\n  * @author Danny (Leifde)\n@@ -142,11 +143,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\tshort start_y = slea.readShort(); // hmm...\n \t\tPoint startPos = new Point(start_x, start_y - 2);\n \t\tPoint serverStartPos = new Point(monster.getPosition());\n-\t\tlong movementDataStart = slea.getPosition();\n                 \n-                updatePosition(slea, monster, -2);  // Thanks Doodle and ZERO\u5091\u6d1b for noticing sponge-based bosses moving out of stage in case of no-offset applied\n-                long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n-\n                 Boolean aggro = monster.aggroMoveLifeUpdate(player);\n                 if (aggro == null) return;\n \n@@ -156,15 +153,21 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\tc.announce(MaplePacketCreator.moveMonsterResponse(objectid, moveid, mobMp, aggro));\n \t\t}\n                 \n-\t\tif (movementDataLength > 0) {\n-            if (YamlConfig.config.server.USE_DEBUG_SHOW_RCVD_MVLIFE) {\n-                System.out.println((isSkill ? \"SKILL \" : (isAttack ? \"ATTCK \" : \" \")) + \"castPos: \" + castPos + \" rawAct: \" + rawActivity + \" opt: \" + pOption + \" skillID: \" + useSkillId + \" skillLV: \" + useSkillLevel + \" \" + \"allowSkill: \" + nextMovementCouldBeSkill + \" mobMp: \" + mobMp);\n-            }\n-            slea.seek(movementDataStart);\n-            map.broadcastMessage(player, MaplePacketCreator.moveMonster(objectid, nextMovementCouldBeSkill, rawActivity, useSkillId, useSkillLevel, pOption, startPos, slea, movementDataLength), serverStartPos);\n-\t\t\t//updatePosition(res, monster, -2); //does this need to be done after the packet is broadcast?\n-\t\t\tmap.moveMonster(monster, monster.getPosition());\n-\t\t}\n+                \n+                try {\n+                        long movementDataStart = slea.getPosition();\n+                        updatePosition(slea, monster, -2);  // Thanks Doodle and ZERO\u5091\u6d1b for noticing sponge-based bosses moving out of stage in case of no-offset applied\n+                        long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n+                        slea.seek(movementDataStart);\n+                        \n+                        if (YamlConfig.config.server.USE_DEBUG_SHOW_RCVD_MVLIFE) {\n+                                System.out.println((isSkill ? \"SKILL \" : (isAttack ? \"ATTCK \" : \" \")) + \"castPos: \" + castPos + \" rawAct: \" + rawActivity + \" opt: \" + pOption + \" skillID: \" + useSkillId + \" skillLV: \" + useSkillLevel + \" \" + \"allowSkill: \" + nextMovementCouldBeSkill + \" mobMp: \" + mobMp);\n+                        }\n+                        \n+                        map.broadcastMessage(player, MaplePacketCreator.moveMonster(objectid, nextMovementCouldBeSkill, rawActivity, useSkillId, useSkillLevel, pOption, startPos, slea, movementDataLength), serverStartPos);\n+                        //updatePosition(res, monster, -2); //does this need to be done after the packet is broadcast?\n+                        map.moveMonster(monster, monster.getPosition());\n+                } catch (EmptyMovementException e) {}\n                 \n                 if (banishPlayers != null) {\n                         for (MapleCharacter chr : banishPlayers) {"}, {"sha": "fd8b120ab78a102702771361221cbdf2598be5cb", "filename": "src/net/server/channel/handlers/MovePetHandler.java", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MovePetHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MovePetHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MovePetHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -27,15 +27,19 @@\n import server.movement.LifeMovementFragment;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n public final class MovePetHandler extends AbstractMovementPacketHandler {\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         int petId = slea.readInt();\n         slea.readLong();\n //        Point startPos = StreamUtil.readShortPoint(slea);\n-        List<LifeMovementFragment> res = parseMovement(slea);\n-        if (res == null || res.isEmpty()) {\n+        List<LifeMovementFragment> res;\n+        \n+        try {\n+            res = parseMovement(slea);\n+        } catch (EmptyMovementException e) {\n             return;\n         }\n         MapleCharacter player = c.getPlayer();"}, {"sha": "85fc54695121a9ae22fede2abb6cc38cd6cfc09d", "filename": "src/net/server/channel/handlers/MovePlayerHandler.java", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MovePlayerHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MovePlayerHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MovePlayerHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -24,22 +24,24 @@\n import client.MapleClient;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n public final class MovePlayerHandler extends AbstractMovementPacketHandler {\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         slea.skip(9);\n-        long movementDataStart = slea.getPosition();\n-        updatePosition(slea, c.getPlayer(), 0);\n-        long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n-        if (movementDataLength > 0) {\n-        \tslea.seek(movementDataStart);\n+        try {   // thanks Sa for noticing empty movement sequences crashing players\n+            long movementDataStart = slea.getPosition();\n+            updatePosition(slea, c.getPlayer(), 0);\n+            long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n+            slea.seek(movementDataStart);\n+            \n             c.getPlayer().getMap().movePlayer(c.getPlayer(), c.getPlayer().getPosition());\n             if (c.getPlayer().isHidden()) {\n                 c.getPlayer().getMap().broadcastGMMessage(c.getPlayer(), MaplePacketCreator.movePlayer(c.getPlayer().getId(), slea, movementDataLength), false);\n             } else {\n                 c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.movePlayer(c.getPlayer().getId(), slea, movementDataLength), false);\n             }\n-        }\n+        } catch (EmptyMovementException e) {}\n     }\n }"}, {"sha": "a6cf0a4420b6290f82fb3e3ecc6242d3fb802221", "filename": "src/net/server/channel/handlers/MoveSummonHandler.java", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveSummonHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/MoveSummonHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MoveSummonHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -29,6 +29,7 @@\n import server.maps.MapleSummon;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n+import tools.exceptions.EmptyMovementException;\n \n public final class MoveSummonHandler extends AbstractMovementPacketHandler {\n     @Override\n@@ -45,11 +46,14 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n         }\n         if (summon != null) {\n-            long movementDataStart = slea.getPosition();\n-            updatePosition(slea, summon, 0);\n-            long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n-            slea.seek(movementDataStart);\n-            player.getMap().broadcastMessage(player, MaplePacketCreator.moveSummon(player.getId(), oid, startPos, slea, movementDataLength), summon.getPosition());\n+            try {\n+                long movementDataStart = slea.getPosition();\n+                updatePosition(slea, summon, 0);\n+                long movementDataLength = slea.getPosition() - movementDataStart; //how many bytes were read by updatePosition\n+                slea.seek(movementDataStart);\n+                \n+                player.getMap().broadcastMessage(player, MaplePacketCreator.moveSummon(player.getId(), oid, startPos, slea, movementDataLength), summon.getPosition());\n+            } catch (EmptyMovementException e) {}\n         }\n     }\n }"}, {"sha": "1e20797d528ac4e08599a3950a444600e827aa0d", "filename": "src/net/server/channel/handlers/PetAutoPotHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PetAutoPotHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PetAutoPotHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetAutoPotHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,12 +43,12 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleStatEffect stat = MapleItemInformationProvider.getInstance().getItemEffect(itemId);\n         if (stat.getHp() > 0 || stat.getHpRate() > 0.0) {\n             float estimatedHp = ((float) chr.getHp()) / chr.getMaxHp();\n-            chr.setAutopotHpAlert(estimatedHp);\n+            chr.setAutopotHpAlert(estimatedHp + 0.05f);\n         }\n         \n         if (stat.getMp() > 0 || stat.getMpRate() > 0.0) {\n             float estimatedMp = ((float) chr.getMp()) / chr.getMaxMp();\n-            chr.setAutopotMpAlert(estimatedMp);\n+            chr.setAutopotMpAlert(estimatedMp + 0.05f);\n         }\n         \n         PetAutopotProcessor.runAutopotAction(c, slot, itemId);"}, {"sha": "34b43627c84af0e93321715ad9f1d49c85d1c9ce", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -116,13 +116,16 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n \n                 Channel cserv = wserv.getChannel(c.getChannel());\n-                if(cserv == null) {\n+                if(cserv == null || !cserv.isActive()) {\n                     c.setChannel(1);\n                     cserv = wserv.getChannel(c.getChannel());\n \n                     if(cserv == null) {\n                         c.disconnect(true, false);\n                         return;\n+                    } else if (!cserv.isActive()) {\n+                        c.announce(MaplePacketCreator.getAfterLoginError(7));\n+                        return;\n                     }\n                 }\n "}, {"sha": "0828593921e3b243f7eb90cbd69046adbbe46d62", "filename": "src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/PlayerMapTransitionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerMapTransitionHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -51,19 +51,21 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             chr.announce(MaplePacketCreator.giveBuff(1, beaconid, stat));\n         }\n         \n-        for (MapleMapObject mo : chr.getMap().getMonsters()) {    // thanks BHB, IxianMace, Jefe for noticing several issues regarding mob statuses (such as freeze)\n-            MapleMonster m = (MapleMonster) mo;\n-            if (m.getSpawnEffect() == 0 || m.getHp() < m.getMaxHp()) {     // avoid effect-spawning mobs\n-                if (m.getController() == chr) {\n-                    c.announce(MaplePacketCreator.stopControllingMonster(m.getObjectId()));\n-                    m.sendDestroyData(c);\n-                    m.aggroRedirectController();\n-                } else {\n-                    m.sendDestroyData(c);\n-                }\n+        if (!chr.isHidden()) {  // thanks Lame for noticing hidden characters controlling mobs\n+            for (MapleMapObject mo : chr.getMap().getMonsters()) {    // thanks BHB, IxianMace, Jefe for noticing several issues regarding mob statuses (such as freeze)\n+                MapleMonster m = (MapleMonster) mo;\n+                if (m.getSpawnEffect() == 0 || m.getHp() < m.getMaxHp()) {     // avoid effect-spawning mobs\n+                    if (m.getController() == chr) {\n+                        c.announce(MaplePacketCreator.stopControllingMonster(m.getObjectId()));\n+                        m.sendDestroyData(c);\n+                        m.aggroRedirectController();\n+                    } else {\n+                        m.sendDestroyData(c);\n+                    }\n \n-                m.aggroSwitchController(chr, false);\n-                m.sendSpawnData(c);\n+                    m.aggroSwitchController(chr, false);\n+                    m.sendSpawnData(c);\n+                }\n             }\n         }\n     }"}, {"sha": "89c3dd3c2a61792d9560f2fb12caf6047f5dc5a6", "filename": "src/net/server/channel/handlers/RaiseIncExpHandler.java", "status": "modified", "additions": 22, "deletions": 8, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/RaiseIncExpHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/RaiseIncExpHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RaiseIncExpHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -2,13 +2,17 @@\n \n import java.util.Map;\n \n+import client.MapleCharacter;\n import client.MapleClient;\n+import client.MapleQuestStatus;\n import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import net.AbstractMaplePacketHandler;\n import client.inventory.manipulator.MapleInventoryManipulator;\n import server.MapleItemInformationProvider;\n import server.MapleItemInformationProvider.QuestConsItem;\n+import server.quest.MapleQuest;\n+import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n /**\n@@ -22,7 +26,7 @@\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         byte inventorytype = slea.readByte();//nItemIT\n         short slot = slea.readShort();//nSlotPosition\n-        int itemid = slea.readInt();//nItemID    \n+        int itemid = slea.readInt();//nItemID\n         \n         if (c.tryacquireClient()) {\n             try {\n@@ -32,25 +36,35 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     return;\n                 }\n \n-                int questid = consItem.questid;\n+                int infoNumber = consItem.questid;\n                 Map<Integer, Integer> consumables = consItem.items;\n-\n+                \n+                MapleCharacter chr = c.getPlayer();\n+                MapleQuest quest = MapleQuest.getInstanceFromInfoNumber(infoNumber);\n+                if (!chr.getQuest(quest).getStatus().equals(MapleQuestStatus.Status.STARTED)) {\n+                    c.announce(MaplePacketCreator.enableActions());\n+                    return;\n+                }\n+                \n                 int consId;\n-                MapleInventory inv = c.getPlayer().getInventory(MapleInventoryType.getByType(inventorytype));\n+                MapleInventory inv = chr.getInventory(MapleInventoryType.getByType(inventorytype));\n                 inv.lockInventory();\n                 try {\n                     consId = inv.getItem(slot).getItemId();\n-                    if (!consumables.containsKey(consId) || !c.getPlayer().haveItem(consId)) {\n+                    if (!consumables.containsKey(consId) || !chr.haveItem(consId)) {\n                         return;\n                     }\n \n                     MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.getByType(inventorytype), (short) slot, (short) 1, false, true);\n                 } finally {\n                     inv.unlockInventory();\n                 }\n-\n-                int nextValue = Math.min(consumables.get(consId) + Integer.parseInt(c.getPlayer().getQuestInfo(questid)), consItem.exp * consItem.grade);\n-                c.getPlayer().updateQuestInfo(questid, \"\" + nextValue);\n+                \n+                int questid = quest.getId();\n+                int nextValue = Math.min(consumables.get(consId) + c.getAbstractPlayerInteraction().getQuestProgressInt(questid, infoNumber), consItem.exp * consItem.grade);\n+                c.getAbstractPlayerInteraction().setQuestProgress(questid, infoNumber, nextValue);\n+                \n+                c.announce(MaplePacketCreator.enableActions());\n             } finally {\n                 c.releaseClient();\n             }"}, {"sha": "287de88347138295b5a64b01cae53f85d3182756", "filename": "src/net/server/channel/handlers/RaiseUIStateHandler.java", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/RaiseUIStateHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/channel/handlers/RaiseUIStateHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RaiseUIStateHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -1,9 +1,11 @@\n package net.server.channel.handlers;\n \n import client.MapleCharacter.DelayedQuestUpdate;\n+import client.MapleCharacter;\n import client.MapleClient;\n import client.MapleQuestStatus;\n import net.AbstractMaplePacketHandler;\n+import scripting.quest.QuestScriptManager;\n import server.quest.MapleQuest;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n@@ -15,19 +17,21 @@\n \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        int questid = slea.readShort();\n+        int infoNumber = slea.readShort();\n         \n         if (c.tryacquireClient()) {\n             try {\n-                MapleQuest quest = MapleQuest.getInstance(questid);\n-                MapleQuestStatus mqs = c.getPlayer().getQuest(quest);\n+                MapleCharacter chr = c.getPlayer();\n+                MapleQuest quest = MapleQuest.getInstanceFromInfoNumber(infoNumber);\n+                MapleQuestStatus mqs = chr.getQuest(quest);\n+                \n+                QuestScriptManager.getInstance().raiseOpen(c, (short) infoNumber, mqs.getNpc());\n+                \n                 if (mqs.getStatus() == MapleQuestStatus.Status.NOT_STARTED) {\n-                    quest.forceStart(c.getPlayer(), 22000);\n-                    c.getPlayer().updateQuestInfo(quest.getId(), \"0\"); \n+                    quest.forceStart(chr, 22000);\n+                    c.getAbstractPlayerInteraction().setQuestProgress(quest.getId(), infoNumber, 0);\n                 } else if (mqs.getStatus() == MapleQuestStatus.Status.STARTED) {\n-                    c.getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, mqs, false);\n-                } else {\n-                    //c.announce(MaplePacketCreator.updateQuestInfo(mqs.getQuestID(), 22000, \"0\"));\n+                    chr.announceUpdateQuest(DelayedQuestUpdate.UPDATE, mqs, mqs.getInfoNumber() > 0);\n                 }\n             } finally {\n                 c.releaseClient();"}, {"sha": "aff55becbaa12cd06a1bf1f06a6a550570806f98", "filename": "src/net/server/guild/MapleGuildCharacter.java", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/guild/MapleGuildCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/guild/MapleGuildCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/guild/MapleGuildCharacter.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -35,22 +35,22 @@\n     private boolean online;\n     private String name;\n \n-    public MapleGuildCharacter(MapleCharacter c) {\n-        this.character = c;\n-        this.name = c.getName();\n-        this.level = c.getLevel();\n-        this.id = c.getId();\n-        this.channel = c.getClient().getChannel();\n-        this.world = c.getWorld();\n-        this.jobid = c.getJob().getId();\n-        this.guildrank = c.getGuildRank();\n-        this.guildid = c.getGuildId();\n+    public MapleGuildCharacter(MapleCharacter chr) {\n+        this.character = chr;\n+        this.name = chr.getName();\n+        this.level = chr.getLevel();\n+        this.id = chr.getId();\n+        this.channel = chr.getClient().getChannel();\n+        this.world = chr.getWorld();\n+        this.jobid = chr.getJob().getId();\n+        this.guildrank = chr.getGuildRank();\n+        this.guildid = chr.getGuildId();\n         this.online = true;\n-        this.allianceRank = c.getAllianceRank();\n+        this.allianceRank = chr.getAllianceRank();\n     }\n \n-    public MapleGuildCharacter(MapleCharacter c, int _id, int _lv, String _name, int _channel, int _world, int _job, int _rank, int _gid, boolean _on, int _allianceRank) {\n-        this.character = c;\n+    public MapleGuildCharacter(MapleCharacter chr, int _id, int _lv, String _name, int _channel, int _world, int _job, int _rank, int _gid, boolean _on, int _allianceRank) {\n+        this.character = chr;\n         this.level = _lv;\n         this.id = _id;\n         this.name = _name;"}, {"sha": "547156edfd1122e47c1b42cf843900817521eb41", "filename": "src/net/server/handlers/login/CharlistRequestHandler.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/handlers/login/CharlistRequestHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/handlers/login/CharlistRequestHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharlistRequestHandler.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -24,6 +24,7 @@\n import client.MapleClient;\n import net.AbstractMaplePacketHandler;\n import net.server.Server;\n+import net.server.channel.Channel;\n import net.server.world.World;\n import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n@@ -42,7 +43,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n         \n         int channel = slea.readByte() + 1;\n-        if(wserv.getChannel(channel) == null) {\n+        Channel ch = wserv.getChannel(channel);\n+        if(ch == null || !ch.isActive()) {\n             c.announce(MaplePacketCreator.getServerStatus(2));\n             return;\n         }"}, {"sha": "6847f5ca7d352c451c32115354596a7392903f01", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -212,7 +212,7 @@ public World(int world, int flag, String eventmsg, int exprate, int droprate, in\n         merchantSchedule = tman.register(new HiredMerchantTask(this), 10 * 60 * 1000, 10 * 60 * 1000);\n         timedMapObjectsSchedule = tman.register(new TimedMapObjectTask(this), 60 * 1000, 60 * 1000);\n         charactersSchedule = tman.register(new CharacterAutosaverTask(this), 60 * 60 * 1000, 60 * 60 * 1000);\n-        marriagesSchedule = tman.register(new WeddingReservationTask(this), ServerConstants.WEDDING_RESERVATION_INTERVAL * 60 * 1000, ServerConstants.WEDDING_RESERVATION_INTERVAL * 60 * 1000);\n+        marriagesSchedule = tman.register(new WeddingReservationTask(this), YamlConfig.config.server.WEDDING_RESERVATION_INTERVAL * 60 * 1000, YamlConfig.config.server.WEDDING_RESERVATION_INTERVAL * 60 * 1000);\n         mapOwnershipSchedule = tman.register(new MapOwnershipTask(this), 20 * 1000, 20 * 1000);\n         fishingSchedule = tman.register(new FishingTask(this), 10 * 1000, 10 * 1000);\n         partySearchSchedule = tman.register(new PartySearchTask(this), 10 * 1000, 10 * 1000);\n@@ -730,14 +730,14 @@ public void changeEmblem(int gid, List<Integer> affectedPlayers, MapleGuildSumma\n     }\n \n     public void sendPacket(List<Integer> targetIds, final byte[] packet, int exception) {\n-        MapleCharacter c;\n+        MapleCharacter chr;\n         for (int i : targetIds) {\n             if (i == exception) {\n                 continue;\n             }\n-            c = getPlayerStorage().getCharacterById(i);\n-            if (c != null) {\n-                c.getClient().announce(packet);\n+            chr = getPlayerStorage().getCharacterById(i);\n+            if (chr != null) {\n+                chr.getClient().announce(packet);\n             }\n         }\n     }"}, {"sha": "b7528f8fc3e493d8696ba14356672de9ba54427e", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 69, "deletions": 68, "changes": 137, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -365,104 +365,101 @@ public void openNpc(int npcid, String script) {\n \t\tNPCScriptManager.getInstance().start(c, npcid, script, null);\n \t}\n \n-        public void updateQuest(int questid, int data) {\n-            MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(questid));\n-            updateQuest(questid, status.getAnyProgressKey(), data);\n-        }\n-        \n-        public void updateQuest(int questid, String data) {\n-            MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(questid));\n-            updateQuest(questid, status.getAnyProgressKey(), data);\n-        }\n-        \n-        public void updateQuest(int questid, int pid, int data) {\n-            updateQuest(questid, pid, String.valueOf(data));\n-        }\n-        \n-\tpublic void updateQuest(int questid, int pid, String data) {\n-\t\tMapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(questid));\n-\t\tstatus.setStatus(MapleQuestStatus.Status.STARTED);\n-\t\tstatus.setProgress(pid, data);//override old if exists\n-\t\tc.getPlayer().updateQuest(status);\n-\t}\n-\n-\tpublic int getQuestStatus(int id) {\n+        public int getQuestStatus(int id) {\n \t\treturn c.getPlayer().getQuest(MapleQuest.getInstance(id)).getStatus().getId();\n \t}\n         \n         private MapleQuestStatus.Status getQuestStat(int id) {\n                 return c.getPlayer().getQuest(MapleQuest.getInstance(id)).getStatus();\n         }\n         \n-\tpublic boolean isQuestCompleted(int quest) {\n+\tpublic boolean isQuestCompleted(int id) {\n \t\ttry {\n-\t\t\treturn getQuestStat(quest) == MapleQuestStatus.Status.COMPLETED;\n+\t\t\treturn getQuestStat(id) == MapleQuestStatus.Status.COMPLETED;\n \t\t} catch (NullPointerException e) {\n                         e.printStackTrace();\n \t\t\treturn false;\n \t\t}\n \t}\n \n-        public boolean isQuestActive(int quest) {\n-            return isQuestStarted(quest);\n+        public boolean isQuestActive(int id) {\n+            return isQuestStarted(id);\n         }\n         \n-\tpublic boolean isQuestStarted(int quest) {\n+\tpublic boolean isQuestStarted(int id) {\n \t\ttry {\n-\t\t\treturn getQuestStat(quest) == MapleQuestStatus.Status.STARTED;\n+\t\t\treturn getQuestStat(id) == MapleQuestStatus.Status.STARTED;\n \t\t} catch (NullPointerException e) {\n                         e.printStackTrace();\n \t\t\treturn false;\n \t\t}\n \t}\n         \n-        public void setQuestProgress(int qid, int progress) {\n-                MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(qid));\n-                status.setProgress(status.getAnyProgressKey(), String.valueOf(progress));\n+        public void setQuestProgress(int id, String progress) {\n+                setQuestProgress(id, 0, progress);\n         }\n         \n-        public void setQuestProgress(int qid, int pid, int progress) {\n-                MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(qid));\n-                status.setProgress(pid, String.valueOf(progress));\n-\t}\n+        public void setQuestProgress(int id, int progress) {\n+                setQuestProgress(id, 0, \"\" + progress);\n+        }\n         \n-        public void setStringQuestProgress(int qid, int pid, String progress) {\n-                MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(qid));\n-                status.setProgress(pid, progress);\n+        public void setQuestProgress(int id, int infoNumber, int progress) {\n+                setQuestProgress(id, infoNumber, \"\" + progress);\n         }\n         \n-        public int getQuestProgress(int qid) {\n-                MapleQuestStatus status = c.getPlayer().getQuest(MapleQuest.getInstance(qid));\n-                String progress = status.getProgress(status.getAnyProgressKey());\n-            \n-                if (progress.isEmpty()) {\n-                        return 0;\n+        public void setQuestProgress(int id, int infoNumber, String progress) {\n+                c.getPlayer().setQuestProgress(id, infoNumber, progress);\n+        }\n+        \n+        public String getQuestProgress(int id) {\n+                return getQuestProgress(id, 0);\n+        }\n+        \n+        public String getQuestProgress(int id, int infoNumber) {\n+                MapleQuestStatus qs = getPlayer().getQuest(MapleQuest.getInstance(id));\n+                \n+                if (qs.getInfoNumber() == infoNumber && infoNumber > 0) {\n+                        qs = getPlayer().getQuest(MapleQuest.getInstance(infoNumber));\n+                        infoNumber = 0;\n+                }\n+                \n+                if (qs != null) {\n+                        return qs.getProgress(infoNumber);\n+                } else {\n+                        return \"\";\n                 }\n-                return Integer.parseInt(progress);\n         }\n         \n-        public int getQuestProgress(int qid, int pid) {\n-                if (getPlayer().getQuest(MapleQuest.getInstance(qid)).getProgress(pid).isEmpty()) {\n-                    return 0;\n+        public int getQuestProgressInt(int id) {\n+                try {\n+                        return Integer.valueOf(getQuestProgress(id));\n+                } catch (NumberFormatException nfe) {\n+                        return 0;\n                 }\n-\t\treturn Integer.parseInt(getPlayer().getQuest(MapleQuest.getInstance(qid)).getProgress(pid));\n-\t}\n+        }\n         \n-        public String getStringQuestProgress(int qid, int pid) {\n-                if (getPlayer().getQuest(MapleQuest.getInstance(qid)).getProgress(pid).isEmpty()) {\n-                    return \"\";\n+        public int getQuestProgressInt(int id, int infoNumber) {\n+                try {\n+                        return Integer.valueOf(getQuestProgress(id, infoNumber));\n+                } catch (NumberFormatException nfe) {\n+                        return 0;\n                 }\n-                return getPlayer().getQuest(MapleQuest.getInstance(qid)).getProgress(pid);\n         }\n         \n-        public void resetAllQuestProgress(int qid) {\n-                getPlayer().getQuest(MapleQuest.getInstance(qid)).resetAllProgress();\n-                getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, getPlayer().getQuest(MapleQuest.getInstance(qid)), false);\n+        public void resetAllQuestProgress(int id) {\n+                MapleQuestStatus qs = getPlayer().getQuest(MapleQuest.getInstance(id));\n+                if (qs != null) {\n+                        qs.resetAllProgress();\n+                        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n+                }\n         }\n         \n-        public void resetQuestProgress(int qid, int pid) {\n-                getPlayer().getQuest(MapleQuest.getInstance(qid)).resetProgress(pid);\n-                getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, getPlayer().getQuest(MapleQuest.getInstance(qid)), false);\n+        public void resetQuestProgress(int id, int infoNumber) {\n+                MapleQuestStatus qs = getPlayer().getQuest(MapleQuest.getInstance(id));\n+                if (qs != null) {\n+                        qs.resetProgress(infoNumber);\n+                        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, false);\n+                }\n         }\n         \n         public boolean forceStartQuest(int id) {\n@@ -497,26 +494,26 @@ public boolean completeQuest(int id) {\n                 return completeQuest(id, 9010000);\n         }\n         \n-        public boolean startQuest(short id, int npcId) {\n-                return startQuest((int) id, npcId);\n+        public boolean startQuest(short id, int npc) {\n+                return startQuest((int) id, npc);\n         }\n         \n-        public boolean completeQuest(short id, int npcId) {\n-                return completeQuest((int) id, npcId);\n+        public boolean completeQuest(short id, int npc) {\n+                return completeQuest((int) id, npc);\n         }\n         \n-        public boolean startQuest(int id, int npcId) {\n+        public boolean startQuest(int id, int npc) {\n                 try {\n-                        return MapleQuest.getInstance(id).forceStart(getPlayer(), npcId);\n+                        return MapleQuest.getInstance(id).forceStart(getPlayer(), npc);\n                 } catch (NullPointerException ex) {\n                         ex.printStackTrace();\n                         return false;\n                 }\n         }\n         \n-        public boolean completeQuest(int id, int npcId) {\n+        public boolean completeQuest(int id, int npc) {\n                 try {\n-                        return MapleQuest.getInstance(id).forceComplete(getPlayer(), npcId);\n+                        return MapleQuest.getInstance(id).forceComplete(getPlayer(), npc);\n                 } catch (NullPointerException ex) {\n                         ex.printStackTrace();\n                         return false;\n@@ -682,6 +679,10 @@ public void playerMessage(int type, String message) {\n \tpublic void message(String message) {\n \t\tgetPlayer().message(message);\n \t}\n+        \n+        public void dropMessage(int type, String message) {\n+\t\tgetPlayer().dropMessage(type, message);\n+\t}\n \n \tpublic void mapMessage(int type, String message) {\n \t\tgetPlayer().getMap().broadcastMessage(MaplePacketCreator.serverNotice(type, message));"}, {"sha": "6a6e574ceb140de332d307cf130c95eafbf44e38", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -898,7 +898,7 @@ public void spawnNpc(int npcId, Point pos, MapleMap map) {\n                 }\n         }\n         \n-        public void dispatchUpdateQuestMobCount(int mobid, int mapid) {\n+        public void dispatchRaiseQuestMobCount(int mobid, int mapid) {\n             Map<Integer, MapleCharacter> mapChars = getInstanceMap(mapid).getMapPlayers();\n             if(!mapChars.isEmpty()) {\n                 List<MapleCharacter> eventMembers = getPlayers();\n@@ -907,7 +907,7 @@ public void dispatchUpdateQuestMobCount(int mobid, int mapid) {\n                     MapleCharacter chr = mapChars.get(evChr.getId());\n \n                     if(chr != null && chr.isLoggedinWorld()) {\n-                        chr.updateQuestMobCount(mobid);\n+                        chr.raiseQuestMobCount(mobid);\n                     }\n                 }\n             }"}, {"sha": "448b0bdfec221d9442e968a45615608a78cc3a57", "filename": "src/scripting/event/EventScriptManager.java", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/event/EventScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/event/EventScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventScriptManager.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -27,7 +27,6 @@\n import java.util.logging.Level;\n import java.util.logging.Logger;\n \n-import javax.script.ScriptEngine;\n import jdk.nashorn.api.scripting.NashornScriptEngine;\n \n import net.server.channel.Channel;\n@@ -48,7 +47,9 @@ public EventEntry(NashornScriptEngine iv, EventManager em) {\n         public NashornScriptEngine iv;\n         public EventManager em;\n     }\n+    \n     private Map<String, EventEntry> events = new LinkedHashMap<>();\n+    private boolean active = false;\n \n     public EventScriptManager(Channel cserv, String[] scripts) {\n         super();\n@@ -67,6 +68,10 @@ public EventManager getEventManager(String event) {\n         }\n         return entry.em;\n     }\n+    \n+    public boolean isActive() {\n+        return active;\n+    }\n \n     public void init() {\n         for (EventEntry entry : events.values()) {\n@@ -78,6 +83,8 @@ public void init() {\n                 System.out.println(\"Error on script: \" + entry.em.getName());\n             }\n         }\n+        \n+        active = true;\n     }\n \n     private void reloadScripts() {\n@@ -100,6 +107,7 @@ public void reload() {\n     }\n \n     public void cancel() {\n+        active = false;\n         for (EventEntry entry : events.values()) {\n             entry.em.cancel();\n         }"}, {"sha": "575cc41ed81d11cb2c603daa1f6a4d8785dd0a76", "filename": "src/scripting/map/MapScriptMethods.java", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/map/MapScriptMethods.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/map/MapScriptMethods.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/map/MapScriptMethods.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -94,13 +94,13 @@ public void explorerQuest(short questid, String questName) {\n                 return;\n             }\n         }\n-        MapleQuestStatus q = getPlayer().getQuest(quest);\n-        if (!q.addMedalMap(getPlayer().getMapId())) {\n+        MapleQuestStatus qs = getPlayer().getQuest(quest);\n+        if (!qs.addMedalMap(getPlayer().getMapId())) {\n             return;\n         }\n-        String status = Integer.toString(q.getMedalProgress());\n-        String infoex = quest.getInfoEx();\n-        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, true);\n+        String status = Integer.toString(qs.getMedalProgress());\n+        String infoex = qs.getInfoEx(0);\n+        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n         StringBuilder smp = new StringBuilder();\n         StringBuilder etm = new StringBuilder();\n         if (status.equals(infoex)) {\n@@ -123,15 +123,15 @@ public void touchTheSky() { //29004\n                 return;\n             }\n         }\n-        MapleQuestStatus q = getPlayer().getQuest(quest);\n-        if (!q.addMedalMap(getPlayer().getMapId())) {\n+        MapleQuestStatus qs = getPlayer().getQuest(quest);\n+        if (!qs.addMedalMap(getPlayer().getMapId())) {\n             return;\n         }\n-        String status = Integer.toString(q.getMedalProgress());\n-        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, q, true);\n+        String status = Integer.toString(qs.getMedalProgress());\n+        getPlayer().announceUpdateQuest(DelayedQuestUpdate.UPDATE, qs, true);\n         getPlayer().announce(MaplePacketCreator.earnTitleMessage(status + \"/5 Completed\"));\n         getPlayer().announce(MaplePacketCreator.earnTitleMessage(\"The One Who's Touched the Sky title in progress.\"));\n-        if (Integer.toString(q.getMedalProgress()).equals(quest.getInfoEx())) {\n+        if (Integer.toString(qs.getMedalProgress()).equals(qs.getInfoEx(0))) {\n             showInfoText(\"The One Who's Touched the Sky\" + rewardstring);\n             getPlayer().announce(MaplePacketCreator.getShowQuestCompletion(quest.getId()));\n         } else {"}, {"sha": "57c1929aa1abcd2cebec68a4a1a7e8db5b64ef0e", "filename": "src/scripting/npc/NPCConversationManager.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/npc/NPCConversationManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/npc/NPCConversationManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/npc/NPCConversationManager.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -579,7 +579,7 @@ public int getCosmeticItem(int itemid) {\n                 return itemid != baseid && itemExists(baseid) ? baseid : -1;\n         }\n         \n-        private int getEquippedItemid(int itemid) {\n+        private int getEquippedCosmeticid(int itemid) {\n                 if (itemid < 30000) {\n                         return getPlayer().getFace();\n                 } else {\n@@ -588,7 +588,7 @@ private int getEquippedItemid(int itemid) {\n         }\n         \n         public boolean isCosmeticEquipped(int itemid) {\n-                return getEquippedItemid(itemid) == itemid;\n+                return getEquippedCosmeticid(itemid) == itemid;\n         }\n         \n         public boolean isUsingOldPqNpcStyle() {"}, {"sha": "c67de4b196cc1f54a4c4f886fbd9c5f522303b1c", "filename": "src/scripting/quest/QuestScriptManager.java", "status": "modified", "additions": 30, "deletions": 4, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/quest/QuestScriptManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/scripting/quest/QuestScriptManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/quest/QuestScriptManager.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -59,10 +59,6 @@ private NashornScriptEngine getQuestScriptEngine(MapleClient c, short questid) {\n         \n \tpublic void start(MapleClient c, short questid, int npc) {\n                 MapleQuest quest = MapleQuest.getInstance(questid);\n-                if (!quest.canStartWithoutRequirements(c.getPlayer())) {\n-                        dispose(c);\n-                        return;\n-                }\n                 try {\n                         QuestActionManager qm = new QuestActionManager(c, questid, npc, true);\n                         if (qms.containsKey(c)) {\n@@ -169,6 +165,36 @@ public void end(MapleClient c, byte mode, byte type, int selection) {\n \t\t}\n \t}\n \n+        public void raiseOpen(MapleClient c, short questid, int npc) {\n+                try {\n+                        QuestActionManager qm = new QuestActionManager(c, questid, npc, true);\n+                        if (qms.containsKey(c)) {\n+                                return;\n+                        }\n+                        if(c.canClickNPC()) {\n+                                qms.put(c, qm);\n+                                \n+                                NashornScriptEngine iv = getQuestScriptEngine(c, questid);\n+                                if (iv == null) {\n+                                        //FilePrinter.printError(FilePrinter.QUEST_UNCODED, \"RAISE Quest \" + questid + \" is uncoded.\");\n+                                        qm.dispose();\n+                                        return;\n+                                }\n+                                \n+                                iv.put(\"qm\", qm);\n+                                scripts.put(c, iv);\n+                                c.setClickedNPC();\n+                                iv.invokeFunction(\"raiseOpen\");\n+                        }\n+                } catch (final UndeclaredThrowableException ute) {\n+                        FilePrinter.printError(FilePrinter.QUEST + questid + \".txt\", ute);\n+                        dispose(c);\n+                } catch (final Throwable t) {\n+                        FilePrinter.printError(FilePrinter.QUEST + getQM(c).getQuest() + \".txt\", t);\n+                        dispose(c);\n+                }\n+\t}\n+\n \tpublic void dispose(QuestActionManager qm, MapleClient c) {\n \t\tqms.remove(c);\n \t\tscripts.remove(c);"}, {"sha": "6ce159d95a2b8b5ee52cf206a0c806c254a8049f", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -2156,23 +2156,25 @@ public final QuestConsItem getQuestConsumablesInfo(final int itemId) {\n             return questItemConsCache.get(itemId);\n         }\n         MapleData data = getItemData(itemId);\n+        QuestConsItem qcItem = null;\n         \n         MapleData infoData = data.getChildByPath(\"info\");\n-        MapleData ciData = infoData.getChildByPath(\"consumeItem\");\n-        QuestConsItem qcItem = null;\n-        if (ciData != null) {\n+        if (infoData.getChildByPath(\"uiData\") != null) {\n             qcItem = new QuestConsItem();\n             qcItem.exp = MapleDataTool.getInt(\"exp\", infoData);\n             qcItem.grade = MapleDataTool.getInt(\"grade\", infoData);\n             qcItem.questid = MapleDataTool.getInt(\"questId\", infoData);\n             qcItem.items = new HashMap<>(2);\n             \n             Map<Integer, Integer> cItems = qcItem.items;\n-            for (MapleData ciItem : ciData.getChildren()) {\n-                int itemid = MapleDataTool.getInt(\"0\", ciItem);\n-                int qty = MapleDataTool.getInt(\"1\", ciItem);\n-                \n-                cItems.put(itemid, qty);\n+            MapleData ciData = infoData.getChildByPath(\"consumeItem\");\n+            if (ciData != null) {\n+                for (MapleData ciItem : ciData.getChildren()) {\n+                    int itemid = MapleDataTool.getInt(\"0\", ciItem);\n+                    int qty = MapleDataTool.getInt(\"1\", ciItem);\n+\n+                    cItems.put(itemid, qty);\n+                }\n             }\n         }\n         "}, {"sha": "194d0fb07a5f8a7fb70112ff1d316a2bd5511cbf", "filename": "src/server/MapleTrade.java", "status": "modified", "additions": 18, "deletions": 18, "changes": 36, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/MapleTrade.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/MapleTrade.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleTrade.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -80,8 +80,8 @@ private byte getValue() {\n     private byte number;\n     private boolean fullTrade = false;\n     \n-    public MapleTrade(byte number, MapleCharacter c) {\n-        chr = c;\n+    public MapleTrade(byte number, MapleCharacter chr) {\n+        this.chr = chr;\n         this.number = number;\n     }\n \n@@ -291,29 +291,29 @@ private boolean checkCompleteHandshake() {  // handshake checkout thanks to Rona\n         }\n     }\n     \n-    public static void completeTrade(MapleCharacter c) {\n-        MapleTrade local = c.getTrade();\n+    public static void completeTrade(MapleCharacter chr) {\n+        MapleTrade local = chr.getTrade();\n         MapleTrade partner = local.getPartner();\n         if (local.checkCompleteHandshake()) {\n             local.fetchExchangedItems();\n             partner.fetchExchangedItems();\n             \n             if (!local.fitsMeso()) {\n                 cancelTrade(local.getChr(), TradeResult.UNSUCCESSFUL);\n-                c.message(\"There is not enough meso inventory space to complete the trade.\");\n+                chr.message(\"There is not enough meso inventory space to complete the trade.\");\n                 partner.getChr().message(\"Partner does not have enough meso inventory space to complete the trade.\");\n                 return;\n             } else if (!partner.fitsMeso()) {\n                 cancelTrade(partner.getChr(), TradeResult.UNSUCCESSFUL);\n-                c.message(\"Partner does not have enough meso inventory space to complete the trade.\");\n+                chr.message(\"Partner does not have enough meso inventory space to complete the trade.\");\n                 partner.getChr().message(\"There is not enough meso inventory space to complete the trade.\");\n                 return;\n             }\n             \n             if (!local.fitsInInventory()) {\n                 if (local.fitsUniquesInInventory()) {\n                     cancelTrade(local.getChr(), TradeResult.UNSUCCESSFUL);\n-                    c.message(\"There is not enough inventory space to complete the trade.\");\n+                    chr.message(\"There is not enough inventory space to complete the trade.\");\n                     partner.getChr().message(\"Partner does not have enough inventory space to complete the trade.\");\n                 } else {\n                     cancelTrade(local.getChr(), TradeResult.UNSUCCESSFUL_UNIQUE_ITEM_LIMIT);\n@@ -323,11 +323,11 @@ public static void completeTrade(MapleCharacter c) {\n             } else if (!partner.fitsInInventory()) {\n                 if (partner.fitsUniquesInInventory()) {\n                     cancelTrade(partner.getChr(), TradeResult.UNSUCCESSFUL);\n-                    c.message(\"Partner does not have enough inventory space to complete the trade.\");\n+                    chr.message(\"Partner does not have enough inventory space to complete the trade.\");\n                     partner.getChr().message(\"There is not enough inventory space to complete the trade.\");\n                 } else {\n                     cancelTrade(partner.getChr(), TradeResult.UNSUCCESSFUL_UNIQUE_ITEM_LIMIT);\n-                    c.message(\"Partner cannot hold more than one one-of-a-kind item at a time.\");\n+                    chr.message(\"Partner cannot hold more than one one-of-a-kind item at a time.\");\n                 }\n                 return;\n             }\n@@ -355,7 +355,7 @@ public static void completeTrade(MapleCharacter c) {\n             partner.completeTrade();\n             \n             partner.getChr().setTrade(null);\n-            c.setTrade(null);\n+            chr.setTrade(null);\n         }\n     }\n     \n@@ -424,9 +424,9 @@ public static void cancelTrade(MapleCharacter chr, TradeResult result) {\n         trade.cancelHandshake(result.getValue());\n     }\n     \n-    public static void startTrade(MapleCharacter c) {\n-        if (c.getTrade() == null) {\n-            c.setTrade(new MapleTrade((byte) 0, c));\n+    public static void startTrade(MapleCharacter chr) {\n+        if (chr.getTrade() == null) {\n+            chr.setTrade(new MapleTrade((byte) 0, chr));\n         }\n     }\n     \n@@ -496,21 +496,21 @@ public static void visitTrade(MapleCharacter c1, MapleCharacter c2) {\n         }\n     }\n \n-    public static void declineTrade(MapleCharacter c) {\n-        MapleTrade trade = c.getTrade();\n+    public static void declineTrade(MapleCharacter chr) {\n+        MapleTrade trade = chr.getTrade();\n         if (trade != null) {\n             if (trade.getPartner() != null) {\n                 MapleCharacter other = trade.getPartner().getChr();\n-                if (MapleInviteCoordinator.answerInvite(InviteType.TRADE, c.getId(), other.getId(), false).result == InviteResult.DENIED) {\n-                    other.message(c.getName() + \" has declined your trade request.\");\n+                if (MapleInviteCoordinator.answerInvite(InviteType.TRADE, chr.getId(), other.getId(), false).result == InviteResult.DENIED) {\n+                    other.message(chr.getName() + \" has declined your trade request.\");\n                 }\n                 \n                 other.getTrade().cancel(TradeResult.PARTNER_CANCEL.getValue());\n                 other.setTrade(null);\n                 \n             }\n             trade.cancel(TradeResult.NO_RESPONSE.getValue());\n-            c.setTrade(null);\n+            chr.setTrade(null);\n         }\n     }\n "}, {"sha": "50202629e9fceefec12f9effd1284c7681a76b05", "filename": "src/server/life/MapleLifeFactory.java", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/life/MapleLifeFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/life/MapleLifeFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleLifeFactory.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -25,9 +25,11 @@\n import java.io.File;\n import java.util.ArrayList;\n import java.util.HashMap;\n+import java.util.HashSet;\n import java.util.LinkedList;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n import provider.MapleData;\n import provider.MapleDataProvider;\n import provider.MapleDataProviderFactory;\n@@ -43,7 +45,19 @@\n     private static MapleData mobStringData = stringDataWZ.getData(\"Mob.img\");\n     private static MapleData npcStringData = stringDataWZ.getData(\"Npc.img\");\n     private static Map<Integer, MapleMonsterStats> monsterStats = new HashMap<>();\n+    private static Set<Integer> hpbarBosses = getHpBarBosses();\n \n+    private static Set<Integer> getHpBarBosses() {\n+        Set<Integer> ret = new HashSet<>();\n+        \n+        MapleDataProvider uiDataWZ = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/UI.wz\"));\n+        for (MapleData bossData : uiDataWZ.getData(\"UIWindow.img\").getChildByPath(\"MobGage/Mob\").getChildren()) {\n+            ret.add(Integer.valueOf(bossData.getName()));\n+        }\n+        \n+        return ret;\n+    }\n+    \n     public static AbstractLoadedMapleLife getLife(int id, String type) {\n         if (type.equalsIgnoreCase(\"n\")) {\n             return getNPC(id);\n@@ -150,9 +164,11 @@ private static void setMonsterAttackInfo(int mid, List<MobAttackInfoHolder> atta\n         stats.setFirstAttack(firstAttack > 0);\n         stats.setDropPeriod(MapleDataTool.getIntConvert(\"dropItemPeriod\", monsterInfoData, stats.getDropPeriod() / 10000) * 10000);\n \n-        stats.setTagColor(MapleDataTool.getIntConvert(\"hpTagColor\", monsterInfoData, 0));\n-        stats.setTagBgColor(MapleDataTool.getIntConvert(\"hpTagBgcolor\", monsterInfoData, 0));\n-\n+        if (!(stats.isBoss() && !hpbarBosses.contains(mid))) {  // thanks Riizade, Z1peR, Anesthetic for noticing some bosses crashing players due to missing requirements\n+            stats.setTagColor(MapleDataTool.getIntConvert(\"hpTagColor\", monsterInfoData, 0));\n+            stats.setTagBgColor(MapleDataTool.getIntConvert(\"hpTagBgcolor\", monsterInfoData, 0));\n+        }\n+        \n         for (MapleData idata : monsterData) {\n             if (!idata.getName().equals(\"info\")) {\n                 int delay = 0;"}, {"sha": "6cb8132a861640b952995afc364e52af142f3be5", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -743,7 +743,7 @@ private void giveExpToCharacter(MapleCharacter attacker, Float personalExp, Floa\n             \n             attacker.gainExp(_personalExp, _partyExp, true, false, white);\n             attacker.increaseEquipExp(_personalExp);\n-            attacker.updateQuestMobCount(getId());\n+            attacker.raiseQuestMobCount(getId());\n         }\n     }\n     \n@@ -873,7 +873,7 @@ public void run() {\n         }, delay, delay);\n     }\n     \n-    private void dispatchUpdateQuestMobCount() {\n+    private void dispatchRaiseQuestMobCount() {\n         Set<Integer> attackerChrids = takenDamage.keySet();\n         if(!attackerChrids.isEmpty()) {\n             Map<Integer, MapleCharacter> mapChars = map.getMapPlayers();\n@@ -884,7 +884,7 @@ private void dispatchUpdateQuestMobCount() {\n                     MapleCharacter chr = mapChars.get(chrid);\n \n                     if(chr != null && chr.isLoggedinWorld()) {\n-                        chr.updateQuestMobCount(mobid);\n+                        chr.raiseQuestMobCount(mobid);\n                     }\n                 }\n             }\n@@ -906,7 +906,7 @@ public void dispatchMonsterKilled(boolean hasKiller) {\n     \n     private synchronized void processMonsterKilled(boolean hasKiller) {\n         if(!hasKiller) {    // players won't gain EXP from a mob that has no killer, but a quest count they should\n-            dispatchUpdateQuestMobCount();\n+            dispatchRaiseQuestMobCount();\n         }\n         \n         this.aggroClearDamages();"}, {"sha": "efb6f96c54a1dc4a33d8340d07e05bce1219d6ab", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -3261,9 +3261,9 @@ public void reportMonsterSpawnPoints(MapleCharacter chr) {\n     public MapleCharacter getCharacterById(int id) {\n         chrRLock.lock();\n         try {\n-            for (MapleCharacter c : this.characters) {\n-                if (c.getId() == id) {\n-                    return c;\n+            for (MapleCharacter chr : this.characters) {\n+                if (chr.getId() == id) {\n+                    return chr;\n                 }\n             }\n         } finally {\n@@ -3421,8 +3421,8 @@ public void sendNightEffect(MapleCharacter mc) {\n     public void broadcastNightEffect() {\n         chrRLock.lock();\n         try {\n-            for (MapleCharacter c : characters) {\n-                sendNightEffect(c);\n+            for (MapleCharacter chr : this.characters) {\n+                sendNightEffect(chr);\n             }\n         } finally {\n             chrRLock.unlock();\n@@ -3432,9 +3432,9 @@ public void broadcastNightEffect() {\n     public MapleCharacter getCharacterByName(String name) {\n         chrRLock.lock();\n         try {\n-            for (MapleCharacter c : this.characters) {\n-                if (c.getName().toLowerCase().equals(name.toLowerCase())) {\n-                    return c;\n+            for (MapleCharacter chr : this.characters) {\n+                if (chr.getName().toLowerCase().equals(name.toLowerCase())) {\n+                    return chr;\n                 }\n             }\n         } finally {"}, {"sha": "30b7066fe252a9301405313046bf39bcf9d5ec77", "filename": "src/server/maps/MapleMiniGame.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MapleMiniGame.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MapleMiniGame.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMiniGame.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -89,8 +89,8 @@ public boolean hasFreeSlot() {\n         return visitor == null;\n     }\n \n-    public boolean isOwner(MapleCharacter c) {\n-        return owner.equals(c);\n+    public boolean isOwner(MapleCharacter chr) {\n+        return owner.equals(chr);\n     }\n     \n     public void addVisitor(MapleCharacter challenger) {"}, {"sha": "c895ae998ac51b713bb0739d44f949be0cd9e8df", "filename": "src/server/maps/MaplePlayerShop.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MaplePlayerShop.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/maps/MaplePlayerShop.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MaplePlayerShop.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -120,8 +120,8 @@ public boolean hasFreeSlot() {\n         }\n     }\n \n-    public boolean isOwner(MapleCharacter c) {\n-        return owner.equals(c);\n+    public boolean isOwner(MapleCharacter chr) {\n+        return owner.equals(chr);\n     }\n \n     private void addVisitor(MapleCharacter visitor) {"}, {"sha": "a33167d190c572816f6b28a16e763774958afe01", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 184, "deletions": 133, "changes": 317, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -28,11 +28,12 @@\n import java.util.List;\n import java.util.Map;\n import client.MapleCharacter;\n-import client.MapleCharacter.DelayedQuestUpdate;\n import client.MapleQuestStatus;\n import client.MapleQuestStatus.Status;\n import config.YamlConfig;\n+import java.util.Collection;\n import java.util.EnumMap;\n+import java.util.Map.Entry;\n import java.util.Set;\n import provider.MapleData;\n import provider.MapleDataProvider;\n@@ -51,6 +52,7 @@\n public class MapleQuest {\n \n     private static Map<Integer, MapleQuest> quests = new HashMap<>();\n+    private static Map<Integer, Integer> infoNumberQuests = new HashMap<>();\n     private static Map<Short, Integer> medals = new HashMap<>();\n     \n     private static final Set<Short> exploitableQuests = new HashSet<>();\n@@ -61,9 +63,8 @@\n         exploitableQuests.add((short) 21752);\n     }\n     \n-    protected short infoNumber, id;\n+    protected short id;\n     protected int timeLimit, timeLimit2;\n-    protected String infoex;\n     protected Map<MapleQuestRequirementType, MapleQuestRequirement> startReqs = new EnumMap<>(MapleQuestRequirementType.class);\n     protected Map<MapleQuestRequirementType, MapleQuestRequirement> completeReqs = new EnumMap<>(MapleQuestRequirementType.class);\n     protected Map<MapleQuestActionType, MapleQuestAction> startActs = new EnumMap<>(MapleQuestActionType.class);\n@@ -111,17 +112,16 @@ private MapleQuest(int id) {\n                 MapleQuestRequirementType type = MapleQuestRequirementType.getByWZName(startReq.getName());\n                 if (type.equals(MapleQuestRequirementType.INTERVAL)) {\n                     repeatable = true;\n-                } else if (type.equals(MapleQuestRequirementType.INFO_NUMBER)) {\n-                    infoNumber = (short) MapleDataTool.getInt(startReq, 0);\n                 } else if (type.equals(MapleQuestRequirementType.MOB)) {\n                     for (MapleData mob : startReq.getChildren()) {\n                         relevantMobs.add(MapleDataTool.getInt(mob.getChildByPath(\"id\")));\n                     }\n                 }\n \t\t\n                 MapleQuestRequirement req = this.getRequirement(type, startReq);\n-                if(req == null)\n-                        continue;\n+                if (req == null) {\n+                    continue;\n+                }\n \t\t\n                 startReqs.put(type, req);\n             }\n@@ -131,14 +131,13 @@ private MapleQuest(int id) {\n         if (completeReqData != null) {\n             for (MapleData completeReq : completeReqData.getChildren()) {\n \t\tMapleQuestRequirementType type = MapleQuestRequirementType.getByWZName(completeReq.getName());\n-                MapleQuestRequirement req = this.getRequirement(type, completeReq);\n                 \n-                if(req == null)\n-                        continue;\n+                MapleQuestRequirement req = this.getRequirement(type, completeReq);\n+                if (req == null) {\n+                    continue;\n+                }\n \t\t\t\t\n-                if (type.equals(MapleQuestRequirementType.INFO_NUMBER)) {\n-                    infoNumber = (short) MapleDataTool.getInt(completeReq, 0);\n-                } else if (type.equals(MapleQuestRequirementType.MOB)) {\n+                if (type.equals(MapleQuestRequirementType.MOB)) {\n                     for (MapleData mob : completeReq.getChildren()) {\n                         relevantMobs.add(MapleDataTool.getInt(mob.getChildByPath(\"id\")));\n                     }\n@@ -193,35 +192,13 @@ public static MapleQuest getInstance(int id) {\n         return ret;\n     }\n     \n-    private String getIntervalTimeLeft(MapleCharacter c, IntervalRequirement r) {\n-        StringBuilder str = new StringBuilder();\n-        \n-        long futureTime = c.getQuest(MapleQuest.getInstance(getId())).getCompletionTime() + r.getInterval();\n-        long leftTime = futureTime - System.currentTimeMillis();\n-        \n-        byte mode = 0;\n-        if(leftTime / (60*1000) > 0) {\n-            mode++;     //counts minutes\n-            \n-            if(leftTime / (60*60*1000) > 0)\n-                mode++;     //counts hours\n+    public static MapleQuest getInstanceFromInfoNumber(int infoNumber) {\n+        Integer id = infoNumberQuests.get(infoNumber);\n+        if (id == null) {\n+            id = infoNumber;\n         }\n         \n-        switch(mode) {\n-            case 2:\n-                int hours   = (int) ((leftTime / (1000*60*60)));\n-                str.append(hours + \" hours, \");\n-                \n-            case 1:\n-                int minutes = (int) ((leftTime / (1000*60)) % 60);\n-                str.append(minutes + \" minutes, \");\n-                \n-            default:\n-                int seconds = (int) (leftTime / 1000) % 60 ;\n-                str.append(seconds + \" seconds\");\n-        }\n-        \n-        return str.toString();\n+        return getInstance(id);\n     }\n     \n     public boolean isSameDayRepeatable() {\n@@ -231,105 +208,129 @@ public boolean isSameDayRepeatable() {\n         return ir.getInterval() < YamlConfig.config.server.QUEST_POINT_REPEATABLE_INTERVAL * 60 * 60 * 1000;\n     }\n     \n-    public boolean canStartWithoutRequirements(MapleCharacter c) {\n-        MapleQuestStatus mqs = c.getQuest(this);\n-        return !(mqs.getStatus() != Status.NOT_STARTED && !(mqs.getStatus() == Status.COMPLETED && repeatable));\n+    public boolean canStartQuestByStatus(MapleCharacter chr) {\n+        MapleQuestStatus mqs = chr.getQuest(this);\n+        return !(!mqs.getStatus().equals(Status.NOT_STARTED) && !(mqs.getStatus().equals(Status.COMPLETED) && repeatable));\n     }\n     \n-    public boolean canStart(MapleCharacter c, int npcid) {\n-        if (!canStartWithoutRequirements(c)) {\n+    public boolean canQuestByInfoProgress(MapleCharacter chr) {\n+        MapleQuestStatus mqs = chr.getQuest(this);\n+        List<String> ix = mqs.getInfoEx();\n+        if (!ix.isEmpty()) {\n+            short questid = mqs.getQuestID();\n+            short infoNumber = mqs.getInfoNumber();\n+            if (infoNumber <= 0) {\n+                infoNumber = questid;  // on default infoNumber mimics questid\n+            }\n+            \n+            int ixSize = ix.size();\n+            for (int i = 0; i < ixSize; i++) {\n+                String progress = chr.getClient().getAbstractPlayerInteraction().getQuestProgress(infoNumber, i);\n+                String ixProgress = ix.get(i);\n+                \n+                if (!progress.contentEquals(ixProgress)) {\n+                    return false;\n+                }\n+            }\n+        }\n+        \n+        return true;\n+    }\n+    \n+    public boolean canStart(MapleCharacter chr, int npcid) {\n+        if (!canStartQuestByStatus(chr)) {\n             return false;\n         }\n+        \n         for (MapleQuestRequirement r : startReqs.values()) {\n-            if (!r.check(c, npcid)) {\n-                if(r.getType().getType() == MapleQuestRequirementType.INTERVAL.getType()) {\n-                    c.message(\"This quest will become available again in approximately \" + getIntervalTimeLeft(c, (IntervalRequirement)r) + \".\");\n-                }\n+            if (!r.check(chr, npcid)) {\n                 return false;\n             }\n         }\n+        \n+        if (!canQuestByInfoProgress(chr)) {\n+            return false;\n+        }\n+        \n         return true;\n     }\n \n-    public boolean canComplete(MapleCharacter c, Integer npcid) {\n-        if (!c.getQuest(this).getStatus().equals(Status.STARTED)) {\n+    public boolean canComplete(MapleCharacter chr, Integer npcid) {\n+        MapleQuestStatus mqs = chr.getQuest(this);\n+        if (!mqs.getStatus().equals(Status.STARTED)) {\n             return false;\n         }\n+        \n         for (MapleQuestRequirement r : completeReqs.values()) {\n-            if (r == null) {\n-                return false;\n-            } else if(!r.check(c, npcid)) {\n-                if(r.getType() == MapleQuestRequirementType.MESO) { // TODO: find a way to tell the client about the new MESO requirement type.\n-                    c.dropMessage(5, \"You don't have enough mesos to complete this quest.\");\n-                }\n+            if (!r.check(chr, npcid)) {\n                 return false;\n             }\n         }\n+        \n+        if (!canQuestByInfoProgress(chr)) {\n+            return false;\n+        }\n+        \n         return true;\n     }\n \n-    public void start(MapleCharacter c, int npc) {\n-        if (autoStart || canStart(c, npc)) {\n-            for (MapleQuestAction a : startActs.values()) {\n-                if (!a.check(c, null)) { // would null be good ?\n-                        return;\n+    public void start(MapleCharacter chr, int npc) {\n+        if (autoStart || canStart(chr, npc)) {\n+            Collection<MapleQuestAction> acts = startActs.values();\n+            for (MapleQuestAction a : acts) {\n+                if (!a.check(chr, null)) { // would null be good ?\n+                    return;\n                 }\n-                a.run(c, null);\n             }\n-            forceStart(c, npc);\n+            for (MapleQuestAction a : acts) {\n+                a.run(chr, null);\n+            }\n+            forceStart(chr, npc);\n         }\n     }\n \n-    public void complete(MapleCharacter c, int npc) {\n-        complete(c, npc, null);\n+    public void complete(MapleCharacter chr, int npc) {\n+        complete(chr, npc, null);\n     }\n \n-    public void complete(MapleCharacter c, int npc, Integer selection) {\n-        if (autoPreComplete || canComplete(c, npc)) {\n-            for (MapleQuestAction a : completeActs.values()) {\n-                if (!a.check(c, selection)) {\n+    public void complete(MapleCharacter chr, int npc, Integer selection) {\n+        if (autoPreComplete || canComplete(chr, npc)) {\n+            Collection<MapleQuestAction> acts = completeActs.values();\n+            for (MapleQuestAction a : acts) {\n+                if (!a.check(chr, selection)) {\n                     return;\n                 }\n             }\n-\n-            forceComplete(c, npc);\n-            for (MapleQuestAction a : completeActs.values()) {\n-                a.run(c, selection);\n+            forceComplete(chr, npc);\n+            for (MapleQuestAction a : acts) {\n+                a.run(chr, selection);\n             }\n         }\n     }\n \n-    public void reset(MapleCharacter c) {\n-        c.updateQuest(new MapleQuestStatus(this, MapleQuestStatus.Status.NOT_STARTED));\n+    public void reset(MapleCharacter chr) {\n+        chr.updateQuestStatus(new MapleQuestStatus(this, MapleQuestStatus.Status.NOT_STARTED));\n     }\n \n-    public void forfeit(MapleCharacter c) {\n-        if (!c.getQuest(this).getStatus().equals(Status.STARTED)) {\n+    public void forfeit(MapleCharacter chr) {\n+        if (!chr.getQuest(this).getStatus().equals(Status.STARTED)) {\n             return;\n         }\n         if (timeLimit > 0) {\n-            c.announce(MaplePacketCreator.removeQuestTimeLimit(id));\n+            chr.announce(MaplePacketCreator.removeQuestTimeLimit(id));\n         }\n         MapleQuestStatus newStatus = new MapleQuestStatus(this, MapleQuestStatus.Status.NOT_STARTED);\n-        newStatus.setForfeited(c.getQuest(this).getForfeited() + 1);\n-        c.updateQuest(newStatus);\n+        newStatus.setForfeited(chr.getQuest(this).getForfeited() + 1);\n+        chr.updateQuestStatus(newStatus);\n     }\n \n-    public boolean forceStart(MapleCharacter c, int npc) {\n+    public boolean forceStart(MapleCharacter chr, int npc) {\n         MapleQuestStatus newStatus = new MapleQuestStatus(this, MapleQuestStatus.Status.STARTED, npc);\n-        newStatus.setForfeited(c.getQuest(this).getForfeited());\n-        newStatus.setCompleted(c.getQuest(this).getCompleted());\n-\n-        if (timeLimit > 0) {\n-            newStatus.setExpirationTime(System.currentTimeMillis() + (timeLimit * 1000));\n-            c.questTimeLimit(this, timeLimit);\n-        }\n-        if (timeLimit2 > 0) {\n-            newStatus.setExpirationTime(System.currentTimeMillis() + timeLimit2);\n-            c.questTimeLimit2(this, newStatus.getExpirationTime());\n-        }\n         \n-        c.updateQuest(newStatus);\n+        MapleQuestStatus oldStatus = chr.getQuest(this.getId());\n+        for (Entry<Integer, String> e : oldStatus.getProgress().entrySet()) {\n+            newStatus.setProgress(e.getKey(), e.getValue());\n+        }\n         \n         if(id / 100 == 35 && YamlConfig.config.server.TOT_MOB_QUEST_REQUIREMENT > 0) {\n             int setProg = 999 - Math.min(999, YamlConfig.config.server.TOT_MOB_QUEST_REQUIREMENT);\n@@ -338,27 +339,40 @@ public boolean forceStart(MapleCharacter c, int npc) {\n                 if(pid >= 8200000 && pid <= 8200012) {\n                     String pr = StringUtil.getLeftPaddedStr(Integer.toString(setProg), '0', 3);\n                     newStatus.setProgress(pid, pr);\n-                    c.announceUpdateQuest(DelayedQuestUpdate.UPDATE, newStatus, false);\n                 }\n             }\n         }\n         \n+        newStatus.setForfeited(chr.getQuest(this).getForfeited());\n+        newStatus.setCompleted(chr.getQuest(this).getCompleted());\n+\n+        if (timeLimit > 0) {\n+            newStatus.setExpirationTime(System.currentTimeMillis() + (timeLimit * 1000));\n+            chr.questTimeLimit(this, timeLimit);\n+        }\n+        if (timeLimit2 > 0) {\n+            newStatus.setExpirationTime(System.currentTimeMillis() + timeLimit2);\n+            chr.questTimeLimit2(this, newStatus.getExpirationTime());\n+        }\n+        \n+        chr.updateQuestStatus(newStatus);\n+        \n         return true;\n     }\n \n-    public boolean forceComplete(MapleCharacter c, int npc) {\n+    public boolean forceComplete(MapleCharacter chr, int npc) {\n         if (timeLimit > 0) {\n-            c.announce(MaplePacketCreator.removeQuestTimeLimit(id));\n+            chr.announce(MaplePacketCreator.removeQuestTimeLimit(id));\n         }\n         \n         MapleQuestStatus newStatus = new MapleQuestStatus(this, MapleQuestStatus.Status.COMPLETED, npc);\n-        newStatus.setForfeited(c.getQuest(this).getForfeited());\n-        newStatus.setCompleted(c.getQuest(this).getCompleted());\n+        newStatus.setForfeited(chr.getQuest(this).getForfeited());\n+        newStatus.setCompleted(chr.getQuest(this).getCompleted());\n         newStatus.setCompletionTime(System.currentTimeMillis());\n-        c.updateQuest(newStatus);\n+        chr.updateQuestStatus(newStatus);\n         \n-        c.announce(MaplePacketCreator.showSpecialEffect(9)); // Quest completion\n-        c.getMap().broadcastMessage(c, MaplePacketCreator.showForeignEffect(c.getId(), 9), false); //use 9 instead of 12 for both\n+        chr.announce(MaplePacketCreator.showSpecialEffect(9)); // Quest completion\n+        chr.getMap().broadcastMessage(chr, MaplePacketCreator.showForeignEffect(chr.getId(), 9), false); //use 9 instead of 12 for both\n         return true;\n     }\n \n@@ -390,32 +404,49 @@ public int getCompleteItemAmountNeeded(int itemid) {\n \n     public int getMobAmountNeeded(int mid) {\n         MapleQuestRequirement req = completeReqs.get(MapleQuestRequirementType.MOB);\n-\t\tif(req == null)\n-\t\t\treturn 0;\n-\t\t\n-\t\tMobRequirement mreq = (MobRequirement) req;\n-\t\t\n-\t\treturn mreq.getRequiredMobCount(mid);\n+        if(req == null)\n+            return 0;\n+\n+        MobRequirement mreq = (MobRequirement) req;\n+\n+        return mreq.getRequiredMobCount(mid);\n     }\n \n-    public short getInfoNumber() {\n-        return infoNumber;\n+    public short getInfoNumber(Status qs) {\n+        boolean checkEnd = qs.equals(Status.STARTED);\n+        Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !checkEnd ? startReqs : completeReqs;\n+\n+        MapleQuestRequirement req = reqs.get(MapleQuestRequirementType.INFO_NUMBER);\n+        if (req != null) {\n+            InfoNumberRequirement inReq = (InfoNumberRequirement) req;\n+            return inReq.getInfoNumber();\n+        } else {\n+            return 0;\n+        }\n     }\n \n-    public String getInfoEx() {\n-        MapleQuestRequirement req = startReqs.get(MapleQuestRequirementType.INFO_EX);\n-\t\tString ret = \"\";\n-\t\tif(req != null) {\n-\t\t\tInfoExRequirement ireq = (InfoExRequirement) req;\n-\t\t\tret = ireq.getFirstInfo();\n-\t\t} else { // Check complete requirements.\n-\t\t\treq = completeReqs.get(MapleQuestRequirementType.INFO_EX);\n-\t\t\tif(req != null) {\n-\t\t\t\tInfoExRequirement ireq = (InfoExRequirement) req;\n-\t\t\t\tret = ireq.getFirstInfo();\n-\t\t\t}\n-\t\t}\n-\t\treturn ret;\n+    public String getInfoEx(Status qs, int index) {\n+        boolean checkEnd = qs.equals(Status.STARTED);\n+        Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !checkEnd ? startReqs : completeReqs;\n+        try {\n+            MapleQuestRequirement req = reqs.get(MapleQuestRequirementType.INFO_EX);\n+            InfoExRequirement ixReq = (InfoExRequirement) req;\n+            return ixReq.getInfo().get(index);\n+        } catch (Exception e) {\n+            return \"\";\n+        }\n+    }\n+    \n+    public List<String> getInfoEx(Status qs) {\n+        boolean checkEnd = qs.equals(Status.STARTED);\n+        Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !checkEnd ? startReqs : completeReqs;\n+        try {\n+            MapleQuestRequirement req = reqs.get(MapleQuestRequirementType.INFO_EX);\n+            InfoExRequirement ixReq = (InfoExRequirement) req;\n+            return ixReq.getInfo();\n+        } catch (Exception e) {\n+            return new LinkedList<>();\n+        }\n     }\n \n         public int getTimeLimit() {\n@@ -447,6 +478,9 @@ private MapleQuestRequirement getRequirement(MapleQuestRequirementType type, Map\n \t\t\tcase FIELD_ENTER:\n \t\t\t\tret = new FieldEnterRequirement(this, data);\n \t\t\t\tbreak;\n+                        case INFO_NUMBER:\n+                                ret = new InfoNumberRequirement(this, data);\n+\t\t\t\tbreak;\n \t\t\tcase INFO_EX:\n \t\t\t\tret = new InfoExRequirement(this, data);\n \t\t\t\tbreak;\n@@ -495,7 +529,6 @@ private MapleQuestRequirement getRequirement(MapleQuestRequirementType type, Map\n \t\t\tcase NORMAL_AUTO_START:\n \t\t\tcase START:\n \t\t\tcase END:\n-\t\t\tcase INFO_NUMBER:\n \t\t\t\tbreak;\n \t\t\tdefault:\n \t\t\t\t//FilePrinter.printError(FilePrinter.EXCEPTION_CAUGHT, \"Unhandled Requirement Type: \" + type.toString() + \" QuestID: \" + this.getId());\n@@ -540,6 +573,9 @@ private MapleQuestAction getAction(MapleQuestActionType type, MapleData data) {\n                         case PETSPEED:\n \t\t\t\tret = new PetSpeedAction(this, data);\n \t\t\t\tbreak;\n+                        case INFO:\n+                                ret = new InfoAction(this, data);\n+                                break;\n \t\t\tdefault:\n \t\t\t\t//FilePrinter.printError(FilePrinter.EXCEPTION_CAUGHT, \"Unhandled Action Type: \" + type.toString() + \" QuestID: \" + this.getId());\n \t\t\t\tbreak;\n@@ -548,9 +584,11 @@ private MapleQuestAction getAction(MapleQuestActionType type, MapleData data) {\n \t}\n         \n         public boolean restoreLostItem(MapleCharacter chr, int itemid) {\n-                ItemAction itemAct = (ItemAction) startActs.get(MapleQuestActionType.ITEM);\n-                if (itemAct != null) {\n-                        return itemAct.restoreLostItem(chr, itemid);\n+                if (chr.getQuest(this).equals(MapleQuestStatus.Status.STARTED)) {\n+                        ItemAction itemAct = (ItemAction) startActs.get(MapleQuestActionType.ITEM);\n+                        if (itemAct != null) {\n+                                return itemAct.restoreLostItem(chr, itemid);\n+                        }\n                 }\n                 \n                 return false;\n@@ -561,8 +599,8 @@ public int getMedalRequirement() {\n                 return medalid != null ? medalid : -1;\n         }\n         \n-        public int getNpcRequirement(boolean complete) {\n-                Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !complete ? startReqs : completeReqs;\n+        public int getNpcRequirement(boolean checkEnd) {\n+                Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !checkEnd ? startReqs : completeReqs;\n                 MapleQuestRequirement mqr = reqs.get(MapleQuestRequirementType.NPC);\n                 if (mqr != null) {\n                         return ((NpcRequirement) mqr).get();\n@@ -571,8 +609,8 @@ public int getNpcRequirement(boolean complete) {\n                 }\n         }\n         \n-        public boolean hasScriptRequirement(boolean complete) {\n-                Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !complete ? startReqs : completeReqs;\n+        public boolean hasScriptRequirement(boolean checkEnd) {\n+                Map<MapleQuestRequirementType, MapleQuestRequirement> reqs = !checkEnd ? startReqs : completeReqs;\n                 MapleQuestRequirement mqr = reqs.get(MapleQuestRequirementType.SCRIPT);\n                 \n                 if (mqr != null) {\n@@ -612,7 +650,20 @@ public static void loadAllQuest() {\n \t\t\tfor(MapleData quest : questInfo.getChildren()) {\n \t\t\t\tint questID = Integer.parseInt(quest.getName());\n \t\t\t\t\n-\t\t\t\tquests.put(questID, new MapleQuest(questID));\n+                                MapleQuest q = new MapleQuest(questID);\n+\t\t\t\tquests.put(questID, q);\n+                                \n+                                int infoNumber;\n+                                \n+                                infoNumber = q.getInfoNumber(Status.STARTED);\n+                                if (infoNumber > 0) {\n+                                        infoNumberQuests.put(infoNumber, questID);\n+                                }\n+                                \n+                                infoNumber = q.getInfoNumber(Status.COMPLETED);\n+                                if (infoNumber > 0) {\n+                                        infoNumberQuests.put(infoNumber, questID);\n+                                }\n \t\t\t}\n \t\t} catch (Exception ex) {\n \t\t\tex.printStackTrace();"}, {"sha": "f009d0ff2107ed28bbf1ee42156aa99d31550625", "filename": "src/server/quest/MapleQuestActionType.java", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/MapleQuestActionType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/MapleQuestActionType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuestActionType.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -26,7 +26,7 @@\n  * @author Matze\n  */\n public enum MapleQuestActionType {\n-    UNDEFINED(-1), EXP(0), ITEM(1), NEXTQUEST(2), MESO(3), QUEST(4), SKILL(5), FAME(6), BUFF(7), PETSKILL(8), YES(9), NO(10), NPC(11), MIN_LEVEL(12), NORMAL_AUTO_START(13), PETTAMENESS(14), PETSPEED(15), ZERO(16);\n+    UNDEFINED(-1), EXP(0), ITEM(1), NEXTQUEST(2), MESO(3), QUEST(4), SKILL(5), FAME(6), BUFF(7), PETSKILL(8), YES(9), NO(10), NPC(11), MIN_LEVEL(12), NORMAL_AUTO_START(13), PETTAMENESS(14), PETSPEED(15), INFO(16), ZERO(16);\n     final byte type;\n \n     private MapleQuestActionType(int type) {\n@@ -64,6 +64,8 @@ public static MapleQuestActionType getByWZName(String name) {\n             return PETTAMENESS;\n         } else if (name.equals(\"petspeed\")) {\n             return PETSPEED;\n+        } else if (name.equals(\"info\")) {\n+            return INFO;\n         } else if (name.equals(\"0\")) {\n             return ZERO;\n         } else {"}, {"sha": "5c5830a18a171eb1a75f87c158b3566b9c0b329d", "filename": "src/server/quest/actions/InfoAction.java", "status": "renamed", "additions": 31, "deletions": 27, "changes": 58, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/InfoAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/InfoAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/InfoAction.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -17,34 +17,38 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n+package server.quest.actions;\n \n-var status = -1;\n+import client.MapleCharacter;\n+import provider.MapleData;\n+import provider.MapleDataTool;\n+import server.quest.MapleQuest;\n+import server.quest.MapleQuestActionType;\n \n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class InfoAction extends MapleQuestAction {\n         \n-        if (status == 0) {\n-            if(qm.getQuestProgress(3345, 0) == 4) {\n-                qm.sendNext(\"So, you have succeeded. With this, Magatia's upfront demise has been averted, well done brave adventurer!\");\n-                qm.forceCompleteQuest();\n-                \n-                qm.gainExp(20000);\n-            } else {\n-                qm.sendNext(\"Did you not seal the #rmagic circle beneath Magatia#k yet? It is a matter of great importance, please haste yourself.\");\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n+        private String info;\n+        private int questID;\n+\n+        public InfoAction(MapleQuest quest, MapleData data) {\n+                super(MapleQuestActionType.INFO, quest);\n+                questID = quest.getId();\n+                processData(data);\n+        }\n+\n+        @Override\n+        public void processData(MapleData data) {\n+                info = MapleDataTool.getString(data, \"\");\n         }\n-    }\n-}\n\\ No newline at end of file\n+\n+\n+        @Override\n+\tpublic void run(MapleCharacter chr, Integer extSelection) {\n+                chr.getAbstractPlayerInteraction().setQuestProgress(questID, info);\n+        }\n+        \n+}", "previous_filename": "scripts/quest/3345.js"}, {"sha": "6d701603bc473dc65c5965bd8cfbc05fb0671004", "filename": "src/server/quest/actions/ItemAction.java", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/ItemAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/ItemAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/ItemAction.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -195,7 +195,7 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n                                                 if(type.equals(MapleInventoryType.EQUIP) && chr.getInventory(MapleInventoryType.EQUIPPED).countById(item.getId()) > quantity)\n                                                         continue;\n                                                 \n-                                                chr.dropMessage(1, \"Please check if you have enough items in your inventory.\");\n+                                                announceInventoryLimit(Collections.singletonList(item.getId()), chr);\n                                                 return false;\n                                         } else {\n                                                 int idx = type.getType() - 1;   // more slots available from the given items!\n@@ -217,7 +217,7 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n                             \n                                 result = MapleInventoryManipulator.checkSpaceProgressively(c, it.getLeft().getItemId(), it.getLeft().getQuantity(), \"\", rndUsed.get(idx), false);\n                                 if(result % 2 == 0) {\n-                                    chr.dropMessage(1, \"Please check if you have enough space in your inventory.\");\n+                                    announceInventoryLimit(Collections.singletonList(it.getLeft().getItemId()), chr);\n                                     return false;\n                                 }\n                                 \n@@ -231,12 +231,28 @@ public boolean check(MapleCharacter chr, Integer extSelection) {\n                 }\n                 \n                 if (!canHold(chr, gainList)) {\n-\t\t\tchr.dropMessage(1, \"Please check if you have enough space in your inventory.\");\n+                        List<Integer> gainItemids = new LinkedList<>();\n+                        for (Pair<Item, MapleInventoryType> it : gainList) {\n+                                gainItemids.add(it.getLeft().getItemId());\n+                        }\n+                    \n+\t\t\tannounceInventoryLimit(gainItemids, chr);\n \t\t\treturn false;\n \t\t}\n \t\treturn true;\n \t}\n         \n+        private void announceInventoryLimit(List<Integer> itemids, MapleCharacter chr) {\n+                for (Integer id : itemids) {\n+                        if (MapleItemInformationProvider.getInstance().isPickupRestricted(id) && chr.haveItemWithId(id, true)) {\n+                                chr.dropMessage(1, \"Please check if you already have a similar one-of-a-kind item in your inventory.\");\n+                                return;\n+                        }\n+                }\n+                \n+                chr.dropMessage(1, \"Please check if you have enough space in your inventory.\");\n+        }\n+        \n         private boolean canHold(MapleCharacter chr, List<Pair<Item, MapleInventoryType>> gainList) {\n                 List<Integer> toAddItemids = new LinkedList<>();\n                 List<Integer> toAddQuantity = new LinkedList<>();"}, {"sha": "db361fb12012847ac053d24259b46f3e4c7b5c5d", "filename": "src/server/quest/actions/MapleQuestAction.java", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/MapleQuestAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/MapleQuestAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/MapleQuestAction.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -43,10 +43,8 @@ public MapleQuestAction(MapleQuestActionType action, MapleQuest quest) {\n \tpublic abstract void run(MapleCharacter chr, Integer extSelection);\n \tpublic abstract void processData(MapleData data);\n \t\n-\t\n \tpublic boolean check(MapleCharacter chr, Integer extSelection) {\n-\t\tMapleQuestStatus status = chr.getQuest(MapleQuest.getInstance(questID));\n-\t\treturn !(status.getStatus() == MapleQuestStatus.Status.NOT_STARTED && status.getForfeited() > 0);\n+\t\treturn true;\n \t}\n \t\n \tpublic MapleQuestActionType getType() {"}, {"sha": "3d86b771c8669859f2ea644b34868c80f274380d", "filename": "src/server/quest/actions/QuestAction.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/QuestAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/actions/QuestAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/QuestAction.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -58,7 +58,7 @@ public void processData(MapleData data) {\n \tpublic void run(MapleCharacter chr, Integer extSelection) {\n \t\tfor(Integer questID : quests.keySet()) {\n \t\t\tint stat = quests.get(questID);\n-\t\t\tchr.updateQuest(new MapleQuestStatus(MapleQuest.getInstance(questID), MapleQuestStatus.Status.getById(stat)));\n+\t\t\tchr.updateQuestStatus(new MapleQuestStatus(MapleQuest.getInstance(questID), MapleQuestStatus.Status.getById(stat)));\n \t\t}\n \t}\n } "}, {"sha": "ec39f0383b87bda4ba9267b4004a4e01719caf2a", "filename": "src/server/quest/requirements/InfoExRequirement.java", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/InfoExRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/InfoExRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/InfoExRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -22,7 +22,6 @@\n package server.quest.requirements;\n \n import client.MapleCharacter;\n-import client.MapleQuestStatus;\n import java.util.ArrayList;\n import java.util.List;\n import provider.MapleData;\n@@ -41,14 +40,14 @@\n \t\n \tpublic InfoExRequirement(MapleQuest quest, MapleData data) {\n \t\tsuper(MapleQuestRequirementType.INFO_EX);\n-\t\tprocessData(data);\n \t\tquestID = quest.getId();\n+                processData(data);\n \t}\n \t\n \t@Override\n \tpublic void processData(MapleData data) {\n \t\t// Because we have to...\n-\t\tfor(MapleData infoEx : data.getChildren()) {\n+                for(MapleData infoEx : data.getChildren()) {\n \t\t\tMapleData value = infoEx.getChildByPath(\"value\");\n \t\t\tinfoExpected.add(MapleDataTool.getString(value, \"\"));\n \t\t}\n@@ -57,15 +56,10 @@ public void processData(MapleData data) {\n \t\n \t@Override\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n-\t\tMapleQuestStatus status = chr.getQuest(MapleQuest.getInstance(questID));\n-\t\treturn infoExpected.contains(status.getInfo());\n+\t\treturn true;\n \t}\n \t\n \tpublic List<String> getInfo() {\n \t\treturn infoExpected;\n-\t}\n-\t\n-\tpublic String getFirstInfo() {\n-\t\treturn !infoExpected.isEmpty() ? infoExpected.get(0) : \"\";\n-\t}\n+        }\n }"}, {"sha": "080176c0cf8f73352c32a966b150a6f022aa39a2", "filename": "src/server/quest/requirements/InfoNumberRequirement.java", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/InfoNumberRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/InfoNumberRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/InfoNumberRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,57 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package server.quest.requirements;\n+\n+import client.MapleCharacter;\n+import provider.MapleData;\n+import provider.MapleDataTool;\n+import server.quest.MapleQuest;\n+import server.quest.MapleQuestRequirementType;\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class InfoNumberRequirement extends MapleQuestRequirement {\n+        \n+        private short infoNumber;\n+        private int questID;\n+\n+        public InfoNumberRequirement(MapleQuest quest, MapleData data) {\n+                super(MapleQuestRequirementType.INFO_NUMBER);\n+                questID = quest.getId();\n+                processData(data);\n+        }\n+\n+        @Override\n+        public void processData(MapleData data) {\n+                infoNumber = (short) MapleDataTool.getIntConvert(data, 0);\n+        }\n+\n+\n+        @Override\n+        public boolean check(MapleCharacter chr, Integer npcid) {\n+                return true;\n+        }\n+\n+        public short getInfoNumber() {\n+                return infoNumber;\n+        }\n+}"}, {"sha": "e1e127a1ce6f8ef6e59ffabe11f5f3c3ca5609ac", "filename": "src/server/quest/requirements/IntervalRequirement.java", "status": "modified", "additions": 38, "deletions": 2, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/IntervalRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/IntervalRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/IntervalRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -38,8 +38,8 @@\n \t\n \tpublic IntervalRequirement(MapleQuest quest, MapleData data) {\n \t\tsuper(MapleQuestRequirementType.INTERVAL);\n-\t\tprocessData(data);\n \t\tquestID = quest.getId();\n+                processData(data);\n \t}\n \t\n         public int getInterval() {\n@@ -51,11 +51,47 @@ public void processData(MapleData data) {\n \t\tinterval = MapleDataTool.getInt(data) * 60 * 1000;\n \t}\n \t\n+        private static String getIntervalTimeLeft(MapleCharacter chr, IntervalRequirement r) {\n+                StringBuilder str = new StringBuilder();\n+\n+                long futureTime = chr.getQuest(MapleQuest.getInstance(r.questID)).getCompletionTime() + r.getInterval();\n+                long leftTime = futureTime - System.currentTimeMillis();\n+\n+                byte mode = 0;\n+                if(leftTime / (60*1000) > 0) {\n+                        mode++;     //counts minutes\n+\n+                        if(leftTime / (60*60*1000) > 0)\n+                               mode++;     //counts hours\n+                }\n+\n+                switch(mode) {\n+                        case 2:\n+                                int hours   = (int) ((leftTime / (1000*60*60)));\n+                                str.append(hours + \" hours, \");\n+\n+                        case 1:\n+                                int minutes = (int) ((leftTime / (1000*60)) % 60);\n+                                str.append(minutes + \" minutes, \");\n+\n+                        default:\n+                                int seconds = (int) (leftTime / 1000) % 60 ;\n+                                str.append(seconds + \" seconds\");\n+                }\n+\n+                return str.toString();\n+        }\n \t\n \t@Override\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n \t\tboolean check = !chr.getQuest(MapleQuest.getInstance(questID)).getStatus().equals(MapleQuestStatus.Status.COMPLETED);\n \t\tboolean check2 = chr.getQuest(MapleQuest.getInstance(questID)).getCompletionTime() <= System.currentTimeMillis() - interval;\n-\t\treturn check || check2;\n+                \n+                if (check || check2) {\n+                        return true;\n+                } else {\n+                        chr.message(\"This quest will become available again in approximately \" + getIntervalTimeLeft(chr, this) + \".\");\n+                        return false;\n+                }\n \t}\n }"}, {"sha": "7ae55d5af5e2c9ee4d860b8ad799cd1a4dc5b455", "filename": "src/server/quest/requirements/MesoRequirement.java", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/MesoRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/MesoRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/MesoRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -45,6 +45,11 @@ public void processData(MapleData data) {\n \t\n \t@Override\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n-\t\treturn chr.getMeso() >= meso;\n+                if (chr.getMeso() >= meso) {\n+                        return true;\n+                } else {\n+                        chr.dropMessage(5, \"You don't have enough mesos to complete this quest.\");\n+                        return false;\n+                }\n \t}\n }"}, {"sha": "8b13440a4ea8933a8ec9198ed4b057dc5a03f0fa", "filename": "src/server/quest/requirements/MobRequirement.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/MobRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/MobRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/MobRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -42,8 +42,8 @@\n \t\n \tpublic MobRequirement(MapleQuest quest, MapleData data) {\n \t\tsuper(MapleQuestRequirementType.MOB);\n-\t\tprocessData(data);\n \t\tquestID = quest.getId();\n+                processData(data);\n \t}\n \t\n \t/**"}, {"sha": "47bc8457dbba1d8f3540d59863292cf9699ddac4", "filename": "src/server/quest/requirements/QuestRequirement.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/QuestRequirement.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/server/quest/requirements/QuestRequirement.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/requirements/QuestRequirement.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -58,12 +58,12 @@ public void processData(MapleData data) {\n \tpublic boolean check(MapleCharacter chr, Integer npcid) {\n \t\tfor(Integer questID : quests.keySet()) {\n \t\t\tint stateReq = quests.get(questID);\n-\t\t\tMapleQuestStatus q = chr.getQuest(MapleQuest.getInstance(questID));\n+\t\t\tMapleQuestStatus qs = chr.getQuest(MapleQuest.getInstance(questID));\n \t\t\t\n-\t\t\tif(q == null && MapleQuestStatus.Status.getById(stateReq).equals(MapleQuestStatus.Status.NOT_STARTED))\n+\t\t\tif(qs == null && MapleQuestStatus.Status.getById(stateReq).equals(MapleQuestStatus.Status.NOT_STARTED))\n \t\t\t\tcontinue;\n \t\t\t\n-\t\t\tif(q == null || !q.getStatus().equals(MapleQuestStatus.Status.getById(stateReq))) {\n+\t\t\tif(qs == null || !qs.getStatus().equals(MapleQuestStatus.Status.getById(stateReq))) {\n \t\t\t\treturn false;\n \t\t\t}\n \t\t\t"}, {"sha": "bad5a798818595f9eb75eb2667436837a302fd19", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 67, "deletions": 53, "changes": 120, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -66,6 +66,7 @@\n import constants.game.ExpTable;\n import constants.game.GameConstants;\n import constants.inventory.ItemConstants;\n+import constants.net.ServerConstants;\n import constants.skills.Buccaneer;\n import constants.skills.Corsair;\n import constants.skills.ThunderBreaker;\n@@ -351,20 +352,31 @@ private static void addCharEntry(final MaplePacketLittleEndianWriter mplew, Mapl\n         }\n         \n         private static void addQuestInfo(final MaplePacketLittleEndianWriter mplew, MapleCharacter chr) {\n-                mplew.writeShort(chr.getStartedQuestsSize());\n-                for (MapleQuestStatus q : chr.getStartedQuests()) {\n-                        mplew.writeShort(q.getQuest().getId());\n-                        mplew.writeMapleAsciiString(q.getQuestData());\n-                        if (q.getQuest().getInfoNumber() > 0) {\n-                                mplew.writeShort(q.getQuest().getInfoNumber());\n-                                mplew.writeMapleAsciiString(q.getQuestData());\n+                List<MapleQuestStatus> started = chr.getStartedQuests();\n+                int startedSize = 0;\n+                for (MapleQuestStatus qs : started) {\n+                        if (qs.getInfoNumber() > 0) {\n+                                startedSize++;\n+                        }\n+                        startedSize++;\n+                }\n+                mplew.writeShort(startedSize);\n+                for (MapleQuestStatus qs : started) {\n+                        mplew.writeShort(qs.getQuest().getId());\n+                        mplew.writeMapleAsciiString(qs.getProgressData());\n+                        \n+                        short infoNumber = qs.getInfoNumber();\n+                        if (infoNumber > 0) {\n+                                MapleQuestStatus iqs = chr.getQuest(infoNumber);\n+                                mplew.writeShort(infoNumber);\n+                                mplew.writeMapleAsciiString(iqs.getProgressData());\n                         }\n                 }\n                 List<MapleQuestStatus> completed = chr.getCompletedQuests();\n                 mplew.writeShort(completed.size());\n-                for (MapleQuestStatus q : completed) {\n-                        mplew.writeShort(q.getQuest().getId());\n-                        mplew.writeLong(getTime(q.getCompletionTime()));\n+                for (MapleQuestStatus qs : completed) {\n+                        mplew.writeShort(qs.getQuest().getId());\n+                        mplew.writeLong(getTime(qs.getCompletionTime()));\n                 }\n         }\n         \n@@ -2839,9 +2851,9 @@ private static int doubleToShortBits(double d) {\n                 }\n                 ArrayList<Short> medalQuests = new ArrayList<>();\n                 List<MapleQuestStatus> completed = chr.getCompletedQuests();\n-                for (MapleQuestStatus q : completed) {\n-                        if (q.getQuest().getId() >= 29000) { // && q.getQuest().getId() <= 29923\n-                                medalQuests.add(q.getQuest().getId());\n+                for (MapleQuestStatus qs : completed) {\n+                        if (qs.getQuest().getId() >= 29000) { // && q.getQuest().getId() <= 29923\n+                                medalQuests.add(qs.getQuest().getId());\n                         }\n                 }\n \n@@ -2989,18 +3001,20 @@ private static int doubleToShortBits(double d) {\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] updateQuest(MapleQuestStatus q, boolean infoUpdate) {\n+        public static byte[] updateQuest(MapleCharacter chr, MapleQuestStatus qs, boolean infoUpdate) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.SHOW_STATUS_INFO.getValue());\n                 mplew.write(1);\n-                mplew.writeShort(infoUpdate ? q.getQuest().getInfoNumber() : q.getQuest().getId());\n                 if (infoUpdate) {\n+                        MapleQuestStatus iqs = chr.getQuest(qs.getInfoNumber());\n+                        mplew.writeShort(iqs.getQuestID());\n                         mplew.write(1);\n+                        mplew.writeMapleAsciiString(iqs.getProgressData());\n                 } else {\n-                        mplew.write(q.getStatus().getId());\n+                        mplew.writeShort(qs.getQuest().getId());\n+                        mplew.write(qs.getStatus().getId());\n+                        mplew.writeMapleAsciiString(qs.getProgressData());\n                 }\n-\n-                mplew.writeMapleAsciiString(q.getQuestData());\n                 mplew.skip(5);\n                 return mplew.getPacket();\n         }\n@@ -3194,23 +3208,23 @@ private static void writeLongMaskChair(final MaplePacketLittleEndianWriter mplew\n                 return mplew.getPacket();\n         }\n         \n-        public static byte[] getPlayerShopChat(MapleCharacter c, String chat, boolean owner) {\n+        public static byte[] getPlayerShopChat(MapleCharacter chr, String chat, boolean owner) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT.getCode());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT_THING.getCode());\n                 mplew.write(owner ? 0 : 1);\n-                mplew.writeMapleAsciiString(c.getName() + \" : \" + chat);\n+                mplew.writeMapleAsciiString(chr.getName() + \" : \" + chat);\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getPlayerShopNewVisitor(MapleCharacter c, int slot) {\n+        public static byte[] getPlayerShopNewVisitor(MapleCharacter chr, int slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n                 mplew.write(slot);\n-                addCharLook(mplew, c, false);\n-                mplew.writeMapleAsciiString(c.getName());\n+                addCharLook(mplew, chr, false);\n+                mplew.writeMapleAsciiString(chr.getName());\n                 return mplew.getPacket();\n         }\n \n@@ -3224,22 +3238,22 @@ private static void writeLongMaskChair(final MaplePacketLittleEndianWriter mplew\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getTradePartnerAdd(MapleCharacter c) {\n+        public static byte[] getTradePartnerAdd(MapleCharacter chr) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n                 mplew.write(1);\n-                addCharLook(mplew, c, false);\n-                mplew.writeMapleAsciiString(c.getName());\n+                addCharLook(mplew, chr, false);\n+                mplew.writeMapleAsciiString(chr.getName());\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] tradeInvite(MapleCharacter c) {\n+        public static byte[] tradeInvite(MapleCharacter chr) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.INVITE.getCode());\n                 mplew.write(3);\n-                mplew.writeMapleAsciiString(c.getName());\n+                mplew.writeMapleAsciiString(chr.getName());\n                 mplew.write(new byte[]{(byte) 0xB7, (byte) 0x50, 0, 0});\n                 return mplew.getPacket();\n         }\n@@ -4439,15 +4453,15 @@ private static void writeIntMask(final MaplePacketLittleEndianWriter mplew, Map<\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] showGuildInfo(MapleCharacter c) {\n+        public static byte[] showGuildInfo(MapleCharacter chr) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.GUILD_OPERATION.getValue());\n                 mplew.write(0x1A); //signature for showing guild info\n-                if (c == null) { //show empty guild (used for leaving, expelled)\n+                if (chr == null) { //show empty guild (used for leaving, expelled)\n                         mplew.write(0);\n                         return mplew.getPacket();\n                 }\n-                MapleGuild g = c.getClient().getWorldServer().getGuild(c.getMGC());\n+                MapleGuild g = chr.getClient().getWorldServer().getGuild(chr.getMGC());\n                 if (g == null) { //failed to read from DB - don't show a guild\n                         mplew.write(0);\n                         return mplew.getPacket();\n@@ -5292,17 +5306,17 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMiniGameNewVisitor(MapleMiniGame minigame, MapleCharacter c, int slot) {\n+        public static byte[] getMiniGameNewVisitor(MapleMiniGame minigame, MapleCharacter chr, int slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n                 mplew.write(slot);\n-                addCharLook(mplew, c, false);\n-                mplew.writeMapleAsciiString(c.getName());\n+                addCharLook(mplew, chr, false);\n+                mplew.writeMapleAsciiString(chr.getName());\n                 mplew.writeInt(1);\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.WIN, true));\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.TIE, true));\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.LOSS, true));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.WIN, true));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.TIE, true));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.LOSS, true));\n                 mplew.writeInt(minigame.getVisitorScore());\n                 return mplew.getPacket();\n         }\n@@ -5447,17 +5461,17 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMatchCardNewVisitor(MapleMiniGame minigame, MapleCharacter c, int slot) {\n+        public static byte[] getMatchCardNewVisitor(MapleMiniGame minigame, MapleCharacter chr, int slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n                 mplew.write(slot);\n-                addCharLook(mplew, c, false);\n-                mplew.writeMapleAsciiString(c.getName());\n+                addCharLook(mplew, chr, false);\n+                mplew.writeMapleAsciiString(chr.getName());\n                 mplew.writeInt(1);\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.WIN, false));\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.TIE, false));\n-                mplew.writeInt(c.getMiniGamePoints(MiniGameResult.LOSS, false));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.WIN, false));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.TIE, false));\n+                mplew.writeInt(chr.getMiniGamePoints(MiniGameResult.LOSS, false));\n                 mplew.writeInt(minigame.getVisitorScore());\n                 return mplew.getPacket();\n         }\n@@ -5559,19 +5573,19 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n         \n-        public static byte[] addOmokBox(MapleCharacter c, int ammount, int type) {\n+        public static byte[] addOmokBox(MapleCharacter chr, int ammount, int type) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.UPDATE_CHAR_BOX.getValue());\n-                mplew.writeInt(c.getId());\n-                addAnnounceBox(mplew, c.getMiniGame(), ammount, type);\n+                mplew.writeInt(chr.getId());\n+                addAnnounceBox(mplew, chr.getMiniGame(), ammount, type);\n                 return mplew.getPacket();\n         }\n         \n-        public static byte[] addMatchCardBox(MapleCharacter c, int ammount, int type) {\n+        public static byte[] addMatchCardBox(MapleCharacter chr, int ammount, int type) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.UPDATE_CHAR_BOX.getValue());\n-                mplew.writeInt(c.getId());\n-                addAnnounceBox(mplew, c.getMiniGame(), ammount, type);\n+                mplew.writeInt(chr.getId());\n+                addAnnounceBox(mplew, chr.getMiniGame(), ammount, type);\n                 return mplew.getPacket();\n         }\n         \n@@ -5583,23 +5597,23 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getPlayerShopChat(MapleCharacter c, String chat, byte slot) {\n+        public static byte[] getPlayerShopChat(MapleCharacter chr, String chat, byte slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT.getCode());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT_THING.getCode());\n                 mplew.write(slot);\n-                mplew.writeMapleAsciiString(c.getName() + \" : \" + chat);\n+                mplew.writeMapleAsciiString(chr.getName() + \" : \" + chat);\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getTradeChat(MapleCharacter c, String chat, boolean owner) {\n+        public static byte[] getTradeChat(MapleCharacter chr, String chat, boolean owner) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT.getCode());\n                 mplew.write(PlayerInteractionHandler.Action.CHAT_THING.getCode());\n                 mplew.write(owner ? 0 : 1);\n-                mplew.writeMapleAsciiString(c.getName() + \" : \" + chat);\n+                mplew.writeMapleAsciiString(chr.getName() + \" : \" + chat);\n                 return mplew.getPacket();\n         }\n "}, {"sha": "4e45381c7137aa77a4fe1997fbf28bcbd6da2653", "filename": "src/tools/exceptions/EmptyMovementException.java", "status": "renamed", "additions": 13, "deletions": 27, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/src/tools/exceptions/EmptyMovementException.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/src/tools/exceptions/EmptyMovementException.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/exceptions/EmptyMovementException.java?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -17,33 +17,19 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n+package tools.exceptions;\n \n-var status = -1;\n+import tools.data.input.LittleEndianAccessor;\n \n-function end(mode, type, selection) {\n-    if (mode == -1) {\n-        qm.dispose();\n-    } else {\n-        if(mode == 0 && type > 0) {\n-            qm.dispose();\n-            return;\n-        }\n-        \n-        if (mode == 1)\n-            status++;\n-        else\n-            status--;\n-        \n-        if (status == 0) {\n-            if(qm.getQuestProgress(21728, 0) == 0) {\n-                qm.sendNext(\"You haven't found the #rPuppeteer's cave#k yet, did you?\");\n-            } else {\n-                qm.sendNext(\"Hm, so the entrance is blocked by a powerful force? I see, gimme a time to think now...\");\n-                qm.gainExp(200);\n-                qm.forceCompleteQuest();\n-            }\n-        } else if (status == 1) {\n-            qm.dispose();\n-        }\n+\n+/**\n+ *\n+ * @author Ronan\n+ */\n+public class EmptyMovementException extends Exception {\n+    \n+    public EmptyMovementException(LittleEndianAccessor lea) {\n+        super(\"Empty movement: \" + lea);\n     }\n-}\n\\ No newline at end of file\n+\n+}", "previous_filename": "scripts/quest/21728.js"}, {"sha": "71300f69f27ba56c2ef796bddf20b89fe62cffef", "filename": "tools/ScriptQuestReleaseTracker/hashset.c", "status": "added", "additions": 238, "deletions": 0, "changes": 238, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/hashset.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/hashset.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/hashset.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,238 @@\n+#include <stdio.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+//NOTE: should the HASH_MAXITEM or HASH_NUMBUCK value be too small, program will crash by SIG_SEGV\n+#define HASH_MAXITEM 4000\n+#define HASH_NUMBUCK 1340\n+#define HASH_HIVALUE 2147483647     //32-BIT integer\n+\n+#define HASH_REHTHRE 3.5\n+#define HASH_REHRATE 5\n+\n+typedef struct {\n+    int list[HASH_MAXITEM];\n+    int first;\n+\n+    unsigned int count;\n+} HastSetIndex;\n+\n+typedef struct {\n+    HastSetIndex **table;\n+    int *list;\n+\n+    unsigned int threshold;\n+    unsigned int length;\n+    unsigned int count;\n+} HashSet;\n+\n+void hashset_create_table(HashSet *hs) {\n+    hs->table = (HastSetIndex **)malloc(hs->length * sizeof(HastSetIndex *));\n+    hs->threshold = (unsigned int)(HASH_REHTHRE * hs->length);\n+\n+    unsigned int i;\n+    for(i = 0; i < hs->length; i++) {\n+        hs->table[i] = (HastSetIndex *)malloc(sizeof(HastSetIndex));\n+        hs->table[i]->count = 0;\n+        hs->table[i]->first = HASH_HIVALUE;\n+    }\n+}\n+\n+HashSet* hashset_create() {\n+    HashSet *hs = (HashSet *)malloc(sizeof(HashSet));\n+    hs->count = 0;\n+    hs->length = HASH_NUMBUCK;\n+    hs->list = NULL;\n+\n+    hashset_create_table(hs);\n+    return(hs);\n+}\n+\n+void hashset_destroy(HashSet *hs) {\n+    if(hs->list != NULL) {\n+        free(hs->list);\n+    }\n+\n+    unsigned int i;\n+    for(i = 0; i < hs->length; i++)\n+        free(hs->table[i]);\n+\n+    free(hs->table);\n+    free(hs);\n+}\n+\n+unsigned int hashset_maptable(HashSet *hs, int item) {\n+    return(item % hs->length);\n+}\n+\n+unsigned int hashset_slot(HashSet *hs, int item, unsigned int *bucket) {\n+    *bucket = hashset_maptable(hs, item);\n+\n+    unsigned int i;\n+    for(i = 0; i < hs->table[*bucket]->count; i++) {\n+        if(hs->table[*bucket]->list[i] == item)\n+            return(i);\n+    }\n+\n+    return(-1);\n+}\n+\n+short hashset_contains(HashSet *hs, int item, unsigned int *bucket) {\n+    return(hashset_slot(hs, item, bucket) != -1);\n+}\n+\n+short hashset_insertinto(HashSet *hs, int item) {\n+    unsigned int bucket;\n+\n+    if(!hashset_contains(hs, item, &bucket)) {\n+        if(hs->table[bucket]->first > item)\n+            hs->table[bucket]->first = item;\n+\n+        hs->table[bucket]->list[hs->table[bucket]->count] = item;\n+\n+        (hs->count)++;\n+        (hs->table[bucket]->count)++;\n+        if(hs->table[bucket]->count > hs->threshold) return(1);\n+    }\n+\n+    return(0);\n+}\n+\n+void hashset_rehash(HashSet *hs) {\n+    int *temp = (int *)malloc(hs->count * sizeof(int));\n+    unsigned int temp_cursor = 0, i, j;\n+\n+    for(i = 0; i < hs->length; i++) {\n+        for(j = 0; j < hs->table[i]->count; j++) {\n+            temp[temp_cursor] = hs->table[i]->list[j];\n+            temp_cursor++;\n+        }\n+    }\n+\n+    for(i = 0; i < hs->length; i++)\n+        free(hs->table[i]);\n+    free(hs->table);\n+\n+    hs->count = 0;\n+    hs->length *= HASH_REHRATE;\n+    hashset_create_table(hs);\n+\n+    for(i = 0; i < temp_cursor; i++)\n+        hashset_insertinto(hs, temp[i]);\n+\n+    free(temp);\n+}\n+\n+void hashset_insert(HashSet *hs, int item) {\n+    if(hashset_insertinto(hs, item)) {\n+        hashset_rehash(hs);\n+    }\n+}\n+\n+int hashset_recalc_first(HashSet *hs, int bucket) {\n+    int i, val = HASH_HIVALUE;\n+    for(i = 0; i < hs->table[bucket]->count; i++) {\n+        if(val > hs->table[bucket]->list[i])\n+            val = hs->table[bucket]->list[i];\n+    }\n+\n+    return(val);\n+}\n+\n+void hashset_remove(HashSet *hs, int item) {\n+    unsigned int bucket;\n+    unsigned int slot = hashset_slot(hs, item, &bucket);\n+\n+    if(slot != -1) {\n+        (hs->count)--;\n+        (hs->table[bucket]->count)--;\n+        hs->table[bucket]->list[slot] = hs->table[bucket]->list[hs->table[bucket]->count];\n+\n+        if(item == hs->table[bucket]->first)\n+            hs->table[bucket]->first = hashset_recalc_first(hs, bucket);\n+    }\n+}\n+\n+short hashset_is_empty(HashSet *hs) {\n+    return(hs->count == 0);\n+}\n+\n+void hashset_make_empty(HashSet *hs) {\n+    unsigned int i;\n+    for(i = 0; i < hs->length; i++) {\n+        hs->table[i]->first = HASH_HIVALUE;\n+        hs->table[i]->count = 0;\n+    }\n+\n+    hs->count = 0;\n+}\n+\n+int hashset_remove_first(HashSet *hs) {\n+    int i, take = HASH_HIVALUE;\n+    for(i = 0; i < hs->length; i++) {\n+        if(take > hs->table[i]->first)\n+            take = hs->table[i]->first;\n+    }\n+\n+    hashset_remove(hs, take);\n+    return(take);\n+}\n+\n+void hashset_merge(HashSet *hs1, HashSet *hs2) {\n+    //add values from hs2 to hs1\n+\n+    unsigned int i, j;\n+    for(i = 0; i < hs2->length; i++) {\n+        for(j = 0; j < hs2->table[i]->count; j++) {\n+            hashset_insert(hs1, hs2->table[i]->list[j]);\n+        }\n+    }\n+}\n+\n+void hashset_dump(HashSet *hs) {\n+    printf(\"HASHSET v1.0 -- count: %d, buckets: %d, threshold: %d\\n\", hs->count, hs->length, hs->threshold);\n+\n+    unsigned int i, j;\n+    for(i = 0; i < hs->length; i++) {\n+        printf(\"\\n%d -> \", i);\n+        for(j = 0; j < hs->table[i]->count; j++) {\n+            printf(\"%d \", hs->table[i]->list[j]);\n+        }\n+        printf(\"$\");\n+    }\n+    printf(\"\\n\");\n+}\n+\n+int* hashset_list(HashSet *hs) {\n+    int *list = hs->list;\n+    if(list != NULL) {\n+        free(list);\n+    }\n+\n+    list = (int *)malloc(hs->count * sizeof(int));\n+\n+    unsigned int i, j, k = 0;\n+    for(i = 0; i < hs->length; i++) {\n+        for(j = 0; j < hs->table[i]->count; j++) {\n+            list[k] = hs->table[i]->list[j];\n+            k++;\n+        }\n+    }\n+\n+    return list;\n+}\n+\n+/*\n+    HASHSET:\n+\n+    HashSet* hashset_create();\n+    void hashset_destroy(HashSet *hs);\n+    short hashset_contains(HashSet *hs, int item, unsigned int *bucket);\n+    void hashset_insert(HashSet *hs, int item);\n+    void hashset_remove(HashSet *hs, int item);\n+    short hashset_is_empty(HashSet *hs);\n+    void hashset_make_empty(HashSet *hs);\n+    int hashset_remove_first(HashSet *hs);\n+    void hashset_merge(HashSet *hs1, HashSet *hs2);\n+    void hashset_dump(HashSet *hs);\n+*/"}, {"sha": "b5fd2a63785922c9898e7d25d9c50ef47524ba13", "filename": "tools/ScriptQuestReleaseTracker/pcre3.dll", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/pcre3.dll", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/pcre3.dll", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/pcre3.dll?ref=7ee947b4041852b33832d856b464abfe0ceafb8e"}, {"sha": "6e842924eaaea1d73cb049d34dd9241aec57e07f", "filename": "tools/ScriptQuestReleaseTracker/quest_diff.c", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_diff.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_diff.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/quest_diff.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,85 @@\n+#include <limits.h>\n+\n+// string hash version by chqrlie - https://stackoverflow.com/questions/20462826/hash-function-for-strings-in-c\n+unsigned int strhash(const char *word) {\n+    unsigned int hash = 0, c;\n+\n+    size_t i = 0;\n+    for (i = 0; word[i] != '\\0'; i++) {\n+        c = (unsigned char)word[i];\n+        hash = (hash << 3) + (hash >> (sizeof(hash) * CHAR_BIT - 3)) + c;\n+    }\n+    return hash % UINT_MAX;\n+}\n+\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#include \"strmap.h\"\n+#include \"hashset.c\"\n+\n+void performQuestDiff(ScriptedQuestList *quests_then, ScriptedQuestList *quests_curr) {\n+    char buf[100], bufhash[100];\n+    HashSet *script_quests = hashset_create();\n+\n+    // bookkeep quest-script hash\n+    StrMap *sm = sm_new(2000);\n+\n+    // insert ongoing scripts\n+    resetScriptedQuestCursor(quests_curr);\n+    while(true) {\n+        ScriptedQuest *method = readScriptedQuest(quests_curr);\n+        if (method == NULL) {\n+            break;\n+        }\n+\n+        int hash_quest = strhash(method->name);\n+        sprintf(bufhash, \"%d\", hash_quest);\n+\n+        sm_put(sm, bufhash, method->name);\n+        hashset_insert(script_quests, hash_quest);\n+    }\n+\n+    // remove initial scripts\n+    resetScriptedQuestCursor(quests_then);\n+    while(true) {\n+        ScriptedQuest *method = readScriptedQuest(quests_then);\n+        if (method == NULL) {\n+            break;\n+        }\n+\n+        int hash_quest = strhash(method->name);\n+        hashset_remove(script_quests, hash_quest);\n+    }\n+\n+    int *list = hashset_list(script_quests);\n+    int i;\n+    for (i = 0; i < script_quests->count; i++) {\n+        int hash_quest = list[i];\n+        sprintf(bufhash, \"%d\", hash_quest);\n+\n+        // dump ongoing script releases\n+        sm_get(sm, bufhash, buf, sizeof(buf));\n+        printf(\"%s\\n\", buf);\n+    }\n+\n+    sm_delete(sm);\n+    hashset_destroy(script_quests);\n+}"}, {"sha": "9911d581cc39c4eaa8dec6c348776b61e2d0bd31", "filename": "tools/ScriptQuestReleaseTracker/quest_diff.h", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_diff.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_diff.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/quest_diff.h?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,28 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#ifndef QUEST_DIFF_H_\n+#define QUEST_DIFF_H_\n+\n+void performQuestDiff(ScriptedQuestList *quests_then, ScriptedQuestList *quests_curr);\n+\n+#include \"quest_diff.c\"\n+\n+#endif /* QUEST_DIFF_H_ */"}, {"sha": "758bc64ab50ba652dbb2ebd5717955ba5317fc97", "filename": "tools/ScriptQuestReleaseTracker/quest_list.c", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_list.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_list.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/quest_list.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,85 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+ScriptedQuest* createScriptedQuest(const char *name) {\n+    ScriptedQuest* method = (ScriptedQuest *)malloc(sizeof(ScriptedQuest));\n+    method->name = (char *)malloc((strlen(name) + 1) * sizeof(char));\n+    strcpy(method->name, name);\n+    return method;\n+}\n+\n+void freeScriptedQuest(ScriptedQuest *method) {\n+    free(method->name);\n+    free(method);\n+}\n+\n+ScriptedQuestList createScriptedQuestList() {\n+    ScriptedQuestList list;\n+    list.size = 0;\n+\n+    ScriptedQuestListItem *item = (ScriptedQuestListItem *)malloc(sizeof(ScriptedQuestListItem));\n+    item->prox = NULL;\n+\n+    list.last = item;\n+    list.first = list.last;\n+\n+    return list;\n+}\n+\n+void insertScriptedQuest(ScriptedQuestList *list, ScriptedQuest *method) {\n+    ScriptedQuestListItem *item = (ScriptedQuestListItem *)malloc(sizeof(ScriptedQuestListItem));\n+    item->prox = NULL;\n+\n+    list->last->method = method;\n+    list->last->prox = item;\n+\n+    list->last = item;\n+    list->size++;\n+}\n+\n+void freeScriptedQuestList(ScriptedQuestList *list) {\n+    ScriptedQuestListItem *aux = list->first;\n+\n+    list->first = list->last;\n+    list->size = 0;\n+\n+    while (aux->prox != NULL) {\n+        ScriptedQuestListItem *aux2 = aux;\n+        aux = aux->prox;\n+\n+        freeScriptedQuest(aux2->method);\n+        free(aux2);\n+    }\n+    free(aux);\n+}\n+\n+void resetScriptedQuestCursor(ScriptedQuestList *list) {\n+    list->cursor = list->first;\n+}\n+\n+ScriptedQuest* readScriptedQuest(ScriptedQuestList *list) {\n+    ScriptedQuestListItem *aux = list->cursor;\n+    if (aux->prox == NULL) {\n+        return NULL;\n+    }\n+\n+    list->cursor = aux->prox;\n+    return aux->method;\n+}"}, {"sha": "4d6b91ef3baa2238cf8027c8315663df0b4d95e8", "filename": "tools/ScriptQuestReleaseTracker/quest_list.h", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_list.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/quest_list.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/quest_list.h?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,43 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#ifndef QUEST_LIST_H_\n+#define QUEST_LIST_H_\n+\n+typedef struct {\n+    char *name;\n+} ScriptedQuest;\n+\n+typedef struct ScriptedQuestListItem {\n+    ScriptedQuest *method;\n+    struct ScriptedQuestListItem *prox;\n+} ScriptedQuestListItem;\n+\n+typedef struct {\n+    ScriptedQuestListItem *first;\n+    ScriptedQuestListItem *last;\n+    ScriptedQuestListItem *cursor;\n+\n+    int size;\n+} ScriptedQuestList;\n+\n+#include \"quest_list.c\"\n+\n+#endif /* QUEST_LIST_H_ */"}, {"sha": "4a1bb71fe0f5c4f51a0c6feddb387218bd2baba7", "filename": "tools/ScriptQuestReleaseTracker/script_tracker.c", "status": "added", "additions": 159, "deletions": 0, "changes": 159, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/script_tracker.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/script_tracker.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/script_tracker.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,159 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2019 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+#include <stdlib.h>\n+#include <stdio.h>\n+#include <string.h>\n+#include <stdbool.h>\n+#include <pcre.h>\n+\n+#include \"strmap.c\"\n+#include \"quest_list.h\"\n+#include \"quest_diff.h\"\n+\n+ScriptedQuestList getBestSubstringsFromStringList(char *aStrRegex, ScriptedQuestList *lines, int lines_size) {\n+    ScriptedQuestList ret = createScriptedQuestList();\n+\n+    // ------------ an adaptation from Mitch Richling's https://www.mitchr.me/SS/exampleCode/AUPG/pcre_example.c.html -----------\n+\n+    int subStrVec[30];\n+    int subStrVecLength = 30;\n+    const char *pcreErrorStr;\n+    int pcreErrorOffset;\n+\n+    pcre *reCompiled = pcre_compile(aStrRegex, 0, &pcreErrorStr, &pcreErrorOffset, NULL);\n+    if(reCompiled == NULL) {\n+        printf(\"ERROR: Could not compile '%s': %s\\n\", aStrRegex, pcreErrorStr);\n+        return ret;\n+    }\n+\n+    pcre_extra *pcreExtra = pcre_study(reCompiled, 0, &pcreErrorStr);\n+    if(pcreErrorStr != NULL) {\n+        printf(\"ERROR: Could not study '%s': %s\\n\", aStrRegex, pcreErrorStr);\n+        return ret;\n+    }\n+\n+    int i;\n+    for (i = 0; i < lines_size; i++) {\n+        ScriptedQuestList list = lines[i];\n+\n+        resetScriptedQuestCursor(&list);\n+        while(true) {\n+            ScriptedQuest *method = readScriptedQuest(&list);\n+            if (method == NULL) {\n+                break;\n+            }\n+\n+            char *str = method->name;\n+            int st = 0, en = strlen(str);\n+            while(st < en) {\n+                int pcreExecRet = pcre_exec(reCompiled, pcreExtra, str, en, st, 0, subStrVec, subStrVecLength);\n+                if(pcreExecRet < 0) {\n+                    switch(pcreExecRet) {\n+                        //case PCRE_ERROR_NOMATCH      : printf(\"String did not match the pattern\\n\");        break;\n+                        case PCRE_ERROR_NULL         : printf(\"Something was null\\n\");                      break;\n+                        case PCRE_ERROR_BADOPTION    : printf(\"A bad option was passed\\n\");                 break;\n+                        case PCRE_ERROR_BADMAGIC     : printf(\"Magic number bad (compiled re corrupt?)\\n\"); break;\n+                        case PCRE_ERROR_UNKNOWN_NODE : printf(\"Something kooky in the compiled re\\n\");      break;\n+                        case PCRE_ERROR_NOMEMORY     : printf(\"Ran out of memory\\n\");                       break;\n+                        //default                      : printf(\"Unknown error\\n\");                           break;\n+                    }\n+\n+                    break;\n+                } else {\n+                    if(pcreExecRet == 0) {\n+                        printf(\"But too many substrings were found to fit in subStrVec!\\n\");\n+                        // Set rc to the max number of substring matches possible.\n+                        pcreExecRet = 30 / 3;\n+                    }\n+\n+                    const char *psubStrMatchStr;\n+                    pcre_get_substring(str, subStrVec, pcreExecRet, 1, &(psubStrMatchStr));\n+\n+                    insertScriptedQuest(&ret, createScriptedQuest(psubStrMatchStr));\n+                    pcre_free_substring(psubStrMatchStr);\n+\n+                    st = subStrVec[1];\n+                }\n+            }\n+        }\n+    }\n+\n+    pcre_free(reCompiled);\n+\n+    if(pcreExtra != NULL) {\n+        pcre_free(pcreExtra);\n+    }\n+\n+    return ret;\n+}\n+\n+char *getContentFromFile(FILE *f) {\n+    fseek(f, 0, SEEK_END);  // implemented by user529758 @ StackOverflow\n+    long fsize = ftell(f);\n+    fseek(f, 0, SEEK_SET);  /* same as rewind(f); */\n+\n+    char *string = malloc(fsize + 1);\n+    fread(string, 1, fsize, f);\n+\n+    string[fsize] = 0;\n+    return string;\n+}\n+\n+ScriptedQuestList readQuestXml(char *file_path) {\n+    ScriptedQuestList *file_content = (ScriptedQuestList *)malloc(sizeof(ScriptedQuestList));\n+    file_content[0] = createScriptedQuestList();\n+\n+    FILE *f = fopen(file_path, \"r+t\");\n+    char *content = getContentFromFile(f);\n+\n+    char *tok = strtok(content, \"\\n\");\n+    int i = 0;\n+    while (tok != NULL) {\n+        insertScriptedQuest(&(file_content[0]), createScriptedQuest(tok));\n+        tok = strtok(NULL, \"\\n\");\n+        i++;\n+    }\n+\n+    free(content);\n+    fclose(f);\n+\n+    ScriptedQuestList ret = getBestSubstringsFromStringList(\"script\\\" value=\\\"(.+)\\\"\", file_content, 1);\n+\n+    freeScriptedQuestList(&file_content[0]);\n+    free(file_content);\n+\n+    return ret;\n+}\n+\n+void trackScriptQuestReleases() {\n+    ScriptedQuestList quests_then = readQuestXml(\"Check2.img.xml\");\n+    ScriptedQuestList quests_curr = readQuestXml(\"Check.img.xml\");\n+\n+    performQuestDiff(&quests_then, &quests_curr);\n+\n+    freeScriptedQuestList(&quests_curr);\n+    freeScriptedQuestList(&quests_then);\n+}\n+\n+int main() {\n+    trackScriptQuestReleases();\n+    return 0;\n+}"}, {"sha": "6111209abe268a44a070dada9755d9b1d267ca2e", "filename": "tools/ScriptQuestReleaseTracker/strmap.c", "status": "added", "additions": 515, "deletions": 0, "changes": 515, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/strmap.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/strmap.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/strmap.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,515 @@\n+/*\n+ *    strmap version 2.0.1\n+ *\n+ *    ANSI C hash table for strings.\n+ *\n+ *\t  Version history:\n+ *\t  1.0.0 - initial release\n+ *\t  2.0.0 - changed function prefix from strmap to sm to ensure\n+ *\t      ANSI C compatibility \n+ *\t  2.0.1 - improved documentation \n+ *\n+ *    strmap.c\n+ *\n+ *    Copyright (c) 2009, 2011, 2013 Per Ola Kristensson.\n+ *\n+ *    Per Ola Kristensson <pok21@cam.ac.uk> \n+ *    Inference Group, Department of Physics\n+ *    University of Cambridge\n+ *    Cavendish Laboratory\n+ *    JJ Thomson Avenue\n+ *    CB3 0HE Cambridge\n+ *    United Kingdom\n+ *\n+ *    strmap is free software: you can redistribute it and/or modify\n+ *    it under the terms of the GNU Lesser General Public License as published by\n+ *    the Free Software Foundation, either version 3 of the License, or\n+ *    (at your option) any later version.\n+ *\n+ *    strmap is distributed in the hope that it will be useful,\n+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *    GNU Lesser General Public License for more details.\n+ *\n+ *    You should have received a copy of the GNU Lesser General Public License\n+ *    along with strmap.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+#include \"strmap.h\"\n+\n+typedef struct Pair Pair;\n+\n+typedef struct Bucket Bucket;\n+\n+struct Pair {\n+\tchar *key;\n+\tchar *value;\n+};\n+\n+struct Bucket {\n+\tunsigned int count;\n+\tPair *pairs;\n+};\n+\n+struct StrMap {\n+\tunsigned int count;\n+\tBucket *buckets;\n+};\n+\n+static Pair * get_pair(Bucket *bucket, const char *key);\n+static unsigned long hash(const char *str);\n+\n+StrMap * sm_new(unsigned int capacity)\n+{\n+\tStrMap *map;\n+\t\n+\tmap = malloc(sizeof(StrMap));\n+\tif (map == NULL) {\n+\t\treturn NULL;\n+\t}\n+\tmap->count = capacity;\n+\tmap->buckets = malloc(map->count * sizeof(Bucket));\n+\tif (map->buckets == NULL) {\n+\t\tfree(map);\n+\t\treturn NULL;\n+\t}\n+\tmemset(map->buckets, 0, map->count * sizeof(Bucket));\n+\treturn map;\n+}\n+\n+void sm_delete(StrMap *map)\n+{\n+\tunsigned int i, j, n, m;\n+\tBucket *bucket;\n+\tPair *pair;\n+\n+\tif (map == NULL) {\n+\t\treturn;\n+\t}\n+\tn = map->count;\n+\tbucket = map->buckets;\n+\ti = 0;\n+\twhile (i < n) {\n+\t\tm = bucket->count;\n+\t\tpair = bucket->pairs;\n+\t\tj = 0;\n+\t\twhile(j < m) {\n+\t\t\tfree(pair->key);\n+\t\t\tfree(pair->value);\n+\t\t\tpair++;\n+\t\t\tj++;\n+\t\t}\n+\t\tfree(bucket->pairs);\n+\t\tbucket++;\n+\t\ti++;\n+\t}\n+\tfree(map->buckets);\n+\tfree(map);\n+}\n+\n+int sm_get(const StrMap *map, const char *key, char *out_buf, unsigned int n_out_buf)\n+{\n+\tunsigned int index;\n+\tBucket *bucket;\n+\tPair *pair;\n+\n+\tif (map == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (key == NULL) {\n+\t\treturn 0;\n+\t}\n+\tindex = hash(key) % map->count;\n+\tbucket = &(map->buckets[index]);\n+\tpair = get_pair(bucket, key);\n+\tif (pair == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (out_buf == NULL && n_out_buf == 0) {\n+\t\treturn strlen(pair->value) + 1;\n+\t}\n+\tif (out_buf == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (strlen(pair->value) >= n_out_buf) {\n+\t\treturn 0;\n+\t}\n+\tstrcpy(out_buf, pair->value);\n+\treturn 1;\n+}\n+\n+int sm_exists(const StrMap *map, const char *key)\n+{\n+\tunsigned int index;\n+\tBucket *bucket;\n+\tPair *pair;\n+\n+\tif (map == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (key == NULL) {\n+\t\treturn 0;\n+\t}\n+\tindex = hash(key) % map->count;\n+\tbucket = &(map->buckets[index]);\n+\tpair = get_pair(bucket, key);\n+\tif (pair == NULL) {\n+\t\treturn 0;\n+\t}\n+\treturn 1;\n+}\n+\n+int sm_put(StrMap *map, const char *key, const char *value)\n+{\n+\tunsigned int key_len, value_len, index;\n+\tBucket *bucket;\n+\tPair *tmp_pairs, *pair;\n+\tchar *tmp_value;\n+\tchar *new_key, *new_value;\n+\n+\tif (map == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (key == NULL || value == NULL) {\n+\t\treturn 0;\n+\t}\n+\tkey_len = strlen(key);\n+\tvalue_len = strlen(value);\n+\t/* Get a pointer to the bucket the key string hashes to */\n+\tindex = hash(key) % map->count;\n+\tbucket = &(map->buckets[index]);\n+\t/* Check if we can handle insertion by simply replacing\n+\t * an existing value in a key-value pair in the bucket.\n+\t */\n+\tif ((pair = get_pair(bucket, key)) != NULL) {\n+\t\t/* The bucket contains a pair that matches the provided key,\n+\t\t * change the value for that pair to the new value.\n+\t\t */\n+\t\tif (strlen(pair->value) < value_len) {\n+\t\t\t/* If the new value is larger than the old value, re-allocate\n+\t\t\t * space for the new larger value.\n+\t\t\t */\n+\t\t\ttmp_value = realloc(pair->value, (value_len + 1) * sizeof(char));\n+\t\t\tif (tmp_value == NULL) {\n+\t\t\t\treturn 0;\n+\t\t\t}\n+\t\t\tpair->value = tmp_value;\n+\t\t}\n+\t\t/* Copy the new value into the pair that matches the key */\n+\t\tstrcpy(pair->value, value);\n+\t\treturn 1;\n+\t}\n+\t/* Allocate space for a new key and value */\n+\tnew_key = malloc((key_len + 1) * sizeof(char));\n+\tif (new_key == NULL) {\n+\t\treturn 0;\n+\t}\n+\tnew_value = malloc((value_len + 1) * sizeof(char));\n+\tif (new_value == NULL) {\n+\t\tfree(new_key);\n+\t\treturn 0;\n+\t}\n+\t/* Create a key-value pair */\n+\tif (bucket->count == 0) {\n+\t\t/* The bucket is empty, lazily allocate space for a single\n+\t\t * key-value pair.\n+\t\t */\n+\t\tbucket->pairs = malloc(sizeof(Pair));\n+\t\tif (bucket->pairs == NULL) {\n+\t\t\tfree(new_key);\n+\t\t\tfree(new_value);\n+\t\t\treturn 0;\n+\t\t}\n+\t\tbucket->count = 1;\n+\t}\n+\telse {\n+\t\t/* The bucket wasn't empty but no pair existed that matches the provided\n+\t\t * key, so create a new key-value pair.\n+\t\t */\n+\t\ttmp_pairs = realloc(bucket->pairs, (bucket->count + 1) * sizeof(Pair));\n+\t\tif (tmp_pairs == NULL) {\n+\t\t\tfree(new_key);\n+\t\t\tfree(new_value);\n+\t\t\treturn 0;\n+\t\t}\n+\t\tbucket->pairs = tmp_pairs;\n+\t\tbucket->count++;\n+\t}\n+\t/* Get the last pair in the chain for the bucket */\n+\tpair = &(bucket->pairs[bucket->count - 1]);\n+\tpair->key = new_key;\n+\tpair->value = new_value;\n+\t/* Copy the key and its value into the key-value pair */\n+\tstrcpy(pair->key, key);\n+\tstrcpy(pair->value, value);\n+\treturn 1;\n+}\n+\n+int sm_get_count(const StrMap *map)\n+{\n+\tunsigned int i, j, n, m;\n+\tunsigned int count;\n+\tBucket *bucket;\n+\tPair *pair;\n+\n+\tif (map == NULL) {\n+\t\treturn 0;\n+\t}\n+\tbucket = map->buckets;\n+\tn = map->count;\n+\ti = 0;\n+\tcount = 0;\n+\twhile (i < n) {\n+\t\tpair = bucket->pairs;\n+\t\tm = bucket->count;\n+\t\tj = 0;\n+\t\twhile (j < m) {\n+\t\t\tcount++;\n+\t\t\tpair++;\n+\t\t\tj++;\n+\t\t}\n+\t\tbucket++;\n+\t\ti++;\n+\t}\n+\treturn count;\n+}\n+\n+int sm_enum(const StrMap *map, sm_enum_func enum_func, const void *obj)\n+{\n+\tunsigned int i, j, n, m;\n+\tBucket *bucket;\n+\tPair *pair;\n+\n+\tif (map == NULL) {\n+\t\treturn 0;\n+\t}\n+\tif (enum_func == NULL) {\n+\t\treturn 0;\n+\t}\n+\tbucket = map->buckets;\n+\tn = map->count;\n+\ti = 0;\n+\twhile (i < n) {\n+\t\tpair = bucket->pairs;\n+\t\tm = bucket->count;\n+\t\tj = 0;\n+\t\twhile (j < m) {\n+\t\t\tenum_func(pair->key, pair->value, obj);\n+\t\t\tpair++;\n+\t\t\tj++;\n+\t\t}\n+\t\tbucket++;\n+\t\ti++;\n+\t}\n+\treturn 1;\n+}\n+\n+/*\n+ * Returns a pair from the bucket that matches the provided key,\n+ * or null if no such pair exist.\n+ */\n+static Pair * get_pair(Bucket *bucket, const char *key)\n+{\n+\tunsigned int i, n;\n+\tPair *pair;\n+\n+\tn = bucket->count;\n+\tif (n == 0) {\n+\t\treturn NULL;\n+\t}\n+\tpair = bucket->pairs;\n+\ti = 0;\n+\twhile (i < n) {\n+\t\tif (pair->key != NULL && pair->value != NULL) {\n+\t\t\tif (strcmp(pair->key, key) == 0) {\n+\t\t\t\treturn pair;\n+\t\t\t}\n+\t\t}\n+\t\tpair++;\n+\t\ti++;\n+\t}\n+\treturn NULL;\n+}\n+\n+/*\n+ * Returns a hash code for the provided string.\n+ */\n+static unsigned long hash(const char *str)\n+{\n+\tunsigned long hash = 5381;\n+\tint c;\n+\n+\twhile (c = *str++) {\n+\t\thash = ((hash << 5) + hash) + c;\n+\t}\n+\treturn hash;\n+}\n+\n+/*\n+\n+\t\t   GNU LESSER GENERAL PUBLIC LICENSE\n+                       Version 3, 29 June 2007\n+\n+ Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>\n+ Everyone is permitted to copy and distribute verbatim copies\n+ of this license document, but changing it is not allowed.\n+\n+\n+  This version of the GNU Lesser General Public License incorporates\n+the terms and conditions of version 3 of the GNU General Public\n+License, supplemented by the additional permissions listed below.\n+\n+  0. Additional Definitions.\n+\n+  As used herein, \"this License\" refers to version 3 of the GNU Lesser\n+General Public License, and the \"GNU GPL\" refers to version 3 of the GNU\n+General Public License.\n+\n+  \"The Library\" refers to a covered work governed by this License,\n+other than an Application or a Combined Work as defined below.\n+\n+  An \"Application\" is any work that makes use of an interface provided\n+by the Library, but which is not otherwise based on the Library.\n+Defining a subclass of a class defined by the Library is deemed a mode\n+of using an interface provided by the Library.\n+\n+  A \"Combined Work\" is a work produced by combining or linking an\n+Application with the Library.  The particular version of the Library\n+with which the Combined Work was made is also called the \"Linked\n+Version\".\n+\n+  The \"Minimal Corresponding Source\" for a Combined Work means the\n+Corresponding Source for the Combined Work, excluding any source code\n+for portions of the Combined Work that, considered in isolation, are\n+based on the Application, and not on the Linked Version.\n+\n+  The \"Corresponding Application Code\" for a Combined Work means the\n+object code and/or source code for the Application, including any data\n+and utility programs needed for reproducing the Combined Work from the\n+Application, but excluding the System Libraries of the Combined Work.\n+\n+  1. Exception to Section 3 of the GNU GPL.\n+\n+  You may convey a covered work under sections 3 and 4 of this License\n+without being bound by section 3 of the GNU GPL.\n+\n+  2. Conveying Modified Versions.\n+\n+  If you modify a copy of the Library, and, in your modifications, a\n+facility refers to a function or data to be supplied by an Application\n+that uses the facility (other than as an argument passed when the\n+facility is invoked), then you may convey a copy of the modified\n+version:\n+\n+   a) under this License, provided that you make a good faith effort to\n+   ensure that, in the event an Application does not supply the\n+   function or data, the facility still operates, and performs\n+   whatever part of its purpose remains meaningful, or\n+\n+   b) under the GNU GPL, with none of the additional permissions of\n+   this License applicable to that copy.\n+\n+  3. Object Code Incorporating Material from Library Header Files.\n+\n+  The object code form of an Application may incorporate material from\n+a header file that is part of the Library.  You may convey such object\n+code under terms of your choice, provided that, if the incorporated\n+material is not limited to numerical parameters, data structure\n+layouts and accessors, or small macros, inline functions and templates\n+(ten or fewer lines in length), you do both of the following:\n+\n+   a) Give prominent notice with each copy of the object code that the\n+   Library is used in it and that the Library and its use are\n+   covered by this License.\n+\n+   b) Accompany the object code with a copy of the GNU GPL and this license\n+   document.\n+\n+  4. Combined Works.\n+\n+  You may convey a Combined Work under terms of your choice that,\n+taken together, effectively do not restrict modification of the\n+portions of the Library contained in the Combined Work and reverse\n+engineering for debugging such modifications, if you also do each of\n+the following:\n+\n+   a) Give prominent notice with each copy of the Combined Work that\n+   the Library is used in it and that the Library and its use are\n+   covered by this License.\n+\n+   b) Accompany the Combined Work with a copy of the GNU GPL and this license\n+   document.\n+\n+   c) For a Combined Work that displays copyright notices during\n+   execution, include the copyright notice for the Library among\n+   these notices, as well as a reference directing the user to the\n+   copies of the GNU GPL and this license document.\n+\n+   d) Do one of the following:\n+\n+       0) Convey the Minimal Corresponding Source under the terms of this\n+       License, and the Corresponding Application Code in a form\n+       suitable for, and under terms that permit, the user to\n+       recombine or relink the Application with a modified version of\n+       the Linked Version to produce a modified Combined Work, in the\n+       manner specified by section 6 of the GNU GPL for conveying\n+       Corresponding Source.\n+\n+       1) Use a suitable shared library mechanism for linking with the\n+       Library.  A suitable mechanism is one that (a) uses at run time\n+       a copy of the Library already present on the user's computer\n+       system, and (b) will operate properly with a modified version\n+       of the Library that is interface-compatible with the Linked\n+       Version.\n+\n+   e) Provide Installation Information, but only if you would otherwise\n+   be required to provide such information under section 6 of the\n+   GNU GPL, and only to the extent that such information is\n+   necessary to install and execute a modified version of the\n+   Combined Work produced by recombining or relinking the\n+   Application with a modified version of the Linked Version. (If\n+   you use option 4d0, the Installation Information must accompany\n+   the Minimal Corresponding Source and Corresponding Application\n+   Code. If you use option 4d1, you must provide the Installation\n+   Information in the manner specified by section 6 of the GNU GPL\n+   for conveying Corresponding Source.)\n+\n+  5. Combined Libraries.\n+\n+  You may place library facilities that are a work based on the\n+Library side by side in a single library together with other library\n+facilities that are not Applications and are not covered by this\n+License, and convey such a combined library under terms of your\n+choice, if you do both of the following:\n+\n+   a) Accompany the combined library with a copy of the same work based\n+   on the Library, uncombined with any other library facilities,\n+   conveyed under the terms of this License.\n+\n+   b) Give prominent notice with the combined library that part of it\n+   is a work based on the Library, and explaining where to find the\n+   accompanying uncombined form of the same work.\n+\n+  6. Revised Versions of the GNU Lesser General Public License.\n+\n+  The Free Software Foundation may publish revised and/or new versions\n+of the GNU Lesser General Public License from time to time. Such new\n+versions will be similar in spirit to the present version, but may\n+differ in detail to address new problems or concerns.\n+\n+  Each version is given a distinguishing version number. If the\n+Library as you received it specifies that a certain numbered version\n+of the GNU Lesser General Public License \"or any later version\"\n+applies to it, you have the option of following the terms and\n+conditions either of that published version or of any later version\n+published by the Free Software Foundation. If the Library as you\n+received it does not specify a version number of the GNU Lesser\n+General Public License, you may choose any version of the GNU Lesser\n+General Public License ever published by the Free Software Foundation.\n+\n+  If the Library as you received it specifies that a proxy can decide\n+whether future versions of the GNU Lesser General Public License shall\n+apply, that proxy's public statement of acceptance of any version is\n+permanent authorization for you to choose that version for the\n+Library.\n+\n+*/\n\\ No newline at end of file"}, {"sha": "b0ff19cbc5a57e32b5c760dc1386799cc9aba7df", "filename": "tools/ScriptQuestReleaseTracker/strmap.h", "status": "added", "additions": 356, "deletions": 0, "changes": 356, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/strmap.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptQuestReleaseTracker/strmap.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptQuestReleaseTracker/strmap.h?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -0,0 +1,356 @@\n+/*\n+ *    strmap version 2.0.1\n+ *\n+ *    ANSI C hash table for strings.\n+ *\n+ *\t  Version history:\n+ *\t  1.0.0 - initial release\n+ *\t  2.0.0 - changed function prefix from strmap to sm to ensure\n+ *\t      ANSI C compatibility\n+ *\t  2.0.1 - improved documentation \n+ *\n+ *    strmap.h\n+ *\n+ *    Copyright (c) 2009, 2011, 2013 Per Ola Kristensson.\n+ *\n+ *    Per Ola Kristensson <pok21@cam.ac.uk> \n+ *    Inference Group, Department of Physics\n+ *    University of Cambridge\n+ *    Cavendish Laboratory\n+ *    JJ Thomson Avenue\n+ *    CB3 0HE Cambridge\n+ *    United Kingdom\n+ *\n+ *    strmap is free software: you can redistribute it and/or modify\n+ *    it under the terms of the GNU Lesser General Public License as published by\n+ *    the Free Software Foundation, either version 3 of the License, or\n+ *    (at your option) any later version.\n+ *\n+ *    strmap is distributed in the hope that it will be useful,\n+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *    GNU Lesser General Public License for more details.\n+ *\n+ *    You should have received a copy of the GNU Lesser General Public License\n+ *    along with strmap.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+#ifndef _STRMAP_H_\n+#define _STRMAP_H_\n+\n+#ifdef __cplusplus\n+extern \"C\"\n+{\n+#endif\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+typedef struct StrMap StrMap;\n+\n+/*\n+ * This callback function is called once per key-value when iterating over\n+ * all keys associated to values.\n+ *\n+ * Parameters:\n+ *\n+ * key: A pointer to a null-terminated C string. The string must not\n+ * be modified by the client.\n+ *\n+ * value: A pointer to a null-terminated C string. The string must\n+ * not be modified by the client.\n+ *\n+ * obj: A pointer to a client-specific object. This parameter may be\n+ * null.\n+ *\n+ * Return value: None.\n+ */\n+typedef void(*sm_enum_func)(const char *key, const char *value, const void *obj);\n+\n+/*\n+ * Creates a string map.\n+ *\n+ * Parameters:\n+ *\n+ * capacity: The number of top-level slots this string map\n+ * should allocate. This parameter must be > 0.\n+ *\n+ * Return value: A pointer to a string map object, \n+ * or null if a new string map could not be allocated.\n+ */\n+StrMap * sm_new(unsigned int capacity);\n+\n+/*\n+ * Releases all memory held by a string map object.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ * If the supplied string map has been previously released, the\n+ * behaviour of this function is undefined.\n+ *\n+ * Return value: None.\n+ */\n+void sm_delete(StrMap *map);\n+\n+/*\n+ * Returns the value associated with the supplied key.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ *\n+ * key: A pointer to a null-terminated C string. This parameter cannot\n+ * be null.\n+ *\n+ * out_buf: A pointer to an output buffer which will contain the value,\n+ * if it exists and fits into the buffer.\n+ *\n+ * n_out_buf: The size of the output buffer in bytes.\n+ *\n+ * Return value: If out_buf is set to null and n_out_buf is set to 0 the return\n+ * value will be the number of bytes required to store the value (if it exists)\n+ * and its null-terminator. For all other parameter configurations the return value\n+ * is 1 if an associated value was found and completely copied into the output buffer,\n+ * 0 otherwise.\n+ */\n+int sm_get(const StrMap *map, const char *key, char *out_buf, unsigned int n_out_buf);\n+\n+/*\n+ * Queries the existence of a key.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ *\n+ * key: A pointer to a null-terminated C string. This parameter cannot\n+ * be null.\n+ *\n+ * Return value: 1 if the key exists, 0 otherwise.\n+ */\n+int sm_exists(const StrMap *map, const char *key);\n+\n+/*\n+ * Associates a value with the supplied key. If the key is already\n+ * associated with a value, the previous value is replaced.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ *\n+ * key: A pointer to a null-terminated C string. This parameter\n+ * cannot be null. The string must have a string length > 0. The\n+ * string will be copied.\n+ *\n+ * value: A pointer to a null-terminated C string. This parameter\n+ * cannot be null. The string must have a string length > 0. The\n+ * string will be copied.\n+ *\n+ * Return value: 1 if the association succeeded, 0 otherwise.\n+ */\n+int sm_put(StrMap *map, const char *key, const char *value);\n+\n+/*\n+ * Returns the number of associations between keys and values.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ *\n+ * Return value: The number of associations between keys and values.\n+ */\n+int sm_get_count(const StrMap *map);\n+\n+/*\n+ * An enumerator over all associations between keys and values.\n+ *\n+ * Parameters:\n+ *\n+ * map: A pointer to a string map. This parameter cannot be null.\n+ *\n+ * enum_func: A pointer to a callback function that will be\n+ * called by this procedure once for every key associated\n+ * with a value. This parameter cannot be null.\n+ *\n+ * obj: A pointer to a client-specific object. This parameter will be\n+ * passed back to the client's callback function. This parameter can\n+ * be null.\n+ *\n+ * Return value: 1 if enumeration completed, 0 otherwise.\n+ */\n+int sm_enum(const StrMap *map, sm_enum_func enum_func, const void *obj);\n+\n+#ifdef __cplusplus\n+}\n+#endif\n+\n+#endif\n+\n+/*\n+\n+\t\t   GNU LESSER GENERAL PUBLIC LICENSE\n+                       Version 3, 29 June 2007\n+\n+ Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>\n+ Everyone is permitted to copy and distribute verbatim copies\n+ of this license document, but changing it is not allowed.\n+\n+\n+  This version of the GNU Lesser General Public License incorporates\n+the terms and conditions of version 3 of the GNU General Public\n+License, supplemented by the additional permissions listed below.\n+\n+  0. Additional Definitions.\n+\n+  As used herein, \"this License\" refers to version 3 of the GNU Lesser\n+General Public License, and the \"GNU GPL\" refers to version 3 of the GNU\n+General Public License.\n+\n+  \"The Library\" refers to a covered work governed by this License,\n+other than an Application or a Combined Work as defined below.\n+\n+  An \"Application\" is any work that makes use of an interface provided\n+by the Library, but which is not otherwise based on the Library.\n+Defining a subclass of a class defined by the Library is deemed a mode\n+of using an interface provided by the Library.\n+\n+  A \"Combined Work\" is a work produced by combining or linking an\n+Application with the Library.  The particular version of the Library\n+with which the Combined Work was made is also called the \"Linked\n+Version\".\n+\n+  The \"Minimal Corresponding Source\" for a Combined Work means the\n+Corresponding Source for the Combined Work, excluding any source code\n+for portions of the Combined Work that, considered in isolation, are\n+based on the Application, and not on the Linked Version.\n+\n+  The \"Corresponding Application Code\" for a Combined Work means the\n+object code and/or source code for the Application, including any data\n+and utility programs needed for reproducing the Combined Work from the\n+Application, but excluding the System Libraries of the Combined Work.\n+\n+  1. Exception to Section 3 of the GNU GPL.\n+\n+  You may convey a covered work under sections 3 and 4 of this License\n+without being bound by section 3 of the GNU GPL.\n+\n+  2. Conveying Modified Versions.\n+\n+  If you modify a copy of the Library, and, in your modifications, a\n+facility refers to a function or data to be supplied by an Application\n+that uses the facility (other than as an argument passed when the\n+facility is invoked), then you may convey a copy of the modified\n+version:\n+\n+   a) under this License, provided that you make a good faith effort to\n+   ensure that, in the event an Application does not supply the\n+   function or data, the facility still operates, and performs\n+   whatever part of its purpose remains meaningful, or\n+\n+   b) under the GNU GPL, with none of the additional permissions of\n+   this License applicable to that copy.\n+\n+  3. Object Code Incorporating Material from Library Header Files.\n+\n+  The object code form of an Application may incorporate material from\n+a header file that is part of the Library.  You may convey such object\n+code under terms of your choice, provided that, if the incorporated\n+material is not limited to numerical parameters, data structure\n+layouts and accessors, or small macros, inline functions and templates\n+(ten or fewer lines in length), you do both of the following:\n+\n+   a) Give prominent notice with each copy of the object code that the\n+   Library is used in it and that the Library and its use are\n+   covered by this License.\n+\n+   b) Accompany the object code with a copy of the GNU GPL and this license\n+   document.\n+\n+  4. Combined Works.\n+\n+  You may convey a Combined Work under terms of your choice that,\n+taken together, effectively do not restrict modification of the\n+portions of the Library contained in the Combined Work and reverse\n+engineering for debugging such modifications, if you also do each of\n+the following:\n+\n+   a) Give prominent notice with each copy of the Combined Work that\n+   the Library is used in it and that the Library and its use are\n+   covered by this License.\n+\n+   b) Accompany the Combined Work with a copy of the GNU GPL and this license\n+   document.\n+\n+   c) For a Combined Work that displays copyright notices during\n+   execution, include the copyright notice for the Library among\n+   these notices, as well as a reference directing the user to the\n+   copies of the GNU GPL and this license document.\n+\n+   d) Do one of the following:\n+\n+       0) Convey the Minimal Corresponding Source under the terms of this\n+       License, and the Corresponding Application Code in a form\n+       suitable for, and under terms that permit, the user to\n+       recombine or relink the Application with a modified version of\n+       the Linked Version to produce a modified Combined Work, in the\n+       manner specified by section 6 of the GNU GPL for conveying\n+       Corresponding Source.\n+\n+       1) Use a suitable shared library mechanism for linking with the\n+       Library.  A suitable mechanism is one that (a) uses at run time\n+       a copy of the Library already present on the user's computer\n+       system, and (b) will operate properly with a modified version\n+       of the Library that is interface-compatible with the Linked\n+       Version.\n+\n+   e) Provide Installation Information, but only if you would otherwise\n+   be required to provide such information under section 6 of the\n+   GNU GPL, and only to the extent that such information is\n+   necessary to install and execute a modified version of the\n+   Combined Work produced by recombining or relinking the\n+   Application with a modified version of the Linked Version. (If\n+   you use option 4d0, the Installation Information must accompany\n+   the Minimal Corresponding Source and Corresponding Application\n+   Code. If you use option 4d1, you must provide the Installation\n+   Information in the manner specified by section 6 of the GNU GPL\n+   for conveying Corresponding Source.)\n+\n+  5. Combined Libraries.\n+\n+  You may place library facilities that are a work based on the\n+Library side by side in a single library together with other library\n+facilities that are not Applications and are not covered by this\n+License, and convey such a combined library under terms of your\n+choice, if you do both of the following:\n+\n+   a) Accompany the combined library with a copy of the same work based\n+   on the Library, uncombined with any other library facilities,\n+   conveyed under the terms of this License.\n+\n+   b) Give prominent notice with the combined library that part of it\n+   is a work based on the Library, and explaining where to find the\n+   accompanying uncombined form of the same work.\n+\n+  6. Revised Versions of the GNU Lesser General Public License.\n+\n+  The Free Software Foundation may publish revised and/or new versions\n+of the GNU Lesser General Public License from time to time. Such new\n+versions will be similar in spirit to the present version, but may\n+differ in detail to address new problems or concerns.\n+\n+  Each version is given a distinguishing version number. If the\n+Library as you received it specifies that a certain numbered version\n+of the GNU Lesser General Public License \"or any later version\"\n+applies to it, you have the option of following the terms and\n+conditions either of that published version or of any later version\n+published by the Free Software Foundation. If the Library as you\n+received it does not specify a version number of the GNU Lesser\n+General Public License, you may choose any version of the GNU Lesser\n+General Public License ever published by the Free Software Foundation.\n+\n+  If the Library as you received it specifies that a proxy can decide\n+whether future versions of the GNU Lesser General Public License shall\n+apply, that proxy's public statement of acceptance of any version is\n+permanent authorization for you to choose that version for the\n+Library.\n+\n+*/\n\\ No newline at end of file"}, {"sha": "5a23d0f23e9876e3d9d3ab473830efb6ae104848", "filename": "tools/ScriptStaticMethodTracker/method_tracker.c", "status": "modified", "additions": 39, "deletions": 37, "changes": 76, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptStaticMethodTracker/method_tracker.c", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptStaticMethodTracker/method_tracker.c", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/method_tracker.c?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -24,8 +24,6 @@\n #include <stdbool.h>\n #include <pcre.h>\n \n-#define SCRIPT_FILES_MAX_CONTENT_SIZE 1777777\n-\n #include \"method_list.h\"\n #include \"script_path.h\"\n \n@@ -63,29 +61,36 @@ JavaMethodList getBestSubstringsFromStringList(char *aStrRegex, JavaMethodList *\n             }\n \n             char *str = method->name;\n-            int pcreExecRet = pcre_exec(reCompiled, pcreExtra, str, strlen(str), 0, 0, subStrVec, subStrVecLength);\n-            if(pcreExecRet < 0) {\n-                switch(pcreExecRet) {\n-                    //case PCRE_ERROR_NOMATCH      : printf(\"String did not match the pattern\\n\");        break;\n-                    case PCRE_ERROR_NULL         : printf(\"Something was null\\n\");                      break;\n-                    case PCRE_ERROR_BADOPTION    : printf(\"A bad option was passed\\n\");                 break;\n-                    case PCRE_ERROR_BADMAGIC     : printf(\"Magic number bad (compiled re corrupt?)\\n\"); break;\n-                    case PCRE_ERROR_UNKNOWN_NODE : printf(\"Something kooky in the compiled re\\n\");      break;\n-                    case PCRE_ERROR_NOMEMORY     : printf(\"Ran out of memory\\n\");                       break;\n-                    //default                      : printf(\"Unknown error\\n\");                           break;\n-                }\n-            } else {\n-                if(pcreExecRet == 0) {\n-                    printf(\"But too many substrings were found to fit in subStrVec!\\n\");\n-                    // Set rc to the max number of substring matches possible.\n-                    pcreExecRet = 30 / 3;\n+            int st = 0, en = strlen(str);\n+            while (st < en) {\n+                int pcreExecRet = pcre_exec(reCompiled, pcreExtra, str, en, st, 0, subStrVec, subStrVecLength);\n+                if(pcreExecRet < 0) {\n+                    switch(pcreExecRet) {\n+                        //case PCRE_ERROR_NOMATCH      : printf(\"String did not match the pattern\\n\");        break;\n+                        case PCRE_ERROR_NULL         : printf(\"Something was null\\n\");                      break;\n+                        case PCRE_ERROR_BADOPTION    : printf(\"A bad option was passed\\n\");                 break;\n+                        case PCRE_ERROR_BADMAGIC     : printf(\"Magic number bad (compiled re corrupt?)\\n\"); break;\n+                        case PCRE_ERROR_UNKNOWN_NODE : printf(\"Something kooky in the compiled re\\n\");      break;\n+                        case PCRE_ERROR_NOMEMORY     : printf(\"Ran out of memory\\n\");                       break;\n+                        //default                      : printf(\"Unknown error\\n\");                           break;\n+                    }\n+\n+                    break;  // no more matches found\n+                } else {\n+                    if(pcreExecRet == 0) {\n+                        printf(\"But too many substrings were found to fit in subStrVec!\\n\");\n+                        // Set rc to the max number of substring matches possible.\n+                        pcreExecRet = 30 / 3;\n+                    }\n+\n+                    const char *psubStrMatchStr;\n+                    pcre_get_substring(str, subStrVec, pcreExecRet, 0, &(psubStrMatchStr));\n+\n+                    insertJavaMethod(&ret, createJavaMethod(psubStrMatchStr));\n+                    pcre_free_substring(psubStrMatchStr);\n+\n+                    st = subStrVec[1];\n                 }\n-\n-                const char *psubStrMatchStr;\n-                pcre_get_substring(str, subStrVec, pcreExecRet, 0, &(psubStrMatchStr));\n-\n-                insertJavaMethod(&ret, createJavaMethod(psubStrMatchStr));\n-                pcre_free_substring(psubStrMatchStr);\n             }\n         }\n     }\n@@ -204,7 +209,6 @@ JavaMethodList trackerFindSourceStaticMethods(JavaMethodList *lines, int lines_s\n             continue;\n         }\n \n-        //printf(\"Java Method: %s\\n\", method->name);\n         insertJavaMethod(&ret, createJavaMethod(method->name));\n     }\n \n@@ -214,17 +218,15 @@ JavaMethodList trackerFindSourceStaticMethods(JavaMethodList *lines, int lines_s\n }\n \n char *getContentFromFile(FILE *f) {\n-    char str[10240];\n-\n-    char *content = (char *)malloc(SCRIPT_FILES_MAX_CONTENT_SIZE * sizeof(char));\n-    content[0] = 0;\n+    fseek(f, 0, SEEK_END);  // implemented by user529758 @ StackOverflow\n+    long fsize = ftell(f);\n+    fseek(f, 0, SEEK_SET);  /* same as rewind(f); */\n \n-    while (!feof(f)) {\n-        fgets(str, 10240, f);\n-        strcat(content, str);\n-    }\n+    char *string = malloc(fsize + 1);\n+    fread(string, 1, fsize, f);\n \n-    return content;\n+    string[fsize] = 0;\n+    return string;\n }\n \n bool locateMethodCall(const char *method_name, char *file_path) {\n@@ -246,6 +248,7 @@ bool locateMethodCall(const char *method_name, char *file_path) {\n     JavaMethodList list = getBestSubstringsFromStringList(aStrRegex, file_content, 1);\n     bool found = (list.size > 0);\n \n+    freeJavaMethodList(&(file_content[0]));\n     free(file_content);\n     fclose(f);\n \n@@ -263,7 +266,7 @@ void locateMethodCalls(const char *method_name, char **file_paths, int file_path\n }\n \n int trackerLocateScriptsStaticCalls(JavaMethodList method_names) {\n-    ScriptFiles *files = createScriptFiles(\"../../HeavenMS/scripts\");\n+    ScriptFiles *files = createScriptFiles(\"../../scripts\");\n     if (files == NULL) {\n         printf(\"ERROR: Could not initialize script files.\\n\");\n         return -1;\n@@ -289,7 +292,7 @@ typedef struct {\n } SourceFilesContent;\n \n SourceFilesContent* readSourceFileContents() {\n-    ScriptFiles *srcFilePaths = createScriptFiles(\"../../HeavenMS/src\");\n+    ScriptFiles *srcFilePaths = createScriptFiles(\"../../src\");\n \n     SourceFilesContent *files = (SourceFilesContent *)malloc(sizeof(SourceFilesContent));\n     files->file_content = (JavaMethodList *)malloc(srcFilePaths->file_paths_size * sizeof(JavaMethodList));\n@@ -311,7 +314,6 @@ SourceFilesContent* readSourceFileContents() {\n         insertJavaMethod(&(files->file_content[i]), createJavaMethod(content));\n     }\n \n-    //printf(\"len: %d\\n\", max_len);\n     freeScriptFiles(srcFilePaths);\n \n     return files;"}, {"sha": "cd2452a5174011bad0b009f5bd2533d0419b35db", "filename": "tools/ScriptStaticMethodTracker/script_path.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptStaticMethodTracker/script_path.h", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/tools/ScriptStaticMethodTracker/script_path.h", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/ScriptStaticMethodTracker/script_path.h?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -21,8 +21,8 @@\n #ifndef SCRIPT_PATH_H_\n #define SCRIPT_PATH_H_\n \n-#define SCRIPT_FILES_MAX_COUNT 20000\n-#define SCRIPT_FILES_MAX_PATH_SIZE 1000\n+#define SCRIPT_FILES_MAX_COUNT 70000\n+#define SCRIPT_FILES_MAX_PATH_SIZE 40000\n \n typedef struct {\n     char **file_paths;"}, {"sha": "647b53de72bfed82ac8bd20e8880dc6732ada842", "filename": "wz/Quest.wz/Act.img.xml", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Act.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Act.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Act.img.xml?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -12775,8 +12775,16 @@\n   </imgdir>\n   <imgdir name=\"2236\">\n     <imgdir name=\"0\">\n+      <string name=\"info\" value=\"000000\"/>\n+      <imgdir name=\"item\">\n+        <imgdir name=\"0\">\n+          <int name=\"id\" value=\"4032263\"/>\n+          <int name=\"count\" value=\"6\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n+      <int name=\"exp\" value=\"60000\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"2237\">\n@@ -20077,6 +20085,7 @@\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n+      <int name=\"pop\" value=\"20\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3115\">"}, {"sha": "f94af3a9356941cf1c6afa9fe070b4b6031a87fd", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 77, "deletions": 12, "changes": 89, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -20136,6 +20136,12 @@\n       <imgdir name=\"job\">\n         <int name=\"0\" value=\"2110\"/>\n       </imgdir>\n+      <int name=\"infoNumber\" value=\"21203\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"1203001\"/>\n@@ -22133,7 +22139,12 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"1061019\"/>\n-      <string name=\"endscript\" value=\"q21728e\"/>\n+      <int name=\"infoNumber\" value=\"21761\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"0\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"21729\">\n@@ -22309,6 +22320,12 @@\n           <int name=\"id\" value=\"9300345\"/>\n         </imgdir>\n       </imgdir>\n+      <int name=\"infoNumber\" value=\"21762\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"2\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"21734\">\n@@ -23461,7 +23478,7 @@\n       <imgdir name=\"mob\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"5130101\"/>\n-          <int name=\"count\" value=\"80\"/>\n+          <int name=\"count\" value=\"100\"/>\n         </imgdir>\n       </imgdir>\n     </imgdir>\n@@ -24184,12 +24201,17 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"1061000\"/>\n-      <string name=\"endscript\" value=\"q2236e\"/>\n       <imgdir name=\"item\">\n         <imgdir name=\"0\">\n           <int name=\"id\" value=\"4032263\"/>\n         </imgdir>\n       </imgdir>\n+      <int name=\"infoNumber\" value=\"2236\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"111111\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"2237\">\n@@ -39696,7 +39718,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2012026\"/>\n-      <string name=\"endscript\" value=\"q3114e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"42\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3115\">\n@@ -40748,7 +40774,6 @@\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n       </imgdir>\n-      <string name=\"endscript\" value=\"q3250e\"/>\n       <int name=\"infoNumber\" value=\"7067\"/>\n       <imgdir name=\"infoex\">\n         <imgdir name=\"0\">\n@@ -41038,7 +41063,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2111000\"/>\n-      <string name=\"endscript\" value=\"q3311e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"5\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3312\">\n@@ -41728,7 +41757,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2020005\"/>\n-      <string name=\"endscript\" value=\"q3345e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"4\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3346\">\n@@ -42046,7 +42079,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2111006\"/>\n-      <string name=\"endscript\" value=\"q3360e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3361\">\n@@ -48377,7 +48414,11 @@\n           <int name=\"id\" value=\"4031579\"/>\n         </imgdir>\n       </imgdir>\n-      <string name=\"endscript\" value=\"q3926e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"3333\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3927\">\n@@ -48393,7 +48434,11 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2101000\"/>\n-      <string name=\"endscript\" value=\"q3927e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3928\">\n@@ -48443,7 +48488,11 @@\n           <int name=\"id\" value=\"4031580\"/>\n         </imgdir>\n       </imgdir>\n-      <string name=\"endscript\" value=\"q3929e\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"3333\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"3930\">\n@@ -50105,6 +50154,12 @@\n     <imgdir name=\"0\">\n       <int name=\"npc\" value=\"9120003\"/>\n       <int name=\"lvmin\" value=\"55\"/>\n+      <imgdir name=\"quest\">\n+        <imgdir name=\"0\">\n+          <int name=\"id\" value=\"4306\"/>\n+          <int name=\"state\" value=\"2\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"9120003\"/>\n@@ -56931,6 +56986,11 @@\n           <int name=\"count\" value=\"1\"/>\n         </imgdir>\n       </imgdir>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"6034\">\n@@ -60034,7 +60094,12 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2095000\"/>\n-      <string name=\"endscript\" value=\"q6410e\"/>\n+      <int name=\"infoNumber\" value=\"6411\"/>\n+      <imgdir name=\"infoex\">\n+        <imgdir name=\"0\">\n+          <string name=\"value\" value=\"p2\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"6700\">"}, {"sha": "1c5d858e442ae393f707ad40ed0fbecf6fd3de0b", "filename": "wz/Quest.wz/QuestInfo.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/QuestInfo.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/QuestInfo.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/QuestInfo.img.xml?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -6467,7 +6467,7 @@ Once there, talk to #b#p1200003##k to board the ship.\n   <imgdir name=\"2198\">\n     <string name=\"name\" value=\"Eliminate the Stone Golems\"/>\n     <string name=\"0\" value=\"Muirhat is worried about the evil spirits that have infiltrated Victoria Island as of late. I wonder what I could do to help? I should go talk to Muirhat on the top deck of The Nautilus.\"/>\n-    <string name=\"1\" value=\"Victoria Island has already been infused with evil spirits. But I refuse to give up like this. I need to eliminate #r80 Stone Golems#k to stop these evil creatures from further spreading their evilness in Victoria Island.  \\n\\n#o 5130101# #r#a21981##k\"/>\n+    <string name=\"1\" value=\"Victoria Island has already been infused with evil spirits. But I refuse to give up like this. I need to eliminate #r100 Stone Golems#k to stop these evil creatures from further spreading their evilness in Victoria Island.  \\n\\n#o 5130101# #r#a21981##k\"/>\n     <string name=\"2\" value=\"I&apos;ve eliminated 100 Stone Golems. I wonder if I&apos;ve made a difference in Victoria Island?\"/>\n     <int name=\"area\" value=\"30\"/>\n   </imgdir>"}, {"sha": "c22151a4e95f6151dc254aef070e8acaa63f8e61", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7ee947b4041852b33832d856b464abfe0ceafb8e/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=7ee947b4041852b33832d856b464abfe0ceafb8e", "patch": "@@ -30134,6 +30134,23 @@\n   </imgdir>\n   <imgdir name=\"3927\">\n     <imgdir name=\"1\">\n+      <string name=\"0\" value=\"Did you find the wall?\\r\\n#L0##b I did, but... I have no idea what it&apos;s talking about.#l\"/>\n+      <string name=\"1\" value=\"What did it say?\\r\\n#L0##b &apos;If I had an iron hammer and a dagger, a bow and an arrow...&apos;#l\\r\\n#L1# &apos;Byron\u2661 Sirin&apos;#l\\r\\n#L2# &apos;Ahhh I forgot.&apos;\"/>\n+      <string name=\"2\" value=\"If I had an iron hammer and a dagger... a bow and an arrow... what does that mean? Do you want me to tell you? I don&apos;t know myself. It&apos;s something you should think about. If you need a clue... it would go something like... a weapon is just an item... until someone uses it...?\"/>\n+      <imgdir name=\"stop\">\n+        <imgdir name=\"npc\">\n+          <string name=\"0\" value=\"I guess you haven&apos;t found #p2103001# yet. Well it&apos;d be tough for you to locate the Sand Bandits anyway...\"/>\n+        </imgdir>\n+        <imgdir name=\"0\">\n+          <int name=\"answer\" value=\"1\"/>\n+        </imgdir>\n+        <imgdir name=\"1\">\n+          <string name=\"1\" value=\"Man, Jiyur wrote on the wall again! Arrgh!!\"/>\n+          <string name=\"2\" value=\"What? You forgot? Do you remember where it was written?\"/>\n+          <int name=\"answer\" value=\"1\"/>\n+        </imgdir>\n+      </imgdir>\n+      <int name=\"ask\" value=\"1\"/>\n     </imgdir>\n     <imgdir name=\"0\">\n       <string name=\"0\" value=\"#m260000000# is a resourceful place that has Lidium, an ore that can only be found at the Oasis and the Nihal Desert. No thanks to the greedy queen, who charges ridiculous amount of taxes, everyone&apos;s struggling these days. Apparently the queen is a fairy from Orbis... and she spends all of the tax money to bring in unfathomable amounts of treasures.\\r\\n#L0##bWhat does the Sultan do?#l\"/>"}]}]},
