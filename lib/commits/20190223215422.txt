{"fetchDate": "2019-12-19", "content": [{"sha": "02ede9329865f4c20e679fc8a44e1662c1342b38", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MDJlZGU5MzI5ODY1ZjRjMjBlNjc5ZmM4YTQ0ZTE2NjJjMTM0MmIzOA==", "commit": {"author": {"name": "Jerry Wang", "email": "jerryw4113@gmail.com", "date": "2019-02-23T21:54:22Z"}, "committer": {"name": "Ronan Lana", "email": "rcpl2010@gmail.com", "date": "2019-02-23T21:54:22Z"}, "message": "Handle reborns(rebirths) - set/get from db, flag to enable/disable and 1 basic NPC to handle it (#413)\n\n* Added ability to handle reborn, option to enable/disable in ServerConstant\r\n\r\n* Basic rebirth NPC for wolf spirit Ryko chan - id 9010021\r\n\r\n* Added player message when rebirth system is off\r\n\r\n* Removed some forgotten comments\r\n\r\n* Ryko now displays original message if rebirth is not enabled", "tree": {"sha": "25a345284597b215761ae97885ec9018624c1f59", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/25a345284597b215761ae97885ec9018624c1f59"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/02ede9329865f4c20e679fc8a44e1662c1342b38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/02ede9329865f4c20e679fc8a44e1662c1342b38", "html_url": "https://github.com/ronancpl/HeavenMS/commit/02ede9329865f4c20e679fc8a44e1662c1342b38", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/02ede9329865f4c20e679fc8a44e1662c1342b38/comments", "author": {"login": "pandabyte", "id": 14182886, "node_id": "MDQ6VXNlcjE0MTgyODg2", "avatar_url": "https://avatars0.githubusercontent.com/u/14182886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pandabyte", "html_url": "https://github.com/pandabyte", "followers_url": "https://api.github.com/users/pandabyte/followers", "following_url": "https://api.github.com/users/pandabyte/following{/other_user}", "gists_url": "https://api.github.com/users/pandabyte/gists{/gist_id}", "starred_url": "https://api.github.com/users/pandabyte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pandabyte/subscriptions", "organizations_url": "https://api.github.com/users/pandabyte/orgs", "repos_url": "https://api.github.com/users/pandabyte/repos", "events_url": "https://api.github.com/users/pandabyte/events{/privacy}", "received_events_url": "https://api.github.com/users/pandabyte/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1772910a5223071bcf96709220ccef610f142c81", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/1772910a5223071bcf96709220ccef610f142c81", "html_url": "https://github.com/ronancpl/HeavenMS/commit/1772910a5223071bcf96709220ccef610f142c81"}], "stats": {"total": 120, "additions": 117, "deletions": 3}, "files": [{"sha": "2d1177d94dad6d814191a7f451c8d358c950abf4", "filename": "scripts/npc/9010021.js", "status": "modified", "additions": 41, "deletions": 3, "changes": 44, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02ede9329865f4c20e679fc8a44e1662c1342b38/scripts/npc/9010021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02ede9329865f4c20e679fc8a44e1662c1342b38/scripts/npc/9010021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9010021.js?ref=02ede9329865f4c20e679fc8a44e1662c1342b38", "patch": "@@ -22,8 +22,46 @@\n /* 9010021 - Wolf Spirit Ryko\n     @author Ronan\n  */\n- \n+ var status;\n+\n function start() {\n-    cm.sendOk(\"... I came from distant planes to assist the fight against the #rBlack Magician#k. Right now I search my master, have you seen him?\");\n-    cm.dispose();\n+    status = -1;\n+    if (!Packages.constants.ServerConstants.USE_REBIRTH_SYSTEM) {\n+        cm.sendOk(\"... I came from distant planes to assist the fight against the #rBlack Magician#k. Right now I search my master, have you seen him?\");\n+        cm.dispose();\n+        return;\n+    }\n+    action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+        status++;\n+    } else {\n+        cm.dispose();\n+        return;\n+    }\n+    if (status == 0) {\n+        cm.sendNext(\"Come to me when you want to be reborn again. You currently have a total of #r\" + cm.getChar().getReborns() + \" #krebirths.\");\n+    } else if (status == 1) {\n+        cm.sendSimple(\"What do you want me to do today: \\r\\n \\r\\n #L0##bI want to be rebirthed#l \\r\\n #L1##bMaybe next time#k#l\");\n+    } else if (status == 2) {\n+        if (selection == 0) {\n+            if (cm.getChar().getLevel() == 200) {\n+                cm.sendYesNo(\"Are you sure you want to be rebirthed?\");\n+            } else {\n+                cm.sendOk(\"You are not level 200, please come back when you hit level 200.\");\n+                cm.dispose();\n+            }\n+        } else if (selection == 1) {\n+            cm.sendOk(\"Ok Bye\")\n+            cm.dispose();\n+        }\n+    } else if (status == 3 && type == 1) {\n+        cm.getChar().executeReborn();\n+        cm.sendOk(\"You have now been reborn. That's a total of #r\" + cm.getChar().getReborns() + \"#k rebirths\");\n+        cm.dispose();\n+    }\n+\n+\n }\n\\ No newline at end of file"}, {"sha": "a481d7c72a9b4bcf285c519af7ab86390ea5043b", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02ede9329865f4c20e679fc8a44e1662c1342b38/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02ede9329865f4c20e679fc8a44e1662c1342b38/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=02ede9329865f4c20e679fc8a44e1662c1342b38", "patch": "@@ -107,6 +107,7 @@\n import tools.MaplePacketCreator;\n import tools.Pair;\n import tools.Randomizer;\n+import tools.exceptions.NotEnabledException;\n import tools.packets.Wedding;\n import client.autoban.AutobanManager;\n import client.creator.CharacterFactoryRecipe;\n@@ -9882,4 +9883,66 @@ public void setRewardPoints(int value) {\n             try { con.close(); } catch (Exception e) { /* ignored */ }\n         }\n     }\n+\n+    public void setReborns(int value) {\n+        if (!ServerConstants.USE_REBIRTH_SYSTEM) {\n+            yellowMessage(\"Rebirth system is not enabled!\");\n+            throw new NotEnabledException();\n+        }\n+        Connection con = null;\n+        PreparedStatement ps = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            ps = con.prepareStatement(\"UPDATE characters SET reborns=? WHERE id=?;\");\n+            ps.setInt(1, value);\n+            ps.setInt(2, id);\n+            ps.executeUpdate();\n+        } catch (SQLException e) {\n+            e.printStackTrace();\n+        } finally {\n+            try { ps.close(); } catch (Exception e) { /* ignored */ }\n+            try { con.close(); } catch (Exception e) { /* ignored */ }\n+        }\n+    }\n+\n+    public void addReborns() {\n+        setReborns(getReborns() + 1);\n+    }\n+\n+    public int getReborns() {\n+        if (!ServerConstants.USE_REBIRTH_SYSTEM) {\n+            yellowMessage(\"Rebirth system is not enabled!\");\n+            throw new NotEnabledException();\n+        }\n+        Connection con = null;\n+        PreparedStatement ps = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            ps = con.prepareStatement(\"SELECT reborns FROM characters WHERE id=?;\");\n+            ps.setInt(1, id);\n+            ResultSet resultSet = ps.executeQuery();\n+            resultSet.next();\n+            return resultSet.getInt(1);\n+        } catch (SQLException e) {\n+            e.printStackTrace();\n+        } finally {\n+            try { ps.close(); } catch (Exception e) { /* ignored */ }\n+            try { con.close(); } catch (Exception e) { /* ignored */ }\n+        }\n+        throw new RuntimeException();\n+    }\n+\n+    public void executeReborn() {\n+        if (!ServerConstants.USE_REBIRTH_SYSTEM) {\n+            yellowMessage(\"Rebirth system is not enabled!\");\n+            throw new NotEnabledException();\n+        }\n+        if (getLevel() != 200) {\n+            return;\n+        }\n+        addReborns();\n+        changeJob(MapleJob.BEGINNER);\n+        setLevel(0);\n+        levelUp(true);\n+    }\n }"}, {"sha": "554dc7f76b7e5773b4fa13ae8b7a376f089131fc", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02ede9329865f4c20e679fc8a44e1662c1342b38/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02ede9329865f4c20e679fc8a44e1662c1342b38/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=02ede9329865f4c20e679fc8a44e1662c1342b38", "patch": "@@ -104,6 +104,7 @@\n     public static final boolean USE_BANISHABLE_TOWN_SCROLL = true;  //Enables town scrolls to act as if it's a \"player banish\", rendering the antibanish scroll effect available.\n     public static final boolean USE_ENABLE_FULL_RESPAWN = true;     //At respawn task, always respawn missing mobs when they're available. Spawn count doesn't depend on how many players are currently there.\n     public static final boolean USE_ENABLE_CHAT_LOG = true;         //Write in-game chat to log\n+    public static final boolean USE_REBIRTH_SYSTEM = false;       //Flag to enable/disable rebirth system\n     \n     //Events/PQs Configuration\n     public static final boolean USE_OLD_GMS_STYLED_PQ_NPCS = true;  //Enables PQ NPCs with similar behaviour to old GMS style, that skips info about the PQs and immediately tries to register the party in."}, {"sha": "8f6bd509d607c4efce672d231c6ef6e3c8096501", "filename": "src/tools/exceptions/NotEnabledException.java", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/02ede9329865f4c20e679fc8a44e1662c1342b38/src/tools/exceptions/NotEnabledException.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/02ede9329865f4c20e679fc8a44e1662c1342b38/src/tools/exceptions/NotEnabledException.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/exceptions/NotEnabledException.java?ref=02ede9329865f4c20e679fc8a44e1662c1342b38", "patch": "@@ -0,0 +1,12 @@\n+package tools.exceptions;\n+\n+public class NotEnabledException extends RuntimeException {\n+\n+    public NotEnabledException() {\n+        super(\"Feature not enabled, please enable the feature in ServerConstant\");\n+    }\n+\n+    public NotEnabledException(String message) {\n+        super(message);\n+    }\n+}"}]}]},
