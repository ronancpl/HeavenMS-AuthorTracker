{"fetchDate": "2019-12-19", "content": [{"sha": "2b44b4baa25d605e28f257d330aadba56e3efcfe", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MmI0NGI0YmFhMjVkNjA1ZTI4ZjI1N2QzMzBhYWRiYTU2ZTNlZmNmZQ==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-10-10T01:39:36Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-10-10T01:39:36Z"}, "message": "Code Coupons + Worldmap update + Mini-games + Player Interaction wrap\n\nFixed several cases on the Cash Shop that would freeze some player actions when triggered, requiring exit Cash Shop to unstuck.\nImplemented Code Coupons, supporting several items bundled on the same code, and also devised a way to automate code generation.\nAdded a current status on-demand option on the Buyback command. Info such as \"current fee\" or \"time remaining\" are available now.\nReviewed several cases where non-owned items would get stacked with owner-tagged items.\nAdded Door support for Happyville, Crimsonwood Keep.\nAdded worldmap tooltip support for some maps in Masteria's C. Keep and H. House.\nAdded Masteria region to the world map.\nC. Keep interiors no longer relocates players to entrance after actions such as logout.\nOverhauled minigame mechanics: from player boxes tooltip and in-match improvements to deploy different minigame types, accordingly with item description or player choice.\nFixed Amoria outskirts not relocating players to city after getting KO'ed.\nFixed issues with pets, rings and cash items being assigned the same cash unique ids leading to some quirks on the cash shop inventory.\nFixed an issue with the recently added HP/MP ratio update, arbitrarily taking off 1 point in certain cases.\nAnswer positions on the explorer's 3rd job quiz are now randomed.\nFixed several issues that showed up when the bcrypt system is disabled.\nDOT from maps such as El Nath and Aqua Road now procs at a 5sec interval, GMS-like.\nImproved performance of Whodrops and Search commands.\nConcurrently protected player interaction handlers, thus mitigating several exploits on these lines.\nAdjusted several expedition timers, such as Horntail, now having a more sane deadline.\nConcurrently protected chair modules.\nFixed \"seduce\" debuff not working on chairs.", "tree": {"sha": "554b34806996d096cfa09b50bc808d5a8ffe679f", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/554b34806996d096cfa09b50bc808d5a8ffe679f"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/2b44b4baa25d605e28f257d330aadba56e3efcfe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/2b44b4baa25d605e28f257d330aadba56e3efcfe", "html_url": "https://github.com/ronancpl/HeavenMS/commit/2b44b4baa25d605e28f257d330aadba56e3efcfe", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/2b44b4baa25d605e28f257d330aadba56e3efcfe/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a8377c283dc133bdd7651b3afef65c08c90f14c", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/3a8377c283dc133bdd7651b3afef65c08c90f14c", "html_url": "https://github.com/ronancpl/HeavenMS/commit/3a8377c283dc133bdd7651b3afef65c08c90f14c"}], "stats": {"total": 22024, "additions": 13770, "deletions": 8254}, "files": [{"sha": "301f14339bbed3b432439da00fa31f47f216bee6", "filename": ".gitignore", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -11,21 +11,25 @@\n /tools/MapleArrowFetcher/dist/\n /tools/MapleArrowFetcher/nbproject/\n \n-/tools/MapleBossHpBarFetcher/nbproject/\n /tools/MapleBossHpBarFetcher/build/\n /tools/MapleBossHpBarFetcher/dist/\n+/tools/MapleBossHpBarFetcher/nbproject/\n \n-/tools/MapleCashDropFetcher/nbproject/\n /tools/MapleCashDropFetcher/build/\n /tools/MapleCashDropFetcher/dist/\n+/tools/MapleCashDropFetcher/nbproject/\n+\n+/tools/MapleCodeCouponGenerator/build/\n+/tools/MapleCodeCouponGenerator/dist/\n+/tools/MapleCodeCouponGenerator/nbproject/\n \n /tools/MapleCouponInstaller/build/\n /tools/MapleCouponInstaller/dist/\n /tools/MapleCouponInstaller/nbproject/\n \n /tools/MapleDojoUpdate/build/\n /tools/MapleDojoUpdate/dist/\n-/tools/MapleDojoUpdate/nbproject/private/\n+/tools/MapleDojoUpdate/nbproject/\n \n /tools/MapleEquipmentOmnileveler/build/\n /tools/MapleEquipmentOmnileveler/dist/\n@@ -59,9 +63,9 @@\n /tools/MapleMobBookUpdate/dist/\n /tools/MapleMobBookUpdate/nbproject/\n \n-/tools/MapleQuestItemCountFetcher/nbproject/\n /tools/MapleQuestItemCountFetcher/build/\n /tools/MapleQuestItemCountFetcher/dist/\n+/tools/MapleQuestItemCountFetcher/nbproject/\n \n /tools/MapleQuestItemFetcher/build/\n /tools/MapleQuestItemFetcher/dist/\n@@ -87,5 +91,9 @@\n /tools/MapleSkillMakerReagentIndexer/dist/\n /tools/MapleSkillMakerReagentIndexer/nbproject/\n \n+/tools/SpiderDropFetcher/build/\n+/tools/SpiderDropFetcher/dist/\n+/tools/SpiderDropFetcher/nbproject/\n+\n /out\n *.onetoc2"}, {"sha": "e113154112e4df98c6054b6513717cff10f93582", "filename": "README.md", "status": "modified", "additions": 39, "deletions": 2, "changes": 41, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -22,7 +22,9 @@ Client files & general tools: https://drive.google.com/drive/folders/0BzDsHSr-0V\n \n **Important note about localhosts**: these executables are red-flagged by antivirus tools as __potentially malicious softwares__, this happens due to the reverse engineering methods that were applied onto these software artifacts. Those depicted here have been put to use for years already and posed no harm so far, so they are soundly assumed to be safe.\n \n-Recommended localhost: https://hostr.co/m2bVtnizCtmD\n+  Latest localhost: https://hostr.co/m2bVtnizCtmD\n+\n+  The following list, in bottom-up chronological order, holds information regarding all changes that were applied from the starting localhost used in this development. Some lines have a link attached, that will lead you to a snapshot of the localhost at that version of the artifact. Naturally, later versions holds all previous changes along with the proposed changes.\n \n **Change log:**\n \n@@ -49,10 +51,27 @@ Recommended localhost: https://hostr.co/m2bVtnizCtmD\n   * MapleSilver's starting on window-mode.\n \n ---\n-### Development status\n+### Development information\n \n Status: <span style=\"color:grey\">__In development (4th round)__</span>.\n \n+#### Mission\n+\n+With non-profitting means intended, provide nostalgic pre-BB MapleStory players world-wide a quality local server for freestyle entertainment.\n+\n+#### Vision\n+\n+By taking the v83 MapleStory as the angular stone, incrementally look forward to improve the gaming experience whilst still retaining the \"clean v83\" conservative ideal. Also, through reviewing distinguished aspects of the server's behavior that could be classified as a potential server threat, in the long run look for ways to improve or even stabilize some of it's uncertain aspects.\n+\n+#### Values\n+\n+* Autonomy, seek self-improvement for tackling issues head-on;\n+* Adventurous, take no fear of failures on the path of progress;\n+* Light-hearted support, general people out there didn't experience what you've already had;\n+* Humility, no matter how good you are, there's no good in boasting yourself over experiences only a few have had;\n+\n+#### Announcements\n+\n HeavenMS development achieved an acceptable state-of-the-art and will get into a halt. A heartfelt thanks for everyone that contributed in some way for the progress of this server!\n \n Although development is halted, support for fixing features that were implemented here is still up. You can still actively help us improve the server by issuing pull requests with informative details about what's changing.\n@@ -179,6 +198,24 @@ In that case, extract \"lolwut.exe\" from \"lolwut-v0.01.rar\" and place it on the M\n \n Important: should the client be refused a connection to the game server, it may be because of firewall issues. Head to the end of this file to proceed in allowing this connection through the computer's firewall. Alternatively, one can deactivate the firewall and try opening the client again.\n \n+---\n+### Creating an account and logging in the game\n+\n+By default, the server source is set to allow AUTO-REGISTERING. This means that, by simply typing in a \"Login ID\" and a \"Password\", you're able to create a new account.\n+\n+After creating a character, experiment typing in all-chat \"@commands\". This will display all available commands for the current GM level your character has.\n+\n+To change a character's GM level, make sure that character is not logged in, then:\n+\n+* Open MySQL Query Browser;\n+* Double-click \"heavenms\" schema;\n+* Double click \"characters\" table;\n+* Execute the selected query;\n+* Mark \"Edit\" flag on the MySQL Query Browser UI screen;\n+* Locate your character's row on the displayed ResultSet;\n+* Edit your character's GM level;\n+* Hit APPLY CHANGES.\n+\n ---\n ### Some notes about WZ/WZ.XML EDITING \n "}, {"sha": "b4ebf0cc3016cb262cb3c64031c934e3f85c64e5", "filename": "docs/feature_list.md", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -68,19 +68,22 @@ Player Social Network:\n * Automated support for Player NPCs and Hall of Fame.\n * Protected concurrently and improved the face expression system, guarding from trivial packet spam and exploits.\n * All upgradeable non-cash equipments in inventory with level & EXP information available for read by anyone, given proper visibility.\n+* Further improved the existent minigame mechanics: remarkably checking out for no-item match requests, allowing different omok/matchcard match layouts and status update on the player matchbox tooltips.\n \n Cash & Items:\n \n * EXP/DROP/Cosmetic Coupons.\n * EXP/DROP coupons now appears as a buff effect when on active time.\n+* Code coupons functional, with support for multiple items on the same code.\n+* Merged unique ids for pets, rings and cash items, thus solving some cash shop inventory issues.\n * Great deal of cash items functional.\n * MapleTV mechanics stabilized and separated by world.\n * GMS-esque omok/match card drop chances.\n * New scroll: antibanish. For use only in cases where bosses send a player back to town.\n * Inventory system properly checks for item slot free space and ownership.\n * Storage with \"Arrange Items\" feature functional.\n * Close-quarters evaluation mode for items (sandbox).\n-* Further improved Karma scissors mechanics.\n+* Further improved Karma scissors & Untradeable items mechanics.\n * Spikes on shoes.\n * Vega's spell.\n * Owl of Minerva.\n@@ -116,6 +119,8 @@ Monsters, Maps & Reactors:\n * Updated many scripted portals not implementing SFX properly.\n * Updated Crimsonwood, World Tour, Nihal Desert and Neo City, enabling quest completion and game progression in these areas.\n * Added world maps for Mushroom Castle, World Tour (Singapore, Malaysia and Zipangu) & Ellin Forest areas.\n+* Added World Tour and Masteria continents in the world map.\n+* Reviewed World Map's town/field tooltips and links from the main world map and Masteria region.\n * Giant Cake (anniversary-themed boss) drops Maple equipments, Maple scrolls, summoning bags and many more interesting items.\n \n PQ potentials:\n@@ -182,13 +187,14 @@ Custom NPCs:\n * Donation Box: automatized item-buyer.\n * Coco & Ace of Hearts: C. scroll crafters.\n \n-Admin/GM commands:\n+Server Commands:\n \n * Server commands layered by GM levels.\n * Spawn Zakum/Horntail/Pinkbean.\n * Several new commands.\n * Rank command highlighting users either by world or server-wide.\n * Revamped command files layout -- thanks Arthur L.\n+* Optimized Search command, caching search range contents and added map search functionality.\n \n External tools:\n "}, {"sha": "518f7a095b04b0404db93d354327be17d8720566", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 62, "deletions": 8, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1276,38 +1276,38 @@ Otimizado fun\u00e7\u00e3o goto, agora n\u00e3o mais gerando mapas de cidade/mapid a todo us\n Melhorado fun\u00e7\u00e3o de disconnect do MapleClient, evitando m\u00faltiplos envios de dados do jogador \u00e0 DB.\n Desenhado (todo conte\u00fado de imagens creditado \u00e0 Nexon) e implementado novos mapas-mundi referente a regi\u00f5es de M. Shrine, Showa, CBD e Metropolis/Kampung.\n \n-03 Agosto 2018,\n+03 Setembro 2018,\n Implementado buffs inexpir\u00e1veis.\n Corrigido comando resetStats n\u00e3o levando em conta AP's atuais dos jogadores.\n Corrigido novo sistema gerenciador de loots removendo a possibilidade de conseguir novos itens de quest ap\u00f3s coleta do primeiro item.\n \n-04 Agosto 2018,\n+04 Setembro 2018,\n Corrigido um flicker na anima\u00e7\u00e3o do efeito da skill Hurricane.\n Ajustado MapleSessionCoordinator, agora verificando HWID's ao inv\u00e9s de contar somente com o remote IP, evitando nega\u00e7\u00e3o de servi\u00e7o para usu\u00e1rios de VPNs.\n Corrigido dispel normal incorretamente mostrando efeitos aleat\u00f3rios a outros jogadores, issue apontado por Thora.\n Corrigido change job n\u00e3o mostrando efeito a outros jogadores.\n Corrigido valores incorretos sendo retirado de jogadores para expans\u00e3o de guild, issue apontado por Thora.\n \n-05 Agosto 2018,\n+05 Setembro 2018,\n Adicionado world map em Ellin Forest.\n Protegido concorrentemente sistema de fames.\n Adicionado ganho de quest points para jogadores que participam de PQs. Reformulado sistema de quest points para viabilizar a nova feature.\n Otimizado m\u00e9todo de ganho de experi\u00eancia em equipamentos, agora devidamente cacheado e sem busca em strings no processo.\n \n-08 Agosto 2018,\n+08 Setembro 2018,\n MapleServerHandler agora \u00e9 devidamente deregistrado ao finalizar uma inst\u00e2ncia de channel, eliminando poss\u00edvel foco de memory leak.\n Fun\u00e7\u00f5es playerDead e playerRevive s\u00e3o agora opcionais em EIM scripts.\n Nova ferramenta: MapleEquipmentOmnileveler. Permite adicionar e atualizar nodos referentes a n\u00edveis para todos os equipamentos. Em jogo, essa adi\u00e7\u00e3o permite jogadores a ver n\u00edvel de qualquer equipamento do jogo.\n \n-09 - 10 Agosto 2018,\n+09 - 10 Setembro 2018,\n Adicionado c\u00e1lculo de MP ao realizar ataques de mobs.\n Aplicado v\u00e1rios pequenos ajustes no handler que lida com movimenta\u00e7\u00e3o de mobs, procurando assim reduzir ruidos no fluxo do jogo (e.g. mob caindo de foothold).\n Corrigido schedules de event instances sendo chamados ap\u00f3s finaliza\u00e7\u00e3o da mesma, levando locks j\u00e1 liberados a serem chamados inesperadamente.\n Corrigido casos onde jogadores poderiam requisitar instancia\u00e7\u00e3o de uma nova PQ, cujo EM que j\u00e1 tenha sido liberado.\n Aplicado reformata\u00e7\u00e3o geral no Character.wz, adicionando nodos de level para todos os equipamentos do jogo. Tal mudan\u00e7a permite que todos os equipamentos exponham n\u00edvel e experi\u00eancia em todos os equipamentos no invent\u00e1rio.\n Implementado c\u00e1lculo de experi\u00eancia no lado do servidor que permite mostrar adequadamente EXP dos equipamentos no lado do cliente.\n \n-11 - 19 Agosto 2018,\n+11 - 19 Setembro 2018,\n Corrigido MP Recovery skill n\u00e3o atuando segundo descri\u00e7\u00e3o, al\u00e9m de matando jogador com pouco HP dispon\u00edvel.\n Refatorado completamente acessos de stats no c\u00f3digo do server.\n Refatorado check de Berserk sendo chamado em m\u00faltiplas se\u00e7\u00f5es do c\u00f3digo.\n@@ -1326,5 +1326,59 @@ Corrigido alliances retendo informa\u00e7\u00f5es de guilds que foram desfeitas na DB.\n Corrigido alliances n\u00e3o salvando nomes de ranks na DB ao serem criadas.\n Adicionado suporte para doors na regi\u00e3o de Mushroom Castle.\n \n-24 Agosto 2018,\n-Resolvido pequenas inconsist\u00eancias entre os XMLs e WZs disponibilizados.\n\\ No newline at end of file\n+24 Setembro 2018,\n+Resolvido pequenas inconsist\u00eancias entre os XMLs e WZs disponibilizados.\n+Alterado \"session write\" para \"announce\", agora devidamente utilizando encapsulamento e lidando com sincroniza\u00e7\u00e3o de servi\u00e7os.\n+\n+25 Setembro 2018,\n+Corrigido diversas exce\u00e7\u00f5es no cash shop congelando pr\u00f3ximas a\u00e7\u00f5es dos jogadores, somente ficando dispon\u00edvel ap\u00f3s sair do mesmo.\n+Reimplementado sistema de code coupons no cash shop.\n+Removido skills Teleport e Super Dragon Roar redundantes do job SuperGM (jobid 910).\n+Adicionado informa\u00e7\u00f5es detalhadas do estado corrente do buyback, em forma de comando.\n+Corrigido desligamento de channel com jogadores dentro do cash shop levando o sistema a lan\u00e7ar algumas exce\u00e7\u00f5es.\n+\n+26 Setembro 2018,\n+Aprimorado code coupons, agora permitindo entrega de v\u00e1rios itens no mesmo c\u00f3digo.\n+Revisado uso de addById no c\u00f3digo, n\u00e3o permitindo adicionar itens limpos em slots de itens que possuem marca\u00e7\u00e3o de dono.\n+Implementado automatiza\u00e7\u00e3o de gera\u00e7\u00e3o de coupon codes baseado em templates, utilizando arquivo XML para pegar os par\u00e2metros.\n+\n+29 Setembro 2018,\n+Corrigido Ereve faltando suporte para um Door portal.\n+Adicionado suporte de Doors para Happyville e Crimsonwood Keep.\n+Melhorado aspectos do world map da regi\u00e3o de Masteria, adicionando interiores de Crimsonwood Keep no mapa e tooltip para interiores de Haunted House no mapa de Masteria.\n+Aprimorado regi\u00e3o interior de Crimsonwood Keep, n\u00e3o mais reposicionando jogadores com a funcionalidade forcedReturn do WZ.\n+Corrigido arredores de Amoria n\u00e3o retornando jogadores para a cidade ao ressucitar pelo m\u00e9todo usual.\n+Corrigido petids e ringids misturando valores com cashids de itens comuns, potencialmente causando problemas com os invent\u00e1rios do jogador e do cash shop da conta do mesmo.\n+\n+30 Setembro 2018,\n+Adicionado regi\u00e3o de Masteria no World Map.\n+Corrigido liga\u00e7\u00e3o de Ludibrium para Orbis n\u00e3o sendo mostrado corretamente.\n+Melhorado ratio update de HP/MP, agora memorizando ratio recentes ao efetuar a\u00e7\u00f5es como modificar status do invent\u00e1rio de itens equipados, entre outros.\n+\n+01 - 03 Outubro 2018,\n+Corrigido diversos problemas com o sistema de login quando o uso do bcrypt est\u00e1 desativado.\n+Implementado/melhorado diversas mec\u00e2nicas dos minigames (do aspecto dos tooltips dos boxes \u00e0s pontua\u00e7\u00f5es visiveis dentro da sala e sistema de pontua\u00e7\u00e3o interno \u00fanico), tornando agora finalmente vi\u00e1vel a jogabilidade estendida dessa funcionalidade.\n+Adicionado server flag para evitar levelup em equipamentos de cash.\n+Melhorado verifica\u00e7\u00e3o de itens untradeable em v\u00e1rios pontos do c\u00f3digo, agora avaliando tamb\u00e9m status de Karma.\n+Adicionado funcionalidade de pesquisa de mapas no comando Search.\n+Otimizado comando Search, agora cacheando dados para as pesquisas.\n+Corrigido pequenas inconsist\u00eancias com HPMP ratio rec\u00e9m implementado.\n+Revisado drop chance de v\u00e1rios itens de quest e diversos ETC drops de mobs de n\u00edvel baixo.\n+Revisado descri\u00e7\u00f5es de v\u00e1rias skills de GM.\n+\n+04 Outubro 2018,\n+Prequest de Zakum agora recompensa 5 Eye of Fire, valor oficial.\n+Modificado script de quiz do 3rd job, agora randomizando posicionamento das respostas.\n+Modificado damage-over-time em mapas como arredores de El Nath e Aqua Road, agora dando dano a cada 5 segundos, como previsto na vers\u00e3o oficial.\n+Corrigido comando Whodrops potencialmente lagando o servidor se comando for spammado por jogadores.\n+Protegido concorrentemente handler de intera\u00e7\u00e3o de jogadores (trades, player shops, minigames, entre outros).\n+Melhorado checagem de acesso concorrente em alguns handlers, agora utilizando sem\u00e1foros para fazer a filtragem de requisi\u00e7\u00f5es a esses handlers.\n+Revertido pet pickup para permitindo coletar itens indiscriminadamente de ataque. Causa de situa\u00e7\u00f5es onde pet pickup evita a\u00e7\u00e3o de ataque de jogador n\u00e3o est\u00e1 claro.\n+Modificado timers para diversas expedi\u00e7\u00f5es, agora com dura\u00e7\u00e3o m\u00e1xima entre 1h30 a 2h.\n+\n+08 Outubro 2018,\n+Protegido concorrentemente m\u00f3dulos de chairs.\n+\n+09 Outubro 2018,\n+Corrigido disease seduce n\u00e3o funcionando da forma esperada quando jogador est\u00e1 sentado.\n+Movido Dropspider para fora do c\u00f3digo-fonte do server, agora estando como uma ferramenta externa.\n\\ No newline at end of file"}, {"sha": "36286ebc6a112dba42a10987c7c2fcf1f897741c", "filename": "handbook/Use.txt", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/handbook/Use.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/handbook/Use.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/handbook/Use.txt?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -903,10 +903,10 @@\n 2048003 - Scroll for Pet Equip. for Jump - Improves jump on pet equip.\\nSuccess rate:100%, jump+1\n 2048004 - Scroll for Pet Equip. for Jump - Improves jump on pet equip.\\nSuccess rate:60%, jump+2. The success rate of this scroll can be enhanced by Vega's Spell.\n 2048005 - Scroll for Pet Equip. for Jump - Improves jump on pet equip.\\nSuccess rate:10%, jump+3. The success rate of this scroll can be enhanced by Vega's Spell.\n-2048006 - Scroll for Speed for Pet Equip. - Improves speed on Pet Equip. nSuccess rate:65%, speed+2\n-2048007 - Scroll for Speed for Pet Equip. - Improves speed on Pet Equip. nSuccess rate:15%, speed+3\n-2048008 - Scroll for jump for Pet Equip. - Improves jump on Pet equip. nSuccess rate:65%, jump+2\n-2048009 - Scroll for jump for Pet Equip. - Improves jump on Pet equip. nSuccess rate:15%, jump+3\n+2048006 - Scroll for Pet Equip. for Speed - Improves speed on Pet Equip. nSuccess rate:65%, speed+2\n+2048007 - Scroll for Pet Equip. for Speed - Improves speed on Pet Equip. nSuccess rate:15%, speed+3\n+2048008 - Scroll for Pet Equip. for Jump - Improves jump on Pet equip. nSuccess rate:65%, jump+2\n+2048009 - Scroll for Pet Equip. for Jump - Improves jump on Pet equip. nSuccess rate:15%, jump+3\n 2048010 - Scroll for Pet Equip. for STR 60% - Improves strength on pet equipments.\\nSuccess rate:60%, STR+1. The success rate of this scroll can be enhanced by Vega's Spell.\n 2048011 - Scroll for Pet Equip. for INT 60% - Improves intelligence on pet equipments.\\nSuccess rate:60%, INT+1. The success rate of this scroll can be enhanced by Vega's Spell.\n 2048012 - Scroll for Pet Equip. for DEX 60% - Improves dexterity on pet equipments.\\nSuccess rate:60%, DEX+1. The success rate of this scroll can be enhanced by Vega's Spell."}, {"sha": "67c9c27960de98cc75964c3b684be04e7628d439", "filename": "nbproject/private/private.properties", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/nbproject/private/private.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/nbproject/private/private.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.properties?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1,10 +1,6 @@\n compile.on.save=true\n do.depend=false\n do.jar=true\n-file.reference.mina-core-2.0.7.jar=C:\\\\Nexon\\\\HeavenMS\\\\cores\\\\mina-core-2.0.7.jar\n-file.reference.mysql-connector-java-bin.jar=C:\\\\Nexon\\\\HeavenMS\\\\cores\\\\mysql-connector-java-bin.jar\n-file.reference.slf4j-api-1.6.6.jar=C:\\\\Nexon\\\\HeavenMS\\\\cores\\\\slf4j-api-1.6.6.jar\n-file.reference.slf4j-jdk14-1.7.5.jar=C:\\\\Nexon\\\\HeavenMS\\\\cores\\\\slf4j-jdk14-1.7.5.jar\n javac.debug=true\n javadoc.preview=true\n user.properties.file=C:\\\\Users\\\\RonanLana\\\\AppData\\\\Roaming\\\\NetBeans\\\\8.0.2\\\\build.properties"}, {"sha": "62e82d2465e003de8b7dc183e1f6b3d74d2a0009", "filename": "nbproject/project.properties", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/project.properties?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -30,20 +30,20 @@ endorsed.classpath=\n excludes=\n file.reference.HikariCP-java7-2.4.12.jar=cores/HikariCP-java7-2.4.12.jar\n file.reference.MapleSolaxia-src=src\n-file.reference.mina-core-2.0.7.jar=cores\\\\mina-core-2.0.7.jar\n-file.reference.mysql-connector-java-bin.jar=cores\\\\mysql-connector-java-bin.jar\n-file.reference.slf4j-api-1.6.6.jar=cores\\\\slf4j-api-1.6.6.jar\n-file.reference.slf4j-jdk14-1.7.5.jar=cores\\\\slf4j-jdk14-1.7.5.jar\n+file.reference.mina-core-2.0.7.jar=cores/mina-core-2.0.7.jar\n+file.reference.mysql-connector-java-bin.jar=cores/mysql-connector-java-bin.jar\n+file.reference.slf4j-api-1.6.6.jar=cores/slf4j-api-1.6.6.jar\n+file.reference.slf4j-jdk14-1.7.5.jar=cores/slf4j-jdk14-1.7.5.jar\n includes=**\n jar.archive.disabled=${jnlp.enabled}\n jar.compress=true\n jar.index=${jnlp.enabled}\n javac.classpath=\\\n+    ${file.reference.HikariCP-java7-2.4.12.jar}:\\\n     ${file.reference.mina-core-2.0.7.jar}:\\\n     ${file.reference.mysql-connector-java-bin.jar}:\\\n     ${file.reference.slf4j-api-1.6.6.jar}:\\\n-    ${file.reference.slf4j-jdk14-1.7.5.jar}:\\\n-    ${file.reference.HikariCP-java7-2.4.12.jar}\n+    ${file.reference.slf4j-jdk14-1.7.5.jar}\n # Space-separated list of extra javac options\n javac.compilerargs=\n javac.deprecation=false"}, {"sha": "391023323ab012f5f80e6adc1e52fd2c10cd7bcf", "filename": "scripts/event/3rdJob_bowman.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_bowman.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_bowman.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_bowman.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -47,7 +47,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "d9401415e0a424ff206bf888d504c919c6153d47", "filename": "scripts/event/3rdJob_magician.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_magician.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_magician.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_magician.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -47,7 +47,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "4b689f3596a0127e8089c131138845988ac95f73", "filename": "scripts/event/3rdJob_mount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_mount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_mount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_mount.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -62,7 +62,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "e149acb930f7761cb3dcbd0faf6186afa4022a63", "filename": "scripts/event/3rdJob_pirate.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_pirate.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_pirate.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_pirate.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -47,7 +47,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "8d925c90889ee3ed7ed26a3fa125f5325f66ab32", "filename": "scripts/event/3rdJob_thief.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_thief.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_thief.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_thief.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -47,7 +47,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "5c47d0916f94309225b556a6c4df13c8882bbef5", "filename": "scripts/event/3rdJob_warrior.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_warrior.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/3rdJob_warrior.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_warrior.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -47,7 +47,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "1949dab5c21c902287fccfb25d2d937f008b11dd", "filename": "scripts/event/4jberserk.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/4jberserk.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/4jberserk.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jberserk.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -58,7 +58,7 @@ function playerEntry(eim, player) {\n     player.changeMap(map, map.getPortal(0));\n \t\n //TODO: hold time across map changes\n-//player.getClient().getSession().write(tools.MaplePacketCreator.getClock(1800));\n+//player.getClient().announce(tools.MaplePacketCreator.getClock(1800));\n }\n \n function playerDead(eim, player) {"}, {"sha": "30cde9317db3d062339ffee01a02d81ba149ee20", "filename": "scripts/event/Aran_2ndmount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Aran_2ndmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Aran_2ndmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_2ndmount.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -53,7 +53,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 2);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "09ccfea5f82eab1008d7e268a6551cd4e75ee42e", "filename": "scripts/event/Aran_3rdmount.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Aran_3rdmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Aran_3rdmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_3rdmount.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -54,7 +54,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 1);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "797f7b23b29f54812017e0443fe4e4d509c98461", "filename": "scripts/event/BalrogQuest.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/BalrogQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/BalrogQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogQuest.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -29,7 +29,7 @@ var exitMap = 105100100;\n var minMapId = 910520000;\n var maxMapId = 910520000;\n \n-var eventTime = 10; //10 minutes\n+var eventTime = 10;     //10 minutes\n \n var lobbyRange = [0, 0];\n \n@@ -56,7 +56,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 1);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "b307bbee25cb97c0d9d121e415e68f3466c1467f", "filename": "scripts/event/DollHouse.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/DollHouse.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/DollHouse.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/DollHouse.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -26,7 +26,7 @@ importPackage(Packages.tools);\n \n var entryMap = 922000010;\n var exitMap = 221024400;\n-var eventTime = 10; //10 minutes\n+var eventTime = 10;     //10 minutes\n \n function init() {\n     em.setProperty(\"noEntry\",\"false\");\n@@ -39,7 +39,7 @@ function playerEntry(eim, player) {\n     player.changeMap(entryMap, 0);\n     em.setProperty(\"noEntry\",\"true\");\n     \n-    player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+    player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n     eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "921efdf8f5d76d7e6c0b151ff43005b5b85d8c49", "filename": "scripts/event/GuildQuest.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/GuildQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/GuildQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuildQuest.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -237,7 +237,7 @@ function changedMap(eim, player, mapid) {\n function afterChangedMap(eim, player, mapid) {\n         if (mapid == 990000100) {\n                 var texttt = \"So, here is the brief. You guys should be warned that, once out on the fortress outskirts, anyone that would not be equipping the #b#t1032033##k will die instantly due to the deteriorated state of the air around there. That being said, once your team moves out, make sure to #bhit the glowing rocks#k in that region and #bequip the dropped item#k before advancing stages. That will protect you thoroughly from the air sickness. Good luck!\";\n-                player.getClient().getSession().write(Packages.tools.MaplePacketCreator.getNPCTalk(9040000, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n+                player.getClient().announce(Packages.tools.MaplePacketCreator.getNPCTalk(9040000, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n         }\n }\n "}, {"sha": "7a3e447418892488eca486d4196a6382b7cc5a1f", "filename": "scripts/event/Hak.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Hak.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/Hak.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Hak.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -34,7 +34,7 @@ function playerEntry(eim, player) {\n         onRide = eim.getMapFactory().getMap(birdRide[myRide]);\n         player.changeMap(onRide, onRide.getPortal(0));\n         \n-        player.getClient().getSession().write(MaplePacketCreator.getClock(rideTime / 1000));\n+        player.getClient().announce(MaplePacketCreator.getClock(rideTime / 1000));\n         eim.schedule(\"timeOut\", rideTime);\n }\n "}, {"sha": "6ed3a6df0bc2bbe2afd90f52a93eef85414cb1d9", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -36,7 +36,7 @@ var clearMap = 240050600;\n var minMapId = 240060000;\n var maxMapId = 240060200;\n \n-var eventTime = 15;     // 15 minutes\n+var eventTime = 120;     // 120 minutes\n \n var lobbyRange = [0, 0];\n "}, {"sha": "13c691df9e89fcae76f9c633aeed88561119340d", "filename": "scripts/event/KerningTrain.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/KerningTrain.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/KerningTrain.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KerningTrain.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -35,8 +35,8 @@ function playerEntry(eim, player) {\n         onRide = eim.getMapFactory().getMap(trainRide[myRide]);\n         player.changeMap(onRide, onRide.getPortal(0));\n         \n-        player.getClient().getSession().write(MaplePacketCreator.getClock(rideTime / 1000));\n-        player.getClient().getSession().write(MaplePacketCreator.earnTitleMessage(\"The next stop is at Kerning \" + (myRide == 0 ? \"Square\" : \"Subway\") + \" Station. The exit is to your left.\"));\n+        player.getClient().announce(MaplePacketCreator.getClock(rideTime / 1000));\n+        player.getClient().announce(MaplePacketCreator.earnTitleMessage(\"The next stop is at Kerning \" + (myRide == 0 ? \"Square\" : \"Subway\") + \" Station. The exit is to your left.\"));\n         eim.schedule(\"timeOut\", rideTime);\n }\n "}, {"sha": "c1daee1b215bb474644472acb9b9f96a89483ef9", "filename": "scripts/event/MK_PrimeMinister2.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/MK_PrimeMinister2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/MK_PrimeMinister2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister2.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2,7 +2,7 @@ importPackage(Packages.tools);\n importPackage(Packages.server.life);\n \n var minPlayers = 1;\n-var eventTime = 10;\n+var eventTime = 10;     // 10 minutes\n var entryMap = 106021402;\n var exitMap = 106021600;\n \n@@ -36,7 +36,7 @@ function playerEntry(eim, player){\n         var pm = MapleLifeFactory.getMonster(3300008);\n         weddinghall.spawnMonsterOnGroundBelow(pm, new Packages.java.awt.Point(472, 27));\n         \n-        player.getClient().getSession().write(MaplePacketCreator.getClock(eventTime * 60));\n+        player.getClient().announce(MaplePacketCreator.getClock(eventTime * 60));\n         eim.startEventTimer(eventTime * 60000);\n }\n "}, {"sha": "9ab4462fdddfb5bfaf9dcf8065acf93a466fc670", "filename": "scripts/event/OrbisPQ.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/OrbisPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/OrbisPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/OrbisPQ.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -180,7 +180,7 @@ function playerEntry(eim, player) {\n         player.changeMap(map, map.getPortal(0));\n         \n         var texttt = \"Hi, my name is Eak, the Chamberlain of the Goddess. Don't be alarmed; you won't be able to see me right now. Back when the Goddess turned into a block of stone, I simultaneously lost my own power. If you gather up the power of the Magic Cloud of Orbis, however, then I'll be able to recover my body and re-transform back to my original self. Please collect #b20#k Magic Clouds and bring them back to me. Right now, you'll only see me as a tiny, flickering light.\";\n-        player.getClient().getSession().write(Packages.tools.MaplePacketCreator.getNPCTalk(2013001, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n+        player.getClient().announce(Packages.tools.MaplePacketCreator.getNPCTalk(2013001, /*(byte)*/ 0, texttt, \"00 00\", /*(byte)*/ 0));\n }\n \n function scheduledTimeout(eim) {"}, {"sha": "a147b862ff37df682a03e56db29a135e1c5b87d8", "filename": "scripts/event/PinkBeanBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/PinkBeanBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/PinkBeanBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PinkBeanBattle.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -37,7 +37,7 @@ var clearMap = 270050300;\n var minMapId = 270050100;\n var maxMapId = 270050300;\n \n-var eventTime = 100;     // 100 minutes\n+var eventTime = 140;     // 140 minutes\n \n var lobbyRange = [0, 0];\n "}, {"sha": "c8b00228d87f236382e8117bae9c3709b6bb806b", "filename": "scripts/event/RockSpirit.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/RockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/RockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpirit.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -22,15 +22,15 @@\n importPackage(Packages.tools);\n \n var exitMap;\n-var startMap;\n+var entryMap;\n var otherMap;\n var minPlayers = 1;\n var fightTime = 60;\n var timer = 1000 * 60 * fightTime;\n \n function init() {\n \texitMap = em.getChannelServer().getMapFactory().getMap(103040400);\n-\tstartMap = em.getChannelServer().getMapFactory().getMap(103040410);\n+\tentryMap = em.getChannelServer().getMapFactory().getMap(103040410);\n \totherMap = em.getChannelServer().getMapFactory().getMap(103040420);\n }\n \n@@ -44,7 +44,7 @@ function setup() {\n function afterSetup(eim) {}\n \n function respawn(eim) {\n-\tvar map = eim.getMapInstance(startMap.getId());\n+\tvar map = eim.getMapInstance(entryMap.getId());\n \tvar map2 = eim.getMapInstance(otherMap.getId());\n \tmap.allowSummonState(true);\n \tmap2.allowSummonState(true);\n@@ -55,7 +55,7 @@ function respawn(eim) {\n \n \n function playerEntry(eim, player) {\n-\tvar amplifierMap = eim.getMapInstance(startMap.getId());\n+\tvar amplifierMap = eim.getMapInstance(entryMap.getId());\n \tplayer.changeMap(amplifierMap);\n     eim.schedule(\"timeOut\", timer);\n }\n@@ -107,7 +107,7 @@ function playerExit(eim, player) {\n function moveMap(eim, player) {\n \tif (player.getMap().getId() == exitMap.getId()) {\n \t\tremovePlayer(eim, player);\n-\t\tplayer.getClient().getSession().write(MaplePacketCreator.removeClock());\n+\t\tplayer.getClient().announce(MaplePacketCreator.removeClock());\n \t\teim.dispose();\n \t}\n }"}, {"sha": "f7e60a5e6bffe947a4e49cdbeb926a2e1f63d5fb", "filename": "scripts/event/RockSpiritVIP.js", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/RockSpiritVIP.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/RockSpiritVIP.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpiritVIP.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -22,15 +22,15 @@\n importPackage(Packages.tools);\n \n var exitMap;\n-var startMap;\n+var entryMap;\n var otherMap;\n var minPlayers = 1;\n var fightTime = 30;\n var timer = 1000 * 60 * fightTime;\n \n function init() {\n \texitMap = em.getChannelServer().getMapFactory().getMap(103040400);\n-\tstartMap = em.getChannelServer().getMapFactory().getMap(103040440);\n+\tentryMap = em.getChannelServer().getMapFactory().getMap(103040440);\n \totherMap = em.getChannelServer().getMapFactory().getMap(103040450);\n }\n \n@@ -44,7 +44,7 @@ function setup() {\n function afterSetup(eim) {}\n \n function respawn(eim) {\n-\tvar map = eim.getMapInstance(startMap.getId());\n+\tvar map = eim.getMapInstance(entryMap.getId());\n \tvar map2 = eim.getMapInstance(otherMap.getId());\n \tmap.allowSummonState(true);\n \tmap2.allowSummonState(true);\n@@ -55,7 +55,7 @@ function respawn(eim) {\n \n \n function playerEntry(eim, player) {\n-\tvar amplifierMap = eim.getMapInstance(startMap.getId());\n+\tvar amplifierMap = eim.getMapInstance(entryMap.getId());\n \tplayer.changeMap(amplifierMap);\n         eim.schedule(\"timeOut\", timer);\n }\n@@ -107,7 +107,7 @@ function playerExit(eim, player) {\n function moveMap(eim, player) {\n \tif (player.getMap().getId() == exitMap.getId()) {\n \t\tremovePlayer(eim, player);\n-\t\tplayer.getClient().getSession().write(MaplePacketCreator.removeClock());\n+\t\tplayer.getClient().announce(MaplePacketCreator.removeClock());\n \t\teim.dispose();\n \t}\n }"}, {"sha": "a91296c1870d32281e89742006873588f8ba3e30", "filename": "scripts/event/ZakumBattle.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/ZakumBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/event/ZakumBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumBattle.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -36,7 +36,7 @@ var clearMap = 211042400;\n var minMapId = 280030000;\n var maxMapId = 280030000;\n \n-var eventTime = 60;     // 60 minutes\n+var eventTime = 120;     // 120 minutes\n \n var lobbyRange = [0, 0];\n "}, {"sha": "8b0ccf4333241799254195e709fcb1f6565edd8d", "filename": "scripts/map/onFirstUserEnter/killing_MapSetting.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/map/onFirstUserEnter/killing_MapSetting.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/map/onFirstUserEnter/killing_MapSetting.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onFirstUserEnter/killing_MapSetting.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -3,7 +3,7 @@\n function start(ms) { \n     //var pq = ms.getPyramid();\n     //ms.getPlayer().resetEnteredScript();\n-    //ms.getClient().getSession().write(MaplePacketCreator.getClock(pq.timer()));\n+    //ms.getClient().announce(MaplePacketCreator.getClock(pq.timer()));\n }\n /*\n killing/first/stage"}, {"sha": "57d476e830cf7298f521d057b49229bf7dc63272", "filename": "scripts/map/onFirstUserEnter/spaceGaGa_start.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/map/onFirstUserEnter/spaceGaGa_start.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/map/onFirstUserEnter/spaceGaGa_start.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/map/onFirstUserEnter/spaceGaGa_start.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -29,11 +29,11 @@ var player;\n function start(ms) { \n \tplayer = ms.getPlayer();\n         player.resetEnteredScript(); \n-        ms.getClient().getSession().write(MaplePacketCreator.showEffect(\"event/space/start\")); \n+        ms.getClient().announce(MaplePacketCreator.showEffect(\"event/space/start\")); \n         player.startMapEffect(\"Please rescue Gaga within the time limit.\", 5120027); \n \tvar map = player.getMap();\n \tif (map.getTimeLeft() > 0) {\n-\t\tms.getClient().getSession().write(MaplePacketCreator.getClock(map.getTimeLeft()));\n+\t\tms.getClient().announce(MaplePacketCreator.getClock(map.getTimeLeft()));\n \t} else {\n \t\tmap.addMapTimer(180);\n \t}"}, {"sha": "7835599d79c862f6d398580884ff651e8f6a0a2e", "filename": "scripts/npc/1061010.js", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/1061010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/1061010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1061010.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -21,13 +21,14 @@ function action(mode, type, selection) {\n         if(status == 0){\n                 cm.sendYesNo(\"Would you like to leave?\");\n         }else if(status == 1){\n-                var mapid = cm.getMapId();\n-                if(mapid == 108010101) cm.getPlayer().changeMap(105040305);\n-                else if(mapid == 108010201) cm.getPlayer().changeMap(100040106);\n-                else if(mapid == 108010301) cm.getPlayer().changeMap(105070001);\n-                else if(mapid == 108010401) cm.getPlayer().changeMap(107000402);\n-                else if(mapid == 108010501) cm.getPlayer().changeMap(105070200);\n+                var mapid = cm.getMapId(), exitid = mapid;\n+                if(mapid == 108010101) exitid = 105040305;\n+                else if(mapid == 108010201) exitid = 100040106;\n+                else if(mapid == 108010301) exitid = 105070001;\n+                else if(mapid == 108010401) exitid = 107000402;\n+                else if(mapid == 108010501) exitid = 105070200;\n \n+                if (mapid != exitid) cm.getPlayer().changeMap(exitid);\n                 cm.dispose();\n         }\n     }"}, {"sha": "2ce3f079ad9e1807a1b6b06a3e07d6e8d95388d9", "filename": "scripts/npc/2020008.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020008.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -92,7 +92,7 @@ function action(mode, type, selection){\n         else if (status == 2) {\n             if (cm.getPlayer().getRemainingSp() > 0)\n                 if (cm.getPlayer().getRemainingSp() > (cm.getLevel() - 70) * 3) {\n-                    cm.sendNext(\"Please, use all your SP before contining.\");\n+                    cm.sendNext(\"Please, use all your SP before continuing.\");\n                     cm.dispose();\n                     return;\n                 }"}, {"sha": "39ab767c6c530632b83188ccfe747e0b0258df79", "filename": "scripts/npc/2020009.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020009.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -64,7 +64,7 @@ function action(mode, type, selection){\n \t\telse if (status == 2) {\n \t\t    if (cm.getPlayer().getRemainingSp() > 0)\n \t\t\t    if (cm.getPlayer().getRemainingSp() > (cm.getLevel() - 70) * 3) {\n-\t\t\t\t    cm.sendNext(\"Please, use all your SP before contining.\");\n+\t\t\t\t    cm.sendNext(\"Please, use all your SP before continuing.\");\n \t\t\t\t\tcm.dispose();\n \t\t\t\t\treturn;\n \t\t\t\t}"}, {"sha": "cab227ff6f734696abf9b904d3a4a9d4429f9289", "filename": "scripts/npc/2020010.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020010.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020010.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020010.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -66,7 +66,7 @@ function action(mode, type, selection){\n \t\telse if (status == 2) {\n \t\t    if (cm.getPlayer().getRemainingSp() > 0)\n \t\t\t    if (cm.getPlayer().getRemainingSp() > (cm.getLevel() - 70) * 3) {\n-\t\t\t\t    cm.sendNext(\"Please, use all your SP before contining.\");\n+\t\t\t\t    cm.sendNext(\"Please, use all your SP before continuing.\");\n \t\t\t\t\tcm.dispose();\n \t\t\t\t\treturn;\n \t\t\t\t}"}, {"sha": "a85730f09d6e927006dc124a8492843373f84de4", "filename": "scripts/npc/2020011.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020011.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -64,7 +64,7 @@ function action(mode, type, selection){\n         else if (status == 2) {\n             if (cm.getPlayer().getRemainingSp() > 0)\n                 if (cm.getPlayer().getRemainingSp() > (cm.getLevel() - 70) * 3) {\n-                    cm.sendNext(\"Please, use all your SP before contining.\");\n+                    cm.sendNext(\"Please, use all your SP before continuing.\");\n                     cm.dispose();\n                     return;\n                 }"}, {"sha": "edec8efb1a0416164c6d27d5dea073cd2831a242", "filename": "scripts/npc/2020013.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020013.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2020013.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2020013.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -64,7 +64,7 @@ function action(mode, type, selection){\n         else if (status == 2) {\n             if (cm.getPlayer().getRemainingSp() > 0)\n                 if (cm.getPlayer().getRemainingSp() > (cm.getLevel() - 70) * 3) {\n-                    cm.sendNext(\"Please, use all your SP before contining.\");\n+                    cm.sendNext(\"Please, use all your SP before continuing.\");\n                     cm.dispose();\n                     return;\n                 }"}, {"sha": "6cc117e1e1851b41ef3e9140d098749fa7bef2fb", "filename": "scripts/npc/2030006.js", "status": "modified", "additions": 40, "deletions": 6, "changes": 46, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2030006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2030006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2030006.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@ var questionTree = [\n         //Questions Related to MONSTERS\n         [\"Green Mushroom, Tree Stump, Bubbling, Axe Stump, Octopus, which is highest level of all?\", [\"Tree Stump\", \"Bubbling\", \"Axe Stump\", \"Octopus\", \"Green Mushroom\"], 2],\n         [\"Which monster will be seen during the ship trip to Orbis/Ellinia?\", [\"Werewolf\", \"Slime\", \"Crimson Balrog\", \"Zakum\", \"Star Pixie\"], 2],\n-        [\"Maple Island doesn't have which following monsters?\", [\"Shroom\", \"Blue Snail\", \"Orange Mushroom\", \"Red Snail\", \"Pig\"], 4],\n+        [\"Maple Island doesn't have which following monsters?\", [\"Green Mushroom\", \"Blue Snail\", \"Orange Mushroom\", \"Red Snail\", \"Pig\"], 0],\n         [\"Which monster is not at Victoria Island and Sleepywood?\", [\"Evil Eye\", \"Sentinel\", \"Jr. Balrog\", \"Ghost Stump\", \"Snail\"], 1],\n         [\"El Nath doesn't have which following monsters?\", [\"Dark Yeti\", \"Dark Ligator\", \"Yeti & Pepe\", \"Bain\", \"Coolie Zombie\"], 1],\n         [\"Which of following monsters can fly?\", [\"Malady\", \"Ligator\", \"Cold Eye\", \"Meerkat\", \"Alishar\"], 0],\n@@ -80,6 +80,8 @@ var question;\n var questionPool;\n var questionPoolCursor;\n \n+var questionAnswer;\n+\n function start() {\n     status = -1;\n     action(1, 0, 0);\n@@ -121,7 +123,10 @@ function action(mode, type, selection) {\n             question = fetchNextQuestion();\n             var questionHead = generateQuestionHeading();\n             var questionEntry = questionTree[question][0];\n-            var questionOptions = generateSelectionMenu(questionTree[question][1]);\n+            \n+            var questionData = generateSelectionMenu(questionTree[question][1], questionTree[question][2]);\n+            var questionOptions = questionData[0];\n+            questionAnswer = questionData[1];\n             \n             cm.sendSimple(questionHead + questionEntry + \"\\r\\n\\r\\n#b\" + questionOptions + \"#k\");\n         } else if(status >= 2 && status <= 5) {\n@@ -134,7 +139,10 @@ function action(mode, type, selection) {\n             question = fetchNextQuestion();\n             var questionHead = generateQuestionHeading();\n             var questionEntry = questionTree[question][0];\n-            var questionOptions = generateSelectionMenu(questionTree[question][1]);\n+            \n+            var questionData = generateSelectionMenu(questionTree[question][1], questionTree[question][2]);\n+            var questionOptions = questionData[0];\n+            questionAnswer = questionData[1];\n             \n             cm.sendSimple(questionHead + questionEntry + \"\\r\\n\\r\\n#b\" + questionOptions + \"#k\");\n         } else if(status == 6) {\n@@ -155,7 +163,7 @@ function action(mode, type, selection) {\n }\n \n function evaluateAnswer(selection) {\n-    return selection == questionTree[question][2];\n+    return selection == questionAnswer;\n }\n \n function generateQuestionHeading() {\n@@ -189,10 +197,36 @@ function fetchNextQuestion() {\n     return next;\n }\n \n-function generateSelectionMenu(array) {\n+function shuffle(array) {\n+    var currentIndex = array.length, temporaryValue, randomIndex;\n+\n+    // While there remain elements to shuffle...\n+    while (0 !== currentIndex) {\n+\n+        // Pick a remaining element...\n+        randomIndex = Math.floor(Math.random() * currentIndex);\n+        currentIndex -= 1;\n+\n+        // And swap it with the current element.\n+        temporaryValue = array[currentIndex];\n+        array[currentIndex] = array[randomIndex];\n+        array[randomIndex] = temporaryValue;\n+    }\n+\n+    return array;\n+}\n+\n+function generateSelectionMenu(array, answer) {\n+    var answerStr = array[answer], answerPos = -1;\n+    \n+    shuffle(array);\n+    \n     var menu = \"\";\n     for (var i = 0; i < array.length; i++) {\n         menu += \"#L\" + i + \"#\" + array[i] + \"#l\\r\\n\";\n+        if (answerStr == array[i]) {\n+            answerPos = i;\n+        }\n     }\n-    return menu;\n+    return [menu, answerPos];\n }\n\\ No newline at end of file"}, {"sha": "31a3afa6f46f2502328fa65b0a52c07cc077482d", "filename": "scripts/npc/2030008.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2030008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/2030008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2030008.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -107,14 +107,14 @@ function action(mode, type, selection) {\n             } else {\n                 if(cm.haveItem(4031061) && cm.haveItem(4031062)) {\n                     if(!cm.haveItem(4000082, 30)) {\n-                        cm.sendOk(\"You have completed the trials, however there's still the need of #b30 #t4000082##k to forge the #t4001017#.\");\n+                        cm.sendOk(\"You have completed the trials, however there's still the need of #b30 #t4000082##k to forge 5 #t4001017#.\");\n                     } else {\n                         cm.completeQuest(100201);\n                         cm.gainItem(4031061, -1);\n                         cm.gainItem(4031062, -1);\n                         cm.gainItem(4000082, -30);\n \n-                        cm.gainItem(4001017, 1);\n+                        cm.gainItem(4001017, 5);\n                         cm.sendNext(\"You #rhave completed the trials#k, from now on having my approval to challenge Zakum.\");\n                     }\n                     "}, {"sha": "49790a53847c8096e1a8dd7f5e32e2bbebeccff7", "filename": "scripts/npc/9201021.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/9201021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/9201021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201021.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -21,7 +21,7 @@\n */\n var status = 0;  \n \n-function start() {  \n+function start() {\n     if(cm.getMapId() != 680000401) cm.sendSimple(\"Hello, where would you like to go?\\r\\n#b\" + ((cm.getMapId() != 680000400) ? \"#L0#Untamed Hearts Hunting Ground#l\\r\\n\" : \"\") + ((cm.getMapId() == 680000400) ? \"#L1#I have 7 keys. Bring me to smash boxes#l\\r\\n\" : \"\") + \"#L2#Please warp me out.#l#k\");\n     else cm.sendSimple(\"Hello, do you want to go back now? Returning here again will cost you #rother 7 keys#k.\\r\\n#b#L2#Please warp me back to the training grounds.#l#k\");\n }  "}, {"sha": "49f1748f541cca4539303537801f10916d21e319", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -82,19 +82,22 @@ function writeFeatureTab_PlayerSocialNetwork() {\n         addFeature(\"Automated support for Player NPCs and Hall of Fame.\");\n         addFeature(\"Engagement & Wedding system.\");\n         addFeature(\"Equipments displays to everyone it's level & EXP info.\");\n+        addFeature(\"Further improved the existent minigame mechanics.\");\n }\n \n function writeFeatureTab_CashItems() {\n         addFeature(\"EXP/DROP/Cosmetic Coupons.\");\n         addFeature(\"EXP/DROP Coupon as buff effect during active time.\");\n         addFeature(\"Great deal of cash items functional.\");\n+        addFeature(\"Code coupons functional, with multi-items support.\");\n+        addFeature(\"Merged unique ids for pets, rings and cash items.\");\n         addFeature(\"MapleTV mechanics stabilized and split by world.\");\n         addFeature(\"GMS-esque omok/match card drop chances.\");\n         addFeature(\"New town scroll: antibanish. Counters boss banishes.\");\n         addFeature(\"Inventory system checks for free slot & stack space.\");\n         addFeature(\"Storage with 'Arrange Items' feature functional.\");\n         addFeature(\"Close-quarters evaluation mode for items.\");\n-        addFeature(\"Further improved Karma scissors.\");\n+        addFeature(\"Reviewed Karma scissors & Untradeable items.\");\n         addFeature(\"Scroll for Spikes on Shoes.\");\n         addFeature(\"Scroll for Cold Protection.\");\n         addFeature(\"Vega's spell.\");\n@@ -133,6 +136,8 @@ function writeFeatureTab_MonstersMapsReactors() {\n         addFeature(\"Updated scripted portals, now with proper portal SFX.\");\n         addFeature(\"Reviewed Masteria, W. Tour, N. Desert and Neo City.\");\n         addFeature(\"Added world maps for M. Castle, W. Tour & Ellin areas.\");\n+        addFeature(\"Added W. Tour & Masteria continents in the world map.\");\n+        addFeature(\"Reviewed several issues with W. Map tooltips & links.\");\n         addFeature(\"Giant Cake boss drops s. bags and Maple items.\");\n }\n \n@@ -197,6 +202,7 @@ function writeFeatureTab_Commands() {\n         addFeature(\"Rank command highlighting users by world or overall.\");\n         addFeature(\"Server commands layered by GM levels.\");\n         addFeature(\"Revamped command files layout - thanks Arthur L!\");\n+        addFeature(\"Improved 'Search' performance & added map search.\");\n }\n \n function writeFeatureTab_CustomNPCs() {\n@@ -274,9 +280,9 @@ function action(mode, type, selection) {\n                         status++;\n                 else\n                         status--;\n-    \n+                    \n                 if (status == 0) {\n-                        var sendStr = \"HeavenMS was developed on the timespan of 3 years, based on where Solaxia left. On the meantime many nice features emerged, development aimed to get back the old GMS experience. Now many of these so-long missing features are gracefully presented to you in the shape of this server. Long live MapleStory!!\\r\\n\\r\\nThese are the features from #bHeavenMS#k:\\r\\n\\r\\n\";\n+                        var sendStr = \"HeavenMS was developed on the timespan of 3 years, based on where Solaxia left. I'm glad to say the development itself had continuously been agraciated by dozens of contributors and cheerers (truly thanks for the trusting vow, guys & gals!).\\r\\n\\r\\nTalking about results: many nice features emerged, development aimed to get back the old GMS experience. Now many of these so-long missing features are gracefully presented to you in the shape of this server. Long live MapleStory!!\\r\\n\\r\\nThese are the features from #bHeavenMS#k:\\r\\n\\r\\n\";\n                         for(var i = 0; i < tabs.length; i++) {\n                             sendStr += \"#L\" + i + \"##b\" + tabs[i] + \"#k#l\\r\\n\";\n                         }"}, {"sha": "7544ede3f7d3fccf6da61170051976ba4c3785bf", "filename": "scripts/npc/credits.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/credits.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/scripts/npc/credits.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/credits.js?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -37,6 +37,7 @@ function writeServerStaff_HeavenMS() {\n         addPerson(\"Ronan\", \"Developer\");\n         addPerson(\"Vcoc\", \"Freelance Developer\");\n         addPerson(\"Thora\", \"Contributor\");\n+        addPerson(\"GabrielSin\", \"Contributor\");\n         \n         setHistory(2015, 2018);\n }"}, {"sha": "05a51d72d9b0eca91942148b8c954e1c675a13c4", "filename": "sql/db_database.sql", "status": "modified", "additions": 16, "deletions": 27, "changes": 43, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -16,7 +16,6 @@ CREATE TABLE IF NOT EXISTS `accounts` (\n   `id` int(11) NOT NULL AUTO_INCREMENT,\n   `name` varchar(13) NOT NULL DEFAULT '',\n   `password` varchar(128) NOT NULL DEFAULT '',\n-  `salt` varchar(128) DEFAULT NULL,\n   `pin` varchar(10) DEFAULT NULL,\n   `pic` varchar(26) DEFAULT NULL,\n   `loggedin` tinyint(4) NOT NULL DEFAULT '0',\n@@ -4517,7 +4516,7 @@ INSERT IGNORE INTO `temp_data` (`id`, `dropperid`, `itemid`, `minimum_quantity`,\n (4298, 5130107, 4130006, 1, 1, 0, 6000),\n (4299, 5130107, 4130011, 1, 1, 0, 6000),\n (4300, 5130108, 4000069, 1, 1, 0, 600000),\n-(4301, 5130108, 4000082, 1, 1, 0, 40000),\n+(4301, 5130108, 4000082, 1, 1, 0, 20000),\n (4302, 5130108, 2000003, 1, 1, 0, 20000),\n (4303, 5130108, 2000004, 1, 1, 0, 20000),\n (4304, 5130108, 2000002, 1, 1, 0, 20000),\n@@ -12926,15 +12925,6 @@ CREATE TABLE IF NOT EXISTS `hiredmerchant` (\n   PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n-CREATE TABLE IF NOT EXISTS `htsquads` (\n-  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n-  `channel` int(10) unsigned NOT NULL,\n-  `leaderid` int(10) unsigned NOT NULL DEFAULT '0',\n-  `status` int(10) unsigned NOT NULL DEFAULT '0',\n-  `members` int(10) unsigned NOT NULL DEFAULT '0',\n-  PRIMARY KEY (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n-\n CREATE TABLE IF NOT EXISTS `hwidaccounts` (\n   `accountid` int(11) NOT NULL DEFAULT '0',\n   `hwid` varchar(40) NOT NULL DEFAULT '',\n@@ -16393,13 +16383,21 @@ CREATE TABLE IF NOT EXISTS `notes` (\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `nxcode` (\n-  `code` varchar(15) NOT NULL,\n-  `valid` int(11) NOT NULL DEFAULT '1',\n-  `user` varchar(13) DEFAULT NULL,\n-  `type` int(11) NOT NULL DEFAULT '0',\n-  `item` int(11) NOT NULL DEFAULT '10000',\n-  PRIMARY KEY (`code`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1;\n+  `id` int(11) NOT NULL AUTO_INCREMENT,\n+  `code` varchar(17) NOT NULL UNIQUE,\n+  `retriever` varchar(13) DEFAULT NULL,\n+  `expiration` bigint(20) unsigned NOT NULL DEFAULT '0',\n+  PRIMARY KEY (`id`)\n+) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+\n+CREATE TABLE IF NOT EXISTS `nxcode_items` (\n+  `id` int(11) NOT NULL AUTO_INCREMENT,\n+  `codeid` int(11) NOT NULL,\n+  `type` int(11) NOT NULL DEFAULT '5',\n+  `item` int(11) NOT NULL DEFAULT '4000000',\n+  `quantity` int(11) NOT NULL DEFAULT '1',\n+  PRIMARY KEY (`id`)\n+) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n CREATE TABLE IF NOT EXISTS `nxcoupons` (\n   `id` int(11) NOT NULL AUTO_INCREMENT,\n@@ -21414,15 +21412,6 @@ CREATE TABLE IF NOT EXISTS `wishlists` (\n   PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n-CREATE TABLE IF NOT EXISTS `zaksquads` (\n-  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n-  `channel` int(10) unsigned NOT NULL,\n-  `leaderid` int(10) unsigned NOT NULL DEFAULT '0',\n-  `status` int(10) unsigned NOT NULL DEFAULT '0',\n-  `members` int(10) unsigned NOT NULL DEFAULT '0',\n-  PRIMARY KEY (`id`)\n-) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n-\n \n ALTER TABLE `dueyitems`\n   ADD CONSTRAINT `dueyitems_ibfk_1` FOREIGN KEY (`PackageId`) REFERENCES `dueypackages` (`PackageId`) ON DELETE CASCADE;"}, {"sha": "9bbc61ad1aac31b243de33a35e703a860a8ff2a6", "filename": "sql/db_drops.sql", "status": "modified", "additions": 51, "deletions": 51, "changes": 102, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -412,9 +412,9 @@ USE `heavenms`;\n (1210102, 4030001, 1, 1, 0, 10000), \n (9300229, 4030001, 1, 1, 0, 10000), \n (9500102, 4030001, 1, 1, 0, 10000),\n-(1210102, 4001345, 1, 1, 0, 7000), \n-(9300229, 4001345, 1, 1, 0, 7000), \n-(9500102, 4001345, 1, 1, 0, 7000), \n+(1210102, 4001345, 1, 1, 0, 70000), \n+(9300229, 4001345, 1, 1, 0, 70000), \n+(9500102, 4001345, 1, 1, 0, 70000), \n (1210102, 2000000, 1, 1, 0, 40000),\n (9300229, 2000000, 1, 1, 0, 40000), \n (9500102, 2000000, 1, 1, 0, 40000), \n@@ -508,18 +508,18 @@ USE `heavenms`;\n (1210101, 4000021, 1, 1, 0, 200000), \n (9300059, 4000021, 1, 1, 0, 200000), \n (9400242, 4000021, 1, 1, 0, 200000), \n-(1210101, 4003004, 1, 1, 0, 7000), \n-(9300059, 4003004, 1, 1, 0, 7000), \n-(9400242, 4003004, 1, 1, 0, 7000), \n+(1210101, 4003004, 1, 1, 0, 70000), \n+(9300059, 4003004, 1, 1, 0, 70000), \n+(9400242, 4003004, 1, 1, 0, 70000), \n (1210101, 4030012, 1, 1, 0, 125000), \n (9300059, 4030012, 1, 1, 0, 125000), \n (9400242, 4030012, 1, 1, 0, 125000), \n-(1210101, 4001343, 1, 1, 0, 7000), \n-(9300059, 4001343, 1, 1, 0, 7000), \n-(9400242, 4001343, 1, 1, 0, 7000), \n-(1210101, 4001342, 1, 1, 0, 7000), \n-(9300059, 4001342, 1, 1, 0, 7000), \n-(9400242, 4001342, 1, 1, 0, 7000), \n+(1210101, 4001343, 1, 1, 0, 70000), \n+(9300059, 4001343, 1, 1, 0, 70000), \n+(9400242, 4001343, 1, 1, 0, 70000), \n+(1210101, 4001342, 1, 1, 0, 70000), \n+(9300059, 4001342, 1, 1, 0, 70000), \n+(9400242, 4001342, 1, 1, 0, 70000), \n (1210101, 2000000, 1, 1, 0, 40000), \n (9300059, 2000000, 1, 1, 0, 40000), \n (9400242, 2000000, 1, 1, 0, 40000), \n@@ -566,9 +566,9 @@ USE `heavenms`;\n (9300059, 1072285, 1, 1, 0, 700), \n (9400242, 1072285, 1, 1, 0, 700), \n (1110101, 4030009, 1, 1, 0, 28000), \n-(1110101, 4001344, 1, 1, 0, 7000), \n-(1110101, 4001356, 1, 1, 0, 7000), \n-(1110101, 4001360, 1, 1, 0, 12000), \n+(1110101, 4001344, 1, 1, 0, 70000), \n+(1110101, 4001356, 1, 1, 0, 70000), \n+(1110101, 4001360, 1, 1, 0, 120000), \n (1110101, 2000000, 1, 1, 0, 40000), \n (1110101, 2040802, 1, 1, 0, 750), \n (1110101, 2380008, 1, 1, 0, 0), \n@@ -4654,7 +4654,7 @@ USE `heavenms`;\n (9300186, 1082195, 1, 1, 0, 40000), \n (9500339, 1082195, 1, 1, 0, 40000), \n (9303003, 1082195, 1, 1, 0, 700), \n-(3300008, 4001318, 1, 1, 0, 7000), \n+(3300008, 4001318, 1, 1, 0, 600000), \n (3300008, 2388070, 1, 4, 0, 20000), \n (3300008, 2000002, 1, 4, 0, 40000), \n (3300008, 2000003, 1, 4, 0, 40000), \n@@ -16180,8 +16180,8 @@ USE `heavenms`;\n (9420513, 1060106, 1, 1, 0, 40000), \n (9420513, 1072173, 1, 1, 0, 40000),\n (9420513, 1332026, 1, 1, 0, 40000), \n-(9400549, 4031903, 1, 1, 0, 7000), \n-(9400571, 4031903, 1, 1, 0, 7000), \n+(9400549, 4031903, 1, 1, 0, 100000), \n+(9400571, 4031903, 1, 1, 0, 100000), \n (9400549, 2020014, 1, 4, 0, 3000), \n (9400571, 2020014, 1, 4, 0, 3000),\n (9400549, 2002025, 1, 4, 0, 10000), \n@@ -20007,29 +20007,29 @@ USE `heavenms`;\n (9300154, 4031782, 1, 1, 0, 400000),\n (9300154, 4031783, 1, 1, 0, 400000),\n (9300154, 4031784, 1, 1, 0, 400000),\n-(1110100, 4032317, 1, 1, 21717, 20000),\n-(1110130, 4032317, 1, 1, 21717, 20000),\n-(1110100, 4032318, 1, 1, 21718, 20000),\n-(1110130, 4032318, 1, 1, 21718, 20000),\n+(1110100, 4032317, 1, 1, 21717, 40000),\n+(1110130, 4032317, 1, 1, 21717, 40000),\n+(1110100, 4032318, 1, 1, 21718, 40000),\n+(1110130, 4032318, 1, 1, 21718, 40000),\n (9400204, 4130020, 1, 1, 0, 3000),\n-(9400614, 4001341, 1, 1, 28172, 15000),\n-(9400615, 4001341, 1, 1, 28172, 15000),\n-(9400616, 4001341, 1, 1, 28172, 15000),\n-(1110101, 4001347, 1, 1, 28229, 80000),\n-(1110100, 4001348, 1, 1, 28231, 400000),\n-(1120100, 4001349, 1, 1, 28235, 100000),\n-(1210101, 4001350, 1, 1, 28235, 100000),\n-(2220100, 4001351, 1, 1, 28237, 100000),\n-(9400614, 4001352, 1, 1, 28205, 40000),\n-(9400615, 4001352, 1, 1, 28205, 40000),\n-(9400616, 4001352, 1, 1, 28205, 40000),\n-(9400617, 4001352, 1, 1, 28205, 40000),\n-(9400617, 4001362, 1, 1, 28252, 40000),\n-(9400655, 4001362, 1, 1, 28252, 40000),\n-(9400656, 4001362, 1, 1, 28252, 40000),\n-(9400617, 4001363, 1, 1, 28252, 40000),\n-(9400655, 4001363, 1, 1, 28252, 40000),\n-(9400656, 4001363, 1, 1, 28252, 40000),\n+(9400614, 4001341, 1, 1, 28172, 30000),\n+(9400615, 4001341, 1, 1, 28172, 30000),\n+(9400616, 4001341, 1, 1, 28172, 30000),\n+(1110101, 4001347, 1, 1, 28229, 160000),\n+(1110100, 4001348, 1, 1, 28231, 800000),\n+(1120100, 4001349, 1, 1, 28235, 200000),\n+(1210101, 4001350, 1, 1, 28235, 200000),\n+(2220100, 4001351, 1, 1, 28237, 200000),\n+(9400614, 4001352, 1, 1, 28205, 80000),\n+(9400615, 4001352, 1, 1, 28205, 80000),\n+(9400616, 4001352, 1, 1, 28205, 80000),\n+(9400617, 4001352, 1, 1, 28205, 80000),\n+(9400617, 4001362, 1, 1, 28252, 80000),\n+(9400655, 4001362, 1, 1, 28252, 80000),\n+(9400656, 4001362, 1, 1, 28252, 80000),\n+(9400617, 4001363, 1, 1, 28252, 80000),\n+(9400655, 4001363, 1, 1, 28252, 80000),\n+(9400656, 4001363, 1, 1, 28252, 80000),\n (9400609, 2000002, 1, 1, 0, 40000),\n (9400609, 2000003, 1, 1, 0, 40000),\n (9400609, 2000004, 1, 1, 0, 10000),\n@@ -20077,17 +20077,17 @@ USE `heavenms`;\n (9400613, 1082258, 1, 1, 0, 5000),\n (9400613, 1072421, 1, 1, 0, 5000),\n (4110302, 2383007, 1, 1, 0, 8000),\n-(130100, 4032374, 1, 1, 2405, 40000),\n-(1110101, 4032374, 1, 1, 2405, 40000),\n-(210100, 4032376, 1, 1, 2406, 40000),\n-(1110101, 4032376, 1, 1, 2406, 40000),\n-(210100, 4032377, 1, 1, 2407, 40000),\n-(1210101, 4032377, 1, 1, 2407, 40000),\n-(130100, 4032378, 1, 1, 2408, 40000),\n-(1120100, 4032378, 1, 1, 2408, 40000),\n-(1110100, 4032379, 1, 1, 2409, 40000),\n-(1210100, 4032379, 1, 1, 2409, 40000),\n-(2130100, 4001344, 1, 1, 0, 7000),\n+(130100, 4032374, 1, 1, 2405, 80000),\n+(1110101, 4032374, 1, 1, 2405, 80000),\n+(210100, 4032376, 1, 1, 2406, 80000),\n+(1110101, 4032376, 1, 1, 2406, 80000),\n+(210100, 4032377, 1, 1, 2407, 80000),\n+(1210101, 4032377, 1, 1, 2407, 80000),\n+(130100, 4032378, 1, 1, 2408, 80000),\n+(1120100, 4032378, 1, 1, 2408, 80000),\n+(1110100, 4032379, 1, 1, 2409, 80000),\n+(1210100, 4032379, 1, 1, 2409, 80000),\n+(2130100, 4001344, 1, 1, 0, 70000),\n (7220002, 4031789, 1, 1, 3844, 999999),\n (8830007, 1302112, 1, 1, 0, 4000),\n (8830007, 1302113, 1, 1, 0, 4000),"}, {"sha": "e1c999c74371d7f0865fa90f34fa2dcff960b3fe", "filename": "src/client/AbstractMapleCharacterObject.java", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/AbstractMapleCharacterObject.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/AbstractMapleCharacterObject.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/AbstractMapleCharacterObject.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -42,6 +42,7 @@\n     protected int hpMpApUsed, remainingAp;\n     protected int[] remainingSp = new int[10];\n     protected transient int clientmaxhp, clientmaxmp, localmaxhp = 50, localmaxmp = 5;\n+    protected float transienthp = Float.NEGATIVE_INFINITY, transientmp = Float.NEGATIVE_INFINITY;\n     \n     private AbstractCharacterListener listener = null;\n     protected Map<MapleStat, Integer> statUpdates = new HashMap<>();\n@@ -222,6 +223,8 @@ protected void setHp(int newHp) {\n         } else if (thp > localmaxhp) {\n             thp = localmaxhp;\n         }\n+        \n+        if (this.hp != thp) this.transienthp = Float.NEGATIVE_INFINITY;\n         this.hp = thp;\n         \n         dispatchHpChanged(oldHp);\n@@ -234,6 +237,8 @@ protected void setMp(int newMp) {\n         } else if (tmp > localmaxmp) {\n             tmp = localmaxmp;\n         }\n+        \n+        if (this.mp != tmp) this.transientmp = Float.NEGATIVE_INFINITY;\n         this.mp = tmp;\n     }\n     \n@@ -246,11 +251,13 @@ private void setRemainingSp(int remainingSp, int skillbook) {\n     }\n     \n     protected void setMaxHp(int hp_) {\n+        if (this.maxhp < hp_) this.transienthp = Float.NEGATIVE_INFINITY;\n         this.maxhp = hp_;\n         this.clientmaxhp = Math.min(30000, hp_);\n     }\n     \n     protected void setMaxMp(int mp_) {\n+        if (this.maxmp < mp_) this.transientmp = Float.NEGATIVE_INFINITY;\n         this.maxmp = mp_;\n         this.clientmaxmp = Math.min(30000, mp_);\n     }"}, {"sha": "83cf9af078f40f52c4d1e3463c220e2c73ba193b", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 206, "deletions": 54, "changes": 260, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -118,6 +118,7 @@\n import client.inventory.MapleWeaponType;\n import client.inventory.ModifyInventory;\n import client.inventory.PetDataFactory;\n+import client.inventory.manipulator.MapleCashidGenerator;\n import client.inventory.manipulator.MapleInventoryManipulator;\n import client.newyear.NewYearCardRecord;\n import constants.ExpTable;\n@@ -945,7 +946,7 @@ public void changeCI(int type) {\n     public void setMasteries(int jobId) {\n         int[] skills = new int[4];\n         for (int i = 0; i > skills.length; i++) {\n-        \tskills[i] = 0; //that initialization meng\n+            skills[i] = 0; //that initialization meng\n         }\n         if (jobId == 112) {\n             skills[0] = Hero.ACHILLES;\n@@ -1002,11 +1003,11 @@ public void setMasteries(int jobId) {\n             skills[1] = Aran.HIGH_MASTERY;\n             skills[2] = Aran.FREEZE_STANDING;\n         } else if (jobId == 2217) {\n-        \tskills[0] = Evan.MAPLE_WARRIOR;\n-        \tskills[1] = Evan.ILLUSION;\n+            skills[0] = Evan.MAPLE_WARRIOR;\n+            skills[1] = Evan.ILLUSION;\n         } else if (jobId == 2218) {\n-        \tskills[0] = Evan.BLESSING_OF_THE_ONYX;\n-        \tskills[1] = Evan.BLAZE;\n+            skills[0] = Evan.BLESSING_OF_THE_ONYX;\n+            skills[1] = Evan.BLAZE;\n         }\n         for (Integer skillId : skills) {\n             if (skillId != 0) {\n@@ -1341,12 +1342,11 @@ public void forceChangeMap(final MapleMap target, final MaplePortal pto) {\n     }\n     \n     private boolean buffMapProtection() {\n-        effLock.lock();\n-        chrLock.lock();\n-        \n         int thisMapid = mapid;\n         int returnMapid = client.getChannelServer().getMapFactory().getMap(thisMapid).getReturnMapId();\n         \n+        effLock.lock();\n+        chrLock.lock();\n         try {\n             for(Entry<MapleBuffStat, MapleBuffStatValueHolder> mbs : effects.entrySet()) {\n                 if(mbs.getKey() == MapleBuffStat.MAP_PROTECTION) {\n@@ -1884,7 +1884,7 @@ public boolean canHold(int itemid, int quantity) {\n             if(hold + quantity <= ii.getSlotMax(client, itemid))\n                 return true;\n         }\n-\n+        \n         return getInventory(ItemConstants.getInventoryType(itemid)).getNextFreeSlot() > -1;\n     }\n \n@@ -1903,7 +1903,7 @@ public void decreaseBattleshipHp(int decrease) {\n             Skill battleship = SkillFactory.getSkill(Corsair.BATTLE_SHIP);\n             int cooldown = battleship.getEffect(getSkillLevel(battleship)).getCooldown();\n             announce(MaplePacketCreator.skillCooldown(Corsair.BATTLE_SHIP, cooldown));\n-            addCooldown(Corsair.BATTLE_SHIP, System.currentTimeMillis(), (long)(cooldown * 1000));\n+            addCooldown(Corsair.BATTLE_SHIP, Server.getInstance().getCurrentTime(), (long)(cooldown * 1000));\n             removeCooldown(5221999);\n             cancelEffectFromBuffStat(MapleBuffStat.MONSTER_RIDING);\n         } else {\n@@ -2080,6 +2080,8 @@ public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n                                                                                     ps3.setInt(1, ringid);\n                                                                                     ps3.executeUpdate();\n                                                                             }\n+                                                                            \n+                                                                            MapleCashidGenerator.freeCashId(ringid);\n                                                                     }\n                                                             }\n                                                     }\n@@ -2090,11 +2092,13 @@ public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n                                                     ps2.executeUpdate();\n                                             }\n                                             \n-                                            if(rs.getInt(\"petid\") > -1) {\n+                                            int petid = rs.getInt(\"petid\");\n+                                            if(petid > -1) {\n                                                     try (PreparedStatement ps2 = con.prepareStatement(\"DELETE FROM pets WHERE petid = ?\")) {\n-                                                            ps2.setInt(1, rs.getInt(\"petid\"));\n+                                                            ps2.setInt(1, petid);\n                                                             ps2.executeUpdate();\n                                                     }\n+                                                    MapleCashidGenerator.freeCashId(petid);\n                                             }\n                                     }\n                             }\n@@ -2453,6 +2457,10 @@ public void giveDebuff(final MapleDisease disease, MobSkill skill) {\n                 chrLock.unlock();\n             }\n             \n+            if (disease == MapleDisease.SEDUCE && chair.get() != 0) {\n+                sitChair(0);\n+            }\n+            \n             final List<Pair<MapleDisease, Integer>> debuff = Collections.singletonList(new Pair<>(disease, Integer.valueOf(skill.getX())));\n             client.announce(MaplePacketCreator.giveDebuff(debuff, skill));\n             \n@@ -2550,7 +2558,7 @@ private void startHpDecreaseTask(long lastHpTask) {\n             public void run() {\n                 doHurtHp();\n             }\n-        }, 10000, 10000 - lastHpTask);\n+        }, ServerConstants.MAP_DAMAGE_OVERTIME_INTERVAL, ServerConstants.MAP_DAMAGE_OVERTIME_INTERVAL - lastHpTask);\n     }\n     \n     public void resetHpDecreaseTask() {\n@@ -2559,7 +2567,7 @@ public void resetHpDecreaseTask() {\n         }\n         \n         long lastHpTask = Server.getInstance().getCurrentTime() - lastHpDec;\n-        startHpDecreaseTask((lastHpTask > 10000) ? 10000 : lastHpTask);\n+        startHpDecreaseTask((lastHpTask > ServerConstants.MAP_DAMAGE_OVERTIME_INTERVAL) ? ServerConstants.MAP_DAMAGE_OVERTIME_INTERVAL : lastHpTask);\n     }\n     \n     public void dropMessage(String message) {\n@@ -2682,7 +2690,7 @@ public void run() {\n                         effLock.unlock();\n                     }\n                     \n-                    long curTime = System.currentTimeMillis();\n+                    long curTime = Server.getInstance().getCurrentTime();\n                     for(Entry<Integer, MapleCoolDownValueHolder> bel : es) {\n                         MapleCoolDownValueHolder mcdvh = bel.getValue();\n                         if(curTime >= mcdvh.startTime + mcdvh.length) {\n@@ -5247,8 +5255,9 @@ public void giveCoolDowns(final int skillid, long starttime, long length) {\n             this.battleshipHp = (int) length;\n             addCooldown(skillid, 0, length);\n         } else {\n-            int time = (int) ((length + starttime) - System.currentTimeMillis());\n-            addCooldown(skillid, System.currentTimeMillis(), time);\n+            long timeNow = Server.getInstance().getCurrentTime();\n+            int time = (int) ((length + starttime) - timeNow);\n+            addCooldown(skillid, timeNow, time);\n         }\n     }\n     \n@@ -5433,9 +5442,43 @@ private int getBuybackFee() {\n         int grade = Math.min(Math.max(level, 30), 120) - 30;\n         \n         fee += (grade * ServerConstants.BUYBACK_LEVEL_STACK_FEE);\n+        if (ServerConstants.USE_BUYBACK_WITH_MESOS) fee *= ServerConstants.BUYBACK_MESO_MULTIPLIER;\n+        \n         return (int) Math.floor(fee);\n     }\n     \n+    public void showBuybackInfo() {\n+        String s = \"#eBUYBACK STATUS#n\\r\\n\\r\\nCurrent buyback fee: #b\" + getBuybackFee() + \" \" + (ServerConstants.USE_BUYBACK_WITH_MESOS ? \"mesos\" : \"NX\") + \"#k\\r\\n\\r\\n\";\n+        \n+        long timeNow = Server.getInstance().getCurrentTime();\n+        boolean avail = true;\n+        if (!isAlive()) {\n+            long timeLapsed = timeNow - lastDeathtime;\n+            long timeRemaining = ServerConstants.BUYBACK_RETURN_MINUTES * 60 * 1000 - (timeLapsed + Math.max(0, getNextBuybackTime() - timeNow));\n+            if (timeRemaining < 1) {\n+                s += \"Buyback #e#rUNAVAILABLE#k#n\";\n+                avail = false;\n+            } else {\n+                s += \"Buyback countdown: #e#b\" + getTimeRemaining(ServerConstants.BUYBACK_RETURN_MINUTES * 60 * 1000 - timeLapsed) + \"#k#n\";\n+            }\n+            s += \"\\r\\n\";\n+        }\n+        \n+        if (timeNow < getNextBuybackTime() && avail) {\n+            s += \"Buyback available in #r\" + getTimeRemaining(getNextBuybackTime() - timeNow) + \"#k\";\n+            s += \"\\r\\n\";\n+        }\n+        \n+        this.showHint(s);\n+    }\n+    \n+    private static String getTimeRemaining(long timeLeft) {\n+        int seconds = (int) Math.floor(timeLeft / 1000) % 60;\n+        int minutes = (int) Math.floor(timeLeft / (1000*60)) % 60;\n+        \n+        return (minutes > 0 ? (String.format(\"%02d\", minutes) + \" minutes, \") : \"\") + String.format(\"%02d\", seconds) + \" seconds\";\n+    }\n+    \n     public boolean couldBuyback() {  // Ronan's buyback system\n         long timeNow = Server.getInstance().getCurrentTime();\n         \n@@ -5447,16 +5490,12 @@ public boolean couldBuyback() {  // Ronan's buyback system\n         long nextBuybacktime = getNextBuybackTime();\n         if (timeNow < nextBuybacktime) {\n             long timeLeft = nextBuybacktime - timeNow;\n-            int seconds = (int) Math.floor(timeLeft / 1000) % 60;\n-            int minutes = (int) Math.floor(timeLeft / (1000*60)) % 60;\n-            \n-            this.dropMessage(5, \"Next buyback available in \" + (minutes > 0 ? (String.format(\"%02d\", minutes) + \" minutes, \") : \"\") + String.format(\"%02d\", seconds) + \" seconds.\");\n+            this.dropMessage(5, \"Next buyback available in \" + getTimeRemaining(timeLeft) + \".\");\n             return false;\n         }\n         \n         boolean usingMesos = ServerConstants.USE_BUYBACK_WITH_MESOS;\n         int fee = getBuybackFee();\n-        if (usingMesos) fee *= ServerConstants.BUYBACK_MESO_MULTIPLIER;\n         \n         if (!canBuyback(fee, usingMesos)) {\n             this.dropMessage(5, \"You don't have \" + fee + \" \" + (usingMesos ? \"mesos\" : \"NX\") + \" to buyback.\");\n@@ -5528,7 +5567,7 @@ public boolean isGuildLeader() {    // true on guild master or jr. master\n     public void leaveMap() {\n         controlled.clear();\n         visibleMapObjects.clear();\n-        chair.set(0);\n+        setChair(0);\n         if (hpDecreaseTask != null) {\n             hpDecreaseTask.cancel(false);\n         }\n@@ -5710,7 +5749,7 @@ public void run() {\n         if (ServerConstants.USE_PERFECT_PITCH && level >= 30) {\n             //milestones?\n             if (MapleInventoryManipulator.checkSpace(client, 4310000, (short) 1, \"\")) {\n-                MapleInventoryManipulator.addById(client, 4310000, (short) 1);\n+                MapleInventoryManipulator.addById(client, 4310000, (short) 1, \"\", -1);\n             }\n         } else if (level == 10) {\n             Runnable r = new Runnable() {\n@@ -6452,7 +6491,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                 ps = con.prepareStatement(\"SELECT SkillID,StartTime,length FROM cooldowns WHERE charid = ?\");\n                 ps.setInt(1, ret.getId());\n                 rs = ps.executeQuery();\n-                long curTime = System.currentTimeMillis();\n+                long curTime = Server.getInstance().getCurrentTime();\n                 while (rs.next()) {\n                     final int skillid = rs.getInt(\"SkillID\");\n                     final long length = rs.getLong(\"length\"), startTime = rs.getLong(\"StartTime\");\n@@ -6534,7 +6573,7 @@ public static MapleCharacter loadCharFromDB(int charid, MapleClient client, bool\n                 ret.storage = MapleStorage.loadOrCreateFromDB(ret.accountid, ret.world);\n                 \n                 int startHp = ret.hp, startMp = ret.mp;\n-                ret.recalcLocalStats();\n+                ret.reapplyLocalStats();\n                 ret.changeHpMp(startHp, startMp, true);\n                 //ret.resetBattleshipHp();\n             }\n@@ -6651,7 +6690,7 @@ public void mount(int id, int skillid) {\n     private void playerDead() {\n         cancelAllBuffs(false);\n         dispelDebuffs();\n-        lastDeathtime = System.currentTimeMillis();\n+        lastDeathtime = Server.getInstance().getCurrentTime();\n         \n         EventInstanceManager eim = getEventInstance();\n         if (eim != null) {\n@@ -6702,12 +6741,51 @@ private void playerDead() {\n             cancelEffectFromBuffStat(MapleBuffStat.MONSTER_RIDING);\n         }\n \n-        if (getChair() != 0) {\n+        unsitChairInternal();\n+        client.announce(MaplePacketCreator.enableActions());\n+    }\n+    \n+    private void unsitChairInternal() {\n+        if (chair.get() != 0) {\n             setChair(0);\n-            client.announce(MaplePacketCreator.cancelChair(-1));\n-            getMap().broadcastMessage(this, MaplePacketCreator.showChair(getId(), 0), false);\n+            if (unregisterChairBuff()) {\n+                getMap().broadcastMessage(this, MaplePacketCreator.cancelForeignChairSkillEffect(this.getId()), false);\n+            }\n+\n+            getMap().broadcastMessage(this, MaplePacketCreator.showChair(this.getId(), 0), false);\n         }\n-        client.announce(MaplePacketCreator.enableActions());\n+\n+        announce(MaplePacketCreator.cancelChair(-1));\n+    }\n+    \n+    public void sitChair(int itemId) {\n+        if (client.tryacquireClient()) {\n+            try {\n+                if (itemId >= 1000000) {    // sit on item chair\n+                    if (chair.get() == 0) {\n+                        setChair(itemId);\n+                        getMap().broadcastMessage(this, MaplePacketCreator.showChair(this.getId(), itemId), false);\n+                    }\n+                    announce(MaplePacketCreator.enableActions());\n+                } else if (itemId != 0) {    // sit on map chair\n+                    if (chair.get() == 0) {\n+                        setChair(itemId);\n+                        if (registerChairBuff()) {\n+                            getMap().broadcastMessage(this, MaplePacketCreator.giveForeignChairSkillEffect(this.getId()), false);\n+                        }\n+                        announce(MaplePacketCreator.cancelChair(itemId));\n+                    }\n+                } else {    // stand up\n+                    unsitChairInternal();\n+                }\n+            } finally {\n+                client.releaseClient();\n+            }\n+        }\n+    }\n+    \n+    private void setChair(int chair) {\n+        this.chair.set(chair);\n     }\n     \n     public void respawn(int returnMap) {\n@@ -6780,15 +6858,11 @@ private void recalcEquipStats() {\n         localwatk += equipwatk;\n     }\n     \n-    private List<Pair<MapleStat, Integer>> recalcLocalStats() {\n+    private void reapplyLocalStats() {\n         effLock.lock();\n+        chrLock.lock();\n         statWlock.lock();\n         try {\n-            List<Pair<MapleStat, Integer>> hpmpupdate = new ArrayList<>(2);\n-            \n-            int oldlocalmaxhp = localmaxhp;\n-            int oldlocalmaxmp = localmaxmp;\n-\n             localmaxhp = getMaxHp();\n             localmaxmp = getMaxMp();\n             localdex = getDex();\n@@ -6815,11 +6889,6 @@ private void recalcEquipStats() {\n             localmaxhp = Math.min(30000, localmaxhp);\n             localmaxmp = Math.min(30000, localmaxmp);\n \n-            if (ServerConstants.USE_FIXED_RATIO_HPMP_UPDATE) {\n-                if (localmaxhp != oldlocalmaxhp) hpmpupdate.add(calcHpRatioUpdate(localmaxhp, oldlocalmaxhp));\n-                if (localmaxmp != oldlocalmaxmp) hpmpupdate.add(calcMpRatioUpdate(localmaxmp, oldlocalmaxmp));\n-            }\n-\n             MapleStatEffect combo = getBuffEffect(MapleBuffStat.ARAN_COMBO);\n             if (combo != null) {\n                 localwatk += combo.getX();\n@@ -6906,10 +6975,54 @@ private void recalcEquipStats() {\n                 }\n                 // Add throwing stars to dmg.\n             }\n+        } finally {\n+            statWlock.unlock();\n+            chrLock.unlock();\n+            effLock.unlock();\n+        }\n+    }\n+    \n+    private List<Pair<MapleStat, Integer>> recalcLocalStats() {\n+        effLock.lock();\n+        chrLock.lock();\n+        statWlock.lock();\n+        try {\n+            List<Pair<MapleStat, Integer>> hpmpupdate = new ArrayList<>(2);\n+            int oldlocalmaxhp = localmaxhp;\n+            int oldlocalmaxmp = localmaxmp;\n+            \n+            reapplyLocalStats();\n+            \n+            if (ServerConstants.USE_FIXED_RATIO_HPMP_UPDATE) {\n+                if (localmaxhp != oldlocalmaxhp) {\n+                    Pair<MapleStat, Integer> hpUpdate;\n+\n+                    if (transienthp == Float.NEGATIVE_INFINITY) {\n+                        hpUpdate = calcHpRatioUpdate(localmaxhp, oldlocalmaxhp);\n+                    } else {\n+                        hpUpdate = calcHpRatioTransient();\n+                    }\n+\n+                    hpmpupdate.add(hpUpdate);\n+                }\n+\n+                if (localmaxmp != oldlocalmaxmp) {\n+                    Pair<MapleStat, Integer> mpUpdate;\n+\n+                    if (transientmp == Float.NEGATIVE_INFINITY) {\n+                        mpUpdate = calcMpRatioUpdate(localmaxmp, oldlocalmaxmp);\n+                    } else {\n+                        mpUpdate = calcMpRatioTransient();\n+                    }\n+\n+                    hpmpupdate.add(mpUpdate);\n+                }\n+            }\n \n             return hpmpupdate;\n         } finally {\n             statWlock.unlock();\n+            chrLock.unlock();\n             effLock.unlock();\n         }\n     }\n@@ -7789,10 +7902,6 @@ public void setBuffedValue(MapleBuffStat effect, int value) {\n         }\n     }\n \n-    public void setChair(int chair) {\n-        this.chair.set(chair);\n-    }\n-\n     public void setChalkboard(String text) {\n         this.chalktext = text;\n     }\n@@ -7968,27 +8077,55 @@ private void hpChangeAction(int oldHp) {\n     \n     private Pair<MapleStat, Integer> calcHpRatioUpdate(int newHp, int oldHp) {\n         int delta = newHp - oldHp;\n-        this.hp = calcHpMpRatioUpdate(hp, oldHp, delta);\n+        this.hp = calcHpRatioUpdate(hp, oldHp, delta);\n         \n         hpChangeAction(Short.MIN_VALUE);\n         return new Pair<>(MapleStat.HP, hp);\n     }\n     \n     private Pair<MapleStat, Integer> calcMpRatioUpdate(int newMp, int oldMp) {\n         int delta = newMp - oldMp;\n-        this.mp = calcHpMpRatioUpdate(mp, oldMp, delta);\n+        this.mp = calcMpRatioUpdate(mp, oldMp, delta);\n         return new Pair<>(MapleStat.MP, mp);\n     }\n     \n-    private static int calcHpMpRatioUpdate(int curpoint, int maxpoint, int diffpoint) {\n+    private static int calcTransientRatio(float transientpoint) {\n+        int ret = (int) transientpoint;\n+        return !(ret <= 0 && transientpoint > 0.0f) ? ret : 1;\n+    }\n+    \n+    private Pair<MapleStat, Integer> calcHpRatioTransient() {\n+        this.hp = calcTransientRatio(transienthp * localmaxhp);\n+        \n+        hpChangeAction(Short.MIN_VALUE);\n+        return new Pair<>(MapleStat.HP, hp);\n+    }\n+    \n+    private Pair<MapleStat, Integer> calcMpRatioTransient() {\n+        this.mp = calcTransientRatio(transientmp * localmaxmp);\n+        return new Pair<>(MapleStat.MP, mp);\n+    }\n+    \n+    private int calcHpRatioUpdate(int curpoint, int maxpoint, int diffpoint) {\n         int curMax = maxpoint;\n         int nextMax = Math.min(30000, maxpoint + diffpoint);\n         \n         float temp = curpoint * nextMax;\n-        int ret = (int) Math.round(temp / curMax);\n+        int ret = (int) Math.ceil(temp / curMax);\n         \n-        //System.out.println(\"cur: \" + curpoint + \" next: \" + ret + \" max: \" + curMax + \" nextmax:\" + nextMax + \" diff: \" + diffpoint);\n-        return !(ret <= 0 && curpoint > 0) ? ret : 1;\n+        transienthp = (maxpoint > nextMax) ? ((float) curpoint) / maxpoint : ((float) ret) / nextMax;\n+        return ret;\n+    }\n+    \n+    private int calcMpRatioUpdate(int curpoint, int maxpoint, int diffpoint) {\n+        int curMax = maxpoint;\n+        int nextMax = Math.min(30000, maxpoint + diffpoint);\n+        \n+        float temp = curpoint * nextMax;\n+        int ret = (int) Math.ceil(temp / curMax);\n+        \n+        transientmp = (maxpoint > nextMax) ? ((float) curpoint) / maxpoint : ((float) ret) / nextMax;\n+        return ret;\n     }\n     \n     public boolean applyHpMpChange(int hpCon, int hpchange, int mpchange) {\n@@ -8137,7 +8274,6 @@ public void setParty(MapleParty p) {\n                 doorSlot = -1;\n \n                 party = null;\n-                //cancelMagicDoor();  // cancel magic doors if kicked out / quitted from party.\n             } else {\n                 party = p;\n             }\n@@ -9082,11 +9218,27 @@ private void unequipPendantOfSpirit() {\n         }\n         pendantExp = 0;\n     }\n+    \n+    private Collection<Item> getUpgradeableEquipList() {\n+        Collection<Item> fullList = getInventory(MapleInventoryType.EQUIPPED).list();\n+        if (ServerConstants.USE_EQUIPMNT_LVLUP_CASH) {\n+            return fullList;\n+        }\n+        \n+        Collection<Item> eqpList = new LinkedHashSet<>();\n+        for (Item it : fullList) {\n+            if (!ii.isCash(it.getItemId())) {\n+                eqpList.add(it);\n+            }\n+        }\n \n+        return eqpList;\n+    }\n+    \n     public void increaseEquipExp(int expGain) {\n         if(expGain < 0) expGain = Integer.MAX_VALUE;\n         \n-        for (Item item : getInventory(MapleInventoryType.EQUIPPED).list()) {\n+        for (Item item : getUpgradeableEquipList()) {\n             Equip nEquip = (Equip) item;\n             String itemName = ii.getName(nEquip.getItemId());\n             if (itemName == null) {"}, {"sha": "4e1ce4aae8cc3c707977e8399bbd3e87baf79be3", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 38, "deletions": 7, "changes": 45, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -41,6 +41,7 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n+import java.util.concurrent.Semaphore;\n import java.util.concurrent.locks.Lock;\n \n import tools.*;\n@@ -109,8 +110,10 @@\n \tprivate String pic = null;\n \tprivate String hwid = null;\n \tprivate int picattempt = 0;\n+        private byte csattempt = 0;\n \tprivate byte gender = -1;\n \tprivate boolean disconnecting = false;\n+        private final Semaphore actionsSemaphore = new Semaphore(7);\n \tprivate final Lock lock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.CLIENT, true);\n         private final Lock encoderLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.CLIENT_ENCODER, true);\n         private static final Lock loginLock = MonitoredReentrantLockFactory.createLock(MonitoredLockType.CLIENT_LOGIN, true);\n@@ -532,7 +535,6 @@ public int login(String login, String pwd, String nibbleHwid) {\n \t\t\t\tgender = rs.getByte(\"gender\");\n \t\t\t\tcharacterSlots = rs.getByte(\"characterslots\");\n \t\t\t\tString passhash = rs.getString(\"password\");\n-\t\t\t\tString salt = rs.getString(\"salt\");\n \t\t\t\tbyte tos = rs.getByte(\"tos\");\n \n \t\t\t\tps.close();\n@@ -547,8 +549,9 @@ public int login(String login, String pwd, String nibbleHwid) {\n \t\t\t\t\tloginok = 7;\n \t\t\t\t} else if (passhash.charAt(0) == '$' && passhash.charAt(1) == '2' && BCrypt.checkpw(pwd, passhash)) {\n \t\t\t\t\tloginok = (tos == 0) ? 23 : 0;\n-\t\t\t\t} else if (pwd.equals(passhash) || checkHash(passhash, \"SHA-1\", pwd) || checkHash(passhash, \"SHA-512\", pwd + salt)) {\n-\t\t\t\t\tloginok = (tos == 0) ? -23 : -10; // migrate to bcrypt\n+\t\t\t\t} else if (pwd.equals(passhash) || checkHash(passhash, \"SHA-1\", pwd) || checkHash(passhash, \"SHA-512\", pwd)) {\n+                                        // thanks GabrielSin for detecting some no-bcrypt inconsistencies here\n+\t\t\t\t\tloginok = (tos == 0) ? (!ServerConstants.BCRYPT_MIGRATION ? 23 : -23) : (!ServerConstants.BCRYPT_MIGRATION ? 0 : -10); // migrate to bcrypt\n \t\t\t\t} else {\n \t\t\t\t\tloggedIn = false;\n \t\t\t\t\tloginok = 4;\n@@ -775,7 +778,7 @@ public int getLoginState() {  // 0 = LOGIN_NOTLOGGEDIN, 1= LOGIN_SERVER_TRANSITI\n \t\t\tif (!rs.next()) {\n \t\t\t\trs.close();\n \t\t\t\tps.close();\n-\t\t\t\tthrow new RuntimeException(\"getLoginState - MapleClient\");\n+\t\t\t\tthrow new RuntimeException(\"getLoginState - MapleClient AccID: \" + getAccID());\n \t\t\t}\n                         \n \t\t\tbirthday = Calendar.getInstance();\n@@ -1170,10 +1173,20 @@ public void unlockClient() {\n                 lock.unlock();\n \t}\n         \n-        public boolean trylockClient() {\n-                return lock.tryLock();\n+        public boolean tryacquireClient() {\n+                if (actionsSemaphore.tryAcquire()) {\n+                        lockClient();\n+                        return true;\n+                } else {\n+                        return false;\n+                }\n \t}\n         \n+        public void releaseClient() {\n+                unlockClient();\n+                actionsSemaphore.release();\n+        }\n+        \n         public void lockEncoder() {\n                 encoderLock.lock();\n \t}\n@@ -1198,7 +1211,7 @@ private static boolean checkHash(String hash, String type, String password) {\n \t\ttry {\n \t\t\tMessageDigest digester = MessageDigest.getInstance(type);\n \t\t\tdigester.update(password.getBytes(\"UTF-8\"), 0, password.length());\n-\t\t\treturn HexTool.toString(digester.digest()).replace(\" \", \"\").toLowerCase().equals(hash);\n+                        return HexTool.toString(digester.digest()).replace(\" \", \"\").toLowerCase().equals(hash);\n \t\t} catch (NoSuchAlgorithmException | UnsupportedEncodingException e) {\n \t\t\tthrow new RuntimeException(\"Encoding the string failed\", e);\n \t\t}\n@@ -1431,4 +1444,22 @@ public void closePlayerScriptInteractions() {\n                 this.removeClickedNPC();\n                 NPCScriptManager.getInstance().dispose(this);\n         }\n+        \n+        public boolean attemptCsCoupon() {\n+                if (csattempt > 2) {\n+                        resetCsCoupon();\n+                        return false;\n+                }\n+                \n+                csattempt++;\n+                return true;\n+        }\n+        \n+        public void resetCsCoupon() {\n+                csattempt = 0;\n+        }\n+        \n+        public void enableCSActions() {\n+                announce(MaplePacketCreator.enableCSUse(player));\n+        }\n }"}, {"sha": "53111f3fb71e164a8f1289a9a58d674f91273167", "filename": "src/client/MapleRing.java", "status": "modified", "additions": 25, "deletions": 27, "changes": 52, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleRing.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/MapleRing.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleRing.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -25,8 +25,9 @@\n import java.sql.PreparedStatement;\n import java.sql.ResultSet;\n import java.sql.SQLException;\n-import java.sql.Statement;\n+import tools.Pair;\n import tools.DatabaseConnection;\n+import client.inventory.manipulator.MapleCashidGenerator;\n \n /**\n  *\n@@ -86,6 +87,9 @@ public static void removeRing(final MapleRing ring) {\n             ps.executeBatch();\n             ps.close();\n             \n+            MapleCashidGenerator.freeCashId(ring.getRingId());\n+            MapleCashidGenerator.freeCashId(ring.getPartnerRingId());\n+            \n             ps = con.prepareStatement(\"UPDATE inventoryequipment SET ringid=-1 WHERE ringid=?\");\n             ps.setInt(1, ring.getRingId());\n             ps.addBatch();\n@@ -102,46 +106,40 @@ public static void removeRing(final MapleRing ring) {\n         }\n     }\n     \n-    public static int createRing(int itemid, final MapleCharacter partner1, final MapleCharacter partner2) {\n+    public static Pair<Integer, Integer> createRing(int itemid, final MapleCharacter partner1, final MapleCharacter partner2) {\n         try {\n             if (partner1 == null) {\n-                return -2;\n+                return new Pair<>(-3, -3);\n             } else if (partner2 == null) {\n-                return -1;\n+                return new Pair<>(-2, -2);\n             }\n+            \n             int[] ringID = new int[2];\n+            ringID[0] = MapleCashidGenerator.generateCashId();\n+            ringID[1] = MapleCashidGenerator.generateCashId();\n+            \n             Connection con = DatabaseConnection.getConnection();\n-            PreparedStatement ps = con.prepareStatement(\"INSERT INTO rings (itemid, partnerChrId, partnername) VALUES (?, ?, ?)\", Statement.RETURN_GENERATED_KEYS);\n-            ps.setInt(1, itemid);\n-            ps.setInt(2, partner2.getId());\n-            ps.setString(3, partner2.getName());\n-            ps.executeUpdate();\n-            ResultSet rs = ps.getGeneratedKeys();\n-            rs.next();\n-            ringID[0] = rs.getInt(1); // ID.\n-            rs.close();\n-            ps.close();\n-            ps = con.prepareStatement(\"INSERT INTO rings (itemid, partnerRingId, partnerChrId, partnername) VALUES (?, ?, ?, ?)\", Statement.RETURN_GENERATED_KEYS);\n-            ps.setInt(1, itemid);\n-            ps.setInt(2, ringID[0]);\n-            ps.setInt(3, partner1.getId());\n-            ps.setString(4, partner1.getName());\n+            PreparedStatement ps = con.prepareStatement(\"INSERT INTO rings (id, itemid, partnerRingId, partnerChrId, partnername) VALUES (?, ?, ?, ?, ?)\");\n+            ps.setInt(1, ringID[0]);\n+            ps.setInt(2, itemid);\n+            ps.setInt(3, ringID[1]);\n+            ps.setInt(4, partner2.getId());\n+            ps.setString(5, partner2.getName());\n             ps.executeUpdate();\n-            rs = ps.getGeneratedKeys();\n-            rs.next();\n-            ringID[1] = rs.getInt(1);\n-            rs.close();\n             ps.close();\n-            ps = con.prepareStatement(\"UPDATE rings SET partnerRingId = ? WHERE id = ?\");\n+            ps = con.prepareStatement(\"INSERT INTO rings (id, itemid, partnerRingId, partnerChrId, partnername) VALUES (?, ?, ?, ?, ?)\");\n             ps.setInt(1, ringID[1]);\n-            ps.setInt(2, ringID[0]);\n+            ps.setInt(2, itemid);\n+            ps.setInt(3, ringID[0]);\n+            ps.setInt(4, partner1.getId());\n+            ps.setString(5, partner1.getName());\n             ps.executeUpdate();\n             ps.close();\n             con.close();\n-            return ringID[0];\n+            return new Pair<>(ringID[0], ringID[1]);\n         } catch (SQLException ex) {\n             ex.printStackTrace();\n-            return -1;\n+            return new Pair<>(-1, -1);\n         }\n     }\n "}, {"sha": "ac27915192c372f40e73d4e38a5c7b965ff03178", "filename": "src/client/autoban/AutobanManager.java", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/autoban/AutobanManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/autoban/AutobanManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/autoban/AutobanManager.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -8,6 +8,7 @@\n import client.MapleCharacter;\n import java.util.HashMap;\n import java.util.Map;\n+import net.server.Server;\n import tools.FilePrinter;\n \n /**\n@@ -35,12 +36,12 @@ public void addPoint(AutobanFactory fac, String reason) {\n     \t\treturn;\n     \t}\n         if (lastTime.containsKey(fac)) {\n-            if (lastTime.get(fac) < (System.currentTimeMillis() - fac.getExpire())) {\n+            if (lastTime.get(fac) < (Server.getInstance().getCurrentTime() - fac.getExpire())) {\n                 points.put(fac, points.get(fac) / 2); //So the points are not completely gone.\n             }\n         }\n         if (fac.getExpire() != -1)\n-            lastTime.put(fac, System.currentTimeMillis());\n+            lastTime.put(fac, Server.getInstance().getCurrentTime());\n         \n         if (points.containsKey(fac)) {\n             points.put(fac, points.get(fac) + 1);\n@@ -76,7 +77,7 @@ else if (samemisscount > 0)\n     \n     //Don't use the same type for more than 1 thing\n     public void spam(int type) {\n-        this.spam[type] = System.currentTimeMillis();\n+        this.spam[type] = Server.getInstance().getCurrentTime();\n     }\n     \n     public void spam(int type, int timestamp) {"}, {"sha": "da78955c1e80c362bde1341463e1bba5012e98ef", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -162,6 +162,7 @@ private void registerLv0Commands(){\n         addCommand(\"droplimit\", DropLimitCommand.class);\n         addCommand(\"time\", TimeCommand.class);\n         addCommand(\"credits\", StaffCommand.class);\n+        addCommand(\"buyback\", BuyBackCommand.class);\n         addCommand(\"uptime\", UptimeCommand.class);\n         addCommand(\"gacha\", GachaCommand.class);\n         addCommand(\"dispose\", DisposeCommand.class);\n@@ -345,6 +346,7 @@ private void registerLv6Commands(){\n         addCommand(\"shutdown\", 6, ShutdownCommand.class);\n         addCommand(\"clearquestcache\", 6, ClearQuestCacheCommand.class);\n         addCommand(\"clearquest\", 6, ClearQuestCommand.class);\n+        addCommand(\"supplyratecoupon\", 6, SupplyRateCouponCommand.class);\n         addCommand(\"spawnallpnpcs\", 6, SpawnAllPNpcsCommand.class);\n         addCommand(\"eraseallpnpcs\", 6, EraseAllPNpcsCommand.class);\n         addCommand(\"addchannel\", 6, ServerAddChannelCommand.class);"}, {"sha": "8c6c9784b7e5a736909a9e24d983ba8a765b9656", "filename": "src/client/command/commands/gm0/BuyBackCommand.java", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/BuyBackCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/BuyBackCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/BuyBackCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -30,6 +30,15 @@\n public class BuyBackCommand extends Command {\n     @Override\n     public void execute(MapleClient c, String[] params) {\n-        BuybackProcessor.processBuyback(c);\n+        if (params.length < 1) {\n+            c.getPlayer().yellowMessage(\"Syntax: @buyback <info|now>\");\n+            return;\n+        }\n+        \n+        if (params[0].contentEquals(\"now\")) {\n+            BuybackProcessor.processBuyback(c);\n+        } else {\n+            c.getPlayer().showBuybackInfo();\n+        }\n     }\n }"}, {"sha": "76b974f9e64a0d095f398fc67605ae6d0fb72504", "filename": "src/client/command/commands/gm0/StatDexCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatDexCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatDexCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatDexCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@ public void execute(MapleClient c, String[] params) {\n         int remainingAp = player.getRemainingAp();\n \n         int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getDex());\n-        if (!player.assignDex(amount)) {\n+        if (!player.assignDex(Math.max(amount, 0))) {\n             player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n         }\n     }"}, {"sha": "02ab5b6f7882ee3ea53a475436ef0d62fff7d3f2", "filename": "src/client/command/commands/gm0/StatIntCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatIntCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatIntCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatIntCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@ public void execute(MapleClient c, String[] params) {\n         int remainingAp = player.getRemainingAp();\n \n         int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getInt());\n-        if (!player.assignInt(amount)) {\n+        if (!player.assignInt(Math.max(amount, 0))) {\n             player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n         }\n     }"}, {"sha": "f2a97c8bba26e6b915a13ffbcecdca2a4d2c2746", "filename": "src/client/command/commands/gm0/StatLukCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatLukCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatLukCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatLukCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@ public void execute(MapleClient c, String[] params) {\n         int remainingAp = player.getRemainingAp();\n \n         int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getLuk());\n-        if (!player.assignLuk(amount)) {\n+        if (!player.assignLuk(Math.max(amount, 0))) {\n             player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n         }\n     }"}, {"sha": "46bac383a875ccc11aff004d22c9ecf4673f8629", "filename": "src/client/command/commands/gm0/StatStrCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatStrCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm0/StatStrCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/StatStrCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@ public void execute(MapleClient c, String[] params) {\n         int remainingAp = player.getRemainingAp();\n         int amount = (params.length > 0) ? Math.min(Integer.parseInt(params[0]), remainingAp) : Math.min(remainingAp, ServerConstants.MAX_AP - player.getStr());\n         \n-        if (!player.assignStr(amount)) {\n+        if (!player.assignStr(Math.max(amount, 0))) {\n             player.dropMessage(\"Please make sure your AP is not over \" + ServerConstants.MAX_AP + \" and you have enough to distribute.\");\n         }\n     }"}, {"sha": "9d4a428007de3282b769b497239fbd1e25b7806d", "filename": "src/client/command/commands/gm1/WhoDropsCommand.java", "status": "modified", "additions": 37, "deletions": 28, "changes": 65, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm1/WhoDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm1/WhoDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhoDropsCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -49,40 +49,49 @@ public void execute(MapleClient c, String[] params) {\n             player.dropMessage(5, \"Please do @whodrops <item name>\");\n             return;\n         }\n-        String searchString = joinStringFrom(params, 0);\n-        String output = \"\";\n-        Iterator<Pair<Integer, String>> listIterator = MapleItemInformationProvider.getInstance().getItemDataByName(searchString).iterator();\n-        if(listIterator.hasNext()) {\n-            int count = 1;\n-            while(listIterator.hasNext() && count <= 3) {\n-                Pair<Integer, String> data = listIterator.next();\n-                output += \"#b\" + data.getRight() + \"#k is dropped by:\\r\\n\";\n-                try {\n-                    Connection con = DatabaseConnection.getConnection();\n-                    PreparedStatement ps = con.prepareStatement(\"SELECT dropperid FROM drop_data WHERE itemid = ? LIMIT 50\");\n-                    ps.setInt(1, data.getLeft());\n-                    ResultSet rs = ps.executeQuery();\n-                    while(rs.next()) {\n-                        String resultName = MapleMonsterInformationProvider.getMobNameFromID(rs.getInt(\"dropperid\"));\n-                        if (resultName != null) {\n-                            output += resultName + \", \";\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                String searchString = joinStringFrom(params, 0);\n+                String output = \"\";\n+                Iterator<Pair<Integer, String>> listIterator = MapleItemInformationProvider.getInstance().getItemDataByName(searchString).iterator();\n+                if(listIterator.hasNext()) {\n+                    int count = 1;\n+                    while(listIterator.hasNext() && count <= 3) {\n+                        Pair<Integer, String> data = listIterator.next();\n+                        output += \"#b\" + data.getRight() + \"#k is dropped by:\\r\\n\";\n+                        try {\n+                            Connection con = DatabaseConnection.getConnection();\n+                            PreparedStatement ps = con.prepareStatement(\"SELECT dropperid FROM drop_data WHERE itemid = ? LIMIT 50\");\n+                            ps.setInt(1, data.getLeft());\n+                            ResultSet rs = ps.executeQuery();\n+                            while(rs.next()) {\n+                                String resultName = MapleMonsterInformationProvider.getMobNameFromID(rs.getInt(\"dropperid\"));\n+                                if (resultName != null) {\n+                                    output += resultName + \", \";\n+                                }\n+                            }\n+                            rs.close();\n+                            ps.close();\n+                            con.close();\n+                        } catch (Exception e) {\n+                            player.dropMessage(6, \"There was a problem retrieving the required data. Please try again.\");\n+                            e.printStackTrace();\n+                            return;\n                         }\n+                        output += \"\\r\\n\\r\\n\";\n+                        count++;\n                     }\n-                    rs.close();\n-                    ps.close();\n-                    con.close();\n-                } catch (Exception e) {\n-                    player.dropMessage(6, \"There was a problem retrieving the required data. Please try again.\");\n-                    e.printStackTrace();\n+                } else {\n+                    player.dropMessage(5, \"The item you searched for doesn't exist.\");\n                     return;\n                 }\n-                output += \"\\r\\n\\r\\n\";\n-                count++;\n+                c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, output, \"00 00\", (byte) 0));\n+            } finally {\n+                c.releaseClient();\n             }\n         } else {\n-            player.dropMessage(5, \"The item you searched for doesn't exist.\");\n-            return;\n+            player.dropMessage(5, \"Please wait a while for your request to be processed.\");\n         }\n-        c.announce(MaplePacketCreator.getNPCTalk(9010000, (byte) 0, output, \"00 00\", (byte) 0));\n     }\n }"}, {"sha": "892a0cda7bcb6e085bcc63e61fb6f4cc5831817e", "filename": "src/client/command/commands/gm2/ItemDropCommand.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm2/ItemDropCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm2/ItemDropCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/ItemDropCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -92,7 +92,6 @@ public void execute(MapleClient c, String[] params) {\n                 return;        \n             }\n         }\n-\n         \n         Item toDrop;\n         if (ItemConstants.getInventoryType(itemId) == MapleInventoryType.EQUIP) {"}, {"sha": "6873c8b4ae83fa55222c991d1c8d313b6e972b8b", "filename": "src/client/command/commands/gm2/SearchCommand.java", "status": "modified", "additions": 40, "deletions": 12, "changes": 52, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm2/SearchCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm2/SearchCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm2/SearchCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -37,8 +37,19 @@\n import java.io.File;\n \n public class SearchCommand extends Command {\n+    private static MapleData npcStringData;\n+    private static MapleData mobStringData;\n+    private static MapleData skillStringData;\n+    private static MapleData mapStringData;\n+    \n     {\n         setDescription(\"\");\n+        \n+        MapleDataProvider dataProvider = MapleDataProviderFactory.getDataProvider(new File(\"wz/String.wz\"));\n+        npcStringData = dataProvider.getData(\"Npc.img\");\n+        mobStringData = dataProvider.getData(\"Mob.img\");\n+        skillStringData = dataProvider.getData(\"Skill.img\");\n+        mapStringData = dataProvider.getData(\"Map.img\");\n     }\n \n     @Override\n@@ -53,26 +64,43 @@ public void execute(MapleClient c, String[] params) {\n         String search = joinStringFrom(params,1);\n         long start = System.currentTimeMillis();//for the lulz\n         MapleData data = null;\n-        MapleDataProvider dataProvider = MapleDataProviderFactory.getDataProvider(new File(\"wz/String.wz\"));\n         if (!params[0].equalsIgnoreCase(\"ITEM\")) {\n+            boolean mapSearch = false;\n+            \n             if (params[0].equalsIgnoreCase(\"NPC\")) {\n-                data = dataProvider.getData(\"Npc.img\");\n+                data = npcStringData;\n             } else if (params[0].equalsIgnoreCase(\"MOB\") || params[0].equalsIgnoreCase(\"MONSTER\")) {\n-                data = dataProvider.getData(\"Mob.img\");\n+                data = mobStringData;\n             } else if (params[0].equalsIgnoreCase(\"SKILL\")) {\n-                data = dataProvider.getData(\"Skill.img\");\n-                                /*} else if (sub[1].equalsIgnoreCase(\"MAP\")) {\n-                                        TODO\n-                                */\n+                data = skillStringData;\n+            } else if (params[0].equalsIgnoreCase(\"MAP\")) {\n+                data = mapStringData;\n+                mapSearch = true;\n             } else {\n-                sb.append(\"#bInvalid search.\\r\\nSyntax: '!search [type] [name]', where [type] is NPC, ITEM, MOB, or SKILL.\");\n+                sb.append(\"#bInvalid search.\\r\\nSyntax: '!search [type] [name]', where [type] is MAP, NPC, ITEM, MOB, or SKILL.\");\n             }\n             if (data != null) {\n                 String name;\n-                for (MapleData searchData : data.getChildren()) {\n-                    name = MapleDataTool.getString(searchData.getChildByPath(\"name\"), \"NO-NAME\");\n-                    if (name.toLowerCase().contains(search.toLowerCase())) {\n-                        sb.append(\"#b\").append(Integer.parseInt(searchData.getName())).append(\"#k - #r\").append(name).append(\"\\r\\n\");\n+                \n+                if (!mapSearch) {\n+                    for (MapleData searchData : data.getChildren()) {\n+                        name = MapleDataTool.getString(searchData.getChildByPath(\"name\"), \"NO-NAME\");\n+                        if (name.toLowerCase().contains(search.toLowerCase())) {\n+                            sb.append(\"#b\").append(Integer.parseInt(searchData.getName())).append(\"#k - #r\").append(name).append(\"\\r\\n\");\n+                        }\n+                    }\n+                } else {\n+                    String mapName, streetName;\n+                    \n+                    for (MapleData searchDataDir : data.getChildren()) {\n+                        for (MapleData searchData : searchDataDir.getChildren()) {\n+                            mapName = MapleDataTool.getString(searchData.getChildByPath(\"mapName\"), \"NO-NAME\");\n+                            streetName = MapleDataTool.getString(searchData.getChildByPath(\"streetName\"), \"NO-NAME\");\n+                            \n+                            if (mapName.toLowerCase().contains(search.toLowerCase()) || streetName.toLowerCase().contains(search.toLowerCase())) {\n+                                sb.append(\"#b\").append(Integer.parseInt(searchData.getName())).append(\"#k - #r\").append(streetName).append(\" - \").append(mapName).append(\"\\r\\n\");\n+                            }\n+                        }\n                     }\n                 }\n             }"}, {"sha": "17a4defbab86279a8d6f1e4161176d08d57e6cc1", "filename": "src/client/command/commands/gm6/SupplyRateCouponCommand.java", "status": "renamed", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm6/SupplyRateCouponCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/command/commands/gm6/SupplyRateCouponCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm6/SupplyRateCouponCommand.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -17,25 +17,27 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n-\n-/*\n-   @Author: Arthur L - Refactored command content into modules\n-*/\n package client.command.commands.gm6;\n \n-import client.command.Command;\n-import client.MapleClient;\n import client.MapleCharacter;\n-import tools.MaplePacketCreator;\n+import client.MapleClient;\n+import client.command.Command;\n+import constants.ServerConstants;\n \n-public class FredCommand extends Command {\n+public class SupplyRateCouponCommand extends Command {\n     {\n         setDescription(\"\");\n     }\n \n     @Override\n     public void execute(MapleClient c, String[] params) {\n-        c.announce(MaplePacketCreator.fredrickMessage(Byte.valueOf(params[0])));\n-\n+        MapleCharacter player = c.getPlayer();\n+        if (params.length < 1) {\n+            player.dropMessage(5, \"Syntax: !supplyratecoupon <yes|no>\");\n+            return;\n+        }\n+        \n+        ServerConstants.USE_SUPPLY_RATE_COUPONS = params[0].compareToIgnoreCase(\"no\") != 0;\n+        player.dropMessage(5, \"Rate coupons are now \" + (ServerConstants.USE_SUPPLY_RATE_COUPONS ? \"enabled\" : \"disabled\") + \" for purchase at the Cash Shop.\");\n     }\n }", "previous_filename": "src/client/command/commands/gm6/FredCommand.java"}, {"sha": "c9b8691dd1de64c9b556986b68f564f54b4563cb", "filename": "src/client/inventory/Item.java", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/Item.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/Item.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Item.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -26,10 +26,12 @@\n import java.util.LinkedList;\n import java.util.List;\n import java.util.concurrent.atomic.AtomicInteger;\n+import client.inventory.manipulator.MapleKarmaManipulator;\n+import server.MapleItemInformationProvider;\n \n public class Item implements Comparable<Item> {\n \n-    private static AtomicInteger runningCashId = new AtomicInteger(0);\n+    private static AtomicInteger runningCashId = new AtomicInteger(777000000);  // pets & rings shares cashid values\n     \n     private int id, cashId, sn;\n     private short position;\n@@ -83,7 +85,7 @@ public int getItemId() {\n \n     public int getCashId() {\n         if (cashId == 0) {\n-            cashId = runningCashId.incrementAndGet();\n+            cashId = runningCashId.getAndIncrement();\n         }\n         return cashId;\n     }\n@@ -177,4 +179,8 @@ public void setGiftFrom(String giftFrom) {\n     public MaplePet getPet() {\n         return pet;\n     }\n+    \n+    public boolean isUntradeable() {\n+        return ((this.getFlag() & ItemConstants.UNTRADEABLE) == ItemConstants.UNTRADEABLE) || (MapleItemInformationProvider.getInstance().isDropRestricted(this.getItemId()) && !MapleKarmaManipulator.hasKarmaFlag(this));\n+    }\n }"}, {"sha": "8f320e55654df40d214b1a3efdf84433c8c936c5", "filename": "src/client/inventory/MaplePet.java", "status": "modified", "additions": 14, "deletions": 20, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/MaplePet.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/MaplePet.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MaplePet.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -21,7 +21,6 @@\n */\n package client.inventory;\n \n-import com.mysql.jdbc.Statement;\n import constants.ExpTable;\n import java.awt.Point;\n import java.sql.PreparedStatement;\n@@ -34,6 +33,7 @@\n import server.movement.LifeMovement;\n import server.movement.LifeMovementFragment;\n import client.MapleCharacter;\n+import client.inventory.manipulator.MapleCashidGenerator;\n import java.sql.Connection;\n import tools.MaplePacketCreator;\n import tools.Pair;\n@@ -90,6 +90,8 @@ public void deleteFromDb() {\n             ps.executeUpdate();\n             ps.close();\n             con.close();\n+            \n+            MapleCashidGenerator.freeCashId(this.getUniqueId());\n         } catch (SQLException ex) {\n             ex.printStackTrace();\n         }\n@@ -116,15 +118,11 @@ public void saveToDb() {\n     public static int createPet(int itemid) {\n         try {\n             Connection con = DatabaseConnection.getConnection();\n-            PreparedStatement ps = con.prepareStatement(\"INSERT INTO pets (name, level, closeness, fullness, summoned) VALUES (?, 1, 0, 100, 0)\", Statement.RETURN_GENERATED_KEYS);\n-            ps.setString(1, MapleItemInformationProvider.getInstance().getName(itemid));\n+            PreparedStatement ps = con.prepareStatement(\"INSERT INTO pets (petid, name, level, closeness, fullness, summoned) VALUES (?, ?, 1, 0, 100, 0)\");\n+            int ret = MapleCashidGenerator.generateCashId();\n+            ps.setInt(1, ret);\n+            ps.setString(2, MapleItemInformationProvider.getInstance().getName(itemid));\n             ps.executeUpdate();\n-            ResultSet rs = ps.getGeneratedKeys();\n-            int ret = -1;\n-            if (rs.next()) {\n-                ret = rs.getInt(1);\n-            }\n-            rs.close();\n             ps.close();\n             con.close();\n             return ret;\n@@ -137,18 +135,14 @@ public static int createPet(int itemid) {\n     public static int createPet(int itemid, byte level, int closeness, int fullness) {\n         try {\n             Connection con = DatabaseConnection.getConnection();\n-            PreparedStatement ps = con.prepareStatement(\"INSERT INTO pets (name, level, closeness, fullness, summoned) VALUES (?, ?, ?, ?, 0)\", Statement.RETURN_GENERATED_KEYS);\n-            ps.setString(1, MapleItemInformationProvider.getInstance().getName(itemid));\n-            ps.setByte(2, level);\n-            ps.setInt(3, closeness);\n-            ps.setInt(4, fullness);\n+            PreparedStatement ps = con.prepareStatement(\"INSERT INTO pets (petid, name, level, closeness, fullness, summoned) VALUES (?, ?, ?, ?, ?, 0)\");\n+            int ret = MapleCashidGenerator.generateCashId();\n+            ps.setInt(1, ret);\n+            ps.setString(2, MapleItemInformationProvider.getInstance().getName(itemid));\n+            ps.setByte(3, level);\n+            ps.setInt(4, closeness);\n+            ps.setInt(5, fullness);\n             ps.executeUpdate();\n-            ResultSet rs = ps.getGeneratedKeys();\n-            int ret = -1;\n-            if (rs.next()) {\n-                ret = rs.getInt(1);\n-            }\n-            rs.close();\n             ps.close();\n             con.close();\n             return ret;"}, {"sha": "cba7bf1e18b5f62d29f00cda1e441b70ad3555d9", "filename": "src/client/inventory/manipulator/MapleCashidGenerator.java", "status": "added", "additions": 104, "deletions": 0, "changes": 104, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/manipulator/MapleCashidGenerator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/manipulator/MapleCashidGenerator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleCashidGenerator.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,104 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package client.inventory.manipulator;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import tools.DatabaseConnection;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ */\n+public class MapleCashidGenerator {\n+    \n+    private final static Set<Integer> existentCashids = new HashSet<>(10000);\n+    private static Integer runningCashid = 0;\n+    \n+    private static void loadExistentCashIdsFromQuery(Connection con, String query) throws SQLException {\n+        PreparedStatement ps = con.prepareStatement(query);\n+        ResultSet rs = ps.executeQuery();\n+        \n+        while (rs.next()) {\n+            existentCashids.add(rs.getInt(1));\n+        }\n+        \n+        rs.close();\n+        ps.close();\n+    }\n+    \n+    public static synchronized void loadExistentCashIdsFromDb() {\n+        Connection con = null;\n+        try {\n+            con = DatabaseConnection.getConnection();\n+            \n+            loadExistentCashIdsFromQuery(con, \"SELECT id FROM rings\");\n+            loadExistentCashIdsFromQuery(con, \"SELECT petid FROM pets\");\n+            \n+            con.close();\n+        } catch (SQLException ex) {\n+            ex.printStackTrace();\n+        } finally {\n+            try {\n+                if (con != null && !con.isClosed()) {\n+                    con.close();\n+                }\n+            } catch (SQLException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+        \n+        runningCashid = 0;\n+        do {\n+            runningCashid++;    // hopefully the id will never surpass the allotted amount for pets/rings?\n+        } while (existentCashids.contains(runningCashid));\n+    }\n+    \n+    private static void getNextAvailableCashId() {\n+        runningCashid++;\n+        if (runningCashid >= 777000000) {\n+            existentCashids.clear();\n+            loadExistentCashIdsFromDb();\n+        }\n+    }\n+    \n+    public static synchronized int generateCashId() {\n+        while (true) {\n+            if (!existentCashids.contains(runningCashid)) {\n+                int ret = runningCashid;\n+                getNextAvailableCashId();\n+                \n+                // existentCashids.add(ret)... no need to do this since the wrap over already refetches already used cashids from the DB\n+                return ret;\n+            }\n+            \n+            getNextAvailableCashId();\n+        }\n+    }\n+    \n+    public static synchronized void freeCashId(int cashId) {\n+        existentCashids.remove(cashId);\n+    }\n+    \n+}"}, {"sha": "e26f36824a417f210cd126d7fffb54722bf76130", "filename": "src/client/inventory/manipulator/MapleInventoryManipulator.java", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/manipulator/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/inventory/manipulator/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleInventoryManipulator.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -520,16 +520,18 @@ public static void equip(MapleClient c, short src, short dst) {\n         \n         //1112413, 1112414, 1112405 (Lilin's Ring)\n         source = (Equip) eqpInv.getItem(src);\n-        Equip target = (Equip) eqpdInv.getItem(dst);\n         eqpInv.removeSlot(src);\n-        if (target != null) {\n-            eqpdInv.lockInventory();\n-            try {\n+        \n+        Equip target;\n+        eqpdInv.lockInventory();\n+        try {\n+            target = (Equip) eqpdInv.getItem(dst);\n+            if (target != null) {\n                 chr.unequippedItem(target);\n                 eqpdInv.removeSlot(dst);\n-            } finally {\n-                eqpdInv.unlockInventory();\n             }\n+        } finally {\n+            eqpdInv.unlockInventory();\n         }\n \n         final List<ModifyInventory> mods = new ArrayList<>();\n@@ -705,7 +707,7 @@ public static void drop(MapleClient c, MapleInventoryType type, short src, short\n     }\n \n     private static boolean isDroppedItemRestricted(Item it) {\n-        return ServerConstants.USE_ERASE_UNTRADEABLE_DROP && ((it.getFlag() & ItemConstants.UNTRADEABLE) == ItemConstants.UNTRADEABLE);\n+        return ServerConstants.USE_ERASE_UNTRADEABLE_DROP && it.isUntradeable();\n     }\n     \n     public static boolean isSandboxItem(Item it) {"}, {"sha": "979f1439ba0f9a89f79fde580e4952dee4823829", "filename": "src/client/processor/AssignSPProcessor.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/AssignSPProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/AssignSPProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/AssignSPProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -43,7 +43,7 @@ public static void SPAssignAction(MapleClient c, int skillid) {\n         c.lockClient();\n         try {\n             if (skillid == Aran.HIDDEN_FULL_DOUBLE || skillid == Aran.HIDDEN_FULL_TRIPLE || skillid == Aran.HIDDEN_OVER_DOUBLE || skillid == Aran.HIDDEN_OVER_TRIPLE) {\n-                c.getSession().write(MaplePacketCreator.enableActions());\n+                c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n "}, {"sha": "82cb5300dda1b66e093dd9f3f4d4d1f84785fe93", "filename": "src/client/processor/BuybackProcessor.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/BuybackProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/BuybackProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/BuybackProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -21,16 +21,13 @@\n \n import client.MapleClient;\n import client.MapleCharacter;\n-import client.MapleStat;\n import java.awt.Point;\n-import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import server.maps.MapleMap;\n import server.movement.AbsoluteLifeMovement;\n import server.movement.LifeMovementFragment;\n import tools.MaplePacketCreator;\n-import tools.Pair;\n \n /**\n  *"}, {"sha": "d24b91cf6d85d73854c6432a2e3b38bc719166cc", "filename": "src/client/processor/DueyProcessor.java", "status": "modified", "additions": 124, "deletions": 120, "changes": 244, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/DueyProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/DueyProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/DueyProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -345,167 +345,171 @@ public static void addItemToDB(Item item, int quantity, int mesos, String sName,\n     }\n     \n     public static void dueySendItem(MapleClient c, byte inventId, short itemPos, short amount, int mesos, String recipient) {\n-        c.lockClient();\n-        try {\n-            final int fee = 5000;\n-            final long sendMesos = (long) mesos + fee;\n-            if (mesos < 0 || sendMesos > Integer.MAX_VALUE || (amount < 1 && mesos == 0)) {\n-                AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with duey.\");\n-                FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use duey with mesos \" + mesos + \" and amount \" + amount + \"\\r\\n\");           \t\n-                c.disconnect(true, false);\n-                return;\n-            }\n-            \n-            int finalcost = mesos + fee;\n-            if (c.getPlayer().getMeso() >= finalcost) {\n-                int accid = getAccIdFromCNAME(recipient, true);\n-                if (accid != -1) {\n-                    if (accid == c.getAccID()) {\n-                        c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SAMEACC_ERROR.getCode()));\n+        if (c.tryacquireClient()) {\n+            try {\n+                final int fee = 5000;\n+                final long sendMesos = (long) mesos + fee;\n+                if (mesos < 0 || sendMesos > Integer.MAX_VALUE || (amount < 1 && mesos == 0)) {\n+                    AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with duey.\");\n+                    FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to use duey with mesos \" + mesos + \" and amount \" + amount + \"\\r\\n\");           \t\n+                    c.disconnect(true, false);\n+                    return;\n+                }\n+\n+                int finalcost = mesos + fee;\n+                if (c.getPlayer().getMeso() >= finalcost) {\n+                    int accid = getAccIdFromCNAME(recipient, true);\n+                    if (accid != -1) {\n+                        if (accid == c.getAccID()) {\n+                            c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SAMEACC_ERROR.getCode()));\n+                            return;\n+                        }\n+                    } else {\n+                        c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_NAME_DOES_NOT_EXIST.getCode()));\n                         return;\n                     }\n                 } else {\n-                    c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_NAME_DOES_NOT_EXIST.getCode()));\n+                    c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_NOT_ENOUGH_MESOS.getCode()));\n                     return;\n                 }\n-            } else {\n-                c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_NOT_ENOUGH_MESOS.getCode()));\n-                return;\n-            }\n \n-            MapleClient rClient = null;\n-            int channel = c.getWorldServer().find(recipient);\n-            if (channel > -1) {\n-                Channel rcserv = c.getWorldServer().getChannel(channel);\n-                if(rcserv != null) {\n-                    MapleCharacter rChr = rcserv.getPlayerStorage().getCharacterByName(recipient);\n-                    if(rChr != null) {\n-                        rClient = rChr.getClient();\n+                MapleClient rClient = null;\n+                int channel = c.getWorldServer().find(recipient);\n+                if (channel > -1) {\n+                    Channel rcserv = c.getWorldServer().getChannel(channel);\n+                    if(rcserv != null) {\n+                        MapleCharacter rChr = rcserv.getPlayerStorage().getCharacterByName(recipient);\n+                        if(rChr != null) {\n+                            rClient = rChr.getClient();\n+                        }\n                     }\n                 }\n-            }\n-            \n-            if (inventId > 0) {\n-                MapleInventoryType inv = MapleInventoryType.getByType(inventId);\n-                Item item = c.getPlayer().getInventory(inv).getItem(itemPos);\n-                if (item != null && c.getPlayer().getItemQuantity(item.getItemId(), false) >= amount) {\n-                    c.getPlayer().gainMeso(-finalcost, false);\n-                    c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SUCCESSFULLY_SENT.getCode()));\n \n-                    if (ItemConstants.isRechargeable(item.getItemId())) {\n-                        MapleInventoryManipulator.removeFromSlot(c, inv, itemPos, item.getQuantity(), true);\n+                if (inventId > 0) {\n+                    MapleInventoryType inv = MapleInventoryType.getByType(inventId);\n+                    Item item = c.getPlayer().getInventory(inv).getItem(itemPos);\n+                    if (item != null && c.getPlayer().getItemQuantity(item.getItemId(), false) >= amount) {\n+                        c.getPlayer().gainMeso(-finalcost, false);\n+                        c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SUCCESSFULLY_SENT.getCode()));\n+\n+                        if (ItemConstants.isRechargeable(item.getItemId())) {\n+                            MapleInventoryManipulator.removeFromSlot(c, inv, itemPos, item.getQuantity(), true);\n+                        } else {\n+                            MapleInventoryManipulator.removeFromSlot(c, inv, itemPos, amount, true, false);\n+                        }\n+\n+                        MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n+                        addItemToDB(item, amount, mesos - getFee(mesos), c.getPlayer().getName(), getAccIdFromCNAME(recipient, false));\n                     } else {\n-                        MapleInventoryManipulator.removeFromSlot(c, inv, itemPos, amount, true, false);\n+                        if (item != null) {\n+                            c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_INCORRECT_REQUEST.getCode()));\n+                        }\n+                        return;\n                     }\n-\n-                    MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n-                    addItemToDB(item, amount, mesos - getFee(mesos), c.getPlayer().getName(), getAccIdFromCNAME(recipient, false));\n                 } else {\n-                    if (item != null) {\n-                        c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_INCORRECT_REQUEST.getCode()));\n-                    }\n-                    return;\n-                }\n-            } else {\n-                c.getPlayer().gainMeso(-finalcost, false);\n-                c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SUCCESSFULLY_SENT.getCode()));    \n+                    c.getPlayer().gainMeso(-finalcost, false);\n+                    c.announce(MaplePacketCreator.sendDueyMSG(DueyProcessor.Actions.TOCLIENT_SEND_SUCCESSFULLY_SENT.getCode()));    \n \n-                addMesoToDB(mesos - getFee(mesos), c.getPlayer().getName(), getAccIdFromCNAME(recipient, false));\n-            }\n+                    addMesoToDB(mesos - getFee(mesos), c.getPlayer().getName(), getAccIdFromCNAME(recipient, false));\n+                }\n \n-            if (rClient != null && rClient.isLoggedIn() && !rClient.getPlayer().isAwayFromWorld()) {\n-                showDueyNotification(rClient, rClient.getPlayer());\n+                if (rClient != null && rClient.isLoggedIn() && !rClient.getPlayer().isAwayFromWorld()) {\n+                    showDueyNotification(rClient, rClient.getPlayer());\n+                }\n+            } finally {\n+                c.releaseClient();\n             }\n-        } finally {\n-            c.unlockClient();\n         }\n     }\n     \n     public static void dueyRemovePackage(MapleClient c, int packageid) {\n-        c.lockClient();\n-        try {\n-            removeItemFromDB(packageid);\n-            c.announce(MaplePacketCreator.removeItemFromDuey(true, packageid));\n-        } finally {\n-            c.unlockClient();\n+        if (c.tryacquireClient()) {\n+            try {\n+                removeItemFromDB(packageid);\n+                c.announce(MaplePacketCreator.removeItemFromDuey(true, packageid));\n+            } finally {\n+                c.releaseClient();\n+            }\n         }\n     }\n     \n     public static void dueyClaimPackage(MapleClient c, int packageid) {\n-        c.lockClient();\n-        try {\n-            List<DueyPackages> packages = new LinkedList<>();\n-            DueyPackages dp = null;\n-            Connection con = null;\n+        if (c.tryacquireClient()) {\n             try {\n-                con = DatabaseConnection.getConnection();\n-                DueyPackages dueypack;\n-                try (PreparedStatement ps = con.prepareStatement(\"SELECT * FROM dueypackages LEFT JOIN dueyitems USING (PackageId) WHERE PackageId = ?\")) {\n-                    ps.setInt(1, packageid);\n-                    try (ResultSet rs = ps.executeQuery()) {\n-                        dueypack = null;\n-                        if (rs.next()) {\n-                            dueypack = getItemByPID(rs);\n-                            dueypack.setSender(rs.getString(\"SenderName\"));\n-                            dueypack.setMesos(rs.getInt(\"Mesos\"));\n-                            dueypack.setSentTime(rs.getString(\"TimeStamp\"));\n+                List<DueyPackages> packages = new LinkedList<>();\n+                DueyPackages dp = null;\n+                Connection con = null;\n+                try {\n+                    con = DatabaseConnection.getConnection();\n+                    DueyPackages dueypack;\n+                    try (PreparedStatement ps = con.prepareStatement(\"SELECT * FROM dueypackages LEFT JOIN dueyitems USING (PackageId) WHERE PackageId = ?\")) {\n+                        ps.setInt(1, packageid);\n+                        try (ResultSet rs = ps.executeQuery()) {\n+                            dueypack = null;\n+                            if (rs.next()) {\n+                                dueypack = getItemByPID(rs);\n+                                dueypack.setSender(rs.getString(\"SenderName\"));\n+                                dueypack.setMesos(rs.getInt(\"Mesos\"));\n+                                dueypack.setSentTime(rs.getString(\"TimeStamp\"));\n \n-                            packages.add(dueypack);\n+                                packages.add(dueypack);\n+                            }\n                         }\n                     }\n-                }\n-                dp = dueypack;\n-                if(dp == null) {\n-                    c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_UNKNOWN_ERROR.getCode()));\n-                    FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to receive package from duey with id \" + packageid + \"\\r\\n\");\n-                    return;\n-                }\n+                    dp = dueypack;\n+                    if(dp == null) {\n+                        c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_UNKNOWN_ERROR.getCode()));\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to receive package from duey with id \" + packageid + \"\\r\\n\");\n+                        return;\n+                    }\n \n-                if (dp.getItem() != null) {\n-                    if (!MapleInventoryManipulator.checkSpace(c, dp.getItem().getItemId(), dp.getItem().getQuantity(), dp.getItem().getOwner())) {\n-                        int itemid = dp.getItem().getItemId();\n-                        if(MapleItemInformationProvider.getInstance().isPickupRestricted(itemid) && c.getPlayer().getInventory(ItemConstants.getInventoryType(itemid)).findById(itemid) != null) {\n-                            c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_RECEIVER_WITH_UNIQUE.getCode()));\n+                    if (dp.getItem() != null) {\n+                        if (!MapleInventoryManipulator.checkSpace(c, dp.getItem().getItemId(), dp.getItem().getQuantity(), dp.getItem().getOwner())) {\n+                            int itemid = dp.getItem().getItemId();\n+                            if(MapleItemInformationProvider.getInstance().isPickupRestricted(itemid) && c.getPlayer().getInventory(ItemConstants.getInventoryType(itemid)).findById(itemid) != null) {\n+                                c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_RECEIVER_WITH_UNIQUE.getCode()));\n+                            } else {\n+                                c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_NO_FREE_SLOTS.getCode()));\n+                            }\n+\n+                            return;\n                         } else {\n-                            c.announce(MaplePacketCreator.sendDueyMSG(Actions.TOCLIENT_RECV_NO_FREE_SLOTS.getCode()));\n+                            MapleInventoryManipulator.addFromDrop(c, dp.getItem(), false);\n                         }\n+                    }\n \n-                        return;\n+                    long gainmesos;\n+                    long totalmesos = (long) dp.getMesos() + c.getPlayer().getMeso();\n+\n+                    if (totalmesos < 0 || dp.getMesos() < 0) {\n+                        gainmesos = 0;\n                     } else {\n-                        MapleInventoryManipulator.addFromDrop(c, dp.getItem(), false);\n+                        totalmesos = Math.min(totalmesos, Integer.MAX_VALUE);\n+                        gainmesos = totalmesos - c.getPlayer().getMeso();\n                     }\n-                }\n \n-                long gainmesos;\n-                long totalmesos = (long) dp.getMesos() + c.getPlayer().getMeso();\n-\n-                if (totalmesos < 0 || dp.getMesos() < 0) {\n-                    gainmesos = 0;\n-                } else {\n-                    totalmesos = Math.min(totalmesos, Integer.MAX_VALUE);\n-                    gainmesos = totalmesos - c.getPlayer().getMeso();\n-                }\n-                \n-                c.getPlayer().gainMeso((int)gainmesos, false);\n+                    c.getPlayer().gainMeso((int)gainmesos, false);\n \n-                removeItemFromDB(packageid);\n-                c.announce(MaplePacketCreator.removeItemFromDuey(false, packageid));\n+                    removeItemFromDB(packageid);\n+                    c.announce(MaplePacketCreator.removeItemFromDuey(false, packageid));\n \n-                con.close();\n-            } catch (SQLException e) {\n-                e.printStackTrace();\n+                    con.close();\n+                } catch (SQLException e) {\n+                    e.printStackTrace();\n+                }\n+            } finally {\n+                c.releaseClient();\n             }\n-        } finally {\n-            c.unlockClient();\n         }\n     }\n     \n     public static void dueySendTalk(MapleClient c) {\n-        c.lockClient();\n-        try {\n-            c.announce(MaplePacketCreator.sendDuey((byte) 8, loadItems(c.getPlayer())));\n-        } finally {\n-            c.unlockClient();\n+        if (c.tryacquireClient()) {\n+            try {\n+                c.announce(MaplePacketCreator.sendDuey((byte) 8, loadItems(c.getPlayer())));\n+            } finally {\n+                c.releaseClient();\n+            }\n         }\n     }\n }"}, {"sha": "780a19bab9db8e323f53c1bb95fce4f199c47689", "filename": "src/client/processor/FredrickProcessor.java", "status": "modified", "additions": 29, "deletions": 28, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/FredrickProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/FredrickProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/FredrickProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -70,42 +70,43 @@ private static boolean deleteFredrickItems(int cid) {\n     }\n     \n     public static void fredrickRetrieveItems(MapleClient c) {     // thanks Gustav for pointing out the dupe on Fredrick handling\n-        c.lockClient();\n-        try {\n-            MapleCharacter chr = c.getPlayer();\n-            \n-            List<Pair<Item, MapleInventoryType>> items;\n+        if (c.tryacquireClient()) {\n             try {\n-                items = ItemFactory.MERCHANT.loadItems(chr.getId(), false);\n-                if (!canRetrieveFromFredrick(chr, items)) {\n-                    chr.announce(MaplePacketCreator.fredrickMessage((byte) 0x21));\n-                    return;\n-                }\n+                MapleCharacter chr = c.getPlayer();\n+\n+                List<Pair<Item, MapleInventoryType>> items;\n+                try {\n+                    items = ItemFactory.MERCHANT.loadItems(chr.getId(), false);\n+                    if (!canRetrieveFromFredrick(chr, items)) {\n+                        chr.announce(MaplePacketCreator.fredrickMessage((byte) 0x21));\n+                        return;\n+                    }\n \n-                chr.withdrawMerchantMesos();\n+                    chr.withdrawMerchantMesos();\n \n-                if (deleteFredrickItems(chr.getId())) {\n-                    MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                    if (deleteFredrickItems(chr.getId())) {\n+                        MapleHiredMerchant merchant = chr.getHiredMerchant();\n \n-                    if(merchant != null)\n-                        merchant.clearItems();\n+                        if(merchant != null)\n+                            merchant.clearItems();\n \n-                    for (Pair<Item, MapleInventoryType> it : items) {\n-                        Item item = it.getLeft();\n-                        MapleInventoryManipulator.addFromDrop(chr.getClient(), item, false);\n-                        String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                        FilePrinter.print(FilePrinter.FREDRICK + chr.getName() + \".txt\", chr.getName() + \" gained \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n-                    }\n+                        for (Pair<Item, MapleInventoryType> it : items) {\n+                            Item item = it.getLeft();\n+                            MapleInventoryManipulator.addFromDrop(chr.getClient(), item, false);\n+                            String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n+                            FilePrinter.print(FilePrinter.FREDRICK + chr.getName() + \".txt\", chr.getName() + \" gained \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                        }\n \n-                    chr.announce(MaplePacketCreator.fredrickMessage((byte) 0x1E));\n-                } else {\n-                    chr.message(\"An unknown error has occured.\");\n+                        chr.announce(MaplePacketCreator.fredrickMessage((byte) 0x1E));\n+                    } else {\n+                        chr.message(\"An unknown error has occured.\");\n+                    }\n+                } catch (SQLException ex) {\n+                    ex.printStackTrace();\n                 }\n-            } catch (SQLException ex) {\n-                ex.printStackTrace();\n+            } finally {\n+                c.releaseClient();\n             }\n-        } finally {\n-            c.unlockClient();\n         }\n     }\n }"}, {"sha": "44ad0e74dd647960ecd89006865d11b5be5b227d", "filename": "src/client/processor/MakerProcessor.java", "status": "modified", "additions": 125, "deletions": 125, "changes": 250, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/MakerProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/MakerProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/MakerProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -26,7 +26,6 @@\n import constants.ItemConstants;\n import constants.ServerConstants;\n import client.inventory.manipulator.MapleInventoryManipulator;\n-import constants.EquipType;\n import constants.GameConstants;\n import java.util.LinkedHashMap;\n import java.util.LinkedList;\n@@ -47,168 +46,169 @@\n     private static MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n \n     public static void makerAction(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        c.lockClient();\n-        try {\n-            int type = slea.readInt();\n-            int toCreate = slea.readInt();\n-            int toDisassemble = -1, pos = -1;\n-            boolean makerSucceeded = true;\n-\n-            MakerItemFactory.MakerItemCreateEntry recipe;\n-            Map<Integer, Short> reagentids = new LinkedHashMap<>();\n-            int stimulantid = -1;\n-\n-            if(type == 3) {    // building monster crystal\n-                int fromLeftover = toCreate;\n-                toCreate = ii.getMakerCrystalFromLeftover(toCreate);\n-                if(toCreate == -1) {\n-                    c.announce(MaplePacketCreator.serverNotice(1, ii.getName(toCreate) + \" is unavailable for Monster Crystal conversion.\"));\n-                    return;\n-                }\n+        if (c.tryacquireClient()) {\n+            try {\n+                int type = slea.readInt();\n+                int toCreate = slea.readInt();\n+                int toDisassemble = -1, pos = -1;\n+                boolean makerSucceeded = true;\n+\n+                MakerItemFactory.MakerItemCreateEntry recipe;\n+                Map<Integer, Short> reagentids = new LinkedHashMap<>();\n+                int stimulantid = -1;\n+\n+                if(type == 3) {    // building monster crystal\n+                    int fromLeftover = toCreate;\n+                    toCreate = ii.getMakerCrystalFromLeftover(toCreate);\n+                    if(toCreate == -1) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, ii.getName(toCreate) + \" is unavailable for Monster Crystal conversion.\"));\n+                        return;\n+                    }\n \n-                recipe = MakerItemFactory.generateLeftoverCrystalEntry(fromLeftover);\n-            } else if(type == 4) {  // disassembling\n-                slea.readInt(); // 1... probably inventory type\n-                pos = slea.readInt();\n+                    recipe = MakerItemFactory.generateLeftoverCrystalEntry(fromLeftover);\n+                } else if(type == 4) {  // disassembling\n+                    slea.readInt(); // 1... probably inventory type\n+                    pos = slea.readInt();\n \n-                Item it = c.getPlayer().getInventory(MapleInventoryType.EQUIP).getItem((short) pos);\n-                if(it != null && it.getItemId() == toCreate) {\n-                    Pair<Integer, Integer> p;\n+                    Item it = c.getPlayer().getInventory(MapleInventoryType.EQUIP).getItem((short) pos);\n+                    if(it != null && it.getItemId() == toCreate) {\n+                        Pair<Integer, Integer> p;\n \n-                    if((p = generateDisassemblyInfo(toCreate)) != null) {\n-                        recipe = MakerItemFactory.generateDisassemblyCrystalEntry(p.getLeft(), p.getRight());\n-                        toDisassemble = toCreate;\n-                        toCreate = ii.getMakerCrystalFromEquip(toCreate);\n+                        if((p = generateDisassemblyInfo(toCreate)) != null) {\n+                            recipe = MakerItemFactory.generateDisassemblyCrystalEntry(p.getLeft(), p.getRight());\n+                            toDisassemble = toCreate;\n+                            toCreate = ii.getMakerCrystalFromEquip(toCreate);\n+                        } else {\n+                            c.announce(MaplePacketCreator.serverNotice(1, ii.getName(toCreate) + \" is unavailable for Monster Crystal disassembly.\"));\n+                            return;\n+                        }\n                     } else {\n-                        c.announce(MaplePacketCreator.serverNotice(1, ii.getName(toCreate) + \" is unavailable for Monster Crystal disassembly.\"));\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"An unknown error occurred when trying to apply that item for disassembly.\"));\n                         return;\n                     }\n                 } else {\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"An unknown error occurred when trying to apply that item for disassembly.\"));\n-                    return;\n-                }\n-            } else {\n-                if(ItemConstants.isEquipment(toCreate)) {   // only equips uses stimulant and reagents\n-                    if(slea.readByte() != 0) {  // stimulant\n-                        stimulantid = ii.getMakerStimulant(toCreate);\n-                        if(!c.getAbstractPlayerInteraction().haveItem(stimulantid)) {\n-                            stimulantid = -1;\n+                    if(ItemConstants.isEquipment(toCreate)) {   // only equips uses stimulant and reagents\n+                        if(slea.readByte() != 0) {  // stimulant\n+                            stimulantid = ii.getMakerStimulant(toCreate);\n+                            if(!c.getAbstractPlayerInteraction().haveItem(stimulantid)) {\n+                                stimulantid = -1;\n+                            }\n                         }\n-                    }\n \n-                    int reagents = Math.min(slea.readInt(), getMakerReagentSlots(toCreate));\n-                    for(int i = 0; i < reagents; i++) {  // crystals\n-                        int reagentid = slea.readInt();\n-                        if(ItemConstants.isMakerReagent(reagentid)) {\n-                            Short rs = reagentids.get(reagentid);\n-                            if(rs == null) {\n-                                reagentids.put(reagentid, (short) 1);\n-                            } else {\n-                                reagentids.put(reagentid, (short) (rs + 1));\n+                        int reagents = Math.min(slea.readInt(), getMakerReagentSlots(toCreate));\n+                        for(int i = 0; i < reagents; i++) {  // crystals\n+                            int reagentid = slea.readInt();\n+                            if(ItemConstants.isMakerReagent(reagentid)) {\n+                                Short rs = reagentids.get(reagentid);\n+                                if(rs == null) {\n+                                    reagentids.put(reagentid, (short) 1);\n+                                } else {\n+                                    reagentids.put(reagentid, (short) (rs + 1));\n+                                }\n                             }\n                         }\n-                    }\n \n-                    List<Pair<Integer, Short>> toUpdate = new LinkedList<>();\n-                    for(Map.Entry<Integer, Short> r : reagentids.entrySet()) {\n-                        int qty = c.getAbstractPlayerInteraction().getItemQuantity(r.getKey());\n+                        List<Pair<Integer, Short>> toUpdate = new LinkedList<>();\n+                        for(Map.Entry<Integer, Short> r : reagentids.entrySet()) {\n+                            int qty = c.getAbstractPlayerInteraction().getItemQuantity(r.getKey());\n \n-                        if(qty < r.getValue()) {\n-                            toUpdate.add(new Pair<>(r.getKey(), (short) qty));\n+                            if(qty < r.getValue()) {\n+                                toUpdate.add(new Pair<>(r.getKey(), (short) qty));\n+                            }\n                         }\n-                    }\n \n-                    // remove those not present on player inventory\n-                    if(!toUpdate.isEmpty()) {\n-                        for(Pair<Integer, Short> rp : toUpdate) {\n-                            if(rp.getRight() > 0) {\n-                                reagentids.put(rp.getLeft(), rp.getRight());\n-                            } else {\n-                                reagentids.remove(rp.getLeft());\n+                        // remove those not present on player inventory\n+                        if(!toUpdate.isEmpty()) {\n+                            for(Pair<Integer, Short> rp : toUpdate) {\n+                                if(rp.getRight() > 0) {\n+                                    reagentids.put(rp.getLeft(), rp.getRight());\n+                                } else {\n+                                    reagentids.remove(rp.getLeft());\n+                                }\n                             }\n                         }\n-                    }\n \n-                    if(!reagentids.isEmpty()) {\n-                        if(!removeOddMakerReagents(toCreate, reagentids)) {\n-                            c.announce(MaplePacketCreator.serverNotice(1, \"You can only use WATK and MATK Strengthening Gems on weapon items.\"));\n-                            return;\n+                        if(!reagentids.isEmpty()) {\n+                            if(!removeOddMakerReagents(toCreate, reagentids)) {\n+                                c.announce(MaplePacketCreator.serverNotice(1, \"You can only use WATK and MATK Strengthening Gems on weapon items.\"));\n+                                return;\n+                            }\n                         }\n                     }\n-                }\n \n-                recipe = MakerItemFactory.getItemCreateEntry(toCreate, stimulantid, reagentids);\n-            }\n+                    recipe = MakerItemFactory.getItemCreateEntry(toCreate, stimulantid, reagentids);\n+                }\n \n-            short createStatus = getCreateStatus(c, recipe);\n+                short createStatus = getCreateStatus(c, recipe);\n \n-            switch(createStatus) {\n-                case -1:// non-available for Maker itemid has been tried to forge\n-                    FilePrinter.printError(FilePrinter.EXPLOITS, \"Player \" + c.getPlayer().getName() + \" tried to craft itemid \" + toCreate + \" using the Maker skill.\");\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"The requested item could not be crafted on this operation.\"));\n-                    break;\n+                switch(createStatus) {\n+                    case -1:// non-available for Maker itemid has been tried to forge\n+                        FilePrinter.printError(FilePrinter.EXPLOITS, \"Player \" + c.getPlayer().getName() + \" tried to craft itemid \" + toCreate + \" using the Maker skill.\");\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"The requested item could not be crafted on this operation.\"));\n+                        break;\n \n-                case 1: // no items\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You don't have all required items in your inventory to make \" + recipe.getRewardAmount() + \" \" + ii.getName(toCreate) + \".\"));\n-                    break;\n+                    case 1: // no items\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You don't have all required items in your inventory to make \" + recipe.getRewardAmount() + \" \" + ii.getName(toCreate) + \".\"));\n+                        break;\n \n-                case 2: // no meso\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough mesos (\" + GameConstants.numberWithCommas(recipe.getCost()) + \") to complete this operation.\"));\n-                    break;\n+                    case 2: // no meso\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough mesos (\" + GameConstants.numberWithCommas(recipe.getCost()) + \") to complete this operation.\"));\n+                        break;\n \n-                case 3: // no req level\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough level to complete this operation.\"));\n-                    break;\n+                    case 3: // no req level\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough level to complete this operation.\"));\n+                        break;\n \n-                case 4: // no req skill level\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough Maker level to complete this operation.\"));\n-                    break;\n+                    case 4: // no req skill level\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough Maker level to complete this operation.\"));\n+                        break;\n \n-                default:\n-                    if (MapleInventoryManipulator.checkSpace(c, toCreate, (short) recipe.getRewardAmount(), \"\")) {\n-                        for (Pair<Integer, Integer> p : recipe.getReqItems()) {\n-                            c.getAbstractPlayerInteraction().gainItem(p.getLeft(), (short) -p.getRight());\n-                        }\n+                    default:\n+                        if (MapleInventoryManipulator.checkSpace(c, toCreate, (short) recipe.getRewardAmount(), \"\")) {\n+                            for (Pair<Integer, Integer> p : recipe.getReqItems()) {\n+                                c.getAbstractPlayerInteraction().gainItem(p.getLeft(), (short) -p.getRight());\n+                            }\n \n-                        if(toDisassemble != -1) {\n-                            MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.EQUIP, (short) pos, (short) 1, false);\n-                            c.announce(MaplePacketCreator.getShowItemGain(toDisassemble, (short) -1, true));\n-                        }\n+                            if(toDisassemble != -1) {\n+                                MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.EQUIP, (short) pos, (short) 1, false);\n+                                c.announce(MaplePacketCreator.getShowItemGain(toDisassemble, (short) -1, true));\n+                            }\n \n-                        int cost = recipe.getCost();\n-                        if(stimulantid == -1 && reagentids.isEmpty()) {\n-                            if(cost > 0) c.getPlayer().gainMeso(-cost);\n+                            int cost = recipe.getCost();\n+                            if(stimulantid == -1 && reagentids.isEmpty()) {\n+                                if(cost > 0) c.getPlayer().gainMeso(-cost);\n \n-                            c.getPlayer().setCS(true);\n-                            c.getAbstractPlayerInteraction().gainItem(toCreate, (short) recipe.getRewardAmount());\n-                            c.getPlayer().setCS(false);\n-                        } else {\n-                            if(stimulantid != -1) c.getAbstractPlayerInteraction().gainItem(stimulantid, (short) -1);\n-                            if(!reagentids.isEmpty()) {\n-                                for(Map.Entry<Integer, Short> r : reagentids.entrySet()) {\n-                                    c.getAbstractPlayerInteraction().gainItem(r.getKey(), (short) (-1 * r.getValue()));\n+                                c.getPlayer().setCS(true);\n+                                c.getAbstractPlayerInteraction().gainItem(toCreate, (short) recipe.getRewardAmount());\n+                                c.getPlayer().setCS(false);\n+                            } else {\n+                                if(stimulantid != -1) c.getAbstractPlayerInteraction().gainItem(stimulantid, (short) -1);\n+                                if(!reagentids.isEmpty()) {\n+                                    for(Map.Entry<Integer, Short> r : reagentids.entrySet()) {\n+                                        c.getAbstractPlayerInteraction().gainItem(r.getKey(), (short) (-1 * r.getValue()));\n+                                    }\n                                 }\n-                            }\n \n-                            if(cost > 0) c.getPlayer().gainMeso(-cost);\n-                            makerSucceeded = addBoostedMakerItem(c, toCreate, stimulantid, reagentids);\n-                        }\n+                                if(cost > 0) c.getPlayer().gainMeso(-cost);\n+                                makerSucceeded = addBoostedMakerItem(c, toCreate, stimulantid, reagentids);\n+                            }\n \n-                        if(makerSucceeded) c.announce(MaplePacketCreator.serverNotice(1, \"You have successfully created \" + recipe.getRewardAmount() + \" \" + ii.getName(toCreate) + \".\"));\n-                        else c.getPlayer().dropMessage(5, \"The Maker skill lights up, but the skill winds up as if nothing happened.\");\n+                            if(makerSucceeded) c.announce(MaplePacketCreator.serverNotice(1, \"You have successfully created \" + recipe.getRewardAmount() + \" \" + ii.getName(toCreate) + \".\"));\n+                            else c.getPlayer().dropMessage(5, \"The Maker skill lights up, but the skill winds up as if nothing happened.\");\n \n-                        c.announce(MaplePacketCreator.showMakerEffect(makerSucceeded));\n-                        c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showForeignMakerEffect(c.getPlayer().getId(), makerSucceeded), false);\n+                            c.announce(MaplePacketCreator.showMakerEffect(makerSucceeded));\n+                            c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showForeignMakerEffect(c.getPlayer().getId(), makerSucceeded), false);\n \n-                        if(toCreate == 4260003 && c.getPlayer().getQuestStatus(6033) == 1) {\n-                            c.getAbstractPlayerInteraction().setQuestProgress(6033, 1);\n+                            if(toCreate == 4260003 && c.getPlayer().getQuestStatus(6033) == 1) {\n+                                c.getAbstractPlayerInteraction().setQuestProgress(6033, 1);\n+                            }\n+                        } else {\n+                            c.announce(MaplePacketCreator.serverNotice(1, \"Your inventory is full.\"));\n                         }\n-                    } else {\n-                        c.announce(MaplePacketCreator.serverNotice(1, \"Your inventory is full.\"));\n-                    }\n+                }\n+            } finally {\n+                c.releaseClient();\n             }\n-        } finally {\n-            c.unlockClient();\n         }\n     }\n         "}, {"sha": "997af5acec04e555061b235a5b50a5260c93ef9e", "filename": "src/client/processor/SpawnPetProcessor.java", "status": "modified", "additions": 49, "deletions": 48, "changes": 97, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/SpawnPetProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/SpawnPetProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/SpawnPetProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -40,60 +40,61 @@\n     private static MapleDataProvider dataRoot = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Item.wz\"));\n     \n     public static void processSpawnPet(MapleClient c, byte slot, boolean lead) {\n-        c.lockClient();\n-        try {\n-            MapleCharacter chr = c.getPlayer();\n-            MaplePet pet = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getPet();\n-            if (pet == null) return;\n+        if (c.tryacquireClient()) {\n+            try {\n+                MapleCharacter chr = c.getPlayer();\n+                MaplePet pet = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getPet();\n+                if (pet == null) return;\n \n-            int petid = pet.getItemId();\n-            if (petid == 5000028 || petid == 5000047) //Handles Dragon AND Robos\n-            {\n-                if (chr.haveItem(petid + 1)) {\n-                    chr.dropMessage(5, \"You can't hatch your \" + (petid == 5000028 ? \"Dragon egg\" : \"Robo egg\") + \" if you already have a Baby \" + (petid == 5000028 ? \"Dragon.\" : \"Robo.\"));\n-                    c.announce(MaplePacketCreator.enableActions());\n-                    return;\n-                } else {\n-                    int evolveid = MapleDataTool.getInt(\"info/evol1\", dataRoot.getData(\"Pet/\" + petid + \".img\"));\n-                    int petId = MaplePet.createPet(evolveid);\n-                    if (petId == -1) {\n+                int petid = pet.getItemId();\n+                if (petid == 5000028 || petid == 5000047) //Handles Dragon AND Robos\n+                {\n+                    if (chr.haveItem(petid + 1)) {\n+                        chr.dropMessage(5, \"You can't hatch your \" + (petid == 5000028 ? \"Dragon egg\" : \"Robo egg\") + \" if you already have a Baby \" + (petid == 5000028 ? \"Dragon.\" : \"Robo.\"));\n+                        c.announce(MaplePacketCreator.enableActions());\n                         return;\n-                    }\n-                    long expiration = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getExpiration();\n-                    MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, petid, (short) 1, false, false);\n-                    MapleInventoryManipulator.addById(c, evolveid, (short) 1, null, petId, expiration);\n-                    pet.deleteFromDb();\n+                    } else {\n+                        int evolveid = MapleDataTool.getInt(\"info/evol1\", dataRoot.getData(\"Pet/\" + petid + \".img\"));\n+                        int petId = MaplePet.createPet(evolveid);\n+                        if (petId == -1) {\n+                            return;\n+                        }\n+                        long expiration = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getExpiration();\n+                        MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, petid, (short) 1, false, false);\n+                        MapleInventoryManipulator.addById(c, evolveid, (short) 1, null, petId, expiration);\n+                        pet.deleteFromDb();\n \n-                    c.announce(MaplePacketCreator.enableActions());\n-                    return;\n-                }\n-            }\n-            if (chr.getPetIndex(pet) != -1) {\n-                chr.unequipPet(pet, true);\n-            } else {\n-                if (chr.getSkillLevel(SkillFactory.getSkill(8)) == 0 && chr.getPet(0) != null) {\n-                    chr.unequipPet(chr.getPet(0), false);\n-                }\n-                if (lead) {\n-                    chr.shiftPetsRight();\n+                        c.announce(MaplePacketCreator.enableActions());\n+                        return;\n+                    }\n                 }\n-                Point pos = chr.getPosition();\n-                pos.y -= 12;\n-                pet.setPos(pos);\n-                pet.setFh(chr.getMap().getFootholds().findBelow(pet.getPos()).getId());\n-                pet.setStance(0);\n-                pet.setSummoned(true);\n-                pet.saveToDb();\n-                chr.addPet(pet);\n-                chr.getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showPet(c.getPlayer(), pet, false, false), true);\n-                c.announce(MaplePacketCreator.petStatUpdate(c.getPlayer()));\n-                c.announce(MaplePacketCreator.enableActions());\n+                if (chr.getPetIndex(pet) != -1) {\n+                    chr.unequipPet(pet, true);\n+                } else {\n+                    if (chr.getSkillLevel(SkillFactory.getSkill(8)) == 0 && chr.getPet(0) != null) {\n+                        chr.unequipPet(chr.getPet(0), false);\n+                    }\n+                    if (lead) {\n+                        chr.shiftPetsRight();\n+                    }\n+                    Point pos = chr.getPosition();\n+                    pos.y -= 12;\n+                    pet.setPos(pos);\n+                    pet.setFh(chr.getMap().getFootholds().findBelow(pet.getPos()).getId());\n+                    pet.setStance(0);\n+                    pet.setSummoned(true);\n+                    pet.saveToDb();\n+                    chr.addPet(pet);\n+                    chr.getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showPet(c.getPlayer(), pet, false, false), true);\n+                    c.announce(MaplePacketCreator.petStatUpdate(c.getPlayer()));\n+                    c.announce(MaplePacketCreator.enableActions());\n \n-                chr.commitExcludedItems();\n-                chr.getClient().getWorldServer().registerPetHunger(chr, chr.getPetIndex(pet));\n+                    chr.commitExcludedItems();\n+                    chr.getClient().getWorldServer().registerPetHunger(chr, chr.getPetIndex(pet));\n+                }\n+            } finally {\n+                c.releaseClient();\n             }\n-        } finally {\n-            c.unlockClient();\n         }\n     }\n }"}, {"sha": "386006d2f6d21e9ab9ef2d1d075edf062e035cbd", "filename": "src/client/processor/StorageProcessor.java", "status": "modified", "additions": 106, "deletions": 105, "changes": 211, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/StorageProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/client/processor/StorageProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/StorageProcessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -54,123 +54,124 @@ public static void storageAction(SeekableLittleEndianAccessor slea, MapleClient\n                         return;\n                 }\n                 \n-                c.lockClient();\n-                try {\n-                        if (mode == 4) { // take out\n-                                byte type = slea.readByte();\n-                                byte slot = slea.readByte();\n-                                if (slot < 0 || slot > storage.getSlots()) { // removal starts at zero\n-                                        AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n-                                        FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to work with storage slot \" + slot + \"\\r\\n\");\n-                                        c.disconnect(true, false);\n-                                        return;\n-                                }\n-                                slot = storage.getSlot(MapleInventoryType.getByType(type), slot);\n-                                Item item = storage.getItem(slot);\n-                                if (item != null) {\n-                                        if (MapleItemInformationProvider.getInstance().isPickupRestricted(item.getItemId()) && chr.haveItemWithId(item.getItemId(), true)) {\n-                                                c.announce(MaplePacketCreator.getStorageError((byte) 0x0C));\n+                if (c.tryacquireClient()) {\n+                        try {\n+                                if (mode == 4) { // take out\n+                                        byte type = slea.readByte();\n+                                        byte slot = slea.readByte();\n+                                        if (slot < 0 || slot > storage.getSlots()) { // removal starts at zero\n+                                                AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n+                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to work with storage slot \" + slot + \"\\r\\n\");\n+                                                c.disconnect(true, false);\n                                                 return;\n                                         }\n-                                        \n-                                        int takeoutFee = storage.getTakeOutFee();\n-                                        if (chr.getMeso() < takeoutFee) {\n-                                                c.announce(MaplePacketCreator.getStorageError((byte) 0x0B));\n+                                        slot = storage.getSlot(MapleInventoryType.getByType(type), slot);\n+                                        Item item = storage.getItem(slot);\n+                                        if (item != null) {\n+                                                if (MapleItemInformationProvider.getInstance().isPickupRestricted(item.getItemId()) && chr.haveItemWithId(item.getItemId(), true)) {\n+                                                        c.announce(MaplePacketCreator.getStorageError((byte) 0x0C));\n+                                                        return;\n+                                                }\n+\n+                                                int takeoutFee = storage.getTakeOutFee();\n+                                                if (chr.getMeso() < takeoutFee) {\n+                                                        c.announce(MaplePacketCreator.getStorageError((byte) 0x0B));\n+                                                        return;\n+                                                } else {\n+                                                        chr.gainMeso(-takeoutFee, false);\n+                                                }\n+\n+                                                if (MapleInventoryManipulator.checkSpace(c, item.getItemId(), item.getQuantity(), item.getOwner())) {                \n+                                                        item = storage.takeOut(slot);//actually the same but idc\n+                                                        String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n+                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" took out \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                                                        chr.setUsedStorage();\n+                                                        MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n+                                                        MapleInventoryManipulator.addFromDrop(c, item, false);\n+                                                        storage.sendTakenOut(c, item.getInventoryType());\n+                                                } else {\n+                                                        c.announce(MaplePacketCreator.getStorageError((byte) 0x0A));\n+                                                }\n+                                        }\n+                                } else if (mode == 5) { // store\n+                                        short slot = slea.readShort();\n+                                        int itemId = slea.readInt();\n+                                        short quantity = slea.readShort();\n+                                        MapleInventoryType slotType = ItemConstants.getInventoryType(itemId);\n+                                        MapleInventory Inv = chr.getInventory(slotType);\n+                                        if (slot < 1 || slot > Inv.getSlotLimit()) { //player inv starts at one\n+                                                AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n+                                                FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to store item at slot \" + slot + \"\\r\\n\");\n+                                                c.disconnect(true, false);\n                                                 return;\n-                                        } else {\n-                                                chr.gainMeso(-takeoutFee, false);\n                                         }\n-                                        \n-                                        if (MapleInventoryManipulator.checkSpace(c, item.getItemId(), item.getQuantity(), item.getOwner())) {                \n-                                                item = storage.takeOut(slot);//actually the same but idc\n-                                                String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                                                FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" took out \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n-                                                chr.setUsedStorage();\n-                                                MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n-                                                MapleInventoryManipulator.addFromDrop(c, item, false);\n-                                                storage.sendTakenOut(c, item.getInventoryType());\n+                                        if (quantity < 1 || chr.getItemQuantity(itemId, false) < quantity) {\n+                                                c.announce(MaplePacketCreator.enableActions());\n+                                                return;\n+                                        }\n+                                        if (storage.isFull()) {\n+                                                c.announce(MaplePacketCreator.getStorageError((byte) 0x11));\n+                                                return;\n+                                        }\n+\n+                                        int storeFee = storage.getStoreFee();\n+                                        if (chr.getMeso() < storeFee) {\n+                                                c.announce(MaplePacketCreator.getStorageError((byte) 0x0B));\n                                         } else {\n-                                                c.announce(MaplePacketCreator.getStorageError((byte) 0x0A));\n+                                                MapleInventoryType invType = ItemConstants.getInventoryType(itemId);\n+                                                Item item = chr.getInventory(invType).getItem(slot).copy();\n+                                                if (item != null && item.getItemId() == itemId && (item.getQuantity() >= quantity || ItemConstants.isRechargeable(itemId))) {\n+                                                        if (ItemConstants.isRechargeable(itemId)) {\n+                                                                quantity = item.getQuantity();\n+                                                        }\n+\n+                                                        chr.gainMeso(-storeFee, false, true, false);\n+                                                        MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n+                                                        MapleInventoryManipulator.removeFromSlot(c, invType, slot, quantity, false);\n+                                                        item.setQuantity(quantity);\n+                                                        storage.store(item);\n+                                                        storage.sendStored(c, ItemConstants.getInventoryType(itemId));\n+                                                        String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n+                                                        FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                                                        chr.setUsedStorage();\n+                                                }\n                                         }\n-                                }\n-                        } else if (mode == 5) { // store\n-                                short slot = slea.readShort();\n-                                int itemId = slea.readInt();\n-                                short quantity = slea.readShort();\n-                                MapleInventoryType slotType = ItemConstants.getInventoryType(itemId);\n-                                MapleInventory Inv = chr.getInventory(slotType);\n-                                if (slot < 1 || slot > Inv.getSlotLimit()) { //player inv starts at one\n-                                        AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with storage.\");\n-                                        FilePrinter.print(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to store item at slot \" + slot + \"\\r\\n\");\n-                                        c.disconnect(true, false);\n-                                        return;\n-                                }\n-                                if (quantity < 1 || chr.getItemQuantity(itemId, false) < quantity) {\n+                                } else if (mode == 6) { // arrange items\n+                                        if(ServerConstants.USE_STORAGE_ITEM_SORT) storage.arrangeItems(c);\n                                         c.announce(MaplePacketCreator.enableActions());\n-                                        return;\n-                                }\n-                                if (storage.isFull()) {\n-                                        c.announce(MaplePacketCreator.getStorageError((byte) 0x11));\n-                                        return;\n-                                }\n-                                \n-                                int storeFee = storage.getStoreFee();\n-                                if (chr.getMeso() < storeFee) {\n-                                        c.announce(MaplePacketCreator.getStorageError((byte) 0x0B));\n-                                } else {\n-                                        MapleInventoryType invType = ItemConstants.getInventoryType(itemId);\n-                                        Item item = chr.getInventory(invType).getItem(slot).copy();\n-                                        if (item != null && item.getItemId() == itemId && (item.getQuantity() >= quantity || ItemConstants.isRechargeable(itemId))) {\n-                                                if (ItemConstants.isRechargeable(itemId)) {\n-                                                        quantity = item.getQuantity();\n+                                } else if (mode == 7) { // meso\n+                                        int meso = slea.readInt();\n+                                        int storageMesos = storage.getMeso();\n+                                        int playerMesos = chr.getMeso();\n+                                        if ((meso > 0 && storageMesos >= meso) || (meso < 0 && playerMesos >= -meso)) {\n+                                                if (meso < 0 && (storageMesos - meso) < 0) {\n+                                                        meso = Integer.MIN_VALUE + storageMesos;\n+                                                        if (meso < playerMesos) {\n+                                                                c.announce(MaplePacketCreator.enableActions());\n+                                                                return;\n+                                                        }\n+                                                } else if (meso > 0 && (playerMesos + meso) < 0) {\n+                                                        meso = Integer.MAX_VALUE - playerMesos;\n+                                                        if (meso > storageMesos) {\n+                                                                c.announce(MaplePacketCreator.enableActions());\n+                                                                return;\n+                                                        }\n                                                 }\n-                                                \n-                                                chr.gainMeso(-storeFee, false, true, false);\n-                                                MapleKarmaManipulator.toggleKarmaFlagToUntradeable(item);\n-                                                MapleInventoryManipulator.removeFromSlot(c, invType, slot, quantity, false);\n-                                                item.setQuantity(quantity);\n-                                                storage.store(item);\n-                                                storage.sendStored(c, ItemConstants.getInventoryType(itemId));\n-                                                String itemName = MapleItemInformationProvider.getInstance().getName(item.getItemId());\n-                                                FilePrinter.print(FilePrinter.STORAGE + c.getAccountName() + \".txt\", c.getPlayer().getName() + \" stored \" + item.getQuantity() + \" \" + itemName + \" (\" + item.getItemId() + \")\\r\\n\");\n+                                                storage.setMeso(storageMesos - meso);\n+                                                chr.gainMeso(meso, false, true, false);\n+                                                FilePrinter.print(FilePrinter.STORAGE + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + (meso > 0 ? \" took out \" : \" stored \") + Math.abs(meso) + \" mesos\\r\\n\");\n                                                 chr.setUsedStorage();\n+                                        } else {\n+                                                c.announce(MaplePacketCreator.enableActions());\n+                                                return;\n                                         }\n+                                        storage.sendMeso(c);\n+                                } else if (mode == 8) {// close\n+                                        storage.close();\n                                 }\n-                        } else if (mode == 6) { // arrange items\n-                                if(ServerConstants.USE_STORAGE_ITEM_SORT) storage.arrangeItems(c);\n-                                c.announce(MaplePacketCreator.enableActions());\n-                        } else if (mode == 7) { // meso\n-                                int meso = slea.readInt();\n-                                int storageMesos = storage.getMeso();\n-                                int playerMesos = chr.getMeso();\n-                                if ((meso > 0 && storageMesos >= meso) || (meso < 0 && playerMesos >= -meso)) {\n-                                        if (meso < 0 && (storageMesos - meso) < 0) {\n-                                                meso = -2147483648 + storageMesos;\n-                                                if (meso < playerMesos) {\n-                                                        c.announce(MaplePacketCreator.enableActions());\n-                                                        return;\n-                                                }\n-                                        } else if (meso > 0 && (playerMesos + meso) < 0) {\n-                                                meso = 2147483647 - playerMesos;\n-                                                if (meso > storageMesos) {\n-                                                        c.announce(MaplePacketCreator.enableActions());\n-                                                        return;\n-                                                }\n-                                        }\n-                                        storage.setMeso(storageMesos - meso);\n-                                        chr.gainMeso(meso, false, true, false);\n-                                        FilePrinter.print(FilePrinter.STORAGE + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + (meso > 0 ? \" took out \" : \" stored \") + Math.abs(meso) + \" mesos\\r\\n\");\n-                                        chr.setUsedStorage();\n-                                } else {\n-                                        c.announce(MaplePacketCreator.enableActions());\n-                                        return;\n-                                }\n-                                storage.sendMeso(c);\n-                        } else if (mode == 8) {// close\n-                                storage.close();\n+                        } finally {\n+                                c.releaseClient();\n                         }\n-                } finally {\n-                        c.unlockClient();\n                 }\n         }\n }"}, {"sha": "0d445deb393fa7b44036576b28a12e070506ab41", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -54,6 +54,7 @@\n     public static final boolean USE_DEBUG = false;                  //Will enable some text prints on the client, oriented for debugging purposes.\n     public static final boolean USE_DEBUG_SHOW_INFO_EQPEXP = false; //Prints on the cmd all equip exp gain info.\n     public static       boolean USE_DEBUG_SHOW_RCVD_PACKET = false; //Prints on the cmd all received packet ids.\n+    public static       boolean USE_SUPPLY_RATE_COUPONS = true;     //Allows rate coupons to be sold through the Cash Shop.\n     \n     public static final boolean USE_MAXRANGE = true;                //Will send and receive packets from all events on a map, rather than those of only view range.\n     public static final boolean USE_MAXRANGE_ECHO_OF_HERO = true;\n@@ -104,6 +105,7 @@\n     \n     //Cash Shop Configuration\n     public static final boolean USE_JOINT_CASHSHOP_INVENTORY = true;//Enables usage of a same cash shop inventory for explorers, cygnus and legends. Items from exclusive cash shop inventories won't show up on the shared inventory, though.\n+    public static final boolean USE_CLEAR_OUTDATED_COUPONS = true;  //Enables deletion of older code coupon registry from the DB, freeing so-long irrelevant data.\n     \n     //Maker Configuration\n     public static final boolean USE_MAKER_PERMISSIVE_ATKUP = true;  //Allows players to use attack-based strengthening gems on non-weapon items.\n@@ -148,7 +150,8 @@\n     //Map Monitor Configuration\n     public static final int ITEM_EXPIRE_CHECK = 10 * 1000;      //Interval between item expiring tasks on maps, which checks and makes disappear expired items.\n     public static final int ITEM_LIMIT_ON_MAP = 200;            //Max number of items allowed on a map.\n-    public static final int MAP_VISITED_SIZE = 5;               //Max length for last mapids visited by a player. This is used to recover and update drops on these maps accordingly with player actions.    \n+    public static final int MAP_VISITED_SIZE = 5;               //Max length for last mapids visited by a player. This is used to recover and update drops on these maps accordingly with player actions.\n+    public static final int MAP_DAMAGE_OVERTIME_INTERVAL = 5000;//Interval in seconds between map environment damage (e.g. El Nath and Aqua Road surrondings).\n     \n     //Channel Mob Disease Monitor Configuration\n     public static final int MOB_STATUS_MONITOR_PROC = 200;     //Frequency in milliseconds between each proc on the mob disease monitor schedule.\n@@ -172,7 +175,7 @@\n     \n     //Other Skills Configuration\n     public static final boolean USE_FAST_REUSE_HERO_WILL = true;//Greatly reduce cooldown on Hero's Will.\n-    public static final boolean USE_ANTI_IMMUNITY_CRASH = true; //Crash skills additionally removes the mob's invincibility buffs.\n+    public static final boolean USE_ANTI_IMMUNITY_CRASH = true; //Crash skills additionally removes the mob's invincibility buffs. Suggestion thanks to Celestial.\n     public static final boolean USE_UNDISPEL_HOLY_SHIELD = true;//Holy shield buff also prevents players from suffering dispel from mobs.\n     \n     //Character Configuration\n@@ -200,6 +203,7 @@\n     //Equipment Configuration\n     public static final boolean USE_EQUIPMNT_LVLUP_SLOTS = true;//Equips can upgrade slots at level up.\n     public static final boolean USE_EQUIPMNT_LVLUP_POWER = true;//Enable more powerful stat upgrades at equip level up.\n+    public static final boolean USE_EQUIPMNT_LVLUP_CASH = true; //Enable equip leveling up on cash equipments as well.\n     public static final boolean USE_SPIKES_AVOID_BANISH = true; //Shoes equipped with spikes prevents mobs from banishing wearer.\n     public static final int MAX_EQUIPMNT_LVLUP_STAT_UP = 10000; //Max stat upgrade an equipment can have on a levelup.\n     public static final int MAX_EQUIPMNT_STAT = 32767;          //Max stat on an equipment by leveling up."}, {"sha": "e6f9dbee3aa0b6c361ba27319824e5bc9d6c15a4", "filename": "src/constants/skills/SuperGM.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/constants/skills/SuperGM.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/constants/skills/SuperGM.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/skills/SuperGM.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -33,6 +33,5 @@\n     public static final int HIDE = 9101004;\n     public static final int RESURRECTION = 9101005;\n     public static final int SUPER_DRAGON_ROAR = 9001001;\n-    public static final int TELEPORT = 9101007;\n     public static final int HYPER_BODY = 9101008;\n }\n\\ No newline at end of file"}, {"sha": "42b3561d31b13f7bfb341c9b10d62754ed54756d", "filename": "src/net/server/Server.java", "status": "modified", "additions": 33, "deletions": 12, "changes": 45, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -80,6 +80,7 @@\n import client.SkillFactory;\n import client.inventory.Item;\n import client.inventory.ItemFactory;\n+import client.inventory.manipulator.MapleCashidGenerator;\n import client.newyear.NewYearCardRecord;\n import constants.ItemConstants;\n import constants.GameConstants;\n@@ -90,7 +91,6 @@\n import server.quest.MapleQuest;\n import tools.AutoJCE;\n import tools.DatabaseConnection;\n-import tools.FilePrinter;\n import tools.Pair;\n \n public class Server {\n@@ -518,6 +518,34 @@ private static long getTimeLeftForNextHour() {\n         return couponRates;\n     }\n     \n+    public static void cleanNxcodeCoupons(Connection con) throws SQLException {\n+        if (!ServerConstants.USE_CLEAR_OUTDATED_COUPONS) return;\n+        \n+        long timeClear = System.currentTimeMillis() - 14 * 24 * 60 * 60 * 1000;\n+        \n+        PreparedStatement ps = con.prepareStatement(\"SELECT * FROM nxcode WHERE expiration <= ?\");\n+        ps.setLong(1, timeClear);\n+        ResultSet rs = ps.executeQuery();\n+\n+        if (!rs.isLast()) {\n+            PreparedStatement ps2 = con.prepareStatement(\"DELETE FROM nxcode_items WHERE codeid = ?\");\n+            while (rs.next()) {\n+                ps2.setInt(1, rs.getInt(\"id\"));\n+                ps2.addBatch();\n+            }\n+            ps2.executeBatch();\n+            ps2.close();\n+            \n+            ps2 = con.prepareStatement(\"DELETE FROM nxcode WHERE expiration <= ?\");\n+            ps2.setLong(1, timeClear);\n+            ps2.executeUpdate();\n+            ps2.close();\n+        }\n+        \n+        rs.close();\n+        ps.close();\n+    }\n+    \n     private void loadCouponRates(Connection c) throws SQLException {\n         PreparedStatement ps = c.prepareStatement(\"SELECT couponid, rate FROM nxcoupons\");\n         ResultSet rs = ps.executeQuery();\n@@ -818,13 +846,17 @@ public void init() {\n             ps.executeUpdate();\n             ps.close();\n             \n+            cleanNxcodeCoupons(c);\n             loadCouponRates(c);\n             updateActiveCoupons();\n             \n             c.close();\n         } catch (SQLException sqle) {\n             sqle.printStackTrace();\n         }\n+        \n+        MapleCashidGenerator.loadExistentCashIdsFromDb();\n+        \n         IoBuffer.setUseDirectBuffer(false);\n         IoBuffer.setAllocator(new SimpleBufferAllocator());\n         acceptor = new NioSocketAcceptor();\n@@ -893,17 +925,6 @@ public void init() {\n         online = true;\n     }\n \n-    public void shutdown() {\n-    \ttry {\n-\t        TimerManager.getInstance().stop();\n-\t        acceptor.unbind();\n-    \t} catch (NullPointerException e) {\n-    \t\tFilePrinter.printError(FilePrinter.EXCEPTION_CAUGHT, e);\n-    \t}\n-        System.out.println(\"Server offline.\");\n-        System.exit(0);// BOEIEND :D\n-    }\n-\n     public static void main(String args[]) {\n         System.setProperty(\"wzpath\", \"wz\");\n         Security.setProperty(\"crypto.policy\", \"unlimited\");"}, {"sha": "02f08c9a68d6030602d05b789dd1ad6fa742ec06", "filename": "src/net/server/channel/Channel.java", "status": "modified", "additions": 21, "deletions": 6, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/Channel.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/Channel.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/Channel.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -198,6 +198,7 @@ public final void shutdown() {\n             System.out.println(\"Shutting down Channel \" + channel + \" on World \" + world);\n             \n             closeAllMerchants();\n+            disconnectAwayPlayers();\n             players.disconnectAll();\n             \n             if(respawnTask != null) {\n@@ -314,6 +315,10 @@ public int getWorld() {\n         return world;\n     }\n     \n+    public World getWorldServer() {\n+        return Server.getInstance().getWorld(world);\n+    }\n+    \n     public void addPlayer(MapleCharacter chr) {\n         players.addPlayer(chr);\n         chr.announce(MaplePacketCreator.serverMessage(serverMessage));\n@@ -393,6 +398,16 @@ public void removePlayerAway(int chrId) {\n     public boolean canUninstall() {\n         return players.getSize() == 0 && playersAway.isEmpty();\n     }\n+    \n+    private void disconnectAwayPlayers() {\n+        World wserv = getWorldServer();\n+        for (Integer cid : playersAway) {\n+            MapleCharacter chr = wserv.getPlayerStorage().getCharacterById(cid);\n+            if (chr != null && chr.isLoggedin()) {\n+                chr.getClient().disconnect(true, false);\n+            }\n+        }\n+    }\n         \n     public class respawnMaps implements Runnable {\n \n@@ -465,7 +480,7 @@ public boolean finishedShutdown() {\n     public void setServerMessage(String message) {\n         this.serverMessage = message;\n         broadcastPacket(MaplePacketCreator.serverMessage(message));\n-        Server.getInstance().getWorld(world).resetDisabledServerMessages();\n+        getWorldServer().resetDisabledServerMessages();\n     }\n     \n     private static String [] getEvents(){\n@@ -692,7 +707,7 @@ public void removeMiniDungeon(int dungeonid) {\n             lock.unlock();\n         }\n         \n-        World wserv = Server.getInstance().getWorld(world);\n+        World wserv = getWorldServer();\n         \n         Pair<Integer, Integer> coupleId = wserv.getMarriageQueuedCouple(ret);\n         Pair<Boolean, Set<Integer>> typeGuests = wserv.removeMarriageQueued(ret);\n@@ -704,7 +719,7 @@ public void removeMiniDungeon(int dungeonid) {\n     }\n     \n     public boolean isWeddingReserved(Integer weddingId) {\n-        World wserv = Server.getInstance().getWorld(world);\n+        World wserv = getWorldServer();\n         \n         lock.lock();\n         try {\n@@ -746,7 +761,7 @@ public int getWeddingReservationStatus(Integer weddingId, boolean cathedral) {\n     public int pushWeddingReservation(Integer weddingId, boolean cathedral, boolean premium, Integer groomId, Integer brideId) {\n         if(weddingId == null || isWeddingReserved(weddingId)) return -1;\n         \n-        World wserv = Server.getInstance().getWorld(world);\n+        World wserv = getWorldServer();\n         wserv.putMarriageQueued(weddingId, cathedral, premium, groomId, brideId);\n         \n         lock.lock();\n@@ -935,7 +950,7 @@ public String getWeddingReservationTimeLeft(Integer weddingId) {\n     public Pair<Integer, Integer> getWeddingCoupleForGuest(int guestId, boolean cathedral) {\n         lock.lock();\n         try {\n-            return (isOngoingWeddingGuest(cathedral, guestId)) ? Server.getInstance().getWorld(world).getRelationshipCouple(getOngoingWedding(cathedral)) : null;\n+            return (isOngoingWeddingGuest(cathedral, guestId)) ? getWorldServer().getRelationshipCouple(getOngoingWedding(cathedral)) : null;\n         } finally {\n             lock.unlock();\n         }\n@@ -1038,7 +1053,7 @@ public void unregisterFaceExpression(int mapid, MapleCharacter chr) {\n     \n     public void debugMarriageStatus() {\n         System.out.println(\" ----- WORLD DATA -----\");\n-        Server.getInstance().getWorld(world).debugMarriageStatus();\n+        getWorldServer().debugMarriageStatus();\n         \n         System.out.println(\" ----- CH. \" + channel + \" -----\");\n         System.out.println(\" ----- CATHEDRAL -----\");"}, {"sha": "0b6693be519cbb8870f72eeead821eb865cd5246", "filename": "src/net/server/channel/handlers/CancelChairHandler.java", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CancelChairHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CancelChairHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CancelChairHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -24,7 +24,6 @@\n import client.MapleClient;\n import client.MapleCharacter;\n import net.AbstractMaplePacketHandler;\n-import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class CancelChairHandler extends AbstractMaplePacketHandler {\n@@ -35,21 +34,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleCharacter mc = c.getPlayer();\n         if(!mc.isLoggedinWorld()) return;\n         \n-        if (id == -1) { // Cancel Chair\n-            mc.setChair(0);\n-            if(mc.unregisterChairBuff()) {\n-                c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.cancelForeignChairSkillEffect(mc.getId()), false);\n-            }\n-            \n-            c.announce(MaplePacketCreator.cancelChair(-1));\n-            c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showChair(c.getPlayer().getId(), 0), false);\n-        } else { // Use In-Map Chair\n-            mc.setChair(id);\n-            if(mc.registerChairBuff()) {\n-                c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.giveForeignChairSkillEffect(mc.getId()), false);\n-            }\n-            \n-            c.announce(MaplePacketCreator.cancelChair(id));\n-        }\n+        mc.sitChair(id == -1 ? 0 : id);\n     }\n }"}, {"sha": "2e2659266e63be95d5178381b7b84899ac6a454e", "filename": "src/net/server/channel/handlers/CashOperationHandler.java", "status": "modified", "additions": 53, "deletions": 37, "changes": 90, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CashOperationHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CashOperationHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CashOperationHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -38,8 +38,10 @@\n import server.CashShop.CashItem;\n import server.CashShop.CashItemFactory;\n import client.inventory.manipulator.MapleInventoryManipulator;\n+import constants.ServerConstants;\n import tools.FilePrinter;\n import tools.MaplePacketCreator;\n+import tools.Pair;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class CashOperationHandler extends AbstractMaplePacketHandler {\n@@ -62,18 +64,20 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             CashItem cItem = CashItemFactory.getItem(snCS);\n             if (!canBuy(cItem, cs.getCash(useNX))) {\n                 FilePrinter.printError(FilePrinter.ITEM, \"Denied to sell cash item with SN \" + cItem.getSN());\n-                c.announce(MaplePacketCreator.enableActions());\n-                return;\n-            }\n-            \n-            if(ItemConstants.isCashStore(cItem.getItemId()) && chr.getLevel() < 16) {\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n             \n             if (action == 0x03) { // Item\n-                if(ItemConstants.isMapleLife(cItem.getItemId()) && chr.getLevel() < 30) {\n-                    c.announce(MaplePacketCreator.enableActions());\n+                if (ItemConstants.isCashStore(cItem.getItemId()) && chr.getLevel() < 16) {\n+                    c.enableCSActions();\n+                    return;\n+                } else if (ItemConstants.isRateCoupon(cItem.getItemId()) && !ServerConstants.USE_SUPPLY_RATE_COUPONS) {\n+                    chr.dropMessage(1, \"Rate coupons are currently unavailable to purchase.\");\n+                    c.enableCSActions();\n+                    return;\n+                } else if (ItemConstants.isMapleLife(cItem.getItemId()) && chr.getLevel() < 30) {\n+                    c.enableCSActions();\n                     return;\n                 }\n                 \n@@ -95,20 +99,17 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             Map<String, String> recipient = MapleCharacter.getCharacterFromDatabase(slea.readMapleAsciiString());\n             String message = slea.readMapleAsciiString();\n             if (!canBuy(cItem, cs.getCash(4)) || message.length() < 1 || message.length() > 73) {\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n             if (!checkBirthday(c, birthday)) {\n                 c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC4));\n-                c.announce(MaplePacketCreator.enableActions());\n                 return;\n             } else if (recipient == null) {\n                 c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xA9));\n-                c.announce(MaplePacketCreator.enableActions());\n                 return;\n             } else if (recipient.get(\"accountid\").equals(String.valueOf(c.getAccID()))) {\n                 c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xA8));\n-                c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n             cs.gift(Integer.parseInt(recipient.get(\"id\")), chr.getName(), message, cItem.getSN());\n@@ -139,7 +140,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (mode == 0) {\n                 byte type = slea.readByte();\n                 if (cs.getCash(cash) < 4000) {\n-                    c.announce(MaplePacketCreator.enableActions());\n+                    c.enableCSActions();\n                     return;\n                 }\n                 if (chr.gainSlots(type, 4, false)) {\n@@ -151,7 +152,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 CashItem cItem = CashItemFactory.getItem(slea.readInt());\n                 int type = (cItem.getItemId() - 9110000) / 1000;\n                 if (!canBuy(cItem, cs.getCash(cash))) {\n-                    c.announce(MaplePacketCreator.enableActions());\n+                    c.enableCSActions();\n                     return;\n                 }\n                 if (chr.gainSlots(type, 8, false)) {\n@@ -166,7 +167,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             byte mode = slea.readByte();\n             if (mode == 0) {\n                 if (cs.getCash(cash) < 4000) {\n-                    c.announce(MaplePacketCreator.enableActions());\n+                    c.enableCSActions();\n                     return;\n                 }\n                 if (chr.getStorage().gainSlots(4)) {\n@@ -181,7 +182,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 CashItem cItem = CashItemFactory.getItem(slea.readInt());\n \n                 if (!canBuy(cItem, cs.getCash(cash))) {\n-                    c.announce(MaplePacketCreator.enableActions());\n+                    c.enableCSActions();\n                     return;\n                 }\n                 if (chr.getStorage().gainSlots(8)) {\n@@ -196,7 +197,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             CashItem cItem = CashItemFactory.getItem(slea.readInt());\n \n             if (!canBuy(cItem, cs.getCash(cash))) {\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n \n@@ -206,13 +207,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 c.announce(MaplePacketCreator.showCash(chr));\n             } else {\n                 chr.dropMessage(1, \"You have already used up all 12 extra character slots.\");\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n         } else if (action == 0x0D) { // Take from Cash Inventory\n             Item item = cs.findByCashId(slea.readInt());\n             if (item == null) {\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n             if (chr.getInventory(item.getInventoryType()).addItem(item) != -1) {\n@@ -240,11 +241,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             MapleInventory mi = chr.getInventory(MapleInventoryType.getByType(invType));\n             Item item = mi.findByCashId(cashId);\n             if (item == null) {\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             } else if(c.getPlayer().getPetIndex(item.getPetId()) > -1) {\n                 chr.getClient().announce(MaplePacketCreator.serverNotice(1, \"You cannot put the pet you currently equip into the Cash Shop inventory.\"));\n-                c.announce(MaplePacketCreator.enableActions());\n+                c.enableCSActions();\n                 return;\n             }\n             cs.addToInventory(item);\n@@ -265,19 +266,19 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 \t\n                   /*  if (partner.getGender() == chr.getGender()) {\n                         chr.dropMessage(\"You and your partner are the same gender, please buy a friendship ring.\");\n-                        c.announce(MaplePacketCreator.enableActions());\n+                        c.enableCSActions();\n                         return;\n                     }*/ //Gotta let them faggots marry too, hence why this is commented out <3 \n                 \t\n                     if(itemRing.toItem() instanceof Equip) {\n                         Equip eqp = (Equip) itemRing.toItem();\n-                        int ringid = MapleRing.createRing(itemRing.getItemId(), chr, partner);\n-                        eqp.setRingId(ringid);\n+                        Pair<Integer, Integer> rings = MapleRing.createRing(itemRing.getItemId(), chr, partner);\n+                        eqp.setRingId(rings.getLeft());\n                         cs.addToInventory(eqp);\n                         c.announce(MaplePacketCreator.showBoughtCashItem(eqp, c.getAccID()));\n-                        cs.gift(partner.getId(), chr.getName(), text, eqp.getSN(), (ringid + 1));\n+                        cs.gift(partner.getId(), chr.getName(), text, eqp.getSN(), rings.getRight());\n                         cs.gainCash(toCharge, itemRing, chr.getWorld());\n-                        chr.addCrushRing(MapleRing.loadFromDb(ringid));\n+                        chr.addCrushRing(MapleRing.loadFromDb(rings.getLeft()));\n                         try {\n                             chr.sendNote(partner.getName(), text, (byte) 1);\n                         } catch (SQLException ex) {\n@@ -288,17 +289,33 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n             } else {\n                 c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC4));\n-                c.announce(MaplePacketCreator.enableActions());\n             }\n                 \n             c.announce(MaplePacketCreator.showCash(c.getPlayer()));\n-        } else if (action == 0x20) { // everything is 1 meso...\n-            int itemId = CashItemFactory.getItem(slea.readInt()).getItemId();\n+        } else if (action == 0x20) {\n+            int serialNumber = slea.readInt();  // thanks GabrielSin for detecting a potential exploit with 1 meso cash items.\n+            if (serialNumber / 10000000 != 8) {\n+                c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC0));\n+                return;\n+            }\n+            \n+            CashItem item = CashItemFactory.getItem(serialNumber);\n+            if (item == null || !item.isOnSale()) {\n+                c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC0));\n+                return;\n+            }\n+            \n+            int itemId = item.getItemId();\n+            int itemPrice = item.getPrice();\n+            if (itemPrice <= 0) {\n+                c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC0));\n+                return;\n+            }\n             \n-            if (chr.getMeso() > 0) {\n+            if (chr.getMeso() >= itemPrice) {\n                 if (chr.canHold(itemId)) {\n-                    chr.gainMeso(-1, false);\n-                    MapleInventoryManipulator.addById(c, itemId, (short) 1);\n+                    chr.gainMeso(-itemPrice, false);\n+                    MapleInventoryManipulator.addById(c, itemId, (short) 1, \"\", -1);\n                     c.announce(MaplePacketCreator.showBoughtQuestItem(itemId));\n                 }\n             }\n@@ -321,13 +338,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     // Need to check to make sure its actually an equip and the right SN...\n                     if(itemRing.toItem() instanceof Equip) {\n                         Equip eqp = (Equip) itemRing.toItem();\n-                        int ringid = MapleRing.createRing(itemRing.getItemId(), chr, partner);\n-                        eqp.setRingId(ringid);\n+                        Pair<Integer, Integer> rings = MapleRing.createRing(itemRing.getItemId(), chr, partner);\n+                        eqp.setRingId(rings.getLeft());\n                         cs.addToInventory(eqp);\n                         c.announce(MaplePacketCreator.showBoughtCashItem(eqp, c.getAccID()));\n-                        cs.gift(partner.getId(), chr.getName(), text, eqp.getSN(), (ringid + 1));\n+                        cs.gift(partner.getId(), chr.getName(), text, eqp.getSN(), rings.getRight());\n                         cs.gainCash(payment, -itemRing.getPrice());\n-                        chr.addFriendshipRing(MapleRing.loadFromDb(ringid));\n+                        chr.addFriendshipRing(MapleRing.loadFromDb(rings.getLeft()));\n                         try {\n                             chr.sendNote(partner.getName(), text, (byte) 1);\n                         } catch (SQLException ex) {\n@@ -338,7 +355,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n             } else {\n                 c.announce(MaplePacketCreator.showCashShopMessage((byte) 0xC4));\n-                c.announce(MaplePacketCreator.enableActions());\n             }\n                 \n             c.announce(MaplePacketCreator.showCash(c.getPlayer()));"}, {"sha": "00dc153da2b843648d8c9769bda7aaf3ef51f9c4", "filename": "src/net/server/channel/handlers/CloseRangeDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CloseRangeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CloseRangeDamageHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -50,7 +50,7 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleCharacter chr = c.getPlayer();\n-        chr.setPetLootCd(currentServerTime());\n+        //chr.setPetLootCd(currentServerTime());\n         \n         /*long timeElapsed = currentServerTime() - chr.getAutobanManager().getLastSpam(8);\n         if(timeElapsed < 300) {"}, {"sha": "f9c9ae03e128837f47ffefa31f2c0abbf7aa4d94", "filename": "src/net/server/channel/handlers/CouponCodeHandler.java", "status": "modified", "additions": 191, "deletions": 68, "changes": 259, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CouponCodeHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/CouponCodeHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/CouponCodeHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,6 +4,8 @@\n \t\t       Matthias Butz <matze@odinms.de>\n \t\t       Jan Christian Meyer <vimes@odinms.de>\n \n+    Copyleft (L) 2016 - 2018 RonanLana (HeavenMS)\n+\n     This program is free software: you can redistribute it and/or modify\n     it under the terms of the GNU Affero General Public License as\n     published by the Free Software Foundation version 3 as published by\n@@ -21,107 +23,228 @@\n */\n package net.server.channel.handlers;\n \n-import java.sql.SQLException;\n import client.MapleClient;\n+import client.MapleCharacter;\n+import client.inventory.Item;\n+import client.inventory.manipulator.MapleInventoryManipulator;\n import java.sql.Connection;\n import java.sql.PreparedStatement;\n import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.HashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n import net.AbstractMaplePacketHandler;\n-import client.inventory.manipulator.MapleInventoryManipulator;\n+import net.server.Server;\n+import server.CashShop;\n+import server.MapleItemInformationProvider;\n import tools.DatabaseConnection;\n+import tools.FilePrinter;\n import tools.MaplePacketCreator;\n+import tools.Pair;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n /**\n  *\n  * @author Penguins (Acrylic)\n+ * @author Ronan (HeavenMS)\n  */\n public final class CouponCodeHandler extends AbstractMaplePacketHandler {\n-    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        slea.skip(2);\n-        String code = slea.readMapleAsciiString();\n-        boolean validcode = false;\n-        int type = -1;\n-        int item = -1;\n-        validcode = getNXCodeValid(code.toUpperCase(), validcode);\n-        if (validcode) {\n-            type = getNXCode(code, \"type\");\n-            item = getNXCode(code, \"item\");\n-            if (type != 5) {\n-                try {\n-                    Connection con = DatabaseConnection.getConnection();\n-                    PreparedStatement ps = con.prepareStatement(\"UPDATE nxcode SET `valid` = 0 WHERE code = \" + code);\n-                    ps.executeUpdate();\n-                    ps.close();\n-                    ps = con.prepareStatement(\"UPDATE nxcode SET `user` = ? WHERE code = ?\");\n-                    ps.setString(1, c.getPlayer().getName());\n-                    ps.setString(2, code);\n-                    ps.executeUpdate();\n-                    ps.close();\n-                    con.close();\n-                } catch (SQLException e) {\n-                    e.printStackTrace();\n+    \n+    private static List<Pair<Integer, Pair<Integer, Integer>>> getNXCodeItems(MapleCharacter chr, Connection con, int codeid) throws SQLException {\n+        Map<Integer, Integer> couponItems = new HashMap<>();\n+        Map<Integer, Integer> couponPoints = new HashMap<>(5);\n+        \n+        PreparedStatement ps = con.prepareStatement(\"SELECT * FROM nxcode_items WHERE codeid = ?\");\n+        ps.setInt(1, codeid);\n+\n+        ResultSet rs = ps.executeQuery();\n+        while (rs.next()) {\n+            int type = rs.getInt(\"type\"), item = rs.getInt(\"item\");\n+            \n+            if (type < 5) {\n+                Integer i = couponPoints.get(type);\n+                if (i != null) {\n+                    couponPoints.put(type, i + item);\n+                } else {\n+                    couponPoints.put(type, item);\n+                }\n+            } else {\n+                int quantity = rs.getInt(\"quantity\");\n+                \n+                Integer i = couponItems.get(item);\n+                if (i != null) {\n+                    couponItems.put(item, i + quantity);\n+                } else {\n+                    couponItems.put(item, quantity);\n                 }\n             }\n-            switch (type) {\n-                case 0:\n-                case 1:\n-                case 2:\n-                    c.getPlayer().getCashShop().gainCash(type, item);\n-                    break;\n-                case 3:\n-                    c.getPlayer().getCashShop().gainCash(0, item);\n-                    c.getPlayer().getCashShop().gainCash(2, (item / 5000));\n-                    break;\n-                case 4:\n-                    MapleInventoryManipulator.addById(c, item, (short) 1, null, -1, -1);\n-                    c.announce(MaplePacketCreator.showCouponRedeemedItem(item));\n-                    break;\n-                case 5:\n-                    c.getPlayer().getCashShop().gainCash(0, item);\n-                    break;\n+        }\n+        \n+        rs.close();\n+        ps.close();\n+        \n+        List<Pair<Integer, Pair<Integer, Integer>>> ret = new LinkedList<>();\n+        if (!couponItems.isEmpty()) {\n+            for (Entry<Integer, Integer> e : couponItems.entrySet()) {\n+                int item = e.getKey(), qty = e.getValue();\n+                \n+                if (MapleItemInformationProvider.getInstance().getName(item) == null) {\n+                    item = 4000000;\n+                    qty = 1;\n+                    \n+                    FilePrinter.printError(FilePrinter.UNHANDLED_EVENT, \"Error trying to redeem itemid \" + item + \" from codeid \" + codeid + \".\");\n+                }\n+                \n+                if (!chr.canHold(item, qty)) {\n+                    return null;\n+                }\n+                \n+                ret.add(new Pair<>(5, new Pair<>(item, qty)));\n             }\n-            c.announce(MaplePacketCreator.showCash(c.getPlayer()));\n-        } else {\n-            //c.announce(MaplePacketCreator.wrongCouponCode());\n         }\n-        c.announce(MaplePacketCreator.enableCSUse());\n+        \n+        if (!couponPoints.isEmpty()) {\n+            for (Entry<Integer, Integer> e : couponPoints.entrySet()) {\n+                ret.add(new Pair<>(e.getKey(), new Pair<>(e.getValue(), 777)));\n+            }\n+        }\n+        \n+        return ret;\n     }\n-\n-    private int getNXCode(String code, String type) {\n-        int item = -1;\n+    \n+    private static Pair<Integer, List<Pair<Integer, Pair<Integer, Integer>>>> getNXCodeResult(MapleCharacter chr, String code) {\n+        MapleClient c = chr.getClient();\n+        List<Pair<Integer, Pair<Integer, Integer>>> ret = new LinkedList<>();\n         try {\n+            if (!c.attemptCsCoupon()) {\n+                return new Pair<>(-5, null);\n+            }\n+            \n             Connection con = DatabaseConnection.getConnection();\n-            PreparedStatement ps = con.prepareStatement(\"SELECT `\" + type + \"` FROM nxcode WHERE code = ?\");\n+            PreparedStatement ps = con.prepareStatement(\"SELECT * FROM nxcode WHERE code = ?\");\n             ps.setString(1, code);\n+            \n             ResultSet rs = ps.executeQuery();\n-            while (rs.next()) {\n-                item = rs.getInt(type);\n+            if (!rs.next()) {\n+                return new Pair<>(-1, null);\n+            }\n+            \n+            if (rs.getString(\"retriever\") != null) {\n+                return new Pair<>(-2, null);\n+            }\n+            \n+            if (rs.getLong(\"expiration\") < Server.getInstance().getCurrentTime()) {\n+                return new Pair<>(-3, null);\n             }\n+            \n+            int codeid = rs.getInt(\"id\");\n             rs.close();\n+            ps.close();\n+            \n+            ret = getNXCodeItems(chr, con, codeid);\n+            if (ret == null) {\n+                return new Pair<>(-4, null);\n+            }\n+            \n+            ps = con.prepareStatement(\"UPDATE nxcode SET retriever = ? WHERE code = ?\");\n+            ps.setString(1, chr.getName());\n+            ps.setString(2, code);\n+            ps.executeUpdate();\n+            \n             ps.close();\n             con.close();\n         } catch (SQLException ex) {\n             ex.printStackTrace();\n         }\n-        return item;\n+        \n+        c.resetCsCoupon();\n+        return new Pair<>(0, ret);\n     }\n+    \n+    private static int parseCouponResult(int res) {\n+        switch (res) {\n+            case -1:\n+                return 0xB0;\n+                \n+            case -2:\n+                return 0xB3;\n+            \n+            case -3:\n+                return 0xB2;\n+            \n+            case -4:\n+                return 0xBB;\n+                \n+            default:\n+                return 0xB1;\n+        }\n+    }\n+    \n+    @Override\n+    public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n+        slea.skip(2);\n+        String code = slea.readMapleAsciiString();\n+        \n+        if (c.tryacquireClient()) {\n+            try {\n+                Pair<Integer, List<Pair<Integer, Pair<Integer, Integer>>>> codeRes = getNXCodeResult(c.getPlayer(), code.toUpperCase());\n+                int type = codeRes.getLeft();\n+                if (type < 0) {\n+                    c.announce(MaplePacketCreator.showCashShopMessage((byte) parseCouponResult(type)));\n+                } else {\n+                    List<Item> couponPackage = new LinkedList<>();\n \n-    private boolean getNXCodeValid(String code, boolean validcode) {\n-        try {\n-            Connection con = DatabaseConnection.getConnection();\n-            PreparedStatement ps = con.prepareStatement(\"SELECT `valid` FROM nxcode WHERE code = ?\");\n-            ps.setString(1, code);\n-            ResultSet rs = ps.executeQuery();\n-            while (rs.next()) {\n-                validcode = rs.getInt(\"valid\") != 0;\n+                    for (Pair<Integer, Pair<Integer, Integer>> p : codeRes.getRight()) {\n+                        type = p.getLeft();\n+                        int item = p.getRight().getLeft();\n+\n+                        CashShop cs = c.getPlayer().getCashShop();\n+                        switch (type) {\n+                            case 0:\n+                            case 4:\n+                                cs.gainCash(1, item);   //nxCredit\n+                                break;\n+                            case 1:\n+                                cs.gainCash(2, item);   //maplePoint\n+                                break;\n+                            case 2:\n+                                cs.gainCash(4, item);   //nxPrepaid\n+                                break;\n+                            case 3:\n+                                cs.gainCash(1, item);\n+                                cs.gainCash(4, (item / 5000));\n+                                break;\n+\n+                            default:\n+                                short qty = p.getRight().getRight().shortValue();\n+                                if (MapleItemInformationProvider.getInstance().isCash(item)) {\n+                                    Item it = CashShop.generateCouponItem(item, qty);\n+\n+                                    cs.addToInventory(it);\n+                                    couponPackage.add(it);\n+                                } else {\n+                                    MapleInventoryManipulator.addById(c, item, qty, \"\", -1);\n+                                }\n+\n+                                //c.announce(MaplePacketCreator.showCouponRedeemedItem(item));\n+                                break;\n+                        }\n+                    }\n+\n+                    if (!couponPackage.isEmpty()) {\n+                        c.announce(MaplePacketCreator.showBoughtCashPackage(couponPackage, c.getAccID()));\n+                    } else {\n+                        c.announce(MaplePacketCreator.showBoughtQuestItem(0));\n+                    }\n+\n+                    c.enableCSActions();\n+                }\n+            } finally {\n+                c.releaseClient();\n             }\n-            rs.close();\n-            ps.close();\n-            con.close();\n-        } catch (SQLException ex) {\n-            ex.printStackTrace();\n         }\n-        return validcode;\n     }\n }"}, {"sha": "116530e2243b7c882803b3e68a64abd34b3b7d7e", "filename": "src/net/server/channel/handlers/EnterMTSHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/EnterMTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/EnterMTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterMTSHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -111,7 +111,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 ex.printStackTrace();\n             }\n             chr.getCashShop().open(true);// xD\n-            c.announce(MaplePacketCreator.enableCSUse());\n+            c.enableCSActions();\n             c.announce(MaplePacketCreator.MTSWantedListingOver(0, 0));\n             c.announce(MaplePacketCreator.showMTSCash(c.getPlayer()));\n             List<MTSItemInfo> items = new ArrayList<>();"}, {"sha": "dd6d0cb577641eeeb24ccbaa0f12de3511a1e518", "filename": "src/net/server/channel/handlers/FaceExpressionHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/FaceExpressionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/FaceExpressionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/FaceExpressionHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -40,13 +40,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n         }\n         \n-        if(c.trylockClient()) {\n+        if(c.tryacquireClient()) {\n             try {   // expecting players never intends to wear the emote 0 (default face, that changes back after 5sec timeout)\n                 if (emote != 0 && chr.isLoggedinWorld()) {\n                     chr.changeFaceExpression(emote);\n                 }\n             } finally {\n-                c.unlockClient();\n+                c.releaseClient();\n             }\n         }\n     }"}, {"sha": "a4da7b00d3df53d3ba562d1428422e554cabcfd5", "filename": "src/net/server/channel/handlers/ItemRewardHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/ItemRewardHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/ItemRewardHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ItemRewardHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -60,7 +60,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     }\n                     MapleInventoryManipulator.addFromDrop(c, item, false);\n                 } else {\n-                    MapleInventoryManipulator.addById(c, reward.itemid, reward.quantity);\n+                    MapleInventoryManipulator.addById(c, reward.itemid, reward.quantity, \"\", -1);\n                 }\n                 MapleInventoryManipulator.removeById(c, MapleInventoryType.USE, itemId, 1, false, false);\n                 if (reward.worldmsg != null) {"}, {"sha": "054e6f72619fe5979e783a298b2efcea81ef8e11", "filename": "src/net/server/channel/handlers/MTSHandler.java", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/MTSHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/MTSHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MTSHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -214,7 +214,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     c.getPlayer().gainMeso(-5000, false);\n                     c.announce(MaplePacketCreator.MTSConfirmSell());\n                     c.announce(getMTS(1, 0, 0));\n-                    c.announce(MaplePacketCreator.enableCSUse());\n+                    c.enableCSActions();\n                     c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));\n                     c.announce(MaplePacketCreator.notYetSoldInv(getNotYetSold(c.getPlayer().getId())));\n                 }\n@@ -240,7 +240,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n                 c.getPlayer().changeTab(tab);\n                 c.getPlayer().changeType(type);\n-                c.announce(MaplePacketCreator.enableCSUse());\n+                c.enableCSActions();\n                 c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));\n                 c.announce(MaplePacketCreator.notYetSoldInv(getNotYetSold(c.getPlayer().getId())));\n             } else if (op == 6) { //search\n@@ -253,7 +253,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 c.getPlayer().changeTab(tab);\n                 c.getPlayer().changeType(type);\n                 c.getPlayer().changeCI(ci);\n-                c.announce(MaplePacketCreator.enableCSUse());\n+                c.enableCSActions();\n                 c.announce(MaplePacketCreator.enableActions());\n                 c.announce(getMTSSearch(tab, type, ci, search, c.getPlayer().getCurrentPage()));\n                 c.announce(MaplePacketCreator.showMTSCash(c.getPlayer()));\n@@ -277,7 +277,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 } catch (SQLException e) {\n                     e.printStackTrace();\n                 }\n-                c.announce(MaplePacketCreator.enableCSUse());\n+                c.enableCSActions();\n                 c.announce(getMTS(c.getPlayer().getCurrentTab(), c.getPlayer().getCurrentType(), c.getPlayer().getCurrentPage()));\n                 c.announce(MaplePacketCreator.notYetSoldInv(getNotYetSold(c.getPlayer().getId())));\n                 c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));\n@@ -331,7 +331,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             pse.executeUpdate();\n                         }\n                         MapleInventoryManipulator.addFromDrop(c, i, false);\n-                        c.announce(MaplePacketCreator.enableCSUse());\n+                        c.enableCSActions();\n                         c.announce(getCart(c.getPlayer().getId()));\n                         c.announce(getMTS(c.getPlayer().getCurrentTab(), c.getPlayer().getCurrentType(), c.getPlayer().getCurrentPage()));\n                         c.announce(MaplePacketCreator.MTSConfirmTransfer(i.getQuantity(), i.getPosition()));\n@@ -374,7 +374,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     e.printStackTrace();\n                 }\n                 c.announce(getMTS(c.getPlayer().getCurrentTab(), c.getPlayer().getCurrentType(), c.getPlayer().getCurrentPage()));\n-                c.announce(MaplePacketCreator.enableCSUse());\n+                c.enableCSActions();\n                 c.announce(MaplePacketCreator.enableActions());\n                 c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));\n                 c.announce(MaplePacketCreator.notYetSoldInv(getNotYetSold(c.getPlayer().getId())));\n@@ -393,7 +393,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     e.printStackTrace();\n                 }\n                 c.announce(getCart(c.getPlayer().getId()));\n-                c.announce(MaplePacketCreator.enableCSUse());\n+                c.enableCSActions();\n                 c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));\n                 c.announce(MaplePacketCreator.notYetSoldInv(getNotYetSold(c.getPlayer().getId())));\n             } else if (op == 12) { //put item up for auction\n@@ -445,7 +445,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             pse.executeUpdate();\n                             pse.close();\n                             c.getPlayer().getCashShop().gainCash(4, -price);\n-                            c.announce(MaplePacketCreator.enableCSUse());\n+                            c.enableCSActions();\n                             c.announce(getMTS(c.getPlayer().getCurrentTab(), c.getPlayer().getCurrentType(), c.getPlayer().getCurrentPage()));\n                             c.announce(MaplePacketCreator.MTSConfirmBuy());\n                             c.announce(MaplePacketCreator.showMTSCash(c.getPlayer()));\n@@ -507,7 +507,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                             pse.close();\n                             c.getPlayer().getCashShop().gainCash(4, -price);\n                             c.announce(getCart(c.getPlayer().getId()));\n-                            c.announce(MaplePacketCreator.enableCSUse());\n+                            c.enableCSActions();\n                             c.announce(MaplePacketCreator.MTSConfirmBuy());\n                             c.announce(MaplePacketCreator.showMTSCash(c.getPlayer()));\n                             c.announce(MaplePacketCreator.transferInventory(getTransfer(c.getPlayer().getId())));"}, {"sha": "b2288be8a6182435c04861047d89580e88f049fe", "filename": "src/net/server/channel/handlers/MagicDamageHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/MagicDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/MagicDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MagicDamageHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -39,7 +39,7 @@\n \t@Override\n \tpublic final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n \t\tMapleCharacter chr = c.getPlayer();\n-                chr.setPetLootCd(currentServerTime());\n+                //chr.setPetLootCd(currentServerTime());\n \n \t\t/*long timeElapsed = currentServerTime() - chr.getAutobanManager().getLastSpam(8);\n \t\tif(timeElapsed < 300) {"}, {"sha": "5a1e997e3cafd711defe99913f8c4d68213894fc", "filename": "src/net/server/channel/handlers/PetFoodHandler.java", "status": "modified", "additions": 19, "deletions": 11, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/PetFoodHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/PetFoodHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetFoodHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -23,6 +23,7 @@\n \n import client.MapleCharacter;\n import client.MapleClient;\n+import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import client.inventory.MaplePet;\n import client.autoban.AutobanManager;\n@@ -65,18 +66,25 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         short pos = slea.readShort();\n         int itemId = slea.readInt();\n-        Item use = chr.getInventory(MapleInventoryType.USE).getItem(pos);\n-        if (use == null || (itemId / 10000) != 212 || use.getItemId() != itemId) {\n-            return;\n-        }\n         \n-        c.lockClient();\n-        try {\n-            pet.gainClosenessFullness(chr, (pet.getFullness() <= 75) ? 1 : 0, 30, 1);   // 25+ \"emptyness\" to get +1 closeness\n-        } finally {\n-            c.unlockClient();\n+        if (c.tryacquireClient()) {\n+            try {\n+                MapleInventory useInv = chr.getInventory(MapleInventoryType.USE);\n+                useInv.lockInventory();\n+                try {\n+                    Item use = useInv.getItem(pos);\n+                    if (use == null || (itemId / 10000) != 212 || use.getItemId() != itemId || use.getQuantity() < 1) {\n+                        return;\n+                    }\n+\n+                    pet.gainClosenessFullness(chr, (pet.getFullness() <= 75) ? 1 : 0, 30, 1);   // 25+ \"emptyness\" to get +1 closeness\n+                    MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, pos, (short) 1, false);\n+                } finally {\n+                    useInv.unlockInventory();\n+                }\n+            } finally {\n+                c.releaseClient();\n+            }\n         }\n-        \n-        MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, pos, (short) 1, false);\n     }\n }"}, {"sha": "ae32614516d10d0bbe069f3cf22955a395088512", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 518, "deletions": 463, "changes": 981, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -49,6 +49,7 @@\n /**\n  *\n  * @author Matze\n+ * @author Ronan (concurrency safety & reviewed minigames)\n  */\n public final class PlayerInteractionHandler extends AbstractMaplePacketHandler {\n     public enum Action {\n@@ -109,7 +110,7 @@ public byte getCode() {\n         }\n     }\n \n-    private static int estabilishMiniroomStatus(MapleCharacter chr, boolean isMinigame) {\n+    private static int establishMiniroomStatus(MapleCharacter chr, boolean isMinigame) {\n         if (isMinigame && FieldLimit.CANNOTMINIGAME.check(chr.getMap().getFieldLimit())) {\n             return 11;\n         }\n@@ -127,510 +128,564 @@ private static int estabilishMiniroomStatus(MapleCharacter chr, boolean isMiniga\n     \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-        byte mode = slea.readByte();\n-        final MapleCharacter chr = c.getPlayer();\n+        if (!c.tryacquireClient()) {    // thanks GabrielSin for pointing dupes within player interactions\n+            c.announce(MaplePacketCreator.enableActions());\n+            return;\n+        }\n         \n-        if (mode == Action.CREATE.getCode()) {\n-            if(!chr.isAlive()) {    // thanks GabrielSin for pointing this\n-                chr.getClient().announce(MaplePacketCreator.getMiniRoomError(4));\n-                return;\n-            }\n-            \n-            byte createType = slea.readByte();\n-            if (createType == 3) {// trade\n-                MapleTrade.startTrade(chr);\n-            } else if (createType == 1) { // omok mini game\n-                int status = estabilishMiniroomStatus(chr, true);\n-                if (status > 0) {\n-                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n-                    return;\n-                }\n-                \n-                String desc = slea.readMapleAsciiString();\n-                int type = slea.readByte();\n-                String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n-                \n-                MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n-                chr.setMiniGame(game);\n-                game.setPieceType(type);\n-                game.setGameType(MiniGameType.OMOK);\n-                chr.getMap().addMapObject(game);\n-                chr.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(chr, 1, 0));\n-                game.sendOmok(c, type);\n-            } else if (createType == 2) { // matchcard\n-                int status = estabilishMiniroomStatus(chr, true);\n-                if (status > 0) {\n-                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n-                    return;\n-                }\n-                \n-                String desc = slea.readMapleAsciiString();\n-                int type = slea.readByte();\n-                String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n-                \n-                MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n-                game.setPieceType(type);\n-                if (type == 0) {\n-                    game.setMatchesToWin(6);\n-                } else if (type == 1) {\n-                    game.setMatchesToWin(10);\n-                } else if (type == 2) {\n-                    game.setMatchesToWin(15);\n-                }\n-                game.setGameType(MiniGameType.MATCH_CARD);\n-                chr.setMiniGame(game);\n-                chr.getMap().addMapObject(game);\n-                chr.getMap().broadcastMessage(MaplePacketCreator.addMatchCardBox(chr, 1, 0));\n-                game.sendMatchCard(c, type);\n-            } else if (createType == 4 || createType == 5) { // shop\n-                if(!GameConstants.isFreeMarketRoom(chr.getMapId())) {\n-                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(15));\n+        try {\n+            byte mode = slea.readByte();\n+            final MapleCharacter chr = c.getPlayer();\n+\n+            if (mode == Action.CREATE.getCode()) {\n+                if(!chr.isAlive()) {    // thanks GabrielSin for pointing this\n+                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(4));\n                     return;\n                 }\n-                \n-                int status = estabilishMiniroomStatus(chr, false);\n-                if (status > 0) {\n-                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n-                    return;\n+\n+                byte createType = slea.readByte();\n+                if (createType == 3) {// trade\n+                    MapleTrade.startTrade(chr);\n+                } else if (createType == 1) { // omok mini game\n+                    int status = establishMiniroomStatus(chr, true);\n+                    if (status > 0) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n+                        return;\n+                    }\n+\n+                    String desc = slea.readMapleAsciiString();\n+                    String pw;\n+\n+                    if (slea.readByte() != 0) {\n+                        pw = slea.readMapleAsciiString();\n+                    } else {\n+                        pw = \"\";\n+                    }\n+\n+                    int type = slea.readByte();\n+                    if (type > 11) {\n+                        type = 11;\n+                    } else if (type < 0) {\n+                        type = 0;\n+                    }\n+                    if (!chr.haveItem(4080000 + type)) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(6));\n+                        return;\n+                    }\n+\n+                    MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n+                    chr.setMiniGame(game);\n+                    game.setPieceType(type);\n+                    game.setGameType(MiniGameType.OMOK);\n+                    chr.getMap().addMapObject(game);\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(chr, 1, 0));\n+                    game.sendOmok(c, type);\n+                } else if (createType == 2) { // matchcard\n+                    int status = establishMiniroomStatus(chr, true);\n+                    if (status > 0) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n+                        return;\n+                    }\n+\n+                    String desc = slea.readMapleAsciiString();\n+                    String pw;\n+\n+                    if (slea.readByte() != 0) {\n+                        pw = slea.readMapleAsciiString();\n+                    } else {\n+                        pw = \"\";\n+                    }\n+\n+                    int type = slea.readByte();\n+                    if (type > 2) {\n+                        type = 2;\n+                    } else if (type < 0) {\n+                        type = 0;\n+                    }\n+                    if (!chr.haveItem(4080100)) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(6));\n+                        return;\n+                    }\n+\n+                    MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n+                    game.setPieceType(type);\n+                    if (type == 0) {\n+                        game.setMatchesToWin(6);\n+                    } else if (type == 1) {\n+                        game.setMatchesToWin(10);\n+                    } else if (type == 2) {\n+                        game.setMatchesToWin(15);\n+                    }\n+                    game.setGameType(MiniGameType.MATCH_CARD);\n+                    chr.setMiniGame(game);\n+                    chr.getMap().addMapObject(game);\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.addMatchCardBox(chr, 1, 0));\n+                    game.sendMatchCard(c, type);\n+                } else if (createType == 4 || createType == 5) { // shop\n+                    if(!GameConstants.isFreeMarketRoom(chr.getMapId())) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(15));\n+                        return;\n+                    }\n+\n+                    int status = establishMiniroomStatus(chr, false);\n+                    if (status > 0) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(status));\n+                        return;\n+                    }\n+\n+                    String desc = slea.readMapleAsciiString();\n+                    slea.skip(3);\n+                    int itemId = slea.readInt();\n+                    if (chr.getInventory(MapleInventoryType.CASH).countById(itemId) < 1) {\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(6));\n+                        return;\n+                    }\n+\n+                    if (ItemConstants.isPlayerShop(itemId)) {\n+                        MaplePlayerShop shop = new MaplePlayerShop(chr, desc, itemId);\n+                        chr.setPlayerShop(shop);\n+                        chr.getMap().addMapObject(shop);\n+                        shop.sendShop(c);\n+                        c.getWorldServer().registerPlayerShop(shop);\n+                        //c.announce(MaplePacketCreator.getPlayerShopRemoveVisitor(1));\n+                    } else if (ItemConstants.isHiredMerchant(itemId)) {\n+                        MapleHiredMerchant merchant = new MapleHiredMerchant(chr, desc, itemId);\n+                        chr.setHiredMerchant(merchant);\n+                        c.getWorldServer().registerHiredMerchant(merchant);\n+                        chr.getClient().getChannelServer().addHiredMerchant(chr.getId(), merchant);\n+                        chr.announce(MaplePacketCreator.getHiredMerchant(chr, merchant, true));\n+                    }\n                 }\n-                \n-                String desc = slea.readMapleAsciiString();\n-                slea.skip(3);\n-                int itemId = slea.readInt();\n-                if (chr.getInventory(MapleInventoryType.CASH).countById(itemId) < 1) {\n-                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(6));\n+            } else if (mode == Action.INVITE.getCode()) {\n+                int otherPlayer = slea.readInt();\n+                if (chr.getId() == chr.getMap().getCharacterById(otherPlayer).getId()) {\n                     return;\n                 }\n-                \n-                if (ItemConstants.isPlayerShop(itemId)) {\n-                    MaplePlayerShop shop = new MaplePlayerShop(chr, desc, itemId);\n-                    chr.setPlayerShop(shop);\n-                    chr.getMap().addMapObject(shop);\n-                    shop.sendShop(c);\n-                    c.getWorldServer().registerPlayerShop(shop);\n-                    //c.announce(MaplePacketCreator.getPlayerShopRemoveVisitor(1));\n-                } else if (ItemConstants.isHiredMerchant(itemId)) {\n-                    MapleHiredMerchant merchant = new MapleHiredMerchant(chr, desc, itemId);\n-                    chr.setHiredMerchant(merchant);\n-                    c.getWorldServer().registerHiredMerchant(merchant);\n-                    chr.getClient().getChannelServer().addHiredMerchant(chr.getId(), merchant);\n-                    chr.announce(MaplePacketCreator.getHiredMerchant(chr, merchant, true));\n-                }\n-            }\n-        } else if (mode == Action.INVITE.getCode()) {\n-            int otherPlayer = slea.readInt();\n-            if (chr.getId() == chr.getMap().getCharacterById(otherPlayer).getId()) {\n-            \treturn;\n-            }\n-            MapleTrade.inviteTrade(chr, chr.getMap().getCharacterById(otherPlayer));\n-        } else if (mode == Action.DECLINE.getCode()) {\n-            MapleTrade.declineTrade(chr);\n-        } else if (mode == Action.VISIT.getCode()) {\n-            if (chr.getTrade() != null && chr.getTrade().getPartner() != null) {\n-            \tif (!chr.getTrade().isFullTrade() && !chr.getTrade().getPartner().isFullTrade()) {\n-            \t\tMapleTrade.visitTrade(chr, chr.getTrade().getPartner().getChr());\n-            \t} else {\n-            \t\tchr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n-            \t\treturn;\n-            \t}\n-            } else {\n-                if (isTradeOpen(chr)) return;\n-                \n-                int oid = slea.readInt();\n-                MapleMapObject ob = chr.getMap().getMapObject(oid);\n-                if (ob instanceof MaplePlayerShop) {\n-                    MaplePlayerShop shop = (MaplePlayerShop) ob;\n-                    shop.visitShop(chr);\n-                } else if (ob instanceof MapleMiniGame) {\n-                    slea.skip(1);\n-                    String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n-                    \n-                    MapleMiniGame game = (MapleMiniGame) ob;\n-                    if(game.checkPassword(pw)) {\n-                        if (game.hasFreeSlot() && !game.isVisitor(chr)) {\n-                            game.addVisitor(chr);\n-                            chr.setMiniGame(game);\n-                            switch (game.getGameType()) {\n-                                case OMOK:\n-                                    game.sendOmok(c, game.getPieceType());\n-                                    break;\n-                                case MATCH_CARD:\n-                                    game.sendMatchCard(c, game.getPieceType());\n-                                    break;\n+                MapleTrade.inviteTrade(chr, chr.getMap().getCharacterById(otherPlayer));\n+            } else if (mode == Action.DECLINE.getCode()) {\n+                MapleTrade.declineTrade(chr);\n+            } else if (mode == Action.VISIT.getCode()) {\n+                if (chr.getTrade() != null && chr.getTrade().getPartner() != null) {\n+                    if (!chr.getTrade().isFullTrade() && !chr.getTrade().getPartner().isFullTrade()) {\n+                            MapleTrade.visitTrade(chr, chr.getTrade().getPartner().getChr());\n+                    } else {\n+                            chr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n+                            return;\n+                    }\n+                } else {\n+                    if (isTradeOpen(chr)) return;\n+\n+                    int oid = slea.readInt();\n+                    MapleMapObject ob = chr.getMap().getMapObject(oid);\n+                    if (ob instanceof MaplePlayerShop) {\n+                        MaplePlayerShop shop = (MaplePlayerShop) ob;\n+                        shop.visitShop(chr);\n+                    } else if (ob instanceof MapleMiniGame) {\n+                        slea.skip(1);\n+                        String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n+\n+                        MapleMiniGame game = (MapleMiniGame) ob;\n+                        if(game.checkPassword(pw)) {\n+                            if (game.hasFreeSlot() && !game.isVisitor(chr)) {\n+                                game.addVisitor(chr);\n+                                chr.setMiniGame(game);\n+                                switch (game.getGameType()) {\n+                                    case OMOK:\n+                                        game.sendOmok(c, game.getPieceType());\n+                                        break;\n+                                    case MATCH_CARD:\n+                                        game.sendMatchCard(c, game.getPieceType());\n+                                        break;\n+                                }\n+                            } else {\n+                                chr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n                             }\n                         } else {\n-                            chr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n+                            chr.getClient().announce(MaplePacketCreator.getMiniRoomError(22));\n                         }\n-                    } else {\n-                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(22));\n+                    } else if (ob instanceof MapleHiredMerchant && chr.getHiredMerchant() == null) {\n+                        MapleHiredMerchant merchant = (MapleHiredMerchant) ob;\n+                        merchant.visitShop(chr);\n                     }\n-                } else if (ob instanceof MapleHiredMerchant && chr.getHiredMerchant() == null) {\n-                    MapleHiredMerchant merchant = (MapleHiredMerchant) ob;\n-                    merchant.visitShop(chr);\n                 }\n-            }\n-        } else if (mode == Action.CHAT.getCode()) { // chat lol\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (chr.getTrade() != null) {\n-                chr.getTrade().chat(slea.readMapleAsciiString());\n-            } else if (chr.getPlayerShop() != null) { //mini game\n+            } else if (mode == Action.CHAT.getCode()) { // chat lol\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (chr.getTrade() != null) {\n+                    chr.getTrade().chat(slea.readMapleAsciiString());\n+                } else if (chr.getPlayerShop() != null) { //mini game\n+                    MaplePlayerShop shop = chr.getPlayerShop();\n+                    if (shop != null) {\n+                        shop.chat(c, slea.readMapleAsciiString());\n+                    }\n+                } else if (chr.getMiniGame() != null) {\n+                    MapleMiniGame game = chr.getMiniGame();\n+                    if (game != null) {\n+                        game.chat(c, slea.readMapleAsciiString());\n+                    }\n+                } else if (merchant != null) {\n+                    merchant.sendMessage(chr, slea.readMapleAsciiString());\n+                }\n+            } else if (mode == Action.EXIT.getCode()) {\n+                if (chr.getTrade() != null) {\n+                    MapleTrade.cancelTrade(chr);\n+                } else {\n+                    chr.closePlayerShop();\n+                    chr.closeMiniGame();\n+                    chr.closeHiredMerchant(true);\n+                }\n+            } else if (mode == Action.OPEN.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n                 MaplePlayerShop shop = chr.getPlayerShop();\n-                if (shop != null) {\n-                    shop.chat(c, slea.readMapleAsciiString());\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (shop != null && shop.isOwner(chr)) {\n+                    slea.readByte();//01\n+\n+                    if(ServerConstants.USE_ERASE_PERMIT_ON_OPENSHOP) {\n+                        try {\n+                            MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, shop.getItemId(), 1, true, false);\n+                        } catch(RuntimeException re) {} // fella does not have a player shop permit...\n+                    }\n+\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.updatePlayerShopBox(shop));\n+                    shop.setOpen(true);\n+                } else if (merchant != null && merchant.isOwner(chr)) {\n+                    chr.setHasMerchant(true);\n+                    merchant.setOpen(true);\n+                    chr.getMap().addMapObject(merchant);\n+                    chr.setHiredMerchant(null);\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.spawnHiredMerchantBox(merchant));\n+                    slea.readByte();\n                 }\n-            } else if (chr.getMiniGame() != null) {\n+            } else if (mode == Action.READY.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n+                game.broadcast(MaplePacketCreator.getMiniGameReady(game));\n+            } else if (mode == Action.UN_READY.getCode()) {\n                 MapleMiniGame game = chr.getMiniGame();\n-                if (game != null) {\n-                    game.chat(c, slea.readMapleAsciiString());\n+                game.broadcast(MaplePacketCreator.getMiniGameUnReady(game));\n+            } else if (mode == Action.START.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n+                if (game.getGameType().equals(MiniGameType.OMOK)) {\n+                    game.minigameMatchStarted();\n+                    game.broadcast(MaplePacketCreator.getMiniGameStart(game, game.getLoser()));\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(game.getOwner(), 2, 1));\n+                } else if (game.getGameType().equals(MiniGameType.MATCH_CARD)) {\n+                    game.minigameMatchStarted();\n+                    game.shuffleList();\n+                    game.broadcast(MaplePacketCreator.getMatchCardStart(game, game.getLoser()));\n+                    chr.getMap().broadcastMessage(MaplePacketCreator.addMatchCardBox(game.getOwner(), 2, 1));\n                 }\n-            } else if (merchant != null) {\n-                merchant.sendMessage(chr, slea.readMapleAsciiString());\n-            }\n-        } else if (mode == Action.EXIT.getCode()) {\n-            if (chr.getTrade() != null) {\n-                MapleTrade.cancelTrade(chr);\n-            } else {\n-                chr.closePlayerShop();\n-                chr.closeMiniGame();\n-                chr.closeHiredMerchant(true);\n-            }\n-        } else if (mode == Action.OPEN.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MaplePlayerShop shop = chr.getPlayerShop();\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (shop != null && shop.isOwner(chr)) {\n-                slea.readByte();//01\n-                \n-                if(ServerConstants.USE_ERASE_PERMIT_ON_OPENSHOP) {\n-                    try {\n-                        MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, shop.getItemId(), 1, true, false);\n-                    } catch(RuntimeException re) {} // fella does not have a player shop permit...\n-                }\n-                \n-                chr.getMap().broadcastMessage(MaplePacketCreator.updatePlayerShopBox(shop));\n-                shop.setOpen(true);\n-            } else if (merchant != null && merchant.isOwner(chr)) {\n-                chr.setHasMerchant(true);\n-                merchant.setOpen(true);\n-                chr.getMap().addMapObject(merchant);\n-                chr.setHiredMerchant(null);\n-                chr.getMap().broadcastMessage(MaplePacketCreator.spawnHiredMerchantBox(merchant));\n-                slea.readByte();\n-            }\n-        } else if (mode == Action.READY.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            game.broadcast(MaplePacketCreator.getMiniGameReady(game));\n-        } else if (mode == Action.UN_READY.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            game.broadcast(MaplePacketCreator.getMiniGameUnReady(game));\n-        } else if (mode == Action.START.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            if (game.getGameType().equals(\"omok\")) {\n-                game.broadcast(MaplePacketCreator.getMiniGameStart(game, game.getLoser()));\n-                chr.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(game.getOwner(), 2, 1));\n-            }\n-            if (game.getGameType().equals(\"matchcard\")) {\n-                game.shuffleList();\n-                game.broadcast(MaplePacketCreator.getMatchCardStart(game, game.getLoser()));\n-                chr.getMap().broadcastMessage(MaplePacketCreator.addMatchCardBox(game.getOwner(), 2, 1));\n-            }\n-        } else if (mode == Action.GIVE_UP.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            if (game.getGameType().equals(\"omok\")) {\n-                if (game.isOwner(chr)) {\n-                    game.broadcast(MaplePacketCreator.getMiniGameOwnerForfeit(game));\n-                } else {\n-                    game.broadcast(MaplePacketCreator.getMiniGameVisitorForfeit(game));\n+            } else if (mode == Action.GIVE_UP.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n+                if (game.getGameType().equals(MiniGameType.OMOK)) {\n+                    if (game.isOwner(chr)) {\n+                        game.minigameMatchVisitorWins(true);\n+                    } else {\n+                        game.minigameMatchOwnerWins(true);\n+                    }\n+                } else if (game.getGameType().equals(MiniGameType.MATCH_CARD)) {\n+                    if (game.isOwner(chr)) {\n+                        game.minigameMatchVisitorWins(true);\n+                    } else {\n+                        game.minigameMatchOwnerWins(true);\n+                    }\n                 }\n-            }\n-            if (game.getGameType().equals(\"matchcard\")) {\n-                if (game.isOwner(chr)) {\n-                    game.broadcast(MaplePacketCreator.getMatchCardVisitorWin(game));\n-                } else {\n-                    game.broadcast(MaplePacketCreator.getMatchCardOwnerWin(game));\n+            } else if (mode == Action.REQUEST_TIE.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n+                if (!game.isTieDenied(chr)) {\n+                    if (game.isOwner(chr)) {\n+                        game.broadcastToVisitor(MaplePacketCreator.getMiniGameRequestTie(game));\n+                    } else {\n+                        game.broadcastToOwner(MaplePacketCreator.getMiniGameRequestTie(game));\n+                    }\n                 }\n-            }\n-        } else if (mode == Action.REQUEST_TIE.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            if (game.isOwner(chr)) {\n-                game.broadcastToVisitor(MaplePacketCreator.getMiniGameRequestTie(game));\n-            } else {\n-                game.getOwner().getClient().announce(MaplePacketCreator.getMiniGameRequestTie(game));\n-            }\n-        } else if (mode == Action.ANSWER_TIE.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            slea.readByte();\n-            if (game.getGameType().equals(\"omok\")) {\n-                game.broadcast(MaplePacketCreator.getMiniGameTie(game));\n-            }\n-            if (game.getGameType().equals(\"matchcard\")) {\n-                game.broadcast(MaplePacketCreator.getMatchCardTie(game));\n-            }\n-        } else if (mode == Action.SKIP.getCode()) {\n-            MapleMiniGame game = chr.getMiniGame();\n-            if (game.isOwner(chr)) {\n-                game.broadcast(MaplePacketCreator.getMiniGameSkipOwner(game));\n-            } else {\n-                game.broadcast(MaplePacketCreator.getMiniGameSkipVisitor(game));\n-            }\n-        } else if (mode == Action.MOVE_OMOK.getCode()) {\n-            int x = slea.readInt(); // x point\n-            int y = slea.readInt(); // y point\n-            int type = slea.readByte(); // piece ( 1 or 2; Owner has one piece, visitor has another, it switches every game.)\n-            chr.getMiniGame().setPiece(x, y, type, chr);\n-        } else if (mode == Action.SELECT_CARD.getCode()) {\n-            int turn = slea.readByte(); // 1st turn = 1; 2nd turn = 0\n-            int slot = slea.readByte(); // slot\n-            MapleMiniGame game = chr.getMiniGame();\n-            int firstslot = game.getFirstSlot();\n-            if (turn == 1) {\n-                game.setFirstSlot(slot);\n-                if (game.isOwner(chr)) {\n-                    game.broadcastToVisitor(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, turn));\n+            } else if (mode == Action.ANSWER_TIE.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n+                if (slea.readByte() != 0) {\n+                    game.minigameMatchDraw();\n                 } else {\n-                    game.getOwner().getClient().announce(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, turn));\n+                    game.denyTie(chr);\n+\n+                    if (game.isOwner(chr)) {\n+                        game.broadcastToVisitor(MaplePacketCreator.getMiniGameDenyTie(game));\n+                    } else {\n+                        game.broadcastToOwner(MaplePacketCreator.getMiniGameDenyTie(game));\n+                    }\n                 }\n-            } else if ((game.getCardId(firstslot + 1)) == (game.getCardId(slot + 1))) {\n+            } else if (mode == Action.SKIP.getCode()) {\n+                MapleMiniGame game = chr.getMiniGame();\n                 if (game.isOwner(chr)) {\n-                    game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 2));\n-                    game.setOwnerPoints();\n+                    game.broadcast(MaplePacketCreator.getMiniGameSkipOwner(game));\n                 } else {\n-                    game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 3));\n-                    game.setVisitorPoints();\n+                    game.broadcast(MaplePacketCreator.getMiniGameSkipVisitor(game));\n                 }\n-            } else if (game.isOwner(chr)) {\n-                game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 0));\n-            } else {\n-                game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 1));\n-            }\n-        } else if (mode == Action.SET_MESO.getCode()) {\n-            chr.getTrade().setMeso(slea.readInt());\n-        } else if (mode == Action.SET_ITEMS.getCode()) {\n-            MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-            MapleInventoryType ivType = MapleInventoryType.getByType(slea.readByte());\n-            Item item = chr.getInventory(ivType).getItem(slea.readShort());\n-            short quantity = slea.readShort();\n-            byte targetSlot = slea.readByte();\n-            if (quantity < 1 || quantity > item.getQuantity()) {\n-                c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough quantity of the item.\"));\n-                c.announce(MaplePacketCreator.enableActions());\n-                return;            \t\n-            }\n-            if (chr.getTrade() != null) {\n-                if ((quantity <= item.getQuantity() && quantity >= 0) || ItemConstants.isRechargeable(item.getItemId())) {\n-                    if (ii.isDropRestricted(item.getItemId())) { // ensure that undroppable items do not make it to the trade window\n-                        if (!MapleKarmaManipulator.hasKarmaFlag(item)) {\n-                            c.announce(MaplePacketCreator.serverNotice(1, \"That item is untradeable.\"));\n-                            c.announce(MaplePacketCreator.enableActions());\n-                            return;\n-                        }\n+            } else if (mode == Action.MOVE_OMOK.getCode()) {\n+                int x = slea.readInt(); // x point\n+                int y = slea.readInt(); // y point\n+                int type = slea.readByte(); // piece ( 1 or 2; Owner has one piece, visitor has another, it switches every game.)\n+                chr.getMiniGame().setPiece(x, y, type, chr);\n+            } else if (mode == Action.SELECT_CARD.getCode()) {\n+                int turn = slea.readByte(); // 1st turn = 1; 2nd turn = 0\n+                int slot = slea.readByte(); // slot\n+                MapleMiniGame game = chr.getMiniGame();\n+                int firstslot = game.getFirstSlot();\n+                if (turn == 1) {\n+                    game.setFirstSlot(slot);\n+                    if (game.isOwner(chr)) {\n+                        game.broadcastToVisitor(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, turn));\n+                    } else {\n+                        game.getOwner().getClient().announce(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, turn));\n                     }\n-                    Item tradeItem = item.copy();\n-                    if (ItemConstants.isRechargeable(item.getItemId())) {\n-                        tradeItem.setQuantity(item.getQuantity());\n-                        MapleInventoryManipulator.removeFromSlot(c, ivType, item.getPosition(), item.getQuantity(), true);\n+                } else if ((game.getCardId(firstslot)) == (game.getCardId(slot))) {\n+                    if (game.isOwner(chr)) {\n+                        game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 2));\n+                        game.setOwnerPoints();\n                     } else {\n-                        tradeItem.setQuantity(quantity);\n-                        MapleInventoryManipulator.removeFromSlot(c, ivType, item.getPosition(), quantity, true);\n+                        game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 3));\n+                        game.setVisitorPoints();\n                     }\n-                    tradeItem.setPosition(targetSlot);\n-                    chr.getTrade().addItem(tradeItem);\n+                } else if (game.isOwner(chr)) {\n+                    game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 0));\n+                } else {\n+                    game.broadcast(MaplePacketCreator.getMatchCardSelect(game, turn, slot, firstslot, 1));\n                 }\n-            }\n-        } else if (mode == Action.CONFIRM.getCode()) {\n-            MapleTrade.completeTrade(chr);\n-        } else if (mode == Action.ADD_ITEM.getCode() || mode == Action.PUT_ITEM.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MapleInventoryType ivType = MapleInventoryType.getByType(slea.readByte());\n-            short slot = slea.readShort();\n-            short bundles = slea.readShort();\n-            Item ivItem = chr.getInventory(ivType).getItem(slot);\n-            \n-            if (ivItem == null || ivItem.getFlag() == ItemConstants.UNTRADEABLE) {\n-                c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n-                c.announce(MaplePacketCreator.enableActions());\n-                return;\n-            }\n-            \n-            short perBundle = slea.readShort();\n-            \n-            if (ItemConstants.isRechargeable(ivItem.getItemId())) {\n-                perBundle = 1;\n-                bundles = 1;\n-            } else if (chr.getItemQuantity(ivItem.getItemId(), false) < perBundle * bundles) {\n-                c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n-                c.announce(MaplePacketCreator.enableActions());\n-                return;\n-            }\n-            \n-            int price = slea.readInt();\n-            if (perBundle <= 0 || perBundle * bundles > 2000 || bundles <= 0 || price <= 0 || price > Integer.MAX_VALUE) {\n-            \tAutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with hired merchants.\");\n-            \tFilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" might of possibly packet edited Hired Merchants\\nperBundle: \" + perBundle + \"\\nperBundle * bundles (This multiplied cannot be greater than 2000): \" + perBundle * bundles + \"\\nbundles: \" + bundles + \"\\nprice: \" + price);\n-                return;\n-            }\n-            \n-            if(ServerConstants.USE_ENFORCE_UNMERCHABLE_CASH && MapleItemInformationProvider.getInstance().isCash(ivItem.getItemId())) {\n-                c.announce(MaplePacketCreator.serverNotice(1, \"Cash items are not allowed to be sold on the Player Store.\"));\n-                return;\n-            }\n-            \n-            if (ServerConstants.USE_ENFORCE_UNMERCHABLE_PET && ItemConstants.isPet(ivItem.getItemId())) {\n-                c.announce(MaplePacketCreator.serverNotice(1, \"Pets are not allowed to be sold on the Player Store.\"));\n-                return;\n-            }\n-            \n-            Item sellItem = ivItem.copy();\n-            if(!ItemConstants.isRechargeable(ivItem.getItemId())) {\n-                sellItem.setQuantity(perBundle);\n-            }\n-            \n-            MaplePlayerShopItem shopItem = new MaplePlayerShopItem(sellItem, bundles, price);\n-            MaplePlayerShop shop = chr.getPlayerShop();\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (shop != null && shop.isOwner(chr)) {\n-                if (shop.isOpen()) {\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You can't sell it anymore.\"));\n+            } else if (mode == Action.SET_MESO.getCode()) {\n+                chr.getTrade().setMeso(slea.readInt());\n+            } else if (mode == Action.SET_ITEMS.getCode()) {\n+                MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+                MapleInventoryType ivType = MapleInventoryType.getByType(slea.readByte());\n+                Item item = chr.getInventory(ivType).getItem(slea.readShort());\n+                short quantity = slea.readShort();\n+                byte targetSlot = slea.readByte();\n+\n+                if (item == null) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"Invalid item description.\"));\n+                    c.announce(MaplePacketCreator.enableActions());\n                     return;\n                 }\n-                \n-                shop.addItem(shopItem);\n-                c.announce(MaplePacketCreator.getPlayerShopItemUpdate(shop));\n-            } else if (merchant != null && merchant.isOwner(chr)) {\n-                if (merchant.isOpen()) {\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You can't sell it anymore.\"));\n+\n+                if (quantity < 1 || quantity > item.getQuantity()) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough quantity of the item.\"));\n+                    c.announce(MaplePacketCreator.enableActions());\n                     return;\n                 }\n-                \n-                merchant.addItem(shopItem);\n-                c.announce(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n-            }\n-            if (ItemConstants.isRechargeable(ivItem.getItemId())) {\n-                MapleInventoryManipulator.removeFromSlot(c, ivType, slot, ivItem.getQuantity(), true);\n-            } else {\n-                MapleInventoryManipulator.removeFromSlot(c, ivType, slot, (short) (bundles * perBundle), true);\n-            }\n-        } else if (mode == Action.REMOVE_ITEM.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MaplePlayerShop shop = chr.getPlayerShop();\n-            if (shop != null && shop.isOwner(chr)) {\n-                if (shop.isOpen()) {\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You can't take it with the store open.\"));\n+                if (chr.getTrade() != null) {\n+                    if ((quantity <= item.getQuantity() && quantity >= 0) || ItemConstants.isRechargeable(item.getItemId())) {\n+                        if (ii.isDropRestricted(item.getItemId())) { // ensure that undroppable items do not make it to the trade window\n+                            if (!MapleKarmaManipulator.hasKarmaFlag(item)) {\n+                                c.announce(MaplePacketCreator.serverNotice(1, \"That item is untradeable.\"));\n+                                c.announce(MaplePacketCreator.enableActions());\n+                                return;\n+                            }\n+                        }\n+                        Item tradeItem = item.copy();\n+                        if (ItemConstants.isRechargeable(item.getItemId())) {\n+                            tradeItem.setQuantity(item.getQuantity());\n+                            MapleInventoryManipulator.removeFromSlot(c, ivType, item.getPosition(), item.getQuantity(), true);\n+                        } else {\n+                            tradeItem.setQuantity(quantity);\n+                            MapleInventoryManipulator.removeFromSlot(c, ivType, item.getPosition(), quantity, true);\n+                        }\n+                        tradeItem.setPosition(targetSlot);\n+                        chr.getTrade().addItem(tradeItem);\n+                    }\n+                }\n+            } else if (mode == Action.CONFIRM.getCode()) {\n+                MapleTrade.completeTrade(chr);\n+            } else if (mode == Action.ADD_ITEM.getCode() || mode == Action.PUT_ITEM.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                MapleInventoryType ivType = MapleInventoryType.getByType(slea.readByte());\n+                short slot = slea.readShort();\n+                short bundles = slea.readShort();\n+                Item ivItem = chr.getInventory(ivType).getItem(slot);\n+\n+                if (ivItem == null || ivItem.isUntradeable()) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n+                    c.announce(MaplePacketCreator.enableActions());\n                     return;\n                 }\n-                \n-                int slot = slea.readShort();\n-                if (slot >= shop.getItems().size() || slot < 0) {\n-                    AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a player shop.\");\n-                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n-                    c.disconnect(true, false);\n+\n+                short perBundle = slea.readShort();\n+\n+                if (ItemConstants.isRechargeable(ivItem.getItemId())) {\n+                    perBundle = 1;\n+                    bundles = 1;\n+                } else if (chr.getItemQuantity(ivItem.getItemId(), false) < perBundle * bundles) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n+                    c.announce(MaplePacketCreator.enableActions());\n                     return;\n                 }\n-                \n-                shop.takeItemBack(slot, chr);\n-            }\n-        } else if (mode == Action.MERCHANT_MESO.getCode()) {\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (merchant == null) return;\n-            \n-            merchant.withdrawMesos(chr);\n-        } else if (mode == Action.MERCHANT_ORGANIZE.getCode()) {\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (merchant == null || !merchant.isOwner(chr)) return;\n-            \n-            merchant.withdrawMesos(chr);\n-            merchant.clearInexistentItems();\n-            \n-            if (merchant.getItems().isEmpty()) {\n-                merchant.closeOwnerMerchant(chr);\n-                return;\n-            }\n-            c.announce(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n-\n-        } else if (mode == Action.BUY.getCode() || mode == Action.MERCHANT_BUY.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            int itemid = slea.readByte();\n-            short quantity = slea.readShort();\n-            if (quantity < 1) {\n-                AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant and or player shop.\");\n-            \tFilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to buy item \" + itemid + \" with quantity \" + quantity + \"\\r\\n\");\n-            \tc.disconnect(true, false);\n-            \treturn;\n-            }\n-            MaplePlayerShop shop = chr.getPlayerShop();\n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (shop != null && shop.isVisitor(chr)) {\n-                shop.buy(c, itemid, quantity);\n-                shop.broadcast(MaplePacketCreator.getPlayerShopItemUpdate(shop));\n-            } else if (merchant != null && !merchant.isOwner(chr)) {\n-                merchant.buy(c, itemid, quantity);\n-                merchant.broadcastToVisitorsThreadsafe(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n-            }\n-        } else if (mode == Action.TAKE_ITEM_BACK.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (merchant != null && merchant.isOwner(chr)) {\n-                if (merchant.isOpen()) {\n-                    c.announce(MaplePacketCreator.serverNotice(1, \"You can't take it with the store open.\"));\n+\n+                int price = slea.readInt();\n+                if (perBundle <= 0 || perBundle * bundles > 2000 || bundles <= 0 || price <= 0 || price > Integer.MAX_VALUE) {\n+                    AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with hired merchants.\");\n+                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" might of possibly packet edited Hired Merchants\\nperBundle: \" + perBundle + \"\\nperBundle * bundles (This multiplied cannot be greater than 2000): \" + perBundle * bundles + \"\\nbundles: \" + bundles + \"\\nprice: \" + price);\n+                    return;\n+                }\n+\n+                if(ServerConstants.USE_ENFORCE_UNMERCHABLE_CASH && MapleItemInformationProvider.getInstance().isCash(ivItem.getItemId())) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"Cash items are not allowed to be sold on the Player Store.\"));\n+                    return;\n+                }\n+\n+                if (ServerConstants.USE_ENFORCE_UNMERCHABLE_PET && ItemConstants.isPet(ivItem.getItemId())) {\n+                    c.announce(MaplePacketCreator.serverNotice(1, \"Pets are not allowed to be sold on the Player Store.\"));\n+                    return;\n+                }\n+\n+                Item sellItem = ivItem.copy();\n+                if(!ItemConstants.isRechargeable(ivItem.getItemId())) {\n+                    sellItem.setQuantity(perBundle);\n+                }\n+\n+                MaplePlayerShopItem shopItem = new MaplePlayerShopItem(sellItem, bundles, price);\n+                MaplePlayerShop shop = chr.getPlayerShop();\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (shop != null && shop.isOwner(chr)) {\n+                    if (shop.isOpen()) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You can't sell it anymore.\"));\n+                        return;\n+                    }\n+\n+                    shop.addItem(shopItem);\n+                    c.announce(MaplePacketCreator.getPlayerShopItemUpdate(shop));\n+                } else if (merchant != null && merchant.isOwner(chr)) {\n+                    if (merchant.isOpen()) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You can't sell it anymore.\"));\n+                        return;\n+                    }\n+\n+                    merchant.addItem(shopItem);\n+                    c.announce(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n+                }\n+                if (ItemConstants.isRechargeable(ivItem.getItemId())) {\n+                    MapleInventoryManipulator.removeFromSlot(c, ivType, slot, ivItem.getQuantity(), true);\n+                } else {\n+                    MapleInventoryManipulator.removeFromSlot(c, ivType, slot, (short) (bundles * perBundle), true);\n+                }\n+            } else if (mode == Action.REMOVE_ITEM.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                MaplePlayerShop shop = chr.getPlayerShop();\n+                if (shop != null && shop.isOwner(chr)) {\n+                    if (shop.isOpen()) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You can't take it with the store open.\"));\n+                        return;\n+                    }\n+\n+                    int slot = slea.readShort();\n+                    if (slot >= shop.getItems().size() || slot < 0) {\n+                        AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a player shop.\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n+                        c.disconnect(true, false);\n+                        return;\n+                    }\n+\n+                    shop.takeItemBack(slot, chr);\n+                }\n+            } else if (mode == Action.MERCHANT_MESO.getCode()) {\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (merchant == null) return;\n+\n+                merchant.withdrawMesos(chr);\n+            } else if (mode == Action.MERCHANT_ORGANIZE.getCode()) {\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (merchant == null || !merchant.isOwner(chr)) return;\n+\n+                merchant.withdrawMesos(chr);\n+                merchant.clearInexistentItems();\n+\n+                if (merchant.getItems().isEmpty()) {\n+                    merchant.closeOwnerMerchant(chr);\n                     return;\n                 }\n-                \n-                int slot = slea.readShort();\n-                if (slot >= merchant.getItems().size() || slot < 0) {\n-                    AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant.\");\n-                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n+                c.announce(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n+\n+            } else if (mode == Action.BUY.getCode() || mode == Action.MERCHANT_BUY.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                int itemid = slea.readByte();\n+                short quantity = slea.readShort();\n+                if (quantity < 1) {\n+                    AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant and or player shop.\");\n+                    FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to buy item \" + itemid + \" with quantity \" + quantity + \"\\r\\n\");\n                     c.disconnect(true, false);\n                     return;\n                 }\n-                \n-                merchant.takeItemBack(slot, chr);\n-            }\n-        } else if (mode == Action.CLOSE_MERCHANT.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if (merchant != null) {\n-                merchant.closeOwnerMerchant(chr);\n-            }\n-        } else if (mode == Action.MAINTENANCE_OFF.getCode()) {\n-            if (isTradeOpen(chr)) return;\n-            \n-            MapleHiredMerchant merchant = chr.getHiredMerchant();\n-            if(merchant != null) {\n-                if (merchant.getItems().isEmpty() && merchant.isOwner(chr)) {\n-                    merchant.closeShop(c, false);\n-                    chr.setHasMerchant(false);\n-                }\n-                if (merchant.isOwner(chr)) {\n-                    merchant.clearMessages();\n-                    merchant.setOpen(true);\n+                MaplePlayerShop shop = chr.getPlayerShop();\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (shop != null && shop.isVisitor(chr)) {\n+                    shop.buy(c, itemid, quantity);\n+                    shop.broadcast(MaplePacketCreator.getPlayerShopItemUpdate(shop));\n+                } else if (merchant != null && !merchant.isOwner(chr)) {\n+                    merchant.buy(c, itemid, quantity);\n+                    merchant.broadcastToVisitorsThreadsafe(MaplePacketCreator.updateHiredMerchant(merchant, chr));\n                 }\n-            }\n-            \n-            chr.setHiredMerchant(null);\n-            c.announce(MaplePacketCreator.enableActions());\n-        } else if (mode == Action.BAN_PLAYER.getCode()) {\n-            slea.skip(1);\n-            \n-            MaplePlayerShop shop = chr.getPlayerShop();\n-            if (shop != null && shop.isOwner(chr)) {\n-                shop.banPlayer(slea.readMapleAsciiString());\n-            }\n-        } else if (mode == Action.EXPEL.getCode()) {\n-            MapleMiniGame miniGame = chr.getMiniGame();\n-            if(miniGame != null && miniGame.isOwner(chr)) {\n-                MapleCharacter visitor = miniGame.getVisitor();\n-                \n-                if(visitor != null) {\n-                    visitor.closeMiniGame();\n-                    visitor.announce(MaplePacketCreator.getMiniGameClose(5));\n+            } else if (mode == Action.TAKE_ITEM_BACK.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (merchant != null && merchant.isOwner(chr)) {\n+                    if (merchant.isOpen()) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"You can't take it with the store open.\"));\n+                        return;\n+                    }\n+\n+                    int slot = slea.readShort();\n+                    if (slot >= merchant.getItems().size() || slot < 0) {\n+                        AutobanFactory.PACKET_EDIT.alert(chr, chr.getName() + \" tried to packet edit with a hired merchant.\");\n+                        FilePrinter.printError(FilePrinter.EXPLOITS + chr.getName() + \".txt\", chr.getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n+                        c.disconnect(true, false);\n+                        return;\n+                    }\n+\n+                    merchant.takeItemBack(slot, chr);\n+                }\n+            } else if (mode == Action.CLOSE_MERCHANT.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if (merchant != null) {\n+                    merchant.closeOwnerMerchant(chr);\n+                }\n+            } else if (mode == Action.MAINTENANCE_OFF.getCode()) {\n+                if (isTradeOpen(chr)) return;\n+\n+                MapleHiredMerchant merchant = chr.getHiredMerchant();\n+                if(merchant != null) {\n+                    if (merchant.getItems().isEmpty() && merchant.isOwner(chr)) {\n+                        merchant.closeShop(c, false);\n+                        chr.setHasMerchant(false);\n+                    }\n+                    if (merchant.isOwner(chr)) {\n+                        merchant.clearMessages();\n+                        merchant.setOpen(true);\n+                    }\n+                }\n+\n+                chr.setHiredMerchant(null);\n+                c.announce(MaplePacketCreator.enableActions());\n+            } else if (mode == Action.BAN_PLAYER.getCode()) {\n+                slea.skip(1);\n+\n+                MaplePlayerShop shop = chr.getPlayerShop();\n+                if (shop != null && shop.isOwner(chr)) {\n+                    shop.banPlayer(slea.readMapleAsciiString());\n+                }\n+            } else if (mode == Action.EXPEL.getCode()) {\n+                MapleMiniGame miniGame = chr.getMiniGame();\n+                if(miniGame != null && miniGame.isOwner(chr)) {\n+                    MapleCharacter visitor = miniGame.getVisitor();\n+\n+                    if(visitor != null) {\n+                        visitor.closeMiniGame();\n+                        visitor.announce(MaplePacketCreator.getMiniGameClose(5));\n+                    }\n                 }\n             }\n+        } finally {\n+            c.releaseClient();\n         }\n     }\n     "}, {"sha": "7d89da5ded9ae2437fbc32825bc43e24165f1854", "filename": "src/net/server/channel/handlers/RangedAttackHandler.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/RangedAttackHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/RangedAttackHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RangedAttackHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -51,8 +51,8 @@\n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         MapleCharacter chr = c.getPlayer();\n-        chr.setPetLootCd(currentServerTime());\n-\t\t\n+        //chr.setPetLootCd(currentServerTime());\n+        \n         /*long timeElapsed = currentServerTime() - chr.getAutobanManager().getLastSpam(8);\n         if(timeElapsed < 300) {\n             AutobanFactory.FAST_ATTACK.alert(chr, \"Time: \" + timeElapsed);"}, {"sha": "aa1cf4828b6bd73cae4a76731062c33e290cacd2", "filename": "src/net/server/channel/handlers/RingActionHandler.java", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/RingActionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/RingActionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/RingActionHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -273,20 +273,20 @@ public static void breakMarriageRing(MapleCharacter chr, final int wItemId) {\n     }\n     \n     public static void giveMarriageRings(MapleCharacter player, MapleCharacter partner, int marriageRingId) {\n-        int ringid = MapleRing.createRing(marriageRingId, player, partner);\n+        Pair<Integer, Integer> rings = MapleRing.createRing(marriageRingId, player, partner);\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n \n         Item ringObj = ii.getEquipById(marriageRingId);\n         Equip ringEqp = (Equip) ringObj;\n-        ringEqp.setRingId(ringid);\n-        player.addMarriageRing(MapleRing.loadFromDb(ringid));\n+        ringEqp.setRingId(rings.getLeft());\n+        player.addMarriageRing(MapleRing.loadFromDb(rings.getLeft()));\n         MapleInventoryManipulator.addFromDrop(player.getClient(), ringEqp, false, -1);\n         player.broadcastMarriageMessage();\n \n         ringObj = ii.getEquipById(marriageRingId);\n         ringEqp = (Equip) ringObj;\n-        ringEqp.setRingId(ringid + 1);\n-        partner.addMarriageRing(MapleRing.loadFromDb(ringid + 1));\n+        ringEqp.setRingId(rings.getRight());\n+        partner.addMarriageRing(MapleRing.loadFromDb(rings.getRight()));\n         MapleInventoryManipulator.addFromDrop(partner.getClient(), ringEqp, false, -1);\n         partner.broadcastMarriageMessage();\n     }\n@@ -513,6 +513,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 break;\n         }\n         \n-        c.getSession().write(MaplePacketCreator.enableActions());\n+        c.announce(MaplePacketCreator.enableActions());\n     }\n }"}, {"sha": "be241138b53d7affbdd65f9b8cb45c8ae1bbcc64", "filename": "src/net/server/channel/handlers/TouchingCashShopHandler.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/TouchingCashShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/TouchingCashShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TouchingCashShopHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -28,9 +28,10 @@\n \n /**\n  *\n- * @author Acrylic (Terry Han)\n+ * @author Terry Han (Acrylic)\n  */\n public final class TouchingCashShopHandler extends AbstractMaplePacketHandler {\n+    @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         c.announce(MaplePacketCreator.showCash(c.getPlayer()));\n     }"}, {"sha": "c678d48b190e5275f37cdea380ce652419e9104c", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -276,7 +276,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         if (item == null) //hack\n                         {\n                             return;\n-                        } else if (((item.getFlag() & ItemConstants.UNTRADEABLE) == ItemConstants.UNTRADEABLE) || (ii.isDropRestricted(item.getItemId()) && !MapleKarmaManipulator.hasKarmaFlag(item))) {\n+                        } else if (item.isUntradeable()) {\n                             player.dropMessage(1, \"You cannot trade this item.\");\n                             c.announce(MaplePacketCreator.enableActions());\n                             return;\n@@ -299,7 +299,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     break;\n             }\n             remove(c, itemId);\n-        } else if (itemType == 508) {   // graduation banner, thanks to tmskdl12\n+        } else if (itemType == 508) {   // graduation banner, thanks to tmskdl12. Also, thanks ratency for first pointing lack of Kite handling\n             MapleKite kite = new MapleKite(player, slea.readMapleAsciiString(), itemId);\n             \n             if (!GameConstants.isFreeMarketRoom(player.getMapId())) {\n@@ -517,7 +517,7 @@ public void run() {\n             \n             Equip toScroll = (Equip) eitem;\n             if (toScroll.getUpgradeSlots() < 1) {\n-                c.getSession().write(MaplePacketCreator.getInventoryFull());\n+                c.announce(MaplePacketCreator.getInventoryFull());\n                 return;\n             }\n             \n@@ -527,10 +527,10 @@ public void run() {\n             player.toggleBlockCashShop();\n             \n             final int curlevel = toScroll.getLevel();\n-            c.getSession().write(MaplePacketCreator.sendVegaScroll(0x40));\n+            c.announce(MaplePacketCreator.sendVegaScroll(0x40));\n             \n             final Equip scrolled = (Equip) ii.scrollEquipWithId(toScroll, uitem.getItemId(), false, itemId, player.isGM());\n-            c.getSession().write(MaplePacketCreator.sendVegaScroll(scrolled.getLevel() > curlevel ? 0x41 : 0x43));\n+            c.announce(MaplePacketCreator.sendVegaScroll(scrolled.getLevel() > curlevel ? 0x41 : 0x43));\n             //opcodes 0x42, 0x44: \"this item cannot be used\"; 0x39, 0x45: crashes\n             \n             MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, uSlot, (short) 1, false);\n@@ -555,7 +555,7 @@ public void run() {\n                         player.equipChanged();\n                     }\n \n-                    client.getSession().write(MaplePacketCreator.enableActions());\n+                    client.announce(MaplePacketCreator.enableActions());\n             \t}\n             }, 1000 * 3);\n         } else {"}, {"sha": "2b3989d3e72c5113e916adf248c41de90323824a", "filename": "src/net/server/channel/handlers/UseChairHandler.java", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseChairHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseChairHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseChairHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -24,7 +24,6 @@\n import client.MapleClient;\n import client.inventory.MapleInventoryType;\n import net.AbstractMaplePacketHandler;\n-import tools.MaplePacketCreator;\n import tools.data.input.SeekableLittleEndianAccessor;\n \n public final class UseChairHandler extends AbstractMaplePacketHandler {\n@@ -34,8 +33,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         if (c.getPlayer().getInventory(MapleInventoryType.SETUP).findById(itemId) == null) {\n             return;\n         }\n-        c.getPlayer().setChair(itemId);\n-        c.getPlayer().getMap().broadcastMessage(c.getPlayer(), MaplePacketCreator.showChair(c.getPlayer().getId(), itemId), false);\n-        c.announce(MaplePacketCreator.enableActions());\n+        \n+        c.getPlayer().sitChair(itemId);\n     }\n }"}, {"sha": "c586c8defbacfee5ba1f39d7e283f39da098439b", "filename": "src/net/server/channel/handlers/UseMountFoodHandler.java", "status": "modified", "additions": 28, "deletions": 19, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseMountFoodHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/UseMountFoodHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseMountFoodHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -25,6 +25,7 @@\n import client.MapleCharacter;\n import client.MapleMount;\n import client.inventory.Item;\n+import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import constants.ExpTable;\n import net.AbstractMaplePacketHandler;\n@@ -45,29 +46,37 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         MapleCharacter chr = c.getPlayer();\n         MapleMount mount = chr.getMount();\n-        Item item = chr.getInventory(MapleInventoryType.USE).getItem(pos);\n-        if (item != null && item.getItemId() == itemid && mount != null) {\n-            c.lockClient();\n+        MapleInventory useInv = chr.getInventory(MapleInventoryType.USE);\n+        \n+        if (c.tryacquireClient()) {\n             try {\n-                int curTiredness = mount.getTiredness();\n-                int healedTiredness = Math.min(curTiredness, 30);\n-                \n-                float healedFactor = (float) healedTiredness / 30;\n-                mount.setTiredness(curTiredness - healedTiredness);\n-                \n-                if (healedFactor > 0.0f) {\n-                    mount.setExp(mount.getExp() + (int) Math.ceil(healedFactor * (2 * mount.getLevel() + 6)));\n-                    int level = mount.getLevel();\n-                    boolean levelup = mount.getExp() >= ExpTable.getMountExpNeededForLevel(level) && level < 31;\n-                    if (levelup) {\n-                        mount.setLevel(level + 1);\n+                useInv.lockInventory();\n+                try {\n+                    Item item = useInv.getItem(pos);\n+                    if (item != null && item.getItemId() == itemid && mount != null) {\n+                        int curTiredness = mount.getTiredness();\n+                        int healedTiredness = Math.min(curTiredness, 30);\n+\n+                        float healedFactor = (float) healedTiredness / 30;\n+                        mount.setTiredness(curTiredness - healedTiredness);\n+\n+                        if (healedFactor > 0.0f) {\n+                            mount.setExp(mount.getExp() + (int) Math.ceil(healedFactor * (2 * mount.getLevel() + 6)));\n+                            int level = mount.getLevel();\n+                            boolean levelup = mount.getExp() >= ExpTable.getMountExpNeededForLevel(level) && level < 31;\n+                            if (levelup) {\n+                                mount.setLevel(level + 1);\n+                            }\n+                            chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, levelup));\n+                        }\n+\n+                        MapleInventoryManipulator.removeById(c, MapleInventoryType.USE, itemid, 1, true, false);\n                     }\n-                    chr.getMap().broadcastMessage(MaplePacketCreator.updateMount(chr.getId(), mount, levelup));\n+                } finally {\n+                    useInv.unlockInventory();\n                 }\n-                \n-                MapleInventoryManipulator.removeById(c, MapleInventoryType.USE, itemid, 1, true, false);\n             } finally {\n-                c.unlockClient();\n+                c.releaseClient();\n             }\n         }\n     }"}, {"sha": "02ded226317e64964cebd2b0e18d801f33f015e2", "filename": "src/net/server/channel/handlers/WhisperHandler.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/WhisperHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/channel/handlers/WhisperHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/WhisperHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -49,9 +49,9 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             String recipient = slea.readMapleAsciiString();\n             String text = slea.readMapleAsciiString();\n             MapleCharacter player = c.getChannelServer().getPlayerStorage().getCharacterByName(recipient);\n-\t\t\tif(c.getPlayer().getAutobanManager().getLastSpam(7) + 200 > currentServerTime()) {\n-\t\t\t\treturn;\n-\t\t\t}\n+            if (c.getPlayer().getAutobanManager().getLastSpam(7) + 200 > currentServerTime()) {\n+                return;\n+            }\n             if (text.length() > Byte.MAX_VALUE && !player.isGM()) {\n             \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with whispers.\");\n             \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to send text with length of \" + text.length() + \"\\r\\n\");\n@@ -92,7 +92,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 } else {\n                     c.announce(MaplePacketCreator.getFindReply(victim.getName(), victim.getMap().getId(), 1));\n                 }\n-            } else if (c.getPlayer().gmLevel() > 1) { // not found\n+            } else if (c.getPlayer().isGM()) { // not found\n                 try {\n                     Connection con = DatabaseConnection.getConnection();\n                     PreparedStatement ps = con.prepareStatement(\"SELECT gm FROM characters WHERE name = ?\");"}, {"sha": "a3963ee68194ef55fe1188f427974c4ee40d2df1", "filename": "src/net/server/handlers/login/LoginPasswordHandler.java", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/handlers/login/LoginPasswordHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/net/server/handlers/login/LoginPasswordHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/LoginPasswordHandler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -37,6 +37,9 @@\n import client.MapleClient;\n import java.sql.ResultSet;\n import java.sql.Statement;\n+import java.io.UnsupportedEncodingException;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n \n public final class LoginPasswordHandler implements MaplePacketHandler {\n \n@@ -45,6 +48,11 @@ public boolean validateState(MapleClient c) {\n         return !c.isLoggedIn();\n     }\n \n+    private static String hashpwSHA512(String pwd) throws NoSuchAlgorithmException, UnsupportedEncodingException {\n+        MessageDigest digester = MessageDigest.getInstance(\"SHA-512\");\n+        digester.update(pwd.getBytes(\"UTF-8\"), 0, pwd.length());\n+        return HexTool.toString(digester.digest()).replace(\" \", \"\").toLowerCase();\n+    }\n \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n@@ -65,7 +73,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 con = DatabaseConnection.getConnection();\n                 ps = con.prepareStatement(\"INSERT INTO accounts (name, password, birthday, tempban) VALUES (?, ?, ?, ?);\", Statement.RETURN_GENERATED_KEYS); //Jayd: Added birthday, tempban\n                 ps.setString(1, login);\n-                ps.setString(2, BCrypt.hashpw(pwd, BCrypt.gensalt(12)));\n+                ps.setString(2, ServerConstants.BCRYPT_MIGRATION ? BCrypt.hashpw(pwd, BCrypt.gensalt(12)) : hashpwSHA512(pwd));\n                 ps.setString(3, \"2018-06-20\"); //Jayd's idea: was added to solve the MySQL 5.7 strict checking (birthday)\n                 ps.setString(4, \"2018-06-20\"); //Jayd's idea: was added to solve the MySQL 5.7 strict checking (tempban)\n                 ps.executeUpdate();\n@@ -74,7 +82,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 rs.next();\n                 c.setAccID(rs.getInt(1));\n                 rs.close();\n-            } catch (SQLException e) {\n+            } catch (SQLException | NoSuchAlgorithmException | UnsupportedEncodingException e) {\n                 e.printStackTrace();\n             } finally {\n                 disposeSql(con, ps);"}, {"sha": "e63efc7dfafbdb09486f14fed9c50741bbc43cb2", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -682,8 +682,8 @@ public boolean isPartyLeader() {\n         public boolean isEventLeader() {\n \t\treturn getEventInstance() != null && getPlayer().getId() == getEventInstance().getLeaderId();\n \t}\n-\n-\tpublic void givePartyItems(int id, short quantity, List<MapleCharacter> party) {\n+        \n+        public void givePartyItems(int id, short quantity, List<MapleCharacter> party) {\n \t\tfor (MapleCharacter chr : party) {\n \t\t\tMapleClient cl = chr.getClient();\n \t\t\tif (quantity >= 0) {\n@@ -695,7 +695,6 @@ public void givePartyItems(int id, short quantity, List<MapleCharacter> party) {\n \t\t}\n \t}\n \n-\n \tpublic void removeHPQItems() {\n \t\tint[] items = {4001095, 4001096, 4001097, 4001098, 4001099, 4001100, 4001101};\n \t\tfor (int i = 0; i < items.length; i ++) {"}, {"sha": "d1e599ea5873f4fc89220d85c69f2e97158d4b5d", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -345,7 +345,7 @@ public void run() {\n         \n         private void dismissEventTimer() {\n                 for(MapleCharacter chr: getPlayers()) {\n-                        chr.getClient().getSession().write(MaplePacketCreator.removeClock());\n+                        chr.getClient().announce(MaplePacketCreator.removeClock());\n                 }\n                 \n                 event_schedule = null;"}, {"sha": "faa7df8bea37427b13f69fc33c3ba54506bc640b", "filename": "src/server/CashShop.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/CashShop.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/CashShop.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/CashShop.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -582,4 +582,9 @@ public synchronized Item openCashShopSurprise() {\n             return null;\n         }\n     }\n+    \n+    public static Item generateCouponItem(int itemId, short quantity) {\n+        CashItem it = new CashItem(77777777, itemId, 7777, ItemConstants.isPet(itemId) ? 30 : 0, quantity, true);\n+        return it.toItem();\n+    }\n }"}, {"sha": "241872282eeade36db4d69abaa68a827957fe9e8", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -373,6 +373,7 @@ private MapleData getItemData(int itemId) {\n     private static short getExtraSlotMaxFromPlayer(MapleClient c, int itemId) {\n         short ret = 0;\n         \n+        // thanks GMChuck for detecting player sensitive data being cached into getSlotMax\n         if (ItemConstants.isThrowingStar(itemId)) {\n             if(c.getPlayer().getJob().isA(MapleJob.NIGHTWALKER1)) {\n                 ret += c.getPlayer().getSkillLevel(SkillFactory.getSkill(NightWalker.CLAW_MASTERY)) * 10;\n@@ -658,11 +659,11 @@ public static boolean rollSuccessChance(double prop) {\n     }\n     \n     private static short getMaximumShortMaxIfOverflow(int value1, int value2) {\n-        return (short)Math.min(Short.MAX_VALUE, Math.max(value1, value2));\n+        return (short) Math.min(Short.MAX_VALUE, Math.max(value1, value2));\n     }\n     \n     private static short getShortMaxIfOverflow(int value) {\n-        return (short)Math.min(Short.MAX_VALUE, value);\n+        return (short) Math.min(Short.MAX_VALUE, value);\n     }\n     \n     private static short chscrollRandomizedStat(int range) {"}, {"sha": "3364e36ee84e9aee594a1c08a9ef04bd30f25771", "filename": "src/server/MapleShop.java", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/MapleShop.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/MapleShop.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleShop.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -94,12 +94,12 @@ public void buy(MapleClient c, short slot, int itemId, short quantity) {\n             if (c.getPlayer().getMeso() >= amount) {\n                 if (MapleInventoryManipulator.checkSpace(c, itemId, quantity, \"\")) {\n                     if (!ItemConstants.isRechargeable(itemId)) { //Pets can't be bought from shops\n-                        MapleInventoryManipulator.addById(c, itemId, quantity);          \n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", -1);          \n                         c.getPlayer().gainMeso(-amount, false);\n                     } else {\n                         short slotMax = ii.getSlotMax(c, item.getItemId());\n                         quantity = slotMax;\n-                        MapleInventoryManipulator.addById(c, itemId, quantity);\n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", -1);\n                         c.getPlayer().gainMeso(-item.getPrice(), false);\n                     }\n                     c.announce(MaplePacketCreator.shopTransaction((byte) 0));\n@@ -115,12 +115,12 @@ public void buy(MapleClient c, short slot, int itemId, short quantity) {\n             if (c.getPlayer().getInventory(MapleInventoryType.ETC).countById(4310000) >= amount) {\n                 if (MapleInventoryManipulator.checkSpace(c, itemId, quantity, \"\")) {\n                     if (!ItemConstants.isRechargeable(itemId)) {\n-                        MapleInventoryManipulator.addById(c, itemId, quantity);\n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", -1);\n                         MapleInventoryManipulator.removeById(c, MapleInventoryType.ETC, 4310000, amount, false, false);\n                     } else {\n                         short slotMax = ii.getSlotMax(c, item.getItemId());\n                         quantity = slotMax;\n-                        MapleInventoryManipulator.addById(c, itemId, quantity);\n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", -1);\n                         MapleInventoryManipulator.removeById(c, MapleInventoryType.ETC, 4310000, amount, false, false);\n                     }\n                     c.announce(MaplePacketCreator.shopTransaction((byte) 0));\n@@ -138,9 +138,9 @@ public void buy(MapleClient c, short slot, int itemId, short quantity) {\n                 if (MapleInventoryManipulator.checkSpace(c, itemId, quantity, \"\")) {\n                     if (ItemConstants.isPet(itemId)) {\n                         int petid = MaplePet.createPet(itemId);\n-                        MapleInventoryManipulator.addById(c, itemId, quantity, null, petid, -1);\n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", petid, -1);\n                     } else {\n-                        MapleInventoryManipulator.addById(c, itemId, quantity);\n+                        MapleInventoryManipulator.addById(c, itemId, quantity, \"\", -1, -1);\n                     }\n                     c.getPlayer().gainMeso(diff, false);\n                 } else {"}, {"sha": "13d6113054dfc10ff141d655f0586b0cfd010916", "filename": "src/server/maps/MapleHiredMerchant.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleHiredMerchant.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleHiredMerchant.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleHiredMerchant.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -376,7 +376,7 @@ public void closeShop(MapleClient c, boolean timeout) {\n                         if (mpsi.getItem().getInventoryType().equals(MapleInventoryType.EQUIP)) {\n                             MapleInventoryManipulator.addFromDrop(c, mpsi.getItem(), false);\n                         } else {\n-                            MapleInventoryManipulator.addById(c, mpsi.getItem().getItemId(), (short) (mpsi.getBundles() * mpsi.getItem().getQuantity()), null, -1, mpsi.getItem().getFlag(), mpsi.getItem().getExpiration());\n+                            MapleInventoryManipulator.addById(c, mpsi.getItem().getItemId(), (short) (mpsi.getBundles() * mpsi.getItem().getQuantity()), mpsi.getItem().getOwner(), -1, mpsi.getItem().getFlag(), mpsi.getItem().getExpiration());\n                         }\n                     }\n                 }"}, {"sha": "0ee937d625b31e8369f88042ffff36b73fe4e417", "filename": "src/server/maps/MapleKite.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleKite.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleKite.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleKite.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -43,12 +43,12 @@ public void setPosition(Point position) {\n \n     @Override\n     public void sendDestroyData(MapleClient client) {\n-        client.getSession().write(makeDestroyData());\n+        client.announce(makeDestroyData());\n     }\n \n     @Override\n     public void sendSpawnData(MapleClient client) {\n-        client.getSession().write(makeSpawnData());\n+        client.announce(makeSpawnData());\n     }\n \n     public final byte[] makeSpawnData() {"}, {"sha": "04162be5dba08b5ebe4ce574de18773b78a88a56", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -3882,7 +3882,7 @@ public boolean isHorntailDefeated() {   // all parts of dead horntail can be fou\n     \n     public void spawnHorntailOnGroundBelow(final Point targetPoint) {   // ayy lmao\n         MapleMonster htIntro = MapleLifeFactory.getMonster(8810026);\n-        spawnMonsterOnGroundBelow(htIntro, targetPoint);\n+        spawnMonsterOnGroundBelow(htIntro, targetPoint);    // htintro spawn animation converting into horntail detected thanks to Arnah\n         \n         final MapleMonster ht = MapleLifeFactory.getMonster(8810018);\n         ht.setParentMobOid(htIntro.getObjectId());"}, {"sha": "d959a3686da59d31913e04961f7a7c21c201d79d", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -427,21 +427,14 @@ public void setWorld(int world) {\n     public Map<Integer, MapleMap> getMaps() {\n         mapsRLock.lock();\n         try {\n-            return Collections.unmodifiableMap(maps);\n+            return new HashMap<>(maps);\n         } finally {\n             mapsRLock.unlock();\n         }\n     }\n     \n     public void dispose() {\n-        Collection<MapleMap> mapValues;\n-        \n-        mapsRLock.lock();\n-        try {\n-            mapValues = maps.values();\n-        } finally {\n-            mapsRLock.unlock();\n-        }\n+        Collection<MapleMap> mapValues = getMaps().values();\n         \n         for(MapleMap map: mapValues) {\n             map.dispose();"}, {"sha": "499b76bf4144eedebe55f2243894e208fb000339", "filename": "src/server/maps/MapleMiniGame.java", "status": "modified", "additions": 121, "deletions": 27, "changes": 148, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMiniGame.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/maps/MapleMiniGame.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMiniGame.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -23,6 +23,7 @@\n \n import client.MapleCharacter;\n import client.MapleClient;\n+import net.server.Server;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n@@ -31,23 +32,25 @@\n /**\n  *\n  * @author Matze\n- * @author Ronan (refactored String GameType to enum MiniGameType)\n+ * @author Ronan (HeavenMS)\n  */\n public class MapleMiniGame extends AbstractMapleMapObject {\n     private MapleCharacter owner;\n     private MapleCharacter visitor;\n     private String password;\n     private MiniGameType GameType = MiniGameType.UNDEFINED;\n+    private int piecetype;\n+    private int inprogress = 0;\n     private int[] piece = new int[250];\n     private List<Integer> list4x3 = new ArrayList<>();\n     private List<Integer> list5x4 = new ArrayList<>();\n     private List<Integer> list6x5 = new ArrayList<>();\n     private String description;\n     private int loser = 1;\n-    private int piecetype;\n     private int firstslot = 0;\n-    private int visitorpoints = 0;\n-    private int ownerpoints = 0;\n+    private int visitorpoints = 0, visitorscore = 0, visitorforfeits = 0, lastvisitor = -1;\n+    private int ownerpoints = 0, ownerscore = 0, ownerforfeits = 0;\n+    private long nextavailabletie = 0;\n     private int matchestowin = 0;\n \n     public static enum MiniGameType {\n@@ -91,12 +94,21 @@ public boolean isOwner(MapleCharacter c) {\n     \n     public void addVisitor(MapleCharacter challenger) {\n         visitor = challenger;\n+        if (lastvisitor != challenger.getId()) {\n+            ownerscore = 0;\n+            ownerforfeits = 0;\n+            \n+            visitorscore = 0;\n+            visitorforfeits = 0;\n+            lastvisitor = challenger.getId();\n+        }\n+        \n         MapleCharacter owner = this.getOwner();\n         if (GameType == MiniGameType.OMOK) {\n-            owner.announce(MaplePacketCreator.getMiniGameNewVisitor(challenger, 1));\n+            owner.announce(MaplePacketCreator.getMiniGameNewVisitor(this, challenger, 1));\n             owner.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(owner, 2, 0));\n         } else if (GameType == MiniGameType.MATCH_CARD) {\n-            owner.announce(MaplePacketCreator.getMatchCardNewVisitor(challenger, 1));\n+            owner.announce(MaplePacketCreator.getMatchCardNewVisitor(this, challenger, 1));\n             owner.getMap().broadcastMessage(MaplePacketCreator.addMatchCardBox(owner, 2, 0));\n         }\n     }\n@@ -117,6 +129,13 @@ public boolean isVisitor(MapleCharacter challenger) {\n         return visitor == challenger;\n     }\n \n+    public void broadcastToOwner(final byte[] packet) {\n+        MapleClient c = owner.getClient();\n+        if (c != null && c.getSession() != null) {\n+            c.announce(packet);\n+        }\n+    }\n+    \n     public void broadcastToVisitor(final byte[] packet) {\n         if (visitor != null) {\n             visitor.getClient().announce(packet);\n@@ -131,15 +150,83 @@ public int getFirstSlot() {\n         return firstslot;\n     }\n \n+    private void updateMiniGameBox() {\n+        this.getOwner().getMap().broadcastMessage(MaplePacketCreator.addOmokBox(owner, visitor != null ? 2 : 1, inprogress));\n+    }\n+    \n+    private void minigameMatchFinished() {\n+        inprogress = 0;\n+        updateMiniGameBox();\n+    }\n+    \n+    public void minigameMatchStarted() {\n+        inprogress = 1;\n+    }\n+    \n+    public boolean isMatchInProgress() {\n+        return inprogress != 0;\n+    }\n+    \n+    public void denyTie(MapleCharacter chr) {\n+        if (this.isOwner(chr)) {\n+            inprogress |= (1 << 1);\n+        } else {\n+            inprogress |= (1 << 2);\n+        }\n+    }\n+    \n+    public boolean isTieDenied(MapleCharacter chr) {\n+        if (this.isOwner(chr)) {\n+            return ((inprogress >> 1) % 2) == 1;\n+        } else {\n+            return ((inprogress >> 2) % 2) == 1;\n+        }\n+    }\n+    \n+    public void minigameMatchOwnerWins(boolean forfeit) {\n+        owner.setMiniGamePoints(visitor, 1, this.isOmok());\n+        if (visitorforfeits < 4 || !forfeit) ownerscore += 50;\n+        visitorscore += (15 * (forfeit ? -1 : 1));\n+        if (forfeit) visitorforfeits++;\n+        \n+        this.broadcast(MaplePacketCreator.getMiniGameOwnerWin(this, forfeit));\n+        minigameMatchFinished();\n+    }\n+    \n+    public void minigameMatchVisitorWins(boolean forfeit) {\n+        owner.setMiniGamePoints(visitor, 2, this.isOmok());\n+        if (ownerforfeits < 4 || !forfeit) visitorscore += 50;\n+        ownerscore += (15 * (forfeit ? -1 : 1));\n+        if (forfeit) ownerforfeits++;\n+        \n+        this.broadcast(MaplePacketCreator.getMiniGameVisitorWin(this, forfeit));\n+        minigameMatchFinished();\n+    }\n+    \n+    public void minigameMatchDraw() {\n+        owner.setMiniGamePoints(visitor, 3, this.isOmok());\n+        \n+        long timeNow = Server.getInstance().getCurrentTime();\n+        if (nextavailabletie <= timeNow) {\n+            visitorscore += 10;\n+            ownerscore += 10;\n+            \n+            nextavailabletie = timeNow + 5 * 60 * 1000;\n+        }\n+        \n+        this.broadcast(MaplePacketCreator.getMiniGameTie(this));\n+        minigameMatchFinished();\n+    }\n+    \n     public void setOwnerPoints() {\n         ownerpoints++;\n         if (ownerpoints + visitorpoints == matchestowin) {\n             if (ownerpoints == visitorpoints) {\n-                this.broadcast(MaplePacketCreator.getMatchCardTie(this));\n+                minigameMatchDraw();\n             } else if (ownerpoints > visitorpoints) {\n-                this.broadcast(MaplePacketCreator.getMatchCardOwnerWin(this));\n+                minigameMatchOwnerWins(false);\n             } else {\n-                this.broadcast(MaplePacketCreator.getMatchCardVisitorWin(this));\n+                minigameMatchVisitorWins(false);\n             }\n             ownerpoints = 0;\n             visitorpoints = 0;\n@@ -150,11 +237,11 @@ public void setVisitorPoints() {\n         visitorpoints++;\n         if (ownerpoints + visitorpoints == matchestowin) {\n             if (ownerpoints > visitorpoints) {\n-                this.broadcast(MaplePacketCreator.getMiniGameOwnerWin(this));\n+                minigameMatchOwnerWins(false);\n             } else if (visitorpoints > ownerpoints) {\n-                this.broadcast(MaplePacketCreator.getMiniGameVisitorWin(this));\n+                minigameMatchVisitorWins(false);\n             } else {\n-                this.broadcast(MaplePacketCreator.getMiniGameTie(this));\n+                minigameMatchDraw();\n             }\n             ownerpoints = 0;\n             visitorpoints = 0;\n@@ -198,6 +285,10 @@ public void setGameType(MiniGameType game) {\n     public MiniGameType getGameType() {\n         return GameType;\n     }\n+    \n+    public boolean isOmok() {\n+        return GameType.equals(MiniGameType.OMOK);\n+    }\n \n     public void shuffleList() {\n         if (matchestowin == 6) {\n@@ -212,11 +303,11 @@ public void shuffleList() {\n     public int getCardId(int slot) {\n         int cardid;\n         if (matchestowin == 6) {\n-            cardid = list4x3.get(slot - 1);\n+            cardid = list4x3.get(slot);\n         } else if (matchestowin == 10) {\n-            cardid = list5x4.get(slot - 1);\n+            cardid = list5x4.get(slot);\n         } else {\n-            cardid = list6x5.get(slot - 1);\n+            cardid = list6x5.get(slot);\n         }\n         return cardid;\n     }\n@@ -234,10 +325,7 @@ public int getLoser() {\n     }\n \n     public void broadcast(final byte[] packet) {\n-        MapleClient c = owner.getClient();\n-        if (c != null && c.getSession() != null) {\n-            c.announce(packet);\n-        }\n+        broadcastToOwner(packet);\n         broadcastToVisitor(packet);\n     }\n \n@@ -270,10 +358,10 @@ public void setPiece(int move1, int move2, int type, MapleCharacter chr) {\n                 for (int x = 0; x < 11; x++) {\n                     if (searchCombo(x, y, type)) {\n                         if (this.isOwner(chr)) {\n-                            this.broadcast(MaplePacketCreator.getMiniGameOwnerWin(this));\n+                            this.minigameMatchOwnerWins(false);\n                             this.setLoser(0);\n                         } else {\n-                            this.broadcast(MaplePacketCreator.getMiniGameVisitorWin(this));\n+                            this.minigameMatchVisitorWins(false);\n                             this.setLoser(1);\n                         }\n                         for (int y2 = 0; y2 < 15; y2++) {\n@@ -289,10 +377,10 @@ public void setPiece(int move1, int move2, int type, MapleCharacter chr) {\n                 for (int x = 4; x < 15; x++) {\n                     if (searchCombo2(x, y, type)) {\n                         if (this.isOwner(chr)) {\n-                            this.broadcast(MaplePacketCreator.getMiniGameOwnerWin(this));\n+                            this.minigameMatchOwnerWins(false);\n                             this.setLoser(0);\n                         } else {\n-                            this.broadcast(MaplePacketCreator.getMiniGameVisitorWin(this));\n+                            this.minigameMatchVisitorWins(false);\n                             this.setLoser(1);\n                         }\n                         for (int y2 = 0; y2 < 15; y2++) {\n@@ -351,14 +439,20 @@ private boolean searchCombo2(int x, int y, int type) {\n     public String getDescription() {\n         return description;\n     }\n+    \n+    public int getOwnerScore() {\n+        return ownerscore;\n+    }\n+    \n+    public int getVisitorScore() {\n+        return visitorscore;\n+    }\n \n     @Override\n-    public void sendDestroyData(MapleClient client) {\n-    }\n+    public void sendDestroyData(MapleClient client) {}\n \n     @Override\n-    public void sendSpawnData(MapleClient client) {\n-    }\n+    public void sendSpawnData(MapleClient client) {}\n \n     @Override\n     public MapleMapObjectType getType() {"}, {"sha": "cf4ad35e018b12b4931a690f53ac307f14490f21", "filename": "src/server/quest/MapleQuest.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/quest/MapleQuest.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/quest/MapleQuest.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/MapleQuest.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -354,7 +354,7 @@ public boolean forceComplete(MapleCharacter c, int npc) {\n         newStatus.setCompletionTime(System.currentTimeMillis());\n         c.updateQuest(newStatus);\n         \n-        c.getClient().getSession().write(MaplePacketCreator.showSpecialEffect(9)); // Quest completion\n+        c.announce(MaplePacketCreator.showSpecialEffect(9)); // Quest completion\n         c.getMap().broadcastMessage(c, MaplePacketCreator.showForeignEffect(c.getId(), 9), false); //use 9 instead of 12 for both\n         return true;\n     }"}, {"sha": "1491515a98e7f902e447f4186ac7e3a36e022a04", "filename": "src/server/quest/actions/ItemAction.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/quest/actions/ItemAction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/server/quest/actions/ItemAction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/quest/actions/ItemAction.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -149,7 +149,7 @@ public void run(MapleCharacter chr, Integer extSelection) {\n                 }\n                 \n                 for(Pair<Integer, Integer> iPair: giveItem) {\n-                        MapleInventoryManipulator.addById(chr.getClient(), iPair.getLeft(), (short) iPair.getRight().shortValue());\n+                        MapleInventoryManipulator.addById(chr.getClient(), iPair.getLeft(), (short) iPair.getRight().shortValue(), \"\", -1);\n                         chr.announce(MaplePacketCreator.getShowItemGain(iPair.getLeft(), (short) iPair.getRight().shortValue(), true));\n                 }\n \t}"}, {"sha": "efd05534ea36f3e71b6b9938010af402dc1df696", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 72, "deletions": 78, "changes": 150, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1996,9 +1996,9 @@ private static void encodeParentlessMobSpawnEffect(MaplePacketLittleEndianWriter\n                         MapleMiniGame miniGame = chr.getMiniGame();\n                         if (miniGame != null && miniGame.isOwner(chr)) {\n                                 if (miniGame.hasFreeSlot()) {\n-                                        spawnAnnounceBox(mplew, miniGame, 0, 1, 0);\n+                                        addAnnounceBox(mplew, miniGame, 1, 0);\n                                 } else {\n-                                        spawnAnnounceBox(mplew, miniGame, 0, 2, 1);\n+                                        addAnnounceBox(mplew, miniGame, 2, miniGame.isMatchInProgress() ? 1 : 0);\n                                 }\n                         } else {\n                                 mplew.write(0);\n@@ -2170,23 +2170,12 @@ private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, Ma\n                 mplew.write(0);\n         }\n \n-        private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, MapleMiniGame game, int type, int ammount, int joinable) {\n-                mplew.write(game.getGameType().getValue());\n-                mplew.writeInt(game.getObjectId()); // gameid/shopid\n-                mplew.writeMapleAsciiString(game.getDescription()); // desc\n-                mplew.writeMapleAsciiString(game.getPassword());\n-                mplew.write(type);\n-                mplew.write(ammount);\n-                mplew.write(2);\n-                mplew.write(joinable);\n-        }\n-        \n-        private static void spawnAnnounceBox(final MaplePacketLittleEndianWriter mplew, MapleMiniGame game, int type, int ammount, int joinable) {\n+        private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, MapleMiniGame game, int ammount, int joinable) {\n                 mplew.write(game.getGameType().getValue());\n                 mplew.writeInt(game.getObjectId()); // gameid/shopid\n                 mplew.writeMapleAsciiString(game.getDescription()); // desc\n                 mplew.writeBool(!game.getPassword().isEmpty());    // password here, thanks GabrielSin!\n-                mplew.write(type);\n+                mplew.write(game.getPieceType());\n                 mplew.write(ammount);\n                 mplew.write(2);         //player capacity\n                 mplew.write(joinable);\n@@ -5016,15 +5005,15 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.WIN, true));\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.TIE, true));\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.LOSS, true));\n-                mplew.writeInt(2000);\n+                mplew.writeInt(minigame.getOwnerScore());\n                 if (minigame.getVisitor() != null) {\n                         MapleCharacter visitor = minigame.getVisitor();\n                         mplew.write(1);\n                         mplew.writeInt(1);\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.WIN, true));\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.TIE, true));\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.LOSS, true));\n-                        mplew.writeInt(2000);\n+                        mplew.writeInt(minigame.getVisitorScore());\n                 }\n                 mplew.write(0xFF);\n                 mplew.writeMapleAsciiString(minigame.getDescription());\n@@ -5115,7 +5104,7 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMiniGameNewVisitor(MapleCharacter c, int slot) {\n+        public static byte[] getMiniGameNewVisitor(MapleMiniGame minigame, MapleCharacter c, int slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n@@ -5126,7 +5115,7 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.WIN, true));\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.TIE, true));\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.LOSS, true));\n-                mplew.writeInt(2000);\n+                mplew.writeInt(minigame.getVisitorScore());\n                 return mplew.getPacket();\n         }\n \n@@ -5138,50 +5127,64 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        private static byte[] getMiniGameResult(MapleMiniGame game, int win, int lose, int tie, int result, int forfeit, boolean omok) {\n+        private static byte[] getMiniGameResult(MapleMiniGame game, int tie, int result, int forfeit) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.GET_RESULT.getCode());\n+                \n+                int matchResultType;\n                 if (tie == 0 && forfeit != 1) {\n+                        matchResultType = 0;\n+                } else if (tie != 0) {\n+                        matchResultType = 1;\n+                } else {\n+                        matchResultType = 2;\n+                }\n+                \n+                mplew.write(matchResultType);\n+                mplew.writeBool(result == 2); // host/visitor wins\n+                \n+                boolean omok = game.isOmok();\n+                if (matchResultType == 1) {\n                         mplew.write(0);\n-                } else if (tie == 1) {\n-                        mplew.write(1);\n-                } else if (forfeit == 1) {\n-                        mplew.write(2);\n+                        mplew.writeShort(0);\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.WIN, omok)); // wins\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.TIE, omok)); // ties\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.LOSS, omok)); // losses\n+                        mplew.writeInt(game.getOwnerScore()); // points\n+\n+                        mplew.writeInt(0); // unknown\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.WIN, omok)); // wins\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.TIE, omok)); // ties\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.LOSS, omok)); // losses\n+                        mplew.writeInt(game.getVisitorScore()); // points\n+                        mplew.write(0);\n+                } else {\n+                        mplew.writeInt(0);\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.WIN, omok)); // wins\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.TIE, omok)); // ties\n+                        mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.LOSS, omok)); // losses\n+                        mplew.writeInt(game.getOwnerScore()); // points\n+                        mplew.writeInt(0);\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.WIN, omok)); // wins\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.TIE, omok)); // ties\n+                        mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.LOSS, omok)); // losses\n+                        mplew.writeInt(game.getVisitorScore()); // points\n                 }\n-                mplew.write(0); // owner\n-                mplew.writeInt(1); // unknown\n-                mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.WIN, omok) + win); // wins\n-                mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.TIE, omok) + tie); // ties\n-                mplew.writeInt(game.getOwner().getMiniGamePoints(MiniGameResult.LOSS, omok) + lose); // losses\n-                mplew.writeInt(2000); // points\n-                mplew.writeInt(1); // start of visitor; unknown\n-                mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.WIN, omok) + lose); // wins\n-                mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.TIE, omok) + tie); // ties\n-                mplew.writeInt(game.getVisitor().getMiniGamePoints(MiniGameResult.LOSS, omok) + win); // losses\n-                mplew.writeInt(2000); // points\n-                game.getOwner().setMiniGamePoints(game.getVisitor(), result, omok);\n+                \n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMiniGameOwnerWin(MapleMiniGame game) {\n-                return getMiniGameResult(game, 0, 1, 0, 1, 0, true);\n+        public static byte[] getMiniGameOwnerWin(MapleMiniGame game, boolean forfeit) {\n+                return getMiniGameResult(game, 0, 1, forfeit ? 1 : 0);\n         }\n \n-        public static byte[] getMiniGameVisitorWin(MapleMiniGame game) {\n-                return getMiniGameResult(game, 1, 0, 0, 2, 0, true);\n+        public static byte[] getMiniGameVisitorWin(MapleMiniGame game, boolean forfeit) {\n+                return getMiniGameResult(game, 0, 2, forfeit ? 1 : 0);\n         }\n \n         public static byte[] getMiniGameTie(MapleMiniGame game) {\n-                return getMiniGameResult(game, 0, 0, 1, 3, 0, true);\n-        }\n-\n-        public static byte[] getMiniGameOwnerForfeit(MapleMiniGame game) {\n-                return getMiniGameResult(game, 0, 1, 0, 2, 1, true);\n-        }\n-\n-        public static byte[] getMiniGameVisitorForfeit(MapleMiniGame game) {\n-                return getMiniGameResult(game, 1, 0, 0, 1, 1, true);\n+                return getMiniGameResult(game, 1, 3, 0);\n         }\n \n         public static byte[] getMiniGameClose(int type) {\n@@ -5215,15 +5218,17 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.WIN, false));\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.TIE, false));\n                 mplew.writeInt(minigame.getOwner().getMiniGamePoints(MiniGameResult.LOSS, false));\n-                mplew.writeInt(2000);\n+                \n+                //set vs\n+                mplew.writeInt(minigame.getOwnerScore());\n                 if (minigame.getVisitor() != null) {\n                         MapleCharacter visitor = minigame.getVisitor();\n                         mplew.write(1);\n                         mplew.writeInt(2);\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.WIN, false));\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.TIE, false));\n                         mplew.writeInt(visitor.getMiniGamePoints(MiniGameResult.LOSS, false));\n-                        mplew.writeInt(2000);\n+                        mplew.writeInt(minigame.getVisitorScore());\n                 }\n                 mplew.write(0xFF);\n                 mplew.writeMapleAsciiString(minigame.getDescription());\n@@ -5237,20 +5242,24 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.START.getCode());\n                 mplew.write(loser);\n-                mplew.write(0x0C);\n-                int last = 13;\n+                \n+                int last;\n                 if (game.getMatchesToWin() > 10) {\n-                        last = 31;\n+                        last = 30;\n                 } else if (game.getMatchesToWin() > 6) {\n-                        last = 21;\n+                        last = 20;\n+                } else {\n+                        last = 12;\n                 }\n-                for (int i = 1; i < last; i++) {\n+                \n+                mplew.write(last);\n+                for (int i = 0; i < last; i++) {\n                         mplew.writeInt(game.getCardId(i));\n                 }\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMatchCardNewVisitor(MapleCharacter c, int slot) {\n+        public static byte[] getMatchCardNewVisitor(MapleMiniGame minigame, MapleCharacter c, int slot) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.VISIT.getCode());\n@@ -5261,7 +5270,7 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.WIN, false));\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.TIE, false));\n                 mplew.writeInt(c.getMiniGamePoints(MiniGameResult.LOSS, false));\n-                mplew.writeInt(2000);\n+                mplew.writeInt(minigame.getVisitorScore());\n                 return mplew.getPacket();\n         }\n \n@@ -5280,18 +5289,6 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMatchCardOwnerWin(MapleMiniGame game) {\n-                return getMiniGameResult(game, 1, 0, 0, 1, 0, false);\n-        }\n-\n-        public static byte[] getMatchCardVisitorWin(MapleMiniGame game) {\n-                return getMiniGameResult(game, 0, 1, 0, 2, 0, false);\n-        }\n-\n-        public static byte[] getMatchCardTie(MapleMiniGame game) {\n-                return getMiniGameResult(game, 0, 0, 1, 3, 0, false);\n-        }\n-\n         public static byte[] fredrickMessage(byte operation) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.FREDRICK_MESSAGE.getValue());\n@@ -5343,15 +5340,15 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.UPDATE_CHAR_BOX.getValue());\n                 mplew.writeInt(c.getId());\n-                addAnnounceBox(mplew, c.getMiniGame(), 0, ammount, type);\n+                addAnnounceBox(mplew, c.getMiniGame(), ammount, type);\n                 return mplew.getPacket();\n         }\n         \n         public static byte[] addMatchCardBox(MapleCharacter c, int ammount, int type) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.UPDATE_CHAR_BOX.getValue());\n                 mplew.writeInt(c.getId());\n-                addAnnounceBox(mplew, c.getMiniGame(), 0, ammount, type);\n+                addAnnounceBox(mplew, c.getMiniGame(), ammount, type);\n                 return mplew.getPacket();\n         }\n         \n@@ -6005,7 +6002,7 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.write(new byte[]{-1, -1, -1, 0});\n                 return mplew.getPacket();\n         }\n-\n+        \n         public static byte[] showCouponRedeemedItem(int itemid) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.CASHSHOP_OPERATION.getValue());\n@@ -6030,11 +6027,8 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] enableCSUse() {\n-                final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n-                mplew.write(0x12);\n-                mplew.skip(6);\n-                return mplew.getPacket();\n+        public static byte[] enableCSUse(MapleCharacter mc) {\n+                return showCash(mc);\n         }\n \n         /**"}, {"sha": "785195515a5ad4e2d80037dd409ec4d22b175b68", "filename": "tools/MapleCodeCouponGenerator/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/build.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleCodeCouponGenerator\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleCodeCouponGenerator.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleCodeCouponGenerator-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "9fccae135f79e85fbcd16edeb40b7c7641b48cee", "filename": "tools/MapleCodeCouponGenerator/lib/CouponCodes.img.xml", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/lib/CouponCodes.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/lib/CouponCodes.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/lib/CouponCodes.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,39 @@\n+\ufeff<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n+<imgdir name=\"CouponCodes.img\">\n+  <imgdir name=\"0\">\n+    <short name=\"active\" value=\"0\"/>\n+    <int name=\"quantity\" value=\"100\"/>\n+    <int name=\"duration\" value=\"1848\"/>\n+    <int name=\"maplePoint\" value=\"7777\">\n+    <int name=\"nxCredit\" value=\"1000\">\n+    <int name=\"nxPrepaid\" value=\"100\">\n+    <imgdir name=\"items\">\n+      <imgdir name=\"0\">\n+        <int name=\"id\" value=\"4000001\">\n+        <int name=\"count\" value=\"100\">\n+      </imgdir>\n+      <imgdir name=\"1\">\n+        <int name=\"id\" value=\"2030100\">\n+        <int name=\"count\" value=\"12\">\n+      </imgdir>\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"1\">\n+    <short name=\"active\" value=\"1\"/>\n+    <int name=\"quantity\" value=\"100\"/>\n+    <int name=\"duration\" value=\"960\"/>\n+    <int name=\"maplePoint\" value=\"5000\">\n+    <int name=\"nxCredit\" value=\"14\">\n+    <int name=\"nxPrepaid\" value=\"77\">\n+    <imgdir name=\"items\">\n+      <imgdir name=\"0\">\n+        <int name=\"id\" value=\"1302000\">\n+        <int name=\"count\" value=\"1\">\n+      </imgdir>\n+      <imgdir name=\"1\">\n+        <int name=\"id\" value=\"5000001\">\n+        <int name=\"count\" value=\"20\">\n+      </imgdir>\n+    </imgdir>\n+  </imgdir>\n+</imgdir>"}, {"sha": "0539039f716034c4896c8eaa81c075c7fa3bc997", "filename": "tools/MapleCodeCouponGenerator/lib/mysql-connector-java-bin.jar", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/lib/mysql-connector-java-bin.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/lib/mysql-connector-java-bin.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/lib/mysql-connector-java-bin.jar?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleCodeCouponGenerator/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/manifest.mf?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "0a6302969763ab2408da9430e57b010fe8abf08a", "filename": "tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "status": "added", "additions": 398, "deletions": 0, "changes": 398, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/MapleCodeCouponGenerator.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,398 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package maplecodecoupongenerator;\n+\n+import java.io.BufferedReader;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.util.ArrayList;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.sql.Statement;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ \n+ This application parses the coupon descriptor XML file and automatically generates\n+ code entries on the DB reflecting the descriptions found. Parse time relies on the\n+ sum of coupon codes created and amount of current codes on DB.\n+ \n+ Estimated parse time: 2 minutes (for 100 code entries)\n+ */\n+public class MapleCodeCouponGenerator {\n+    static String host = \"jdbc:mysql://localhost:3306/heavenms\";\n+    static String driver = \"com.mysql.jdbc.Driver\";\n+    static String username = \"root\";\n+    static String password = \"\";\n+    \n+    static Connection con = null;\n+    static InputStreamReader fileReader = null;\n+    static BufferedReader bufferedReader = null;\n+    \n+    static String fileName = \"lib/CouponCodes.img.xml\";\n+    static long currentTime;\n+    \n+    static int initialStringLength = 250;\n+    \n+    static String name;\n+    static boolean active;\n+    static int quantity, duration;\n+    static int maplePoint, nxCredit, nxPrepaid;\n+    \n+    static List<Pair<Integer, Integer>> itemList = new ArrayList<>();\n+    static Pair<Integer, Integer> item;\n+    \n+    \n+    static List<CodeCouponDescriptor> activeCoupons = new ArrayList<>();\n+    static List<Integer> generatedKeys;\n+    static Set<String> usedCodes = new HashSet<>();\n+    \n+    static byte status;\n+    \n+    private static void resetCouponPackage() {\n+        name = null;\n+        active = false;\n+        quantity = 1;\n+        duration = 7;\n+        maplePoint = 0;\n+        nxCredit = 0;\n+        nxPrepaid = 0;\n+        itemList.clear();\n+    }\n+    \n+    private static String getName(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+        \n+        i = token.lastIndexOf(\"name\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        try {\n+            token.getChars(i, j, dest, 0);\n+        } catch (StringIndexOutOfBoundsException e) {\n+            // do nothing\n+            return \"\";\n+        } catch (Exception e) {\n+            System.out.println(\"error in: \" + token + \"\");\n+            e.printStackTrace();\n+            try {\n+                Thread.sleep(100000000);\n+            } catch (Exception ex) {}\n+        }\n+        \n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static String getValue(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+\n+        i = token.lastIndexOf(\"value\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static void forwardCursor(int st) {\n+        String line = null;\n+\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                simpleToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void simpleToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+        }\n+    }\n+    \n+    private static void translateToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            \n+            if (status == 1) {\n+                if (active) {\n+                    activeCoupons.add(new CodeCouponDescriptor(name, quantity, duration, maplePoint, nxCredit, nxPrepaid, itemList));\n+                }\n+                \n+                resetCouponPackage();\n+            } else if (status == 3) {\n+                itemList.add(item);\n+            }\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+            \n+            if (status == 4) {\n+                item = new Pair<>(-1, -1);\n+            } else if (status == 2) {\n+                String d = getName(token);\n+                \n+                System.out.println(\"  Reading coupon '\" + d + \"'\");\n+                name = d;\n+            }\n+        }\n+        else {\n+            String d = getName(token);\n+            \n+            if (status == 2) {\n+                switch (d) {\n+                    case \"active\":\n+                        if (Integer.valueOf(getValue(token)) == 0) {\n+                            forwardCursor(status);\n+                            resetCouponPackage();\n+                        } else {\n+                            active = true;\n+                        }\n+                        break;\n+\n+                    case \"quantity\":\n+                        quantity = Integer.valueOf(getValue(token));\n+                        break;\n+                    case \"duration\":\n+                        duration = Integer.valueOf(getValue(token));\n+                        break;\n+                    case \"maplePoint\":\n+                        maplePoint = Integer.valueOf(getValue(token));\n+                        break;\n+                    case \"nxCredit\":\n+                        nxCredit = Integer.valueOf(getValue(token));\n+                        break;\n+                    case \"nxPrepaid\":\n+                        nxPrepaid = Integer.valueOf(getValue(token));\n+                        break;\n+                }\n+            } else if (status == 4) {\n+                switch (d) {\n+                    case \"count\":\n+                        item.right = Integer.valueOf(getValue(token));\n+                        break;\n+                    case \"id\":\n+                        item.left = Integer.valueOf(getValue(token));\n+                        break;\n+                }\n+            }\n+        }\n+    }\n+    \n+    private static class CodeCouponDescriptor {\n+        protected String name;\n+        protected int quantity, duration;\n+        protected int nxCredit, maplePoint, nxPrepaid;\n+        protected List<Pair<Integer, Integer>> itemList;\n+        \n+        protected CodeCouponDescriptor(String name, int quantity, int duration, int maplePoint, int nxCredit, int nxPrepaid, List<Pair<Integer, Integer>> itemList) {\n+            this.name = name;\n+            this.quantity = quantity;\n+            this.duration = duration;\n+            this.maplePoint = maplePoint;\n+            this.nxCredit = nxCredit;\n+            this.nxPrepaid = nxPrepaid;\n+            \n+            this.itemList = new ArrayList<>(itemList);\n+        }\n+    }\n+    \n+    private static String randomizeCouponCode() {\n+        StringBuilder rnd = new StringBuilder(Long.toHexString(Double.doubleToLongBits(Math.random())));\n+        rnd.setCharAt(5, '-');\n+        rnd.insert(11, '-');\n+        return rnd.toString();\n+    }\n+    \n+    private static String generateCouponCode() {\n+        String newCode;\n+        do {\n+            newCode = randomizeCouponCode();\n+        } while (usedCodes.contains(newCode));\n+        \n+        usedCodes.add(newCode);\n+        return newCode;\n+    }\n+    \n+    private static List<Integer> getGeneratedKeys(PreparedStatement ps) throws SQLException {\n+        if (generatedKeys == null) {\n+            generatedKeys = new ArrayList<>();\n+            \n+            ResultSet rs = ps.getGeneratedKeys();\n+            while (rs.next()) {\n+                generatedKeys.add(rs.getInt(1));\n+            }\n+            rs.close();\n+        }\n+        \n+        return generatedKeys;\n+    }\n+    \n+    private static void commitCodeCouponDescription(CodeCouponDescriptor recipe) throws SQLException {\n+        if (recipe.quantity < 1) return;\n+        \n+        System.out.println(\"  Generating coupon '\" + recipe.name + \"'\");\n+        generatedKeys = null;\n+        \n+        PreparedStatement ps = con.prepareStatement(\"INSERT IGNORE INTO `nxcode` (`code`, `expiration`) VALUES (?, ?)\", Statement.RETURN_GENERATED_KEYS);\n+        ps.setLong(2, currentTime + (recipe.duration * 60 * 60 * 1000));\n+        \n+        for(int i = 0; i < recipe.quantity; i++) {\n+            ps.setString(1, generateCouponCode());\n+            ps.addBatch();\n+        }\n+        ps.executeBatch();\n+        \n+        PreparedStatement ps2 = con.prepareStatement(\"INSERT IGNORE INTO `nxcode_items` (`codeid`, `type`, `item`, `quantity`) VALUES (?, ?, ?, ?)\");\n+        if (!recipe.itemList.isEmpty()) {\n+            ps2.setInt(2, 5);\n+            List<Integer> keys = getGeneratedKeys(ps);\n+            \n+            for (Pair<Integer, Integer> p : recipe.itemList) {\n+                ps2.setInt(3, p.getLeft());\n+                ps2.setInt(4, p.getRight());\n+                \n+                for (Integer codeid : keys) {\n+                    ps2.setInt(1, codeid);\n+                    ps2.addBatch();\n+                }\n+            }\n+        }\n+        \n+        ps2.setInt(4, 0);\n+        if (recipe.nxCredit > 0) {\n+            ps2.setInt(2, 0);\n+            ps2.setInt(3, recipe.nxCredit);\n+            List<Integer> keys = getGeneratedKeys(ps);\n+            \n+            for(Integer codeid : keys) {\n+                ps2.setInt(1, codeid);\n+                ps2.addBatch();\n+            }\n+        }\n+        \n+        if (recipe.maplePoint > 0) {\n+            ps2.setInt(2, 1);\n+            ps2.setInt(3, recipe.maplePoint);\n+            List<Integer> keys = getGeneratedKeys(ps);\n+            \n+            for(Integer codeid : keys) {\n+                ps2.setInt(1, codeid);\n+                ps2.addBatch();\n+            }\n+        }\n+        \n+        if (recipe.nxPrepaid > 0) {\n+            ps2.setInt(2, 2);\n+            ps2.setInt(3, recipe.nxPrepaid);\n+            List<Integer> keys = getGeneratedKeys(ps);\n+            \n+            for(Integer codeid : keys) {\n+                ps2.setInt(1, codeid);\n+                ps2.addBatch();\n+            }\n+        }\n+        \n+        ps2.executeBatch();\n+        ps2.close();\n+        ps.close();\n+    }\n+    \n+    private static void loadUsedCouponCodes() throws SQLException {\n+        PreparedStatement ps = con.prepareStatement(\"SELECT code FROM nxcode\", Statement.RETURN_GENERATED_KEYS);\n+        ResultSet rs = ps.executeQuery();\n+        while (rs.next()) {\n+            usedCodes.add(rs.getString(\"code\"));\n+        }\n+        rs.close();\n+        ps.close();\n+    }\n+    \n+    private static void generateCodeCoupons(String fileName) throws IOException {\n+        fileReader = new InputStreamReader(new FileInputStream(fileName), \"UTF-8\");\n+        bufferedReader = new BufferedReader(fileReader);\n+        \n+        resetCouponPackage();\n+        status = 0;\n+        \n+        System.out.println(\"Reading XML coupon information...\");\n+        String line;\n+        while((line = bufferedReader.readLine()) != null) {\n+            translateToken(line);\n+        }\n+\n+        bufferedReader.close();\n+        fileReader.close();\n+        System.out.println();\n+        \n+        try {\n+            Class.forName(driver).newInstance();\n+            con = DriverManager.getConnection(host, username, password);\n+            \n+            System.out.println(\"Loading DB coupon codes...\");\n+            loadUsedCouponCodes();\n+            System.out.println();\n+            \n+            System.out.println(\"Saving generated coupons...\");\n+            currentTime = System.currentTimeMillis();\n+            for (CodeCouponDescriptor ccd : activeCoupons) {\n+                commitCodeCouponDescription(ccd);\n+            }\n+            System.out.println();\n+            \n+            con.close();\n+            System.out.println(\"Done.\");\n+        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | SQLException e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    public static void main(String[] args) {\n+        try {\n+            generateCodeCoupons(fileName);\n+        } catch(IOException ex) {\n+            System.out.println(\"Error reading file '\" + fileName + \"'\");\n+        }\n+    }\n+}"}, {"sha": "3a8abd3b16f6fd5e769b51e9676fdff382f063ad", "filename": "tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/Pair.java", "status": "added", "additions": 121, "deletions": 0, "changes": 121, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/Pair.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/Pair.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleCodeCouponGenerator/src/maplecodecoupongenerator/Pair.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,121 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package maplecodecoupongenerator;\n+\n+/**\n+ * Represents a pair of values.\n+ * \n+ * @author Frz\n+ * @since Revision 333\n+ * @version 1.0\n+ * \n+ * @param <E> The type of the left value.\n+ * @param <F> The type of the right value.\n+ */\n+public class Pair<E, F> {\n+\n+    public E left;\n+    public F right;\n+\n+    /**\n+     * Class constructor - pairs two objects together.\n+     *\n+     * @param left The left object.\n+     * @param right The right object.\n+     */\n+    public Pair(E left, F right) {\n+        this.left = left;\n+        this.right = right;\n+    }\n+\n+    /**\n+     * Gets the left value.\n+     *\n+     * @return The left value.\n+     */\n+    public E getLeft() {\n+        return left;\n+    }\n+\n+    /**\n+     * Gets the right value.\n+     *\n+     * @return The right value.\n+     */\n+    public F getRight() {\n+        return right;\n+    }\n+\n+    /**\n+     * Turns the pair into a string.\n+     *\n+     * @return Each value of the pair as a string joined by a colon.\n+     */\n+    @Override\n+    public String toString() {\n+        return left.toString() + \":\" + right.toString();\n+    }\n+\n+    /**\n+     * Gets the hash code of this pair.\n+     */\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((left == null) ? 0 : left.hashCode());\n+        result = prime * result + ((right == null) ? 0 : right.hashCode());\n+        return result;\n+    }\n+\n+    /**\n+     * Checks to see if two pairs are equal.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        }\n+        if (obj == null) {\n+            return false;\n+        }\n+        if (getClass() != obj.getClass()) {\n+            return false;\n+        }\n+        final Pair other = (Pair) obj;\n+        if (left == null) {\n+            if (other.left != null) {\n+                return false;\n+            }\n+        } else if (!left.equals(other.left)) {\n+            return false;\n+        }\n+        if (right == null) {\n+            if (other.right != null) {\n+                return false;\n+            }\n+        } else if (!right.equals(other.right)) {\n+            return false;\n+        }\n+        return true;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "ab1d051324f7adbadc2091563d317009834052ec", "filename": "tools/MapleDojoUpdater/src/mapledojoupdate/MapleDojoUpdate.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleDojoUpdater/src/mapledojoupdate/MapleDojoUpdate.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleDojoUpdater/src/mapledojoupdate/MapleDojoUpdate.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleDojoUpdater/src/mapledojoupdate/MapleDojoUpdate.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -204,9 +204,6 @@ private static void parseDirectoryDojoData(String curPath) {\n         }\n     }\n     \n-    /**\n-     * @param args the command line arguments\n-     */\n     public static void main(String[] args) {\n         parseDirectoryDojoData(\"\");\n     }"}, {"sha": "7241bb5e533a10747a3bbd156040c51945f007dd", "filename": "tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEquipmentOmnileveler/src/mapleequipmentomnileveler/MapleEquipmentOmnileveler.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -485,9 +485,6 @@ private static void parseDirectoryEquipData(String curPath) {\n         }\n     }\n     \n-    /**\n-     * @param args the command line arguments\n-     */\n     public static void main(String[] args) {\n         parseDirectoryEquipData(\"\");\n     }"}, {"sha": "e3c4fff9e11f8070a0d4ba98be6b0570b135b78f", "filename": "tools/MapleMobBookUpdate/nbproject/project.properties", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleMobBookUpdate/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleMobBookUpdate/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleMobBookUpdate/nbproject/project.properties?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -29,12 +29,10 @@ dist.jar=${dist.dir}/MapleMobBookUpdate.jar\n dist.javadoc.dir=${dist.dir}/javadoc\n endorsed.classpath=\n excludes=\n-file.reference.MobBookUpdate-lib=lib\n-file.reference.mysql-connector-java-bin.jar=lib/mysql-connector-java-bin.jar\n+file.reference.mysql-connector-java-bin.jar=lib\\\\mysql-connector-java-bin.jar\n includes=**\n jar.compress=false\n javac.classpath=\\\n-    ${file.reference.MobBookUpdate-lib}:\\\n     ${file.reference.mysql-connector-java-bin.jar}\n # Space-separated list of extra javac options\n javac.compilerargs=\n@@ -68,8 +66,7 @@ mkdist.disabled=false\n platform.active=default_platform\n run.classpath=\\\n     ${javac.classpath}:\\\n-    ${build.classes.dir}:\\\n-    ${file.reference.mysql-connector-java-bin.jar}\n+    ${build.classes.dir}\n # Space-separated list of JVM arguments used when running the project.\n # You may also define separate properties like run-sys-prop.name=value instead of -Dname=value.\n # To set system properties for unit tests define test-sys-prop.name=value:"}, {"sha": "00556b119d45dd85a3c3073b1826916c3c60b9c4", "filename": "tools/MapleQuestItemCountFetcher/lib/commons-io-2.6.jar", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/lib/commons-io-2.6.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/lib/commons-io-2.6.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemCountFetcher/lib/commons-io-2.6.jar?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe"}, {"sha": "f4bf11fcfea86f9a88370d2e74d65358434254fb", "filename": "tools/MapleQuestItemCountFetcher/nbproject/project.properties", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/nbproject/project.properties", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/nbproject/project.properties", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemCountFetcher/nbproject/project.properties?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -30,11 +30,9 @@ dist.javadoc.dir=${dist.dir}/javadoc\n endorsed.classpath=\n excludes=\n file.reference.commons-io-2.6.jar=lib/commons-io-2.6.jar\n-file.reference.mysql-connector-java-bin.jar=../../cores/mysql-connector-java-bin.jar\n includes=**\n jar.compress=false\n javac.classpath=\\\n-    ${file.reference.mysql-connector-java-bin.jar}:\\\n     ${file.reference.commons-io-2.6.jar}\n # Space-separated list of extra javac options\n javac.compilerargs="}, {"sha": "0b135b562a6e03be481d58c0b35606f25ab58532", "filename": "tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -25,7 +25,6 @@\n import java.io.IOException;\n import java.io.InputStreamReader;\n import java.io.PrintWriter;\n-import java.sql.Connection;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.LinkedHashMap;\n@@ -47,10 +46,8 @@\n public class MapleQuestItemCountFetcher {\n     static String actName = \"../../wz/Quest.wz/Act.img.xml\";\n     static String checkName = \"../../wz/Quest.wz/Check.img.xml\";\n-    static String directoryName = \"../..\";\n     static String newFile = \"lib/QuestReport.txt\";\n-\n-    static Connection con = null;\n+    \n     static PrintWriter printWriter = null;\n     static InputStreamReader fileReader = null;\n     static BufferedReader bufferedReader = null;"}, {"sha": "69ac122190aecf598a4338da6614100250473629", "filename": "tools/SpiderDropFetcher/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/build.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"SpiderDropFetcher\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project SpiderDropFetcher.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"SpiderDropFetcher-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/SpiderDropFetcher/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/manifest.mf?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "778262f463e38e42888b32a5a92e5d8c9f6aa4f7", "filename": "tools/SpiderDropFetcher/src/client/inventory/MapleInventoryType.java", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/client/inventory/MapleInventoryType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/client/inventory/MapleInventoryType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/client/inventory/MapleInventoryType.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,73 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package client.inventory;\n+\n+/**\n+ * @author Matze\n+ */\n+public enum MapleInventoryType {\n+    UNDEFINED(0),\n+    EQUIP(1),\n+    USE(2),\n+    SETUP(3),\n+    ETC(4),\n+    CASH(5),\n+    CANHOLD(6),   //Proof-guard for inserting after removal checks\n+    EQUIPPED(-1); //Seems nexon screwed something when removing an item T_T\n+    final byte type;\n+\n+    private MapleInventoryType(int type) {\n+        this.type = (byte) type;\n+    }\n+\n+    public byte getType() {\n+        return type;\n+    }\n+\n+    public short getBitfieldEncoding() {\n+        return (short) (2 << type);\n+    }\n+\n+    public static MapleInventoryType getByType(byte type) {\n+        for (MapleInventoryType l : MapleInventoryType.values()) {\n+            if (l.getType() == type) {\n+                return l;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    public static MapleInventoryType getByWZName(String name) {\n+        if (name.equals(\"Install\")) {\n+            return SETUP;\n+        } else if (name.equals(\"Consume\")) {\n+            return USE;\n+        } else if (name.equals(\"Etc\")) {\n+            return ETC;\n+        } else if (name.equals(\"Cash\")) {\n+            return CASH;\n+        } else if (name.equals(\"Pet\")) {\n+            return CASH;\n+        }\n+        return UNDEFINED;\n+    }\n+}"}, {"sha": "a9a3cd6973887a3063e0201ca22f71ecc92440f0", "filename": "tools/SpiderDropFetcher/src/constants/CharsetConstants.java", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/constants/CharsetConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/constants/CharsetConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/constants/CharsetConstants.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,48 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+ \n+package constants;\n+ \n+/*\n+ * Courtesy of GabrielSin (gabrielsin@playellin.net)\n+ * Ellin\n+ * MapleStory Server\n+ * CharsetConstants\n+ */\n+ \n+public class CharsetConstants {\n+   \n+    public static MapleLanguageType MAPLE_TYPE = MapleLanguageType.LANGUAGE_PT_BR;\n+   \n+    public enum MapleLanguageType {\n+        LANGUAGE_PT_BR(1, \"ISO-8859-1\"),\n+        LANGUAGE_US(2, \"US-ASCII\");\n+        final byte type;\n+        final String ascii;\n+ \n+        private MapleLanguageType(int type, String ascii) {\n+            this.type = (byte) type;\n+            this.ascii = ascii;\n+        }\n+ \n+        public String getAscii() {\n+            return ascii;\n+        }\n+ \n+        public byte getType() {\n+            return type;\n+        }\n+ \n+        public static MapleLanguageType getByType(byte type) {\n+            for (MapleLanguageType l : MapleLanguageType.values()) {\n+                if (l.getType() == type) {\n+                    return l;\n+                }\n+            }\n+            return LANGUAGE_PT_BR;\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "860c392f347c208c830a4ffe0eefa149b51780d4", "filename": "tools/SpiderDropFetcher/src/constants/ItemConstants.java", "status": "added", "additions": 234, "deletions": 0, "changes": 234, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/constants/ItemConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/constants/ItemConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/constants/ItemConstants.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,234 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package constants;\n+\n+import client.inventory.MapleInventoryType;\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author Jay Estrella\n+ * @author Ronan\n+ */\n+public final class ItemConstants {\n+    protected static Map<Integer, MapleInventoryType> inventoryTypeCache = new HashMap<>();\n+    \n+    public final static int LOCK = 0x01;\n+    public final static int SPIKES = 0x02;\n+    public final static int KARMA_USE = 0x02;\n+    public final static int COLD = 0x04;\n+    public final static int UNTRADEABLE = 0x08;\n+    public final static int KARMA_EQP = 0x10;\n+    public final static int KARMA_UNTRADEABLE = 0x20;   // let 0x20 until it's proven something uses this\n+    public final static int SANDBOX = 0x40;             // let 0x40 until it's proven something uses this\n+    public final static int PET_COME = 0x80;\n+    public final static int ACCOUNT_SHARING = 0x100;\n+\n+    public final static boolean EXPIRING_ITEMS = true;\n+    public final static Set<Integer> permanentItemids = new HashSet<>();\n+\n+    static {\n+        int[] pi = {5000060, 5000100, 5000101, 5000102};    // i ain't going to open one gigantic itemid cache just for 4 perma itemids, no way!\n+        for(int i : pi) {\n+            permanentItemids.add(i);\n+        }\n+    }\n+    \n+    public static int getFlagByInt(int type) {\n+        if (type == 128) {\n+            return PET_COME;\n+        } else if (type == 256) {\n+            return ACCOUNT_SHARING;\n+        }\n+        return 0;\n+    }\n+\n+    public static boolean isThrowingStar(int itemId) {\n+        return itemId / 10000 == 207;\n+    }\n+\n+    public static boolean isBullet(int itemId) {\n+        return itemId / 10000 == 233;\n+    }\n+    \n+    public static boolean isPotion(int itemId) {\n+        return itemId / 1000 == 2000;\n+    }\n+    \n+    public static boolean isFood(int itemId) {\n+        int useType = itemId / 1000;\n+        return useType == 2022 || useType == 2010 || useType == 2020;\n+    }\n+    \n+    public static boolean isConsumable(int itemId) {\n+        return isPotion(itemId) || isFood(itemId);\n+    }\n+\n+    public static boolean isRechargeable(int itemId) {\n+        return isThrowingStar(itemId) || isBullet(itemId);\n+    }\n+\n+    public static boolean isArrowForCrossBow(int itemId) {\n+        return itemId / 1000 == 2061;\n+    }\n+\n+    public static boolean isArrowForBow(int itemId) {\n+        return itemId / 1000 == 2060;\n+    }\n+    \n+    public static boolean isArrow(int itemId) {\n+        return isArrowForBow(itemId) || isArrowForCrossBow(itemId);\n+    }\n+\n+    public static boolean isPet(int itemId) {\n+        return itemId / 1000 == 5000;\n+    }\n+    \n+    public static boolean isExpirablePet(int itemId) {\n+        return itemId == 5000054;\n+    }\n+    \n+    public static boolean isPermanentItem(int itemId) {\n+        return permanentItemids.contains(itemId);\n+    }\n+    \n+    public static boolean isNewYearCardEtc(int itemId) { \n+        return itemId / 10000 == 430;\n+    } \n+     \n+    public static boolean isNewYearCardUse(int itemId) { \n+        return itemId / 10000 == 216;\n+    }\n+    \n+    public static boolean isAccessory(int itemId) {\n+        return itemId >= 1110000 && itemId < 1140000;\n+    }\n+    \n+    public static boolean isTaming(int itemId) {\n+        int itemType = itemId / 1000;\n+        return itemType == 1902 || itemType == 1912;\n+    }\n+    \n+    public static boolean isTownScroll(int itemId) {\n+        return itemId >= 2030000 && itemId < 2030100;\n+    }\n+    \n+    public static boolean isAntibanishScroll(int itemId) {\n+        return itemId == 2030100;\n+    }\n+    \n+    public static boolean isCleanSlate(int scrollId) {\n+        return scrollId > 2048999 && scrollId < 2049004;\n+    }\n+    \n+    public static boolean isFlagModifier(int scrollId, byte flag) {\n+        if(scrollId == 2041058 && ((flag & ItemConstants.COLD) == ItemConstants.COLD)) return true;\n+        if(scrollId == 2040727 && ((flag & ItemConstants.SPIKES) == ItemConstants.SPIKES)) return true;\n+        return false;\n+    }\n+    \n+    public static boolean isChaosScroll(int scrollId) {\n+    \treturn scrollId >= 2049100 && scrollId <= 2049103;\n+    }\n+    \n+    public static boolean isRateCoupon(int itemId) {\n+        int itemType = itemId / 1000;\n+        return itemType == 5211 || itemType == 5360;\n+    }\n+    \n+    public static boolean isExpCoupon(int couponId) {\n+        return couponId / 1000 == 5211;\n+    }\n+    \n+    public static boolean isPartyItem(int itemId) {\n+        return itemId >= 2022430 && itemId <= 2022433;\n+    }\n+    \n+    public static boolean isPartyAllcure(int itemId) {\n+        return itemId == 2022433;\n+    }\n+    \n+    public static boolean isHiredMerchant(int itemId) {\n+        return itemId / 10000 == 503;\n+    }\n+    \n+    public static boolean isPlayerShop(int itemId) {\n+        return itemId / 10000 == 514;\n+    }\n+    \n+    public static MapleInventoryType getInventoryType(final int itemId) {\n+        if (inventoryTypeCache.containsKey(itemId)) {\n+            return inventoryTypeCache.get(itemId);\n+        }\n+        \n+        MapleInventoryType ret = MapleInventoryType.UNDEFINED;\n+        \n+\tfinal byte type = (byte) (itemId / 1000000);\n+\tif (type >= 1 && type <= 5) {\n+\t    ret = MapleInventoryType.getByType(type);\n+\t}\n+        \n+        inventoryTypeCache.put(itemId, ret);\n+        return ret;\n+    }\n+    \n+    public static boolean isMakerReagent(int itemId) {\n+        return itemId / 10000 == 425;\n+    }\n+    \n+    public static boolean isOverall(int itemId) {\n+        return itemId / 10000 == 105;\n+    }\n+    \n+    public static boolean isCashStore(int itemId) {\n+        int itemType = itemId / 10000;\n+        return itemType == 503 || itemType == 514;\n+    }\n+    \n+    public static boolean isMapleLife(int itemId) {\n+        int itemType = itemId / 10000;\n+        return itemType == 543 && itemId != 5430000;\n+    }\n+\n+    public static boolean isWeapon(int itemId) {\n+        return itemId >= 1302000 && itemId < 1492024;\n+    }\n+    \n+    public static boolean isEquipment(int itemId) {\n+        return itemId < 2000000 && itemId != 0;\n+    }\n+\n+    public static boolean isMedal(int itemId) {\n+        return itemId >= 1140000 && itemId < 1143000;\n+    }\n+    \n+    public static boolean isWeddingRing(int itemId) {\n+        return itemId >= 1112803 && itemId <= 1112809;\n+    }\n+    \n+    public static boolean isWeddingToken(int itemId) {\n+        return itemId >= 4031357 && itemId <= 4031364;\n+    }\n+}"}, {"sha": "cb71379b82158c12230fb9669dbbafe3a2412fd4", "filename": "tools/SpiderDropFetcher/src/dropspider/DataTool.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/DataTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/DataTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/dropspider/DataTool.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2,7 +2,7 @@\n  * To change this template, choose Tools | Templates\n  * and open the template in the editor.\n  */\n-package tools.dropspider;\n+package dropspider;\n \n import java.io.File;\n import java.util.ArrayList;", "previous_filename": "src/tools/dropspider/DataTool.java"}, {"sha": "9dc5457d8714fd48741e9f2978750530043fc476", "filename": "tools/SpiderDropFetcher/src/dropspider/DropEntry.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/DropEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/DropEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/dropspider/DropEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2,7 +2,7 @@\n  * To change this template, choose Tools | Templates\n  * and open the template in the editor.\n  */\n-package tools.dropspider;\n+package dropspider;\n \n import client.inventory.MapleInventoryType;\n import constants.ItemConstants;", "previous_filename": "src/tools/dropspider/DropEntry.java"}, {"sha": "a54b8543ab72ea1ed98ccffe95685cf6f8baefd7", "filename": "tools/SpiderDropFetcher/src/dropspider/Errors.java", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/Errors.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/Errors.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/dropspider/Errors.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1,4 +1,4 @@\n-package tools.dropspider;\n+package dropspider;\n \n import java.util.LinkedList;\n ", "previous_filename": "src/tools/dropspider/Errors.java"}, {"sha": "1d0ae2dfa68563753f60aae802a796a07fab5735", "filename": "tools/SpiderDropFetcher/src/dropspider/Main.java", "status": "renamed", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/Main.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/dropspider/Main.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/dropspider/Main.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2,7 +2,7 @@\n  * To change this template, choose Tools | Templates\n  * and open the template in the editor.\n  */\n-package tools.dropspider;\n+package dropspider;\n \n import java.io.BufferedWriter;\n import java.io.File;\n@@ -37,7 +37,7 @@\n     private static String[] additionalPagesBB = {\"101-120,\", \"121-140\", \"141-160\", \"161-180\", \"181-200\"};\n \n     public static void main(String[] args) {\n-        System.setProperty(\"wzpath\", \"wz\");\n+        System.setProperty(\"wzpath\", \"../../wz\");\n         \n         //DataTool.setHardcodedMobNames();\n         //parsePage(\"https://bbb.hidden-street.net/monster/nibelung-3\");", "previous_filename": "src/tools/dropspider/Main.java"}, {"sha": "10ab68219636d6faf90029f5bd485ff3a6648c56", "filename": "tools/SpiderDropFetcher/src/provider/MapleCanvas.java", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleCanvas.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,30 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.awt.image.BufferedImage;\n+\n+public interface MapleCanvas {\n+    int getHeight();\n+    int getWidth();\n+    BufferedImage getImage();\n+}"}, {"sha": "4d90a9380442c23c911757c8e49cebc2141cf869", "filename": "tools/SpiderDropFetcher/src/provider/MapleData.java", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleData.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleData.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleData.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,34 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.util.List;\n+import provider.wz.MapleDataType;\n+\n+public interface MapleData extends MapleDataEntity, Iterable<MapleData> {\n+    @Override\n+    public String getName();\n+    public MapleDataType getType();\n+    public List<MapleData> getChildren();\n+    public MapleData getChildByPath(String path);\n+    public Object getData();\n+}"}, {"sha": "cb043e0c945ea92f8e3aaa122e5b00a63c9588c5", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataDirectoryEntry.java", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataDirectoryEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataDirectoryEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataDirectoryEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,34 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.util.List;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataDirectoryEntry extends MapleDataEntry {\n+    public List<MapleDataDirectoryEntry> getSubdirectories();\n+    public List<MapleDataFileEntry> getFiles();\n+    public MapleDataEntry getEntry(String name);\n+}"}, {"sha": "03ff77649c8e5acc43bd9dc417bd6a5a5bde9f45", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataEntity.java", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataEntity.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataEntity.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataEntity.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,31 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataEntity {\n+    public String getName();\n+    public MapleDataEntity getParent();\n+}"}, {"sha": "62db6d0abeac3165aaa502d4098c15ce9598acab", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataEntry.java", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,33 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataEntry extends MapleDataEntity {\n+    public String getName();\n+    public int getSize();\n+    public int getChecksum();\n+    public int getOffset();\n+}"}, {"sha": "902130a612aeb60746ac4fd119b4f88376947472", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataFileEntry.java", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataFileEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataFileEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataFileEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,30 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+/**\n+ *\n+ * @author Matze\n+ */\n+public interface MapleDataFileEntry extends MapleDataEntry {\n+    public void setOffset(int offset);\n+}"}, {"sha": "5237b7ac37e4655b807bc6d47ad4bd10a360cc49", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataProvider.java", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataProvider.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,27 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+public interface MapleDataProvider {\n+    MapleData getData(String path);\n+    MapleDataDirectoryEntry getRoot();\n+}"}, {"sha": "14753d440683c1c13e8012d993cfbb85b3b76e8b", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataProviderFactory.java", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataProviderFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataProviderFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataProviderFactory.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,55 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import provider.wz.WZFile;\n+import provider.wz.XMLWZFile;\n+\n+public class MapleDataProviderFactory {\n+    private final static String wzPath = System.getProperty(\"wzpath\");\n+\n+    private static MapleDataProvider getWZ(File in, boolean provideImages) {\n+        if (in.getName().toLowerCase().endsWith(\"wz\") && !in.isDirectory()) {\n+            try {\n+                return new WZFile(in, provideImages);\n+            } catch (IOException e) {\n+                throw new RuntimeException(\"Loading WZ File failed\", e);\n+            }\n+        } else {\n+            return new XMLWZFile(in);\n+        }\n+    }\n+\n+    public static MapleDataProvider getDataProvider(File in) {\n+        return getWZ(in, false);\n+    }\n+\n+    public static MapleDataProvider getImageProvidingDataProvider(File in) {\n+        return getWZ(in, true);\n+    }\n+\n+    public static File fileInWZPath(String filename) {\n+        return new File(wzPath, filename);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "25f4c7f81749a8145359d27437f2d7075c5786c3", "filename": "tools/SpiderDropFetcher/src/provider/MapleDataTool.java", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/MapleDataTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/MapleDataTool.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,145 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider;\n+\n+import java.awt.Point;\n+import java.awt.image.BufferedImage;\n+import provider.wz.MapleDataType;\n+\n+public class MapleDataTool {\n+    public static String getString(MapleData data) {\n+        return ((String) data.getData());\n+    }\n+\n+    public static String getString(MapleData data, String def) {\n+        if (data == null || data.getData() == null) {\n+            return def;\n+        } else {\n+            return ((String) data.getData());\n+        }\n+    }\n+\n+    public static String getString(String path, MapleData data) {\n+        return getString(data.getChildByPath(path));\n+    }\n+\n+    public static String getString(String path, MapleData data, String def) {\n+        return getString(data.getChildByPath(path), def);\n+    }\n+\n+    public static double getDouble(MapleData data) {\n+        return ((Double) data.getData()).doubleValue();\n+    }\n+\n+    public static float getFloat(MapleData data) {\n+        return ((Float) data.getData()).floatValue();\n+    }\n+\n+    public static int getInt(MapleData data) {\n+        if (data == null || data.getData() == null) {\n+            return 0;// DEF?\n+        }\n+        return ((Integer) data.getData()).intValue();\n+    }\n+\n+    public static int getInt(String path, MapleData data) {\n+        return getInt(data.getChildByPath(path));\n+    }\n+\n+    public static int getIntConvert(MapleData data) {\n+        if (data.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(data));\n+        } else {\n+            return getInt(data);\n+        }\n+    }\n+\n+    public static int getIntConvert(String path, MapleData data) {\n+        MapleData d = data.getChildByPath(path);\n+        if (d.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(d));\n+        } else {\n+            return getInt(d);\n+        }\n+    }\n+\n+    public static int getInt(MapleData data, int def) {\n+        if (data == null || data.getData() == null) {\n+            return  def;\n+        } else if (data.getType() == MapleDataType.STRING) {\n+            return Integer.parseInt(getString(data));\n+        } else {\n+            return ((Integer) data.getData()).intValue();\n+        }\n+    }\n+\n+    public static int getInt(String path, MapleData data, int def) {\n+        return getInt(data.getChildByPath(path), def);\n+    }\n+\n+    public static int getIntConvert(String path, MapleData data, int def) {\n+        MapleData d = data.getChildByPath(path);\n+        if (d == null) {\n+            return def;\n+        }\n+        if (d.getType() == MapleDataType.STRING) {\n+            try {\n+                return Integer.parseInt(getString(d));\n+            } catch (NumberFormatException nfe) {\n+                nfe.printStackTrace();\n+                return def;\n+            }\n+        } else {\n+            return getInt(d, def);\n+        }\n+    }\n+\n+    public static BufferedImage getImage(MapleData data) {\n+        return ((MapleCanvas) data.getData()).getImage();\n+    }\n+\n+    public static Point getPoint(MapleData data) {\n+        return ((Point) data.getData());\n+    }\n+\n+    public static Point getPoint(String path, MapleData data) {\n+        return getPoint(data.getChildByPath(path));\n+    }\n+\n+    public static Point getPoint(String path, MapleData data, Point def) {\n+        final MapleData pointData = data.getChildByPath(path);\n+        if (pointData == null) {\n+            return def;\n+        }\n+        return getPoint(pointData);\n+    }\n+\n+    public static String getFullDataPath(MapleData data) {\n+        String path = \"\";\n+        MapleDataEntity myData = data;\n+        while (myData != null) {\n+            path = myData.getName() + \"/\" + path;\n+            myData = myData.getParent();\n+        }\n+        return path.substring(0, path.length() - 1);\n+    }\n+}"}, {"sha": "21736c2c162063c141117bff66deb9f830b4bc06", "filename": "tools/SpiderDropFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "status": "added", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/FileStoredPngMapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/FileStoredPngMapleCanvas.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,70 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import javax.imageio.ImageIO;\n+import provider.MapleCanvas;\n+\n+public class FileStoredPngMapleCanvas implements MapleCanvas {\n+    private File file;\n+    private int width;\n+    private int height;\n+    private BufferedImage image;\n+\n+    public FileStoredPngMapleCanvas(int width, int height, File fileIn) {\n+        this.width = width;\n+        this.height = height;\n+        this.file = fileIn;\n+    }\n+\n+    @Override\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    @Override\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    @Override\n+    public BufferedImage getImage() {\n+        loadImageIfNecessary();\n+        return image;\n+    }\n+\n+    private void loadImageIfNecessary() {\n+        if (image == null) {\n+            try {\n+                image = ImageIO.read(file);\n+                // replace the dimensions loaded from the wz by the REAL dimensions from the image - should be equal tho\n+                width = image.getWidth();\n+                height = image.getHeight();\n+            } catch (IOException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+    }\n+}"}, {"sha": "8add2ccb36fcfa8f1a683da0562601e9f2c0afda", "filename": "tools/SpiderDropFetcher/src/provider/wz/ImgMapleSound.java", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/ImgMapleSound.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/ImgMapleSound.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/ImgMapleSound.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,39 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+public class ImgMapleSound {\n+    private int dataLength, offset;\n+\n+    public ImgMapleSound(int dataLength, int offset) {\n+        this.dataLength = dataLength;\n+        this.offset = offset;\n+    }\n+\n+    public int getDataLength() {\n+        return dataLength;\n+    }\n+\n+    public int getOffset() {\n+        return offset;\n+    }\n+}"}, {"sha": "1672a08c598cb21a441ea89664de97fdb9b9c90b", "filename": "tools/SpiderDropFetcher/src/provider/wz/ListWZFile.java", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/ListWZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/ListWZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/ListWZFile.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,86 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.BufferedInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import provider.MapleDataProviderFactory;\n+import tools.data.input.GenericLittleEndianAccessor;\n+import tools.data.input.InputStreamByteStream;\n+import tools.data.input.LittleEndianAccessor;\n+\n+public class ListWZFile {\n+    private LittleEndianAccessor lea;\n+    private List<String> entries = new ArrayList<String>();\n+    private static Collection<String> modernImgs = new HashSet<String>();\n+\n+    public static byte[] xorBytes(byte[] a, byte[] b) {\n+        byte[] wusched = new byte[a.length];\n+        for (int i = 0; i < a.length; i++) {\n+            wusched[i] = (byte) (a[i] ^ b[i]);\n+        }\n+        return wusched;\n+    }\n+\n+    public ListWZFile(File listwz) throws FileNotFoundException {\n+        lea = new GenericLittleEndianAccessor(new InputStreamByteStream(new BufferedInputStream(new FileInputStream(listwz))));\n+        while (lea.available() > 0) {\n+            int l = lea.readInt() * 2;\n+            byte[] chunk = new byte[l];\n+            for (int i = 0; i < chunk.length; i++) {\n+                chunk[i] = lea.readByte();\n+            }\n+            lea.readChar();\n+            final String value = String.valueOf(WZTool.readListString(chunk));\n+            entries.add(value);\n+        }\n+        entries = Collections.unmodifiableList(entries);\n+    }\n+\n+    public List<String> getEntries() {\n+        return entries;\n+    }\n+\n+    public static void init() {\n+        final String listWz = System.getProperty(\"listwz\");\n+        if (listWz != null) {\n+            ListWZFile listwz;\n+            try {\n+                listwz = new ListWZFile(MapleDataProviderFactory.fileInWZPath(\"List.wz\"));\n+                modernImgs = new HashSet<String>(listwz.getEntries());\n+            } catch (FileNotFoundException e) {\n+                e.printStackTrace();\n+            }\n+        }\n+    }\n+\n+    public static boolean isModernImgFile(String path) {\n+        return modernImgs.contains(path);\n+    }\n+}"}, {"sha": "e074d57d14a16e7ccc38449c8f9b10d9176215eb", "filename": "tools/SpiderDropFetcher/src/provider/wz/MapleDataType.java", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/MapleDataType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/MapleDataType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/MapleDataType.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,26 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+public enum MapleDataType {\n+    NONE, IMG_0x00, SHORT, INT, FLOAT, DOUBLE, STRING, EXTENDED, PROPERTY, CANVAS, VECTOR, CONVEX, SOUND, UOL, UNKNOWN_TYPE, UNKNOWN_EXTENDED_TYPE;\n+}\n\\ No newline at end of file"}, {"sha": "97c2303804d63dbbfc36bb745fb675fff26b61a3", "filename": "tools/SpiderDropFetcher/src/provider/wz/PNGMapleCanvas.java", "status": "added", "additions": 151, "deletions": 0, "changes": 151, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/PNGMapleCanvas.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/PNGMapleCanvas.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/PNGMapleCanvas.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,151 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.awt.image.BufferedImage;\n+import java.awt.image.DataBuffer;\n+import java.awt.image.DataBufferByte;\n+import java.awt.image.PixelInterleavedSampleModel;\n+import java.awt.image.Raster;\n+import java.awt.image.SampleModel;\n+import java.awt.image.WritableRaster;\n+import java.util.zip.DataFormatException;\n+import java.util.zip.Inflater;\n+import provider.MapleCanvas;\n+\n+public class PNGMapleCanvas implements MapleCanvas {\n+    private static final int[] ZAHLEN = new int[]{2, 1, 0, 3};\n+    private int height;\n+    private int width;\n+    private int dataLength;\n+    private int format;\n+    private byte[] data;\n+\n+    public PNGMapleCanvas(int width, int height, int dataLength, int format, byte[] data) {\n+        super();\n+        this.height = height;\n+        this.width = width;\n+        this.dataLength = dataLength;\n+        this.format = format;\n+        this.data = data;\n+    }\n+\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    public int getFormat() {\n+        return format;\n+    }\n+\n+    private byte[] getData() {\n+        return data;\n+    }\n+\n+    @Override\n+    public BufferedImage getImage() {\n+        int sizeUncompressed = 0;\n+        int size8888 = 0;\n+        int maxWriteBuf = 2;\n+        int maxHeight = 3;\n+        byte[] writeBuf = new byte[maxWriteBuf];\n+        @SuppressWarnings (\"unused\")\n+        byte[] rowPointers = new byte[maxHeight];\n+        switch (getFormat()) {\n+            case 1:\n+            case 513:\n+                sizeUncompressed = getHeight() * getWidth() * 4;\n+                break;\n+            case 2:\n+                sizeUncompressed = getHeight() * getWidth() * 8;\n+                break;\n+            case 517:\n+                sizeUncompressed = getHeight() * getWidth() / 128;\n+                break;\n+        }\n+        size8888 = getHeight() * getWidth() * 8;\n+        if (size8888 > maxWriteBuf) {\n+            maxWriteBuf = size8888;\n+            writeBuf = new byte[maxWriteBuf];\n+        }\n+        if (getHeight() > maxHeight) {\n+            maxHeight = getHeight();\n+            rowPointers = new byte[maxHeight];\n+        }\n+        Inflater dec = new Inflater();\n+        dec.setInput(getData(), 0, dataLength);\n+        int declen = 0;\n+        byte[] uc = new byte[sizeUncompressed];\n+        try {\n+            declen = dec.inflate(uc);\n+        } catch (DataFormatException ex) {\n+            throw new RuntimeException(\"zlib fucks\", ex);\n+        }\n+        dec.end();\n+        if (getFormat() == 1) {\n+            for (int i = 0; i < sizeUncompressed; i++) {\n+                byte low = (byte) (uc[i] & 0x0F);\n+                byte high = (byte) (uc[i] & 0xF0);\n+                writeBuf[(i << 1)] = (byte) (((low << 4) | low) & 0xFF);\n+                writeBuf[(i << 1) + 1] = (byte) (high | ((high >>> 4) & 0xF));\n+            }\n+        } else if (getFormat() == 2) {\n+            writeBuf = uc;\n+        } else if (getFormat() == 513) {\n+            for (int i = 0; i < declen; i += 2) {\n+                byte bBits = (byte) ((uc[i] & 0x1F) << 3);\n+                byte gBits = (byte) (((uc[i + 1] & 0x07) << 5) | ((uc[i] & 0xE0) >> 3));\n+                byte rBits = (byte) (uc[i + 1] & 0xF8);\n+                writeBuf[(i << 1)] = (byte) (bBits | (bBits >> 5));\n+                writeBuf[(i << 1) + 1] = (byte) (gBits | (gBits >> 6));\n+                writeBuf[(i << 1) + 2] = (byte) (rBits | (rBits >> 5));\n+                writeBuf[(i << 1) + 3] = (byte) 0xFF;\n+            }\n+        } else if (getFormat() == 517) {\n+            byte b = 0x00;\n+            int pixelIndex = 0;\n+            for (int i = 0; i < declen; i++) {\n+                for (int j = 0; j < 8; j++) {\n+                    b = (byte) (((uc[i] & (0x01 << (7 - j))) >> (7 - j)) * 255);\n+                    for (int k = 0; k < 16; k++) {\n+                        pixelIndex = (i << 9) + (j << 6) + k * 2;\n+                        writeBuf[pixelIndex] = b;\n+                        writeBuf[pixelIndex + 1] = b;\n+                        writeBuf[pixelIndex + 2] = b;\n+                        writeBuf[pixelIndex + 3] = (byte) 0xFF;\n+                    }\n+                }\n+            }\n+        }\n+        DataBufferByte imgData = new DataBufferByte(writeBuf, sizeUncompressed);\n+        SampleModel sm = new PixelInterleavedSampleModel(DataBuffer.TYPE_BYTE, getWidth(), getHeight(), 4, getWidth() * 4, ZAHLEN);\n+        WritableRaster imgRaster = Raster.createWritableRaster(sm, imgData, new Point(0, 0));\n+        BufferedImage aa = new BufferedImage(getWidth(), getHeight(), BufferedImage.TYPE_INT_ARGB);\n+        aa.setData(imgRaster);\n+        return aa;\n+    }\n+}"}, {"sha": "d24b8cb2b992c82b360366af581c08599323781e", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZDirectoryEntry.java", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZDirectoryEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZDirectoryEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZDirectoryEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,68 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataEntity;\n+import provider.MapleDataEntry;\n+import provider.MapleDataFileEntry;\n+\n+public class WZDirectoryEntry extends WZEntry implements MapleDataDirectoryEntry {\n+    private List<MapleDataDirectoryEntry> subdirs = new ArrayList<MapleDataDirectoryEntry>();\n+    private List<MapleDataFileEntry> files = new ArrayList<MapleDataFileEntry>();\n+    private Map<String, MapleDataEntry> entries = new HashMap<String, MapleDataEntry>();\n+\n+    public WZDirectoryEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super(name, size, checksum, parent);\n+    }\n+\n+    public WZDirectoryEntry() {\n+        super(null, 0, 0, null);\n+    }\n+\n+    public void addDirectory(MapleDataDirectoryEntry dir) {\n+        subdirs.add(dir);\n+        entries.put(dir.getName(), dir);\n+    }\n+\n+    public void addFile(MapleDataFileEntry fileEntry) {\n+        files.add(fileEntry);\n+        entries.put(fileEntry.getName(), fileEntry);\n+    }\n+\n+    public List<MapleDataDirectoryEntry> getSubdirectories() {\n+        return Collections.unmodifiableList(subdirs);\n+    }\n+\n+    public List<MapleDataFileEntry> getFiles() {\n+        return Collections.unmodifiableList(files);\n+    }\n+\n+    public MapleDataEntry getEntry(String name) {\n+        return entries.get(name);\n+    }\n+}"}, {"sha": "1e921b208220663ddd15966a89f32f5cfbb4a8a2", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZEntry.java", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,61 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import provider.MapleDataEntity;\n+import provider.MapleDataEntry;\n+\n+public class WZEntry implements MapleDataEntry {\n+    private String name;\n+    private int size;\n+    private int checksum;\n+    private int offset;\n+    private MapleDataEntity parent;\n+\n+    public WZEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super();\n+        this.name = name;\n+        this.size = size;\n+        this.checksum = checksum;\n+        this.parent = parent;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public int getSize() {\n+        return size;\n+    }\n+\n+    public int getChecksum() {\n+        return checksum;\n+    }\n+\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    public MapleDataEntity getParent() {\n+        return parent;\n+    }\n+}"}, {"sha": "c6c0abf5377cf42dbf23295649d0b321fb497913", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZFile.java", "status": "added", "additions": 154, "deletions": 0, "changes": 154, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZFile.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,154 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.BufferedInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataFileEntry;\n+import provider.MapleDataProvider;\n+import tools.data.input.GenericLittleEndianAccessor;\n+import tools.data.input.GenericSeekableLittleEndianAccessor;\n+import tools.data.input.InputStreamByteStream;\n+import tools.data.input.LittleEndianAccessor;\n+import tools.data.input.RandomAccessByteStream;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+public class WZFile implements MapleDataProvider {\n+    static {\n+        ListWZFile.init();\n+    }\n+    private File wzfile;\n+    private LittleEndianAccessor lea;\n+    private SeekableLittleEndianAccessor slea;\n+    private int headerSize;\n+    private WZDirectoryEntry root;\n+    private boolean provideImages;\n+    private int cOffset;\n+\n+    public WZFile(File wzfile, boolean provideImages) throws IOException {\n+        this.wzfile = wzfile;\n+        lea = new GenericLittleEndianAccessor(new InputStreamByteStream(new BufferedInputStream(new FileInputStream(wzfile))));\n+        RandomAccessFile raf = new RandomAccessFile(wzfile, \"r\");\n+        slea = new GenericSeekableLittleEndianAccessor(new RandomAccessByteStream(raf));\n+        root = new WZDirectoryEntry(wzfile.getName(), 0, 0, null);\n+        this.provideImages = provideImages;\n+        load();\n+    }\n+\n+    private void load() throws IOException {\n+        lea.readAsciiString(4);\n+        lea.readInt();\n+        lea.readInt();\n+        headerSize = lea.readInt();\n+        lea.readNullTerminatedAsciiString();\n+        lea.readShort();\n+        parseDirectory(root);\n+        cOffset = (int) lea.getBytesRead();\n+        getOffsets(root);\n+    }\n+\n+    private void getOffsets(MapleDataDirectoryEntry dir) {\n+        for (MapleDataFileEntry file : dir.getFiles()) {\n+            file.setOffset(cOffset);\n+            cOffset += file.getSize();\n+        }\n+        for (MapleDataDirectoryEntry sdir : dir.getSubdirectories()) {\n+            getOffsets(sdir);\n+        }\n+    }\n+\n+    private void parseDirectory(WZDirectoryEntry dir) {\n+        int entries = WZTool.readValue(lea);\n+        for (int i = 0; i < entries; i++) {\n+            byte marker = lea.readByte();\n+            String name = null;\n+            int size, checksum;\n+            switch (marker) {\n+                case 0x02:\n+                    name = WZTool.readDecodedStringAtOffsetAndReset(slea, lea.readInt() + this.headerSize + 1);\n+                    size = WZTool.readValue(lea);\n+                    checksum = WZTool.readValue(lea);\n+                    lea.readInt(); //dummy int\n+                    dir.addFile(new WZFileEntry(name, size, checksum, dir));\n+                    break;\n+                case 0x03:\n+                case 0x04:\n+                    name = WZTool.readDecodedString(lea);\n+                    size = WZTool.readValue(lea);\n+                    checksum = WZTool.readValue(lea);\n+                    lea.readInt(); //dummy int\n+                    if (marker == 3) {\n+                        dir.addDirectory(new WZDirectoryEntry(name, size, checksum, dir));\n+                    } else {\n+                        dir.addFile(new WZFileEntry(name, size, checksum, dir));\n+                    }\n+                    break;\n+                default:\n+            }\n+        }\n+        for (MapleDataDirectoryEntry idir : dir.getSubdirectories()) {\n+            parseDirectory((WZDirectoryEntry) idir);\n+        }\n+    }\n+\n+    public WZIMGFile getImgFile(String path) throws IOException {\n+        String segments[] = path.split(\"/\");\n+        WZDirectoryEntry dir = root;\n+        for (int x = 0; x < segments.length - 1; x++) {\n+            dir = (WZDirectoryEntry) dir.getEntry(segments[x]);\n+            if (dir == null) {\n+                return null;\n+            }\n+        }\n+        WZFileEntry entry = (WZFileEntry) dir.getEntry(segments[segments.length - 1]);\n+        if (entry == null) {\n+            return null;\n+        }\n+        String fullPath = wzfile.getName().substring(0, wzfile.getName().length() - 3).toLowerCase() + \"/\" + path;\n+        return new WZIMGFile(this.wzfile, entry, provideImages, ListWZFile.isModernImgFile(fullPath));\n+    }\n+\n+    @Override\n+    public synchronized MapleData getData(String path) {\n+        try {\n+            WZIMGFile imgFile = getImgFile(path);\n+            if (imgFile == null) {\n+                return null;\n+            }\n+            MapleData ret = imgFile.getRoot();\n+            return ret;\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public MapleDataDirectoryEntry getRoot() {\n+        return root;\n+    }\n+}"}, {"sha": "792371d9cf3ef340e9c895ec2143cf2918a92952", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZFileEntry.java", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZFileEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZFileEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZFileEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,42 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import provider.MapleDataEntity;\n+import provider.MapleDataFileEntry;\n+\n+public class WZFileEntry extends WZEntry implements MapleDataFileEntry {\n+    private int offset;\n+\n+    public WZFileEntry(String name, int size, int checksum, MapleDataEntity parent) {\n+        super(name, size, checksum, parent);\n+    }\n+\n+    @Override\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    public void setOffset(int offset) {\n+        this.offset = offset;\n+    }\n+}"}, {"sha": "385d78518357407cf131b0197f29c175b9815c9c", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZIMGEntry.java", "status": "added", "additions": 118, "deletions": 0, "changes": 118, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZIMGEntry.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZIMGEntry.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZIMGEntry.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,118 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.List;\n+import provider.MapleData;\n+import provider.MapleDataEntity;\n+\n+public class WZIMGEntry implements MapleData {\n+    private String name;\n+    private MapleDataType type;\n+    private List<MapleData> children = new ArrayList<MapleData>(10);\n+    private Object data;\n+    private MapleDataEntity parent;\n+\n+    public WZIMGEntry(MapleDataEntity parent) {\n+        this.parent = parent;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return name;\n+    }\n+\n+    @Override\n+    public MapleDataType getType() {\n+        return type;\n+    }\n+\n+    @Override\n+    public List<MapleData> getChildren() {\n+        return Collections.unmodifiableList(children);\n+    }\n+\n+    @Override\n+    public MapleData getChildByPath(String path) {\n+        String segments[] = path.split(\"/\");\n+        if (segments[0].equals(\"..\")) {\n+            return ((MapleData) getParent()).getChildByPath(path.substring(path.indexOf(\"/\") + 1));\n+        }\n+        MapleData ret = this;\n+        for (int x = 0; x < segments.length; x++) {\n+            boolean foundChild = false;\n+            for (MapleData child : ret.getChildren()) {\n+                if (child.getName().equals(segments[x])) {\n+                    ret = child;\n+                    foundChild = true;\n+                    break;\n+                }\n+            }\n+            if (!foundChild) {\n+                return null;\n+            }\n+        }\n+        return ret;\n+    }\n+\n+    @Override\n+    public Object getData() {\n+        return data;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public void setType(MapleDataType type) {\n+        this.type = type;\n+    }\n+\n+    public void setData(Object data) {\n+        this.data = data;\n+    }\n+\n+    public void addChild(WZIMGEntry entry) {\n+        children.add(entry);\n+    }\n+\n+    @Override\n+    public Iterator<MapleData> iterator() {\n+        return getChildren().iterator();\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return getName() + \":\" + getData();\n+    }\n+\n+    public MapleDataEntity getParent() {\n+        return parent;\n+    }\n+\n+    public void finish() {\n+        ((ArrayList<MapleData>) children).trimToSize();\n+    }\n+}"}, {"sha": "bec06c78bdf9568da3ea9819f896e22bbc7f7c44", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZIMGFile.java", "status": "added", "additions": 227, "deletions": 0, "changes": 227, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZIMGFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZIMGFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZIMGFile.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,227 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.io.DataOutputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.RandomAccessFile;\n+import tools.data.input.GenericSeekableLittleEndianAccessor;\n+import tools.data.input.RandomAccessByteStream;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+public class WZIMGFile {\n+    private WZFileEntry file;\n+    private WZIMGEntry root;\n+    private boolean provideImages;\n+    @SuppressWarnings (\"unused\")\n+    private boolean modernImg;\n+\n+    public WZIMGFile(File wzfile, WZFileEntry file, boolean provideImages, boolean modernImg) throws IOException {\n+        RandomAccessFile raf = new RandomAccessFile(wzfile, \"r\");\n+        SeekableLittleEndianAccessor slea = new GenericSeekableLittleEndianAccessor(new RandomAccessByteStream(raf));\n+        slea.seek(file.getOffset());\n+        this.file = file;\n+        this.provideImages = provideImages;\n+        root = new WZIMGEntry(file.getParent());\n+        root.setName(file.getName());\n+        root.setType(MapleDataType.EXTENDED);\n+        this.modernImg = modernImg;\n+        parseExtended(root, slea, 0);\n+        root.finish();\n+        raf.close();\n+    }\n+\n+    protected void dumpImg(OutputStream out, SeekableLittleEndianAccessor slea) throws IOException {\n+        DataOutputStream os = new DataOutputStream(out);\n+        long oldPos = slea.getPosition();\n+        slea.seek(file.getOffset());\n+        for (int x = 0; x < file.getSize(); x++) {\n+            os.write(slea.readByte());\n+        }\n+        slea.seek(oldPos);\n+    }\n+\n+    public WZIMGEntry getRoot() {\n+        return root;\n+    }\n+\n+    private void parse(WZIMGEntry entry, SeekableLittleEndianAccessor slea) {\n+        byte marker = slea.readByte();\n+        switch (marker) {\n+            case 0: {\n+                String name = WZTool.readDecodedString(slea);\n+                entry.setName(name);\n+                break;\n+            }\n+            case 1: {\n+                String name = WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt());\n+                entry.setName(name);\n+                break;\n+            }\n+            default:\n+                System.out.println(\"Unknown Image identifier: \" + marker + \" at offset \" + (slea.getPosition() - file.getOffset()));\n+        }\n+        marker = slea.readByte();\n+        switch (marker) {\n+            case 0:\n+                entry.setType(MapleDataType.IMG_0x00);\n+                break;\n+            case 2:\n+            case 11: //??? no idea, since 0.49\n+                entry.setType(MapleDataType.SHORT);\n+                entry.setData(Short.valueOf(slea.readShort()));\n+                break;\n+            case 3:\n+                entry.setType(MapleDataType.INT);\n+                entry.setData(Integer.valueOf(WZTool.readValue(slea)));\n+                break;\n+            case 4:\n+                entry.setType(MapleDataType.FLOAT);\n+                entry.setData(Float.valueOf(WZTool.readFloatValue(slea)));\n+                break;\n+            case 5:\n+                entry.setType(MapleDataType.DOUBLE);\n+                entry.setData(Double.valueOf(slea.readDouble()));\n+                break;\n+            case 8:\n+                entry.setType(MapleDataType.STRING);\n+                byte iMarker = slea.readByte();\n+                if (iMarker == 0) {\n+                    entry.setData(WZTool.readDecodedString(slea));\n+                } else if (iMarker == 1) {\n+                    entry.setData(WZTool.readDecodedStringAtOffsetAndReset(slea, slea.readInt() + file.getOffset()));\n+                } else {\n+                    System.out.println(\"Unknown String type \" + iMarker);\n+                }\n+                break;\n+            case 9:\n+                entry.setType(MapleDataType.EXTENDED);\n+                long endOfExtendedBlock = slea.readInt();\n+                endOfExtendedBlock += slea.getPosition();\n+                parseExtended(entry, slea, endOfExtendedBlock);\n+                break;\n+            default:\n+                System.out.println(\"Unknown Image type \" + marker);\n+        }\n+    }\n+\n+    private void parseExtended(WZIMGEntry entry, SeekableLittleEndianAccessor slea, long endOfExtendedBlock) {\n+        byte marker = slea.readByte();\n+        String type;\n+        switch (marker) {\n+            case 0x73:\n+                type = WZTool.readDecodedString(slea);\n+                break;\n+            case 0x1B:\n+                type = WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt());\n+                break;\n+            default:\n+                throw new RuntimeException(\"Unknown extended image identifier: \" + marker + \" at offset \" +\n+                        (slea.getPosition() - file.getOffset()));\n+        }\n+        if (type.equals(\"Property\")) {\n+            entry.setType(MapleDataType.PROPERTY);\n+            slea.readByte();\n+            slea.readByte();\n+            int children = WZTool.readValue(slea);\n+            for (int i = 0; i < children; i++) {\n+                WZIMGEntry cEntry = new WZIMGEntry(entry);\n+                parse(cEntry, slea);\n+                cEntry.finish();\n+                entry.addChild(cEntry);\n+            }\n+        } else if (type.equals(\"Canvas\")) {\n+            entry.setType(MapleDataType.CANVAS);\n+            slea.readByte();\n+            marker = slea.readByte();\n+            if (marker == 0) {\n+                // do nothing\n+            } else if (marker == 1) {\n+                slea.readByte();\n+                slea.readByte();\n+                int children = WZTool.readValue(slea);\n+                for (int i = 0; i < children; i++) {\n+                    WZIMGEntry child = new WZIMGEntry(entry);\n+                    parse(child, slea);\n+                    child.finish();\n+                    entry.addChild(child);\n+                }\n+            } else {\n+                System.out.println(\"Canvas marker != 1 (\" + marker + \")\");\n+            }\n+            int width = WZTool.readValue(slea);\n+            int height = WZTool.readValue(slea);\n+            int format = WZTool.readValue(slea);\n+            int format2 = slea.readByte();\n+            slea.readInt();\n+            int dataLength = slea.readInt() - 1;\n+            slea.readByte();\n+            if (provideImages) {\n+                byte[] pngdata = slea.read(dataLength);\n+                entry.setData(new PNGMapleCanvas(width, height, dataLength, format + format2, pngdata));\n+            } else {\n+                entry.setData(new PNGMapleCanvas(width, height, dataLength, format + format2, null));\n+                slea.skip(dataLength);\n+            }\n+        } else if (type.equals(\"Shape2D#Vector2D\")) {\n+            entry.setType(MapleDataType.VECTOR);\n+            int x = WZTool.readValue(slea);\n+            int y = WZTool.readValue(slea);\n+            entry.setData(new Point(x, y));\n+        } else if (type.equals(\"Shape2D#Convex2D\")) {\n+            int children = WZTool.readValue(slea);\n+            for (int i = 0; i < children; i++) {\n+                WZIMGEntry cEntry = new WZIMGEntry(entry);\n+                parseExtended(cEntry, slea, 0);\n+                cEntry.finish();\n+                entry.addChild(cEntry);\n+            }\n+        } else if (type.equals(\"Sound_DX8\")) {\n+            entry.setType(MapleDataType.SOUND);\n+            slea.readByte();\n+            int dataLength = WZTool.readValue(slea);\n+            WZTool.readValue(slea); // no clue what this is\n+            int offset = (int) slea.getPosition();\n+            entry.setData(new ImgMapleSound(dataLength, offset - file.getOffset()));\n+            slea.seek(endOfExtendedBlock);\n+        } else if (type.equals(\"UOL\")) {\n+            entry.setType(MapleDataType.UOL);\n+            slea.readByte();\n+            byte uolmarker = slea.readByte();\n+            switch (uolmarker) {\n+                case 0:\n+                    entry.setData(WZTool.readDecodedString(slea));\n+                    break;\n+                case 1:\n+                    entry.setData(WZTool.readDecodedStringAtOffsetAndReset(slea, file.getOffset() + slea.readInt()));\n+                    break;\n+                default:\n+                    System.out.println(\"Unknown UOL marker: \" + uolmarker + \" \" + entry.getName());\n+            }\n+        } else {\n+            throw new RuntimeException(\"Unhandled extended type: \" + type);\n+        }\n+    }\n+}"}, {"sha": "85e1c8d90b12ad81599c4bc39bd3af48af60deeb", "filename": "tools/SpiderDropFetcher/src/provider/wz/WZTool.java", "status": "added", "additions": 187, "deletions": 0, "changes": 187, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/WZTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/WZTool.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,187 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.security.InvalidKeyException;\n+import java.security.NoSuchAlgorithmException;\n+import javax.crypto.BadPaddingException;\n+import javax.crypto.Cipher;\n+import javax.crypto.IllegalBlockSizeException;\n+import javax.crypto.NoSuchPaddingException;\n+import javax.crypto.spec.SecretKeySpec;\n+import tools.data.input.LittleEndianAccessor;\n+import tools.data.input.SeekableLittleEndianAccessor;\n+\n+/*\n+ * Ported Code, see WZFile.java for more info\n+ */\n+public class WZTool {\n+    private static byte[] encKey;\n+\n+    static {\n+        byte[] iv = new byte[]{(byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,\n+            (byte) 0x4d, (byte) 0x23, (byte) 0xc7, (byte) 0x2b,};\n+        byte[] key = new byte[]{(byte) 0x13, 0x00, 0x00, 0x00,\n+            (byte) 0x08, 0x00, 0x00, 0x00,\n+            (byte) 0x06, 0x00, 0x00, 0x00,\n+            (byte) 0xB4, 0x00, 0x00, 0x00,\n+            (byte) 0x1B, 0x00, 0x00, 0x00,\n+            (byte) 0x0F, 0x00, 0x00, 0x00,\n+            (byte) 0x33, 0x00, 0x00, 0x00,\n+            (byte) 0x52, 0x00, 0x00, 0x00\n+        };\n+        Cipher cipher = null;\n+        SecretKeySpec skeySpec = new SecretKeySpec(key, \"AES\");\n+        try {\n+            cipher = Cipher.getInstance(\"AES\");\n+        } catch (NoSuchAlgorithmException e) {\n+            e.printStackTrace();\n+        } catch (NoSuchPaddingException e) {\n+            e.printStackTrace();\n+        }\n+        try {\n+            cipher.init(Cipher.ENCRYPT_MODE, skeySpec);\n+        } catch (InvalidKeyException e) {\n+            e.printStackTrace();\n+        }\n+        encKey = new byte[0xFFFF];\n+        for (int i = 0; i < (0xFFFF / 16); i++) {\n+            try {\n+                iv = cipher.doFinal(iv);\n+            } catch (IllegalBlockSizeException e) {\n+                e.printStackTrace();\n+            } catch (BadPaddingException e) {\n+                e.printStackTrace();\n+            }\n+            System.arraycopy(iv, 0, encKey, (i * 16), 16);\n+        }\n+        try {\n+            iv = cipher.doFinal(iv);\n+        } catch (IllegalBlockSizeException e) {\n+            e.printStackTrace();\n+        } catch (BadPaddingException e) {\n+            e.printStackTrace();\n+        }\n+        System.arraycopy(iv, 0, encKey, 65520, 15);\n+    }\n+\n+    public static byte[] readListString(byte[] str) {\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ encKey[i]);\n+        }\n+        return str;\n+    }\n+\n+    public static String readDecodedString(LittleEndianAccessor llea) {\n+        int strLength;\n+        byte b = llea.readByte();\n+        if (b == 0x00) {\n+            return \"\";\n+        }\n+        if (b >= 0) {\n+            if (b == 0x7F) {\n+                strLength = llea.readInt();\n+            } else {\n+                strLength = (int) b;\n+            }\n+            if (strLength < 0) {\n+                return \"\";\n+            }\n+            byte str[] = new byte[strLength * 2];\n+            for (int i = 0; i < strLength * 2; i++) {\n+                str[i] = llea.readByte();\n+            }\n+            return DecryptUnicodeStr(str);\n+        } else {\n+            if (b == -128) {\n+                strLength = llea.readInt();\n+            } else {\n+                strLength = -b;\n+            }\n+            if (strLength < 0) {\n+                return \"\";\n+            }\n+            byte str[] = new byte[strLength];\n+            for (int i = 0; i < strLength; i++) {\n+                str[i] = llea.readByte();\n+            }\n+            return DecryptAsciiStr(str);\n+        }\n+    }\n+\n+    public static String DecryptAsciiStr(byte[] str) {\n+        byte xorByte = (byte) 0xAA;\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ xorByte ^ encKey[i]);\n+            xorByte++;\n+        }\n+        return new String(str);\n+    }\n+\n+    public static String DecryptUnicodeStr(byte[] str) {\n+        int xorByte = 0xAAAA;\n+        char[] charRet = new char[str.length / 2];\n+        for (int i = 0; i < str.length; i++) {\n+            str[i] = (byte) (str[i] ^ encKey[i]);\n+        }\n+        for (int i = 0; i < (str.length / 2); i++) {\n+            char toXor = (char) ((str[i] << 8) | str[i + 1]);\n+            charRet[i] = (char) (toXor ^ xorByte);\n+            xorByte++;\n+        }\n+        return String.valueOf(charRet);\n+    }\n+\n+    public static String readDecodedStringAtOffset(SeekableLittleEndianAccessor slea, int offset) {\n+        slea.seek(offset);\n+        return readDecodedString(slea);\n+    }\n+\n+    public static String readDecodedStringAtOffsetAndReset(SeekableLittleEndianAccessor slea, int offset) {\n+        long pos = 0;\n+        pos = slea.getPosition();\n+        slea.seek(offset);\n+        String ret = readDecodedString(slea);\n+        slea.seek(pos);\n+        return ret;\n+    }\n+\n+    public static int readValue(LittleEndianAccessor lea) {\n+        byte b = lea.readByte();\n+        if (b == -128) {\n+            return lea.readInt();\n+        } else {\n+            return ((int) b);\n+        }\n+    }\n+\n+    public static float readFloatValue(LittleEndianAccessor lea) {\n+        byte b = lea.readByte();\n+        if (b == -128) {\n+            return lea.readFloat();\n+        } else {\n+            return 0;\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "f8756a869682b3af2375894a63047991363ccd68", "filename": "tools/SpiderDropFetcher/src/provider/wz/XMLDomMapleData.java", "status": "added", "additions": 225, "deletions": 0, "changes": 225, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/XMLDomMapleData.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/XMLDomMapleData.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/XMLDomMapleData.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,225 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package provider.wz;\n+\n+import java.awt.Point;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.text.NumberFormat;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Locale;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import provider.MapleData;\n+import provider.MapleDataEntity;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.NamedNodeMap;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class XMLDomMapleData implements MapleData {\n+\tprivate Node node;\n+\tprivate File imageDataDir;\n+        private final static NumberFormat nfParser = NumberFormat.getInstance(Locale.FRANCE);\n+\n+\tpublic XMLDomMapleData(FileInputStream fis, File imageDataDir) {\n+\t\ttry {\n+\t\t\tDocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\n+\t\t\tDocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();\n+\t\t\tDocument document = documentBuilder.parse(fis);\n+\t\t\tthis.node = document.getFirstChild();\n+\t\t} catch (ParserConfigurationException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t} catch (SAXException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new RuntimeException(e);\n+\t\t}\n+\t\tthis.imageDataDir = imageDataDir;\n+\t}\n+\n+\tprivate XMLDomMapleData(Node node) {\n+\t\tthis.node = node;\n+\t}\n+\n+\t@Override\n+\tpublic synchronized MapleData getChildByPath(String path) {  // the whole XML reading system seems susceptible to give nulls on strenuous read scenarios\n+\t\tString segments[] = path.split(\"/\");\n+\t\tif (segments[0].equals(\"..\")) {\n+\t\t\treturn ((MapleData) getParent()).getChildByPath(path.substring(path.indexOf(\"/\") + 1));\n+\t\t}\n+\n+                Node myNode;\n+                myNode = node;\n+                for (String s : segments) {\n+                        NodeList childNodes = myNode.getChildNodes();\n+                        boolean foundChild = false;\n+                        for (int i = 0; i < childNodes.getLength(); i++) {\n+                                Node childNode = childNodes.item(i);\n+                                if (childNode.getNodeType() == Node.ELEMENT_NODE && childNode.getAttributes().getNamedItem(\"name\").getNodeValue().equals(s)) {\n+                                        myNode = childNode;\n+                                        foundChild = true;\n+                                        break;\n+                                }\n+                        }\n+                        if (!foundChild) {\n+                                return null;\n+                        }\n+                }\n+                \n+\t\tXMLDomMapleData ret = new XMLDomMapleData(myNode);\n+\t\tret.imageDataDir = new File(imageDataDir, getName() + \"/\" + path).getParentFile();\n+\t\treturn ret;\n+\t}\n+\n+\t@Override\n+\tpublic synchronized List<MapleData> getChildren() {\n+\t\tList<MapleData> ret = new ArrayList<>();\n+                \n+                NodeList childNodes = node.getChildNodes();\n+                for (int i = 0; i < childNodes.getLength(); i++) {\n+                        Node childNode = childNodes.item(i);\n+                        if (childNode.getNodeType() == Node.ELEMENT_NODE) {\n+                                XMLDomMapleData child = new XMLDomMapleData(childNode);\n+                                child.imageDataDir = new File(imageDataDir, getName());\n+                                ret.add(child);\n+                        }\n+                }\n+                \n+\t\treturn ret;\n+\t}\n+\n+        public synchronized static Number parseNumber(String value) {\n+            try {\n+                return nfParser.parse(value);\n+            } catch(Exception e) {\n+                e.printStackTrace();\n+                return 0.0f;\n+            }\n+        }\n+        \n+\t@Override\n+\tpublic synchronized Object getData() {\n+                NamedNodeMap attributes = node.getAttributes();\n+                MapleDataType type = getType();\n+                switch (type) {\n+                        case DOUBLE:\n+                        case FLOAT:\n+                        case INT:\n+                        case SHORT: {\n+                                String value = attributes.getNamedItem(\"value\").getNodeValue();\n+                                Number nval = parseNumber(value);\n+\n+                                switch (type) {\n+                                        case DOUBLE:\n+                                                return nval.doubleValue();\n+                                        case FLOAT:\n+                                                return nval.floatValue();\n+                                        case INT:\n+                                                return nval.intValue();\n+                                        case SHORT:\n+                                                return nval.shortValue();\n+                                        default:\n+                                                return null;\n+                                }\n+                        }\n+                        case STRING:\n+                        case UOL: {\n+                                String value = attributes.getNamedItem(\"value\").getNodeValue();\n+                                return value;\n+                        }\n+                        case VECTOR: {\n+                                String x = attributes.getNamedItem(\"x\").getNodeValue();\n+                                String y = attributes.getNamedItem(\"y\").getNodeValue();\n+                                return new Point(Integer.parseInt(x), Integer.parseInt(y));\n+                        }\n+                        case CANVAS: {\n+                                String width = attributes.getNamedItem(\"width\").getNodeValue();\n+                                String height = attributes.getNamedItem(\"height\").getNodeValue();\n+                                return new FileStoredPngMapleCanvas(Integer.parseInt(width), Integer.parseInt(height), new File(\n+                                                imageDataDir, getName() + \".png\"));\n+                        }\n+                        default:\n+                                return null;\n+                }\n+\t}\n+\n+\t@Override\n+\tpublic synchronized MapleDataType getType() {\n+                String nodeName = node.getNodeName();\n+                \n+                switch (nodeName) {\n+                    case \"imgdir\":\n+                        return MapleDataType.PROPERTY;\n+                    case \"canvas\":\n+                        return MapleDataType.CANVAS;\n+                    case \"convex\":\n+                        return MapleDataType.CONVEX;\n+                    case \"sound\":\n+                        return MapleDataType.SOUND;\n+                    case \"uol\":\n+                        return MapleDataType.UOL;\n+                    case \"double\":\n+                        return MapleDataType.DOUBLE;\n+                    case \"float\":\n+                        return MapleDataType.FLOAT;\n+                    case \"int\":\n+                        return MapleDataType.INT;\n+                    case \"short\":\n+                        return MapleDataType.SHORT;\n+                    case \"string\":\n+                        return MapleDataType.STRING;\n+                    case \"vector\":\n+                        return MapleDataType.VECTOR;\n+                    case \"null\":\n+                        return MapleDataType.IMG_0x00;\n+                }\n+\t\treturn null;\n+\t}\n+\n+\t@Override\n+\tpublic synchronized MapleDataEntity getParent() {\n+                Node parentNode;\n+                parentNode = node.getParentNode();\n+                if (parentNode.getNodeType() == Node.DOCUMENT_NODE) {\n+                        return null;\n+                }\n+\t\tXMLDomMapleData parentData = new XMLDomMapleData(parentNode);\n+\t\tparentData.imageDataDir = imageDataDir.getParentFile();\n+\t\treturn parentData;\n+\t}\n+\n+\t@Override\n+\tpublic synchronized String getName() {\n+                return node.getAttributes().getNamedItem(\"name\").getNodeValue();\n+\t}\n+\n+\t@Override\n+\tpublic synchronized Iterator<MapleData> iterator() {\n+\t\treturn getChildren().iterator();\n+\t}\n+}"}, {"sha": "2a7694fdc97c511f4e0d4b894967b02d813683be", "filename": "tools/SpiderDropFetcher/src/provider/wz/XMLWZFile.java", "status": "added", "additions": 85, "deletions": 0, "changes": 85, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/XMLWZFile.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/provider/wz/XMLWZFile.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/provider/wz/XMLWZFile.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,85 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package provider.wz;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import provider.MapleData;\n+import provider.MapleDataDirectoryEntry;\n+import provider.MapleDataProvider;\n+\n+public class XMLWZFile implements MapleDataProvider {\n+    private File root;\n+    private WZDirectoryEntry rootForNavigation;\n+\n+    public XMLWZFile(File fileIn) {\n+        root = fileIn;\n+        rootForNavigation = new WZDirectoryEntry(fileIn.getName(), 0, 0, null);\n+        fillMapleDataEntitys(root, rootForNavigation);\n+    }\n+\n+    private void fillMapleDataEntitys(File lroot, WZDirectoryEntry wzdir) {\n+        for (File file : lroot.listFiles()) {\n+            String fileName = file.getName();\n+            if (file.isDirectory() && !fileName.endsWith(\".img\")) {\n+                WZDirectoryEntry newDir = new WZDirectoryEntry(fileName, 0, 0, wzdir);\n+                wzdir.addDirectory(newDir);\n+                fillMapleDataEntitys(file, newDir);\n+            } else if (fileName.endsWith(\".xml\")) {\n+                wzdir.addFile(new WZFileEntry(fileName.substring(0, fileName.length() - 4), 0, 0, wzdir));\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public MapleData getData(String path) {\n+        File dataFile = new File(root, path + \".xml\");\n+        File imageDataDir = new File(root, path);\n+        if (!dataFile.exists()) {\n+            return null;//bitches\n+        }\n+        FileInputStream fis;\n+        try {\n+            fis = new FileInputStream(dataFile);\n+        } catch (FileNotFoundException e) {\n+            throw new RuntimeException(\"Datafile \" + path + \" does not exist in \" + root.getAbsolutePath());\n+        }\n+        final XMLDomMapleData domMapleData;\n+        try {\n+            domMapleData = new XMLDomMapleData(fis, imageDataDir.getParentFile());\n+        } finally {\n+            try {\n+                fis.close();\n+            } catch (IOException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+        return domMapleData;\n+    }\n+\n+    @Override\n+    public MapleDataDirectoryEntry getRoot() {\n+        return rootForNavigation;\n+    }\n+}"}, {"sha": "b215841610afe6bdbea387880b26c95ba9e38bbc", "filename": "tools/SpiderDropFetcher/src/server/MapleItemInformationProvider.java", "status": "added", "additions": 147, "deletions": 0, "changes": 147, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/server/MapleItemInformationProvider.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,147 @@\n+/*\n+ This file is part of the OdinMS Maple Story Server\n+ Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+ Matthias Butz <matze@odinms.de>\n+ Jan Christian Meyer <vimes@odinms.de>\n+\n+ This program is free software: you can redistribute it and/or modify\n+ it under the terms of the GNU Affero General Public License as\n+ published by the Free Software Foundation version 3 as published by\n+ the Free Software Foundation. You may not use, modify or distribute\n+ this program under any other version of the GNU Affero General Public\n+ License.\n+\n+ This program is distributed in the hope that it will be useful,\n+ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ GNU Affero General Public License for more details.\n+\n+ You should have received a copy of the GNU Affero General Public License\n+ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package server;\n+\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import provider.MapleData;\n+import provider.MapleDataProvider;\n+import provider.MapleDataProviderFactory;\n+import provider.MapleDataTool;\n+import tools.Pair;\n+\n+/**\n+ *\n+ * @author Matze\n+ *\n+ */\n+public class MapleItemInformationProvider {\n+    private final static MapleItemInformationProvider instance = new MapleItemInformationProvider();\n+    \n+    public static MapleItemInformationProvider getInstance() {\n+        return instance;\n+    }\n+    \n+    protected MapleDataProvider itemData;\n+    protected MapleDataProvider equipData;\n+    protected MapleDataProvider stringData;\n+    protected MapleDataProvider etcData;\n+    protected MapleData cashStringData;\n+    protected MapleData consumeStringData;\n+    protected MapleData eqpStringData;\n+    protected MapleData etcStringData;\n+    protected MapleData insStringData;\n+    protected MapleData petStringData;\n+    protected Map<Integer, Boolean> isQuestItemCache = new HashMap<>();\n+    protected Map<Integer, Boolean> isPartyQuestItemCache = new HashMap<>();\n+    protected List<Pair<Integer, String>> itemNameCache = new ArrayList<>();\n+\n+    private MapleItemInformationProvider() {\n+        itemData = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Item.wz\"));\n+        equipData = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Character.wz\"));\n+        stringData = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/String.wz\"));\n+        etcData = MapleDataProviderFactory.getDataProvider(new File(System.getProperty(\"wzpath\") + \"/Etc.wz\"));\n+        cashStringData = stringData.getData(\"Cash.img\");\n+        consumeStringData = stringData.getData(\"Consume.img\");\n+        eqpStringData = stringData.getData(\"Eqp.img\");\n+        etcStringData = stringData.getData(\"Etc.img\");\n+        insStringData = stringData.getData(\"Ins.img\");\n+        petStringData = stringData.getData(\"Pet.img\");\n+        \n+        isQuestItemCache.put(0, false);\n+        isPartyQuestItemCache.put(0, false);\n+    }\n+\n+//    public MapleInventoryType getInventoryType(int itemId) {\n+//        if (inventoryTypeCache.containsKey(itemId)) {\n+//            return inventoryTypeCache.get(itemId);\n+//        }\n+//        MapleInventoryType ret;\n+//        String idStr = \"0\" + String.valueOf(itemId);\n+//        MapleDataDirectoryEntry root = itemData.getRoot();\n+//        for (MapleDataDirectoryEntry topDir : root.getSubdirectories()) {\n+//            for (MapleDataFileEntry iFile : topDir.getFiles()) {\n+//                if (iFile.getName().equals(idStr.substring(0, 4) + \".img\")) {\n+//                    ret = MapleInventoryType.getByWZName(topDir.getName());\n+//                    inventoryTypeCache.put(itemId, ret);\n+//                    return ret;\n+//                } else if (iFile.getName().equals(idStr.substring(1) + \".img\")) {\n+//                    ret = MapleInventoryType.getByWZName(topDir.getName());\n+//                    inventoryTypeCache.put(itemId, ret);\n+//                    return ret;\n+//                }\n+//            }\n+//        }\n+//        root = equipData.getRoot();\n+//        for (MapleDataDirectoryEntry topDir : root.getSubdirectories()) {\n+//            for (MapleDataFileEntry iFile : topDir.getFiles()) {\n+//                if (iFile.getName().equals(idStr + \".img\")) {\n+//                    ret = MapleInventoryType.EQUIP;\n+//                    inventoryTypeCache.put(itemId, ret);\n+//                    return ret;\n+//                }\n+//            }\n+//        }\n+//        ret = MapleInventoryType.UNDEFINED;\n+//        inventoryTypeCache.put(itemId, ret);\n+//        return ret;\n+//    }\n+\n+    public List<Pair<Integer, String>> getAllItems() {\n+        if (!itemNameCache.isEmpty()) {\n+            return itemNameCache;\n+        }\n+        List<Pair<Integer, String>> itemPairs = new ArrayList<>();\n+        MapleData itemsData;\n+        itemsData = stringData.getData(\"Cash.img\");\n+        for (MapleData itemFolder : itemsData.getChildren()) {\n+            itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+        }\n+        itemsData = stringData.getData(\"Consume.img\");\n+        for (MapleData itemFolder : itemsData.getChildren()) {\n+            itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+        }\n+        itemsData = stringData.getData(\"Eqp.img\").getChildByPath(\"Eqp\");\n+        for (MapleData eqpType : itemsData.getChildren()) {\n+            for (MapleData itemFolder : eqpType.getChildren()) {\n+                itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+            }\n+        }\n+        itemsData = stringData.getData(\"Etc.img\").getChildByPath(\"Etc\");\n+        for (MapleData itemFolder : itemsData.getChildren()) {\n+            itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+        }\n+        itemsData = stringData.getData(\"Ins.img\");\n+        for (MapleData itemFolder : itemsData.getChildren()) {\n+            itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+        }\n+        itemsData = stringData.getData(\"Pet.img\");\n+        for (MapleData itemFolder : itemsData.getChildren()) {\n+            itemPairs.add(new Pair<>(Integer.parseInt(itemFolder.getName()), MapleDataTool.getString(\"name\", itemFolder, \"NO-NAME\")));\n+        }\n+        return itemPairs;\n+    }\n+}"}, {"sha": "428baf3115e06febc867111508623988810846ce", "filename": "tools/SpiderDropFetcher/src/tools/HexTool.java", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/HexTool.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/HexTool.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/HexTool.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,87 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools;\n+\n+import java.io.ByteArrayOutputStream;\n+\n+public class HexTool {\n+    private static final char[] HEX = {'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'};\n+\n+    private static String toString(byte byteValue) {\n+        int tmp = byteValue << 8;\n+        char[] retstr = new char[]{HEX[(tmp >> 12) & 0x0F], HEX[(tmp >> 8) & 0x0F]};\n+        return String.valueOf(retstr);\n+    }\n+\n+    public static String toString(byte[] bytes) {\n+        StringBuilder hexed = new StringBuilder();\n+        for (int i = 0; i < bytes.length; i++) {\n+            hexed.append(toString(bytes[i]));\n+            hexed.append(' ');\n+        }\n+        return hexed.substring(0, hexed.length() - 1);\n+    }\n+    \n+    public static String toCompressedString(byte[] bytes) {\n+        StringBuilder hexed = new StringBuilder();\n+        for (int i = 0; i < bytes.length; i++) {\n+            hexed.append(toString(bytes[i]));\n+        }\n+        return hexed.substring(0, hexed.length());\n+    }\n+\n+    public static byte[] getByteArrayFromHexString(String hex) {\n+        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        int nexti = 0;\n+        int nextb = 0;\n+        boolean highoc = true;\n+        outer:\n+        for (;;) {\n+            int number = -1;\n+            while (number == -1) {\n+                if (nexti == hex.length()) {\n+                    break outer;\n+                }\n+                char chr = hex.charAt(nexti);\n+                if (chr >= '0' && chr <= '9') {\n+                    number = chr - '0';\n+                } else if (chr >= 'a' && chr <= 'f') {\n+                    number = chr - 'a' + 10;\n+                } else if (chr >= 'A' && chr <= 'F') {\n+                    number = chr - 'A' + 10;\n+                } else {\n+                    number = -1;\n+                }\n+                nexti++;\n+            }\n+            if (highoc) {\n+                nextb = number << 4;\n+                highoc = false;\n+            } else {\n+                nextb |= number;\n+                highoc = true;\n+                baos.write(nextb);\n+            }\n+        }\n+        return baos.toByteArray();\n+    }\n+}"}, {"sha": "2a9864ae5f813107a100bb96c2bd2bfef2fedb50", "filename": "tools/SpiderDropFetcher/src/tools/Pair.java", "status": "added", "additions": 123, "deletions": 0, "changes": 123, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/Pair.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/Pair.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/Pair.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,123 @@\n+package tools;\n+\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+\n+/**\n+ * Represents a pair of values.\n+ * \n+ * @author Frz\n+ * @since Revision 333\n+ * @version 1.0\n+ * \n+ * @param <E> The type of the left value.\n+ * @param <F> The type of the right value.\n+ */\n+public class Pair<E, F> {\n+\n+    public E left;\n+    public F right;\n+\n+    /**\n+     * Class constructor - pairs two objects together.\n+     *\n+     * @param left The left object.\n+     * @param right The right object.\n+     */\n+    public Pair(E left, F right) {\n+        this.left = left;\n+        this.right = right;\n+    }\n+\n+    /**\n+     * Gets the left value.\n+     *\n+     * @return The left value.\n+     */\n+    public E getLeft() {\n+        return left;\n+    }\n+\n+    /**\n+     * Gets the right value.\n+     *\n+     * @return The right value.\n+     */\n+    public F getRight() {\n+        return right;\n+    }\n+\n+    /**\n+     * Turns the pair into a string.\n+     *\n+     * @return Each value of the pair as a string joined by a colon.\n+     */\n+    @Override\n+    public String toString() {\n+        return left.toString() + \":\" + right.toString();\n+    }\n+\n+    /**\n+     * Gets the hash code of this pair.\n+     */\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((left == null) ? 0 : left.hashCode());\n+        result = prime * result + ((right == null) ? 0 : right.hashCode());\n+        return result;\n+    }\n+\n+    /**\n+     * Checks to see if two pairs are equal.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        }\n+        if (obj == null) {\n+            return false;\n+        }\n+        if (getClass() != obj.getClass()) {\n+            return false;\n+        }\n+        final Pair other = (Pair) obj;\n+        if (left == null) {\n+            if (other.left != null) {\n+                return false;\n+            }\n+        } else if (!left.equals(other.left)) {\n+            return false;\n+        }\n+        if (right == null) {\n+            if (other.right != null) {\n+                return false;\n+            }\n+        } else if (!right.equals(other.right)) {\n+            return false;\n+        }\n+        return true;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "eac7de21eaac3423b32736fe92c5bd80da94d2a6", "filename": "tools/SpiderDropFetcher/src/tools/data/input/ByteArrayByteStream.java", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/ByteArrayByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/ByteArrayByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/ByteArrayByteStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,72 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import tools.HexTool;\n+\n+public class ByteArrayByteStream implements SeekableInputStreamBytestream {\n+    private int pos = 0;\n+    private long bytesRead = 0;\n+    private byte[] arr;\n+\n+    public ByteArrayByteStream(byte[] arr) {\n+        this.arr = arr;\n+    }\n+\n+    @Override\n+    public long getPosition() {\n+        return pos;\n+    }\n+\n+    @Override\n+    public void seek(long offset) throws IOException {\n+        pos = (int) offset;\n+    }\n+\n+    @Override\n+    public long getBytesRead() {\n+        return bytesRead;\n+    }\n+\n+    @Override\n+    public int readByte() {\n+        bytesRead++;\n+        return ((int) arr[pos++]) & 0xFF;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        String nows = \"kevintjuh93 pwns\";//I lol'd\n+        if (arr.length - pos > 0) {\n+            byte[] now = new byte[arr.length - pos];\n+            System.arraycopy(arr, pos, now, 0, arr.length - pos);\n+            nows = HexTool.toString(now);\n+        }\n+        return \"All: \" + HexTool.toString(arr) + \"\\nNow: \" + nows;\n+    }\n+  \n+    @Override\n+    public long available() {\n+        return arr.length - pos;\n+    }\n+}"}, {"sha": "107f71843e5890dc43f8679eb7608ac631165eae", "filename": "tools/SpiderDropFetcher/src/tools/data/input/ByteInputStream.java", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/ByteInputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/ByteInputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/ByteInputStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,35 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+/**\n+ * Represents an abstract stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public interface ByteInputStream {\n+    int readByte();\n+    long getBytesRead();\n+    long available();\n+}"}, {"sha": "d08a9b8374c3b3a9c38fd898295446e7d3582d50", "filename": "tools/SpiderDropFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "status": "added", "additions": 239, "deletions": 0, "changes": 239, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/GenericLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/GenericLittleEndianAccessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,239 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.awt.Point;\n+import java.io.ByteArrayOutputStream;\n+\n+/**\n+ * Provides a generic interface to a Little Endian stream of bytes.\n+ *\n+ * @version 1.0\n+ * @author Frz\n+ * @since Revision 323\n+ */\n+public class GenericLittleEndianAccessor implements LittleEndianAccessor {\n+    private ByteInputStream bs;\n+\n+    /**\n+     * Class constructor - Wraps the accessor around a stream of bytes.\n+     *\n+     * @param bs The byte stream to wrap the accessor around.\n+     */\n+    public GenericLittleEndianAccessor(ByteInputStream bs) {\n+        this.bs = bs;\n+    }\n+\n+    /**\n+     * Read a single byte from the stream.\n+     *\n+     * @return The byte read.\n+     * @see tools.data.input.ByteInputStream#readByte\n+     */\n+    @Override\n+    public byte readByte() {\n+        return (byte) bs.readByte();\n+    }\n+\n+    /**\n+     * Reads an integer from the stream.\n+     *\n+     * @return The integer read.\n+     */\n+    @Override\n+    public int readInt() {\n+        return bs.readByte() + (bs.readByte() << 8) + (bs.readByte() << 16) + (bs.readByte() << 24);\n+    }\n+\n+    /**\n+     * Reads a short integer from the stream.\n+     *\n+     * @return The short read.\n+     */\n+    @Override\n+    public short readShort() {\n+        return (short) (bs.readByte() + (bs.readByte() << 8));\n+    }\n+\n+    /**\n+     * Reads a single character from the stream.\n+     *\n+     * @return The character read.\n+     */\n+    @Override\n+    public char readChar() {\n+        return (char) readShort();\n+    }\n+\n+    /**\n+     * Reads a long integer from the stream.\n+     *\n+     * @return The long integer read.\n+     */\n+    @Override\n+    public long readLong() {\n+        long byte1 = bs.readByte();\n+        long byte2 = bs.readByte();\n+        long byte3 = bs.readByte();\n+        long byte4 = bs.readByte();\n+        long byte5 = bs.readByte();\n+        long byte6 = bs.readByte();\n+        long byte7 = bs.readByte();\n+        long byte8 = bs.readByte();\n+        return (byte8 << 56) + (byte7 << 48) + (byte6 << 40) + (byte5 << 32) + (byte4 << 24) + (byte3 << 16) + (byte2 << 8) + byte1;\n+    }\n+\n+    /**\n+     * Reads a floating point integer from the stream.\n+     *\n+     * @return The float-type integer read.\n+     */\n+    @Override\n+    public float readFloat() {\n+        return Float.intBitsToFloat(readInt());\n+    }\n+\n+    /**\n+     * Reads a double-precision integer from the stream.\n+     *\n+     * @return The double-type integer read.\n+     */\n+    @Override\n+    public double readDouble() {\n+        return Double.longBitsToDouble(readLong());\n+    }\n+\n+    /**\n+     * Reads an ASCII string from the stream with length <code>n</code>.\n+     *\n+     * @param n Number of characters to read.\n+     * @return The string read.\n+     */\n+    public final String readAsciiString(int n) {\n+        char ret[] = new char[n];\n+        for (int x = 0; x < n; x++) {\n+            ret[x] = (char) readByte();\n+        }\n+        return String.valueOf(ret);\n+    }\n+\n+    /**\n+     * Reads a null-terminated string from the stream.\n+     *\n+     * @return The string read.\n+     */\n+    public final String readNullTerminatedAsciiString() {\n+        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        byte b;\n+        while (true) {\n+            b = readByte();\n+            if (b == 0) {\n+                break;\n+            }\n+            baos.write(b);\n+        }\n+        byte[] buf = baos.toByteArray();\n+        char[] chrBuf = new char[buf.length];\n+        for (int x = 0; x < buf.length; x++) {\n+            chrBuf[x] = (char) buf[x];\n+        }\n+        return String.valueOf(chrBuf);\n+    }\n+\n+    /**\n+     * Gets the number of bytes read from the stream so far.\n+     *\n+     * @return A long integer representing the number of bytes read.\n+     * @see tools.data.input.ByteInputStream#getBytesRead()\n+     */\n+    public long getBytesRead() {\n+        return bs.getBytesRead();\n+    }\n+\n+    /**\n+     * Reads a MapleStory convention lengthed ASCII string.\n+     * This consists of a short integer telling the length of the string,\n+     * then the string itself.\n+     *\n+     * @return The string read.\n+     */\n+    @Override\n+    public String readMapleAsciiString() {\n+        return readAsciiString(readShort());\n+    }\n+\n+    /**\n+     * Reads <code>num</code> bytes off the stream.\n+     *\n+     * @param num The number of bytes to read.\n+     * @return An array of bytes with the length of <code>num</code>\n+     */\n+    @Override\n+    public byte[] read(int num) {\n+        byte[] ret = new byte[num];\n+        for (int x = 0; x < num; x++) {\n+            ret[x] = readByte();\n+        }\n+        return ret;\n+    }\n+\n+    /**\n+     * Reads a MapleStory Position information.\n+     * This consists of 2 short integer.\n+     *\n+     * @return The Position read.\n+     */\n+    @Override\n+    public final Point readPos() {\n+\tfinal int x = readShort();\n+\tfinal int y = readShort();\n+\treturn new Point(x, y);\n+    }\n+\n+    /**\n+     * Skips the current position of the stream <code>num</code> bytes ahead.\n+     *\n+     * @param num Number of bytes to skip.\n+     */\n+    @Override\n+    public void skip(int num) {\n+        for (int x = 0; x < num; x++) {\n+            readByte();\n+        }\n+    }\n+\n+    /**\n+     * @see tools.data.input.ByteInputStream#available\n+     */\n+    @Override\n+    public long available() {\n+        return bs.available();\n+    }\n+\n+    /**\n+     * @see java.lang.Object#toString\n+     */\n+    @Override\n+    public String toString() {\n+        return bs.toString();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "fdd147d79637904e92445553643117eb0aa6ebf4", "filename": "tools/SpiderDropFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "status": "added", "additions": 91, "deletions": 0, "changes": 91, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/GenericSeekableLittleEndianAccessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,91 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides an abstract accessor to a generic Little Endian byte stream. This\n+ * accessor is seekable.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ * @see tools.data.input.GenericLittleEndianAccessor\n+ */\n+public class GenericSeekableLittleEndianAccessor extends GenericLittleEndianAccessor implements SeekableLittleEndianAccessor {\n+    private SeekableInputStreamBytestream bs;\n+\n+    /**\n+     * Class constructor\n+     * Provide a seekable input stream to wrap this object around.\n+     *\n+     * @param bs The byte stream to wrap this around.\n+     */\n+    public GenericSeekableLittleEndianAccessor(SeekableInputStreamBytestream bs) {\n+        super(bs);\n+        this.bs = bs;\n+    }\n+\n+    /**\n+     * Seek the pointer to <code>offset</code>\n+     *\n+     * @param offset The offset to seek to.\n+     * @see tools.data.input.SeekableInputStreamBytestream#seek\n+     */\n+    @Override\n+    public void seek(long offset) {\n+        try {\n+            bs.seek(offset);\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"Seek failed \" + e);\n+        }\n+    }\n+\n+    /**\n+     * Get the current position of the pointer.\n+     *\n+     * @return The current position of the pointer as a long integer.\n+     * @see tools.data.input.SeekableInputStreamBytestream#getPosition\n+     */\n+    @Override\n+    public long getPosition() {\n+        try {\n+            return bs.getPosition();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"getPosition failed\" + e);\n+            return -1;\n+        }\n+    }\n+\n+    /**\n+     * Skip <code>num</code> number of bytes in the stream.\n+     *\n+     * @param num The number of bytes to skip.\n+     */\n+    @Override\n+    public void skip(int num) {\n+        seek(getPosition() + num);\n+    }\n+}"}, {"sha": "70aef3489f8eeaa27e8236c069dd847e069c0a85", "filename": "tools/SpiderDropFetcher/src/tools/data/input/InputStreamByteStream.java", "status": "added", "additions": 93, "deletions": 0, "changes": 93, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/InputStreamByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/InputStreamByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/InputStreamByteStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,93 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+\n+/**\n+ * Provides an abstract wrapper to a stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class InputStreamByteStream implements ByteInputStream {\n+    private InputStream is;\n+    private long read = 0;\n+\n+    /**\n+     * Class constructor.\n+     * Provide an input stream to wrap this around.\n+     *\n+     * @param is The input stream to wrap this object around.\n+     */\n+    public InputStreamByteStream(InputStream is) {\n+        this.is = is;\n+    }\n+\n+    /**\n+     * Reads the next byte from the stream.\n+     *\n+     * @return Then next byte in the stream.\n+     */\n+    @Override\n+    public int readByte() {\n+        int temp;\n+        try {\n+            temp = is.read();\n+            if (temp == -1) {\n+                throw new RuntimeException(\"EOF\");\n+            }\n+            read++;\n+            return temp;\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    /**\n+     * Gets the number of bytes read from the stream.\n+     *\n+     * @return The number of bytes read as a long integer.\n+     */\n+    @Override\n+    public long getBytesRead() {\n+        return read;\n+    }\n+\n+    /**\n+     * Returns the number of bytes left in the stream.\n+     *\n+     * @return The number of bytes available for reading as a long integer.\n+     */\n+    @Override\n+    public long available() {\n+        try {\n+            return is.available();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"ERROR\" + e);\n+            return 0;\n+        }\n+    }\n+}"}, {"sha": "f991dbf537e4230969cf96296d460306fb52c019", "filename": "tools/SpiderDropFetcher/src/tools/data/input/LittleEndianAccessor.java", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/LittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/LittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/LittleEndianAccessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,45 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.awt.Point;\n+\n+/**\n+ * @author Frz\n+ */\n+public interface LittleEndianAccessor {\n+    byte readByte();\n+    char readChar();\n+    short readShort();\n+    int readInt();\n+    Point readPos();\n+    long readLong();\n+    void skip(int num);\n+    byte[] read(int num);\n+    float readFloat();\n+    double readDouble();\n+    String readAsciiString(int n);\n+    String readNullTerminatedAsciiString();\n+    String readMapleAsciiString();\n+    long getBytesRead();\n+    long available();\n+}"}, {"sha": "c0004be17fd1125ee7bff7911c3be489bc488f5c", "filename": "tools/SpiderDropFetcher/src/tools/data/input/RandomAccessByteStream.java", "status": "added", "additions": 84, "deletions": 0, "changes": 84, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/RandomAccessByteStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/RandomAccessByteStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/RandomAccessByteStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,84 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+\n+/**\n+ * Provides an abstract layer to a byte stream. This layer can be accessed\n+ * randomly.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class RandomAccessByteStream implements SeekableInputStreamBytestream {\n+    private RandomAccessFile raf;\n+    private long read = 0;\n+\n+    public RandomAccessByteStream(RandomAccessFile raf) {\n+        super();\n+        this.raf = raf;\n+    }\n+\n+    @Override\n+    public int readByte() {\n+        int temp;\n+        try {\n+            temp = raf.read();\n+            if (temp == -1) {\n+                throw new RuntimeException(\"EOF\");\n+            }\n+            read++;\n+            return temp;\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public void seek(long offset) throws IOException {\n+        raf.seek(offset);\n+    }\n+\n+    @Override\n+    public long getPosition() throws IOException {\n+        return raf.getFilePointer();\n+    }\n+\n+    @Override\n+    public long getBytesRead() {\n+        return read;\n+    }\n+\n+    @Override\n+    public long available() {\n+        try {\n+            return raf.length() - raf.getFilePointer();\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+            System.out.println(\"ERROR \" + e);\n+            return 0;\n+        }\n+    }\n+}"}, {"sha": "f4922dc876ef24832968388c0d62c27e9303cf20", "filename": "tools/SpiderDropFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/SeekableInputStreamBytestream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/SeekableInputStreamBytestream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,51 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides an abstract interface to a stream of bytes. This stream can be\n+ * seeked.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since 299\n+ */\n+public interface SeekableInputStreamBytestream extends ByteInputStream {\n+    /**\n+     * Seeks the stream by the specified offset.\n+     *\n+     * @param offset\n+     *            Number of bytes to seek.\n+     * @throws IOException\n+     */\n+    void seek(long offset) throws IOException;\n+\n+    /**\n+     * Gets the current position of the stream.\n+     *\n+     * @return The stream position as a long integer.\n+     * @throws IOException\n+     */\n+    long getPosition() throws IOException;\n+}"}, {"sha": "16b2317f7a5b5d000be9d7f12cd86bdc30d2ed89", "filename": "tools/SpiderDropFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/input/SeekableLittleEndianAccessor.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,27 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.input;\n+\n+public interface SeekableLittleEndianAccessor extends LittleEndianAccessor {\n+    void seek(long offset);\n+    long getPosition();\n+}"}, {"sha": "80cbc9301e410f00b74731f7f8ee366109f12a1d", "filename": "tools/SpiderDropFetcher/src/tools/data/output/BAOSByteOutputStream.java", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/BAOSByteOutputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/BAOSByteOutputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/output/BAOSByteOutputStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,56 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.io.ByteArrayOutputStream;\n+\n+/**\n+ * Uses a byte array to output a stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 352\n+ */\n+class BAOSByteOutputStream implements ByteOutputStream {\n+    private ByteArrayOutputStream baos;\n+\n+    /**\n+     * Class constructor - Wraps the stream around a Java BAOS.\n+     *\n+     * @param baos <code>The ByteArrayOutputStream</code> to wrap this around.\n+     */\n+    BAOSByteOutputStream(ByteArrayOutputStream baos) {\n+        super();\n+        this.baos = baos;\n+    }\n+\n+    /**\n+     * Writes a byte to the stream.\n+     *\n+     * @param b The byte to write to the stream.\n+     * @see tools.data.output.ByteOutputStream#writeByte(byte)\n+     */\n+    @Override\n+    public void writeByte(byte b) {\n+        baos.write(b);\n+    }\n+}"}, {"sha": "0df7ca775362e7ef40ee4e5fa9d9b36ebd0b5001", "filename": "tools/SpiderDropFetcher/src/tools/data/output/ByteOutputStream.java", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/ByteOutputStream.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/ByteOutputStream.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/output/ByteOutputStream.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,38 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+/**\n+ * Provides an interface to an output stream of bytes.\n+ * \n+ * @author Frz\n+ * @since Revision 323\n+ * @version 1.0\n+ */\n+interface ByteOutputStream {\n+    /**\n+     * Writes a byte to the stream.\n+     *\n+     * @param b The byte to write.\n+     */\n+    void writeByte(byte b);\n+}"}, {"sha": "91779e4d57434927717580da9404f47d7010fcaa", "filename": "tools/SpiderDropFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "status": "added", "additions": 184, "deletions": 0, "changes": 184, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/GenericLittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/output/GenericLittleEndianWriter.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,184 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.awt.Point;\n+import java.nio.charset.Charset;\n+import constants.CharsetConstants.MapleLanguageType;\n+\n+/**\n+ * Provides a generic writer of a little-endian sequence of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public class GenericLittleEndianWriter implements LittleEndianWriter {\n+    private static Charset ASCII = Charset.forName(MapleLanguageType.LANGUAGE_US.getAscii());\n+    private ByteOutputStream bos;\n+\n+    /**\n+     * Class constructor - Protected to prevent instantiation with no arguments.\n+     */\n+    protected GenericLittleEndianWriter() {\n+        // Blah!\n+    }\n+\n+    /**\n+     * Sets the byte-output stream for this instance of the object.\n+     *\n+     * @param bos The new output stream to set.\n+     */\n+    void setByteOutputStream(ByteOutputStream bos) {\n+        this.bos = bos;\n+    }\n+\n+    /**\n+     * Write an array of bytes to the stream.\n+     *\n+     * @param b The bytes to write.\n+     */\n+    @Override\n+    public void write(byte[] b) {\n+        for (int x = 0; x < b.length; x++) {\n+            bos.writeByte(b[x]);\n+        }\n+    }\n+\n+    /**\n+     * Write a byte to the stream.\n+     *\n+     * @param b The byte to write.\n+     */\n+    @Override\n+    public void write(byte b) {\n+        bos.writeByte(b);\n+    }\n+\n+    /**\n+     * Write a byte in integer form to the stream.\n+     *\n+     * @param b The byte as an <code>Integer</code> to write.\n+     */\n+    @Override\n+    public void write(int b) {\n+        bos.writeByte((byte) b);\n+    }\n+\n+    @Override\n+    public void skip(int b) {\n+        write(new byte[b]);\n+    }\n+\n+    /**\n+     * Write a short integer to the stream.\n+     *\n+     * @param i The short integer to write.\n+     */\n+    @Override\n+    public void writeShort(int i) {\n+        bos.writeByte((byte) (i & 0xFF));\n+        bos.writeByte((byte) ((i >>> 8) & 0xFF));\n+    }\n+    \n+    /**\n+     * Writes an integer to the stream.\n+     *\n+     * @param i The integer to write.\n+     */\n+    @Override\n+    public void writeInt(int i) {\n+        bos.writeByte((byte) (i & 0xFF));\n+        bos.writeByte((byte) ((i >>> 8) & 0xFF));\n+        bos.writeByte((byte) ((i >>> 16) & 0xFF));\n+        bos.writeByte((byte) ((i >>> 24) & 0xFF));\n+    }\n+\n+    /**\n+     * Writes an ASCII string the the stream.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    @Override\n+    public void writeAsciiString(String s) {\n+        write(s.getBytes(ASCII));\n+    }\n+\n+    /**\n+     * Writes a maple-convention ASCII string to the stream.\n+     *\n+     * @param s The ASCII string to use maple-convention to write.\n+     */\n+    @Override\n+    public void writeMapleAsciiString(String s) {\n+        writeShort((short) s.length());\n+        writeAsciiString(s);\n+    }\n+\n+    /**\n+     * Writes a null-terminated ASCII string to the stream.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    @Override\n+    public void writeNullTerminatedAsciiString(String s) {\n+        writeAsciiString(s);\n+        write(0);\n+    }\n+\n+    /**\n+     * Write a long integer to the stream.\n+     * @param l The long integer to write.\n+     */\n+    @Override\n+    public void writeLong(long l) {\n+        bos.writeByte((byte) (l & 0xFF));\n+        bos.writeByte((byte) ((l >>> 8) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 16) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 24) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 32) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 40) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 48) & 0xFF));\n+        bos.writeByte((byte) ((l >>> 56) & 0xFF));\n+    }\n+\n+    /**\n+     * Writes a 2D 4 byte position information\n+     *\n+     * @param s The Point position to write.\n+     */\n+    @Override\n+    public void writePos(Point s) {\n+        writeShort(s.x);\n+        writeShort(s.y);\n+    }\n+\n+    /**\n+     * Writes a boolean true ? 1 : 0\n+     *\n+     * @param b The boolean to write.\n+     */\n+    @Override\n+    public void writeBool(final boolean b) {\n+        write(b ? 1 : 0);\n+    }\n+}"}, {"sha": "f17bd7c72ec04f5abf2032a6622141630bd3dc81", "filename": "tools/SpiderDropFetcher/src/tools/data/output/LittleEndianWriter.java", "status": "added", "additions": 114, "deletions": 0, "changes": 114, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/LittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/LittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/output/LittleEndianWriter.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,114 @@\n+/*\n+ This file is part of the OdinMS Maple Story Server\n+ Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+ Matthias Butz <matze@odinms.de>\n+ Jan Christian Meyer <vimes@odinms.de>\n+\n+ This program is free software: you can redistribute it and/or modify\n+ it under the terms of the GNU Affero General Public License as\n+ published by the Free Software Foundation version 3 as published by\n+ the Free Software Foundation. You may not use, modify or distribute\n+ this program under any other version of the GNU Affero General Public\n+ License.\n+\n+ This program is distributed in the hope that it will be useful,\n+ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ GNU Affero General Public License for more details.\n+\n+ You should have received a copy of the GNU Affero General Public License\n+ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package tools.data.output;\n+\n+import java.awt.Point;\n+\n+/**\n+ * Provides an interface to a writer class that writes a little-endian sequence\n+ * of bytes.\n+ *\n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 323\n+ */\n+public interface LittleEndianWriter {\n+\n+    /**\n+     * Write an array of bytes to the sequence.\n+     *\n+     * @param b The bytes to write.\n+     */\n+    public void write(byte b[]);\n+\n+    /**\n+     * Write a byte to the sequence.\n+     *\n+     * @param b The byte to write.\n+     */\n+    public void write(byte b);\n+\n+    /**\n+     * Write a byte in integer form to the sequence.\n+     *\n+     * @param b The byte as an <code>Integer</code> to write.\n+     */\n+    public void write(int b);\n+\n+    public void skip(int b);\n+\n+    /**\n+     * Writes an integer to the sequence.\n+     *\n+     * @param i The integer to write.\n+     */\n+    public void writeInt(int i);\n+\n+    /**\n+     * Write a short integer to the sequence.\n+     *\n+     * @param s The short integer to write.\n+     */\n+    public void writeShort(int s);\n+\n+    /**\n+     * Write a long integer to the sequence.\n+     *\n+     * @param l The long integer to write.\n+     */\n+    public void writeLong(long l);\n+\n+    /**\n+     * Writes an ASCII string the the sequence.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    void writeAsciiString(String s);\n+\n+    /**\n+     * Writes a null-terminated ASCII string to the sequence.\n+     *\n+     * @param s The ASCII string to write.\n+     */\n+    void writeNullTerminatedAsciiString(String s);\n+\n+    /**\n+     * Writes a maple-convention ASCII string to the sequence.\n+     *\n+     * @param s The ASCII string to use maple-convention to write.\n+     */\n+    void writeMapleAsciiString(String s);\n+\n+    /**\n+     * Writes a 2D 4 byte position information\n+     *\n+     * @param s The Point position to write.\n+     */\n+    void writePos(Point s);\n+\n+    /**\n+     * Writes a boolean true ? 1 : 0\n+     *\n+     * @param b The boolean to write.\n+     */\n+    void writeBool(final boolean b);\n+}"}, {"sha": "b02365ec62c9cbaf2998c5816928195512967a7f", "filename": "tools/SpiderDropFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/tools/SpiderDropFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/SpiderDropFetcher/src/tools/data/output/MaplePacketLittleEndianWriter.java?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -0,0 +1,73 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package tools.data.output;\n+\n+import java.io.ByteArrayOutputStream;\n+import tools.HexTool;\n+\n+/**\n+ * Writes a maplestory-packet little-endian stream of bytes.\n+ * \n+ * @author Frz\n+ * @version 1.0\n+ * @since Revision 352\n+ */\n+public class MaplePacketLittleEndianWriter extends GenericLittleEndianWriter {\n+    private ByteArrayOutputStream baos;\n+\n+    /**\n+     * Constructor - initializes this stream with a default size.\n+     */\n+    public MaplePacketLittleEndianWriter() {\n+        this(32);\n+    }\n+\n+    /**\n+     * Constructor - initializes this stream with size <code>size</code>.\n+     *\n+     * @param size The size of the underlying stream.\n+     */\n+    public MaplePacketLittleEndianWriter(int size) {\n+        this.baos = new ByteArrayOutputStream(size);\n+        setByteOutputStream(new BAOSByteOutputStream(baos));\n+    }\n+\n+    /**\n+     * Gets a <code>MaplePacket</code> instance representing this\n+     * sequence of bytes.\n+     *\n+     * @return A <code>MaplePacket</code> with the bytes in this stream.\n+     */\n+    public byte[] getPacket() {\n+        return baos.toByteArray();\n+    }\n+\n+    /**\n+     * Changes this packet into a human-readable hexadecimal stream of bytes.\n+     *\n+     * @return This packet as hex digits.\n+     */\n+    @Override\n+    public String toString() {\n+        return HexTool.toString(baos.toByteArray());\n+    }\n+}"}, {"sha": "26e792d2bb4aca133a407c37165fd63ed258421a", "filename": "wz/Item.wz/Etc/0403.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Item.wz/Etc/0403.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Item.wz/Etc/0403.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Etc/0403.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -9757,7 +9757,6 @@\n       </canvas>\n       <int name=\"price\" value=\"1\"/>\n       <int name=\"tradeBlock\" value=\"1\"/>\n-      <int name=\"slotMax\" value=\"1\"/>\n       <int name=\"notSale\" value=\"1\"/>\n     </imgdir>\n   </imgdir>\n@@ -10642,6 +10641,7 @@\n       </canvas>\n       <int name=\"price\" value=\"1\"/>\n       <string name=\"tradeBlock\" value=\"1\"/>\n+      <int name=\"notSale\" value=\"1\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04032014\">"}, {"sha": "2d66854a7872b9a8d38478513442ead012480a11", "filename": "wz/Map.wz/Map/Map1/105100100.img.xml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map1/105100100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map1/105100100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map1/105100100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2435,7 +2435,7 @@\n       <int name=\"y\" value=\"-458\"/>\n       <int name=\"tm\" value=\"999999999\"/>\n       <string name=\"tn\" value=\"\"/>\n-      <string name=\"script\" value=\"OutPerrion_2\"/>\n+      <string name=\"script\" value=\"outPerrion_2\"/>\n       <int name=\"hideTooltip\" value=\"0\"/>\n       <int name=\"onlyOnce\" value=\"1\"/>\n       <int name=\"delay\" value=\"0\"/>\n@@ -2447,7 +2447,7 @@\n       <int name=\"y\" value=\"-462\"/>\n       <int name=\"tm\" value=\"999999999\"/>\n       <string name=\"tn\" value=\"\"/>\n-      <string name=\"script\" value=\"OutPerrion_2\"/>\n+      <string name=\"script\" value=\"outPerrion_2\"/>\n       <int name=\"hideTooltip\" value=\"0\"/>\n       <int name=\"onlyOnce\" value=\"1\"/>\n       <int name=\"delay\" value=\"0\"/>\n@@ -2465,13 +2465,13 @@\n       <int name=\"delay\" value=\"0\"/>\n     </imgdir>\n     <imgdir name=\"6\">\n-      <string name=\"pn\" value=\"OutPerrion\"/>\n+      <string name=\"pn\" value=\"outPerrion\"/>\n       <int name=\"pt\" value=\"7\"/>\n       <int name=\"x\" value=\"-691\"/>\n       <int name=\"y\" value=\"246\"/>\n       <int name=\"tm\" value=\"999999999\"/>\n       <string name=\"tn\" value=\"\"/>\n-      <string name=\"script\" value=\"OutPerrion_1\"/>\n+      <string name=\"script\" value=\"outPerrion_1\"/>\n       <int name=\"hideTooltip\" value=\"0\"/>\n       <int name=\"onlyOnce\" value=\"0\"/>\n       <int name=\"delay\" value=\"0\"/>"}, {"sha": "8a93ebf9f0ff8ecde52c9903bcca7529266f8300", "filename": "wz/Map.wz/Map/Map1/130000000.img.xml", "status": "modified", "additions": 2243, "deletions": 2244, "changes": 4487, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map1/130000000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map1/130000000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map1/130000000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe"}, {"sha": "ac9dbd2b2d68e18c8d726f31c2687cb7d274cdf9", "filename": "wz/Map.wz/Map/Map2/209000000.img.xml", "status": "modified", "additions": 62, "deletions": 2, "changes": 64, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map2/209000000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map2/209000000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map2/209000000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -2106,6 +2106,66 @@\n       <string name=\"tn\" value=\"chimney00\"/>\n       <string name=\"pn\" value=\"chimney00_2\"/>\n     </imgdir>\n+    <imgdir name=\"19\">\n+      <int name=\"x\" value=\"2735\"/>\n+      <int name=\"y\" value=\"147\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"20\">\n+      <int name=\"x\" value=\"3000\"/>\n+      <int name=\"y\" value=\"-80\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"21\">\n+      <int name=\"x\" value=\"1951\"/>\n+      <int name=\"y\" value=\"148\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"22\">\n+      <int name=\"x\" value=\"1592\"/>\n+      <int name=\"y\" value=\"145\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"23\">\n+      <int name=\"x\" value=\"636\"/>\n+      <int name=\"y\" value=\"146\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"24\">\n+      <int name=\"x\" value=\"-489\"/>\n+      <int name=\"y\" value=\"-28\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n   </imgdir>\n   <imgdir name=\"reactor\">\n     <imgdir name=\"0\">\n@@ -3615,8 +3675,8 @@\n       <int name=\"y\" value=\"150\"/>\n       <int name=\"cy\" value=\"153\"/>\n       <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"rx0\" value=\"2488\"/>\n-      <int name=\"rx1\" value=\"2588\"/>\n+      <int name=\"rx0\" value=\"2487\"/>\n+      <int name=\"rx1\" value=\"2587\"/>\n       <int name=\"f\" value=\"1\"/>\n       <string name=\"type\" value=\"n\"/>\n       <int name=\"fh\" value=\"131\"/>"}, {"sha": "3865c89ae2a8747b6c31da507331be8b28644761", "filename": "wz/Map.wz/Map/Map6/610020006.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610020006.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610020006.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610020006.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,7 +5,7 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"682000000\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n     <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"0.8\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeep\"/>"}, {"sha": "e93c4763ac9856b321ea1018cd965067144c7e24", "filename": "wz/Map.wz/Map/Map6/610030000.img.xml", "status": "modified", "additions": 977, "deletions": 925, "changes": 1902, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1,1435 +1,1487 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n <imgdir name=\"610030000.img\">\n   <imgdir name=\"info\">\n-    <int name=\"version\" value=\"10\"/>\n+    <string name=\"bgm\" value=\"BgmGL/Courtyard\"/>\n     <int name=\"cloud\" value=\"0\"/>\n-    <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"682000000\"/>\n     <int name=\"forcedReturn\" value=\"999999999\"/>\n-    <float name=\"mobRate\" value=\"0.8\"/>\n-    <string name=\"bgm\" value=\"BgmGL/Courtyard\"/>\n-    <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n+    <string name=\"mapMark\" value=\"Crimsonwood\"/>\n+    <float name=\"mobRate\" value=\"0.8\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"town\" value=\"1\"/>\n+    <int name=\"version\" value=\"10\"/>\n     <int name=\"fieldLimit\" value=\"0\"/>\n-    <int name=\"fly\" value=\"0\"/>\n     <string name=\"onFirstUserEnter\" value=\"\"/>\n     <string name=\"onUserEnter\" value=\"\"/>\n-    <int name=\"VRTop\" value=\"-721\"/>\n+    <int name=\"fly\" value=\"0\"/>\n     <int name=\"VRLeft\" value=\"-1108\"/>\n-    <int name=\"VRBottom\" value=\"270\"/>\n     <int name=\"VRRight\" value=\"1345\"/>\n+    <int name=\"VRTop\" value=\"-721\"/>\n+    <int name=\"VRBottom\" value=\"270\"/>\n   </imgdir>\n-  <imgdir name=\"back\">\n-    <imgdir name=\"0\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"0\"/>\n-      <int name=\"y\" value=\"0\"/>\n-      <int name=\"rx\" value=\"0\"/>\n-      <int name=\"ry\" value=\"0\"/>\n-      <int name=\"type\" value=\"3\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"1\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"1\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"-1\"/>\n-      <int name=\"y\" value=\"-15\"/>\n-      <int name=\"rx\" value=\"-5\"/>\n-      <int name=\"ry\" value=\"-5\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"2\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"2\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"-101\"/>\n-      <int name=\"y\" value=\"-268\"/>\n-      <int name=\"rx\" value=\"-8\"/>\n-      <int name=\"ry\" value=\"-4\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"3\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"3\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"-46\"/>\n-      <int name=\"y\" value=\"-137\"/>\n-      <int name=\"rx\" value=\"-10\"/>\n-      <int name=\"ry\" value=\"-6\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"4\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"4\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"-16\"/>\n-      <int name=\"y\" value=\"-188\"/>\n-      <int name=\"rx\" value=\"-13\"/>\n-      <int name=\"ry\" value=\"-8\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"5\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"5\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"16\"/>\n-      <int name=\"y\" value=\"-265\"/>\n-      <int name=\"rx\" value=\"-15\"/>\n-      <int name=\"ry\" value=\"-9\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"6\">\n-      <string name=\"bS\" value=\"masteriaGL\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"6\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"121\"/>\n-      <int name=\"y\" value=\"-363\"/>\n-      <int name=\"rx\" value=\"-20\"/>\n-      <int name=\"ry\" value=\"-10\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-    <imgdir name=\"7\">\n-      <string name=\"bS\" value=\"masteriaGL2\"/>\n-      <int name=\"front\" value=\"0\"/>\n-      <int name=\"ani\" value=\"0\"/>\n-      <int name=\"no\" value=\"107\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"x\" value=\"144\"/>\n-      <int name=\"y\" value=\"-65\"/>\n-      <int name=\"rx\" value=\"-50\"/>\n-      <int name=\"ry\" value=\"-50\"/>\n-      <int name=\"type\" value=\"0\"/>\n-      <int name=\"cx\" value=\"0\"/>\n-      <int name=\"cy\" value=\"0\"/>\n-      <int name=\"a\" value=\"255\"/>\n-    </imgdir>\n-  </imgdir>\n-  <imgdir name=\"life\">\n-    <imgdir name=\"0\">\n-      <string name=\"type\" value=\"n\"/>\n-      <string name=\"id\" value=\"9201107\"/>\n-      <int name=\"x\" value=\"-715\"/>\n-      <int name=\"y\" value=\"165\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"19\"/>\n-      <int name=\"cy\" value=\"171\"/>\n-      <int name=\"rx0\" value=\"-765\"/>\n-      <int name=\"rx1\" value=\"-665\"/>\n-    </imgdir>\n-    <imgdir name=\"1\">\n-      <string name=\"type\" value=\"n\"/>\n-      <string name=\"id\" value=\"9201108\"/>\n-      <int name=\"x\" value=\"-179\"/>\n-      <int name=\"y\" value=\"159\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"25\"/>\n-      <int name=\"cy\" value=\"171\"/>\n-      <int name=\"rx0\" value=\"-229\"/>\n-      <int name=\"rx1\" value=\"-129\"/>\n-    </imgdir>\n-    <imgdir name=\"2\">\n-      <string name=\"type\" value=\"n\"/>\n-      <string name=\"id\" value=\"9201109\"/>\n-      <int name=\"x\" value=\"-460\"/>\n-      <int name=\"y\" value=\"161\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"21\"/>\n-      <int name=\"cy\" value=\"171\"/>\n-      <int name=\"rx0\" value=\"-510\"/>\n-      <int name=\"rx1\" value=\"-410\"/>\n-    </imgdir>\n-    <imgdir name=\"3\">\n-      <string name=\"type\" value=\"n\"/>\n-      <string name=\"id\" value=\"9201110\"/>\n-      <int name=\"x\" value=\"96\"/>\n-      <int name=\"y\" value=\"165\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"24\"/>\n-      <int name=\"cy\" value=\"171\"/>\n-      <int name=\"rx0\" value=\"46\"/>\n-      <int name=\"rx1\" value=\"146\"/>\n-    </imgdir>\n-    <imgdir name=\"4\">\n-      <string name=\"type\" value=\"n\"/>\n-      <string name=\"id\" value=\"9201111\"/>\n-      <int name=\"x\" value=\"364\"/>\n-      <int name=\"y\" value=\"166\"/>\n-      <int name=\"mobTime\" value=\"0\"/>\n-      <int name=\"f\" value=\"0\"/>\n-      <int name=\"hide\" value=\"0\"/>\n-      <int name=\"fh\" value=\"29\"/>\n-      <int name=\"cy\" value=\"171\"/>\n-      <int name=\"rx0\" value=\"314\"/>\n-      <int name=\"rx1\" value=\"414\"/>\n-    </imgdir>\n-  </imgdir>\n-  <imgdir name=\"reactor\">\n+  <imgdir name=\"miniMap\">\n+    <canvas name=\"canvas\" width=\"160\" height=\"42\">\n+    </canvas>\n+    <int name=\"width\" value=\"2564\"/>\n+    <int name=\"height\" value=\"675\"/>\n+    <int name=\"centerX\" value=\"1166\"/>\n+    <int name=\"centerY\" value=\"221\"/>\n+    <int name=\"mag\" value=\"4\"/>\n   </imgdir>\n   <imgdir name=\"0\">\n     <imgdir name=\"info\">\n     </imgdir>\n-    <imgdir name=\"tile\">\n-    </imgdir>\n     <imgdir name=\"obj\">\n     </imgdir>\n-  </imgdir>\n-  <imgdir name=\"1\">\n-    <imgdir name=\"info\">\n-    </imgdir>\n     <imgdir name=\"tile\">\n     </imgdir>\n-    <imgdir name=\"obj\">\n-    </imgdir>\n   </imgdir>\n-  <imgdir name=\"2\">\n+  <imgdir name=\"1\">\n     <imgdir name=\"info\">\n-    </imgdir>\n-    <imgdir name=\"tile\">\n+      <string name=\"tS\" value=\"masteriaGL3\"/>\n     </imgdir>\n     <imgdir name=\"obj\">\n     </imgdir>\n-  </imgdir>\n-  <imgdir name=\"3\">\n-    <imgdir name=\"info\">\n-      <string name=\"tS\" value=\"masteriaGL3\"/>\n-      <int name=\"tSMag\" value=\"1\"/>\n-    </imgdir>\n     <imgdir name=\"tile\">\n       <imgdir name=\"0\">\n         <int name=\"x\" value=\"540\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"edU\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n       <imgdir name=\"1\">\n-        <int name=\"x\" value=\"540\"/>\n+        <int name=\"x\" value=\"-1080\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"edD\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"edU\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"3\">\n-        <int name=\"x\" value=\"630\"/>\n+      <imgdir name=\"2\">\n+        <int name=\"x\" value=\"-1080\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"edD\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"12\">\n-        <int name=\"x\" value=\"810\"/>\n-        <int name=\"y\" value=\"60\"/>\n-        <string name=\"u\" value=\"slLU\"/>\n+      <imgdir name=\"3\">\n+        <int name=\"x\" value=\"540\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"edD\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"8\">\n-        <int name=\"x\" value=\"720\"/>\n+      <imgdir name=\"4\">\n+        <int name=\"x\" value=\"630\"/>\n         <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"slLU\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"1\"/>\n+      </imgdir>\n+      <imgdir name=\"5\">\n+        <int name=\"x\" value=\"-1080\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"4\">\n+      <imgdir name=\"6\">\n         <int name=\"x\" value=\"630\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"slLU\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"edD\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"19\">\n-        <int name=\"x\" value=\"900\"/>\n-        <int name=\"y\" value=\"-60\"/>\n+      <imgdir name=\"7\">\n+        <int name=\"x\" value=\"-1080\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"14\">\n-        <int name=\"x\" value=\"900\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"4\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"17\">\n-        <int name=\"x\" value=\"990\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n+      <imgdir name=\"8\">\n+        <int name=\"x\" value=\"-990\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"21\">\n-        <int name=\"x\" value=\"1080\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"23\">\n-        <int name=\"x\" value=\"1170\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"25\">\n-        <int name=\"x\" value=\"1260\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"4\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"24\">\n-        <int name=\"x\" value=\"1260\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"4\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"10\">\n-        <int name=\"x\" value=\"810\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n+      <imgdir name=\"9\">\n+        <int name=\"x\" value=\"630\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"slLU\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"16\">\n-        <int name=\"x\" value=\"900\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"15\">\n-        <int name=\"x\" value=\"1170\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n+      <imgdir name=\"10\">\n+        <int name=\"x\" value=\"630\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"18\">\n-        <int name=\"x\" value=\"990\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"5\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"20\">\n-        <int name=\"x\" value=\"1080\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n+      <imgdir name=\"11\">\n+        <int name=\"x\" value=\"-990\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"22\">\n-        <int name=\"x\" value=\"1170\"/>\n-        <int name=\"y\" value=\"0\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n+      <imgdir name=\"12\">\n+        <int name=\"x\" value=\"-810\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"29\">\n-        <int name=\"x\" value=\"1260\"/>\n-        <int name=\"y\" value=\"60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"5\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n       <imgdir name=\"13\">\n-        <int name=\"x\" value=\"810\"/>\n-        <int name=\"y\" value=\"60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"5\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"6\">\n         <int name=\"x\" value=\"990\"/>\n         <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"5\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"5\">\n-        <int name=\"x\" value=\"630\"/>\n+      <imgdir name=\"14\">\n+        <int name=\"x\" value=\"-810\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"2\">\n-        <int name=\"x\" value=\"630\"/>\n-        <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"9\">\n-        <int name=\"x\" value=\"720\"/>\n-        <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"7\">\n+      <imgdir name=\"15\">\n         <int name=\"x\" value=\"1170\"/>\n         <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"45\">\n+      <imgdir name=\"16\">\n         <int name=\"x\" value=\"720\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"11\">\n-        <int name=\"x\" value=\"810\"/>\n-        <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"4\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"28\">\n-        <int name=\"x\" value=\"990\"/>\n         <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"42\">\n-        <int name=\"x\" value=\"900\"/>\n-        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"slLU\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"43\">\n-        <int name=\"x\" value=\"990\"/>\n+      <imgdir name=\"17\">\n+        <int name=\"x\" value=\"-900\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"44\">\n-        <int name=\"x\" value=\"1080\"/>\n+      <imgdir name=\"18\">\n+        <int name=\"x\" value=\"720\"/>\n         <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"40\">\n-        <int name=\"x\" value=\"1260\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n+      <imgdir name=\"19\">\n+        <int name=\"x\" value=\"-900\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"41\">\n-        <int name=\"x\" value=\"1080\"/>\n+      <imgdir name=\"20\">\n+        <int name=\"x\" value=\"-360\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"34\">\n-        <int name=\"x\" value=\"1170\"/>\n-        <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"38\">\n-        <int name=\"x\" value=\"1080\"/>\n-        <int name=\"y\" value=\"60\"/>\n+      <imgdir name=\"21\">\n+        <int name=\"x\" value=\"810\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"39\">\n-        <int name=\"x\" value=\"1170\"/>\n+      <imgdir name=\"22\">\n+        <int name=\"x\" value=\"-360\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"31\">\n-        <int name=\"x\" value=\"1260\"/>\n-        <int name=\"y\" value=\"120\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"0\"/>\n       </imgdir>\n-      <imgdir name=\"32\">\n-        <int name=\"x\" value=\"900\"/>\n+      <imgdir name=\"23\">\n+        <int name=\"x\" value=\"810\"/>\n         <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"4\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"37\">\n-        <int name=\"x\" value=\"1260\"/>\n+      <imgdir name=\"24\">\n+        <int name=\"x\" value=\"810\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"slLU\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"25\">\n+        <int name=\"x\" value=\"-720\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"27\">\n-        <int name=\"x\" value=\"1080\"/>\n-        <int name=\"y\" value=\"-60\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n       <imgdir name=\"26\">\n-        <int name=\"x\" value=\"720\"/>\n-        <int name=\"y\" value=\"60\"/>\n-        <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"3\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"36\">\n-        <int name=\"x\" value=\"900\"/>\n+        <int name=\"x\" value=\"-720\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-      <imgdir name=\"30\">\n-        <int name=\"x\" value=\"990\"/>\n-        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"35\">\n+      <imgdir name=\"27\">\n         <int name=\"x\" value=\"810\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"5\"/>\n+      </imgdir>\n+      <imgdir name=\"28\">\n+        <int name=\"x\" value=\"-630\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"5\"/>\n       </imgdir>\n-      <imgdir name=\"33\">\n+      <imgdir name=\"29\">\n         <int name=\"x\" value=\"900\"/>\n-        <int name=\"y\" value=\"60\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"bsc\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"5\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"obj\">\n-    </imgdir>\n-  </imgdir>\n-  <imgdir name=\"4\">\n-    <imgdir name=\"info\">\n-    </imgdir>\n-    <imgdir name=\"tile\">\n-    </imgdir>\n-    <imgdir name=\"obj\">\n-    </imgdir>\n-  </imgdir>\n-  <imgdir name=\"5\">\n-    <imgdir name=\"info\">\n-      <string name=\"tS\" value=\"masteriaGL3\"/>\n-      <int name=\"tSMag\" value=\"1\"/>\n-    </imgdir>\n-    <imgdir name=\"tile\">\n-      <imgdir name=\"0\">\n-        <int name=\"x\" value=\"-1080\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"edU\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"1\">\n-        <int name=\"x\" value=\"-1080\"/>\n+      <imgdir name=\"30\">\n+        <int name=\"x\" value=\"-630\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"edD\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"8\">\n-        <int name=\"x\" value=\"-900\"/>\n-        <int name=\"y\" value=\"180\"/>\n+      <imgdir name=\"31\">\n+        <int name=\"x\" value=\"1170\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"9\">\n-        <int name=\"x\" value=\"-900\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n+      <imgdir name=\"32\">\n+        <int name=\"x\" value=\"900\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"4\">\n-        <int name=\"x\" value=\"-990\"/>\n+      <imgdir name=\"33\">\n+        <int name=\"x\" value=\"-540\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n-      </imgdir>\n-      <imgdir name=\"5\">\n-        <int name=\"x\" value=\"-990\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n-      </imgdir>\n-      <imgdir name=\"2\">\n-        <int name=\"x\" value=\"-1080\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"3\">\n-        <int name=\"x\" value=\"-1080\"/>\n+      <imgdir name=\"34\">\n+        <int name=\"x\" value=\"-540\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"18\">\n+      <imgdir name=\"35\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"36\">\n         <int name=\"x\" value=\"-450\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"19\">\n+      <imgdir name=\"37\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"5\"/>\n+      </imgdir>\n+      <imgdir name=\"38\">\n+        <int name=\"x\" value=\"900\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"2\"/>\n+      </imgdir>\n+      <imgdir name=\"39\">\n         <int name=\"x\" value=\"-450\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"16\">\n-        <int name=\"x\" value=\"-540\"/>\n+      <imgdir name=\"40\">\n+        <int name=\"x\" value=\"-270\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"41\">\n+        <int name=\"x\" value=\"1080\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"42\">\n+        <int name=\"x\" value=\"1080\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"17\">\n-        <int name=\"x\" value=\"-540\"/>\n+      <imgdir name=\"43\">\n+        <int name=\"x\" value=\"-270\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"0\"/>\n       </imgdir>\n-      <imgdir name=\"14\">\n-        <int name=\"x\" value=\"-630\"/>\n+      <imgdir name=\"44\">\n+        <int name=\"x\" value=\"1170\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"45\">\n+        <int name=\"x\" value=\"90\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"15\">\n-        <int name=\"x\" value=\"-630\"/>\n+      <imgdir name=\"46\">\n+        <int name=\"x\" value=\"1170\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"1\"/>\n+      </imgdir>\n+      <imgdir name=\"47\">\n+        <int name=\"x\" value=\"90\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"12\">\n-        <int name=\"x\" value=\"-720\"/>\n+      <imgdir name=\"48\">\n+        <int name=\"x\" value=\"-180\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"13\">\n-        <int name=\"x\" value=\"-720\"/>\n+      <imgdir name=\"49\">\n+        <int name=\"x\" value=\"1260\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"4\"/>\n+      </imgdir>\n+      <imgdir name=\"50\">\n+        <int name=\"x\" value=\"-180\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"6\">\n-        <int name=\"x\" value=\"-810\"/>\n+      <imgdir name=\"51\">\n+        <int name=\"x\" value=\"1260\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"4\"/>\n+      </imgdir>\n+      <imgdir name=\"52\">\n+        <int name=\"x\" value=\"-90\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"7\">\n-        <int name=\"x\" value=\"-810\"/>\n+      <imgdir name=\"53\">\n+        <int name=\"x\" value=\"720\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"3\"/>\n+      </imgdir>\n+      <imgdir name=\"54\">\n+        <int name=\"x\" value=\"-90\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n-      </imgdir>\n-      <imgdir name=\"10\">\n-        <int name=\"x\" value=\"-360\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"11\">\n-        <int name=\"x\" value=\"-360\"/>\n-        <int name=\"y\" value=\"180\"/>\n+      <imgdir name=\"55\">\n+        <int name=\"x\" value=\"1080\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"28\">\n+      <imgdir name=\"56\">\n         <int name=\"x\" value=\"0\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"29\">\n+      <imgdir name=\"57\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"58\">\n+        <int name=\"x\" value=\"1260\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"5\"/>\n+      </imgdir>\n+      <imgdir name=\"59\">\n         <int name=\"x\" value=\"0\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"26\">\n-        <int name=\"x\" value=\"-90\"/>\n+      <imgdir name=\"60\">\n+        <int name=\"x\" value=\"180\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"27\">\n-        <int name=\"x\" value=\"-90\"/>\n-        <int name=\"y\" value=\"180\"/>\n+      <imgdir name=\"61\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"0\"/>\n       </imgdir>\n-      <imgdir name=\"24\">\n-        <int name=\"x\" value=\"-180\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n+      <imgdir name=\"62\">\n+        <int name=\"x\" value=\"1260\"/>\n+        <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"25\">\n-        <int name=\"x\" value=\"-180\"/>\n+      <imgdir name=\"63\">\n+        <int name=\"x\" value=\"180\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"20\">\n-        <int name=\"x\" value=\"-270\"/>\n+      <imgdir name=\"64\">\n+        <int name=\"x\" value=\"360\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"21\">\n-        <int name=\"x\" value=\"-270\"/>\n+      <imgdir name=\"65\">\n+        <int name=\"x\" value=\"900\"/>\n+        <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"4\"/>\n+      </imgdir>\n+      <imgdir name=\"66\">\n+        <int name=\"x\" value=\"900\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"2\"/>\n+      </imgdir>\n+      <imgdir name=\"67\">\n+        <int name=\"x\" value=\"360\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"22\">\n-        <int name=\"x\" value=\"90\"/>\n+      <imgdir name=\"68\">\n+        <int name=\"x\" value=\"1170\"/>\n+        <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"69\">\n+        <int name=\"x\" value=\"270\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"23\">\n-        <int name=\"x\" value=\"90\"/>\n+      <imgdir name=\"70\">\n+        <int name=\"x\" value=\"810\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"0\"/>\n       </imgdir>\n-      <imgdir name=\"40\">\n-        <int name=\"x\" value=\"540\"/>\n+      <imgdir name=\"71\">\n+        <int name=\"x\" value=\"270\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n-      </imgdir>\n-      <imgdir name=\"41\">\n-        <int name=\"x\" value=\"540\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"34\">\n-        <int name=\"x\" value=\"270\"/>\n+      <imgdir name=\"72\">\n+        <int name=\"x\" value=\"900\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"35\">\n-        <int name=\"x\" value=\"270\"/>\n+      <imgdir name=\"73\">\n+        <int name=\"x\" value=\"450\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"30\">\n-        <int name=\"x\" value=\"180\"/>\n+      <imgdir name=\"74\">\n+        <int name=\"x\" value=\"1260\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"31\">\n-        <int name=\"x\" value=\"180\"/>\n+      <imgdir name=\"75\">\n+        <int name=\"x\" value=\"450\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"0\"/>\n       </imgdir>\n-      <imgdir name=\"32\">\n-        <int name=\"x\" value=\"360\"/>\n+      <imgdir name=\"76\">\n+        <int name=\"x\" value=\"630\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"33\">\n-        <int name=\"x\" value=\"360\"/>\n+      <imgdir name=\"77\">\n+        <int name=\"x\" value=\"1080\"/>\n+        <int name=\"y\" value=\"60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"78\">\n+        <int name=\"x\" value=\"1170\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"1\"/>\n+      </imgdir>\n+      <imgdir name=\"79\">\n+        <int name=\"x\" value=\"630\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"36\">\n-        <int name=\"x\" value=\"450\"/>\n-        <int name=\"y\" value=\"180\"/>\n+      <imgdir name=\"80\">\n+        <int name=\"x\" value=\"1260\"/>\n+        <int name=\"y\" value=\"-60\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"37\">\n-        <int name=\"x\" value=\"450\"/>\n+      <imgdir name=\"81\">\n+        <int name=\"x\" value=\"540\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"50\">\n-        <int name=\"x\" value=\"990\"/>\n+      <imgdir name=\"82\">\n+        <int name=\"x\" value=\"1080\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"51\">\n-        <int name=\"x\" value=\"990\"/>\n+      <imgdir name=\"83\">\n+        <int name=\"x\" value=\"540\"/>\n         <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"44\">\n-        <int name=\"x\" value=\"720\"/>\n+      <imgdir name=\"84\">\n+        <int name=\"x\" value=\"900\"/>\n+        <int name=\"y\" value=\"0\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"slLU\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"85\">\n+        <int name=\"x\" value=\"810\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"45\">\n-        <int name=\"x\" value=\"720\"/>\n+      <imgdir name=\"86\">\n+        <int name=\"x\" value=\"810\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"87\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"38\">\n-        <int name=\"x\" value=\"630\"/>\n+      <imgdir name=\"88\">\n+        <int name=\"x\" value=\"720\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"39\">\n-        <int name=\"x\" value=\"630\"/>\n+      <imgdir name=\"89\">\n+        <int name=\"x\" value=\"1080\"/>\n+        <int name=\"y\" value=\"120\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"bsc\"/>\n+        <int name=\"no\" value=\"2\"/>\n+      </imgdir>\n+      <imgdir name=\"90\">\n+        <int name=\"x\" value=\"720\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"2\"/>\n       </imgdir>\n-      <imgdir name=\"42\">\n-        <int name=\"x\" value=\"810\"/>\n+      <imgdir name=\"91\">\n+        <int name=\"x\" value=\"720\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n-      </imgdir>\n-      <imgdir name=\"43\">\n-        <int name=\"x\" value=\"810\"/>\n-        <int name=\"y\" value=\"180\"/>\n-        <string name=\"u\" value=\"enH0\"/>\n-        <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n+        <int name=\"no\" value=\"1\"/>\n       </imgdir>\n-      <imgdir name=\"46\">\n+      <imgdir name=\"92\">\n         <int name=\"x\" value=\"900\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"47\">\n+      <imgdir name=\"93\">\n         <int name=\"x\" value=\"900\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"48\">\n+      <imgdir name=\"94\">\n         <int name=\"x\" value=\"1080\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"49\">\n+      <imgdir name=\"95\">\n         <int name=\"x\" value=\"1080\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"52\">\n+      <imgdir name=\"96\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH1\"/>\n+        <int name=\"no\" value=\"1\"/>\n+      </imgdir>\n+      <imgdir name=\"97\">\n+        <int name=\"x\" value=\"990\"/>\n+        <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n+        <string name=\"u\" value=\"enH0\"/>\n+        <int name=\"no\" value=\"2\"/>\n+      </imgdir>\n+      <imgdir name=\"98\">\n         <int name=\"x\" value=\"1170\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"53\">\n+      <imgdir name=\"99\">\n         <int name=\"x\" value=\"1170\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"2\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"54\">\n+      <imgdir name=\"100\">\n         <int name=\"x\" value=\"1260\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH1\"/>\n         <int name=\"no\" value=\"1\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n-      <imgdir name=\"55\">\n+      <imgdir name=\"101\">\n         <int name=\"x\" value=\"1260\"/>\n         <int name=\"y\" value=\"180\"/>\n+        <int name=\"zM\" value=\"7\"/>\n         <string name=\"u\" value=\"enH0\"/>\n         <int name=\"no\" value=\"0\"/>\n-        <int name=\"zM\" value=\"4\"/>\n       </imgdir>\n     </imgdir>\n+  </imgdir>\n+  <imgdir name=\"2\">\n+    <imgdir name=\"info\">\n+    </imgdir>\n     <imgdir name=\"obj\">\n       <imgdir name=\"0\">\n+        <int name=\"x\" value=\"1143\"/>\n+        <int name=\"y\" value=\"51\"/>\n+        <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"8\"/>\n         <string name=\"oS\" value=\"masteriaGL2\"/>\n         <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n         <string name=\"l1\" value=\"wall\"/>\n-        <string name=\"l2\" value=\"10\"/>\n+        <string name=\"l2\" value=\"11\"/>\n+        <int name=\"r\" value=\"0\"/>\n+        <int name=\"f\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"1\">\n         <int name=\"x\" value=\"747\"/>\n         <int name=\"y\" value=\"111\"/>\n         <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"8\"/>\n+        <string name=\"oS\" value=\"masteriaGL2\"/>\n+        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n+        <string name=\"l1\" value=\"wall\"/>\n+        <string name=\"l2\" value=\"10\"/>\n+        <int name=\"r\" value=\"0\"/>\n         <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"0\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"tile\">\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"3\">\n+    <imgdir name=\"info\">\n+    </imgdir>\n+    <imgdir name=\"obj\">\n+      <imgdir name=\"0\">\n+        <int name=\"x\" value=\"1041\"/>\n+        <int name=\"y\" value=\"284\"/>\n+        <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"5\"/>\n+        <string name=\"oS\" value=\"masteriaGL2\"/>\n+        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n+        <string name=\"l1\" value=\"tile\"/>\n+        <string name=\"l2\" value=\"5\"/>\n         <int name=\"r\" value=\"0\"/>\n+        <int name=\"f\" value=\"0\"/>\n       </imgdir>\n       <imgdir name=\"1\">\n+        <int name=\"x\" value=\"424\"/>\n+        <int name=\"y\" value=\"284\"/>\n+        <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"5\"/>\n         <string name=\"oS\" value=\"masteriaGL2\"/>\n         <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n-        <string name=\"l1\" value=\"wall\"/>\n-        <string name=\"l2\" value=\"11\"/>\n-        <int name=\"x\" value=\"1143\"/>\n-        <int name=\"y\" value=\"51\"/>\n+        <string name=\"l1\" value=\"tile\"/>\n+        <string name=\"l2\" value=\"5\"/>\n+        <int name=\"r\" value=\"0\"/>\n+        <int name=\"f\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"2\">\n+        <int name=\"x\" value=\"-193\"/>\n+        <int name=\"y\" value=\"283\"/>\n         <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"5\"/>\n+        <string name=\"oS\" value=\"masteriaGL2\"/>\n+        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n+        <string name=\"l1\" value=\"tile\"/>\n+        <string name=\"l2\" value=\"5\"/>\n+        <int name=\"r\" value=\"0\"/>\n         <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"0\"/>\n+      </imgdir>\n+      <imgdir name=\"3\">\n+        <int name=\"x\" value=\"-810\"/>\n+        <int name=\"y\" value=\"284\"/>\n+        <int name=\"z\" value=\"9\"/>\n+        <int name=\"zM\" value=\"5\"/>\n+        <string name=\"oS\" value=\"masteriaGL2\"/>\n+        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n+        <string name=\"l1\" value=\"tile\"/>\n+        <string name=\"l2\" value=\"5\"/>\n         <int name=\"r\" value=\"0\"/>\n+        <int name=\"f\" value=\"0\"/>\n       </imgdir>\n     </imgdir>\n+    <imgdir name=\"tile\">\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"4\">\n+    <imgdir name=\"info\">\n+    </imgdir>\n+    <imgdir name=\"obj\">\n+    </imgdir>\n+    <imgdir name=\"tile\">\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"5\">\n+    <imgdir name=\"info\">\n+    </imgdir>\n+    <imgdir name=\"obj\">\n+    </imgdir>\n+    <imgdir name=\"tile\">\n+    </imgdir>\n   </imgdir>\n   <imgdir name=\"6\">\n     <imgdir name=\"info\">\n     </imgdir>\n+    <imgdir name=\"obj\">\n+    </imgdir>\n+    <imgdir name=\"tile\">\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"7\">\n+    <imgdir name=\"info\">\n+    </imgdir>\n+    <imgdir name=\"obj\">\n+    </imgdir>\n     <imgdir name=\"tile\">\n     </imgdir>\n-    <imgdir name=\"obj\">\n-      <imgdir name=\"0\">\n-        <string name=\"oS\" value=\"masteriaGL2\"/>\n-        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n-        <string name=\"l1\" value=\"tile\"/>\n-        <string name=\"l2\" value=\"5\"/>\n-        <int name=\"x\" value=\"-810\"/>\n-        <int name=\"y\" value=\"284\"/>\n-        <int name=\"z\" value=\"9\"/>\n-        <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"0\"/>\n-        <int name=\"r\" value=\"0\"/>\n-      </imgdir>\n-      <imgdir name=\"1\">\n-        <string name=\"oS\" value=\"masteriaGL2\"/>\n-        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n-        <string name=\"l1\" value=\"tile\"/>\n-        <string name=\"l2\" value=\"5\"/>\n-        <int name=\"x\" value=\"-193\"/>\n-        <int name=\"y\" value=\"284\"/>\n-        <int name=\"z\" value=\"9\"/>\n-        <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"1\"/>\n-        <int name=\"r\" value=\"0\"/>\n-      </imgdir>\n-      <imgdir name=\"2\">\n-        <string name=\"oS\" value=\"masteriaGL2\"/>\n-        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n-        <string name=\"l1\" value=\"tile\"/>\n-        <string name=\"l2\" value=\"5\"/>\n-        <int name=\"x\" value=\"424\"/>\n-        <int name=\"y\" value=\"284\"/>\n-        <int name=\"z\" value=\"9\"/>\n-        <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"2\"/>\n-        <int name=\"r\" value=\"0\"/>\n-      </imgdir>\n-      <imgdir name=\"3\">\n-        <string name=\"oS\" value=\"masteriaGL2\"/>\n-        <string name=\"l0\" value=\"crimsonwoodKeep\"/>\n-        <string name=\"l1\" value=\"tile\"/>\n-        <string name=\"l2\" value=\"5\"/>\n-        <int name=\"x\" value=\"1041\"/>\n-        <int name=\"y\" value=\"284\"/>\n-        <int name=\"z\" value=\"9\"/>\n-        <int name=\"f\" value=\"0\"/>\n-        <int name=\"zM\" value=\"3\"/>\n-        <int name=\"r\" value=\"0\"/>\n-      </imgdir>\n+  </imgdir>\n+  <imgdir name=\"ladderRope\">\n+  </imgdir>\n+  <imgdir name=\"portal\">\n+    <imgdir name=\"0\">\n+      <int name=\"x\" value=\"7\"/>\n+      <int name=\"y\" value=\"116\"/>\n+      <int name=\"pt\" value=\"0\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"sp\"/>\n+    </imgdir>\n+    <imgdir name=\"1\">\n+      <int name=\"x\" value=\"-1007\"/>\n+      <int name=\"y\" value=\"169\"/>\n+      <int name=\"pt\" value=\"2\"/>\n+      <int name=\"tm\" value=\"610020006\"/>\n+      <string name=\"tn\" value=\"in00\"/>\n+      <string name=\"pn\" value=\"out00\"/>\n+    </imgdir>\n+    <imgdir name=\"2\">\n+      <int name=\"x\" value=\"1190\"/>\n+      <int name=\"y\" value=\"-70\"/>\n+      <int name=\"pt\" value=\"2\"/>\n+      <int name=\"tm\" value=\"610030010\"/>\n+      <string name=\"tn\" value=\"out00\"/>\n+      <string name=\"pn\" value=\"in00\"/>\n+    </imgdir>\n+    <imgdir name=\"3\">\n+      <int name=\"x\" value=\"-585\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"4\">\n+      <int name=\"x\" value=\"-859\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"5\">\n+      <int name=\"x\" value=\"-311\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"6\">\n+      <int name=\"x\" value=\"-40\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"7\">\n+      <int name=\"x\" value=\"226\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"8\">\n+      <int name=\"x\" value=\"493\"/>\n+      <int name=\"y\" value=\"167\"/>\n+      <int name=\"pt\" value=\"6\"/>\n+      <int name=\"tm\" value=\"999999999\"/>\n+      <string name=\"tn\" value=\"\"/>\n+      <string name=\"pn\" value=\"tp\"/>\n+      <int name=\"hideTooltip\" value=\"0\"/>\n+      <int name=\"onlyOnce\" value=\"0\"/>\n+    </imgdir>\n+  </imgdir>\n+  <imgdir name=\"reactor\">\n+  </imgdir>\n+  <imgdir name=\"back\">\n+    <imgdir name=\"0\">\n+      <int name=\"x\" value=\"0\"/>\n+      <int name=\"y\" value=\"0\"/>\n+      <int name=\"rx\" value=\"0\"/>\n+      <int name=\"ry\" value=\"0\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"3\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"0\"/>\n+    </imgdir>\n+    <imgdir name=\"1\">\n+      <int name=\"x\" value=\"-1\"/>\n+      <int name=\"y\" value=\"-15\"/>\n+      <int name=\"rx\" value=\"-5\"/>\n+      <int name=\"ry\" value=\"-5\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"1\"/>\n+    </imgdir>\n+    <imgdir name=\"2\">\n+      <int name=\"x\" value=\"-101\"/>\n+      <int name=\"y\" value=\"-268\"/>\n+      <int name=\"rx\" value=\"-8\"/>\n+      <int name=\"ry\" value=\"-4\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"2\"/>\n+    </imgdir>\n+    <imgdir name=\"3\">\n+      <int name=\"x\" value=\"-46\"/>\n+      <int name=\"y\" value=\"-137\"/>\n+      <int name=\"rx\" value=\"-10\"/>\n+      <int name=\"ry\" value=\"-6\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"3\"/>\n+    </imgdir>\n+    <imgdir name=\"4\">\n+      <int name=\"x\" value=\"-16\"/>\n+      <int name=\"y\" value=\"-188\"/>\n+      <int name=\"rx\" value=\"-13\"/>\n+      <int name=\"ry\" value=\"-8\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"4\"/>\n     </imgdir>\n-  </imgdir>\n-  <imgdir name=\"7\">\n-    <imgdir name=\"info\">\n+    <imgdir name=\"5\">\n+      <int name=\"x\" value=\"16\"/>\n+      <int name=\"y\" value=\"-265\"/>\n+      <int name=\"rx\" value=\"-15\"/>\n+      <int name=\"ry\" value=\"-9\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"5\"/>\n     </imgdir>\n-    <imgdir name=\"tile\">\n+    <imgdir name=\"6\">\n+      <int name=\"x\" value=\"121\"/>\n+      <int name=\"y\" value=\"-363\"/>\n+      <int name=\"rx\" value=\"-20\"/>\n+      <int name=\"ry\" value=\"-10\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"6\"/>\n     </imgdir>\n-    <imgdir name=\"obj\">\n+    <imgdir name=\"7\">\n+      <int name=\"x\" value=\"144\"/>\n+      <int name=\"y\" value=\"-65\"/>\n+      <int name=\"rx\" value=\"-50\"/>\n+      <int name=\"ry\" value=\"-50\"/>\n+      <int name=\"cx\" value=\"0\"/>\n+      <int name=\"cy\" value=\"0\"/>\n+      <int name=\"a\" value=\"255\"/>\n+      <int name=\"type\" value=\"0\"/>\n+      <int name=\"front\" value=\"0\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"bS\" value=\"masteriaGL2\"/>\n+      <int name=\"ani\" value=\"0\"/>\n+      <int name=\"no\" value=\"107\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"foothold\">\n-    <imgdir name=\"3\">\n-      <imgdir name=\"5\">\n-        <imgdir name=\"1\">\n+    <imgdir name=\"1\">\n+      <imgdir name=\"7\">\n+        <imgdir name=\"21\">\n           <int name=\"x1\" value=\"513\"/>\n-          <int name=\"y1\" value=\"180\"/>\n-          <int name=\"x2\" value=\"513\"/>\n+          <int name=\"y1\" value=\"171\"/>\n+          <int name=\"x2\" value=\"540\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"0\"/>\n-          <int name=\"next\" value=\"2\"/>\n+          <int name=\"prev\" value=\"22\"/>\n+          <int name=\"next\" value=\"23\"/>\n         </imgdir>\n-        <imgdir name=\"2\">\n+        <imgdir name=\"22\">\n           <int name=\"x1\" value=\"513\"/>\n-          <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"540\"/>\n+          <int name=\"y1\" value=\"180\"/>\n+          <int name=\"x2\" value=\"513\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"1\"/>\n-          <int name=\"next\" value=\"3\"/>\n+          <int name=\"prev\" value=\"0\"/>\n+          <int name=\"next\" value=\"21\"/>\n         </imgdir>\n-        <imgdir name=\"3\">\n+        <imgdir name=\"23\">\n           <int name=\"x1\" value=\"540\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"630\"/>\n           <int name=\"y2\" value=\"111\"/>\n-          <int name=\"prev\" value=\"2\"/>\n-          <int name=\"next\" value=\"4\"/>\n+          <int name=\"prev\" value=\"21\"/>\n+          <int name=\"next\" value=\"25\"/>\n         </imgdir>\n-        <imgdir name=\"4\">\n+        <imgdir name=\"25\">\n           <int name=\"x1\" value=\"630\"/>\n           <int name=\"y1\" value=\"111\"/>\n           <int name=\"x2\" value=\"720\"/>\n           <int name=\"y2\" value=\"51\"/>\n-          <int name=\"prev\" value=\"3\"/>\n-          <int name=\"next\" value=\"5\"/>\n+          <int name=\"prev\" value=\"23\"/>\n+          <int name=\"next\" value=\"27\"/>\n         </imgdir>\n-        <imgdir name=\"5\">\n+        <imgdir name=\"27\">\n           <int name=\"x1\" value=\"720\"/>\n           <int name=\"y1\" value=\"51\"/>\n           <int name=\"x2\" value=\"810\"/>\n           <int name=\"y2\" value=\"-9\"/>\n-          <int name=\"prev\" value=\"4\"/>\n-          <int name=\"next\" value=\"11\"/>\n+          <int name=\"prev\" value=\"25\"/>\n+          <int name=\"next\" value=\"29\"/>\n         </imgdir>\n-        <imgdir name=\"6\">\n-          <int name=\"x1\" value=\"1170\"/>\n-          <int name=\"y1\" value=\"-69\"/>\n-          <int name=\"x2\" value=\"1260\"/>\n+        <imgdir name=\"29\">\n+          <int name=\"x1\" value=\"810\"/>\n+          <int name=\"y1\" value=\"-9\"/>\n+          <int name=\"x2\" value=\"900\"/>\n           <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"8\"/>\n-          <int name=\"next\" value=\"10\"/>\n+          <int name=\"prev\" value=\"27\"/>\n+          <int name=\"next\" value=\"31\"/>\n         </imgdir>\n-        <imgdir name=\"7\">\n+        <imgdir name=\"31\">\n           <int name=\"x1\" value=\"900\"/>\n           <int name=\"y1\" value=\"-69\"/>\n           <int name=\"x2\" value=\"990\"/>\n           <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"11\"/>\n-          <int name=\"next\" value=\"9\"/>\n+          <int name=\"prev\" value=\"29\"/>\n+          <int name=\"next\" value=\"33\"/>\n         </imgdir>\n-        <imgdir name=\"8\">\n+        <imgdir name=\"33\">\n+          <int name=\"x1\" value=\"990\"/>\n+          <int name=\"y1\" value=\"-69\"/>\n+          <int name=\"x2\" value=\"1080\"/>\n+          <int name=\"y2\" value=\"-69\"/>\n+          <int name=\"prev\" value=\"31\"/>\n+          <int name=\"next\" value=\"35\"/>\n+        </imgdir>\n+        <imgdir name=\"35\">\n           <int name=\"x1\" value=\"1080\"/>\n           <int name=\"y1\" value=\"-69\"/>\n           <int name=\"x2\" value=\"1170\"/>\n           <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"9\"/>\n-          <int name=\"next\" value=\"6\"/>\n+          <int name=\"prev\" value=\"33\"/>\n+          <int name=\"next\" value=\"37\"/>\n         </imgdir>\n-        <imgdir name=\"9\">\n-          <int name=\"x1\" value=\"990\"/>\n+        <imgdir name=\"37\">\n+          <int name=\"x1\" value=\"1170\"/>\n           <int name=\"y1\" value=\"-69\"/>\n-          <int name=\"x2\" value=\"1080\"/>\n+          <int name=\"x2\" value=\"1260\"/>\n           <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"7\"/>\n-          <int name=\"next\" value=\"8\"/>\n+          <int name=\"prev\" value=\"35\"/>\n+          <int name=\"next\" value=\"39\"/>\n         </imgdir>\n-        <imgdir name=\"10\">\n+        <imgdir name=\"39\">\n           <int name=\"x1\" value=\"1260\"/>\n           <int name=\"y1\" value=\"-69\"/>\n           <int name=\"x2\" value=\"1350\"/>\n           <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"6\"/>\n+          <int name=\"prev\" value=\"37\"/>\n           <int name=\"next\" value=\"0\"/>\n         </imgdir>\n-        <imgdir name=\"11\">\n-          <int name=\"x1\" value=\"810\"/>\n-          <int name=\"y1\" value=\"-9\"/>\n-          <int name=\"x2\" value=\"900\"/>\n-          <int name=\"y2\" value=\"-69\"/>\n-          <int name=\"prev\" value=\"5\"/>\n-          <int name=\"next\" value=\"7\"/>\n-        </imgdir>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"5\">\n       <imgdir name=\"4\">\n-        <imgdir name=\"12\">\n+        <imgdir name=\"1\">\n           <int name=\"x1\" value=\"-1107\"/>\n-          <int name=\"y1\" value=\"180\"/>\n-          <int name=\"x2\" value=\"-1107\"/>\n+          <int name=\"y1\" value=\"171\"/>\n+          <int name=\"x2\" value=\"-1053\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"0\"/>\n-          <int name=\"next\" value=\"13\"/>\n+          <int name=\"prev\" value=\"2\"/>\n+          <int name=\"next\" value=\"3\"/>\n         </imgdir>\n-        <imgdir name=\"13\">\n+        <imgdir name=\"2\">\n           <int name=\"x1\" value=\"-1107\"/>\n-          <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"-1053\"/>\n+          <int name=\"y1\" value=\"180\"/>\n+          <int name=\"x2\" value=\"-1107\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"12\"/>\n-          <int name=\"next\" value=\"14\"/>\n+          <int name=\"prev\" value=\"0\"/>\n+          <int name=\"next\" value=\"1\"/>\n         </imgdir>\n-        <imgdir name=\"14\">\n+        <imgdir name=\"3\">\n           <int name=\"x1\" value=\"-1053\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-990\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"13\"/>\n-          <int name=\"next\" value=\"15\"/>\n+          <int name=\"prev\" value=\"1\"/>\n+          <int name=\"next\" value=\"4\"/>\n         </imgdir>\n-        <imgdir name=\"15\">\n+        <imgdir name=\"4\">\n           <int name=\"x1\" value=\"-990\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-900\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"14\"/>\n-          <int name=\"next\" value=\"17\"/>\n-        </imgdir>\n-        <imgdir name=\"16\">\n-          <int name=\"x1\" value=\"-810\"/>\n-          <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"-720\"/>\n-          <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"17\"/>\n-          <int name=\"next\" value=\"19\"/>\n+          <int name=\"prev\" value=\"3\"/>\n+          <int name=\"next\" value=\"5\"/>\n         </imgdir>\n-        <imgdir name=\"17\">\n+        <imgdir name=\"5\">\n           <int name=\"x1\" value=\"-900\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-810\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"15\"/>\n-          <int name=\"next\" value=\"16\"/>\n+          <int name=\"prev\" value=\"4\"/>\n+          <int name=\"next\" value=\"6\"/>\n         </imgdir>\n-        <imgdir name=\"18\">\n-          <int name=\"x1\" value=\"-360\"/>\n+        <imgdir name=\"6\">\n+          <int name=\"x1\" value=\"-810\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"-270\"/>\n+          <int name=\"x2\" value=\"-720\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"22\"/>\n-          <int name=\"next\" value=\"23\"/>\n+          <int name=\"prev\" value=\"5\"/>\n+          <int name=\"next\" value=\"7\"/>\n         </imgdir>\n-        <imgdir name=\"19\">\n+        <imgdir name=\"7\">\n           <int name=\"x1\" value=\"-720\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-630\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"16\"/>\n-          <int name=\"next\" value=\"20\"/>\n+          <int name=\"prev\" value=\"6\"/>\n+          <int name=\"next\" value=\"8\"/>\n         </imgdir>\n-        <imgdir name=\"20\">\n+        <imgdir name=\"8\">\n           <int name=\"x1\" value=\"-630\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-540\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"19\"/>\n-          <int name=\"next\" value=\"21\"/>\n+          <int name=\"prev\" value=\"7\"/>\n+          <int name=\"next\" value=\"9\"/>\n         </imgdir>\n-        <imgdir name=\"21\">\n+        <imgdir name=\"9\">\n           <int name=\"x1\" value=\"-540\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-450\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"20\"/>\n-          <int name=\"next\" value=\"22\"/>\n+          <int name=\"prev\" value=\"8\"/>\n+          <int name=\"next\" value=\"10\"/>\n         </imgdir>\n-        <imgdir name=\"22\">\n+        <imgdir name=\"10\">\n           <int name=\"x1\" value=\"-450\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-360\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"21\"/>\n-          <int name=\"next\" value=\"18\"/>\n+          <int name=\"prev\" value=\"9\"/>\n+          <int name=\"next\" value=\"11\"/>\n         </imgdir>\n-        <imgdir name=\"23\">\n-          <int name=\"x1\" value=\"-270\"/>\n+        <imgdir name=\"11\">\n+          <int name=\"x1\" value=\"-360\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"-180\"/>\n+          <int name=\"x2\" value=\"-270\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"18\"/>\n-          <int name=\"next\" value=\"25\"/>\n+          <int name=\"prev\" value=\"10\"/>\n+          <int name=\"next\" value=\"12\"/>\n         </imgdir>\n-        <imgdir name=\"24\">\n-          <int name=\"x1\" value=\"90\"/>\n+        <imgdir name=\"12\">\n+          <int name=\"x1\" value=\"-270\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"180\"/>\n+          <int name=\"x2\" value=\"-180\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"27\"/>\n-          <int name=\"next\" value=\"28\"/>\n+          <int name=\"prev\" value=\"11\"/>\n+          <int name=\"next\" value=\"13\"/>\n         </imgdir>\n-        <imgdir name=\"25\">\n+        <imgdir name=\"13\">\n           <int name=\"x1\" value=\"-180\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"-90\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"23\"/>\n-          <int name=\"next\" value=\"26\"/>\n+          <int name=\"prev\" value=\"12\"/>\n+          <int name=\"next\" value=\"14\"/>\n         </imgdir>\n-        <imgdir name=\"26\">\n+        <imgdir name=\"14\">\n           <int name=\"x1\" value=\"-90\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"0\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"25\"/>\n-          <int name=\"next\" value=\"27\"/>\n+          <int name=\"prev\" value=\"13\"/>\n+          <int name=\"next\" value=\"15\"/>\n         </imgdir>\n-        <imgdir name=\"27\">\n+        <imgdir name=\"15\">\n           <int name=\"x1\" value=\"0\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"90\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"26\"/>\n-          <int name=\"next\" value=\"24\"/>\n+          <int name=\"prev\" value=\"14\"/>\n+          <int name=\"next\" value=\"16\"/>\n         </imgdir>\n-        <imgdir name=\"28\">\n-          <int name=\"x1\" value=\"180\"/>\n+        <imgdir name=\"16\">\n+          <int name=\"x1\" value=\"90\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"270\"/>\n+          <int name=\"x2\" value=\"180\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"24\"/>\n-          <int name=\"next\" value=\"30\"/>\n+          <int name=\"prev\" value=\"15\"/>\n+          <int name=\"next\" value=\"17\"/>\n         </imgdir>\n-        <imgdir name=\"29\">\n-          <int name=\"x1\" value=\"360\"/>\n+        <imgdir name=\"17\">\n+          <int name=\"x1\" value=\"180\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"450\"/>\n+          <int name=\"x2\" value=\"270\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"30\"/>\n-          <int name=\"next\" value=\"31\"/>\n+          <int name=\"prev\" value=\"16\"/>\n+          <int name=\"next\" value=\"18\"/>\n         </imgdir>\n-        <imgdir name=\"30\">\n+        <imgdir name=\"18\">\n           <int name=\"x1\" value=\"270\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"360\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"28\"/>\n-          <int name=\"next\" value=\"29\"/>\n+          <int name=\"prev\" value=\"17\"/>\n+          <int name=\"next\" value=\"19\"/>\n         </imgdir>\n-        <imgdir name=\"31\">\n+        <imgdir name=\"19\">\n+          <int name=\"x1\" value=\"360\"/>\n+          <int name=\"y1\" value=\"171\"/>\n+          <int name=\"x2\" value=\"450\"/>\n+          <int name=\"y2\" value=\"171\"/>\n+          <int name=\"prev\" value=\"18\"/>\n+          <int name=\"next\" value=\"20\"/>\n+        </imgdir>\n+        <imgdir name=\"20\">\n           <int name=\"x1\" value=\"450\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"540\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"29\"/>\n-          <int name=\"next\" value=\"33\"/>\n+          <int name=\"prev\" value=\"19\"/>\n+          <int name=\"next\" value=\"24\"/>\n         </imgdir>\n-        <imgdir name=\"32\">\n+        <imgdir name=\"24\">\n+          <int name=\"x1\" value=\"540\"/>\n+          <int name=\"y1\" value=\"171\"/>\n+          <int name=\"x2\" value=\"630\"/>\n+          <int name=\"y2\" value=\"171\"/>\n+          <int name=\"prev\" value=\"20\"/>\n+          <int name=\"next\" value=\"26\"/>\n+        </imgdir>\n+        <imgdir name=\"26\">\n           <int name=\"x1\" value=\"630\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"720\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"33\"/>\n-          <int name=\"next\" value=\"35\"/>\n+          <int name=\"prev\" value=\"24\"/>\n+          <int name=\"next\" value=\"28\"/>\n         </imgdir>\n-        <imgdir name=\"33\">\n-          <int name=\"x1\" value=\"540\"/>\n+        <imgdir name=\"28\">\n+          <int name=\"x1\" value=\"720\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"630\"/>\n+          <int name=\"x2\" value=\"810\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"31\"/>\n-          <int name=\"next\" value=\"32\"/>\n+          <int name=\"prev\" value=\"26\"/>\n+          <int name=\"next\" value=\"30\"/>\n         </imgdir>\n-        <imgdir name=\"34\">\n+        <imgdir name=\"30\">\n           <int name=\"x1\" value=\"810\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"900\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"35\"/>\n-          <int name=\"next\" value=\"36\"/>\n+          <int name=\"prev\" value=\"28\"/>\n+          <int name=\"next\" value=\"32\"/>\n         </imgdir>\n-        <imgdir name=\"35\">\n-          <int name=\"x1\" value=\"720\"/>\n+        <imgdir name=\"32\">\n+          <int name=\"x1\" value=\"900\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"810\"/>\n+          <int name=\"x2\" value=\"990\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"32\"/>\n+          <int name=\"prev\" value=\"30\"/>\n           <int name=\"next\" value=\"34\"/>\n         </imgdir>\n-        <imgdir name=\"36\">\n-          <int name=\"x1\" value=\"900\"/>\n+        <imgdir name=\"34\">\n+          <int name=\"x1\" value=\"990\"/>\n           <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"990\"/>\n+          <int name=\"x2\" value=\"1080\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"34\"/>\n-          <int name=\"next\" value=\"38\"/>\n+          <int name=\"prev\" value=\"32\"/>\n+          <int name=\"next\" value=\"36\"/>\n         </imgdir>\n-        <imgdir name=\"37\">\n+        <imgdir name=\"36\">\n           <int name=\"x1\" value=\"1080\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"1170\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"38\"/>\n-          <int name=\"next\" value=\"39\"/>\n+          <int name=\"prev\" value=\"34\"/>\n+          <int name=\"next\" value=\"38\"/>\n         </imgdir>\n         <imgdir name=\"38\">\n-          <int name=\"x1\" value=\"990\"/>\n-          <int name=\"y1\" value=\"171\"/>\n-          <int name=\"x2\" value=\"1080\"/>\n-          <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"36\"/>\n-          <int name=\"next\" value=\"37\"/>\n-        </imgdir>\n-        <imgdir name=\"39\">\n           <int name=\"x1\" value=\"1170\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"1260\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"37\"/>\n+          <int name=\"prev\" value=\"36\"/>\n           <int name=\"next\" value=\"40\"/>\n         </imgdir>\n         <imgdir name=\"40\">\n           <int name=\"x1\" value=\"1260\"/>\n           <int name=\"y1\" value=\"171\"/>\n           <int name=\"x2\" value=\"1350\"/>\n           <int name=\"y2\" value=\"171\"/>\n-          <int name=\"prev\" value=\"39\"/>\n+          <int name=\"prev\" value=\"38\"/>\n           <int name=\"next\" value=\"0\"/>\n         </imgdir>\n       </imgdir>\n     </imgdir>\n   </imgdir>\n-  <imgdir name=\"ladderRope\">\n-  </imgdir>\n-  <imgdir name=\"miniMap\">\n-    <canvas name=\"canvas\" width=\"160\" height=\"42\">\n-    </canvas>\n-    <int name=\"width\" value=\"2564\"/>\n-    <int name=\"height\" value=\"675\"/>\n-    <int name=\"centerX\" value=\"1166\"/>\n-    <int name=\"centerY\" value=\"221\"/>\n-    <int name=\"mag\" value=\"4\"/>\n-  </imgdir>\n-  <imgdir name=\"portal\">\n+  <imgdir name=\"life\">\n     <imgdir name=\"0\">\n-      <string name=\"pn\" value=\"sp\"/>\n-      <int name=\"pt\" value=\"0\"/>\n-      <int name=\"x\" value=\"7\"/>\n-      <int name=\"y\" value=\"116\"/>\n-      <int name=\"tm\" value=\"999999999\"/>\n-      <string name=\"tn\" value=\"\"/>\n+      <string name=\"id\" value=\"9201107\"/>\n+      <int name=\"x\" value=\"-715\"/>\n+      <int name=\"y\" value=\"165\"/>\n+      <int name=\"cy\" value=\"171\"/>\n+      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"rx0\" value=\"-765\"/>\n+      <int name=\"rx1\" value=\"-665\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"type\" value=\"n\"/>\n+      <int name=\"fh\" value=\"7\"/>\n     </imgdir>\n     <imgdir name=\"1\">\n-      <string name=\"pn\" value=\"out00\"/>\n-      <int name=\"pt\" value=\"2\"/>\n-      <int name=\"x\" value=\"-1007\"/>\n-      <int name=\"y\" value=\"169\"/>\n-      <int name=\"tm\" value=\"610020006\"/>\n-      <string name=\"tn\" value=\"in00\"/>\n+      <string name=\"id\" value=\"9201108\"/>\n+      <int name=\"x\" value=\"-179\"/>\n+      <int name=\"y\" value=\"159\"/>\n+      <int name=\"cy\" value=\"171\"/>\n+      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"rx0\" value=\"-229\"/>\n+      <int name=\"rx1\" value=\"-129\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"type\" value=\"n\"/>\n+      <int name=\"fh\" value=\"13\"/>\n     </imgdir>\n     <imgdir name=\"2\">\n-      <string name=\"pn\" value=\"in00\"/>\n-      <int name=\"pt\" value=\"2\"/>\n-      <int name=\"x\" value=\"1190\"/>\n-      <int name=\"y\" value=\"-70\"/>\n-      <int name=\"tm\" value=\"610030010\"/>\n-      <string name=\"tn\" value=\"out00\"/>\n+      <string name=\"id\" value=\"9201109\"/>\n+      <int name=\"x\" value=\"-460\"/>\n+      <int name=\"y\" value=\"161\"/>\n+      <int name=\"cy\" value=\"171\"/>\n+      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"rx0\" value=\"-510\"/>\n+      <int name=\"rx1\" value=\"-410\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"type\" value=\"n\"/>\n+      <int name=\"fh\" value=\"9\"/>\n+    </imgdir>\n+    <imgdir name=\"3\">\n+      <string name=\"id\" value=\"9201110\"/>\n+      <int name=\"x\" value=\"96\"/>\n+      <int name=\"y\" value=\"165\"/>\n+      <int name=\"cy\" value=\"171\"/>\n+      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"rx0\" value=\"46\"/>\n+      <int name=\"rx1\" value=\"146\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"type\" value=\"n\"/>\n+      <int name=\"fh\" value=\"16\"/>\n+    </imgdir>\n+    <imgdir name=\"4\">\n+      <string name=\"id\" value=\"9201111\"/>\n+      <int name=\"x\" value=\"364\"/>\n+      <int name=\"y\" value=\"166\"/>\n+      <int name=\"cy\" value=\"171\"/>\n+      <int name=\"mobTime\" value=\"0\"/>\n+      <int name=\"rx0\" value=\"314\"/>\n+      <int name=\"rx1\" value=\"414\"/>\n+      <int name=\"f\" value=\"0\"/>\n+      <string name=\"type\" value=\"n\"/>\n+      <int name=\"fh\" value=\"19\"/>\n     </imgdir>\n   </imgdir>\n </imgdir>"}, {"sha": "99fbe74282a8484568d7bacab025423bc4964123", "filename": "wz/Map.wz/Map/Map6/610030010.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030010.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030010.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030010.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,11 +4,11 @@\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <float name=\"mobRate\" value=\"0.4999999\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"version\" value=\"10\"/>\n     <int name=\"fieldLimit\" value=\"0\"/>"}, {"sha": "4470da8f450488d45965ed891cbadb2b349c0306", "filename": "wz/Map.wz/Map/Map6/610030011.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030011.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030011.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030011.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "1249dd6efc22ed1f20186e7794ae806d48ee6731", "filename": "wz/Map.wz/Map/Map6/610030012.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030012.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030012.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030012.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "42166d0592ed14fce319f05159fe141968dc122a", "filename": "wz/Map.wz/Map/Map6/610030013.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030013.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030013.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030013.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "1d4e26bd541e87070143bfdfc001646ffa210f87", "filename": "wz/Map.wz/Map/Map6/610030014.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030014.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030014.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030014.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "ce5b2079882320e82f75e114cab5857e74dcf39c", "filename": "wz/Map.wz/Map/Map6/610030015.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030015.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030015.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030015.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "1f3e8c8023504a691fc870616d124f44b093222d", "filename": "wz/Map.wz/Map/Map6/610030020.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030020.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030020.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030020.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"returnMap\" value=\"610030000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/CrimsonwoodKeepInterior\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "e6d5143832fbd62e16525b40a4a377342dd24466", "filename": "wz/Map.wz/Map/Map6/610030100.img.xml", "status": "modified", "additions": 3000, "deletions": 3014, "changes": 6014, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe"}, {"sha": "d33448ec93ad8ed9f95d2bb5f75ad5c3bf966a31", "filename": "wz/Map.wz/Map/Map6/610030200.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030200.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030200.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030200.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/Courtyard\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "15fd0f5e375f78ab622ee062ec36f645c0a37e1b", "filename": "wz/Map.wz/Map/Map6/610030300.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030300.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030300.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030300.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,7 +4,7 @@\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>"}, {"sha": "0a970ebd99b68e1203bcecb30724fce152bd5d97", "filename": "wz/Map.wz/Map/Map6/610030400.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030400.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030400.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030400.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"10.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "d68f1d56d7990c69c6c10e13363849a01e15ca35", "filename": "wz/Map.wz/Map/Map6/610030500.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030500.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030500.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030500.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,7 +5,7 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <int name=\"fly\" value=\"0\"/>"}, {"sha": "f4b0244ca1d8c2929297e6a34b786123c2a467cb", "filename": "wz/Map.wz/Map/Map6/610030510.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030510.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030510.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030510.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,7 +4,7 @@\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <float name=\"mobRate\" value=\"0.4999999\"/>"}, {"sha": "353b360c9bd1803457ad528dd05ca6e7e8a9d056", "filename": "wz/Map.wz/Map/Map6/610030520.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030520.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030520.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030520.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "e723f73df21565b29ad02d4b9794b3766a7df58d", "filename": "wz/Map.wz/Map/Map6/610030521.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030521.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030521.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030521.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "408ab4c9b8e65f5921dfa0dafee4c64fde4f3e4b", "filename": "wz/Map.wz/Map/Map6/610030522.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030522.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030522.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030522.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "4ea1d0349e121a0983d7bee94c484313778c9610", "filename": "wz/Map.wz/Map/Map6/610030530.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030530.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030530.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030530.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,7 +4,7 @@\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <float name=\"mobRate\" value=\"0.6\"/>"}, {"sha": "a0d06f9c4a090fd443ee8716f74fc6a230e55f06", "filename": "wz/Map.wz/Map/Map6/610030540.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030540.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030540.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030540.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "9698444beedf46c8b76e31adb5a3d299525fe2d5", "filename": "wz/Map.wz/Map/Map6/610030550.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030550.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030550.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030550.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"0.8\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "4127a92b2ec97ed9a6500998f92731bd71bc49a0", "filename": "wz/Map.wz/Map/Map6/610030600.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030600.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030600.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030600.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"10.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/GrandmastersGauntlet\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "3f0dc4565c817ea3696b3edecc2123f055e64e32", "filename": "wz/Map.wz/Map/Map6/610030700.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030700.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030700.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030700.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,7 +4,7 @@\n     <string name=\"bgm\" value=\"BgmGL/Courtyard\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>"}, {"sha": "5a71dcf6d8e144dbd9c7e938541c0060507d8262", "filename": "wz/Map.wz/Map/Map6/610030800.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030800.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/610030800.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/610030800.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -6,7 +6,7 @@\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"returnMap\" value=\"610030010\"/>\n-    <int name=\"forcedReturn\" value=\"610030010\"/>\n+    <int name=\"forcedReturn\" value=\"610030020\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/PartyQuestGL\"/>\n     <string name=\"mapMark\" value=\"Crimsonwood\"/>"}, {"sha": "42efc0a7150a8baad33f59720c0abf4310ce9bea", "filename": "wz/Map.wz/Map/Map6/670000100.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670000100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670000100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/670000100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"670000100\"/>\n-    <int name=\"forcedReturn\" value=\"670000100\"/>\n+    <int name=\"returnMap\" value=\"680000000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/amoria\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>"}, {"sha": "0834860e33e998dec9e591301a871cfb44498f45", "filename": "wz/Map.wz/Map/Map6/670000200.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670000200.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670000200.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/670000200.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"670000200\"/>\n-    <int name=\"forcedReturn\" value=\"670000200\"/>\n+    <int name=\"returnMap\" value=\"680000000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/amoria\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>"}, {"sha": "7ff11213fad7a630466286ae0bce45c73f111437", "filename": "wz/Map.wz/Map/Map6/670010000.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670010000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670010000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/670010000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,8 +5,8 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"670010000\"/>\n-    <int name=\"forcedReturn\" value=\"670010000\"/>\n+    <int name=\"returnMap\" value=\"680000000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/amoria\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>"}, {"sha": "725ecce91b46ff5803e1ffdca6d1ac6006313701", "filename": "wz/Map.wz/Map/Map6/670010100.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670010100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670010100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/670010100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,11 +4,11 @@\n     <string name=\"bgm\" value=\"BgmGL/Amorianchallenge\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"forcedReturn\" value=\"670010100\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n-    <int name=\"returnMap\" value=\"670010100\"/>\n+    <int name=\"returnMap\" value=\"670010000\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"version\" value=\"10\"/>\n     <int name=\"fieldLimit\" value=\"360\"/>"}, {"sha": "f69f1064b9380d3a5bcda45e09daf61b3b8487af", "filename": "wz/Map.wz/Map/Map6/670011000.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670011000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/670011000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/670011000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,7 +5,7 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"670011000\"/>\n+    <int name=\"returnMap\" value=\"670010000\"/>\n     <int name=\"forcedReturn\" value=\"670011000\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"BgmGL/Amorianchallenge\"/>"}, {"sha": "8d9b00908e2bff4e22af2dd73354acf09f7f2259", "filename": "wz/Map.wz/Map/Map6/674030100.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/674030100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/674030100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/674030100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -5,7 +5,7 @@\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n     <int name=\"swim\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"100000000\"/>\n+    <int name=\"returnMap\" value=\"999999999\"/>\n     <int name=\"forcedReturn\" value=\"999999999\"/>\n     <float name=\"mobRate\" value=\"1.0\"/>\n     <string name=\"bgm\" value=\"Bgm10/BizarreTales\"/>"}, {"sha": "1664774d290b727b0d274253d17fa6892fed70c5", "filename": "wz/Map.wz/Map/Map6/680010000.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/680010000.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/680010000.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/680010000.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,11 +4,11 @@\n     <int name=\"version\" value=\"10\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"680010000\"/>\n+    <int name=\"returnMap\" value=\"680000000\"/>\n     <float name=\"mobRate\" value=\"1.499998\"/>\n     <string name=\"bgm\" value=\"BgmGL/amoria\"/>\n     <string name=\"mapDesc\" value=\"\"/>\n-    <int name=\"forcedReturn\" value=\"680010000\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>"}, {"sha": "44ce42405188c3247bb1ca600e58a469b44e4577", "filename": "wz/Map.wz/Map/Map6/680010100.img.xml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/680010100.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/Map/Map6/680010100.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/Map/Map6/680010100.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4,11 +4,11 @@\n     <int name=\"version\" value=\"10\"/>\n     <int name=\"cloud\" value=\"0\"/>\n     <int name=\"town\" value=\"0\"/>\n-    <int name=\"returnMap\" value=\"680010100\"/>\n+    <int name=\"returnMap\" value=\"680000000\"/>\n     <float name=\"mobRate\" value=\"1.499998\"/>\n     <string name=\"bgm\" value=\"BgmGL/amoria\"/>\n     <string name=\"mapDesc\" value=\"\"/>\n-    <int name=\"forcedReturn\" value=\"680010100\"/>\n+    <int name=\"forcedReturn\" value=\"999999999\"/>\n     <string name=\"mapMark\" value=\"Wedding\"/>\n     <int name=\"swim\" value=\"0\"/>\n     <int name=\"hideMinimap\" value=\"0\"/>"}, {"sha": "aa9971e375670dd622325ce37fb674611b7daaf7", "filename": "wz/Map.wz/WorldMap/WorldMap.img.xml", "status": "modified", "additions": 142, "deletions": 3, "changes": 145, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/WorldMap/WorldMap.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -233,7 +233,7 @@\n       </imgdir>\n       <vector name=\"spot\" x=\"-273\" y=\"-99\"/>\n       <canvas name=\"path\" width=\"287\" height=\"116\">\n-        <vector name=\"origin\" x=\"284\" y=\"204\"/>\n+        <vector name=\"origin\" x=\"284\" y=\"205\"/>\n         <int name=\"z\" value=\"2\"/>\n       </canvas>\n     </imgdir>\n@@ -580,7 +580,7 @@\n         <int name=\"98\" value=\"300010200\"/>\n       </imgdir>\n       <canvas name=\"path\" width=\"59\" height=\"119\">\n-        <vector name=\"origin\" x=\"-282\" y=\"-199\"/>\n+        <vector name=\"origin\" x=\"60\" y=\"102\"/>\n         <int name=\"z\" value=\"2\"/>\n       </canvas>\n     </imgdir>\n@@ -1025,7 +1025,7 @@\n       </imgdir>\n       <vector name=\"spot\" x=\"-8\" y=\"-152\"/>\n       <canvas name=\"path\" width=\"287\" height=\"116\">\n-        <vector name=\"origin\" x=\"284\" y=\"204\"/>\n+        <vector name=\"origin\" x=\"286\" y=\"205\"/>\n         <int name=\"z\" value=\"2\"/>\n       </canvas>\n     </imgdir>\n@@ -1116,6 +1116,135 @@\n       <vector name=\"spot\" x=\"20\" y=\"-175\"/>\n       <int name=\"type\" value=\"3\"/>\n     </imgdir>\n+    <imgdir name=\"30\">\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600000000\"/>\n+        <int name=\"1\" value=\"600000001\"/>\n+        <int name=\"10\" value=\"600020000\"/>\n+        <int name=\"11\" value=\"600020100\"/>\n+        <int name=\"12\" value=\"600020200\"/>\n+        <int name=\"13\" value=\"600020300\"/>\n+        <int name=\"14\" value=\"600020400\"/>\n+        <int name=\"15\" value=\"600020500\"/>\n+        <int name=\"16\" value=\"600020600\"/>\n+        <int name=\"2\" value=\"600010000\"/>\n+        <int name=\"3\" value=\"600010001\"/>\n+        <int name=\"4\" value=\"600010100\"/>\n+        <int name=\"5\" value=\"600010200\"/>\n+        <int name=\"6\" value=\"600010300\"/>\n+        <int name=\"7\" value=\"600010400\"/>\n+        <int name=\"8\" value=\"600010500\"/>\n+        <int name=\"9\" value=\"600010600\"/>\n+      </imgdir>\n+      <int name=\"type\" value=\"3\"/>\n+      <vector name=\"spot\" x=\"-222\" y=\"-150\"/>\n+      <canvas name=\"path\" width=\"72\" height=\"88\">\n+        <int name=\"z\" value=\"2\"/>\n+        <vector name=\"origin\" x=\"282\" y=\"174\"/>\n+      </canvas>\n+    </imgdir>\n+    <imgdir name=\"31\">\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"610010003\"/>\n+        <int name=\"1\" value=\"610010001\"/>\n+        <int name=\"10\" value=\"610010100\"/>\n+        <int name=\"11\" value=\"610010101\"/>\n+        <int name=\"12\" value=\"610010102\"/>\n+        <int name=\"13\" value=\"610010103\"/>\n+        <int name=\"14\" value=\"610010104\"/>\n+        <int name=\"15\" value=\"610010200\"/>\n+        <int name=\"16\" value=\"610010201\"/>\n+        <int name=\"17\" value=\"610010202\"/>\n+        <int name=\"18\" value=\"610020000\"/>\n+        <int name=\"19\" value=\"610020001\"/>\n+        <int name=\"2\" value=\"610010002\"/>\n+        <int name=\"20\" value=\"610020002\"/>\n+        <int name=\"21\" value=\"610020003\"/>\n+        <int name=\"22\" value=\"610020004\"/>\n+        <int name=\"23\" value=\"610020005\"/>\n+        <int name=\"24\" value=\"610020010\"/>\n+        <int name=\"25\" value=\"610020011\"/>\n+        <int name=\"26\" value=\"610020012\"/>\n+        <int name=\"27\" value=\"610020013\"/>\n+        <int name=\"28\" value=\"610020014\"/>\n+        <int name=\"29\" value=\"610020015\"/>\n+        <int name=\"3\" value=\"610010000\"/>\n+        <int name=\"4\" value=\"610010004\"/>\n+        <int name=\"5\" value=\"610010005\"/>\n+        <int name=\"6\" value=\"610010010\"/>\n+        <int name=\"7\" value=\"610010011\"/>\n+        <int name=\"8\" value=\"610010012\"/>\n+        <int name=\"9\" value=\"610010013\"/>\n+      </imgdir>\n+      <int name=\"type\" value=\"3\"/>\n+      <vector name=\"spot\" x=\"-233\" y=\"-156\"/>\n+    </imgdir>\n+    <imgdir name=\"32\">\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"610020006\"/>\n+        <int name=\"1\" value=\"610030000\"/>\n+        <int name=\"2\" value=\"610030010\"/>\n+        <int name=\"3\" value=\"610030011\"/>\n+        <int name=\"4\" value=\"610030012\"/>\n+        <int name=\"5\" value=\"610030013\"/>\n+        <int name=\"6\" value=\"610030014\"/>\n+        <int name=\"7\" value=\"610030015\"/>\n+        <int name=\"8\" value=\"610030020\"/>\n+      </imgdir>\n+      <int name=\"type\" value=\"3\"/>\n+      <vector name=\"spot\" x=\"-243\" y=\"-158\"/>\n+    </imgdir>\n+    <imgdir name=\"33\">\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"682000000\"/>\n+        <int name=\"1\" value=\"682000001\"/>\n+        <int name=\"10\" value=\"682000306\"/>\n+        <int name=\"11\" value=\"682000400\"/>\n+        <int name=\"12\" value=\"682000401\"/>\n+        <int name=\"13\" value=\"682000402\"/>\n+        <int name=\"14\" value=\"682000403\"/>\n+        <int name=\"15\" value=\"682000404\"/>\n+        <int name=\"16\" value=\"682000405\"/>\n+        <int name=\"17\" value=\"682000406\"/>\n+        <int name=\"18\" value=\"682000500\"/>\n+        <int name=\"19\" value=\"682000501\"/>\n+        <int name=\"2\" value=\"682000100\"/>\n+        <int name=\"20\" value=\"682000502\"/>\n+        <int name=\"21\" value=\"682000503\"/>\n+        <int name=\"22\" value=\"682000504\"/>\n+        <int name=\"23\" value=\"682000505\"/>\n+        <int name=\"24\" value=\"682000506\"/>\n+        <int name=\"25\" value=\"682000600\"/>\n+        <int name=\"26\" value=\"682000601\"/>\n+        <int name=\"27\" value=\"682000602\"/>\n+        <int name=\"28\" value=\"682000603\"/>\n+        <int name=\"29\" value=\"682000604\"/>\n+        <int name=\"3\" value=\"682000200\"/>\n+        <int name=\"30\" value=\"682000605\"/>\n+        <int name=\"31\" value=\"682000606\"/>\n+        <int name=\"32\" value=\"682000700\"/>\n+        <int name=\"33\" value=\"682000800\"/>\n+        <int name=\"34\" value=\"682000900\"/>\n+        <int name=\"35\" value=\"682010000\"/>\n+        <int name=\"36\" value=\"682010100\"/>\n+        <int name=\"37\" value=\"682010001\"/>\n+        <int name=\"38\" value=\"682010101\"/>\n+        <int name=\"39\" value=\"682010002\"/>\n+        <int name=\"4\" value=\"682000300\"/>\n+        <int name=\"40\" value=\"682010102\"/>\n+        <int name=\"41\" value=\"682010200\"/>\n+        <int name=\"42\" value=\"682010201\"/>\n+        <int name=\"43\" value=\"682010202\"/>\n+        <int name=\"44\" value=\"682010203\"/>\n+        <int name=\"5\" value=\"682000301\"/>\n+        <int name=\"6\" value=\"682000302\"/>\n+        <int name=\"7\" value=\"682000303\"/>\n+        <int name=\"8\" value=\"682000304\"/>\n+        <int name=\"9\" value=\"682000305\"/>\n+      </imgdir>\n+      <int name=\"type\" value=\"3\"/>\n+      <vector name=\"spot\" x=\"-220\" y=\"-161\"/>\n+    </imgdir>\n   </imgdir>\n   <imgdir name=\"MapLink\">\n     <imgdir name=\"0\">\n@@ -1239,5 +1368,15 @@\n       </imgdir>\n       <string name=\"toolTip\" value=\"WorldTour\"/>\n     </imgdir>\n+    <imgdir name=\"12\">\n+      <imgdir name=\"link\">\n+        <string name=\"linkMap\" value=\"WorldMap142\"/>\n+        <canvas name=\"linkImg\" width=\"44\" height=\"26\">\n+          <int name=\"z\" value=\"1\"/>\n+          <vector name=\"origin\" x=\"252\" y=\"165\"/>\n+        </canvas>\n+      </imgdir>\n+      <string name=\"toolTip\" value=\"Masteria\"/>\n+    </imgdir>\n   </imgdir>\n </imgdir>"}, {"sha": "be79b84f92e8859e9c56f80cdc8f9f15c5130d2e", "filename": "wz/Map.wz/WorldMap/WorldMap141.img.xml", "status": "modified", "additions": 53, "deletions": 162, "changes": 215, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap141.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap141.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/WorldMap/WorldMap141.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1,7 +1,7 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n <imgdir name=\"WorldMap141.img\">\n   <imgdir name=\"info\">\n-    <string name=\"parentMap\" value=\"WorldMap\"/>\n+    <string name=\"parentMap\" value=\"WorldMap142\"/>\n   </imgdir>\n   <imgdir name=\"BaseImg\">\n     <canvas name=\"0\" width=\"640\" height=\"470\">\n@@ -11,210 +11,101 @@\n   </imgdir>\n   <imgdir name=\"MapList\">\n     <imgdir name=\"0\">\n-      <vector name=\"spot\" x=\"-215\" y=\"-144\"/>\n+      <vector name=\"spot\" x=\"-120\" y=\"32\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020006\"/>\n+        <int name=\"0\" value=\"682000305\"/>\n+        <int name=\"1\" value=\"682000405\"/>\n+        <int name=\"2\" value=\"682000505\"/>\n+        <int name=\"3\" value=\"682000605\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n-      <vector name=\"spot\" x=\"-247\" y=\"-106\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"-118\" y=\"111\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020005\"/>\n+        <int name=\"0\" value=\"682000304\"/>\n+        <int name=\"1\" value=\"682000404\"/>\n+        <int name=\"2\" value=\"682000504\"/>\n+        <int name=\"3\" value=\"682000604\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"2\">\n-      <vector name=\"spot\" x=\"-261\" y=\"-79\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"-69\" y=\"-41\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020003\"/>\n+        <int name=\"0\" value=\"682000900\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"3\">\n-      <vector name=\"spot\" x=\"-208\" y=\"-95\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"-107\" y=\"167\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020004\"/>\n+        <int name=\"0\" value=\"682000306\"/>\n+        <int name=\"1\" value=\"682000406\"/>\n+        <int name=\"2\" value=\"682000506\"/>\n+        <int name=\"3\" value=\"682000606\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"4\">\n-      <vector name=\"spot\" x=\"-219\" y=\"-70\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"2\" y=\"169\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020002\"/>\n+        <int name=\"0\" value=\"682000100\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"5\">\n-      <vector name=\"spot\" x=\"-162\" y=\"-42\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"3\" y=\"114\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020001\"/>\n+        <int name=\"0\" value=\"682000300\"/>\n+        <int name=\"1\" value=\"682000400\"/>\n+        <int name=\"2\" value=\"682000500\"/>\n+        <int name=\"3\" value=\"682000600\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"6\">\n-      <vector name=\"spot\" x=\"-197\" y=\"-18\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"5\" y=\"45\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610020000\"/>\n+        <int name=\"0\" value=\"682000800\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"7\">\n-      <vector name=\"spot\" x=\"-125\" y=\"-2\"/>\n-      <int name=\"type\" value=\"1\"/>\n+      <vector name=\"spot\" x=\"55\" y=\"-27\"/>\n+      <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010005\"/>\n+        <int name=\"0\" value=\"682000200\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"8\">\n-      <vector name=\"spot\" x=\"-176\" y=\"39\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010004\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"9\">\n-      <vector name=\"spot\" x=\"-88\" y=\"21\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010002\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"10\">\n-      <vector name=\"spot\" x=\"-57\" y=\"-19\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010200\"/>\n-        <int name=\"1\" value=\"610010201\"/>\n-        <int name=\"2\" value=\"610010202\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"11\">\n-      <vector name=\"spot\" x=\"9\" y=\"-27\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010001\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"12\">\n-      <vector name=\"spot\" x=\"-37\" y=\"49\"/>\n+      <vector name=\"spot\" x=\"151\" y=\"28\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000000\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"13\">\n-      <vector name=\"spot\" x=\"50\" y=\"25\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"610010000\"/>\n+        <int name=\"0\" value=\"682000301\"/>\n+        <int name=\"1\" value=\"682000401\"/>\n+        <int name=\"2\" value=\"682000501\"/>\n+        <int name=\"3\" value=\"682000601\"/>\n       </imgdir>\n     </imgdir>\n-    <imgdir name=\"14\">\n-      <vector name=\"spot\" x=\"83\" y=\"105\"/>\n+    <imgdir name=\"9\">\n+      <vector name=\"spot\" x=\"145\" y=\"115\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020000\"/>\n-        <int name=\"1\" value=\"600020100\"/>\n-        <int name=\"2\" value=\"600020200\"/>\n-        <int name=\"3\" value=\"600020300\"/>\n-        <int name=\"4\" value=\"600020400\"/>\n-        <int name=\"5\" value=\"600020500\"/>\n-        <int name=\"6\" value=\"600020600\"/>\n+        <int name=\"0\" value=\"682000303\"/>\n+        <int name=\"1\" value=\"682000403\"/>\n+        <int name=\"2\" value=\"682000503\"/>\n+        <int name=\"3\" value=\"682000603\"/>\n       </imgdir>\n     </imgdir>\n-    <imgdir name=\"15\">\n-      <vector name=\"spot\" x=\"161\" y=\"137\"/>\n+    <imgdir name=\"10\">\n+      <vector name=\"spot\" x=\"120\" y=\"171\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010001\"/>\n-        <int name=\"1\" value=\"600010002\"/>\n-        <int name=\"2\" value=\"600000000\"/>\n-        <int name=\"3\" value=\"600000001\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"16\">\n-      <vector name=\"spot\" x=\"238\" y=\"30\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010100\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"17\">\n-      <vector name=\"spot\" x=\"287\" y=\"2\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010300\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"18\">\n-      <vector name=\"spot\" x=\"206\" y=\"-15\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010200\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"19\">\n-      <vector name=\"spot\" x=\"189\" y=\"-57\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010400\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"20\">\n-      <vector name=\"spot\" x=\"233\" y=\"-94\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010500\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"21\">\n-      <vector name=\"spot\" x=\"187\" y=\"-129\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600010600\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"22\">\n-      <vector name=\"spot\" x=\"-97\" y=\"116\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020100\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"23\">\n-      <vector name=\"spot\" x=\"-137\" y=\"116\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020300\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"24\">\n-      <vector name=\"spot\" x=\"-137\" y=\"146\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020200\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"25\">\n-      <vector name=\"spot\" x=\"-176\" y=\"146\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020600\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"26\">\n-      <vector name=\"spot\" x=\"-137\" y=\"177\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020400\"/>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"27\">\n-      <vector name=\"spot\" x=\"-176\" y=\"177\"/>\n-      <int name=\"type\" value=\"1\"/>\n-      <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"600020500\"/>\n+        <int name=\"0\" value=\"682000302\"/>\n+        <int name=\"1\" value=\"682000402\"/>\n+        <int name=\"2\" value=\"682000502\"/>\n+        <int name=\"3\" value=\"682000602\"/>\n       </imgdir>\n     </imgdir>\n   </imgdir>"}, {"sha": "357f16d8cd21eec2c6e75104c1e0031241d687eb", "filename": "wz/Map.wz/WorldMap/WorldMap142.img.xml", "status": "modified", "additions": 213, "deletions": 53, "changes": 266, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap142.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Map.wz/WorldMap/WorldMap142.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Map.wz/WorldMap/WorldMap142.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1,7 +1,7 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n <imgdir name=\"WorldMap142.img\">\n   <imgdir name=\"info\">\n-    <string name=\"parentMap\" value=\"WorldMap141\"/>\n+    <string name=\"parentMap\" value=\"WorldMap\"/>\n   </imgdir>\n   <imgdir name=\"BaseImg\">\n     <canvas name=\"0\" width=\"640\" height=\"470\">\n@@ -11,101 +11,261 @@\n   </imgdir>\n   <imgdir name=\"MapList\">\n     <imgdir name=\"0\">\n-      <vector name=\"spot\" x=\"-120\" y=\"32\"/>\n+      <vector name=\"spot\" x=\"-215\" y=\"-144\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000305\"/>\n-        <int name=\"1\" value=\"682000405\"/>\n-        <int name=\"2\" value=\"682000505\"/>\n-        <int name=\"3\" value=\"682000605\"/>\n+        <int name=\"0\" value=\"610020006\"/>\n+        <int name=\"1\" value=\"610030010\"/>\n+        <int name=\"2\" value=\"610030011\"/>\n+        <int name=\"3\" value=\"610030012\"/>\n+        <int name=\"4\" value=\"610030013\"/>\n+        <int name=\"5\" value=\"610030014\"/>\n+        <int name=\"6\" value=\"610030015\"/>\n+        <int name=\"7\" value=\"610030020\"/>\n+        <int name=\"8\" value=\"610030000\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n-      <vector name=\"spot\" x=\"-118\" y=\"111\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-247\" y=\"-106\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000304\"/>\n-        <int name=\"1\" value=\"682000404\"/>\n-        <int name=\"2\" value=\"682000504\"/>\n-        <int name=\"3\" value=\"682000604\"/>\n+        <int name=\"0\" value=\"610020005\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"2\">\n-      <vector name=\"spot\" x=\"-69\" y=\"-41\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-261\" y=\"-79\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000900\"/>\n+        <int name=\"0\" value=\"610020003\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"3\">\n-      <vector name=\"spot\" x=\"-107\" y=\"167\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-208\" y=\"-95\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000306\"/>\n-        <int name=\"1\" value=\"682000406\"/>\n-        <int name=\"2\" value=\"682000506\"/>\n-        <int name=\"3\" value=\"682000606\"/>\n+        <int name=\"0\" value=\"610020004\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"4\">\n-      <vector name=\"spot\" x=\"2\" y=\"169\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-219\" y=\"-70\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000100\"/>\n+        <int name=\"0\" value=\"610020002\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"5\">\n-      <vector name=\"spot\" x=\"3\" y=\"114\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-162\" y=\"-42\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000300\"/>\n-        <int name=\"1\" value=\"682000400\"/>\n-        <int name=\"2\" value=\"682000500\"/>\n-        <int name=\"3\" value=\"682000600\"/>\n+        <int name=\"0\" value=\"610020001\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"6\">\n-      <vector name=\"spot\" x=\"5\" y=\"45\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-197\" y=\"-18\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000800\"/>\n+        <int name=\"0\" value=\"610020000\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"7\">\n-      <vector name=\"spot\" x=\"55\" y=\"-27\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-125\" y=\"-2\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000200\"/>\n+        <int name=\"0\" value=\"610010005\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"8\">\n-      <vector name=\"spot\" x=\"151\" y=\"28\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-176\" y=\"39\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000301\"/>\n-        <int name=\"1\" value=\"682000401\"/>\n-        <int name=\"2\" value=\"682000501\"/>\n-        <int name=\"3\" value=\"682000601\"/>\n+        <int name=\"0\" value=\"610010004\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"9\">\n-      <vector name=\"spot\" x=\"145\" y=\"115\"/>\n-      <int name=\"type\" value=\"0\"/>\n+      <vector name=\"spot\" x=\"-88\" y=\"21\"/>\n+      <int name=\"type\" value=\"1\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000303\"/>\n-        <int name=\"1\" value=\"682000403\"/>\n-        <int name=\"2\" value=\"682000503\"/>\n-        <int name=\"3\" value=\"682000603\"/>\n+        <int name=\"0\" value=\"610010002\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"10\">\n-      <vector name=\"spot\" x=\"120\" y=\"171\"/>\n+      <vector name=\"spot\" x=\"-57\" y=\"-19\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"610010200\"/>\n+        <int name=\"1\" value=\"610010201\"/>\n+        <int name=\"2\" value=\"610010202\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"11\">\n+      <vector name=\"spot\" x=\"9\" y=\"-27\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"610010001\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"12\">\n+      <vector name=\"spot\" x=\"-37\" y=\"49\"/>\n       <int name=\"type\" value=\"0\"/>\n       <imgdir name=\"mapNo\">\n-        <int name=\"0\" value=\"682000302\"/>\n-        <int name=\"1\" value=\"682000402\"/>\n-        <int name=\"2\" value=\"682000502\"/>\n-        <int name=\"3\" value=\"682000602\"/>\n+        <int name=\"0\" value=\"682000000\"/>\n+        <int name=\"1\" value=\"682000200\"/>\n+        <int name=\"10\" value=\"682000401\"/>\n+        <int name=\"11\" value=\"682000402\"/>\n+        <int name=\"12\" value=\"682000403\"/>\n+        <int name=\"13\" value=\"682000404\"/>\n+        <int name=\"14\" value=\"682000405\"/>\n+        <int name=\"15\" value=\"682000406\"/>\n+        <int name=\"16\" value=\"682000500\"/>\n+        <int name=\"17\" value=\"682000501\"/>\n+        <int name=\"18\" value=\"682000502\"/>\n+        <int name=\"19\" value=\"682000503\"/>\n+        <int name=\"2\" value=\"682000300\"/>\n+        <int name=\"20\" value=\"682000504\"/>\n+        <int name=\"21\" value=\"682000505\"/>\n+        <int name=\"22\" value=\"682000506\"/>\n+        <int name=\"23\" value=\"682000600\"/>\n+        <int name=\"24\" value=\"682000601\"/>\n+        <int name=\"25\" value=\"682000602\"/>\n+        <int name=\"26\" value=\"682000603\"/>\n+        <int name=\"27\" value=\"682000604\"/>\n+        <int name=\"28\" value=\"682000605\"/>\n+        <int name=\"29\" value=\"682000606\"/>\n+        <int name=\"3\" value=\"682000301\"/>\n+        <int name=\"30\" value=\"682000700\"/>\n+        <int name=\"31\" value=\"682000800\"/>\n+        <int name=\"32\" value=\"682000900\"/>\n+        <int name=\"33\" value=\"682010000\"/>\n+        <int name=\"34\" value=\"682010100\"/>\n+        <int name=\"35\" value=\"682010001\"/>\n+        <int name=\"36\" value=\"682010101\"/>\n+        <int name=\"37\" value=\"682010002\"/>\n+        <int name=\"38\" value=\"682010102\"/>\n+        <int name=\"39\" value=\"682010200\"/>\n+        <int name=\"4\" value=\"682000302\"/>\n+        <int name=\"40\" value=\"682010201\"/>\n+        <int name=\"41\" value=\"682010202\"/>\n+        <int name=\"42\" value=\"682010203\"/>\n+        <int name=\"43\" value=\"682000100\"/>\n+        <int name=\"5\" value=\"682000303\"/>\n+        <int name=\"6\" value=\"682000304\"/>\n+        <int name=\"7\" value=\"682000305\"/>\n+        <int name=\"8\" value=\"682000306\"/>\n+        <int name=\"9\" value=\"682000400\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"13\">\n+      <vector name=\"spot\" x=\"50\" y=\"25\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"610010000\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"14\">\n+      <vector name=\"spot\" x=\"83\" y=\"105\"/>\n+      <int name=\"type\" value=\"0\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020000\"/>\n+        <int name=\"1\" value=\"600020100\"/>\n+        <int name=\"2\" value=\"600020200\"/>\n+        <int name=\"3\" value=\"600020300\"/>\n+        <int name=\"4\" value=\"600020400\"/>\n+        <int name=\"5\" value=\"600020500\"/>\n+        <int name=\"6\" value=\"600020600\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"15\">\n+      <vector name=\"spot\" x=\"161\" y=\"137\"/>\n+      <int name=\"type\" value=\"0\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010001\"/>\n+        <int name=\"1\" value=\"600010002\"/>\n+        <int name=\"2\" value=\"600000000\"/>\n+        <int name=\"3\" value=\"600000001\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"16\">\n+      <vector name=\"spot\" x=\"238\" y=\"30\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010100\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"17\">\n+      <vector name=\"spot\" x=\"287\" y=\"2\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010300\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"18\">\n+      <vector name=\"spot\" x=\"206\" y=\"-15\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010200\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"19\">\n+      <vector name=\"spot\" x=\"189\" y=\"-57\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010400\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"20\">\n+      <vector name=\"spot\" x=\"233\" y=\"-94\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010500\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"21\">\n+      <vector name=\"spot\" x=\"187\" y=\"-129\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600010600\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"22\">\n+      <vector name=\"spot\" x=\"-97\" y=\"116\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020100\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"23\">\n+      <vector name=\"spot\" x=\"-137\" y=\"116\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020300\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"24\">\n+      <vector name=\"spot\" x=\"-137\" y=\"146\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020200\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"25\">\n+      <vector name=\"spot\" x=\"-176\" y=\"146\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020600\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"26\">\n+      <vector name=\"spot\" x=\"-137\" y=\"177\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020400\"/>\n+      </imgdir>\n+    </imgdir>\n+    <imgdir name=\"27\">\n+      <vector name=\"spot\" x=\"-176\" y=\"177\"/>\n+      <int name=\"type\" value=\"1\"/>\n+      <imgdir name=\"mapNo\">\n+        <int name=\"0\" value=\"600020500\"/>\n       </imgdir>\n     </imgdir>\n   </imgdir>"}, {"sha": "2fd7e02fe64bc63556c5a41bb815863860073156", "filename": "wz/Quest.wz/QuestInfo.img.xml", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Quest.wz/QuestInfo.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Quest.wz/QuestInfo.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/QuestInfo.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4393,17 +4393,17 @@ You can now begin the &quot;Manji&apos;s Request&quot; quest.\n     <string name=\"name\" value=\"Searching for Fossils\"/>\n     <string name=\"parent\" value=\"Winston&apos;s Fossil Dig-up\"/>\n     <int name=\"order\" value=\"1\"/>\n-    <string name=\"0\" value=\"I heard that #p1022006# the archeologist is searching for something in the Rocky Mountains on the East side of Perion...\"/>\n-    <string name=\"1\" value=\"#b#p1022006##k the archeologist who I ran into on the rocky mountains on the east side of Perion said he lost the fossils he collected near Perion. He asked me to bring back #b100 #t4031146##k and #b100 #t4031147##k which #b#o1110100##k and #b#o1130100##k took. How can he lose something so important like that? He is careless than he looks...\\n\\n#t4031146# #c4031146#/100\\n#t4031147# #c4031147#/100\"/>\n+    <string name=\"0\" value=\"I heard that #p1022006# the archaeologist is searching for something in the Rocky Mountains on the East side of Perion...\"/>\n+    <string name=\"1\" value=\"#b#p1022006##k the archaeologist who I ran into on the rocky mountains on the east side of Perion said he lost the fossils he collected near Perion. He asked me to bring back #b100 #t4031146##k and #b100 #t4031147##k which #b#o1110100##k and #b#o1130100##k took. How can he lose something so important like that? He is careless than he looks...\\n\\n#t4031146# #c4031146#/100\\n#t4031147# #c4031147#/100\"/>\n     <string name=\"2\" value=\"I found the fossil which #b#p1022006##k lost.\"/>\n     <int name=\"area\" value=\"30\"/>\n   </imgdir>\n   <imgdir name=\"2066\">\n     <string name=\"name\" value=\"Delivering a Box of Fossil\"/>\n     <string name=\"parent\" value=\"Winston&apos;s Fossil Dig-up\"/>\n     <int name=\"order\" value=\"2\"/>\n-    <string name=\"1\" value=\"#b#p1022006# the Archeologist#k said that it is not safe to put the valuable fossils in the tent. He asked me to take the fossil and deliver it to #bDr. #p1032104##k in Ellinia. He also wrote a letter of introduction for me to show him. \"/>\n-    <string name=\"2\" value=\"#b#p1022006# the Archeologist#k in Perion said that it is not safe to put the valuable fossils in his tent. He asked me to deliver it to #bDr. #p1032104##k in Ellinia. Dr. Betty said it is going to be really busy from now. He asked me to stop by again and give him a hand afterwards. Fossils huh...? Should I give it a try?\"/>\n+    <string name=\"1\" value=\"#b#p1022006# the Archaeologist#k said that it is not safe to put the valuable fossils in the tent. He asked me to take the fossil and deliver it to #bDr. #p1032104##k in Ellinia. He also wrote a letter of introduction for me to show him. \"/>\n+    <string name=\"2\" value=\"#b#p1022006# the Archaeologist#k in Perion said that it is not safe to put the valuable fossils in his tent. He asked me to deliver it to #bDr. #p1032104##k in Ellinia. Dr. Betty said it is going to be really busy from now. He asked me to stop by again and give him a hand afterwards. Fossils huh...? Should I give it a try?\"/>\n     <int name=\"area\" value=\"30\"/>\n   </imgdir>\n   <imgdir name=\"2067\">\n@@ -5419,7 +5419,7 @@ You can now begin the &quot;Manji&apos;s Request&quot; quest.\n     <string name=\"name\" value=\"Truth of the Rumor\"/>\n     <string name=\"parent\" value=\"The Old Tree\"/>\n     <int name=\"order\" value=\"1\"/>\n-    <string name=\"0\" value=\"The archeologist, Doctor #p1022006#, currently does research at a camping site in #m102000000#. He recently called me about a strange rumor he heard. \"/>\n+    <string name=\"0\" value=\"The archaeologist, Doctor #p1022006#, currently does research at a camping site in #m102000000#. He recently called me about a strange rumor he heard. \"/>\n     <string name=\"1\" value=\"During the excavation, Doctor #p1022006# said he heard a rumor about a very old tree living in #m102000000#. However, he had no clue on what kind of tree it was, or where exactly it was located. That&apos;s why he&apos;s asked me to visit #b#m102000000# village to collect information on this particular tree.#k\\n\\n#y2148# #b (#u2148#)#k\\n#y2149# #b(#u2149#)#k\\n#y2150# #b(#u2150#)#k\\n#y2151# #b(#u2151#)#k\\n#y2152# #b(#u2152#)#k\"/>\n     <string name=\"2\" value=\"Told Doctor #p1022006# what the villagers of #m102000000# talked about. Could #o3220000# mentioned by #p1020000# be the same tree Doctor #p1022006# is looking for?\"/>\n     <int name=\"area\" value=\"30\"/>\n@@ -11097,7 +11097,7 @@ Can proceed to the &quot;A Request from Corporal Easy&quot; quest.\n     <string name=\"name\" value=\"The Descendent of the Author of the Book of Ancient\"/>\n     <string name=\"parent\" value=\"In Search of the Book of Ancient\"/>\n     <string name=\"0\" value=\"I should go see Alcaster of El Nath right now...\"/>\n-    <string name=\"1\" value=\"I met #bAlcaster#k, the archeologist, at El Nath. He said he had heard about the #bBook of Ancient#k, which tells about the Great World War, happened hundreds years ago. Interesting... The only living descendant of the author of the &quot;Book of Ancient&quot;  #bHella#k who lives in Orbis. I better go to find her right now~\"/>\n+    <string name=\"1\" value=\"I met #bAlcaster#k, the archaeologist, at El Nath. He said he had heard about the #bBook of Ancient#k, which tells about the Great World War, happened hundreds years ago. Interesting... The only living descendant of the author of the &quot;Book of Ancient&quot;  #bHella#k who lives in Orbis. I better go to find her right now~\"/>\n     <null name=\"2\"/>\n     <int name=\"order\" value=\"1\"/>\n     <int name=\"area\" value=\"33\"/>\n@@ -16897,7 +16897,7 @@ Able to proceed to &apos;Merry-go-round in Kampung&apos; as next quest.\n     <string name=\"name\" value=\"Bruce&apos;s Research\"/>\n     <string name=\"0\" value=\"Bruce, the monster researcher, might know something. Maybe he can tell me how old Bob actually is. If I get to know how old he is, wouldn&apos;t that be a discovery of something remarkable?\"/>\n     <string name=\"1\" value=\"He does seem to know something about his age but he looks spooked. I shouldn&apos;t hesitate to ask him what is wrong!\"/>\n-    <string name=\"2\" value=\"Wow... Bruce told me that Bob&apos;s age is incalculable. This is getting serious, isn&apos;t it. A snail that even professional monster researcher can&apos;t tell the age. Maybe he was right about asking me to go see Winston. Maybe an archeologist knows more about the history and the age issue than Bruce.\"/>\n+    <string name=\"2\" value=\"Wow... Bruce told me that Bob&apos;s age is incalculable. This is getting serious, isn&apos;t it. A snail that even professional monster researcher can&apos;t tell the age. Maybe he was right about asking me to go see Winston. Maybe an archaeologist knows more about the history and the age issue than Bruce.\"/>\n     <int name=\"area\" value=\"30\"/>\n   </imgdir>\n   <imgdir name=\"4937\">\n@@ -23717,7 +23717,7 @@ Able to proceed to &apos;Merry-go-round in Kampung&apos; as next quest.\n     <string name=\"parent\" value=\"Snow Silk and the Mysterious Fabric \"/>\n     <int name=\"order\" value=\"1\"/>\n     <string name=\"0\" value=\"Cassandra, maple world&apos;s informant, is said to have obtained some new information hot off the press.  I&apos;m curious what it is. \"/>\n-    <string name=\"1\" value=\"Cassandra told me about the Snow Silk.  But for some reason she wouldn&apos;t explain in detail and kept telling me to just go see the archeologist, #bWinston#k...\"/>\n+    <string name=\"1\" value=\"Cassandra told me about the Snow Silk.  But for some reason she wouldn&apos;t explain in detail and kept telling me to just go see the archaeologist, #bWinston#k...\"/>\n     <string name=\"2\" value=\"Maple world&apos;s informant, Cassandra, notified me of her latest information, the Snow Silk.  I went to go see Winston, the archaeologist who is looking for this Snow Silk.\"/>\n     <int name=\"area\" value=\"50\"/>\n   </imgdir>"}, {"sha": "ec6f82b9eabf8b85cae86ee3406a1416588a413e", "filename": "wz/Quest.wz/Say.img.xml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Quest.wz/Say.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Quest.wz/Say.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Say.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -7659,7 +7659,7 @@\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"0\">\n-      <string name=\"0\" value=\"Hello, there, nice to meet you. I&apos;m #b#p1022006##k the archeologist, and I&apos;m looking for fossils of the prehistoric life.\"/>\n+      <string name=\"0\" value=\"Hello, there, nice to meet you. I&apos;m #b#p1022006##k the archaeologist, and I&apos;m looking for fossils of the prehistoric life.\"/>\n       <string name=\"1\" value=\"Perion may now be a land of dry, rocky mountains, but it used to be a fertile land full of tall trees and lots of creatures, much like Ellinia. Can you believe that? I&apos;m looking for evidences from that era. If you are not busy and all, can you help me out?\"/>\n       <imgdir name=\"yes\">\n         <string name=\"0\" value=\"Thank you. I ran into something odd yesterday. I went to Perion for some food, and when I came back, I found my tent raided by the monsters. They took my fossils and ran away.\"/>\n@@ -33571,7 +33571,7 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <string name=\"0\" value=\"Great work, kid! Ready to hear about the treasure? \\n\\n#L0##bOk, what else have you discovered?#k#l\"/>\n-      <string name=\"1\" value=\"Well, it&apos;s a pretty long list. I always liked history, even when I was a kid. All my other subjects were ok, but I always got straight A&apos;s in History-probably because my dad would kick my butt if I didn&apos;t. That what happens when you grow up with an archeologist for a father. \\n\\n#L0##bWhat about your family?#k#l\"/>\n+      <string name=\"1\" value=\"Well, it&apos;s a pretty long list. I always liked history, even when I was a kid. All my other subjects were ok, but I always got straight A&apos;s in History-probably because my dad would kick my butt if I didn&apos;t. That what happens when you grow up with an archaeologist for a father. \\n\\n#L0##bWhat about your family?#k#l\"/>\n       <string name=\"2\" value=\"You must mean my brother, Jack Barricade. We&apos;ve agreed to something that I&apos;ll tell you about a bit later, but essentially, he&apos;s looking for something in Aqua Road, and I&apos;m searching here. \\n\\n#L0##bOk, you still haven&apos;t told me what was the first thing you discovered?#k#l\"/>\n       <string name=\"3\" value=\"Oh, sorry. It happens sometimes. After college, my brother and I concluded that the only way to live forever was to find the Fountain of Youth. It took 3 years, but we finally found it! \\n\\n#L0##bNO WAY!#k#l\"/>\n       <string name=\"4\" value=\"WAY! \\n\\n#L0##bThat&apos;s awesome!#k#l\"/>\n@@ -34352,7 +34352,7 @@\n     </imgdir>\n     <imgdir name=\"1\">\n       <string name=\"0\" value=\"This is interesting. It might appear to be just another snail shell to you but if you look it up close, the growth rings on this shell are very densely constructed making it practically impossible for human eyes to count them.\\r\\n\\r\\n#L0##bWell, I wouldn&apos;t be surprised. He is the Legendary Bob Snale who lived with the history of Maplestory.#k#l\"/>\n-      <string name=\"1\" value=\"I wouldn&apos;t know much of a history of this world. But this is a very unique find. I bet Winston the archeologist might know more than I do for this case.\"/>\n+      <string name=\"1\" value=\"I wouldn&apos;t know much of a history of this world. But this is a very unique find. I bet Winston the archaeologist might know more than I do for this case.\"/>\n       <imgdir name=\"yes\">\n         <string name=\"0\" value=\"Winston is somewhere around Perion researching for the fossils. You might want to check with him about this snail shell. I have to tell you before you go there. Watch out. Winston loves attraction and fame. I&apos;ve heard that from time to time he stole the research of others to take the glory in the past. I hope he is not too interested in the scholastic value of Bob&apos;s snail shell...\"/>\n       </imgdir>"}, {"sha": "3fa76afcf8ae9aa7ff0ed6e5cdb40bf11a5520c4", "filename": "wz/Skill.wz/910.img.xml", "status": "modified", "additions": 0, "deletions": 136, "changes": 136, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Skill.wz/910.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/Skill.wz/910.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Skill.wz/910.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -634,142 +634,6 @@\n         <int name=\"z\" value=\"-1\"/>\n       </imgdir>\n     </imgdir>\n-    <imgdir name=\"9101006\">\n-      <canvas name=\"icon\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <canvas name=\"iconMouseOver\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <canvas name=\"iconDisabled\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <imgdir name=\"action\">\n-        <string name=\"0\" value=\"alert3\"/>\n-      </imgdir>\n-      <imgdir name=\"level\">\n-        <imgdir name=\"1\">\n-          <string name=\"hs\" value=\"h1\"/>\n-          <vector name=\"lt\" x=\"-400\" y=\"-350\"/>\n-          <vector name=\"rb\" x=\"400\" y=\"250\"/>\n-          <int name=\"mobCount\" value=\"15\"/>\n-          <int name=\"damage\" value=\"1000\"/>\n-        </imgdir>\n-      </imgdir>\n-      <imgdir name=\"effect\">\n-        <canvas name=\"0\" width=\"178\" height=\"181\">\n-          <vector name=\"origin\" x=\"89\" y=\"136\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"1\" width=\"167\" height=\"167\">\n-          <vector name=\"origin\" x=\"83\" y=\"130\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"2\" width=\"218\" height=\"216\">\n-          <vector name=\"origin\" x=\"109\" y=\"154\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"3\" width=\"212\" height=\"210\">\n-          <vector name=\"origin\" x=\"105\" y=\"152\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"4\" width=\"202\" height=\"206\">\n-          <vector name=\"origin\" x=\"99\" y=\"151\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"5\" width=\"200\" height=\"200\">\n-          <vector name=\"origin\" x=\"100\" y=\"147\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"6\" width=\"203\" height=\"235\">\n-          <vector name=\"origin\" x=\"101\" y=\"131\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"7\" width=\"211\" height=\"215\">\n-          <vector name=\"origin\" x=\"105\" y=\"131\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"8\" width=\"217\" height=\"187\">\n-          <vector name=\"origin\" x=\"108\" y=\"131\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"9\" width=\"219\" height=\"182\">\n-          <vector name=\"origin\" x=\"109\" y=\"143\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"10\" width=\"215\" height=\"170\">\n-          <vector name=\"origin\" x=\"107\" y=\"131\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"11\" width=\"215\" height=\"182\">\n-          <vector name=\"origin\" x=\"107\" y=\"138\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"12\" width=\"215\" height=\"206\">\n-          <vector name=\"origin\" x=\"107\" y=\"151\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"13\" width=\"220\" height=\"220\">\n-          <vector name=\"origin\" x=\"110\" y=\"156\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"14\" width=\"241\" height=\"252\">\n-          <vector name=\"origin\" x=\"120\" y=\"172\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"15\" width=\"209\" height=\"190\">\n-          <vector name=\"origin\" x=\"104\" y=\"140\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"16\" width=\"201\" height=\"204\">\n-          <vector name=\"origin\" x=\"100\" y=\"147\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-        <canvas name=\"17\" width=\"216\" height=\"221\">\n-          <vector name=\"origin\" x=\"108\" y=\"155\"/>\n-          <int name=\"delay\" value=\"80\"/>\n-        </canvas>\n-      </imgdir>\n-      <imgdir name=\"hit\">\n-        <imgdir name=\"0\">\n-          <canvas name=\"0\" width=\"62\" height=\"64\">\n-            <vector name=\"origin\" x=\"31\" y=\"32\"/>\n-            <int name=\"delay\" value=\"120\"/>\n-          </canvas>\n-          <canvas name=\"1\" width=\"94\" height=\"94\">\n-            <vector name=\"origin\" x=\"46\" y=\"46\"/>\n-            <int name=\"delay\" value=\"120\"/>\n-          </canvas>\n-          <canvas name=\"2\" width=\"104\" height=\"105\">\n-            <vector name=\"origin\" x=\"53\" y=\"52\"/>\n-            <int name=\"delay\" value=\"120\"/>\n-          </canvas>\n-        </imgdir>\n-      </imgdir>\n-    </imgdir>\n-    <imgdir name=\"9101007\">\n-      <canvas name=\"icon\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <canvas name=\"iconMouseOver\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <canvas name=\"iconDisabled\" width=\"32\" height=\"32\">\n-        <vector name=\"origin\" x=\"0\" y=\"32\"/>\n-        <int name=\"z\" value=\"0\"/>\n-      </canvas>\n-      <imgdir name=\"level\">\n-        <imgdir name=\"1\">\n-          <string name=\"hs\" value=\"h1\"/>\n-          <int name=\"range\" value=\"150\"/>\n-        </imgdir>\n-      </imgdir>\n-    </imgdir>\n     <imgdir name=\"9101008\">\n       <canvas name=\"icon\" width=\"32\" height=\"32\">\n         <vector name=\"origin\" x=\"0\" y=\"32\"/>"}, {"sha": "070f3b902787bbc70531ab8de9d745b0e3ba1c0e", "filename": "wz/String.wz/Consume.img.xml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Consume.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Consume.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Consume.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -3604,19 +3604,19 @@\n     <string name=\"desc\" value=\"Improves jump on pet equip.\\nSuccess rate:10%, jump+3. The success rate of this scroll can be enhanced by Vega&apos;s Spell.\"/>\n   </imgdir>\n   <imgdir name=\"2048006\">\n-    <string name=\"name\" value=\"Scroll for Speed for Pet Equip.\"/>\n+    <string name=\"name\" value=\"Scroll for Pet Equip. for Speed\"/>\n     <string name=\"desc\" value=\"Improves speed on Pet Equip. nSuccess rate:65%, speed+2\"/>\n   </imgdir>\n   <imgdir name=\"2048007\">\n-    <string name=\"name\" value=\"Scroll for Speed for Pet Equip.\"/>\n+    <string name=\"name\" value=\"Scroll for Pet Equip. for Speed\"/>\n     <string name=\"desc\" value=\"Improves speed on Pet Equip. nSuccess rate:15%, speed+3\"/>\n   </imgdir>\n   <imgdir name=\"2048008\">\n-    <string name=\"name\" value=\"Scroll for jump for Pet Equip.\"/>\n+    <string name=\"name\" value=\"Scroll for Pet Equip. for Jump\"/>\n     <string name=\"desc\" value=\"Improves jump on Pet equip. nSuccess rate:65%, jump+2\"/>\n   </imgdir>\n   <imgdir name=\"2048009\">\n-    <string name=\"name\" value=\"Scroll for jump for Pet Equip.\"/>\n+    <string name=\"name\" value=\"Scroll for Pet Equip. for Jump\"/>\n     <string name=\"desc\" value=\"Improves jump on Pet equip. nSuccess rate:15%, jump+3\"/>\n   </imgdir>\n   <imgdir name=\"2048010\">"}, {"sha": "72038930e36ad1eb898938aef1fb6cf8cc4f928f", "filename": "wz/String.wz/Eqp.img.xml", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Eqp.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Eqp.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Eqp.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -1218,12 +1218,12 @@\n         <string name=\"name\" value=\"Wind Bell Earrings\"/>\n       </imgdir>\n       <imgdir name=\"1022088\">\n-        <string name=\"name\" value=\"Archeologist Glasses\"/>\n-        <string name=\"desc\" value=\"A pair of Archeologist Glasses received for participating in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Glasses\"/>\n+        <string name=\"desc\" value=\"A pair of Archaeologist Glasses received for participating in the Artifact Hunt.\"/>\n       </imgdir>\n       <imgdir name=\"1022089\">\n-        <string name=\"name\" value=\"Archeologist Glasses\"/>\n-        <string name=\"desc\" value=\"A pair of Archeologist Glasses received for finishing Top 10 in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Glasses\"/>\n+        <string name=\"desc\" value=\"A pair of Archaeologist Glasses received for finishing Top 10 in the Artifact Hunt.\"/>\n       </imgdir>\n       <imgdir name=\"1132005\">\n         <string name=\"name\" value=\"White Cookie Belt\"/>\n@@ -1523,8 +1523,8 @@\n         <string name=\"name\" value=\"Alphabet Glasses\"/>\n       </imgdir>\n       <imgdir name=\"1022103\">\n-        <string name=\"name\" value=\"Archeologist Glasses\"/>\n-        <string name=\"desc\" value=\"A pair of Archeologist Glasses received for participating in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Glasses\"/>\n+        <string name=\"desc\" value=\"A pair of Archaeologist Glasses received for participating in the Artifact Hunt.\"/>\n       </imgdir>\n       <imgdir name=\"1022104\">\n         <string name=\"name\" value=\"3D Glasses\"/>\n@@ -4162,12 +4162,12 @@\n         <string name=\"name\" value=\"Pink Bean Hat \"/>\n       </imgdir>\n       <imgdir name=\"1002980\">\n-        <string name=\"name\" value=\"Archeologist Hat\"/>\n-        <string name=\"desc\" value=\"An archeologist hat received for participating in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Hat\"/>\n+        <string name=\"desc\" value=\"An archaeologist hat received for participating in the Artifact Hunt.\"/>\n       </imgdir>\n       <imgdir name=\"1002981\">\n-        <string name=\"name\" value=\"Archeologist Hat\"/>\n-        <string name=\"desc\" value=\"An archeologist hat received for finishing Top 10 in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Hat\"/>\n+        <string name=\"desc\" value=\"An archaeologist hat received for finishing Top 10 in the Artifact Hunt.\"/>\n       </imgdir>\n       <imgdir name=\"1003023\">\n         <string name=\"name\" value=\"Targar Hat(INT)\"/>\n@@ -4340,8 +4340,8 @@\n         <string name=\"name\" value=\"Mini Crown\"/>\n       </imgdir>\n       <imgdir name=\"1003073\">\n-        <string name=\"name\" value=\"Archeologist Hat\"/>\n-        <string name=\"desc\" value=\"An archeologist hat received for participating in the Artifact Hunt.\"/>\n+        <string name=\"name\" value=\"Archaeologist Hat\"/>\n+        <string name=\"desc\" value=\"An archaeologist hat received for participating in the Artifact Hunt.\"/>\n       </imgdir>\n     </imgdir>\n     <imgdir name=\"Cape\">"}, {"sha": "7b2c617dd8513c6b7cb9706754c08d98b9e14aa4", "filename": "wz/String.wz/Etc.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Etc.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Etc.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Etc.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -3150,7 +3150,7 @@\n     </imgdir>\n     <imgdir name=\"4031148\">\n       <string name=\"name\" value=\"Winston&apos;s Recommendation\"/>\n-      <string name=\"desc\" value=\"A letter of recommendation from Winston the Archeologist. Need to deliver this to Dr. Betty of Ellinia.\"/>\n+      <string name=\"desc\" value=\"A letter of recommendation from Winston the Archaeologist. Need to deliver this to Dr. Betty of Ellinia.\"/>\n     </imgdir>\n     <imgdir name=\"4031149\">\n       <string name=\"name\" value=\"Fossil Box\"/>"}, {"sha": "d8a393883725cfb7a0d5d7417c2b58887346c1a1", "filename": "wz/String.wz/Npc.img.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Npc.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Npc.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Npc.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -374,7 +374,7 @@\n     <string name=\"s0\" value=\"The fossils contain important information from the past.\"/>\n     <string name=\"s1\" value=\"Do you think I can ... recover all that data that I&apos;ve lost?\"/>\n     <string name=\"n0\" value=\"Look around the cliff and you may be able to find the fossils.\"/>\n-    <string name=\"d0\" value=\"I&apos;m Winston the archeologist.\"/>\n+    <string name=\"d0\" value=\"I&apos;m Winston the archaeologist.\"/>\n     <string name=\"d1\" value=\"You&apos;re the one that helped me out the other day. Unfortunately I&apos;m really busy right this minute. I&apos;ll talk to you later.\"/>\n   </imgdir>\n   <imgdir name=\"1022007\">"}, {"sha": "eba9f463ace4de3cb7d9eba7a17622f78d2e1a24", "filename": "wz/String.wz/Skill.img.xml", "status": "modified", "additions": 25, "deletions": 35, "changes": 60, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Skill.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/2b44b4baa25d605e28f257d330aadba56e3efcfe/wz/String.wz/Skill.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/String.wz/Skill.img.xml?ref=2b44b4baa25d605e28f257d330aadba56e3efcfe", "patch": "@@ -4757,66 +4757,56 @@\n   </imgdir>\n   <imgdir name=\"9001000\">\n     <string name=\"name\" value=\"Haste (Normal)\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Haste\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Haste\"/>\n     <string name=\"h1\" value=\"Moving Speed + 40, Jump + 20 for 30 Minutes (Only for self)\"/>\n   </imgdir>\n   <imgdir name=\"9001001\">\n     <string name=\"name\" value=\"Super Dragon Roar\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Super Dragon Roar\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Super Dragon Roar\"/>\n     <string name=\"h1\" value=\"Damage 1000%, Full Screen Attack\"/>\n   </imgdir>\n   <imgdir name=\"9001002\">\n     <string name=\"name\" value=\"Teleport\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Teleport\"/>\n-    <string name=\"h1\" value=\"Teleport \"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Teleport\"/>\n+    <string name=\"h1\" value=\"Teleport yourself.\"/>\n   </imgdir>\n   <imgdir name=\"910\">\n     <string name=\"bookName\" value=\"Admin. Skill Book (Super)\"/>\n   </imgdir>\n   <imgdir name=\"9101000\">\n     <string name=\"name\" value=\"Heal + Dispel\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\nHeal + Dispel\"/>\n-    <string name=\"h1\" value=\"Heal + Dispel\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Heal + Dispel\"/>\n+    <string name=\"h1\" value=\"Heal and Dispel nearby players.\"/>\n   </imgdir>\n   <imgdir name=\"9101001\">\n     <string name=\"name\" value=\"Haste (Super)\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Haste\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Haste\"/>\n     <string name=\"h1\" value=\"Moving Speed + 40, Jump + 20 for 30 Minutes\"/>\n   </imgdir>\n   <imgdir name=\"9101002\">\n     <string name=\"name\" value=\"Holy Symbol\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Holy Symbol\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Holy Symbol\"/>\n     <string name=\"h1\" value=\"EXP 150% for 30 Minutes\"/>\n   </imgdir>\n   <imgdir name=\"9101003\">\n     <string name=\"name\" value=\"Bless\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Bless\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Bless\"/>\n     <string name=\"h1\" value=\"Attack &amp; Magic Attack + 20, Others + 100 for 30 Minutes\"/>\n   </imgdir>\n   <imgdir name=\"9101004\">\n     <string name=\"name\" value=\"Hide\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Hide\"/>\n-    <string name=\"h1\" value=\"Hide\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Hide\"/>\n+    <string name=\"h1\" value=\"Hide yourself.\"/>\n   </imgdir>\n   <imgdir name=\"9101005\">\n     <string name=\"name\" value=\"Resurrection\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Resurrection\"/>\n-    <string name=\"h1\" value=\"Ressurect\"/>\n-  </imgdir>\n-  <imgdir name=\"9101006\">\n-    <string name=\"name\" value=\"Super Dragon Roar\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Super Dragon Roar\"/>\n-    <string name=\"h1\" value=\"Damage 1000%, Full Screen Attack\"/>\n-  </imgdir>\n-  <imgdir name=\"9101007\">\n-    <string name=\"name\" value=\"Teleport\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Teleport\"/>\n-    <string name=\"h1\" value=\"Teleport \"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Resurrection\"/>\n+    <string name=\"h1\" value=\"Ressurect nearby players.\"/>\n   </imgdir>\n   <imgdir name=\"9101008\">\n     <string name=\"name\" value=\"Hyper Body\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\nIncrease the Max HP and Max MP for 15 mins.\"/>\n-    <string name=\"h1\" value=\"Max HP, Max MP 60% increase.\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Hyper Body\"/>\n+    <string name=\"h1\" value=\"Max HP, Max MP 60% increase on players nearby for 15 mins.\"/>\n   </imgdir>\n   <imgdir name=\"0001005\">\n     <string name=\"name\" value=\"Echo of Hero\"/>\n@@ -11675,28 +11665,28 @@\n   </imgdir>\n   <imgdir name=\"9001003\">\n     <string name=\"name\" value=\"Bless\"/>\n-    <string name=\"desc\" value=\"[Master Level:1]\\nIncreases all abilities of those around you for 15 minutes.\"/>\n+    <string name=\"desc\" value=\"[Master Level:1]\\n GM Bless\"/>\n     <string name=\"h1\" value=\"Attack and Magic Ability +20, and other abilities +100 for 30 minutes.\"/>\n   </imgdir>\n   <imgdir name=\"9001004\">\n     <string name=\"name\" value=\"Hide\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Hide\"/>\n-    <string name=\"h1\" value=\"Hide\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Hide\"/>\n+    <string name=\"h1\" value=\"Hide yourself.\"/>\n   </imgdir>\n   <imgdir name=\"9001005\">\n     <string name=\"name\" value=\"Resurrection\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Resurrection\"/>\n-    <string name=\"h1\" value=\"Ressurect\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Resurrection\"/>\n+    <string name=\"h1\" value=\"Ressurect nearby players.\"/>\n   </imgdir>\n   <imgdir name=\"9001006\">\n     <string name=\"name\" value=\"Super Dragon Roar\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Super Dragon Roar\"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Super Dragon Roar\"/>\n     <string name=\"h1\" value=\"Damage 1000%, Full Screen Attack\"/>\n   </imgdir>\n   <imgdir name=\"9001007\">\n     <string name=\"name\" value=\"Teleport\"/>\n-    <string name=\"desc\" value=\"[Master Level : 1]\\n Teleport\"/>\n-    <string name=\"h1\" value=\"Teleport \"/>\n+    <string name=\"desc\" value=\"[Master Level : 1]\\n GM Teleport\"/>\n+    <string name=\"h1\" value=\"Teleport yourself.\"/>\n   </imgdir>\n   <imgdir name=\"9001009\">\n     <string name=\"name\" value=\"ADMIN_ANTIMACRO\"/>\n@@ -11705,8 +11695,8 @@\n   </imgdir>\n   <imgdir name=\"9001008\">\n     <string name=\"name\" value=\"Hyper Body\"/>\n-    <string name=\"desc\" value=\"[Master Level:1]\\nMax HP, Max MP increases for 15 minutes.\"/>\n-    <string name=\"h1\" value=\"Max HP, Max MP 60% increase.\"/>\n+    <string name=\"desc\" value=\"[Master Level:1]\\n GM Hyper Body\"/>\n+    <string name=\"h1\" value=\"Max HP, Max MP 60% increase on players nearby for 15 minutes.\"/>\n   </imgdir>\n   <imgdir name=\"10001014\">\n     <string name=\"name\" value=\"Spaceship\"/>"}]}]},
