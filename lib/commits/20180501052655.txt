{"fetchDate": "2019-12-19", "content": [{"sha": "7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6N2QwZjFjYjMxMTQzNzVkN2NjOTVkNWI4YmYwN2Q0NDQzOGVmYTk2Nw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-05-01T05:26:55Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-05-01T05:26:55Z"}, "message": "Password on minigames + Broadcast diseases + Missing reactor scripts\n\nAdded script for several uncoded reactors with drop data on DB.\nImproved quest status updates on the DB, now using a common \"characterid\" column.\nFixed several disease status not appearing for other players.\nFixed MapleTV item being taken twice per operation.\nImplemented password system for minirooms such as omok/match cards. Passwords as player names will suggest to the system that player is being \"invited\" to the private game.", "tree": {"sha": "e56013b11f3a2318a5613a7fa6640f5674f704ab", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/e56013b11f3a2318a5613a7fa6640f5674f704ab"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "html_url": "https://github.com/ronancpl/HeavenMS/commit/7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "61292f5c9b6bf03f0cd2d45b6324e3d2c0268548", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/61292f5c9b6bf03f0cd2d45b6324e3d2c0268548", "html_url": "https://github.com/ronancpl/HeavenMS/commit/61292f5c9b6bf03f0cd2d45b6324e3d2c0268548"}], "stats": {"total": 885, "additions": 805, "deletions": 80}, "files": [{"sha": "ea3a637b1d00b06c1fbec265c74efa7430458835", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -63,6 +63,10 @@\n /tools/MapleQuestMesoFetcher/dist/\n /tools/MapleQuestMesoFetcher/nbproject/\n \n+/tools/MapleReactorDropFetcher/build/\n+/tools/MapleReactorDropFetcher/dist/\n+/tools/MapleReactorDropFetcher/nbproject/\n+\n /tools/MapleSkillMakerFetcher/build/\n /tools/MapleSkillMakerFetcher/dist/\n /tools/MapleSkillMakerFetcher/nbproject/"}, {"sha": "7df541e9a16dc750e749e59612f496ef0e8acddf", "filename": "docs/feature_list.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -50,6 +50,7 @@ Player Social Network:\n * Guild and Alliance system fully functional.\n * Beginners can create and join a \"beginner-only\" party (characters up to level 10).\n * Enhanced synchronization on Player Shops and Hired Merchants. Transactions made are instantly informed to the owner.\n+* Game minirooms such as match cards and omok now has semi-functional password system.\n \n Cash & Items:\n \n@@ -131,6 +132,7 @@ External tools:\n * MapleQuestItemCountFetcher - Searches the quest WZ files and reports in all relevant data regarding missing \"count\" labels on item acts at \"complete quest\".\n * MapleQuestItemFetcher - Searches the SQL tables and project files and reports in all relevant data regarding missing/erroneous quest items.\n * MapleQuestMesoFetcher - Searches the quest WZ files and reports in all relevant data regarding missing/erroneous quest fee checks.\n+* MapleReactorDropFetcher - Searches the DB for reactors with drop data and reports in reactorids that are not yet coded.\n * MapleSkillMakerFetcher - Updates the DB Maker-related tables with the current info present on the WZs.\n * MapleSkillMakerReagentIndexer - Generates a new maker table describing all stat-improvements from the Maker reagents (those empowering crystals and jewels).\n "}, {"sha": "740064462ccf96b1b7bbeda60a6b08c3db9ad4e7", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -850,35 +850,35 @@ Adicionado sistema de bonus para expedi\u00e7\u00e3o de Showa, ating\u00edvel se nenhum joga\n Nova ferramenta: MapleBossHpBarFetcher. Localiza no Mob.wz ids de mobs que possuem um boss hp bar mas n\u00e3o s\u00e3o labelados como \"boss\".\n Incrementado quiz de 3rd job, agora utilizando um pool de 40 perguntas com escolha arbitr\u00e1ria.\n \n-05 - 10 Mar\u00e7o 2018,\n+05 - 10 Abril 2018,\n Corrigido diseases n\u00e3o sendo removidas corretamente no cliente quando tentando trocar de canal/entrar Cash Shop, permitindo-as ficar no jogador infinitamente.\n Corrigido Holy Symbol atuando de forma inesperada no cen\u00e1rio com somente um jogador.\n Corrigido Summon Sack lv. 9 lan\u00e7ando mob com id inexistente.\n Corrigido NPC de guild tirando mesos do jogador sem efetuar a a\u00e7\u00e3o alguma caso o n\u00famero m\u00e1ximo de jogadores tenha sido alcan\u00e7ado.\n \n-11 - 12 Mar\u00e7o 2018,\n+11 - 12 Abril 2018,\n Localhost melhorado: retirado caps de Matk, Mdef, Wdef, Acc e Avoid.\n Balanceado Ninja Ambush, agora dando uma quantidade de dano justific\u00e1vel.\n Implementado questline do Dyle.\n Corrigido poss\u00edvel exploit com sistema de quests, onde jogador podia come\u00e7ar e completar quaisquer quests livremente.\n Nova ferramenta: MapleCashDropFetcher. Aplica\u00e7\u00e3o busca por drop data de cash na DB e reporta.\n \n-13 - 14 Mar\u00e7o 2018,\n+13 - 14 Abril 2018,\n Adicionado feature de an\u00fancio de mudan\u00e7a de classe.\n Adicionado drops faltando da questline Puppeteer de Aran.\n Movimenta\u00e7\u00e3o de GM rank para alguns comandos.\n Corrigido autoassigner inesperadamente desconectando jogadores, quando o autoassigner do cliente est\u00e1 sendo utilizado.\n Adicionado scripts para a questline de Full Swing de Aran.\n \n-19 Mar\u00e7o 2018,\n+19 Abril 2018,\n Tentativa de corre\u00e7\u00e3o em reactors desconectando jogadores que tentam ativ\u00e1-los com ataque b\u00e1sico ao mesmo tempo.\n Adicionado feature de AutoJCE (cr\u00e9ditos aos Acernis devs).\n \n-20 - 22 Mar\u00e7o 2018,\n+20 - 22 Abril 2018,\n Resolvido exploit com login, onde qualquer um (via packet editing) podia logar livremente com personagem de outras contas.\n Nova ferramenta: MapleQuestlineFetcher. Busca nos XMLs e registra questids que ainda n\u00e3o possuem quest scripts.\n \n-24 - 25 Mar\u00e7o 2018,\n+24 - 25 Abril 2018,\n Corrigido sistema de levelup de equips desbalanceado para o cen\u00e1rio low-level, distribuindo uma quantidade de EXP extremamente baixa.\n Corrigido flag EQUIP_EXP_RATE atuando de forma err\u00f4nea.\n Modificado sistema do chaos scroll, agora utilizando uma flag nova ao inv\u00e9s de reusar flag SCROLL_CHANCE_RATE.\n@@ -887,11 +887,24 @@ Corrigido alguns aspectos do BalrogPQ, tais como a cabe\u00e7a sendo ating\u00edvel ante\n Corrigido barras da tela de sele\u00e7\u00e3o de canais na etapa de login n\u00e3o atuando corretamente.\n Adicionado checks de world server lotado de diversos pontos das etapas de login.\n \n-26 Mar\u00e7o 2018,\n+26 Abril 2018,\n Corrigido sistema de levelup ainda desbalanceado para o cen\u00e1rio EXTREMAMENTE low-level.\n Adicionado suporte para quests de Kerning Square e Mushroom Castle.\n Adicionado script para v\u00e1rias quests ainda n\u00e3o-scriptadas.\n Refatorado medal quests, agora adotando um sistema de script default para aquelas n\u00e3o-scriptadas.\n Adicionado comando \"debuff\", debuffando em \u00e1rea pr\u00f3ximo ao character que ativou o comando.\n Corrigido vazamento de dados na DB referente \u00e0s informa\u00e7\u00f5es de quest status e medal maps dos jogadores.\n-Adicionado checagem de proximidade aos NPCs para come\u00e7ar e terminar quests sem lightbulb.\n\\ No newline at end of file\n+Adicionado checagem de proximidade aos NPCs para come\u00e7ar e terminar quests sem lightbulb.\n+\n+27 Abril 2018,\n+Edi\u00e7\u00e3o de localhost: Removido popup de \"excesso de AP\" e bloqueios de \"Admin/MWLB\", cr\u00e9ditos ao kevintjuh93.\n+Edi\u00e7\u00e3o de localhost: Removido popup de \"You've gained a level!\", cr\u00e9ditos ao PrinceReborn.\n+Adicionado script para v\u00e1rios reactors com drop data na DB mas ainda n\u00e3o-scriptados.\n+Melhorado updates de quest status, agora utilizando uma nova coluna \"characterid\" para facilitar retirada de antigos elementos da tabela.\n+Corrigido v\u00e1rios status de diseases n\u00e3o aparecendo para outros jogadores.\n+Corrigido item de MapleTV sendo retirado 2x ao usar.\n+\n+29 Abril 2018,\n+Implementado sistema de senhas para minirooms de match cards/omok.\n+Adicionado/documentado mensagens de erro apropriados ao criar/visitar minirooms.\n+Implementado expel em minirooms de jogos.\n\\ No newline at end of file"}, {"sha": "1a7c3eece593e3d1a2ff60e24e779b94e932b6da", "filename": "docs/todo.txt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/todo.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/docs/todo.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/todo.txt?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -7,10 +7,13 @@ Vcoc - Freelance Developer\n Known issues:\n - Everytime two people click on an npc at the same time, one of them dcs and the other needs to @dispose to talk to the npc.\n - If multiple people hit boxes/reactors at the same time, they both dc with invalid pointer error.\n+- Passwords on minirooms are not encoded for players entering/logging into the map.\n ---------------------------\n \n ---------------------------\n-ToDo / Missing features list:\n+Missing features list:\n+- Miniroom tooltips (such as number of players in store/host awaiting game) not showing up properly.\n+- Disease POISON appears MISSES to other players.\n ---------------------------\n \n "}, {"sha": "be6f6bcae0866583b6461f5250a6f1206269ab4c", "filename": "scripts/npc/commands.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/npc/commands.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/npc/commands.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/commands.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -74,6 +74,7 @@ function writeSolaxiaCommandsLv5() {    //Developer\n         addCommand(\"debugcoupons\", \"\");\n         addCommand(\"debugplayercoupons\", \"\");\n         addCommand(\"debugtimer\", \"\");\n+        addCommand(\"set\", \"\");\n }\n \n function writeSolaxiaCommandsLv4() {    //SuperGM"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/1022001.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/1022001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/1022001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1022001.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/1032000.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/1032000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/1032000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/1032000.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200000.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200000.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200001.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200001.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200002.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200002.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200003.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200003.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200004.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200004.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200005.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200005.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200006.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200006.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200007.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200007.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200008.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200008.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/200009.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200009.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/200009.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/200009.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/2052001.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/2052001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/2052001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2052001.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "9371dcfa5cc00bc930bf73c77050ef18f4e2ba53", "filename": "scripts/reactor/2112015.js", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/2112015.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/scripts/reactor/2112015.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2112015.js?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,26 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/* @Author Ronan\n+*/\n+\n+function act() {\n+    rm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "04a209adf9d4bbdc4e6dfa4fc89662587b78b9ee", "filename": "sql/db_database.sql", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -15990,6 +15990,7 @@ CREATE TABLE IF NOT EXISTS `marriages` (\n \n CREATE TABLE IF NOT EXISTS `medalmaps` (\n   `id` int(11) NOT NULL AUTO_INCREMENT,\n+  `characterid` int(11) NOT NULL,\n   `queststatusid` int(11) unsigned NOT NULL,\n   `mapid` int(11) NOT NULL,\n   PRIMARY KEY (`id`),\n@@ -16508,6 +16509,7 @@ CREATE TABLE IF NOT EXISTS `questactions` (\n \n CREATE TABLE IF NOT EXISTS `questprogress` (\n   `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n+  `characterid` int(11) NOT NULL,\n   `queststatusid` int(10) unsigned NOT NULL DEFAULT '0',\n   `progressid` int(11) NOT NULL DEFAULT '0',\n   `progress` varchar(15) CHARACTER SET latin1 COLLATE latin1_german1_ci NOT NULL DEFAULT '',\n@@ -17240,8 +17242,8 @@ INSERT INTO `reactordrops` (`reactordropid`, `reactorid`, `itemid`, `chance`, `q\n (693, 6702012, 3010011, 50, -1),\n (694, 6702012, 3012000, 100, -1),\n (695, 6702012, 3012005, 100, -1),\n-(696, 1032000, 4001363, 1, -1),\n-(697, 1032000, 4001362, 1, -1),\n+(696, 1032000, 4001363, 1, 28252),\n+(697, 1032000, 4001362, 1, 28252),\n (698, 2512000, 2022131, 1, -1),\n (699, 2512000, 2022132, 1, -1),\n (700, 2612002, 4001134, 1, -1),"}, {"sha": "b99400406a1f81b32caffd3605af63e7c307878c", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 16, "deletions": 24, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -1886,24 +1886,14 @@ public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n     }\n     \n     private static void deleteQuestProgressWhereCharacterId(Connection con, int cid) throws SQLException {\n-        try (PreparedStatement ps = con.prepareStatement(\"SELECT queststatusid FROM queststatus WHERE characterid = ?\")) {\n+        try (PreparedStatement ps = con.prepareStatement(\"DELETE FROM medalmaps WHERE characterid = ?\")) {\n             ps.setInt(1, cid);\n+            ps.executeUpdate();\n+        }\n \n-            try (ResultSet rs = ps.executeQuery()) {\n-                while (rs.next()) {\n-                    int queststatusid = rs.getInt(\"queststatusid\");\n-\n-                    try (PreparedStatement ps2 = con.prepareStatement(\"DELETE FROM medalmaps WHERE queststatusid = ?\")) {\n-                        ps2.setInt(1, queststatusid);\n-                        ps2.executeUpdate();\n-                    }\n-\n-                    try (PreparedStatement ps2 = con.prepareStatement(\"DELETE FROM questprogress WHERE queststatusid = ?\")) {\n-                        ps2.setInt(1, queststatusid);\n-                        ps2.executeUpdate();\n-                    }\n-                }\n-            }\n+        try (PreparedStatement ps = con.prepareStatement(\"DELETE FROM questprogress WHERE characterid = ?\")) {\n+            ps.setInt(1, cid);\n+            ps.executeUpdate();\n         }\n     }\n \n@@ -4309,7 +4299,7 @@ public void closeMiniGame() {\n         this.setMiniGame(null);\n         if (game.isOwner(this)) {\n             this.getMap().broadcastMessage(MaplePacketCreator.removeCharBox(this));\n-            game.broadcastToVisitor(MaplePacketCreator.getMiniGameClose());\n+            game.broadcastToVisitor(MaplePacketCreator.getMiniGameClose(3));\n         } else {\n             game.removeVisitor(this);\n         }\n@@ -6663,8 +6653,8 @@ public synchronized void saveToDB(boolean notAutosave) {\n             deleteQuestProgressWhereCharacterId(con, id);\n             ps = con.prepareStatement(\"INSERT INTO queststatus (`queststatusid`, `characterid`, `quest`, `status`, `time`, `expires`, `forfeited`) VALUES (DEFAULT, ?, ?, ?, ?, ?, ?)\", Statement.RETURN_GENERATED_KEYS);\n             PreparedStatement psf;\n-            try (PreparedStatement pse = con.prepareStatement(\"INSERT INTO questprogress VALUES (DEFAULT, ?, ?, ?)\")) {\n-                psf = con.prepareStatement(\"INSERT INTO medalmaps VALUES (DEFAULT, ?, ?)\");\n+            try (PreparedStatement pse = con.prepareStatement(\"INSERT INTO questprogress VALUES (DEFAULT, ?, ?, ?, ?)\")) {\n+                psf = con.prepareStatement(\"INSERT INTO medalmaps VALUES (DEFAULT, ?, ?, ?)\");\n                 ps.setInt(1, id);\n                 \n                 synchronized (quests) {\n@@ -6678,14 +6668,16 @@ public synchronized void saveToDB(boolean notAutosave) {\n                         try (ResultSet rs = ps.getGeneratedKeys()) {\n                             rs.next();\n                             for (int mob : q.getProgress().keySet()) {\n-                                pse.setInt(1, rs.getInt(1));\n-                                pse.setInt(2, mob);\n-                                pse.setString(3, q.getProgress(mob));\n+                                pse.setInt(1, id);\n+                                pse.setInt(2, rs.getInt(1));\n+                                pse.setInt(3, mob);\n+                                pse.setString(4, q.getProgress(mob));\n                                 pse.addBatch();\n                             }\n                             for (int i = 0; i < q.getMedalMaps().size(); i++) {\n-                                psf.setInt(1, rs.getInt(1));\n-                                psf.setInt(2, q.getMedalMaps().get(i));\n+                                psf.setInt(1, id);\n+                                psf.setInt(2, rs.getInt(1));\n+                                psf.setInt(3, q.getMedalMaps().get(i));\n                                 psf.addBatch();\n                             }\n                             pse.executeBatch();"}, {"sha": "45014bec10b567128c16553e3387129f2b88e123", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -1636,7 +1636,7 @@ public static boolean executeHeavenMsCommandLv3(Channel cserv, Server srv, Maple\n \t\t\t\tbreak;\n                         }\n                     \n-                        for (MapleMapObject mmo : player.getMap().getMapObjectsInRange(player.getPosition(), 1000.0, Arrays.asList(MapleMapObjectType.PLAYER))) {\n+                        for (MapleMapObject mmo : player.getMap().getMapObjectsInRange(player.getPosition(), 777777.7, Arrays.asList(MapleMapObjectType.PLAYER))) {\n                                 MapleCharacter chr = (MapleCharacter) mmo;\n                                 \n                                 if(chr.getId() != player.getId()) {\n@@ -2671,6 +2671,14 @@ public static boolean executeHeavenMsCommandLv5(Channel cserv, Server srv, Maple\n \t\t\tTimerManager tMan = TimerManager.getInstance();\n \t\t\tplayer.dropMessage(6, \"Total Task: \" + tMan.getTaskCount() + \" Current Task: \" + tMan.getQueuedTasks() + \" Active Task: \" + tMan.getActiveCount() + \" Completed Task: \" + tMan.getCompletedTaskCount());\n \t\t\tbreak;\n+                \n+                case \"set\":\n+                        for(int i = 0; i < sub.length - 1; i++) {\n+                                ServerConstants.DEBUG_VALUES[i] = Integer.parseInt(sub[i + 1]);\n+                        }\n+                    \n+                        \n+                        break;\n                     \n                 default:\n                         return false;"}, {"sha": "8eeb0c4708ea63bba59270917dce34bbc9e0ebea", "filename": "src/constants/GameConstants.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/constants/GameConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/constants/GameConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/GameConstants.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -4,6 +4,7 @@\n import constants.skills.Aran;\n import server.maps.MapleMap;\n import server.maps.FieldLimit;\n+import server.quest.MapleQuest;\n \n /*\n  * @author kevintjuh93\n@@ -211,7 +212,7 @@ public static boolean isFinisherSkill(int skillId) {\n     }\n     \n     public static boolean isMedalQuest(short questid) {\n-        return questid / 100 == 299;\n+        return MapleQuest.getInstance(questid).getMedalRequirement() != -1;\n     }\n     \n     public static boolean hasSPTable(MapleJob job) {"}, {"sha": "970ade8f67e1d423abf2b6018123ab454931556a", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -166,7 +166,10 @@\n     \n     //Event End Timestamp\n     public static final long EVENT_END_TIMESTAMP = 1428897600000L;\n-\t\n+\n+    //Debug Variables\n+    public static int DEBUG_VALUES[] = new int[10];             // Field designed for packet testing purposes\n+    \n     //Properties\n     static {\n         Properties p = new Properties();"}, {"sha": "f8ebe4d2eb6a74a42a085c63ff6af1c07b5ef08a", "filename": "src/net/server/channel/handlers/PlayerInteractionHandler.java", "status": "modified", "additions": 55, "deletions": 25, "changes": 80, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/channel/handlers/PlayerInteractionHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/channel/handlers/PlayerInteractionHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerInteractionHandler.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -93,6 +93,7 @@\n         CANCEL_EXIT(0x39),\n         READY(0x3A),\n         UN_READY(0x3B),\n+        EXPEL(0x3C),\n         START(0x3D),\n         GET_RESULT(0x3E),\n         SKIP(0x3F),\n@@ -120,26 +121,32 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 MapleTrade.startTrade(chr);\n             } else if (createType == 1) { // omok mini game\n                 if (chr.getChalkboard() != null || FieldLimit.CANNOTMINIGAME.check(chr.getMap().getFieldLimit())) {\n+                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(11));\n                     return;\n                 }\n+                \n                 String desc = slea.readMapleAsciiString();\n-                slea.readByte(); // 20 6E 4E\n-                int type = slea.readByte(); // 20 6E 4E\n-                MapleMiniGame game = new MapleMiniGame(chr, desc);\n+                int type = slea.readByte();\n+                String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n+                \n+                MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n                 chr.setMiniGame(game);\n                 game.setPieceType(type);\n                 game.setGameType(\"omok\");\n                 chr.getMap().addMapObject(game);\n                 chr.getMap().broadcastMessage(MaplePacketCreator.addOmokBox(chr, 1, 0));\n                 game.sendOmok(c, type);\n             } else if (createType == 2) { // matchcard\n-                if (chr.getChalkboard() != null) {\n+                if (chr.getChalkboard() != null || FieldLimit.CANNOTMINIGAME.check(chr.getMap().getFieldLimit())) {\n+                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(11));\n                     return;\n                 }\n+                \n                 String desc = slea.readMapleAsciiString();\n-                slea.readByte(); // 20 6E 4E\n-                int type = slea.readByte(); // 20 6E 4E\n-                MapleMiniGame game = new MapleMiniGame(chr, desc);\n+                int type = slea.readByte();\n+                String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n+                \n+                MapleMiniGame game = new MapleMiniGame(chr, desc, pw);\n                 game.setPieceType(type);\n                 if (type == 0) {\n                     game.setMatchesToWin(6);\n@@ -155,12 +162,14 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 game.sendMatchCard(c, type);\n             } else if (createType == 4 || createType == 5) { // shop\n                 if (!chr.getMap().getMapObjectsInRange(chr.getPosition(), 23000, Arrays.asList(MapleMapObjectType.SHOP, MapleMapObjectType.HIRED_MERCHANT)).isEmpty()) {\n+                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(14));\n                     return;\n                 }\n                 String desc = slea.readMapleAsciiString();\n                 slea.skip(3);\n                 int itemId = slea.readInt();\n                 if (chr.getInventory(MapleInventoryType.CASH).countById(itemId) < 1) {\n+                    chr.getClient().announce(MaplePacketCreator.getMiniRoomError(6));\n                     return;\n                 }\n \n@@ -194,7 +203,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             \tif (!chr.getTrade().isFullTrade() && !chr.getTrade().getPartner().isFullTrade()) {\n             \t\tMapleTrade.visitTrade(chr, chr.getTrade().getPartner().getChr());\n             \t} else {\n-            \t\tc.announce(MaplePacketCreator.enableActions()); //Ill be nice and not dc u\n+            \t\tchr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n             \t\treturn;\n             \t}\n             } else {\n@@ -204,20 +213,27 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     MaplePlayerShop shop = (MaplePlayerShop) ob;\n                     shop.visitShop(chr);\n                 } else if (ob instanceof MapleMiniGame) {\n+                    slea.skip(1);\n+                    String pw = slea.available() > 1 ? slea.readMapleAsciiString() : \"\";\n+                    \n                     MapleMiniGame game = (MapleMiniGame) ob;\n-                    if (game.hasFreeSlot() && !game.isVisitor(c.getPlayer())) {\n-                        game.addVisitor(c.getPlayer());\n-                        chr.setMiniGame(game);\n-                        switch (game.getGameType()) {\n-                            case \"omok\":\n-                                game.sendOmok(c, game.getPieceType());\n-                                break;\n-                            case \"matchcard\":\n-                                game.sendMatchCard(c, game.getPieceType());\n-                                break;\n+                    if(game.checkPassword(pw) || game.checkPassword(c.getPlayer().getName())) {\n+                        if (game.hasFreeSlot() && !game.isVisitor(c.getPlayer())) {\n+                            game.addVisitor(c.getPlayer());\n+                            chr.setMiniGame(game);\n+                            switch (game.getGameType()) {\n+                                case \"omok\":\n+                                    game.sendOmok(c, game.getPieceType());\n+                                    break;\n+                                case \"matchcard\":\n+                                    game.sendMatchCard(c, game.getPieceType());\n+                                    break;\n+                            }\n+                        } else {\n+                            chr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n                         }\n                     } else {\n-                        chr.getClient().announce(MaplePacketCreator.getMiniGameFull());\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(22));\n                     }\n                 } else if (ob instanceof MapleHiredMerchant && chr.getHiredMerchant() == null) {\n                     MapleHiredMerchant merchant = (MapleHiredMerchant) ob;\n@@ -227,10 +243,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                         \n                         c.announce(MaplePacketCreator.getHiredMerchant(chr, merchant, false));\n                     } else if (!merchant.isOpen()) {\n-                        c.announce(MaplePacketCreator.hiredMerchantMaintenanceMessage());\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(18));\n                         return;\n                     } else if (!merchant.addVisitor(c.getPlayer())) {\n-                        chr.dropMessage(1, \"This shop has reached it's maximum capacity, please come by later.\");\n+                        chr.getClient().announce(MaplePacketCreator.getMiniRoomError(2));\n                         return;\n                     } else {\n                         c.announce(MaplePacketCreator.getHiredMerchant(c.getPlayer(), merchant, false));\n@@ -374,20 +390,21 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         } else if (mode == Action.SET_MESO.getCode()) {\n             chr.getTrade().setMeso(slea.readInt());\n         } else if (mode == Action.SET_ITEMS.getCode()) {\n-        \t\n             MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n             MapleInventoryType ivType = MapleInventoryType.getByType(slea.readByte());\n             Item item = chr.getInventory(ivType).getItem(slea.readShort());\n             short quantity = slea.readShort();\n             byte targetSlot = slea.readByte();\n             if (quantity < 1 || quantity > item.getQuantity()) {\n+                c.announce(MaplePacketCreator.serverNotice(1, \"You don't have enough quantity of the item.\"));\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;            \t\n             }\n             if (chr.getTrade() != null) {\n                 if ((quantity <= item.getQuantity() && quantity >= 0) || ItemConstants.isRechargable(item.getItemId())) {\n                     if (ii.isDropRestricted(item.getItemId())) { // ensure that undroppable items do not make it to the trade window\n                         if (!((item.getFlag() & ItemConstants.KARMA) == ItemConstants.KARMA)) {\n+                            c.announce(MaplePacketCreator.serverNotice(1, \"That item is untradeable.\"));\n                             c.announce(MaplePacketCreator.enableActions());\n                             return;\n                         }\n@@ -411,6 +428,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             short slot = slea.readShort();\n             short bundles = slea.readShort();\n             if (chr.getInventory(ivType).getItem(slot) == null || chr.getItemQuantity(chr.getInventory(ivType).getItem(slot).getItemId(), false) < bundles || chr.getInventory(ivType).getItem(slot).getFlag() == ItemConstants.UNTRADEABLE) {\n+                c.announce(MaplePacketCreator.serverNotice(1, \"Could not perform shop operation with that item.\"));\n+                c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n             short perBundle = slea.readShort();\n@@ -451,7 +470,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (shop != null && shop.isOwner(c.getPlayer())) {\n                 int slot = slea.readShort();\n                 if (slot >= shop.getItems().size() || slot < 0) {\n-                \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with a player shop.\");\n+                        AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with a player shop.\");\n                 \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to remove item at slot \" + slot + \"\\r\\n\");\n                 \tc.disconnect(true, false);\n                 \treturn;\n@@ -479,7 +498,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         } else if (mode == Action.MERCHANT_ORGANIZE.getCode()) {\n             MapleHiredMerchant merchant = chr.getHiredMerchant();\n             if (!merchant.isOwner(chr)) return;\n-\n+            \n             if (chr.getMerchantMeso() > 0) {\n                 int possible = Integer.MAX_VALUE - chr.getMerchantMeso();\n                 if (possible > 0) {\n@@ -508,7 +527,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             int itemid = slea.readByte();\n             short quantity = slea.readShort();\n             if (quantity < 1) {\n-            \tAutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with a hired merchant and or player shop.\");\n+                AutobanFactory.PACKET_EDIT.alert(c.getPlayer(), c.getPlayer().getName() + \" tried to packet edit with a hired merchant and or player shop.\");\n             \tFilePrinter.printError(FilePrinter.EXPLOITS + c.getPlayer().getName() + \".txt\", c.getPlayer().getName() + \" tried to buy item \" + itemid + \" with quantity \" + quantity + \"\\r\\n\");\n             \tc.disconnect(true, false);\n             \treturn;\n@@ -528,6 +547,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 int slot = slea.readShort();\n                 MaplePlayerShopItem shopItem = merchant.getItems().get(slot);\n                 if (!MapleInventory.checkSpot(chr, shopItem.getItem())) {\n+                        c.announce(MaplePacketCreator.serverNotice(1, \"Have a slot available on your inventory to claim back the item.\"));\n                 \tc.announce(MaplePacketCreator.enableActions());\n                 \treturn;\n                 }\n@@ -568,6 +588,16 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             if (chr.getPlayerShop() != null && chr.getPlayerShop().isOwner(c.getPlayer())) {\n                 chr.getPlayerShop().banPlayer(slea.readMapleAsciiString());\n             }\n+        } else if (mode == Action.EXPEL.getCode()) {\n+            MapleMiniGame miniGame = chr.getMiniGame();\n+            if(miniGame != null && miniGame.isOwner(chr)) {\n+                MapleCharacter visitor = miniGame.getVisitor();\n+                \n+                if(visitor != null) {\n+                    visitor.closeMiniGame();\n+                    visitor.announce(MaplePacketCreator.getMiniGameClose(5));\n+                }\n+            }\n         }\n     }\n }"}, {"sha": "92f8305881104608d26b9fd2f5a97ba8a5c16a15", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -331,7 +331,6 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     }\n                     if (!MapleTVEffect.isActive()) {\n                         new MapleTVEffect(player, victim, messages, tvType);\n-                        remove(c, itemId);\n                     } else {\n                         player.dropMessage(1, \"MapleTV is already in use.\");\n                         return;"}, {"sha": "277c7e9939b2f4b488a8cfd45c20e988fd48d77c", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -1034,7 +1034,7 @@ public MapleHiredMerchant getHiredMerchant(int ownerid) {\n             activeMerchantsLock.unlock();\n         }\n     }\n-\n+    \n     public void setServerMessage(String msg) {\n         for (Channel ch : channels) {\n             ch.setServerMessage(msg);"}, {"sha": "e45f4d415aadad371b9fcb7ac49d629d05b02c52", "filename": "src/server/maps/MapleMiniGame.java", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/server/maps/MapleMiniGame.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/server/maps/MapleMiniGame.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMiniGame.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -35,6 +35,7 @@\n public class MapleMiniGame extends AbstractMapleMapObject {\n     private MapleCharacter owner;\n     private MapleCharacter visitor;\n+    private String password;\n     private String GameType = null;\n     private int[] piece = new int[250];\n     private List<Integer> list4x3 = new ArrayList<>();\n@@ -48,11 +49,20 @@\n     private int ownerpoints = 0;\n     private int matchestowin = 0;\n \n-    public MapleMiniGame(MapleCharacter owner, String description) {\n+    public MapleMiniGame(MapleCharacter owner, String description, String password) {\n         this.owner = owner;\n         this.description = description;\n+        this.password = password;\n     }\n \n+    public String getPassword() {\n+        return this.password;\n+    }\n+    \n+    public boolean checkPassword(String sentPw) {\n+        return this.password.length() == 0 || sentPw.toLowerCase().contentEquals(this.password.toLowerCase());\n+    }\n+    \n     public boolean hasFreeSlot() {\n         return visitor == null;\n     }"}, {"sha": "dde1c65dc6b2a34543fc1d1ffaa9eadcf1894120", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 41, "deletions": 14, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -1898,15 +1898,19 @@ private static void encodeParentlessMobSpawnEffect(MaplePacketLittleEndianWriter\n                         } else {\n                                 addAnnounceBox(mplew, mps, 1);\n                         }\n-                } else if (chr.getMiniGame() != null && chr.getMiniGame().isOwner(chr)) {\n-                        if (chr.getMiniGame().hasFreeSlot()) {\n-                                addAnnounceBox(mplew, chr.getMiniGame(), 1, 0, 1, 0);\n+                } else {\n+                        MapleMiniGame miniGame = chr.getMiniGame();\n+                        if (miniGame != null && miniGame.isOwner(chr)) {\n+                                if (miniGame.hasFreeSlot()) {\n+                                        spawnAnnounceBox(mplew, miniGame, 1, 0, 1, 0);\n+                                } else {\n+                                        spawnAnnounceBox(mplew, miniGame, 1, 0, 2, 1);\n+                                }\n                         } else {\n-                                addAnnounceBox(mplew, chr.getMiniGame(), 1, 0, 2, 1);\n+                                mplew.write(0);\n                         }\n-                } else {\n-                        mplew.write(0);\n                 }\n+                \n                 if (chr.getChalkboard() != null) {\n                         mplew.write(1);\n                         mplew.writeMapleAsciiString(chr.getChalkboard());\n@@ -2073,6 +2077,17 @@ private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, Ma\n         }\n \n         private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, MapleMiniGame game, int gametype, int type, int ammount, int joinable) {\n+                mplew.write(gametype);\n+                mplew.writeInt(game.getObjectId()); // gameid/shopid\n+                mplew.writeMapleAsciiString(game.getDescription()); // desc\n+                mplew.writeMapleAsciiString(game.getPassword());\n+                mplew.write(type);\n+                mplew.write(ammount);\n+                mplew.write(2);\n+                mplew.write(joinable);\n+        }\n+        \n+        private static void spawnAnnounceBox(final MaplePacketLittleEndianWriter mplew, MapleMiniGame game, int gametype, int type, int ammount, int joinable) {\n                 mplew.write(gametype);\n                 mplew.writeInt(game.getObjectId()); // gameid/shopid\n                 mplew.writeMapleAsciiString(game.getDescription()); // desc\n@@ -2082,7 +2097,7 @@ private static void addAnnounceBox(final MaplePacketLittleEndianWriter mplew, Ma\n                 mplew.write(2);\n                 mplew.write(joinable);\n         }\n-\n+        \n         public static byte[] facialExpression(MapleCharacter from, int expression) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter(10);\n                 mplew.writeShort(SendOpcode.FACIAL_EXPRESSION.getValue());\n@@ -2768,7 +2783,7 @@ private static void writeLongMaskD(final MaplePacketLittleEndianWriter mplew, Li\n                 mplew.writeInt(cid);\n                 writeLongMaskD(mplew, statups);\n                 for (Pair<MapleDisease, Integer> statup : statups) {\n-                        mplew.writeShort(statup.getRight().shortValue());\n+                        if(statup.getLeft() == MapleDisease.POISON) mplew.writeShort(statup.getRight().shortValue());\n                         mplew.writeShort(skill.getSkillId());\n                         mplew.writeShort(skill.getSkillLevel());\n                 }\n@@ -4823,15 +4838,27 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return mplew.getPacket();\n         }\n \n-        public static byte[] getMiniGameFull() {\n+        /**\n+         * 1 = Room already closed  2 = Can't enter due full cappacity 3 = Other requests at this minute\n+         * 4 = Can't do while dead 5 = Can't do while middle event 6 = This character unable to do it\n+         * 7, 20 = Not allowed to trade anymore 9 = Can only trade on same map 10 = May not open store near portal\n+         * 11, 14 = Can't start game here 12 = Can't open store at this channel 13 = Can't estabilish miniroom\n+         * 15 = Stores only an the free market 16 = Lists the rooms at FM (?) 17 = You may not enter this store\n+         * 18 = Owner undergoing store maintenance 19 = Unable to enter tournament room 21 = Not enough mesos to enter\n+         * 22 = Incorrect password\n+         *\n+         * @param status\n+         * @return\n+         */\n+        public static byte[] getMiniRoomError(int status) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter(5);\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.ROOM.getCode());\n                 mplew.write(0);\n-                mplew.write(2);\n+                mplew.write(status);\n                 return mplew.getPacket();\n         }\n-\n+        \n         public static byte[] getMiniGameSkipVisitor(MapleMiniGame game) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter(4);\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n@@ -4918,12 +4945,12 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 return getMiniGameResult(game, 1, 0, 0, 1, 1, true);\n         }\n \n-        public static byte[] getMiniGameClose() {\n+        public static byte[] getMiniGameClose(int type) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter(5);\n                 mplew.writeShort(SendOpcode.PLAYER_INTERACTION.getValue());\n                 mplew.write(PlayerInteractionHandler.Action.EXIT.getCode());\n                 mplew.write(1);\n-                mplew.write(3);\n+                mplew.write(type); /* 2 : CRASH 3 : The room has been closed 4 : You have left the room 5 : You have been expelled  */\n                 return mplew.getPacket();\n         }\n \n@@ -5072,7 +5099,7 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 mplew.skip(3);\n                 return mplew.getPacket();\n         }\n-\n+        \n         public static byte[] addOmokBox(MapleCharacter c, int ammount, int type) {\n                 final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.UPDATE_CHAR_BOX.getValue());"}, {"sha": "24bf91c3908ca0cb4d132e52c92b4f37661f4b17", "filename": "tools/MapleReactorDropFetcher/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleReactorDropFetcher/build.xml?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleReactorDropFetcher\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleReactorDropFetcher.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleReactorDropFetcher-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "b011a3466e7271b1270b059cfcd774c4f166e530", "filename": "tools/MapleReactorDropFetcher/lib/ReactorDropReport.txt", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/lib/ReactorDropReport.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/lib/ReactorDropReport.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleReactorDropFetcher/lib/ReactorDropReport.txt?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,20 @@\n+ # Report File autogenerated from the MapleReactorDropFetcher feature by Ronan Lana.\n+ # Generated data takes into account several data info from the underlying DB and the server-side files.\n+\n+MISSING REACTOR DROP SCRIPTS\n+  200000\n+  200001\n+  200002\n+  200003\n+  200004\n+  200005\n+  200006\n+  200007\n+  200008\n+  200009\n+  1022001\n+  1032000\n+  2052001\n+  2112015\n+\n+"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleReactorDropFetcher/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleReactorDropFetcher/manifest.mf?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "8a317fee3fdb6b3b189bef6d0489e9283f72036a", "filename": "tools/MapleReactorDropFetcher/src/maplereactordropfetcher/MapleReactorDropFetcher.java", "status": "added", "additions": 170, "deletions": 0, "changes": 170, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/src/maplereactordropfetcher/MapleReactorDropFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/7d0f1cb3114375d7cc95d5b8bf07d44438efa967/tools/MapleReactorDropFetcher/src/maplereactordropfetcher/MapleReactorDropFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleReactorDropFetcher/src/maplereactordropfetcher/MapleReactorDropFetcher.java?ref=7d0f1cb3114375d7cc95d5b8bf07d44438efa967", "patch": "@@ -0,0 +1,170 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package maplereactordropfetcher;\n+\n+import java.io.BufferedReader;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.sql.Connection;\n+import java.sql.DriverManager;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import java.io.File;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ \n+ This application reports in reactor ids that have drops on the SQL table but are\n+ not yet coded.\n+ \n+ */\n+public class MapleReactorDropFetcher {\n+    static String host = \"jdbc:mysql://localhost:3306/heavenms\";\n+    static String driver = \"com.mysql.jdbc.Driver\";\n+    static String username = \"root\";\n+    static String password = \"\";\n+\n+    static String reactorScriptPath = \"../../scripts/reactor\";\n+    \n+    static String directoryName = \"../..\";\n+    static String newFile = \"lib/ReactorDropReport.txt\";\n+\n+    static Connection con = null;\n+    static PrintWriter printWriter = null;\n+    static InputStreamReader fileReader = null;\n+    static BufferedReader bufferedReader = null;\n+    \n+    static Set<Integer> reactors = new HashSet<>();\n+\n+    private static void printReportFileHeader() {\n+        printWriter.println(\" # Report File autogenerated from the MapleReactorDropFetcher feature by Ronan Lana.\");\n+        printWriter.println(\" # Generated data takes into account several data info from the underlying DB and the server-side files.\");\n+        printWriter.println();\n+    }\n+    \n+    private static int getReactorIdFromFilename(String name) {\n+        try {\n+            return Integer.valueOf(name.substring(0, name.indexOf('.')));\n+        } catch(Exception e) {\n+            return -1;\n+        }\n+    }\n+    \n+    private static void removeScriptedReactorids(String directoryName) {\n+        File directory = new File(directoryName);\n+\n+        // get all the files from a directory\n+        File[] fList = directory.listFiles();\n+        for (File file : fList) {\n+            if (file.isFile()) {\n+                reactors.remove(getReactorIdFromFilename(file.getName()));\n+            }\n+        }\n+    }\n+    \n+    private static void loadReactoridsOnDB() throws SQLException {\n+        PreparedStatement ps = con.prepareStatement(\"SELECT DISTINCT reactorid FROM reactordrops;\");\n+        ResultSet rs = ps.executeQuery();\n+        \n+        while(rs.next()) {\n+            reactors.add(rs.getInt(\"reactorid\"));\n+        }\n+        \n+        rs.close();\n+        ps.close();\n+    }\n+    \n+    private static List<Integer> getSortedReactorids() {\n+        List<Integer> sortedReactors = new ArrayList<>(reactors);\n+        Collections.sort(sortedReactors);\n+        \n+        return sortedReactors;\n+    }\n+    \n+    private static void fetchMissingReactorDrops() throws SQLException {\n+        loadReactoridsOnDB();\n+        removeScriptedReactorids(reactorScriptPath);\n+    }\n+    \n+    private static void reportMissingReactorDrops() throws SQLException {\n+        if(!reactors.isEmpty()) {\n+            printWriter.println(\"MISSING REACTOR DROP SCRIPTS\");\n+            for(Integer reactorid : getSortedReactorids()) {\n+                printWriter.println(\"  \" + reactorid);\n+            }\n+            printWriter.println(\"\\n\");\n+        }\n+    }\n+    \n+    private static void ReportMissingReactors() {\n+        try {\n+            Class.forName(driver).newInstance();\n+            \n+            // filter reactorids on DB\n+            con = DriverManager.getConnection(host, username, password);\n+            \n+            System.out.println(\"Fetching reactors from DB...\");\n+            fetchMissingReactorDrops();\n+            \n+            con.close();\n+            printWriter = new PrintWriter(newFile, \"UTF-8\");\n+            \n+            // report suspects of missing quest drop data, as well as those drop data that may have incorrect questids.\n+            System.out.println(\"Reporting results...\");\n+            printReportFileHeader();\n+            reportMissingReactorDrops();\n+            \n+            printWriter.close();\n+            System.out.println(\"Done!\");\n+        }\n+\n+        catch(SQLException e) {\n+            System.out.println(\"Warning: Could not establish connection to database to report quest data.\");\n+            System.out.println(e.getMessage());\n+        }\n+\n+        catch(ClassNotFoundException e) {\n+            System.out.println(\"Error: could not find class\");\n+            System.out.println(e.getMessage());\n+        }\n+\n+        catch(InstantiationException e) {\n+            System.out.println(\"Error: instantiation failure\");\n+            System.out.println(e.getMessage());\n+        }\n+\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    public static void main(String[] args) {\n+        ReportMissingReactors();\n+    }\n+    \n+}"}]}]},
