{"fetchDate": "2019-12-19", "content": [{"sha": "a4973b8254fe8b76b5fd62df8860a3cde85404a8", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YTQ5NzNiODI1NGZlOGI3NmI1ZmQ2MmRmODg2MGEzY2RlODU0MDRhOA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-02-20T21:37:32Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-02-20T21:37:32Z"}, "message": "Autopot & Steal patch + Friendly mob drops + Portal update fix\n\nAdjusted pet autopot to use temporary variables instead of the current player's HP, MP. This seems to have solved a race condition issue where the pet would instantly use up all the pots of the assigned itemid the player had on the inventory.\nSteal now uses the effective chance it is supposed to use.\nReworked Steal so that it determines which item to drop accordingly with the drop rates of each available item. It won't drop Quest nor Party Quest items.\nReworked friendly mob drops to act on the same way common mobs drops items.\nFixed issues with scripted portals introduced on the Portal Soundeffect update patch. There is expected to have no more syntax errors on the portal scripts.\nImproved quality of the strings used on the Expedition scripts.\nNew command: reach. Warps the caller to the area where the targeted player is.", "tree": {"sha": "e331bfee549801488a0868aad21d4eb352dbd56b", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/e331bfee549801488a0868aad21d4eb352dbd56b"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/a4973b8254fe8b76b5fd62df8860a3cde85404a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a4973b8254fe8b76b5fd62df8860a3cde85404a8", "html_url": "https://github.com/ronancpl/HeavenMS/commit/a4973b8254fe8b76b5fd62df8860a3cde85404a8", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a4973b8254fe8b76b5fd62df8860a3cde85404a8/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f76e7be25a8e521d74ca71887e3a7519de0de34", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/8f76e7be25a8e521d74ca71887e3a7519de0de34", "html_url": "https://github.com/ronancpl/HeavenMS/commit/8f76e7be25a8e521d74ca71887e3a7519de0de34"}], "stats": {"total": 727, "additions": 517, "deletions": 210}, "files": [{"sha": "eb7572aebc00211a0bf37e2d0cabb791434d1d49", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1,9 +1,10 @@\n-\ufeffNEW NPC SCRIPTS:\n+\ufeffCUSTOM NPC SCRIPTS:\n \tCoco -> 9000017\n \tAgent E -> 9000036\n \n-NEW NPC SHOP:\n+CUSTOM NPC SHOPS:\n \tSpindle -> 9201082\n+\tT-1337 -> 9201101\n \n LOGS:\n \n@@ -791,4 +792,17 @@ Adicionado efeito de som ao atravessar portais para a maioria dos scripts de por\n Adicionado diversos drops de skill/mastery books para mobs level 90+.\n Corrigido problema com PQs onde jogadores que sa\u00edam do grupo n\u00e3o eram transportados para fora do mapa do evento devidamente.\n Corrigido problema com PQs onde jogadores eram expulsos de eventos j\u00e1 completados ao tentar sair/debandar da party.\n-Corrigido poss\u00edvel problema de exploit com Vega's scroll.\n\\ No newline at end of file\n+Corrigido poss\u00edvel problema de exploit com Vega's scroll.\n+\n+17 - 19 Fevereiro 2018,\n+Adicionado custom npc shop de consum\u00edveis para o T-1337.\n+Normalizado drop data do Pianus esquerdo, removido drops do Jr. Newtie que evolui pra Nest Golem.\n+Melhorado qualidade das mensagens aos usu\u00e1rios das expedi\u00e7\u00f5es.\n+Melhorado sistema de drops dos monstros aliados (Moon Bunny, Watch Hog, etc), agora fornecendo devidas exclusividades aos itens de quests. Drops de mobs aliados agora seguem o mesmo padr\u00e3o dos drops de mobs normais.\n+Modificado autopot agora usando vari\u00e1veis tempor\u00e1rias para calcular o consumo de pots, ao inv\u00e9s de usar o valor vol\u00e1til de HP/MP do objeto do jogador.\n+Resolvido bug com portais introduzido no patch anterior, que quebrou a sintaxe de c\u00f3digo em alguns casos.\n+Novo comando: reach. Transporta o usu\u00e1rio do comando a um ponto pr\u00f3ximo ao jogador alvo.\n+\n+20 Fevereiro 2018,\n+Corrigido skill Steal n\u00e3o agindo corretamente. Ratio de drops agora segue conformante ao determinado pelas chances de sair cada item (itens comuns cair\u00e3o com mais frequ\u00eancia).\n+Modificado skill Steal para n\u00e3o dropar mais itens de PQ nem de quest.\n\\ No newline at end of file"}, {"sha": "ecf4f4ad9e6eb991cb0ce24baf88b7cc388e7dc3", "filename": "scripts/event/AreaBossBamboo.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/AreaBossBamboo.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/AreaBossBamboo.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossBamboo.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -40,7 +40,7 @@ function cancelSchedule() {\n }\n \n function start() {\n-    var mapObj = em.getChannelServer().getMapFactory().getMap(800020120);\n+    var mapObj = em.getChannelServer().getMapFactory().getMap(800020120);   // original mapid was 251010101\n     var mobObj = Packages.server.life.MapleLifeFactory.getMonster(6090002);\n \t\n \tif(mapObj.getMonsterById(6090002) != null) {"}, {"sha": "b76ff3701972c4236b8a2522f072d2f806c30b4f", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -222,7 +222,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -279,7 +279,7 @@ function playerDead(eim, player) {}\n function playerRevive(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n     }\n     else {\n@@ -290,7 +290,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "a3f923cd40ffed0789a4c9f403025510e62d10ce", "filename": "scripts/event/HorntailBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/HorntailBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/HorntailBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/HorntailBattle.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -107,7 +107,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -125,7 +125,7 @@ function playerDead(eim, player) {}\n function playerRevive(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n     }\n     else {\n@@ -136,7 +136,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "95efbd74df500dcb374d02eb3cc00732d72fe2bf", "filename": "scripts/event/PinkBeanBattle.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/PinkBeanBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/PinkBeanBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PinkBeanBattle.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -109,7 +109,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue this expedition.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -144,7 +144,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue this expedition.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "f32a8aa1c4d2aa3c525e1d986bde1c7a8eef0def", "filename": "scripts/event/ScargaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ScargaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ScargaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ScargaBattle.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -93,7 +93,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -111,7 +111,7 @@ function playerDead(eim, player) {}\n function playerRevive(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n     }\n     else {\n@@ -122,7 +122,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "1b34e13428f8fc842b516d5e76f697cea3658254", "filename": "scripts/event/ShowaBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ShowaBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ShowaBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ShowaBattle.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -99,7 +99,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -117,7 +117,7 @@ function playerDead(eim, player) {}\n function playerRevive(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n     }\n     else {\n@@ -128,7 +128,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "858161063e1aa6dd14e0c53ed673a5aabfb4958f", "filename": "scripts/event/ZakumBattle.js", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ZakumBattle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/event/ZakumBattle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/ZakumBattle.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -95,7 +95,7 @@ function scheduledTimeout(eim) {\n function changedMap(eim, player, mapid) {\n     if (mapid < minMapId || mapid > maxMapId) {\n \tif (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-            eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+            eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n             eim.unregisterPlayer(player);\n             end(eim);\n         }\n@@ -113,7 +113,7 @@ function playerDead(eim, player) {}\n function playerRevive(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n         eim.unregisterPlayer(player);\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         end(eim);\n     }\n     else {\n@@ -124,7 +124,7 @@ function playerRevive(eim, player) {\n \n function playerDisconnected(eim, player) {\n     if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n-        eim.dropMessage(5, \"[Expedition] Either the leader has quitted the event or there is no longer the minimum number of members required to continue this event.\");\n+        eim.dropMessage(5, \"[Expedition] Either the leader has quit the expedition or there is no longer the minimum number of members required to continue it.\");\n         eim.unregisterPlayer(player);\n         end(eim);\n     }"}, {"sha": "2832db459808900d1cf1ffd18017a58dd2a516f5", "filename": "scripts/npc/1061018.js", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1061018.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1061018.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1061018.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -3,7 +3,6 @@ importPackage(Packages.server.events);\n var status = 0;\n var dispose = false;\n function start(){\n-    status == 0;\n     action(1, 0, 0);\n }\n "}, {"sha": "97f5e4991b39943b7a1cd7528f56d619c9dbad7c", "filename": "scripts/npc/1092015.js", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1092015.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1092015.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1092015.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -0,0 +1,47 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Water Filter */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.sendOk(\"I'm bored! Someone come play with me!\");\n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "11b909b3f2d20561f518fc767d29afd10497c4b1", "filename": "scripts/npc/1100003.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1100003.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -37,8 +37,9 @@ function action(mode, type, selection) {\n \t\tstatus++;\n \t\tif (status == 0) {\n                         if(!hasCoupon) {\n+                                var display = \"\";\n                                 for(var i=0; i < menu.length; i++) {\n-\t\t\t\t\tvar display = \"\\r\\n#L\"+i+\"##b Victoria Island (1000 mesos)#k\";\n+\t\t\t\t\tdisplay += \"\\r\\n#L\"+i+\"##b Victoria Island (1000 mesos)#k\";\n \t\t\t\t}\t\t\t\n \t\t\t\tcm.sendSimple(\"Eh, Hello...again. Do you want to leave Ereve and go somewhere else? If so, you've come to the right place. I operate a ferry that goes from #bEreve#k to #bVictoria Island#k, I can take you to #bVictoria Island#k if you want... You'll have to pay a fee of #b1000#k Mesos.\\r\\n\"+display);\n                         } else {"}, {"sha": "175ea5a9ca842780b1f16b1b7c1bf04e00cb9f5f", "filename": "scripts/npc/1100004.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1100004.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -31,8 +31,9 @@ function action(mode, type, selection) {\n         }\n         status++;\n         if (status == 0) {\n+            var display = \"\";\n             for (var i = 0; i < menu.length; i++) {\n-                var display = \"\\r\\n#L\" + i + \"##b Orbis (1000 mesos)#k\";\n+                display += \"\\r\\n#L\" + i + \"##b Orbis (1000 mesos)#k\";\n             }\n             cm.sendSimple(\"Hmm... The winds are favorable. Are you thinking of leaving ereve and going somwhere else? This ferry sails to Orbis on the Ossyria Continent, Have you taking care of everything you needed to in Ereve? If you happen to be headed toward #bOrbis#k i can take you there. What do you day? Are you going to go to Orbis?\\r\\n\" + display);\n "}, {"sha": "c536c0219431fcbc6ff8fccb774c50ed9aa2ba14", "filename": "scripts/npc/1100007.js", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1100007.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -32,10 +32,11 @@ function action(mode, type, selection) {\n \t\t}\n \t\tstatus++;\n \t\tif (status == 0) {\n-\t\t\tfor(var i=0; i < menu.length; i++) {\n-\t\t\t\t\tvar display = \"\\r\\n#L\"+i+\"##b Ereve (1000 mesos)#k\";\n-\t\t\t\t}\t\t\t\n-\t\t\t\tcm.sendSimple(\"Eh... So... Um... Are you trying to leave Victoria to go to a different region? You can take this boat to #bEreve#k. There, you will see bright sunlight shinning on the leaves and feel a gentle breeze on your skin. It's where Shinsoo and Empress Cygnus are. Would you like to go to Ereve? It will take about #b2 Minutes#k, and it will cost you #b1000#k mesos.\\r\\n\"+display);\n+\t\t\tvar display = \"\";\n+                        for(var i=0; i < menu.length; i++) {\n+                                display += \"\\r\\n#L\"+i+\"##b Ereve (1000 mesos)#k\";\n+                        }\t\t\t\n+                        cm.sendSimple(\"Eh... So... Um... Are you trying to leave Victoria to go to a different region? You can take this boat to #bEreve#k. There, you will see bright sunlight shinning on the leaves and feel a gentle breeze on your skin. It's where Shinsoo and Empress Cygnus are. Would you like to go to Ereve? It will take about #b2 Minutes#k, and it will cost you #b1000#k mesos.\\r\\n\"+display);\n \t\t\t\n \t\t} else if(status == 1) {\n \t\t if(cm.getMeso() < 1000) {"}, {"sha": "4db742751d41e63f1e74767cb181119130ad9d9f", "filename": "scripts/npc/1100008.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1100008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1100008.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -32,8 +32,9 @@ function action(mode, type, selection) {\n \t\t}\n \t\tstatus++;\n \t\tif (status == 0) {\n+                        var display = \"\";\n                         for(var i=0; i < menu.length; i++) {\n-                                var display = \"\\r\\n#L\"+i+\"##b Ereve (1000 mesos)#k\";\n+                                display += \"\\r\\n#L\"+i+\"##b Ereve (1000 mesos)#k\";\n                         }\t\t\t\n                         cm.sendSimple(\"This ship will head towards #bEreve#k, an island where you'll find crimson leaves soaking up the sun, the gentle breeze that glides past the stream, and the Empress of Maple Cygnus. If you're interested in joining the Cygnus Knights, Then you should definitly pay a visit here. Are you interested in visiting Ereve?, The Trip will cost you #b1000#k Mesos\\r\\n\"+display);\n "}, {"sha": "a2ed2537b1d1f9e0be85ed31079d62cdc92a15fa", "filename": "scripts/npc/1200003.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1200003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1200003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1200003.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -32,8 +32,9 @@ function action(mode, type, selection) {\n \t\t}\n \t\tstatus++;\n \t\tif (status == 0) {\n+                        var display = \"\";\n \t\t\tfor(var i=0; i < menu.length; i++) {\n-                                var display = \"\\r\\n#L\"+i+\"##b Lith Harbor (800 mesos)#k\";\n+                                display += \"\\r\\n#L\"+i+\"##b Lith Harbor (800 mesos)#k\";\n                         }\t\t\t\n                         cm.sendSimple(\"Are you trying to leave Rien? Board this ship and I'll take you from #bRien#k to #bLith Harbor#k and back. for a #bfee of 800#k Mesos. Would you like to head over to Lith Harbor now? It'll take about a minute to get there.\\r\\n\"+display);\n \t\t\t"}, {"sha": "accabbda1f2f40adb3567fd91a26bef82a732e53", "filename": "scripts/npc/1200004.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1200004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/1200004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1200004.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -32,8 +32,9 @@ function action(mode, type, selection) {\n \t\t}\n \t\tstatus++;\n \t\tif (status == 0) {\n+                        var display = \"\";\n \t\t\tfor(var i=0; i < menu.length; i++) {\n-                                var display = \"\\r\\n#L\"+i+\"##b Rien (800 mesos)#k\";\n+                                display += \"\\r\\n#L\"+i+\"##b Rien (800 mesos)#k\";\n                         }\n                         cm.sendSimple(\"Are you thinking about leaving Victoria Island and heading to our town? If you board this ship, I can take you from #bLith Harbor#k to #bRien#k and back. But you must pay a #bfee of 800#k Mesos. Would you like to go to Rien? It'll take about a minute to get there.\\r\\n\"+display);\n \t\t\t"}, {"sha": "21d68b88ef7926087b723f0b56208332cf2909fb", "filename": "scripts/npc/2030008.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2030008.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2030008.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2030008.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -101,15 +101,15 @@ function action(mode, type, selection) {\n             } else {\n                 if(cm.haveItem(4031061) && cm.haveItem(4031062)) {\n                     if(!cm.haveItem(4000082, 30)) {\n-                        cm.sendOk(\"You have completed the trials, however there still the need of #b30 #t4000082##k to forge the #t4001017#.\");\n+                        cm.sendOk(\"You have completed the trials, however there's still the need of #b30 #t4000082##k to forge the #t4001017#.\");\n                     } else {\n                         cm.completeQuest(100201);\n                         cm.gainItem(4031061, -1);\n                         cm.gainItem(4031062, -1);\n                         cm.gainItem(4000082, -30);\n \n                         cm.gainItem(4001017, 1);\n-                        cm.sendNext(\"You have completed the trials, from now on having my approval to challenge Zakum.\");\n+                        cm.sendNext(\"You #rhave completed the trials#k, from now on having my approval to challenge Zakum.\");\n                     }\n                     \n                     cm.dispose();"}, {"sha": "53aba7e94dd9644c1a1ad38d94eda3265580162d", "filename": "scripts/npc/2032002.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2032002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2032002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2032002.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -79,9 +79,9 @@ function action(mode, type, selection) {\n                     else {\n                         gotAllDocs = cm.haveItem(4001015, 30);\n                         if (!gotAllDocs) { //documents\n-                            cm.sendYesNo(\"So, you brought the fire ore with you? In that case, I can give you and your party a piece of it that should be more than enough to make the core of Zakum. Make sure your whole party has room in their inventory before proceeding.\");\n+                            cm.sendYesNo(\"So, you brought the fire ore with you? In that case, I can give to you and to each member of your party a piece of it, that should be more than enough to make the core of Zakum. Make sure your whole party has room in their inventory before proceeding.\");\n                         } else {\n-                            cm.sendYesNo(\"So, you brought the fire ore and the documents with you? In that case, I can give you and your party a piece of it that should be more than enough to make the core of Zakum. As well, since you brought the documents with you, I can also give you a special item which will #bbring you to the mine's entrance at any time#k. Make sure your whole party has room in their inventory before proceeding.\");\n+                            cm.sendYesNo(\"So, you brought the fire ore and the documents with you? In that case, I can give to you and to each member of your party a piece of it, that should be more than enough to make the core of Zakum. As well, since you #rbrought the documents#k with you, I can also provide you a special item which will #bbring you to the mine's entrance at any time#k. Make sure your whole party has room in their inventory before proceeding.\");\n                         }\n                     }\n                 } else if (selection == 2)"}, {"sha": "4be04e8533353b2b2a7fcde7f2b467156e26ee5e", "filename": "scripts/npc/2032003.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2032003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2032003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2032003.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -38,7 +38,7 @@ function action(mode, type, selection) {\n         status++;\n         \n         if (status == 0) {\n-            cm.sendNext(\"Congratulations on getting this far!  Well, I suppose I'd better give you your #bBreath of Fire#k.  You've certainly earned it!\");\n+            cm.sendNext(\"Congratulations on getting this far! Well, I suppose I'd better give you the #bBreath of Fire#k. You've certainly earned it!\");\n         } else if (status == 1) {\n             if(!cm.canHold(4031062)) {\n                 cm.sendOk(\"Try freeing a slot to receive the #b#t4031062##k.\");"}, {"sha": "24ae225110ce107a2b238115106e2aa0a9f65d29", "filename": "scripts/npc/2040021.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2040021.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/2040021.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/2040021.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -143,7 +143,7 @@ function action(mode, type, selection) {\n             cost = costSet[selectedItem];\n         }\n         //Ludi fee is -10%, array not changed unlike 2040016 and 2040020\n-        cost *= .9;\n+        cost *= 0.9;\n         var prompt = \"You want me to make a #t\" + item + \"#? In that case, I'm going to need specific items from you in order to make it. Make sure you have room in your inventory, though!#b\";\n         if(stimulator)\n             prompt += \"\\r\\n#i\"+stimID+\"# 1 #t\" + stimID + \"#\";"}, {"sha": "ac126a322c5111179eb7a66d40f06f0395a1f2b6", "filename": "scripts/npc/9000007.js", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9000007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9000007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9000007.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -0,0 +1,47 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/* Chun Ji */\n+\n+var status;\n+ \n+function start() {\n+        status = -1;\n+        action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+        if (mode == -1) {\n+                cm.dispose();\n+        } else {\n+                if (mode == 0 && type > 0) {\n+                        cm.dispose();\n+                        return;\n+                }\n+                if (mode == 1)\n+                        status++;\n+                else\n+                        status--;\n+    \n+                if(status == 0) {\n+                        cm.sendOk(\"Just a kid... Don't talk to me...\");\n+                        cm.dispose();\n+                }\n+        }\n+}"}, {"sha": "da8f052d3e997bbb77324ba1c6ee51238d1413a6", "filename": "scripts/npc/9201101.js", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9201101.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9201101.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201101.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1,9 +1,14 @@\n /**\n- *9201083 - T-1337\n+ *9201101 - T-1337\n  *@author Ronan\n  */\n  \n function start() {\n-    cm.sendOk(\"The patrol in New Leaf City is always ready. No creatures are able to break through to the city.\");\n+    if(Packages.server.MapleShopFactory.getInstance().getShop(9201101) != null) {\n+        cm.openShopNPC(9201101);\n+    } else {\n+        cm.sendOk(\"The patrol in New Leaf City is always ready. No creatures are able to break through to the city.\");\n+    }\n+    \n     cm.dispose();\n }"}, {"sha": "81d56ade5a3196ea7e76b9eb2e0ded4e2c741883", "filename": "scripts/npc/9209000.js", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9209000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/9209000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9209000.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -30,13 +30,20 @@ function action(mode, type, selection) {\n \n         if (status == 0) {\n             var greeting = \"Hello, I'm #p9209000#, the Skill & Mastery Book announcer! \";\n+            \n+            var jobrank = cm.getJob().getId() % 10;\n+            if(jobrank < 2) {\n+                cm.sendOk(greeting + \"Keep training yourself until you reach the #r4th job#k of your class. New opportunities for improvement will arrive when you reach that feat!\");\n+                cm.dispose();\n+                return;\n+            }\n+            \n             skillbook = cm.getAvailableSkillBooks();\n             masterybook = cm.getAvailableMasteryBooks();\n \n             if(skillbook.length == 0 && masterybook.length == 0) {\n-                cm.sendOk(greeting + \"There are no more books available to further improve your job skills for now. Either you #bmaxed out everything#k or #byou didn't reach the minimum requisites to use some skill books#k yet.\");\n+                cm.sendOk(greeting + \"There are no books available to further improve your job skills for now. Either you #bmaxed out everything#k or #byou didn't reach the minimum requisites to use some skill books#k yet.\");\n                 cm.dispose();\n-\n             } else if(skillbook.length > 0 && masterybook.length > 0) {\n                 var sendStr = greeting + \"New opportunities for skill improvement have been located for you to improve your skills! Pick a type to take a look onto.\\r\\n\\r\\n#b\";\n \n@@ -51,7 +58,7 @@ function action(mode, type, selection) {\n                 selected = 2;\n                 cm.sendNext(greeting + \"New opportunities for skill improvement have been located for you to improve your skills! Only skill upgrades available.\");\n             }\n-\n+            \n         } else if(status == 1) {\n             var sendStr = \"The following books are currently available:\\r\\n\\r\\n\";\n             if(selected == 0) selected = selection;"}, {"sha": "45c6b0b44369fe2f25614c6af7b95805ddac436c", "filename": "scripts/npc/commands.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/commands.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/npc/commands.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/commands.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -166,6 +166,7 @@ function writeSolaxiaCommandsLv2() {    //JrGM\n         addCommand(\"warp\", \"\");\n         addCommand(\"warpto\", \"\");\n         addCommand(\"warphere\", \"\");\n+        addCommand(\"reach\", \"\");\n         addCommand(\"gmshop\", \"\");\n         addCommand(\"heal\", \"\");\n         addCommand(\"item\", \"\");"}, {"sha": "1f9f77728757d25e53de3fe5c58dd5054c3d1a4f", "filename": "scripts/portal/Masteria_CM2_E.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/Masteria_CM2_E.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/Masteria_CM2_E.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/Masteria_CM2_E.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1,4 +1,4 @@\n-F/*\n+/*\n \tThis file is part of the OdinMS Maple Story Server\n     Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n \t\t       Matthias Butz <matze@odinms.de>"}, {"sha": "591741cd047f764a63be88331e11e7a251cf30eb", "filename": "scripts/portal/TD_MC_first.js", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/TD_MC_first.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/TD_MC_first.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/TD_MC_first.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1,15 +1,15 @@\n function enter(pi) {\n-\tif (pi.isQuestStarted(2300) || pi.isQuestCompleted(2300)\n-                        || pi.isQuestStarted(2301) || pi.isQuestCompleted(2301) \n-\t\t\t|| pi.isQuestStarted(2302) || pi.isQuestCompleted(2302) \n-\t\t\t|| pi.isQuestStarted(2303) || pi.isQuestCompleted(2303)\n-\t\t\t|| pi.isQuestStarted(2304) || pi.isQuestCompleted(2304) \n-\t\t\t|| pi.isQuestStarted(2305) || pi.isQuestCompleted(2305) \n-\t\t\t|| pi.isQuestStarted(2306) || pi.isQuestCompleted(2306)\n-\t\t\t|| pi.isQuestStarted(2307) || pi.isQuestCompleted(2307)\n-\t\t\t|| pi.isQuestStarted(2308) || pi.isQuestCompleted(2308)\n-\t\t\t|| pi.isQuestStarted(2309) || pi.isQuestCompleted(2309)\n-\t\t\t|| pi.isQuestStarted(2310) || pi.isQuestCompleted(2310)) {\n+\tif (pi.isQuestStarted(2300) || pi.isQuestCompleted(2300) ||\n+                        pi.isQuestStarted(2301) || pi.isQuestCompleted(2301) || \n+\t\t\tpi.isQuestStarted(2302) || pi.isQuestCompleted(2302) || \n+\t\t\tpi.isQuestStarted(2303) || pi.isQuestCompleted(2303) ||\n+\t\t\tpi.isQuestStarted(2304) || pi.isQuestCompleted(2304) || \n+\t\t\tpi.isQuestStarted(2305) || pi.isQuestCompleted(2305) || \n+\t\t\tpi.isQuestStarted(2306) || pi.isQuestCompleted(2306) ||\n+\t\t\tpi.isQuestStarted(2307) || pi.isQuestCompleted(2307) ||\n+\t\t\tpi.isQuestStarted(2308) || pi.isQuestCompleted(2308) ||\n+\t\t\tpi.isQuestStarted(2309) || pi.isQuestCompleted(2309) ||\n+\t\t\tpi.isQuestStarted(2310) || pi.isQuestCompleted(2310)) {\n \t\tpi.playPortalSound();\n \t\tpi.warp(106020000, 0);\n \t\treturn true;"}, {"sha": "1afbeb322cae6e1ca4d18dce5268afce95f05535", "filename": "scripts/portal/Zakum05.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/Zakum05.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/Zakum05.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/Zakum05.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -30,7 +30,7 @@ function enter(pi) {\n     }\n     \n     if (!pi.isQuestCompleted(100201)) {\n-        pi.getPlayer().dropMessage(5,\"You do not have completed all the trials yet. You may not attempt the boss right now.\");\n+        pi.getPlayer().dropMessage(5,\"You haven't completed all the trials yet. You may not attempt the boss right now.\");\n         return false;\n     }\n     "}, {"sha": "14f5f6c9c6ffec7ffef40441831890c469f0d25f", "filename": "scripts/portal/entertraining.js", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/entertraining.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/entertraining.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/entertraining.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1,13 +1,13 @@\n function enter(pi) {\n-\tif (pi.isQuestStarted(1041))\n-\t\tpi.warp(1010100, 4);\n-\telse if (pi.isQuestStarted(1042))\n-\t\tpi.warp(1010200, 4);\n-\telse if (pi.isQuestStarted(1043))\n-\t\tpi.warp(1010300, 4);\n-\telse if (pi.isQuestStarted(1044))\n+\tif (pi.isQuestStarted(1041)) {\n+\t\tpi.playPortalSound(); pi.warp(1010100, 4);\n+        } else if (pi.isQuestStarted(1042)) {\n+\t\tpi.playPortalSound(); pi.warp(1010200, 4);\n+        } else if (pi.isQuestStarted(1043)) {\n+\t\tpi.playPortalSound(); pi.warp(1010300, 4);\n+        } else if (pi.isQuestStarted(1044)) {\n \t\tpi.playPortalSound(); pi.warp(1010400, 4);\n-\telse {\n+        } else {\n \t\tpi.message(\"Only the adventurers that have been trained by Mai may enter.\");\n \t\treturn false;\n \t}"}, {"sha": "d8577d9643ef460319145a42dc2ca51fcf2734ec", "filename": "scripts/portal/hontale_Bopen.js", "status": "modified", "additions": 32, "deletions": 26, "changes": 58, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/hontale_Bopen.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/hontale_Bopen.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/hontale_Bopen.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -23,13 +23,19 @@\n  * @author Jvlaple\n  */\n function enter(pi) {\n+    var nextMap;\n+    var eim;\n+    var target;\n+    var targetPortal;\n+    var avail;\n+    \n     if (pi.getPlayer().getMapId() == 240050101) {\n-        var nextMap = 240050102;\n-        var eim = pi.getPlayer().getEventInstance()\n-        var target = eim.getMapInstance(nextMap);\n-        var targetPortal = target.getPortal(\"sp\");\n+        nextMap = 240050102;\n+        eim = pi.getPlayer().getEventInstance();\n+        target = eim.getMapInstance(nextMap);\n+        targetPortal = target.getPortal(\"sp\");\n         // only let people through if the eim is ready\n-        var avail = eim.getProperty(\"1stageclear\");\n+        avail = eim.getProperty(\"1stageclear\");\n         if (avail == null) {\n             // do nothing; send message to player\n             pi.getPlayer().dropMessage(6, \"Horntail\\'s Seal is Blocking this Door.\");\n@@ -40,12 +46,12 @@ function enter(pi) {\n         }\n     }\n     else if (pi.getPlayer().getMapId() == 240050102) {\n-        var nextMap = 240050103;\n-        var eim = pi.getPlayer().getEventInstance()\n-        var target = eim.getMapInstance(nextMap);\n-        var targetPortal = target.getPortal(\"sp\");\n+        nextMap = 240050103;\n+        eim = pi.getPlayer().getEventInstance();\n+        target = eim.getMapInstance(nextMap);\n+        targetPortal = target.getPortal(\"sp\");\n         // only let people through if the eim is ready\n-        var avail = eim.getProperty(\"2stageclear\");\n+        avail = eim.getProperty(\"2stageclear\");\n         if (avail == null) {\n             // do nothing; send message to player\n             pi.getPlayer().dropMessage(6, \"Horntail\\'s Seal is Blocking this Door.\");\n@@ -56,12 +62,12 @@ function enter(pi) {\n         }\n     }\n     else if (pi.getPlayer().getMapId() == 240050103) {\n-        var nextMap = 240050104;\n-        var eim = pi.getPlayer().getEventInstance()\n-        var target = eim.getMapInstance(nextMap);\n-        var targetPortal = target.getPortal(\"sp\");\n+        nextMap = 240050104;\n+        eim = pi.getPlayer().getEventInstance();\n+        target = eim.getMapInstance(nextMap);\n+        targetPortal = target.getPortal(\"sp\");\n         // only let people through if the eim is ready\n-        var avail = eim.getProperty(\"3stageclear\");\n+        avail = eim.getProperty(\"3stageclear\");\n         if (avail == null) {\n             // do nothing; send message to player\n             pi.getPlayer().dropMessage(6, \"Horntail\\'s Seal is Blocking this Door.\");\n@@ -72,12 +78,12 @@ function enter(pi) {\n         }\n     }\n     else if (pi.getPlayer().getMapId() == 240050104) {\n-        var nextMap = 240050105;\n-        var eim = pi.getPlayer().getEventInstance()\n-        var target = eim.getMapInstance(nextMap);\n-        var targetPortal = target.getPortal(\"sp\");\n+        nextMap = 240050105;\n+        eim = pi.getPlayer().getEventInstance();\n+        target = eim.getMapInstance(nextMap);\n+        targetPortal = target.getPortal(\"sp\");\n         // only let people through if the eim is ready\n-        var avail = eim.getProperty(\"4stageclear\");\n+        avail = eim.getProperty(\"4stageclear\");\n         if (avail == null) {\n             // do nothing; send message to player\n             pi.getPlayer().dropMessage(6, \"Horntail\\'s Seal is Blocking this Door.\");\n@@ -88,15 +94,15 @@ function enter(pi) {\n         }\n     }\n     else if (pi.getPlayer().getMapId() == 240050105) {\n-        var nextMap = 240050100;\n-        var eim = pi.getPlayer().getEventInstance()\n-        var target = eim.getMapInstance(nextMap);\n-        var targetPortal = target.getPortal(\"st00\");\n+        nextMap = 240050100;\n+        eim = pi.getPlayer().getEventInstance();\n+        target = eim.getMapInstance(nextMap);\n+        targetPortal = target.getPortal(\"st00\");\n         \n-        var avail = eim.getProperty(\"5stageclear\");\n+        avail = eim.getProperty(\"5stageclear\");\n         if (avail == null) {\n             if (pi.haveItem(4001092) && pi.isEventLeader()) {\n-                pi.getEventInstance().showClearEffect();\n+                eim.showClearEffect();\n                 pi.getPlayer().dropMessage(6, \"The leader's key break the seal for a flash...\");\n                 pi.getPlayer().changeMap(target, targetPortal);\n                 eim.setIntProperty(\"5stageclear\", 1);"}, {"sha": "961cef852fffe914f1dc704f3f4d189207406a60", "filename": "scripts/portal/lpq5.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/lpq5.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/lpq5.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/lpq5.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -26,7 +26,7 @@ LudiPQ - 1 - 2 Portal\n \n function enter(pi) {\n \tvar nextMap = 922010700;\n-\tvar eim = pi.getPlayer().getEventInstance()\n+\tvar eim = pi.getPlayer().getEventInstance();\n \tvar target = eim.getMapInstance(nextMap);\n \tvar targetPortal = target.getPortal(\"st00\");\n \t// only let people through if the eim is ready"}, {"sha": "5532f8eef0efaecc06ce689d68808da0c84b54a0", "filename": "scripts/portal/out_pepeking.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/out_pepeking.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/portal/out_pepeking.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/out_pepeking.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -8,7 +8,7 @@ function enter(pi) {\n \tvar questProgress = pi.getQuestProgress(2330, 3300005) + pi.getQuestProgress(2330, 3300006) + pi.getQuestProgress(2330, 3300007); //3 Yetis\n  \tif(questProgress == 3 && !pi.hasItem(4032388)) {\n  \t\tif(pi.canHold(4032388)){\n- \t\t\tpi.getPlayer().message(\"You have aquired a key to the Wedding Hall. King Pepe must have dropped it.\")\n+ \t\t\tpi.getPlayer().message(\"You have aquired a key to the Wedding Hall. King Pepe must have dropped it.\");\n  \t\t\tpi.gainItem(4032388, 1);\n  \n  \t\t\tpi.playPortalSound();"}, {"sha": "8a61e7fe35c5898c4f712d200047085e7f4b4ea6", "filename": "scripts/reactor/2110000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/reactor/2110000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/reactor/2110000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2110000.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -26,6 +26,6 @@\n */\n \n function act(){\n-    rm.playerMessage(5, \"An unknown force has returned you to the starting point.\");\n+    rm.playerMessage(5, \"An unknown force has moved you to the starting point.\");\n     rm.warp(280010000, 0);\n }\n\\ No newline at end of file"}, {"sha": "7e8b4f3335f177d7c7cc0128c4dfb6a246269adf", "filename": "scripts/reactor/2602000.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/reactor/2602000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/scripts/reactor/2602000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2602000.js?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2612004.js - Queen's treasure room\n+ *@author Ronan\n+ */\n+ \n+function act() {\n+\trm.dropItems();\n+}\n\\ No newline at end of file"}, {"sha": "c8b218ffa27c16821e520a3583765ef0736bdd70", "filename": "sql/db_drops.sql", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -20021,7 +20021,10 @@ USE `heavenms`;\n (1110100, 4032379, 1, 1, 2409, 40000),\n (1210100, 4032379, 1, 1, 2409, 40000),\n (2130100, 4001344, 1, 1, 0, 7000),\n-(7220002, 4031789, 1, 1, 3844, 999999);\n+(7220002, 4031789, 1, 1, 3844, 999999),\n+(9300102, 4031507, 1, 1, 6002, 999999),\n+(9300061, 4001101, 1, 1, 0, 999999),\n+(9300093, 4031495, 1, 1, 6192, 999999);\n \n # (dropperid, itemid, minqty, maxqty, questid, chance)\n \n@@ -20115,7 +20118,7 @@ USE `heavenms`;\n (8190003, 2280013, 1, 1, 0, 1000),\n (9400121, 2280014, 1, 1, 0, 40000),\n (8200001, 2280015, 1, 1, 0, 1000),\n-(8190001, 2280016, 1, 1, 0, 1000),\n+(8190000, 2280016, 1, 1, 0, 1000),\n (8200011, 2290001, 1, 1, 0, 1000),\n (8150300, 2290003, 1, 1, 0, 1000),\n (8200000, 2290005, 1, 1, 0, 1000),\n@@ -20153,7 +20156,7 @@ USE `heavenms`;\n (8190004, 2290071, 1, 1, 0, 1000),\n (8190004, 2290073, 1, 1, 0, 1000),\n (9400582, 2290074, 1, 1, 0, 1000),\n-(8190001, 2290075, 1, 1, 0, 1000),\n+(8190000, 2290075, 1, 1, 0, 1000),\n (9400582, 2290079, 1, 1, 0, 1000),\n (9400580, 2290083, 1, 1, 0, 1000),\n (8150302, 2290085, 1, 1, 0, 1000),\n@@ -20164,7 +20167,7 @@ USE `heavenms`;\n (8200005, 2290095, 1, 1, 0, 1000),\n (8150302, 2290096, 1, 1, 0, 1000),\n (8200003, 2290101, 1, 1, 0, 1000),\n-(8190001, 2290103, 1, 1, 0, 1000),\n+(9400121, 2290103, 1, 1, 0, 40000),\n (8150301, 2290107, 1, 1, 0, 1000),\n (9420513, 2290108, 1, 1, 0, 40000),\n (8150300, 2290111, 1, 1, 0, 1000),\n@@ -20233,6 +20236,14 @@ USE `heavenms`;\n   DELETE FROM temp_data WHERE dropperid=9300090;\n   DELETE FROM temp_data WHERE dropperid=9420501;\n \n+  # normalize item drops for left-side Pianus\n+  DELETE FROM temp_data WHERE dropperid=8520000;\n+\n+  INSERT INTO temp_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`)\n+  SELECT  8520000, temp_data.itemid, temp_data.minimum_quantity, temp_data.maximum_quantity, temp_data.questid, temp_data.chance\n+  FROM    temp_data\n+  WHERE   temp_data.dropperid = 8510000;\n+\n   # delete/normalize item drops from clones of Pink Bean\n   DELETE FROM temp_data WHERE dropperid=8820000;\n   DELETE FROM temp_data WHERE dropperid>=8820010 AND dropperid<=8820014;\n@@ -20396,6 +20407,9 @@ USE `heavenms`;\n   DELETE FROM drop_data WHERE dropperid = 9500100;\n   DELETE FROM drop_data where dropperid >= 9300141 AND dropperid <= 9300154 AND (itemid < 4001130 OR itemid >= 4001136);\n \n+  # remove drop data from mobs which respawns as other mobs\n+  DELETE FROM drop_data WHERE dropperid = 8190001;\n+\n   # remove key of dimension dropping outside PQ\n   DELETE FROM drop_data WHERE itemid=4001023 AND dropperid!=9300012;\n \n@@ -21873,7 +21887,6 @@ USE `heavenms`;\n (8150300, 0, 666, 986, 0, 400000),\n (8150301, 0, 730, 1070, 0, 400000),\n (8150302, 0, 764, 1115, 0, 400000),\n-(8190001, 0, 800, 1162, 0, 400000),\n (8220003, 0, 3381, 15830, 0, 400000),\n (8220005, 0, 4350, 19860, 0, 400000),\n (8220006, 0, 5466, 24400, 0, 400000),"}, {"sha": "22de23d3ef50b9bdb92276cb9b72f55a6aee4c10", "filename": "sql/db_shopupdate.sql", "status": "modified", "additions": 99, "deletions": 78, "changes": 177, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/sql/db_shopupdate.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/sql/db_shopupdate.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_shopupdate.sql?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -3,13 +3,14 @@\n \n USE `heavenms`;\n \n-# Scroll shop at Spindle, chair shop at Kino Konoko\n+# Scroll shop at Spindle, chair shop at Kino Konoko, potion shop at T-1337\n INSERT INTO `shops` (`shopid`,`npcid`) VALUES\n (9110002,9110002),\n-(9201082,9201082);\n+(9201082,9201082),\n+(9201101,9201101);\n \n INSERT IGNORE INTO `shopitems` (`shopid`, `itemid`, `price`, `pitch`, `position`) VALUES\n-(9201082, 2040004, 500000, 0, 1),\n+(9201082, 2040004, 480000, 0, 1),\n (9201082, 2040025, 500000, 0, 2),\n (9201082, 2040029, 500000, 0, 3),\n (9201082, 2040017, 500000, 0, 4),\n@@ -25,81 +26,83 @@ INSERT IGNORE INTO `shopitems` (`shopid`, `itemid`, `price`, `pitch`, `position`\n (9201082, 2040613, 400000, 0, 14),\n (9201082, 2040701, 450000, 0, 15),\n (9201082, 2040704, 450000, 0, 16),\n-(9201082, 2040804, 550000, 0, 17),\n-(9201082, 2040817, 550000, 0, 18),\n-(9201082, 2040914, 300000, 0, 19),\n-(9201082, 2040919, 300000, 0, 20),\n-(9201082, 2041007, 300000, 0, 21),\n-(9201082, 2041010, 300000, 0, 22),\n-(9201082, 2041013, 300000, 0, 23),\n-(9201082, 2041016, 300000, 0, 24),\n-(9201082, 2041019, 300000, 0, 25),\n-(9201082, 2041022, 300000, 0, 26),\n-(9201082, 2044901, 520000, 0, 27),\n-(9201082, 2044701, 520000, 0, 28),\n-(9201082, 2043001, 520000, 0, 29),\n-(9201082, 2043801, 520000, 0, 30),\n-(9201082, 2044601, 520000, 0, 31),\n-(9201082, 2040727, 50000, 0, 32),\n-(9201082, 2041058, 50000, 0, 33),\n-(9201082, 2040807, 1000000, 0, 34),\n-(9201082, 2040005, 15000, 0, 35),\n-(9201082, 2040026, 15000, 0, 36),\n-(9201082, 2040031, 15000, 0, 37),\n-(9201082, 2040016, 15000, 0, 38),\n-(9201082, 2040302, 25000, 0, 39),\n-(9201082, 2040318, 25000, 0, 40),\n-(9201082, 2040323, 25000, 0, 41),\n-(9201082, 2040412, 20000, 0, 42),\n-(9201082, 2040419, 20000, 0, 43),\n-(9201082, 2040502, 25000, 0, 44),\n-(9201082, 2040514, 25000, 0, 45),\n-(9201082, 2040517, 25000, 0, 46),\n-(9201082, 2040534, 25000, 0, 47),\n-(9201082, 2040612, 20000, 0, 48),\n-(9201082, 2040702, 20000, 0, 49),\n-(9201082, 2040705, 25000, 0, 50),\n-(9201082, 2040805, 100000, 0, 51),\n-(9201082, 2040816, 100000, 0, 52),\n-(9201082, 2040915, 55000, 0, 53),\n-(9201082, 2040920, 55000, 0, 54),\n-(9201082, 2041008, 55000, 0, 55),\n-(9201082, 2041011, 55000, 0, 56),\n-(9201082, 2041014, 30000, 0, 57),\n-(9201082, 2041017, 30000, 0, 58),\n-(9201082, 2041020, 30000, 0, 59),\n-(9201082, 2041023, 30000, 0, 60),\n-(9201082, 2044902, 50000, 0, 61),\n-(9201082, 2044702, 50000, 0, 62),\n-(9201082, 2043002, 50000, 0, 63),\n-(9201082, 2043802, 50000, 0, 64),\n-(9201082, 2044602, 50000, 0, 65),\n-(9201082, 2049200, 170000, 0, 66),\n-(9201082, 2049201, 220000, 0, 67),\n-(9201082, 2049202, 170000, 0, 68),\n-(9201082, 2049203, 220000, 0, 69),\n-(9201082, 2049204, 170000, 0, 70),\n-(9201082, 2049205, 220000, 0, 71),\n-(9201082, 2049206, 170000, 0, 72),\n-(9201082, 2049207, 220000, 0, 73),\n-(9201082, 2049208, 140000, 0, 74),\n-(9201082, 2049209, 170000, 0, 75),\n-(9201082, 2049210, 140000, 0, 76),\n-(9201082, 2049211, 170000, 0, 77),\n-(9201082, 2040101, 540000, 0, 78),\n-(9201082, 2040100, 700000, 0, 79),\n-(9201082, 2040106, 540000, 0, 80),\n-(9201082, 2040105, 700000, 0, 81),\n-(9201082, 2040201, 540000, 0, 82),\n-(9201082, 2040200, 700000, 0, 83),\n-(9201082, 2040206, 540000, 0, 84),\n-(9201082, 2040205, 700000, 0, 85),\n-(9201082, 2070016, 120000000, 0, 86),\n-(9201082, 2070018, 190000000, 0, 87),\n-(9201082, 2030007, 1800000, 0, 88),\n-(9201082, 4001017, 60000000, 0, 89);\n+(9201082, 2040707, 450000, 0, 17),\n+(9201082, 2040804, 550000, 0, 18),\n+(9201082, 2040817, 550000, 0, 19),\n+(9201082, 2040914, 480000, 0, 20),\n+(9201082, 2040919, 480000, 0, 21),\n+(9201082, 2041007, 470000, 0, 22),\n+(9201082, 2041010, 470000, 0, 23),\n+(9201082, 2041013, 500000, 0, 24),\n+(9201082, 2041016, 500000, 0, 25),\n+(9201082, 2041019, 500000, 0, 26),\n+(9201082, 2041022, 500000, 0, 27),\n+(9201082, 2044901, 520000, 0, 28),\n+(9201082, 2044701, 520000, 0, 29),\n+(9201082, 2043001, 520000, 0, 30),\n+(9201082, 2043801, 520000, 0, 31),\n+(9201082, 2044601, 520000, 0, 32),\n+(9201082, 2040727, 50000, 0, 33),\n+(9201082, 2041058, 50000, 0, 34),\n+(9201082, 2040807, 1000000, 0, 35),\n+(9201082, 2040005, 22000, 0, 36),\n+(9201082, 2040026, 23000, 0, 37),\n+(9201082, 2040031, 23000, 0, 38),\n+(9201082, 2040016, 23000, 0, 39),\n+(9201082, 2040302, 25000, 0, 40),\n+(9201082, 2040318, 25000, 0, 41),\n+(9201082, 2040323, 25000, 0, 42),\n+(9201082, 2040412, 20000, 0, 43),\n+(9201082, 2040419, 20000, 0, 44),\n+(9201082, 2040502, 25000, 0, 45),\n+(9201082, 2040514, 25000, 0, 46),\n+(9201082, 2040517, 25000, 0, 47),\n+(9201082, 2040534, 25000, 0, 48),\n+(9201082, 2040612, 20000, 0, 49),\n+(9201082, 2040702, 20000, 0, 50),\n+(9201082, 2040705, 25000, 0, 51),\n+(9201082, 2040708, 20000, 0, 52),\n+(9201082, 2040805, 100000, 0, 53),\n+(9201082, 2040816, 100000, 0, 54),\n+(9201082, 2040915, 55000, 0, 55),\n+(9201082, 2040920, 55000, 0, 56),\n+(9201082, 2041008, 38000, 0, 57),\n+(9201082, 2041011, 38000, 0, 58),\n+(9201082, 2041014, 40000, 0, 59),\n+(9201082, 2041017, 40000, 0, 60),\n+(9201082, 2041020, 40000, 0, 61),\n+(9201082, 2041023, 40000, 0, 62),\n+(9201082, 2044902, 50000, 0, 63),\n+(9201082, 2044702, 50000, 0, 64),\n+(9201082, 2043002, 50000, 0, 65),\n+(9201082, 2043802, 50000, 0, 66),\n+(9201082, 2044602, 50000, 0, 67),\n+(9201082, 2049200, 170000, 0, 68),\n+(9201082, 2049201, 220000, 0, 69),\n+(9201082, 2049202, 170000, 0, 70),\n+(9201082, 2049203, 220000, 0, 71),\n+(9201082, 2049204, 170000, 0, 72),\n+(9201082, 2049205, 220000, 0, 73),\n+(9201082, 2049206, 170000, 0, 74),\n+(9201082, 2049207, 220000, 0, 75),\n+(9201082, 2049208, 140000, 0, 76),\n+(9201082, 2049209, 170000, 0, 77),\n+(9201082, 2049210, 140000, 0, 78),\n+(9201082, 2049211, 170000, 0, 79),\n+(9201082, 2040101, 540000, 0, 80),\n+(9201082, 2040100, 700000, 0, 81),\n+(9201082, 2040106, 540000, 0, 82),\n+(9201082, 2040105, 700000, 0, 83),\n+(9201082, 2040201, 540000, 0, 84),\n+(9201082, 2040200, 700000, 0, 85),\n+(9201082, 2040206, 540000, 0, 86),\n+(9201082, 2040205, 700000, 0, 87),\n+(9201082, 2070016, 120000000, 0, 88),\n+(9201082, 2070018, 190000000, 0, 89),\n+(9201082, 2030007, 1800000, 0, 90),\n+(9201082, 4001017, 60000000, 0, 91);\n \n-UPDATE shopitems SET price = 11*price WHERE (`position` >= 32 and `position` <= 77 and `shopid` = 9201082);\n+UPDATE shopitems SET price = 11*price WHERE (`position` >= 33 and `position` <= 79 and `shopid` = 9201082);\n \n INSERT IGNORE INTO `shopitems` (`shopid`, `itemid`, `price`, `pitch`, `position`) VALUES\n (1031100, 3010015, 20000, 0, 100),\n@@ -108,7 +111,25 @@ INSERT IGNORE INTO `shopitems` (`shopid`, `itemid`, `price`, `pitch`, `position`\n (9110002, 3010007, 10000000, 0, 100),\n (9201020, 3010009, 4200000, 0, 96),\n (9201020, 3010014, 7000000, 0, 100),\n-(1081000, 3010013, 4000000, 0, 100);\n+(1081000, 3010013, 4000000, 0, 100),\n+(9201101, 2022338, 2100000, 0, 100),\n+(9201101, 2022339, 2800000, 0, 104),\n+(9201101, 2022340, 4000000, 0, 108),\n+(9201101, 2022341, 2800000, 0, 112),\n+(9201101, 2022342, 2000000, 0, 116),\n+(9201101, 2022343, 4700000, 0, 120),\n+(9201101, 2022344, 5000000, 0, 124),\n+(9201101, 2022345, 4000000, 0, 128),\n+(9201101, 2002028, 5000000, 0, 132),\n+(9201101, 2022544, 100000, 0, 136),\n+(9201101, 2022545, 4400000, 0, 140),\n+(9201101, 2020027, 2100000, 0, 144),\n+(9201101, 2022113, 1800000, 0, 148),\n+(9201101, 2022121, 12000000, 0, 152),\n+(9201101, 2022123, 12000000, 0, 156),\n+(9201101, 2022277, 5300000, 0, 160),\n+(9201101, 2012008, 4200000, 0, 164),\n+(9201101, 2022251, 3800000, 0, 168);\n \n # adding antibanish scrolls\n INSERT IGNORE INTO `shopitems` (`shopid`, `itemid`, `price`, `pitch`, `position`) VALUES"}, {"sha": "f18cb0b16c17f108c5aba636985152eb09deb0f9", "filename": "src/client/command/Commands.java", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/client/command/Commands.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/client/command/Commands.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/Commands.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -1120,6 +1120,25 @@ else if (type.equals(\"cash\")) {\n \t\t\t\tplayer.dropMessage(\"Unknown player.\");\n \t\t\t}\n                     break;\n+                    \n+                case \"reach\":\n+                        if (sub.length < 2){\n+                                player.yellowMessage(\"Syntax: !reach <playername>\");\n+                                break;\n+                        }\n+                        \n+                        victim = c.getWorldServer().getPlayerStorage().getCharacterByName(sub[1]);\n+                        if(victim != null && victim.isLoggedin()) {\n+                                if (player.getClient().getChannel() != victim.getClient().getChannel()) {\n+                                        player.dropMessage(\"Player '\" + victim.getName() + \"' is at channel \" + victim.getClient().getChannel() + \".\");\n+                                } else {\n+                                        MapleMap map = victim.getMap();\n+                                        player.changeMap(map, map.findClosestPortal(victim.getPosition()));\n+                                }\n+                        } else {\n+                                player.dropMessage(\"Unknown player.\");\n+                        }\n+                    break;\n                 \n                 case \"gmshop\":\n \t\t\tMapleShopFactory.getInstance().getShop(1337).sendShop(c);"}, {"sha": "c0d5496036bbfa323e178cf7c29e00c17f6ce401", "filename": "src/net/server/channel/handlers/AbstractDealDamageHandler.java", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/AbstractDealDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/AbstractDealDamageHandler.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -295,21 +295,24 @@ public void run() {\n                     } else if (attack.skill == Bandit.STEAL) {                    \t\n                         Skill steal = SkillFactory.getSkill(Bandit.STEAL);\n                         if (monster.getStolen().size() < 1) { // One steal per mob <3\n-                            if (Math.random() < 0.3 && steal.getEffect(player.getSkillLevel(steal)).makeChanceResult()) { //Else it drops too many cool stuff :(\n-                                List<MonsterDropEntry> toSteals = MapleMonsterInformationProvider.getInstance().retrieveDrop(monster.getId());\n-                                Collections.shuffle(toSteals);\n-                                int toSteal = toSteals.get(rand(0, (toSteals.size() - 1))).itemId;\n-                                MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-                                Item item;\n-                                if (ItemConstants.getInventoryType(toSteal).equals(MapleInventoryType.EQUIP)) {\n-                                    item = ii.randomizeStats((Equip) ii.getEquipById(toSteal));\n-                                } else {\n-                                    item = new Item(toSteal, (byte) 0, (short) 1, -1);\n+                            if (steal.getEffect(player.getSkillLevel(steal)).makeChanceResult()) {\n+                                MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n+                                \n+                                List<Integer> dropPool = mi.retrieveDropPool(monster.getId());\n+                                if(!dropPool.isEmpty()) {\n+                                    Integer rndPool = (int) Math.floor(Math.random() * dropPool.get(dropPool.size() - 1));\n+                                    \n+                                    int i = 0;\n+                                    while(rndPool >= dropPool.get(i)) i++;\n+                                    \n+                                    List<MonsterDropEntry> toSteal = new ArrayList<>();\n+                                    toSteal.add(mi.retrieveDrop(monster.getId()).get(i));\n+                                    \n+                                    player.getMap().dropItemsFromMonster(toSteal, player, monster);\n+                                    monster.addStolen(toSteal.get(0).itemId);\n                                 }\n-                                player.getMap().spawnItemDrop(monster, player, item, monster.getPosition(), false, false);\n-                                monster.addStolen(toSteal);\n                             }\n-                        }                        \n+                        }\n                     } else if (attack.skill == FPArchMage.FIRE_DEMON) {\n                         monster.setTempEffectiveness(Element.ICE, ElementalEffectiveness.WEAK, SkillFactory.getSkill(FPArchMage.FIRE_DEMON).getEffect(player.getSkillLevel(SkillFactory.getSkill(FPArchMage.FIRE_DEMON))).getDuration() * 1000);\n                     } else if (attack.skill == ILArchMage.ICE_DEMON) {"}, {"sha": "8d43442d3138a316de675c0a3cb83eb5504e6616", "filename": "src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/MobDamageMobFriendlyHandler.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -35,6 +35,7 @@\n  */\n \n public final class MobDamageMobFriendlyHandler extends AbstractMaplePacketHandler {\n+        @Override\n \tpublic final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n \t\tint attacker = slea.readInt();\n \t\tslea.readInt();\n@@ -66,12 +67,12 @@ else if(monster.getId() == 9300138) {   //romeo\n                         }\n                         \n                         c.getPlayer().getMap().killFriendlies(monster);\n+                } else {\n+                        if (monster.getId() == 9300061) {\n+                                MapleMap map = c.getPlayer().getEventInstance().getMapInstance(monster.getMap().getId());\n+                                map.addBunnyHit();\n+                        }\n                 }\n-                \n-\t\tif (monster.getId() == 9300061) {\n-                        MapleMap map = c.getPlayer().getEventInstance().getMapInstance(monster.getMap().getId());\n-\t\t\tmap.addBunnyHit();\n-\t\t}\n \n \t\tc.getPlayer().getMap().broadcastMessage(MaplePacketCreator.MobDamageMobFriendly(monster, damage), monster.getPosition());\n \t\tc.announce(MaplePacketCreator.enableActions());"}, {"sha": "93b4cfdc265e0a75b949d10de61fd5b852d64d2e", "filename": "src/net/server/channel/handlers/PetAutoPotHandler.java", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/PetAutoPotHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/net/server/channel/handlers/PetAutoPotHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetAutoPotHandler.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -49,6 +49,10 @@\n     boolean hasMpGain;\n     short maxHp;\n     short maxMp;\n+    short incHp;\n+    short incMp;\n+    int curHp;\n+    int curMp;\n     \n     @Override\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n@@ -91,14 +95,27 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             maxHp = maxHpMp.left;\n             maxMp = maxHpMp.right;\n             \n+            incHp = stat.getHp();\n+            if(incHp <= 0 && hasHpGain) incHp = (short)((maxHp * stat.getHpRate()) / 100.0);\n+            \n+            incMp = stat.getMp();\n+            if(incMp <= 0 && hasMpGain) incMp = (short)((maxMp * stat.getMpRate()) / 100.0);\n+            \n+            curHp = chr.getHp();\n+            curMp = chr.getMp();\n+            \n+            //System.out.println(\"\\n-------------------\\n\");\n             while(true) {\n                 do {\n                     MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, slot, (short) 1, false);\n                     stat.applyTo(chr);\n+                    \n+                    curHp += incHp;\n+                    curMp += incMp;\n \n                     //System.out.println();\n-                    //System.out.println(\"hp: \" + hasHpGain + \" player hp \" + chr.getHp() + \" maxhp \" + maxHp);\n-                    //System.out.println(\"mp: \" + hasMpGain + \" player mp \" + chr.getMp() + \" maxmp \" + maxMp);\n+                    //System.out.println(\"hp: \" + hasHpGain + \" player hp \" + curHp + \" maxhp \" + maxHp);\n+                    //System.out.println(\"mp: \" + hasMpGain + \" player mp \" + curMp + \" maxmp \" + maxMp);\n                     //System.out.println(\"redo? \" + (shouldReusePot(chr) && toUse.getQuantity() > 0));\n                 } while(shouldReusePot(chr) && toUse.getQuantity() > 0);\n \n@@ -154,6 +171,6 @@ private boolean cursorOnNextAvailablePot(MapleCharacter chr) {\n     }\n     \n     private boolean shouldReusePot(MapleCharacter chr) {\n-        return (hasHpGain && chr.getHp() < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (hasMpGain && chr.getMp() < ServerConstants.PET_AUTOMP_RATIO * maxMp);\n+        return (hasHpGain && curHp < ServerConstants.PET_AUTOHP_RATIO * maxHp) || (hasMpGain && curMp < ServerConstants.PET_AUTOMP_RATIO * maxMp);\n     } \n }"}, {"sha": "9fd6997bbdb87466eb6c275bda436e2319a2a4ae", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -111,6 +111,7 @@\n     protected List<Pair<Integer, String>> itemNameCache = new ArrayList<>();\n     protected Map<Integer, Boolean> consumeOnPickupCache = new HashMap<>();\n     protected Map<Integer, Boolean> isQuestItemCache = new HashMap<>();\n+    protected Map<Integer, Boolean> isPartyQuestItemCache = new HashMap<>();\n     protected Map<Integer, String> equipmentSlotCache = new HashMap<>();\n     protected Map<Integer, Boolean> noCancelMouseCache = new HashMap<>();\n     protected Map<Integer, Integer> mobCrystalMakerCache = new HashMap<>();\n@@ -129,6 +130,9 @@ private MapleItemInformationProvider() {\n         etcStringData = stringData.getData(\"Etc.img\");\n         insStringData = stringData.getData(\"Ins.img\");\n         petStringData = stringData.getData(\"Pet.img\");\n+        \n+        isQuestItemCache.put(0, false);\n+        isPartyQuestItemCache.put(0, false);\n     }\n \n     public static MapleItemInformationProvider getInstance() {\n@@ -1231,6 +1235,16 @@ public boolean isQuestItem(int itemId) {\n         isQuestItemCache.put(itemId, questItem);\n         return questItem;\n     }\n+    \n+    public boolean isPartyQuestItem(int itemId) {\n+        if (isPartyQuestItemCache.containsKey(itemId)) {\n+            return isPartyQuestItemCache.get(itemId);\n+        }\n+        MapleData data = getItemData(itemId);\n+        boolean partyquestItem = (data != null && MapleDataTool.getIntConvert(\"info/pquest\", data, 0) == 1);\n+        isPartyQuestItemCache.put(itemId, partyquestItem);\n+        return partyquestItem;\n+    }\n \n     public int getQuestIdFromItem(int itemId) {\n         MapleData data = getItemData(itemId);"}, {"sha": "450b00e56abde4f61b594ddd6c6fe6ce0b3941db", "filename": "src/server/expeditions/MapleExpedition.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/expeditions/MapleExpedition.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/expeditions/MapleExpedition.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpedition.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -96,7 +96,8 @@ public MapleExpedition(MapleCharacter player, MapleExpeditionType met) {\n \tprivate void beginRegistration() {\n \t\tregistering = true;\n                 leader.announce(MaplePacketCreator.getClock(type.getRegistrationTime() * 60));\n-\t\tstartMap.broadcastMessage(MaplePacketCreator.serverNotice(6, \"[Expedition] \" + leader.getName() + \" has been declared the expedition captain. Please register for the expedition.\"));\n+\t\tstartMap.broadcastMessage(leader, MaplePacketCreator.serverNotice(6, \"[Expedition] \" + leader.getName() + \" has been declared the expedition captain. Please register for the expedition.\"), false);\n+                leader.announce(MaplePacketCreator.serverNotice(6, \"[Expedition] You have become the expedition captain. Gather enough people for your team then talk to the NPC to start.\"));\n \t\tscheduleRegistrationEnd();\n \t}\n "}, {"sha": "eb0bdcbc6ef210cf4341dd907b42ba474236b756", "filename": "src/server/life/MapleMonsterInformationProvider.java", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/life/MapleMonsterInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/life/MapleMonsterInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterInformationProvider.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -34,6 +34,7 @@\n import provider.MapleDataProvider;\n import provider.MapleDataProviderFactory;\n import provider.MapleDataTool;\n+import server.MapleItemInformationProvider;\n import tools.DatabaseConnection;\n import tools.Pair;\n \n@@ -43,6 +44,8 @@\n \tprivate static final MapleMonsterInformationProvider instance = new MapleMonsterInformationProvider();\n \tprivate final Map<Integer, List<MonsterDropEntry>> drops = new HashMap<>();\n \tprivate final List<MonsterGlobalDropEntry> globaldrops = new ArrayList<>();\n+        \n+        private final Map<Integer, List<Integer>> dropsChancePool = new HashMap<>();    // thanks to ronan\n \n \tprotected MapleMonsterInformationProvider() {\n \t\tretrieveGlobal();\n@@ -148,6 +151,31 @@ private void retrieveGlobal() {\n \t\tdrops.put(monsterId, ret);\n \t\treturn ret;\n \t}\n+        \n+        public final List<Integer> retrieveDropPool(final int monsterId) {  // ignores Quest and Party Quest items\n+\t\tif (dropsChancePool.containsKey(monsterId)) {\n+\t\t\treturn dropsChancePool.get(monsterId);\n+\t\t}\n+                \n+                MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+                \n+                List<MonsterDropEntry> dropList = retrieveDrop(monsterId);\n+\t\tList<Integer> ret = new ArrayList<>();\n+                \n+                int accProp = 0;\n+                for(MonsterDropEntry mde : dropList) {\n+                        if(!ii.isQuestItem(mde.itemId) && !ii.isPartyQuestItem(mde.itemId)) {\n+                                accProp += mde.chance;\n+                        }\n+\n+                        ret.add(accProp);\n+                }\n+                \n+\t\tif(accProp == 0) ret.clear();    // don't accept mobs dropping no relevant items\n+                \n+                dropsChancePool.put(monsterId, ret);\n+\t\treturn ret;\n+\t}\n \n \tpublic static ArrayList<Pair<Integer, String>> getMobsIDsFromName(String search)\n \t{\n@@ -206,6 +234,7 @@ public static String getMobNameFromID(int id)\n \n \tpublic final void clearDrops() {\n \t\tdrops.clear();\n+                dropsChancePool.clear();\n \t\tglobaldrops.clear();\n \t\tretrieveGlobal();\n \t}"}, {"sha": "ad92746ffc80038f99097a4839595142ab441340", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 36, "deletions": 11, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -583,7 +583,7 @@ private byte dropItemsFromMonsterOnMap(List<MonsterDropEntry> dropEntry, Point p\n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n         \n         for (final MonsterDropEntry de : dropEntry) {\n-            if (Randomizer.nextInt(999999) < de.chance * chRate) {\n+            if (Randomizer.nextInt(999999) < (long) de.chance * chRate) {\n                 if (droptype == 3) {\n                     pos.x = (int) (mobpos + (d % 2 == 0 ? (40 * (d + 1) / 2) : -(40 * (d / 2))));\n                 } else {\n@@ -644,7 +644,7 @@ private byte dropGlobalItemsFromMonsterOnMap(List<MonsterGlobalDropEntry> global\n         return d;\n     }\n     \n-    private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob) {\n+    private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob, final boolean useBaseRate) {\n         if (mob.dropsDisabled() || !dropsOn) {\n             return;\n         }\n@@ -658,6 +658,8 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob) {\n         if (stati != null) {\n             chRate *= (stati.getStati().get(MonsterStatus.SHOWDOWN).doubleValue() / 100.0 + 1.0);\n         }\n+        \n+        if(useBaseRate) chRate = 1;\n \n         final MapleMonsterInformationProvider mi = MapleMonsterInformationProvider.getInstance();\n         \n@@ -676,6 +678,24 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob) {\n         dropItemsFromMonsterOnMap(questEntry, pos, d, chRate, droptype, mobpos, chr, mob);\n     }\n     \n+    public void dropItemsFromMonster(List<MonsterDropEntry> list, final MapleCharacter chr, final MapleMonster mob) {\n+        if (mob.dropsDisabled() || !dropsOn) {\n+            return;\n+        }\n+        \n+        final byte droptype = (byte) (chr.getParty() != null ? 1 : 0);\n+        final int mobpos = mob.getPosition().x;\n+        int chRate = 1000000;   // guaranteed item drop\n+        byte d = 1;\n+        Point pos = new Point(0, mob.getPosition().y);\n+        \n+        dropItemsFromMonsterOnMap(list, pos, d, chRate, droptype, mobpos, chr, mob);\n+    }\n+    \n+    public void dropFromFriendlyMonster(final MapleCharacter chr, final MapleMonster mob) {\n+        dropFromMonster(chr, mob, true);\n+    }\n+    \n     public void dropFromReactor(final MapleCharacter chr, final MapleReactor reactor, Item drop, Point dropPos, short questid) {\n         spawnDrop(drop, this.calcDropPos(dropPos, reactor.getPosition()), reactor, chr, (byte)(chr.getParty() != null ? 1 : 0), questid);\n     }\n@@ -1139,7 +1159,7 @@ public void killMonster(final MapleMonster monster, final MapleCharacter chr, fi\n             if (dropOwner == null) {\n                 dropOwner = chr;\n             }\n-            dropFromMonster(dropOwner, monster);\n+            dropFromMonster(dropOwner, monster, false);\n         }\n         \n         if (monster.hasBossHPBar()) {\n@@ -1551,16 +1571,21 @@ public void addBunnyHit() {\n         }\n     }\n \n-    private void monsterItemDrop(final MapleMonster m, final Item item, long delay) {\n+    private void monsterItemDrop(final MapleMonster m, long delay) {\n         final ScheduledFuture<?> monsterItemDrop = TimerManager.getInstance().register(new Runnable() {\n             @Override\n             public void run() {\n-                if (m.isAlive() && !MapleMap.this.getPlayers().isEmpty()) {\n-                    if (item.getItemId() == 4001101) {\n+                List<MapleMapObject> chrList = MapleMap.this.getPlayers();\n+                \n+                if (m.isAlive() && !chrList.isEmpty()) {\n+                    MapleCharacter chr = (MapleCharacter) chrList.get(0);\n+                    \n+                    if (m.getId() == 9300061) {\n                         MapleMap.this.riceCakes++;\n                         MapleMap.this.broadcastMessage(MaplePacketCreator.serverNotice(6, \"The Moon Bunny made rice cake number \" + (MapleMap.this.riceCakes)));\n                     }\n-                    spawnItemDrop(m, (MapleCharacter) getPlayers().get(0), item, m.getPosition(), false, false);\n+                    \n+                    dropFromFriendlyMonster(chr, m);\n                 }\n             }\n         }, delay, delay);\n@@ -1643,11 +1668,11 @@ public void sendPackets(MapleClient c) {\n \n         if (monster.getDropPeriodTime() > 0) { //9300102 - Watchhog, 9300061 - Moon Bunny (HPQ), 9300093 - Tylus\n             if (monster.getId() == 9300102) {\n-                monsterItemDrop(monster, new Item(4031507, (short) 0, (short) 1), monster.getDropPeriodTime());\n+                monsterItemDrop(monster, monster.getDropPeriodTime());\n             } else if (monster.getId() == 9300061) {\n-                monsterItemDrop(monster, new Item(4001101, (short) 0, (short) 1), monster.getDropPeriodTime() / 3);\n+                monsterItemDrop(monster, monster.getDropPeriodTime() / 3);\n             } else if (monster.getId() == 9300093) {\n-                monsterItemDrop(monster, new Item(4031495, (short) 0, (short) 1), monster.getDropPeriodTime());\n+                monsterItemDrop(monster, monster.getDropPeriodTime());\n             } else {\n                 FilePrinter.printError(FilePrinter.UNHANDLED_EVENT, \"UNCODED TIMED MOB DETECTED: \" + monster.getId() + \"\\r\\n\");\n             }\n@@ -1947,7 +1972,7 @@ public void searchItemReactors(final MapleReactor react) {\n             for(final MapleMapItem drop : list) {\n                 final Item item = drop.getItem();\n             \n-                if (reactItem == item.getItemId() && reactQty == item.getQuantity()) {\n+                if (item != null && reactItem == item.getItemId() && reactQty == item.getQuantity()) {\n                     if (reactArea.contains(drop.getPosition())) {\n                         MapleClient owner = drop.getOwnerClient();\n                         if(owner != null) {"}, {"sha": "ae5989e191e73bf5c95ac9a191e7f3e09fe5acbb", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -248,8 +248,10 @@ private synchronized MapleMap loadMapFromWz(int mapid, Integer omapid) {\n             map.setMapName(MapleDataTool.getString(\"mapName\", nameData.getChildByPath(getMapStringName(omapid)), \"\"));\n             map.setStreetName(MapleDataTool.getString(\"streetName\", nameData.getChildByPath(getMapStringName(omapid)), \"\"));\n         } catch (Exception e) {\n-            e.printStackTrace();\n-            System.err.println(\"Not found mapid \" + omapid);\n+            if(omapid / 1000 != 1020) {     // explorer job introducion scenes\n+                e.printStackTrace();\n+                System.err.println(\"Not found mapid \" + omapid);\n+            }\n \n             map.setMapName(\"\");\n             map.setStreetName(\"\");"}, {"sha": "f0f30a2fa5cc444ce868e1f4ae2098a2e710a1c8", "filename": "wz/Item.wz/Etc/0400.img.xml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/a4973b8254fe8b76b5fd62df8860a3cde85404a8/wz/Item.wz/Etc/0400.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/a4973b8254fe8b76b5fd62df8860a3cde85404a8/wz/Item.wz/Etc/0400.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Item.wz/Etc/0400.img.xml?ref=a4973b8254fe8b76b5fd62df8860a3cde85404a8", "patch": "@@ -6232,6 +6232,7 @@\n         <vector name=\"origin\" x=\"-2\" y=\"32\"/>\n       </canvas>\n       <int name=\"price\" value=\"1\"/>\n+      <int name=\"pquest\" value=\"1\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04001023\">\n@@ -7281,6 +7282,7 @@\n         <vector name=\"origin\" x=\"-6\" y=\"25\"/>\n       </canvas>\n       <int name=\"price\" value=\"1\"/>\n+      <int name=\"pquest\" value=\"1\"/>\n     </imgdir>\n   </imgdir>\n   <imgdir name=\"04001107\">"}]}]},
