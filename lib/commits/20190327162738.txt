{"fetchDate": "2019-12-19", "content": [{"sha": "16deacb426be53a181757fbbafe8f2f76f900730", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MTZkZWFjYjQyNmJlNTNhMTgxNzU3ZmJiYWZlOGYyZjc2ZjkwMDczMA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-03-27T16:27:38Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-03-27T16:27:38Z"}, "message": "Cash shop transition patch\n\nSolved an issue where players were being unable to return to the game once exiting the cash shop.", "tree": {"sha": "e7b6a4d27b0c4e005c1a1d5dc612b21ebcb55cec", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/e7b6a4d27b0c4e005c1a1d5dc612b21ebcb55cec"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/16deacb426be53a181757fbbafe8f2f76f900730", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/16deacb426be53a181757fbbafe8f2f76f900730", "html_url": "https://github.com/ronancpl/HeavenMS/commit/16deacb426be53a181757fbbafe8f2f76f900730", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/16deacb426be53a181757fbbafe8f2f76f900730/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "83266508af2bce7ed466b1cac860b41b5cb32f0c", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/83266508af2bce7ed466b1cac860b41b5cb32f0c", "html_url": "https://github.com/ronancpl/HeavenMS/commit/83266508af2bce7ed466b1cac860b41b5cb32f0c"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "8e83dce209ca0ba899922132b1e32435057987b5", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/16deacb426be53a181757fbbafe8f2f76f900730/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/16deacb426be53a181757fbbafe8f2f76f900730/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=16deacb426be53a181757fbbafe8f2f76f900730", "patch": "@@ -1765,4 +1765,7 @@ Corrigido comando \"forcevac\" guardando no invent\u00e1rio mas n\u00e3o usando (como deve\n Revisado novamente login, para o caso onde accId = 0 estava sendo atribu\u00eddo e ent\u00e3o conta estava sendo rechecada, assim gerando conflito ao tentar logar.\n Adicionado update de estado de login no m\u00f3dulo de disconnect, para tamb\u00e9m atualizar estado da conta quando a mesma n\u00e3o se encontra j\u00e1 logada ou em transi\u00e7\u00e3o.\n Corrigido NPC da CPQ2, sa\u00edda abrupta, n\u00e3o retornando jogadores devidamente para o sagu\u00e3o de espera.\n-Corrigido bug na CPQ em tempo estendido n\u00e3o mostrando devidamente o efeito visual de fim de partida.\n\\ No newline at end of file\n+Corrigido bug na CPQ em tempo estendido n\u00e3o mostrando devidamente o efeito visual de fim de partida.\n+\n+27 Mar\u00e7o 2019,\n+Corrigido possibilidade de bloqueio de volta do jogador ao jogo, ao utilizar o sistema de MTS/Cash Shop. Problema ocorria devido a mudan\u00e7as concorrentes de login states ao fazer a transi\u00e7\u00e3o de volta ao jogo.\n\\ No newline at end of file"}, {"sha": "c61a5cb16b01bfdedf1989f02a0120501e81f2d2", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/16deacb426be53a181757fbbafe8f2f76f900730/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/16deacb426be53a181757fbbafe8f2f76f900730/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=16deacb426be53a181757fbbafe8f2f76f900730", "patch": "@@ -487,6 +487,7 @@ public void setEnteredChannelWorld() {\n     }\n     \n     public void setAwayFromChannelWorld() {\n+        client.getSession().setAttribute(MapleClient.CLIENT_CASH_SHOP);\n         setAwayFromChannelWorld(false);\n     }\n             "}, {"sha": "34a5f4e7659d4921e0c0cb5c17b52e30b289e443", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/16deacb426be53a181757fbbafe8f2f76f900730/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/16deacb426be53a181757fbbafe8f2f76f900730/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=16deacb426be53a181757fbbafe8f2f76f900730", "patch": "@@ -91,6 +91,7 @@\n         public static final String CLIENT_HWID = \"HWID\";\n         public static final String CLIENT_NIBBLEHWID = \"HWID2\";\n         public static final String CLIENT_REMOTE_ADDRESS = \"REMOTE_IP\";\n+        public static final String CLIENT_CASH_SHOP = \"CASH_SHOP\";\n \tprivate MapleAESOFB send;\n \tprivate MapleAESOFB receive;\n \tprivate final IoSession session;"}, {"sha": "c0abe69599ae811db827a92dbd358ec5e0704144", "filename": "src/net/MapleServerHandler.java", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/16deacb426be53a181757fbbafe8f2f76f900730/src/net/MapleServerHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/16deacb426be53a181757fbbafe8f2f76f900730/src/net/MapleServerHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/MapleServerHandler.java?ref=16deacb426be53a181757fbbafe8f2f76f900730", "patch": "@@ -150,11 +150,9 @@ private void closeMapleSession(IoSession session) {\n         MapleClient client = (MapleClient) session.getAttribute(MapleClient.CLIENT_KEY);\n         if (client != null) {\n             try {\n-                boolean inCashShop = false;\n-                if (client.getPlayer() != null) {\n-                    inCashShop = client.getPlayer().getCashShop().isOpened();\n+                if (!session.containsAttribute(MapleClient.CLIENT_CASH_SHOP)) {\n+                    client.disconnect(false, false);\n                 }\n-                client.disconnect(false, inCashShop);\n             } catch (Throwable t) {\n                 FilePrinter.printError(FilePrinter.ACCOUNT_STUCK, t);\n             } finally {"}, {"sha": "7d86d574b824750e0e88e1505fff63ee36270a25", "filename": "src/net/server/channel/handlers/EnterCashShopHandler.java", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/16deacb426be53a181757fbbafe8f2f76f900730/src/net/server/channel/handlers/EnterCashShopHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/16deacb426be53a181757fbbafe8f2f76f900730/src/net/server/channel/handlers/EnterCashShopHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/EnterCashShopHandler.java?ref=16deacb426be53a181757fbbafe8f2f76f900730", "patch": "@@ -42,7 +42,6 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             if (mc.cannotEnterCashShop()) {\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;\n-                \n             }\n             \n             if(mc.getEventInstance() != null) {"}]}]},
