{"fetchDate": "2019-12-19", "content": [{"sha": "0203d45901fc57ab42fe4d64b559080f76886184", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6MDIwM2Q0NTkwMWZjNTdhYjQyZmU0ZDY0YjU1OTA4MGY3Njg4NjE4NA==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-01-16T16:46:28Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2019-01-16T16:46:28Z"}, "message": "PNPC & Pmob + Events Wheel & P. Leave patch + Proper cash use deplete\n\nReworked cash item consume. It now depletes from the selected slot rather than from the first slot it appears on inventory.\nImplemented PNPC and PMOB commands.\nSolved an issue with some events finishing abruptly when players quit a party.\nAdded missing mandatory script functions to the event scripts.\nSolved an interaction issue with Wheel of Destiny activation in event instances.\nAdded interaction with NPC Mom & Dad in the Engagement prequest.\nSolved an issue with event maps being disposed while reactor's spray items activity is still in effect.\nFixed modifier scrolls such as Spikes on Shoes depleting a upgrade slot.\nAdded a server flag for avoiding compulsory consuming by pet autopot.\nAdded a cache for fetching mob names.\nImplemented boss drop rate.\nSmart protected commands system against command requests in burst by the same user.\nRevised login handler, bringing disconnection checks before checking login state and preventing new client reattribution to already logged-in character objects.\nBotched login handler sessions now properly gets closed.", "tree": {"sha": "4cae2adcfd560a16ceb768479a3de2054f9dec1a", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/4cae2adcfd560a16ceb768479a3de2054f9dec1a"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/0203d45901fc57ab42fe4d64b559080f76886184", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0203d45901fc57ab42fe4d64b559080f76886184", "html_url": "https://github.com/ronancpl/HeavenMS/commit/0203d45901fc57ab42fe4d64b559080f76886184", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/0203d45901fc57ab42fe4d64b559080f76886184/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "132a4ee98908afcf19b9db59b93742fb58f736e1", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/132a4ee98908afcf19b9db59b93742fb58f736e1", "html_url": "https://github.com/ronancpl/HeavenMS/commit/132a4ee98908afcf19b9db59b93742fb58f736e1"}], "stats": {"total": 3209, "additions": 2738, "deletions": 471}, "files": [{"sha": "2105e475e13ff3b12e44d1a4ee7bbcdebd400ba9", "filename": ".gitignore", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -47,6 +47,10 @@\n /tools/MapleEquipmentOmnileveler/dist/\n /tools/MapleEquipmentOmnileveler/nbproject/\n \n+/tools/MapleEventMethodFiller/build/\n+/tools/MapleEventMethodFiller/dist/\n+/tools/MapleEventMethodFiller/nbproject/\n+\n /tools/MapleIdRetriever/build/\n /tools/MapleIdRetriever/dist/\n /tools/MapleIdRetriever/nbproject/\n@@ -112,4 +116,4 @@\n /tools/SpiderDropFetcher/nbproject/\n \n /out\n-*.onetoc2\n\\ No newline at end of file\n+*.onetoc2"}, {"sha": "f82f4bf60a7305d2f89265940458958bd68d4228", "filename": "README.md", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -1,5 +1,4 @@\n-# HeavenMS\n----\n+<img src=\"https://heavenmssurveyhome.files.wordpress.com/2018/12/heavenmslogo.png\"  width=\"370\" height=\"auto\">\n \n ## Head developer: Ronan C. P. Lana\n \n@@ -90,6 +89,8 @@ Paypal: https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=3K8\n \n ### Disclaimer\n \n+* HeavenMS development is decisively __ONLY accepting donations__ from the Paypal link aforementioned, in the __ronancpl/HeavenMS__ repository readme (no patreons or other revenue resources).\n+\n * HeavenMS staff has __no current intention__ to publicly open a server with this source, if that ever comes to happen this note will be lifted. __Don't be scammed!__\n \n * This server source is __NOT intended to be stable__ as is. Proper deadlock review and other maintenance checks are needed in order to make it suitable for production use."}, {"sha": "3f09112e5e8f988a0ad7a57ceb6ecea80040b08e", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -1546,4 +1546,31 @@ Corrigido Homing Beacon skill provocando autoflag em mobs para jogadores que mud\n Resolvido casos onde pets equipados poderiam provocar inconsist\u00eancias na DB ao ser removido da aba de cash no invent\u00e1rio.\n Revisado sistema de log por todo o c\u00f3digo-fonte. Espera-se uma formata\u00e7\u00e3o similar para os v\u00e1rios logs.\n Corrigido pet excludes n\u00e3o sendo devidamente removidos ao retirar o pet da DB.\n-Corrigido bug na expedi\u00e7\u00e3o de Horntail ao tentar reentrar numa expedi\u00e7\u00e3o j\u00e1 come\u00e7ada.\n\\ No newline at end of file\n+Corrigido bug na expedi\u00e7\u00e3o de Horntail ao tentar reentrar numa expedi\u00e7\u00e3o j\u00e1 come\u00e7ada.\n+\n+07 Janeiro 2019,\n+Corrigido petignores n\u00e3o sendo devidamente liberados da cache ao deletar pets, levando a poss\u00edvel leak na DB dos ignores.\n+Revisado cash consum\u00edveis sendo sempre retirado do primeiro slot em que aparece no invent\u00e1rio.\n+Implementado comandos \"pnpc\" e \"pmob\".\n+Revisado mec\u00e2nica de eventos de RockSpirit, eliminando uso escasso de chamada de fun\u00e7\u00e3o de script em MapleMap.addPlayer().\n+Removido finaliza\u00e7\u00e3o de evento ao sair de party em alguns eventos solo.\n+Adicionado fun\u00e7\u00f5es nos scripts de evento para todos os casos onde ainda faltava refer\u00eancia obrigat\u00f3ria.\n+\n+08 - 09 Janeiro 2019,\n+Corrigido fun\u00e7\u00e3o de script revivePlayer sendo ativado mesmo ao usar Wheel of Destiny (uso indevido da fun\u00e7\u00e3o, que assume retorno usual do character para a cidade).\n+Implementado comandos \"pnpcremove\" e \"pmobremove\".\n+\n+13 Janeiro 2019,\n+Adicionado intera\u00e7\u00e3o com NPC \"Mom & Dad\" na quest de noivado.\n+Revisado problema com dispose em mapas de eventos ocorrendo muito cedo, havendo casos n\u00e3o previstos onde mapas ainda tendo alguma atividade levaria dispose.\n+Corrigido scrolls de modifica\u00e7\u00e3o de flags em equipamentos removendo slots quando n\u00e3o deveriam.\n+\n+14 Janeiro 2019,\n+Implementado nova flag que permite evitar consumo compuls\u00f3rio de recursos via autopot de pets.\n+Otimizado busca por nome de mobs em requisi\u00e7\u00f5es de comando WhoDrops e provedor de info de mobs, agora utilizando cache.\n+Implementado nova server flag para boss drop rate.\n+Protegido concorrentemente sistema de comandos, assim evitando processamento em rajada de instancia\u00e7\u00f5es de comandos de um mesmo jogador.\n+\n+16 Janeiro 2019,\n+Revisado login handler, trazendo m\u00e9todos de desconex\u00e3o para antes de checar LoginState, e n\u00e3o permitindo reatribui\u00e7\u00e3o de objeto-cliente para jogador j\u00e1 logado em canal.\n+Revisado disconnect no login handler, agora devidamente finalizando sess\u00f5es rec\u00e9m-criadas que falham em conectar jogador ao mundo.\n\\ No newline at end of file"}, {"sha": "c24c548cab8e7209e378e98a8faed8061b29f6d9", "filename": "scripts/event/2xEvent.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/2xEvent.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/2xEvent.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/2xEvent.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -67,4 +67,37 @@ function stop() {\n    var world = Packages.net.server.Server.getInstance().getWorld(em.getChannelServer().getWorld());\n    world.setExpRate(4);\n    world.broadcastPacket(Packages.tools.MaplePacketCreator.serverNotice(6, \"Unfortunately the Emergency XP Pool (EXP) has run out of juice for now and needs to recharge causing the EXP rate to go back to normal.\"));\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "e622903724da4961f369810694380ab1ead288ff", "filename": "scripts/event/3rdJob_bowman.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_bowman.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_bowman.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_bowman.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -93,3 +93,19 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "563efe6de92db3463dd3ae34804eacfcd10c4e48", "filename": "scripts/event/3rdJob_magician.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_magician.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_magician.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_magician.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -93,3 +93,19 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "1b100dd27bd70975b43f70b06105301c703e3272", "filename": "scripts/event/3rdJob_mount.js", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_mount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_mount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_mount.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -123,3 +123,17 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+"}, {"sha": "fb7ba2be9e6d89eb66b27de0502d6a872f1c3597", "filename": "scripts/event/3rdJob_pirate.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_pirate.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_pirate.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_pirate.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -93,3 +93,19 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "6160f3c22130c589a3741177acb4985a04202e8d", "filename": "scripts/event/3rdJob_thief.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_thief.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_thief.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_thief.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -93,3 +93,19 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "af119f877bac9b9144e1bbd9be208c2cfd081348", "filename": "scripts/event/3rdJob_warrior.js", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_warrior.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/3rdJob_warrior.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/3rdJob_warrior.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -93,3 +93,19 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "d4dc9708d7f3a70348571eebac23127b7df29e3b", "filename": "scripts/event/4jaerial.js", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jaerial.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jaerial.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jaerial.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -107,3 +107,9 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "9480843488a53c05fd84d3a02ececc683dbd2903", "filename": "scripts/event/4jberserk.js", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jberserk.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jberserk.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jberserk.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -178,3 +178,13 @@ function timeOut() {\n         eim.dispose();\n     }\n }\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "e5b7179d914d53a36f884c7a9793ee5697b07ed2", "filename": "scripts/event/4jrush.js", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jrush.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jrush.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jrush.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -145,3 +145,13 @@ function timeOut() {\n         eim.dispose();\n     }\n }\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "ddb0da25024ce7d32cd8160109eb8294c691cf77", "filename": "scripts/event/4jship.js", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jship.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/4jship.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/4jship.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -136,3 +136,9 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "f530de71b59de255c36f860d36ebfed000b89899", "filename": "scripts/event/AirPlane.js", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AirPlane.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AirPlane.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AirPlane.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -52,3 +52,37 @@ function arrived() {\n }\n \n function cancelSchedule() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "68f2e64c47c7e54dea777e2d08e9a9426185de22", "filename": "scripts/event/Aran_2ndmount.js", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Aran_2ndmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Aran_2ndmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_2ndmount.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -110,3 +110,17 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+"}, {"sha": "efc469e2fcd074037eaed8f8913462738f89b543", "filename": "scripts/event/Aran_3rdmount.js", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Aran_3rdmount.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Aran_3rdmount.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Aran_3rdmount.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -115,3 +115,17 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+"}, {"sha": "35d114c0a66c1ebb76b868f8f8a7809d357955a9", "filename": "scripts/event/AreaBossBamboo.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossBamboo.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossBamboo.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossBamboo.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -51,4 +51,37 @@ function start() {\n     mapObj.spawnMonsterOnGroundBelow(mobObj, new Packages.java.awt.Point(560, 50));\n     mapObj.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"From amongst the ruins shrouded by the mists, Bamboo Warrior appears.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "998ebddd08b11951be4fdf932bb769d15bc76904", "filename": "scripts/event/AreaBossCentipede.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossCentipede.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossCentipede.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossCentipede.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -51,4 +51,37 @@ function start() {\n     herbGarden.spawnMonsterOnGroundBelow(gcent, new Packages.java.awt.Point(560, 50));\n     herbGarden.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"From the mists surrounding the herb garden, the gargantuous Giant Centipede appears.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "8c5328967b3520166da1cc176034af8204b87dd0", "filename": "scripts/event/AreaBossDeo.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDeo.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDeo.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDeo.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -51,4 +51,37 @@ function start() {\n     royalCatthusDesert.spawnMonsterOnGroundBelow(deo, new Packages.java.awt.Point(645, 275));\n     royalCatthusDesert.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Deo slowly appeared out of the sand dust.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "e497823d064e3d5eca93c05adbda581271361370", "filename": "scripts/event/AreaBossDoor1.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor1.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "65bee99bc2fd287de358b5b4ae36a2eba8a333e6", "filename": "scripts/event/AreaBossDoor2.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor2.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "20969b76e927a62cc21d7f476d931c112b664319", "filename": "scripts/event/AreaBossDoor3.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor3.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor3.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor3.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "e5965a9f3bf5b9dad50e4359b1de1a9bfac2258c", "filename": "scripts/event/AreaBossDoor4.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor4.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor4.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor4.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "cae6b7cf90c46766114aa0a5caedd4b3712a54c9", "filename": "scripts/event/AreaBossDoor5.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor5.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor5.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor5.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "5576c7aa7fe1db13a245e91aac4a5b18ee07420c", "filename": "scripts/event/AreaBossDoor6.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor6.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDoor6.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDoor6.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     map.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, bossMsg));\n     \n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "f4c11549d284c614cb28ddb64392989743ea9790", "filename": "scripts/event/AreaBossDyle.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDyle.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossDyle.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossDyle.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -51,4 +51,37 @@ function start() {\n     dangeroudCroko1.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(6220000), new Packages.java.awt.Point(90, 119));\n     dangeroudCroko1.broadcastMessage(MaplePacketCreator.serverNotice(6, \"The huge crocodile Dyle has come out from the swamp.\"));\n \tsetupTask = em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "7a000355d777c13449736db812163c8ecb591ec7", "filename": "scripts/event/AreaBossEliza1.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossEliza1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossEliza1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossEliza1.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -56,4 +56,37 @@ function start() {\n     stairwayToTheSky2.spawnMonsterOnGroundBelow(eliza, new Packages.java.awt.Point(208, 83));\n     stairwayToTheSky2.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Eliza has appeared with a black whirlwind.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "0d3de727a56ea9efcdb3d2fc5ce33014fe67551e", "filename": "scripts/event/AreaBossFaust1.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossFaust1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossFaust1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossFaust1.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     theForestOfEvil1.spawnMonsterOnGroundBelow(faust1, new Packages.java.awt.Point(456, 278));\n     theForestOfEvil1.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Faust appeared amidst the blue fog.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "610804655affa41f67ef823d17f32bdd1884b09a", "filename": "scripts/event/AreaBossFaust2.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossFaust2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossFaust2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossFaust2.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n     theForestOfEvil2.spawnMonsterOnGroundBelow(faust2, new Packages.java.awt.Point(474, 278));\n     theForestOfEvil2.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Faust appeared amidst the blue fog.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "006e4e6ef4a0ed14e88c387e09a6c09c468ee698", "filename": "scripts/event/AreaBossKimera.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKimera.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKimera.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossKimera.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -57,4 +57,37 @@ function start() {\n     labSecretBasementPath.spawnMonsterOnGroundBelow(chimera, new Packages.java.awt.Point(posX, posY));\n     labSecretBasementPath.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Kimera has appeared out of the darkness of the underground with a glitter in her eyes.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "62e2871a5bbcdb005e5fa5d4b46b50f1359e6f6b", "filename": "scripts/event/AreaBossKingClang.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKingClang.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKingClang.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossKingClang.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -57,4 +57,37 @@ function start() {\n     hotSand.spawnMonsterOnGroundBelow(kingClang, new Packages.java.awt.Point(posX, posY));\n     hotSand.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"A strange turban shell has appeared on the beach.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "ffd42b460389062ec9951e152d96dad0114acc55", "filename": "scripts/event/AreaBossKingSageCat.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKingSageCat.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossKingSageCat.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossKingSageCat.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -56,4 +56,37 @@ function start() {\n     goblinForest2.spawnMonsterOnGroundBelow(kingSageCat, new Packages.java.awt.Point(posX, posY));\n     goblinForest2.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"The ghostly air around here has become stronger. The unpleasant sound of a cat crying can be heard.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "7a4ca827cfc414dbe5d73c265e9f558d9dba6dfc", "filename": "scripts/event/AreaBossLeviathan.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossLeviathan.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossLeviathan.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossLeviathan.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -56,4 +56,37 @@ function start() {\n     leviathansCanyon.spawnMonsterOnGroundBelow(leviathan, new Packages.java.awt.Point(posX, posY));\n     leviathansCanyon.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Leviathan emerges from the canyon and the cold icy wind blows.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "861054278aa465d624e79af28998df3fab08cd89", "filename": "scripts/event/AreaBossMano.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossMano.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossMano.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossMano.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -52,4 +52,37 @@ function start() {\n     thicketAroundTheBeach3.spawnMonsterOnGroundBelow(mano, new Packages.java.awt.Point(279, -496));\n     thicketAroundTheBeach3.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"A cool breeze was felt when Mano appeared.\"));\n     em.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "b49c71d54986b5b628182ffc495263959d518488", "filename": "scripts/event/AreaBossNineTailedFox.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossNineTailedFox.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossNineTailedFox.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossNineTailedFox.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -55,4 +55,37 @@ function start() {\n     moonRidge.spawnMonsterOnGroundBelow(nineTailedFox, new Packages.java.awt.Point(posX, posY));\n     moonRidge.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"As the moon light dims, a long fox cry can be heard and the presence of the old fox can be felt\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "8ba8243b3da942a7576ed6677fbe8269d5d45954", "filename": "scripts/event/AreaBossSeruf.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossSeruf.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossSeruf.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossSeruf.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -58,4 +58,37 @@ function start() {\n     theSeaweedTower.spawnMonsterOnGroundBelow(seruf, new Packages.java.awt.Point(posX, posY));\n     theSeaweedTower.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"A strange shell has appeared from a grove of seaweed\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "46d966c384cb68886f7de20139bd590e6d8bdde1", "filename": "scripts/event/AreaBossSnackBar.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossSnackBar.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossSnackBar.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossSnackBar.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -54,4 +54,37 @@ function start() {\n         snackBarMap.spawnMonsterOnGroundBelow(snackBar, new Packages.java.awt.Point(rndPos[0], rndPos[1]));\n         snackBarMap.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Slowly, a suspicious food stand opens up on a strangely remote place.\"));\n \tem.schedule(\"start\", 3 * 60 *60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "12354f9d4f5c29cd285d388cdbd748f9550c4f9a", "filename": "scripts/event/AreaBossStumpy.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossStumpy.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossStumpy.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossStumpy.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -57,4 +57,37 @@ function start() {\n     eastRockyMountain5.spawnMonsterOnGroundBelow(stumpy, new Packages.java.awt.Point(posX, posY));\n     eastRockyMountain5.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Stumpy has appeared with a stumping sound that rings the Stone Mountain.\"));\n     em.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "862fef4394c5e6640871e5acdc2bf7b38aa04e8c", "filename": "scripts/event/AreaBossTaeRoon.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTaeRoon.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTaeRoon.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossTaeRoon.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -57,4 +57,37 @@ function start() {\n     territoryOfWanderingBear.spawnMonsterOnGroundBelow(taeRoon, new Packages.java.awt.Point(posX, posY));\n     territoryOfWanderingBear.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Tae Roon has appeared with a soft whistling sound.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "0ba63a009f2218acc35657600907513f9a95699f", "filename": "scripts/event/AreaBossTimer1.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossTimer1.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -56,4 +56,37 @@ function start() {\n     whirlpoolOfTime.spawnMonsterOnGroundBelow(timer1, new Packages.java.awt.Point(posX, posY));\n     whirlpoolOfTime.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Tick-Tock Tick-Tock! Timer makes it's presence known.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "0618e87b3ee35da2d5b03e91ad8baaacee65151c", "filename": "scripts/event/AreaBossTimer2.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossTimer2.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -57,4 +57,37 @@ function start() {\n     lostTime1.spawnMonsterOnGroundBelow(timer2, new Packages.java.awt.Point(posX, posY));\n     lostTime1.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Tick-Tock Tick-Tock! Timer makes it's presence known.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "6642cc05cf98af57940e7cd5d98dcf8bc0d19d2f", "filename": "scripts/event/AreaBossTimer3.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer3.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossTimer3.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossTimer3.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -58,4 +58,37 @@ function start() {\n     lostTime2.spawnMonsterOnGroundBelow(timer3, new Packages.java.awt.Point(posX, posY));\n     lostTime2.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Tick-Tock Tick-Tock! Timer makes it's presence known.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "9820efc538958433c939ead5092ce1530db1931a", "filename": "scripts/event/AreaBossZeno.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossZeno.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/AreaBossZeno.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AreaBossZeno.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -51,4 +51,37 @@ function start() {\n     graysPrairie.spawnMonsterOnGroundBelow(zeno, new Packages.java.awt.Point(-4224, 776));\n     graysPrairie.broadcastMessage(Packages.tools.MaplePacketCreator.serverNotice(6, \"Zeno has appeared with a heavy sound of machinery.\"));\n \tem.schedule(\"start\", 3 * 60 * 60 * 1000);\n-}\n\\ No newline at end of file\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "6ab3a6917f3d33b723f5be0b4207f3779cdd491a", "filename": "scripts/event/BalrogQuest.js", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/BalrogQuest.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/BalrogQuest.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/BalrogQuest.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -100,3 +100,17 @@ function allMonstersDead(eim) {}\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function disbandParty(eim, player) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+"}, {"sha": "cea1f52ec657bfdc3b9ca9c1b2fcfbb5c4a9feec", "filename": "scripts/event/Boats.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Boats.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Boats.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Boats.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -107,4 +107,37 @@ function invasion() {\n     map2.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8150000), pos2);\n }\n \n-function cancelSchedule() {}\n\\ No newline at end of file\n+function cancelSchedule() {}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "6ca1130023654b8c06eb4efb4ce252a08baa3d91", "filename": "scripts/event/CWKPQ.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/CWKPQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/CWKPQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/CWKPQ.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -25,7 +25,7 @@\n \n var isPq = true;\n var minPlayers = 6, maxPlayers = 30;\n-var minLevel = 100, maxLevel = 255;\n+var minLevel = 90, maxLevel = 255;\n var entryMap = 610030100;\n var exitMap = 610030020;\n var recruitMap = 610030020;"}, {"sha": "a793ad8851da956c1499d91a5d0476bdd27c2adb", "filename": "scripts/event/Cabin.js", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Cabin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Cabin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Cabin.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -109,3 +109,37 @@ function arrived() {\n }\n \n function cancelSchedule() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "1fee278828e592b1999cbfaaf1762669e3a0cbd5", "filename": "scripts/event/Cygnus_Magic_Library.js", "status": "modified", "additions": 11, "deletions": 18, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Cygnus_Magic_Library.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Cygnus_Magic_Library.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Cygnus_Magic_Library.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -62,19 +62,7 @@ function monsterValue(eim, mobId){\n \treturn -1;\n }\n \n-function leftParty(eim, player){\n-\tvar party = eim.getPlayers();\n-\n-\tif(party.size() < minPlayers){\n-\t\tfor(var i = 0; i < party.size(); i++){\n-\t\t\tplayerExit(eim, party.get(i));\n-\t\t}\n-\t\teim.dispose();\n-\t}\n-\telse{\n-\t\tplayerExit(eim, player);\n-\t}\n-}\n+function leftParty(eim, player){}\n \n function disbandParty(eim){}\n \n@@ -85,10 +73,10 @@ function playerExit(eim, player){\n \tplayer.changeMap(entryMap, 2);\n }\n \n-function moveMap(eim, player){\n-\tif(player.getMap().getId() == exitMap){\n-\t\tremovePlayer(eim, player);\n-\t\teim.dispose();\n+function changedMap(eim, chr, mapid) {\n+        if(mapid == exitMap){\n+                removePlayer(eim, chr);\n+                eim.dispose();\n \t}\n }\n \n@@ -106,4 +94,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "d784adc0b1690a34adcd9d79c556e2d80a01d7c0", "filename": "scripts/event/DollHouse.js", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/DollHouse.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/DollHouse.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/DollHouse.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -77,3 +77,25 @@ function changedMap(eim, chr, mapid) {\n function cancelSchedule() {}\n \n function dispose() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+"}, {"sha": "1a42b349ac2eefe26c7d694ec726d52a3d69feaf", "filename": "scripts/event/Elevator.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Elevator.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Elevator.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Elevator.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -83,4 +83,37 @@ function isDownNow() {\n     goUp();\n }\n \n-function cancelSchedule() {}\n\\ No newline at end of file\n+function cancelSchedule() {}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "26f3ac5bfa3f6fa062871144e79d810d21a0b46a", "filename": "scripts/event/Genie.js", "status": "modified", "additions": 34, "deletions": 1, "changes": 35, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Genie.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Genie.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Genie.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -85,4 +85,37 @@ function arrived() {\n     scheduleNew();\n }\n \n-function cancelSchedule() {}\n\\ No newline at end of file\n+function cancelSchedule() {}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "b2a9be576ed1a142532f2406b2fea4280799d1c2", "filename": "scripts/event/GuardianNex.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/GuardianNex.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/GuardianNex.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/GuardianNex.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -92,4 +92,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "a33ab7121edee620954efc9140e9b10548de1ed3", "filename": "scripts/event/Hak.js", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Hak.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Hak.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Hak.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -64,3 +64,23 @@ function playerDisconnected(eim, player) {\n function cancelSchedule() {}\n \n function dispose(eim) {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+"}, {"sha": "6a30f37b5f270e5d74fa4cbb3a44148b44409d3f", "filename": "scripts/event/KerningTrain.js", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/KerningTrain.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/KerningTrain.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KerningTrain.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -66,3 +66,23 @@ function playerDisconnected(eim, player) {\n function cancelSchedule() {}\n \n function dispose(eim) {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+"}, {"sha": "b072271e8f6d1973eff2897e821672182780aef1", "filename": "scripts/event/KingPepeAndYetis.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/KingPepeAndYetis.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/KingPepeAndYetis.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/KingPepeAndYetis.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -84,4 +84,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "628e3f01c886a09fb14d60b10fbcf02cd5410eb5", "filename": "scripts/event/MK_PrimeMinister.js", "status": "modified", "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/MK_PrimeMinister.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/MK_PrimeMinister.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -61,19 +61,7 @@ function monsterValue(eim, mobId){\n \treturn -1;\n }\n \n-function leftParty(eim, player){\n-\tvar party = eim.getPlayers();\n-\n-\tif(party.size() < minPlayers){\n-\t\tfor(var i = 0; i < party.size(); i++){\n-\t\t\tplayerExit(eim, party.get(i));\n-\t\t}\n-\t\teim.dispose();\n-\t}\n-\telse{\n-\t\tplayerExit(eim, player);\n-\t}\n-}\n+function leftParty(eim, player){}\n \n function disbandParty(eim){}\n \n@@ -102,4 +90,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "6a31209680ece9d0ca8c56ca3eb785cb602f6b55", "filename": "scripts/event/MK_PrimeMinister2.js", "status": "modified", "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/MK_PrimeMinister2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/MK_PrimeMinister2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/MK_PrimeMinister2.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -72,19 +72,7 @@ function monsterValue(eim, mobId){\n \treturn -1;\n }\n \n-function leftParty(eim, player){\n-\tvar party = eim.getPlayers();\n-\n-\tif(party.size() < minPlayers){\n-\t\tfor(var i = 0; i < party.size(); i++){\n-\t\t\tplayerExit(eim, party.get(i));\n-\t\t}\n-\t\teim.dispose();\n-\t}\n-\telse{\n-\t\tplayerExit(eim, player);\n-\t}\n-}\n+function leftParty(eim, player){}\n \n function disbandParty(eim){}\n \n@@ -113,4 +101,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "7ea0cd5bb439c83e3a48fd879cfcd4db990e1bf5", "filename": "scripts/event/Puppeteer.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Puppeteer.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Puppeteer.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Puppeteer.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -90,4 +90,9 @@ function clearPQ(eim){}\n \n function monsterKilled(mob, eim){}\n \n-function allMonstersDead(eim){}\n\\ No newline at end of file\n+function allMonstersDead(eim){}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "6ab69099edaabb0bca614713615d4c6d35da52d3", "filename": "scripts/event/RockSpirit.js", "status": "modified", "additions": 45, "deletions": 55, "changes": 100, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/RockSpirit.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/RockSpirit.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpirit.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -29,34 +29,34 @@ var fightTime = 60;\n var timer = 1000 * 60 * fightTime;\n \n function init() {\n-\texitMap = em.getChannelServer().getMapFactory().getMap(103040400);\n-\tentryMap = em.getChannelServer().getMapFactory().getMap(103040410);\n-\totherMap = em.getChannelServer().getMapFactory().getMap(103040420);\n+    exitMap = em.getChannelServer().getMapFactory().getMap(103040400);\n+    entryMap = em.getChannelServer().getMapFactory().getMap(103040410);\n+    otherMap = em.getChannelServer().getMapFactory().getMap(103040420);\n }\n \n function setup() {\n     var eim = em.newInstance(\"RockSpirit_\" + em.getProperty(\"player\"));\n     respawn(eim);\n     eim.startEventTimer(timer);    \n-\treturn eim;\n+    return eim;\n }\n \n function afterSetup(eim) {}\n \n function respawn(eim) {\n-\tvar map = eim.getMapInstance(entryMap.getId());\n-\tvar map2 = eim.getMapInstance(otherMap.getId());\n-\tmap.allowSummonState(true);\n-\tmap2.allowSummonState(true);\n-\tmap.instanceMapRespawn();\n-\tmap2.instanceMapRespawn();\n-\teim.schedule(\"respawn\", 10000);\n+    var map = eim.getMapInstance(entryMap.getId());\n+    var map2 = eim.getMapInstance(otherMap.getId());\n+    map.allowSummonState(true);\n+    map2.allowSummonState(true);\n+    map.instanceMapRespawn();\n+    map2.instanceMapRespawn();\n+    eim.schedule(\"respawn\", 10000);\n }\n \n \n function playerEntry(eim, player) {\n-\tvar amplifierMap = eim.getMapInstance(entryMap.getId());\n-\tplayer.changeMap(amplifierMap);\n+    var amplifierMap = eim.getMapInstance(entryMap.getId());\n+    player.changeMap(amplifierMap);\n     eim.schedule(\"timeOut\", timer);\n }\n \n@@ -68,32 +68,39 @@ function playerRevive(eim, player) {\n function playerDead(eim, player) {}\n \n function playerDisconnected(eim, player) {\n-    var party = eim.getPlayers();\n-\tfor (var i = 0; i < party.size(); i++) {\n-\t    if (party.get(i).equals(player)) {\n-\t        removePlayer(eim, player);\n-\t    } else {\n-\t        playerExit(eim, party.get(i));\n-\t    }\n-\t}\n-\teim.dispose();\n+    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+        eim.unregisterPlayer(player);\n+        end(eim);\n+    }\n+    else\n+        eim.unregisterPlayer(player);\n+}\n+\n+function changedMap(eim, player, mapid) {\n+    if(mapid == exitMap.getId()) {\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+            eim.unregisterPlayer(player);\n+            end(eim);\n+        }\n+        else\n+            eim.unregisterPlayer(player);\n+    }\n }\n \n function monsterValue(eim,mobId) { \n     return -1;\n }\n \n-function leftParty(eim, player) {\n+function end(eim) {\n     var party = eim.getPlayers();\n-    if (party.size() < minPlayers) {\n-        for (var i = 0; i < party.size(); i++)\n-            playerExit(eim,party.get(i));\n-        eim.dispose();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n     }\n-    else\n-        playerExit(eim, player);\n+    eim.dispose();\n }\n \n+function leftParty(eim, player) {}\n+\n function disbandParty(eim) {}\n \n function playerUnregistered(eim, player) {}\n@@ -103,21 +110,6 @@ function playerExit(eim, player) {\n     player.changeMap(exitMap, exitMap.getPortal(0));\n }\n \n-\n-function moveMap(eim, player) {\n-\tif (player.getMap().getId() == exitMap.getId()) {\n-\t\tremovePlayer(eim, player);\n-\t\tplayer.getClient().announce(MaplePacketCreator.removeClock());\n-\t\teim.dispose();\n-\t}\n-}\n-\n-function removePlayer(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.getMap().removePlayer(player);\n-    player.setMap(exitMap);\n-}\n-\n function cancelSchedule() {}\n \n function dispose() {}\n@@ -129,14 +121,12 @@ function monsterKilled(mob, eim) {}\n function allMonstersDead(eim) {}\n \n function timeOut(eim) {\n-    if (eim != null) {\n-        if (eim.getPlayerCount() > 0) {\n-            var pIter = eim.getPlayers().iterator();\n-            while (pIter.hasNext()){\n-                var player = pIter.next();\n-                playerExit(eim, player);\n-            }\n-        }\n-        eim.dispose();\n-    }\n-}\n\\ No newline at end of file\n+    end(eim);\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "2a2983211f1fd6276e78943889cc5421b3fe40f7", "filename": "scripts/event/RockSpiritVIP.js", "status": "modified", "additions": 32, "deletions": 42, "changes": 74, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/RockSpiritVIP.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/RockSpiritVIP.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/RockSpiritVIP.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -68,32 +68,39 @@ function playerRevive(eim, player) {\n function playerDead(eim, player) {}\n \n function playerDisconnected(eim, player) {\n-    var party = eim.getPlayers();\n-\tfor (var i = 0; i < party.size(); i++) {\n-\t    if (party.get(i).equals(player)) {\n-\t        removePlayer(eim, player);\n-\t    } else {\n-\t        playerExit(eim, party.get(i));\n-\t    }\n-\t}\n-\teim.dispose();\n+    if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+        eim.unregisterPlayer(player);\n+        end(eim);\n+    }\n+    else\n+        eim.unregisterPlayer(player);    \n+}\n+\n+function changedMap(eim, player, mapid) {\n+    if(mapid == exitMap.getId()) {\n+        if (eim.isEventTeamLackingNow(true, minPlayers, player)) {\n+            eim.unregisterPlayer(player);\n+            end(eim);\n+        }\n+        else\n+            eim.unregisterPlayer(player);\n+    }\n }\n \n function monsterValue(eim,mobId) { \n     return -1;\n }\n \n-function leftParty(eim, player) {\n+function end(eim) {\n     var party = eim.getPlayers();\n-    if (party.size() < minPlayers) {\n-        for (var i = 0; i < party.size(); i++)\n-            playerExit(eim,party.get(i));\n-        eim.dispose();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n     }\n-    else\n-        playerExit(eim, player);\n+    eim.dispose();\n }\n \n+function leftParty(eim, player) {}\n+\n function disbandParty(eim) {}\n \n function playerUnregistered(eim, player) {}\n@@ -103,21 +110,6 @@ function playerExit(eim, player) {\n     player.changeMap(exitMap, exitMap.getPortal(0));\n }\n \n-\n-function moveMap(eim, player) {\n-\tif (player.getMap().getId() == exitMap.getId()) {\n-\t\tremovePlayer(eim, player);\n-\t\tplayer.getClient().announce(MaplePacketCreator.removeClock());\n-\t\teim.dispose();\n-\t}\n-}\n-\n-function removePlayer(eim, player) {\n-    eim.unregisterPlayer(player);\n-    player.getMap().removePlayer(player);\n-    player.setMap(exitMap);\n-}\n-\n function cancelSchedule() {}\n \n function dispose() {}\n@@ -129,14 +121,12 @@ function monsterKilled(mob, eim) {}\n function allMonstersDead(eim) {}\n \n function timeOut(eim) {\n-    if (eim != null) {\n-        if (eim.getPlayerCount() > 0) {\n-            var pIter = eim.getPlayers().iterator();\n-            while (pIter.hasNext()){\n-                var player = pIter.next();\n-                playerExit(eim, player);\n-            }\n-        }\n-        eim.dispose();\n-    }\n-}\n\\ No newline at end of file\n+    end(eim);\n+}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function scheduledTimeout(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "0ddc29268fb9768604747a71cd66c9479b48db0b", "filename": "scripts/event/Subway.js", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Subway.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Subway.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Subway.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -58,3 +58,37 @@ function arrived() {\n }\n \n function cancelSchedule() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "63a41ee2af112b64a59b068feffabc357a78587d", "filename": "scripts/event/Trains.js", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Trains.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/Trains.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Trains.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -67,3 +67,37 @@ function arrived() {\n }\n \n function cancelSchedule() {}\n+\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function dispose() {}\n+\n+function setup(eim, leaderid) {}\n+\n+function monsterValue(eim, mobid) {return 0;}\n+\n+function disbandParty(eim, player) {}\n+\n+function playerDisconnected(eim, player) {}\n+\n+function playerEntry(eim, player) {}\n+\n+function monsterKilled(mob, eim) {}\n+\n+function scheduledTimeout(eim) {}\n+\n+function afterSetup(eim) {}\n+\n+function changedLeader(eim, leader) {}\n+\n+function playerExit(eim, player) {}\n+\n+function leftParty(eim, player) {}\n+\n+function clearPQ(eim) {}\n+\n+function allMonstersDead(eim) {}\n+\n+function playerUnregistered(eim, player) {}\n+"}, {"sha": "ea5039fca9ecb7de55ed1520e6a3363f6e163a65", "filename": "scripts/event/s4aWorld.js", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/s4aWorld.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/event/s4aWorld.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/s4aWorld.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -116,4 +116,9 @@ function allMonstersDead(eim) {}\n \n function cancelSchedule() {}\n \n-function dispose() {}\n\\ No newline at end of file\n+function dispose() {}\n+\n+// ---------- FILLER FUNCTIONS ----------\n+\n+function changedLeader(eim, leader) {}\n+"}, {"sha": "7c93ee15c594ed97954d1cfcd406eae89c7cd9c8", "filename": "scripts/npc/1052125.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/1052125.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/1052125.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/1052125.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -61,7 +61,7 @@ function action(mode, type, selection) {\n                         if(cm.getPlayer().getLevel() > 50) {\n                                 cm.sendOk(\"The VIP area is available only for players #rlevel 50 or below#k.\");\n                         } else {\n-                                cm.sendOk(\"The VIP area is available via completing the #r'Admission to the VIP Zone'#k quest.\");\n+                                cm.sendOk(\"The VIP area only gets available after handing over #r#t4032521#s#k from the #b'Admission to the VIP Zone'#k quest.\");\n                         }\n                 } else {\n                         cm.sendOk(\"#rVIP#k? Yeah that is funny #rMr. VIP#k, now get lost before I call security.\"); "}, {"sha": "c684ffdf3db3b610bf18c9a99251860372f0e838", "filename": "scripts/npc/9201000.js", "status": "modified", "additions": 3, "deletions": 28, "changes": 31, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201000.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -32,18 +32,6 @@ var cost;\n \n var options;\n \n-function hasProofOfLoves(player) {\n-    var count = 0;\n-    \n-    for(var i = 4031367; i <= 4031372; i++) {\n-        if(player.haveItem(i)) {\n-            count++;\n-        }\n-    }\n-    \n-    return count >= 4;\n-}\n-\n function hasEngagementBox(player) {\n     for(var i = 2240000; i <= 2240003; i++) {\n         if(player.haveItem(i)) {\n@@ -80,21 +68,9 @@ function action(mode, type, selection) {\n                 if(!cm.isQuestCompleted(100400)) {\n                     if(!cm.isQuestStarted(100400)) {\n                         state = 0;\n-                        cm.sendAcceptDecline(\"So you want to make a engagement ring, huh? Very well, I can provide one for you if you pass my test. Certainly you must have already seen #rNanas, the fairies of Love#k, around the Maple world. From 4 of them, collect #b4 #t4031367#'s#k and bring them here. Only then I'll accept you as a proper ring holder. Are you up to it?\");\n+                        cm.sendNext(\"So you want to make a engagement ring, huh? Very well, I can provide one after you receive #rblessings#k from your #b#p9201003##k.\");\n                     } else {\n-                        if(!hasProofOfLoves(cm.getPlayer())) {\n-                            cm.sendOk(\"Please bring here #b4 #t4031367#'s#k. That's a must for me to accept you as a proper holder for the wedding ring.\");\n-                        } else {\n-                            cm.completeQuest(100400);\n-                            cm.gainExp(20000 * cm.getPlayer().getExpRate());\n-\n-                            for(var i = 4031367; i <= 4031372; i++) {\n-                                cm.removeAll(i);\n-                            }\n-\n-                            cm.sendOk(\"You brought the #t4031367#'s, good. From now on you are eligible for holding the rings I make. Talk to me again to start forging the kind of ring you want.\");\n-                        }\n-\n+                        cm.sendOk(\"Take the blessings from your #b#p9201003##k before trying to craft an engagement ring. They must be waiting for you at home, beyond #rHenesys hunting grounds#k.\");\n                         cm.dispose();\n                     }\n                 } else {\n@@ -129,9 +105,8 @@ function action(mode, type, selection) {\n             }\n         } else if(status == 2) {\n             if(state == 0) {\n+                cm.sendOk(\"Where do they live, you ask? My, it goes way back... you see, I'm a friend of theirs, and I was the one who crafted and personally delivered their engagement ring. They live beyond #rHenesys Hunting Grounds#k, I'm sure you know where it is.\");\n                 cm.startQuest(100400);\n-                cm.sendOk(\"Very well, then go after these #t4031367#'s. I will be waiting here.\");\n-                \n                 cm.dispose();\n             } else {\n                 var itemSet = new Array(2240000,2240001,2240002,2240003);"}, {"sha": "af2a3c6ecbbfc3c760d1bfa87de2a37772839fe9", "filename": "scripts/npc/9201003.js", "status": "modified", "additions": 46, "deletions": 35, "changes": 81, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201003.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -22,9 +22,23 @@\n /**\n  *9201003.js - Mom and Dad\n  *@author Jvlaple\n+ *@author Ronan\n  */\n var numberOfLoves = 0;\n-var status = 0;\n+var status = -1;\n+var state = 0;\n+\n+function hasProofOfLoves(player) {\n+    var count = 0;\n+    \n+    for(var i = 4031367; i <= 4031372; i++) {\n+        if(player.haveItem(i)) {\n+            count++;\n+        }\n+    }\n+    \n+    return count >= 4;\n+}\n \n function start() {\n     status = -1;\n@@ -35,53 +49,50 @@ function action(mode, type, selection) {\n     if (mode == -1) {\n         cm.dispose();\n     } else {\n-        if (mode == 0 && status == 0) {\n+        if (mode == 0 && type > 0) {\n             cm.dispose();\n             return;\n         }\n         if (mode == 1)\n             status++;\n         else\n             status--;\n-        if (cm.getPlayer().getMarriageQuestLevel() == 51) {\n-            if (status == 0) {\n-                if (cm.getPlayer().getGender() == 0) {\n-                    cm.sendYesNo(\"Hello my child. Are you sure that you want to get married to this girl? I believe in love at first sight, but this is rather sudden... I don't think we are ready for this. Lets think about it. Do you really love this girl?\");\n+\n+        if (status == 0) {\n+            if (!cm.isQuestStarted(100400)) {\n+                cm.sendOk(\"Hello we're Mom and Dad...\");\n+                cm.dispose();\n+            } else {\n+                if (cm.getQuestProgress(100400, 1) == 0) {\n+                    cm.sendNext(\"Mom, dad, I have a request to do to both of you... I wanna know more about the path you've already been walking since always, the path of loving and caring for someone dear to me.\", 2);\n                 } else {\n-                    cm.sendYesNo(\"Hello my child. Are you sure that you want to get married to this man? I believe in love at first sight, but this is rather sudden... I don't think we are ready for this. Lets think about it. Do you really love this man?\");\n+                    if(!hasProofOfLoves(cm.getPlayer())) {\n+                        cm.sendOk(\"Dear, we need to make sure you are really ready to fall in love with whoever you choose to be your partner, please bring here #b4 #t4031367#'s#k.\");\n+                        cm.dispose();\n+                    } else {\n+                        cm.sendNext(\"#b#h0##k, you made us proud today. You may now have #rour blessings#k to choose whoever you like to be your fiancee. You may now consult #p9201000#, the Wedding Jeweler. Have a sooth, loving and caring journey ahead~~\");\n+                        state = 1;\n+                    }\n                 }\n-            } else if (status == 1) {\n-                cm.getPlayer().addMarriageQuestLevel();\n-                cm.sendNext(\"Okay then. Go back to town and collect two more #bProof of Loves#k to prove it.\");\n-                cm.dispose();\n             }\n-        } else if (cm.getPlayer().getMarriageQuestLevel() == 52) {\n-            if (status == 0) {\n-                numberOfLoves += cm.getPlayer().countItem(4031367);\n-                numberOfLoves += cm.getPlayer().countItem(4031368);\n-                numberOfLoves += cm.getPlayer().countItem(4031369);\n-                numberOfLoves += cm.getPlayer().countItem(4031370);\n-                numberOfLoves += cm.getPlayer().countItem(4031371);\n-                numberOfLoves += cm.getPlayer().countItem(4031372);\n-                if (numberOfLoves >= 2) {\n-                    cm.sendNext(\"Wow, you really are serious! Okay then, here is our blessing.\");\n-                } else {\n-                    cm.sendNext(\"Come back when you get two #bProof of Loves#k.\");\n-                    cm.dispose();\n+        } else if (status == 1) {\n+            if (state == 0) {\n+                cm.sendNextPrev(\"My dear! How thoughtful of you asking our help. Surely we will help you out!\");\n+            } else {\n+                cm.sendOk(\"Mom... Dad... Thanks a lot for your tender support!!!\", 2);\n+                \n+                cm.completeQuest(100400);\n+                cm.gainExp(20000 * cm.getPlayer().getExpRate());\n+                for(var i = 4031367; i <= 4031372; i++) {\n+                    cm.removeAll(i);\n                 }\n-            } else if (status == 1) {\n-                cm.getPlayer().addMarriageQuestLevel();\n-                cm.removeAll(4031367);\n-                cm.removeAll(4031368);\n-                cm.removeAll(4031369);\n-                cm.removeAll(4031370);\n-                cm.removeAll(4031371);\n-                cm.removeAll(4031372);\n-                cm.gainItem(4031373, 1);\n+                \n                 cm.dispose();\n             }\n-        } else {\n-            cm.sendOk(\"Hello we're Mom and Dad...\");\n+        } else if (status == 2) {\n+            cm.sendNextPrev(\"Certainly you must have already seen #rNanas, the fairies of Love#k, around the Maple world. From 4 of them, collect #b4 #t4031367#'s#k and bring them here. This journey shall clear some questions you may have about love...\");\n+        } else if (status == 3) {\n+            cm.setQuestProgress(100400, 1, 1);\n             cm.dispose();\n         }\n     }"}, {"sha": "f306a913cfe50680857b25ccd40a0a5323c2b12c", "filename": "scripts/npc/9201004.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9201004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201004.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -78,7 +78,7 @@ function action(mode, type, selection) {\n         } else if(status == 1) {\n             switch(selection) {\n                 case 0:\n-                    cm.sendOk(\"The #bengagement process#k is as straightforward as it can be. Firstly one must start a prequest from the #bring maker, #p9201000##k. They must gather #b#t4031367#'s#k thoughout the Maple world.\\r\\nFrom the completion of the quest, the player will gain an engagement ring. With that in hand, declare yourself to someone you become fond of. Then, hope the person accepts your proposal.\");\n+                    cm.sendOk(\"The #bengagement process#k is as straightforward as it can be. Starting from a prequest from the #bring maker, #p9201000##k, gather #b#t4031367#'s#k thoughout the Maple world.\\r\\n\\r\\nCompleting it, you will be able to craft an engagement ring. With one in hands, declare yourself to someone you become fond of, and hope that person feels the same way.\");\n                     cm.dispose();\n                     break;\n                     "}, {"sha": "d0136b8e9cfdc7771c881aa0931bde558537283a", "filename": "scripts/npc/9977777.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9977777.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/9977777.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9977777.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -47,6 +47,7 @@ function writeFeatureTab_PQs() {\n         addFeature(\"Brand-new PQs: BossRushPQ, CafePQ.\");\n         addFeature(\"Mu Lung Dojo.\");\n         addFeature(\"Capt. Latanica with party fighting the boss.\");\n+        addFeature(\"Filled up missing obligatory event script methods.\");\n }\n \n function writeFeatureTab_Skills() {\n@@ -90,6 +91,7 @@ function writeFeatureTab_CashItems() {\n         addFeature(\"EXP/DROP/Cosmetic Coupons.\");\n         addFeature(\"EXP/DROP Coupon as buff effect during active time.\");\n         addFeature(\"Great deal of cash items functional.\");\n+        addFeature(\"Proper depletion of picked slot for usable cash items.\");\n         addFeature(\"Code coupons functional, with multi-items support.\");\n         addFeature(\"Merged unique ids for pets, rings and cash items.\");\n         addFeature(\"MapleTV mechanics stabilized and split by world.\");\n@@ -206,6 +208,7 @@ function writeFeatureTab_Serverpotentials() {\n \n function writeFeatureTab_Commands() {\n         addFeature(\"Spawn Zakum/Horntail/Pinkbean.\");\n+        addFeature(\"Permanent NPCs & mobs.\");\n         addFeature(\"Several new commands.\");\n         addFeature(\"Rank command highlighting users by world or overall.\");\n         addFeature(\"Server commands layered by GM levels.\");"}, {"sha": "5e6b2a946102c62d1ed96ff9b580f199eaebda2f", "filename": "scripts/npc/credits.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/credits.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/scripts/npc/credits.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/credits.js?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -39,6 +39,7 @@ function writeServerStaff_HeavenMS() {\n         addPerson(\"Thora\", \"Contributor\");\n         addPerson(\"GabrielSin\", \"Contributor\");\n         addPerson(\"Masterrulax\", \"Contributor\");\n+        addPerson(\"MedicOP\", \"Adjunct Developer\");\n         \n         setHistory(2015, 2018);\n }"}, {"sha": "e8eed3bb75007d719d8f18592dd4cc1e03a8cc21", "filename": "sql/db_database.sql", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -16519,6 +16519,25 @@ CREATE TABLE IF NOT EXISTS `playernpcs_field` (\n   PRIMARY KEY (`id`)\n ) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n \n+CREATE TABLE IF NOT EXISTS `plife` (\n+  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n+  `world` int(11) NOT NULL DEFAULT '-1',\n+  `map` int(11) NOT NULL DEFAULT '0',\n+  `life` int(11) NOT NULL DEFAULT '0',\n+  `type` varchar(1) NOT NULL DEFAULT 'n',\n+  `cy` int(11) NOT NULL DEFAULT '0',\n+  `f` int(11) NOT NULL DEFAULT '0',\n+  `fh` int(11) NOT NULL DEFAULT '0',\n+  `rx0` int(11) NOT NULL DEFAULT '0',\n+  `rx1` int(11) NOT NULL DEFAULT '0',\n+  `x` int(11) NOT NULL DEFAULT '0',\n+  `y` int(11) NOT NULL DEFAULT '0',\n+  `hide` int(11) NOT NULL DEFAULT '0',\n+  `mobtime` int(11) NOT NULL DEFAULT '0',\n+  `team` int(11) NOT NULL DEFAULT '0',\n+  PRIMARY KEY (`id`)\n+) ENGINE=InnoDB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1 ;\n+\n CREATE TABLE IF NOT EXISTS `questactions` (\n   `questactionid` int(10) unsigned NOT NULL AUTO_INCREMENT,\n   `questid` int(11) NOT NULL DEFAULT '0',"}, {"sha": "ab1c780077a69b5951ba60b5f77d33853ebc8f9d", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -4362,6 +4362,11 @@ public int getRawDropRate() {\n         return dropRate / (dropCoupon * getWorldServer().getDropRate());\n     }\n     \n+    public int getBossDropRate() {\n+        World w = getWorldServer();\n+        return (dropRate / w.getDropRate()) * w.getBossDropRate();\n+    }\n+    \n     public int getMesoRate() {\n         return mesoRate;\n     }\n@@ -5545,7 +5550,7 @@ public boolean couldBuyback() {  // Ronan's buyback system\n         long timeNow = Server.getInstance().getCurrentTime();\n         \n         if (timeNow - lastDeathtime > ServerConstants.BUYBACK_RETURN_MINUTES * 60 * 1000) {\n-            this.dropMessage(5, \"The time available to decide has expired, therefore you are unable to buyback.\");\n+            this.dropMessage(5, \"The period of time to decide has expired, therefore you are unable to buyback.\");\n             return false;\n         }\n         "}, {"sha": "50f77e86aab7fd541b7b5bc2b907a18c1bda1668", "filename": "src/client/MapleClient.java", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/MapleClient.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/MapleClient.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleClient.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -989,6 +989,11 @@ private void disconnectInternal(boolean shutdown, boolean cashshop) {//once per\n \t\t\t\n                         clear();\n \t\t} else {\n+                        if (session.containsAttribute(MapleClient.CLIENT_KEY)) {\n+                                MapleSessionCoordinator.getInstance().closeSession(session, false);\n+                                session.removeAttribute(MapleClient.CLIENT_KEY);\n+                        }\n+                    \n                         engines.clear();\n                 }\n \t}"}, {"sha": "3d6570b21fc0004397bf43fa1dad692fcc2eadb5", "filename": "src/client/command/CommandsExecutor.java", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/CommandsExecutor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/CommandsExecutor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/CommandsExecutor.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -81,6 +81,18 @@ private CommandsExecutor(){\n     }\n     \n     public void handle(MapleClient client, String message){\n+            if (client.tryacquireClient()) {\n+            try {\n+                handleInternal(client, message);\n+            } finally {\n+                client.releaseClient();\n+            }\n+        } else {\n+            client.getPlayer().dropMessage(5, \"Try again in a while... Latest commands are currently being processed.\");\n+        }\n+    }\n+    \n+    private void handleInternal(MapleClient client, String message){\n         final String[] spitedMessage = message.toLowerCase().substring(1).split(\"[ ]\");\n         final String commandName = spitedMessage[0];\n         final RegisteredCommand command = registeredCommands.get(commandName);\n@@ -321,8 +333,12 @@ private void registerLv4Commands(){\n         addCommand(\"pap\", 4, PapCommand.class);\n         addCommand(\"pianus\", 4, PianusCommand.class);\n         addCommand(\"cake\", 4, CakeCommand.class);\n-        addCommand(\"playernpcremove\", 4, PlayerNpcRemoveCommand.class);\n         addCommand(\"playernpc\", 4, PlayerNpcCommand.class);\n+        addCommand(\"playernpcremove\", 4, PlayerNpcRemoveCommand.class);\n+        addCommand(\"pnpc\", 4, PnpcCommand.class);\n+        addCommand(\"pnpcremove\", 4, PnpcRemoveCommand.class);\n+        addCommand(\"pmob\", 4, PmobCommand.class);\n+        addCommand(\"pmobremove\", 4, PmobRemoveCommand.class);\n         \n         commandsNameDesc.add(levelCommandsCursor);\n     }"}, {"sha": "4ae23dc7793d3283c0e59a1f9c6b00c34b799c90", "filename": "src/client/command/commands/gm0/RatesCommand.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm0/RatesCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm0/RatesCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/RatesCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -42,6 +42,7 @@ public void execute(MapleClient c, String[] params) {\n         showMsg_ += \"EXP Rate: #e#b\" + player.getExpRate() + \"x#k#n\" + \"\\r\\n\";\n         showMsg_ += \"MESO Rate: #e#b\" + player.getMesoRate() + \"x#k#n\" + \"\\r\\n\";\n         showMsg_ += \"DROP Rate: #e#b\" + player.getDropRate() + \"x#k#n\" + \"\\r\\n\";\n+        showMsg_ += \"BOSS DROP Rate: #e#b\" + player.getBossDropRate() + \"x#k#n\" + \"\\r\\n\";\n         if(ServerConstants.USE_QUEST_RATE) showMsg_ += \"QUEST Rate: #e#b\" + c.getWorldServer().getQuestRate() + \"x#k#n\" + \"\\r\\n\";\n \n         player.showHint(showMsg_, 300);"}, {"sha": "e1bf0064778fc8d7dbbbb26599d9b17e51cf0bcf", "filename": "src/client/command/commands/gm0/ShowRatesCommand.java", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm0/ShowRatesCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm0/ShowRatesCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm0/ShowRatesCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -37,30 +37,36 @@\n     public void execute(MapleClient c, String[] params) {\n         MapleCharacter player = c.getPlayer();\n         String showMsg = \"#eEXP RATE#n\" + \"\\r\\n\";\n-        showMsg += \"Server EXP Rate: #k\" + c.getWorldServer().getExpRate() + \"x#k\" + \"\\r\\n\";\n+        showMsg += \"World EXP Rate: #k\" + c.getWorldServer().getExpRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"Player EXP Rate: #k\" + player.getRawExpRate() + \"x#k\" + \"\\r\\n\";\n         if(player.getCouponExpRate() != 1) showMsg += \"Coupon EXP Rate: #k\" + player.getCouponExpRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"EXP Rate: #e#b\" + player.getExpRate() + \"x#k#n\" + \"\\r\\n\";\n \n         showMsg += \"\\r\\n\" + \"#eMESO RATE#n\" + \"\\r\\n\";\n-        showMsg += \"Server MESO Rate: #k\" + c.getWorldServer().getMesoRate() + \"x#k\" + \"\\r\\n\";\n+        showMsg += \"World MESO Rate: #k\" + c.getWorldServer().getMesoRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"Player MESO Rate: #k\" + player.getRawMesoRate() + \"x#k\" + \"\\r\\n\";\n         if(player.getCouponMesoRate() != 1) showMsg += \"Coupon MESO Rate: #k\" + player.getCouponMesoRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"MESO Rate: #e#b\" + player.getMesoRate() + \"x#k#n\" + \"\\r\\n\";\n \n         showMsg += \"\\r\\n\" + \"#eDROP RATE#n\" + \"\\r\\n\";\n-        showMsg += \"Server DROP Rate: #k\" + c.getWorldServer().getDropRate() + \"x#k\" + \"\\r\\n\";\n+        showMsg += \"World DROP Rate: #k\" + c.getWorldServer().getDropRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"Player DROP Rate: #k\" + player.getRawDropRate() + \"x#k\" + \"\\r\\n\";\n         if(player.getCouponDropRate() != 1) showMsg += \"Coupon DROP Rate: #k\" + player.getCouponDropRate() + \"x#k\" + \"\\r\\n\";\n         showMsg += \"DROP Rate: #e#b\" + player.getDropRate() + \"x#k#n\" + \"\\r\\n\";\n+        \n+        showMsg += \"\\r\\n\" + \"#eBOSS DROP RATE#n\" + \"\\r\\n\";\n+        showMsg += \"World BOSS DROP Rate: #k\" + c.getWorldServer().getBossDropRate() + \"x#k\" + \"\\r\\n\";\n+        showMsg += \"Player DROP Rate: #k\" + player.getRawDropRate() + \"x#k\" + \"\\r\\n\";\n+        if(player.getCouponDropRate() != 1) showMsg += \"Coupon DROP Rate: #k\" + player.getCouponDropRate() + \"x#k\" + \"\\r\\n\";\n+        showMsg += \"BOSS DROP Rate: #e#b\" + player.getBossDropRate() + \"x#k#n\" + \"\\r\\n\";\n \n         if(ServerConstants.USE_QUEST_RATE) {\n             showMsg += \"\\r\\n\" + \"#eQUEST RATE#n\" + \"\\r\\n\";\n-            showMsg += \"Server QUEST Rate: #e#b\" + c.getWorldServer().getQuestRate() + \"x#k#n\" + \"\\r\\n\";\n+            showMsg += \"World QUEST Rate: #e#b\" + c.getWorldServer().getQuestRate() + \"x#k#n\" + \"\\r\\n\";\n         }\n         \n-        showMsg += \"\\r\\n\" + \"#eTRAVEL RATE#n\" + \"\\r\\n\";\n-        showMsg += \"Server TRAVEL Rate: #e#b\" + c.getWorldServer().getTravelRate() + \"x#k#n\" + \"\\r\\n\";\n+        showMsg += \"\\r\\n\";\n+        showMsg += \"World TRAVEL Rate: #e#b\" + c.getWorldServer().getTravelRate() + \"x#k#n\" + \"\\r\\nServer\\r\\nPlayer\";\n \n         player.showHint(showMsg, 300);\n     }"}, {"sha": "cd1eecee991810adb525e94218dd9e98c2d4d8b5", "filename": "src/client/command/commands/gm1/WhatDropsFromCommand.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm1/WhatDropsFromCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm1/WhatDropsFromCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhatDropsFromCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -62,7 +62,7 @@ public void execute(MapleClient c, String[] params) {\n                         if (name == null || name.equals(\"null\") || drop.chance == 0){\n                             continue;\n                         }\n-                        float chance = 1000000 / drop.chance / player.getDropRate();\n+                        float chance = 1000000 / drop.chance / (!MapleMonsterInformationProvider.getInstance().isBoss(mobId) ? player.getDropRate() : player.getBossDropRate());\n                         output += \"- \" + name + \" (1/\" + (int) chance + \")\\r\\n\";\n                     } catch (Exception ex){\n                         ex.printStackTrace();"}, {"sha": "8da3801911062a7327442a80d2b0f3781a0d0d13", "filename": "src/client/command/commands/gm1/WhoDropsCommand.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm1/WhoDropsCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm1/WhoDropsCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm1/WhoDropsCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -29,7 +29,6 @@\n import server.MapleItemInformationProvider;\n import server.life.MapleMonsterInformationProvider;\n import tools.DatabaseConnection;\n-import tools.MaplePacketCreator;\n import tools.Pair;\n \n import java.sql.Connection;\n@@ -66,7 +65,7 @@ public void execute(MapleClient c, String[] params) {\n                             ps.setInt(1, data.getLeft());\n                             ResultSet rs = ps.executeQuery();\n                             while(rs.next()) {\n-                                String resultName = MapleMonsterInformationProvider.getMobNameFromID(rs.getInt(\"dropperid\"));\n+                                String resultName = MapleMonsterInformationProvider.getInstance().getMobNameFromId(rs.getInt(\"dropperid\"));\n                                 if (resultName != null) {\n                                     output += resultName + \", \";\n                                 }"}, {"sha": "0d7da1c89af11e2092ca6b15a5583d180bd769f7", "filename": "src/client/command/commands/gm4/PmobCommand.java", "status": "added", "additions": 105, "deletions": 0, "changes": 105, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PmobCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PmobCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PmobCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,105 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Ronan\n+*/\n+package client.command.commands.gm4;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+\n+import net.server.channel.Channel;\n+import server.life.MapleLifeFactory;\n+import server.maps.MapleMap;\n+import client.command.Command;\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import java.awt.Point;\n+import server.life.MapleMonster;\n+import tools.DatabaseConnection;\n+\n+public class PmobCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        if (params.length < 1) {\n+            player.yellowMessage(\"Syntax: !pmob <mobid> [<mobtime>]\");\n+            return;\n+        }\n+\n+        // command suggestion thanks to HighKey21, none, bibiko94 (TAYAMO), asafgb\n+        int mapId = player.getMapId();\n+        int mobId = Integer.parseInt(params[0]);\n+        int mobTime = (params.length > 1) ? Integer.parseInt(params[1]) : -1;\n+        \n+        Point checkpos = player.getMap().getGroundBelow(player.getPosition());\n+        int xpos = checkpos.x;\n+        int ypos = checkpos.y;\n+        int fh = player.getMap().getFootholds().findBelow(checkpos).getId();\n+        \n+        MapleMonster mob = MapleLifeFactory.getMonster(mobId);\n+        if (mob != null && !mob.getName().equals(\"MISSINGNO\")) {\n+            mob.setPosition(checkpos);\n+            mob.setCy(ypos);\n+            mob.setRx0(xpos + 50);\n+            mob.setRx1(xpos - 50);\n+            mob.setFh(fh);\n+            try {\n+                Connection con = DatabaseConnection.getConnection();\n+                PreparedStatement ps = con.prepareStatement(\"INSERT INTO plife ( life, f, fh, cy, rx0, rx1, type, x, y, world, map, mobtime, hide ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )\");\n+                ps.setInt(1, mobId);\n+                ps.setInt(2, 0);\n+                ps.setInt(3, fh);\n+                ps.setInt(4, ypos);\n+                ps.setInt(5, xpos + 50);\n+                ps.setInt(6, xpos - 50);\n+                ps.setString(7, \"m\");\n+                ps.setInt(8, xpos);\n+                ps.setInt(9, ypos);\n+                ps.setInt(10, player.getWorld());\n+                ps.setInt(11, mapId);\n+                ps.setInt(12, mobTime);\n+                ps.setInt(13, 0);\n+                ps.executeUpdate();\n+                ps.close();\n+                con.close();\n+                \n+                for (Channel ch: player.getWorldServer().getChannels()) {\n+                    MapleMap map = ch.getMapFactory().getMap(mapId);\n+                    map.addMonsterSpawn(mob, mobTime, -1);\n+                    map.addAllMonsterSpawn(mob, mobTime, -1);\n+                }\n+                \n+                player.yellowMessage(\"Pmob created.\");\n+            } catch (SQLException e) {\n+                e.printStackTrace();\n+                player.dropMessage(5, \"Failed to store pmob in the database.\");\n+            }\n+        } else {\n+            player.dropMessage(5, \"You have entered an invalid mob id.\");\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "e9222ccae8f76f6eec647f7193d21acfad2842f1", "filename": "src/client/command/commands/gm4/PmobRemoveCommand.java", "status": "added", "additions": 114, "deletions": 0, "changes": 114, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PmobRemoveCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PmobRemoveCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PmobRemoveCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,114 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Ronan\n+*/\n+package client.command.commands.gm4;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+import net.server.channel.Channel;\n+import server.maps.MapleMap;\n+import client.command.Command;\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import java.awt.Point;\n+import tools.DatabaseConnection;\n+import tools.Pair;\n+\n+public class PmobRemoveCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        \n+        int mapId = player.getMapId();\n+        int mobId = params.length > 0 ? Integer.parseInt(params[0]) : -1;\n+        \n+        Point pos = player.getPosition();\n+        int xpos = pos.x;\n+        int ypos = pos.y;\n+        \n+        List<Pair<Integer, Pair<Integer, Integer>>> toRemove = new LinkedList<>();\n+        try {\n+            Connection con = DatabaseConnection.getConnection();\n+            PreparedStatement ps;\n+            \n+            if (mobId > -1) {\n+                String select = \"SELECT * FROM plife WHERE world = ? AND map = ? AND type LIKE ? AND life = ?\";\n+                ps = con.prepareStatement(select, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);\n+                ps.setInt(1, player.getWorld());\n+                ps.setInt(2, mapId);\n+                ps.setString(3, \"m\");\n+                ps.setInt(4, mobId);\n+            } else {\n+                String select = \"SELECT * FROM plife WHERE world = ? AND map = ? AND type LIKE ? AND x >= ? AND x <= ? AND y >= ? AND y <= ?\";\n+                ps = con.prepareStatement(select, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);\n+                ps.setInt(1, player.getWorld());\n+                ps.setInt(2, mapId);\n+                ps.setString(3, \"m\");\n+                ps.setInt(4, xpos - 50);\n+                ps.setInt(5, xpos + 50);\n+                ps.setInt(6, ypos - 50);\n+                ps.setInt(7, ypos + 50);\n+            }\n+            \n+            ResultSet rs = ps.executeQuery();\n+            while (true) {\n+                rs.beforeFirst();\n+                if (!rs.next()) {\n+                    break;\n+                }\n+                \n+                toRemove.add(new Pair<>(rs.getInt(\"life\"), new Pair<>(rs.getInt(\"x\"), rs.getInt(\"y\"))));\n+                rs.deleteRow();\n+            }\n+            \n+            rs.close();\n+            ps.close();\n+            con.close();\n+        } catch (SQLException e) {\n+            e.printStackTrace();\n+            player.dropMessage(5, \"Failed to remove pmob from the database.\");\n+        }\n+        \n+        if (!toRemove.isEmpty()) {\n+            for (Channel ch: player.getWorldServer().getChannels()) {\n+                MapleMap map = ch.getMapFactory().getMap(mapId);\n+\n+                for (Pair<Integer, Pair<Integer, Integer>> r : toRemove) {\n+                    map.removeMonsterSpawn(r.getLeft(), r.getRight().getLeft(), r.getRight().getRight());\n+                    map.removeAllMonsterSpawn(r.getLeft(), r.getRight().getLeft(), r.getRight().getRight());\n+                }\n+            }\n+        }\n+        \n+        player.yellowMessage(\"Cleared \" + toRemove.size() + \" pmob placements.\");\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "f9c7c4bf13566f5afe66365f738a3a94ff5e7037", "filename": "src/client/command/commands/gm4/PnpcCommand.java", "status": "added", "additions": 112, "deletions": 0, "changes": 112, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PnpcCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PnpcCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PnpcCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,112 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Ronan\n+*/\n+package client.command.commands.gm4;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+\n+import net.server.channel.Channel;\n+import server.life.MapleLifeFactory;\n+import server.life.MapleNPC;\n+import client.command.Command;\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import java.awt.Point;\n+import server.maps.MapleMap;\n+import tools.DatabaseConnection;\n+import tools.MaplePacketCreator;\n+\n+public class PnpcCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        if (params.length < 1) {\n+            player.yellowMessage(\"Syntax: !pnpc <npcid>\");\n+            return;\n+        }\n+        \n+        // command suggestion thanks to HighKey21, none, bibiko94 (TAYAMO), asafgb\n+        int mapId = player.getMapId();\n+        int npcId = Integer.parseInt(params[0]);\n+        if (player.getMap().containsNPC(npcId)) {\n+            player.dropMessage(5, \"This map already contains the specified NPC.\");\n+            return;\n+        }\n+        \n+        MapleNPC npc = MapleLifeFactory.getNPC(npcId);\n+        \n+        Point checkpos = player.getMap().getGroundBelow(player.getPosition());\n+        int xpos = checkpos.x;\n+        int ypos = checkpos.y;\n+        int fh = player.getMap().getFootholds().findBelow(checkpos).getId();\n+        \n+        if (npc != null && !npc.getName().equals(\"MISSINGNO\")) {\n+            try {\n+                Connection con = DatabaseConnection.getConnection();\n+                PreparedStatement ps = con.prepareStatement(\"INSERT INTO plife ( life, f, fh, cy, rx0, rx1, type, x, y, world, map, mobtime, hide ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )\");\n+                ps.setInt(1, npcId);\n+                ps.setInt(2, 0);\n+                ps.setInt(3, fh);\n+                ps.setInt(4, ypos);\n+                ps.setInt(5, xpos + 50);\n+                ps.setInt(6, xpos - 50);\n+                ps.setString(7, \"n\");\n+                ps.setInt(8, xpos);\n+                ps.setInt(9, ypos);\n+                ps.setInt(10, player.getWorld());\n+                ps.setInt(11, mapId);\n+                ps.setInt(12, -1);\n+                ps.setInt(13, 0);\n+                ps.executeUpdate();\n+                ps.close();\n+                con.close();\n+                \n+                for (Channel ch: player.getWorldServer().getChannels()) {\n+                    npc = MapleLifeFactory.getNPC(npcId);\n+                    npc.setPosition(checkpos);\n+                    npc.setCy(ypos);\n+                    npc.setRx0(xpos + 50);\n+                    npc.setRx1(xpos - 50);\n+                    npc.setFh(fh);\n+                    \n+                    MapleMap map = ch.getMapFactory().getMap(mapId);\n+                    map.addMapObject(npc);\n+                    map.broadcastMessage(MaplePacketCreator.spawnNPC(npc));\n+                }\n+\n+                player.yellowMessage(\"Pnpc created.\");\n+            } catch (SQLException e) {\n+                e.printStackTrace();\n+                player.dropMessage(5, \"Failed to store pNPC in the database.\");\n+            }\n+        } else {\n+            player.dropMessage(5, \"You have entered an invalid NPC id.\");\n+        }\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "f3ca9aa89aeb79c53c9aab642c5c02a9cf52fa0f", "filename": "src/client/command/commands/gm4/PnpcRemoveCommand.java", "status": "added", "additions": 113, "deletions": 0, "changes": 113, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PnpcRemoveCommand.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/command/commands/gm4/PnpcRemoveCommand.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/command/commands/gm4/PnpcRemoveCommand.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,113 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server, commands OdinMS-based\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+/*\n+   @Author: Ronan\n+*/\n+package client.command.commands.gm4;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+\n+import net.server.channel.Channel;\n+import client.command.Command;\n+import client.MapleCharacter;\n+import client.MapleClient;\n+import java.awt.Point;\n+import java.sql.ResultSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import server.maps.MapleMap;\n+import tools.DatabaseConnection;\n+import tools.Pair;\n+\n+public class PnpcRemoveCommand extends Command {\n+    {\n+        setDescription(\"\");\n+    }\n+\n+    @Override\n+    public void execute(MapleClient c, String[] params) {\n+        MapleCharacter player = c.getPlayer();\n+        \n+        int mapId = player.getMapId();\n+        int npcId = params.length > 0 ? Integer.parseInt(params[0]) : -1;\n+        \n+        Point pos = player.getPosition();\n+        int xpos = pos.x;\n+        int ypos = pos.y;\n+        \n+        List<Pair<Integer, Pair<Integer, Integer>>> toRemove = new LinkedList<>();\n+        try {\n+            Connection con = DatabaseConnection.getConnection();\n+            PreparedStatement ps;\n+            \n+            if (npcId > -1) {\n+                String select = \"SELECT * FROM plife WHERE world = ? AND map = ? AND type LIKE ? AND life = ?\";\n+                ps = con.prepareStatement(select, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);\n+                ps.setInt(1, player.getWorld());\n+                ps.setInt(2, mapId);\n+                ps.setString(3, \"n\");\n+                ps.setInt(4, npcId);\n+            } else {\n+                String select = \"SELECT * FROM plife WHERE world = ? AND map = ? AND type LIKE ? AND x >= ? AND x <= ? AND y >= ? AND y <= ?\";\n+                ps = con.prepareStatement(select, ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);\n+                ps.setInt(1, player.getWorld());\n+                ps.setInt(2, mapId);\n+                ps.setString(3, \"n\");\n+                ps.setInt(4, xpos - 50);\n+                ps.setInt(5, xpos + 50);\n+                ps.setInt(6, ypos - 50);\n+                ps.setInt(7, ypos + 50);\n+            }\n+            \n+            ResultSet rs = ps.executeQuery();\n+            while (true) {\n+                rs.beforeFirst();\n+                if (!rs.next()) {\n+                    break;\n+                }\n+                \n+                toRemove.add(new Pair<>(rs.getInt(\"life\"), new Pair<>(rs.getInt(\"x\"), rs.getInt(\"y\"))));\n+                rs.deleteRow();\n+            }\n+            \n+            rs.close();\n+            ps.close();\n+            con.close();\n+        } catch (SQLException e) {\n+            e.printStackTrace();\n+            player.dropMessage(5, \"Failed to remove pNPC from the database.\");\n+        }\n+        \n+        if (!toRemove.isEmpty()) {\n+            for (Channel ch: player.getWorldServer().getChannels()) {\n+                MapleMap map = ch.getMapFactory().getMap(mapId);\n+\n+                for (Pair<Integer, Pair<Integer, Integer>> r : toRemove) {\n+                    map.destroyNPC(r.getLeft());\n+                }\n+            }\n+        }\n+        \n+        player.yellowMessage(\"Cleared \" + toRemove.size() + \" pNPC placements.\");\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "9d02702184bdc7462cb279f00baed85d302294f0", "filename": "src/client/inventory/MaplePet.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/inventory/MaplePet.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/inventory/MaplePet.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/MaplePet.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -82,7 +82,7 @@ public static MaplePet loadFromDb(int itemid, short position, int petid) {\n         }\n     }\n     \n-    public static void deleteFromDb(int petid) {\n+    public static void deleteFromDb(MapleCharacter owner, int petid) {\n         try {\n             Connection con = DatabaseConnection.getConnection();\n             \n@@ -98,6 +98,7 @@ public static void deleteFromDb(int petid) {\n             \n             con.close();\n             \n+            owner.resetExcluded(petid);\n             MapleCashidGenerator.freeCashId(petid);\n         } catch (SQLException ex) {\n             ex.printStackTrace();"}, {"sha": "8e3c58ca1bcc4917b44e92d67b071a6ab5f49817", "filename": "src/client/inventory/manipulator/MapleInventoryManipulator.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/inventory/manipulator/MapleInventoryManipulator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/inventory/manipulator/MapleInventoryManipulator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/manipulator/MapleInventoryManipulator.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -391,7 +391,7 @@ public static void removeFromSlot(MapleClient c, MapleInventoryType type, short\n                     announceModifyInventory(c, item, fromDrop, allowZero);\n                 }\n                 \n-                MaplePet.deleteFromDb(petid);\n+                MaplePet.deleteFromDb(chr, petid);\n             } else {\n                 inv.removeItem(slot, quantity, allowZero);\n                 if(type != MapleInventoryType.CANHOLD) {"}, {"sha": "2dc76925583897b5be81c9b14570798f0f7876d9", "filename": "src/client/processor/SpawnPetProcessor.java", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/client/processor/SpawnPetProcessor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/client/processor/SpawnPetProcessor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/processor/SpawnPetProcessor.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -62,8 +62,7 @@ public static void processSpawnPet(MapleClient c, byte slot, boolean lead) {\n                         long expiration = chr.getInventory(MapleInventoryType.CASH).getItem(slot).getExpiration();\n                         MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, petid, (short) 1, false, false);\n                         MapleInventoryManipulator.addById(c, evolveid, (short) 1, null, petId, expiration);\n-                        MaplePet.deleteFromDb(petId);\n-\n+                        MaplePet.deleteFromDb(chr, petId);\n                         c.announce(MaplePacketCreator.enableActions());\n                         return;\n                     }"}, {"sha": "a9a5372cd620ac53250d9b58974130c897aceccd", "filename": "src/constants/ItemConstants.java", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/constants/ItemConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/constants/ItemConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ItemConstants.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -143,6 +143,10 @@ public static boolean isCleanSlate(int scrollId) {\n         return scrollId > 2048999 && scrollId < 2049004;\n     }\n     \n+    public static boolean isModifierScroll(int scrollId) {\n+        return scrollId == 2040727 || scrollId == 2041058;\n+    }\n+    \n     public static boolean isFlagModifier(int scrollId, byte flag) {\n         if(scrollId == 2041058 && ((flag & ItemConstants.COLD) == ItemConstants.COLD)) return true;\n         if(scrollId == 2040727 && ((flag & ItemConstants.SPIKES) == ItemConstants.SPIKES)) return true;"}, {"sha": "26a8ac20d7dc9e02246900502908a928c867ecc7", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -129,9 +129,10 @@\n     public static final boolean USE_WHOLE_SERVER_RANKING = false;   //Enables a ranking pool made from every character registered on the server for the \"ranks\" command, instead of separated by worlds.\n     \n     //Server Rates And Experience\n-    public static final int EXP_RATE = 10;\n+    public static final int EXP_RATE = 10;                          //NOTE: World-specific rates within \"world.ini\" OVERRIDES the default rates from here.\n     public static final int MESO_RATE = 10;\n     public static final int DROP_RATE = 10;\n+    public static final int BOSS_DROP_RATE = 10;                    //NOTE: Boss drop rate OVERRIDES common drop rate, for bosses-only.\n     public static final int QUEST_RATE = 5;                         //Multiplier for Exp & Meso gains when completing a quest. Only available when USE_QUEST_RATE is true. Stacks with server Exp & Meso rates.\n     public static final int TRAVEL_RATE = 10;                       //Means of transportation rides/departs using 1/N of the default time.\n     \n@@ -196,7 +197,7 @@\n     //Character Configuration\n     public static final boolean USE_ADD_SLOTS_BY_LEVEL = true;  //Slots are added each 20 levels.\n     public static final boolean USE_ADD_RATES_BY_LEVEL = true;  //Rates are added each 20 levels.\n-    public static final boolean USE_STACK_COUPON_RATES = true;  //Multiple coupons effects builds up together.\n+    public static final boolean USE_STACK_COUPON_RATES = false; //Multiple coupons effects builds up together.\n     public static final boolean USE_PERFECT_PITCH = true;       //For lvl 30 or above, each lvlup grants player 1 perfect pitch.\n     \n     //Quest Configuration\n@@ -239,6 +240,7 @@\n     public static final boolean PLAYERNPC_AUTODEPLOY = true;    //Makes PlayerNPC automatically deployed on the Hall of Fame at the instant one reaches max level. If false, eligible players must talk to 1st job instructor to deploy a NPC.\n     \n     //Pet Auto-Pot Configuration\n+    public static final boolean USE_COMPULSORY_AUTOPOT = true;  //Pets will consume as many potions as needed to fulfill the AUTOHP/MP ratio threshold.\n     public static final boolean USE_EQUIPS_ON_AUTOPOT = true;   //Player MaxHP and MaxMP check values on autopot handler will be updated by the HP/MP bonuses on equipped items.\n     public static final double PET_AUTOHP_RATIO = 0.99;         //Will automatically consume potions until given ratio of the MaxHP/MaxMP is reached.\n     public static final double PET_AUTOMP_RATIO = 0.99;"}, {"sha": "d73ed7568f8154444c691e27f821c9ed7311db46", "filename": "src/net/server/Server.java", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -394,13 +394,14 @@ private int initWorld(Properties p) {\n             int exprate = getWorldProperty(p, \"exprate\", i, ServerConstants.EXP_RATE);\n             int mesorate = getWorldProperty(p, \"mesorate\", i, ServerConstants.MESO_RATE);\n             int droprate = getWorldProperty(p, \"droprate\", i, ServerConstants.DROP_RATE);\n+            int bossdroprate = getWorldProperty(p, \"bossdroprate\", i, ServerConstants.BOSS_DROP_RATE);\n             int questrate = getWorldProperty(p, \"questrate\", i, ServerConstants.QUEST_RATE);\n             int travelrate = getWorldProperty(p, \"travelrate\", i, ServerConstants.TRAVEL_RATE);\n             \n             World world = new World(i,\n                     Integer.parseInt(p.getProperty(\"flag\" + i)),\n                     p.getProperty(\"eventmessage\" + i),\n-                    exprate, droprate, mesorate, questrate, travelrate);\n+                    exprate, droprate, bossdroprate, mesorate, questrate, travelrate);\n \n             worldRecommendedList.add(new Pair<>(i, p.getProperty(\"whyamirecommended\" + i)));\n             worlds.add(world);"}, {"sha": "746716040a7f1637f005ecb4f048a8295d418419", "filename": "src/net/server/channel/handlers/ChangeMapHandler.java", "status": "modified", "additions": 17, "deletions": 16, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/ChangeMapHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/ChangeMapHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ChangeMapHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -80,23 +80,24 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\t\tslea.readByte();\n \t\t\t\tboolean wheel = slea.readShort() > 0;\n \t\t\t\tif (targetid != -1 && !chr.isAlive()) {\n-\t\t\t\t\tboolean executeStandardPath = true;\n-\t\t\t\t\tif (chr.getEventInstance() != null) {\n-\t\t\t\t\t\texecuteStandardPath = chr.getEventInstance().revivePlayer(chr);\n-\t\t\t\t\t}\n-\t\t\t\t\tif (executeStandardPath) {\n-                                                MapleMap map = chr.getMap();\n+                                        MapleMap map = chr.getMap();\n+                                        if (wheel && chr.haveItemWithId(5510000, false)) {\n+                                                // thanks lucasziron for showing revivePlayer() also being triggered by Wheel\n                                                 \n-\t\t\t\t\t\tif (wheel && chr.haveItemWithId(5510000, false)) {\n-\t\t\t\t\t\t\tMapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, 5510000, 1, true, false);\n-\t\t\t\t\t\t\tchr.announce(MaplePacketCreator.showWheelsLeft(chr.getItemQuantity(5510000, false)));\n-                                                        \n-                                                        chr.updateHp(50);\n-                                                        chr.changeMap(map, map.getRandomPlayerSpawnpoint());\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tchr.respawn(map.getReturnMapId());\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n+                                                MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, 5510000, 1, true, false);\n+                                                chr.announce(MaplePacketCreator.showWheelsLeft(chr.getItemQuantity(5510000, false)));\n+\n+                                                chr.updateHp(50);\n+                                                chr.changeMap(map, map.findClosestPlayerSpawnpoint(chr.getPosition()));\n+                                        } else {\n+                                                boolean executeStandardPath = true;\n+                                                if (chr.getEventInstance() != null) {\n+                                                        executeStandardPath = chr.getEventInstance().revivePlayer(chr);\n+                                                }\n+                                                if (executeStandardPath) {\n+                                                        chr.respawn(map.getReturnMapId());\n+                                                }\n+                                        }\n \t\t\t\t} else if (targetid != -1) {\n                                         if(chr.isGM()) {\n                                                 MapleMap to = chr.getWarpMap(targetid);"}, {"sha": "305f09dd04c944a965daa5113984bc5db228addc", "filename": "src/net/server/channel/handlers/PetAutoPotHandler.java", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/PetAutoPotHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/PetAutoPotHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PetAutoPotHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -104,12 +104,16 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 incMp = stat.getMp();\n                 if(incMp <= 0 && hasMpGain) incMp = Math.ceil(maxMp * stat.getMpRate());\n                 \n-                if (hasHpGain) {\n-                    qtyCount = (int) Math.ceil(((ServerConstants.PET_AUTOHP_RATIO * maxHp) - curHp) / incHp);\n-                }\n-                \n-                if (hasMpGain) {\n-                    qtyCount = Math.max(qtyCount, (int) Math.ceil(((ServerConstants.PET_AUTOMP_RATIO * maxMp) - curMp) / incMp));\n+                if (ServerConstants.USE_COMPULSORY_AUTOPOT) {\n+                    if (hasHpGain) {\n+                        qtyCount = (int) Math.ceil(((ServerConstants.PET_AUTOHP_RATIO * maxHp) - curHp) / incHp);\n+                    }\n+\n+                    if (hasMpGain) {\n+                        qtyCount = Math.max(qtyCount, (int) Math.ceil(((ServerConstants.PET_AUTOMP_RATIO * maxMp) - curMp) / incMp));\n+                    }\n+                } else {\n+                    qtyCount = 1;   // non-compulsory autopot concept thanks to marcuswoon\n                 }\n \n                 while (true) {"}, {"sha": "527d9581c6aad20b37a5bb6b9b9bdc1c921fe237", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 54, "deletions": 47, "changes": 101, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -81,7 +81,25 @@ public final boolean validateState(MapleClient c) {\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         final int cid = slea.readInt();\n         final Server server = Server.getInstance();\n-        MapleCharacter player = c.getWorldServer().getPlayerStorage().getCharacterById(cid);\n+        \n+        World wserv = server.getWorld(c.getWorld());\n+        if(wserv == null) {\n+            c.disconnect(true, false);\n+            return;\n+        }\n+        \n+        Channel cserv = wserv.getChannel(c.getChannel());\n+        if(cserv == null) {\n+            c.setChannel(1);\n+            cserv = wserv.getChannel(c.getChannel());\n+            \n+            if(cserv == null) {\n+                c.disconnect(true, false);\n+                return;\n+            }\n+        }\n+        \n+        MapleCharacter player = wserv.getPlayerStorage().getCharacterById(cid);\n         boolean newcomer = false;\n         \n         IoSession session = c.getSession();\n@@ -106,40 +124,17 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n         } else {\n             remoteHwid = player.getClient().getHWID();\n-            c.setCharacterSlots((byte) player.getClient().getCharacterSlots());\n-            player.newClient(c);\n         }\n+        \n         if (player == null) { //If you are still getting null here then please just uninstall the game >.>, we dont need you fucking with the logs\n             c.disconnect(true, false);\n             return;\n         }\n         \n-        int hwidLen = remoteHwid.length();\n-        session.setAttribute(MapleClient.CLIENT_HWID, remoteHwid);\n-        session.setAttribute(MapleClient.CLIENT_NIBBLEHWID, remoteHwid.substring(hwidLen - 8, hwidLen));\n-        c.setHWID(remoteHwid);\n-        \n         c.setPlayer(player);\n         c.setAccID(player.getAccountID());\n         \n         boolean allowLogin = true;\n-        \n-        World world = server.getWorld(c.getWorld());\n-        if(world == null) {\n-            c.disconnect(true, false);\n-            return;\n-        }\n-        \n-        Channel cserv = world.getChannel(c.getChannel());\n-        if(cserv == null) {\n-            c.setChannel(1);\n-            cserv = world.getChannel(c.getChannel());\n-            \n-            if(cserv == null) {\n-                c.disconnect(true, false);\n-                return;\n-            }\n-        }\n \n         /*  is this check really necessary?\n         if (state == MapleClient.LOGIN_SERVER_TRANSITION || state == MapleClient.LOGIN_NOTLOGGEDIN) {\n@@ -149,7 +144,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             }\n             \n             for (String charName : charNames) {\n-                if(c.getWorldServer().getPlayerStorage().getCharacterByName(charName) != null) {\n+                if(wserv.getPlayerStorage().getCharacterByName(charName) != null) {\n                     allowLogin = false;\n                     break;\n                 }\n@@ -160,21 +155,35 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         c.lockClient(); // Sync this to prevent wrong login state for double channel changes\n         try {\n             int state = c.getLoginState();\n-            if (state == MapleClient.LOGIN_LOGGEDIN) {\n-                return;\n-            }\n             if (state != MapleClient.LOGIN_SERVER_TRANSITION || !allowLogin) {\n                 c.setPlayer(null);\n-                c.announce(MaplePacketCreator.getAfterLoginError(7));\n+                c.setAccID(0);\n+                \n+                if (state == MapleClient.LOGIN_LOGGEDIN) {\n+                    c.disconnect(true, false);\n+                } else {\n+                    c.announce(MaplePacketCreator.getAfterLoginError(7));\n+                }\n+                \n                 return;\n             }\n             c.updateLoginState(MapleClient.LOGIN_LOGGEDIN);\n         } finally {\n             c.unlockClient();\n         }\n         \n+        if (!newcomer) {\n+            c.setCharacterSlots((byte) player.getClient().getCharacterSlots());\n+            player.newClient(c);\n+        }\n+        \n+        int hwidLen = remoteHwid.length();\n+        session.setAttribute(MapleClient.CLIENT_HWID, remoteHwid);\n+        session.setAttribute(MapleClient.CLIENT_NIBBLEHWID, remoteHwid.substring(hwidLen - 8, hwidLen));\n+        c.setHWID(remoteHwid);\n+        \n         cserv.addPlayer(player);\n-        world.addPlayer(player);\n+        wserv.addPlayer(player);\n         player.setEnteredChannelWorld();\n         \n         List<PlayerBuffValueHolder> buffs = server.getPlayerBuffStorage().getBuffsFromStorage(cid);\n@@ -209,8 +218,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         BuddyList bl = player.getBuddylist();\n         int buddyIds[] = bl.getBuddyIds();\n-        world.loggedOn(player.getName(), player.getId(), c.getChannel(), buddyIds);\n-        for (CharacterIdChannelPair onlineBuddy : world.multiBuddyFind(player.getId(), buddyIds)) {\n+        wserv.loggedOn(player.getName(), player.getId(), c.getChannel(), buddyIds);\n+        for (CharacterIdChannelPair onlineBuddy : wserv.multiBuddyFind(player.getId(), buddyIds)) {\n             BuddylistEntry ble = bl.get(onlineBuddy.getCharacterId());\n             ble.setChannel(onlineBuddy.getChannel());\n             bl.put(ble);\n@@ -219,10 +228,10 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         c.announce(MaplePacketCreator.loadFamily(player));\n         if (player.getFamilyId() > 0) {\n-            MapleFamily f = world.getFamily(player.getFamilyId());\n+            MapleFamily f = wserv.getFamily(player.getFamilyId());\n             if (f == null) {\n                 f = new MapleFamily(player.getId());\n-                world.addFamily(player.getFamilyId(), f);\n+                wserv.addFamily(player.getFamilyId(), f);\n             }\n             player.setFamily(f);\n             c.announce(MaplePacketCreator.getFamilyInfo(f.getMember(player.getId())));\n@@ -271,7 +280,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             pchar.setChannel(c.getChannel());\n             pchar.setMapId(player.getMapId());\n             pchar.setOnline(true);\n-            world.updateParty(player.getParty().getId(), PartyOperation.LOG_ONOFF, pchar);\n+            wserv.updateParty(player.getParty().getId(), PartyOperation.LOG_ONOFF, pchar);\n             player.updatePartyMemberHP();\n         }\n         \n@@ -292,22 +301,20 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             c.announce(MaplePacketCreator.requestBuddylistAdd(pendingBuddyRequest.getId(), c.getPlayer().getId(), pendingBuddyRequest.getName()));\n         }\n         \n-        if (newcomer) {\n-            for(MaplePet pet : player.getPets()) {\n-                if(pet != null)\n-                    world.registerPetHunger(player, player.getPetIndex(pet));\n-            }\n-            \n-            player.reloadQuestExpirations();\n-        }\n-        \n         c.announce(MaplePacketCreator.updateGender(player));\n         player.checkMessenger();\n         c.announce(MaplePacketCreator.enableReport());\n         player.changeSkillLevel(SkillFactory.getSkill(10000000 * player.getJobType() + 12), (byte) (player.getLinkedLevel() / 10), 20, -1);\n         player.checkBerserk(player.isHidden());\n         \n-        if (newcomer){\n+        if (newcomer) {\n+            for(MaplePet pet : player.getPets()) {\n+                if(pet != null)\n+                    wserv.registerPetHunger(player, player.getPetIndex(pet));\n+            }\n+            \n+            player.reloadQuestExpirations();\n+            \n             /*\n             if (!c.hasVotedAlready()){\n             \tplayer.announce(MaplePacketCreator.earnTitleMessage(\"You can vote now! Vote and earn a vote point!\"));\n@@ -354,7 +361,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         \n         if(player.getPartnerId() > 0) {\n             int partnerId = player.getPartnerId();\n-            final MapleCharacter partner = c.getWorldServer().getPlayerStorage().getCharacterById(partnerId);\n+            final MapleCharacter partner = wserv.getPlayerStorage().getCharacterById(partnerId);\n             \n             if(partner != null && !partner.isAwayFromWorld()) {\n                 player.announce(Wedding.OnNotifyWeddingPartnerTransfer(partnerId, partner.getMapId()));"}, {"sha": "40d1b1c2a18a8981fec498ac0283fe66dcb6fa5c", "filename": "src/net/server/channel/handlers/ScrollHandler.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/ScrollHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/ScrollHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/ScrollHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -79,7 +79,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 c.announce(MaplePacketCreator.getInventoryFull());\n                 return;\n             }\n-        } else if (((Equip) toScroll).getUpgradeSlots() < 1) {\n+        } else if (!ItemConstants.isModifierScroll(scroll.getItemId()) && ((Equip) toScroll).getUpgradeSlots() < 1) {\n             c.announce(MaplePacketCreator.getInventoryFull());\n             return;\n         }"}, {"sha": "595e1e51213a4683ecec6c660ef2f03135954bf8", "filename": "src/net/server/channel/handlers/UseCashItemHandler.java", "status": "modified", "additions": 59, "deletions": 30, "changes": 89, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/UseCashItemHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/UseCashItemHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/UseCashItemHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -29,6 +29,7 @@\n import client.inventory.Equip;\n import client.inventory.Equip.ScrollResult;\n import client.inventory.Item;\n+import client.inventory.MapleInventory;\n import client.inventory.MapleInventoryType;\n import client.inventory.MaplePet;\n import client.inventory.ModifyInventory;\n@@ -75,24 +76,38 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         player.setLastUsedCashItem(timeNow);\n         \n         MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n-        slea.readShort();\n+        short position = slea.readShort();\n         int itemId = slea.readInt();\n         int itemType = itemId / 10000;\n-        Item toUse = player.getInventory(MapleInventoryType.CASH).getItem(player.getInventory(MapleInventoryType.CASH).findById(itemId).getPosition());\n+        \n+        MapleInventory cashInv = player.getInventory(MapleInventoryType.CASH);\n+        Item toUse = cashInv.getItem(position);\n+        if (toUse == null || toUse.getItemId() != itemId) {\n+            toUse = cashInv.findById(itemId);\n+            \n+            if (toUse == null) {\n+                c.announce(MaplePacketCreator.enableActions());\n+                return;\n+            }\n+            \n+            position = toUse.getPosition();\n+        }\n+        \n+        if (toUse.getQuantity() < 1) {\n+            c.announce(MaplePacketCreator.enableActions());\n+            return;\n+        }\n+        \n         String medal = \"\";\n         Item medalItem = player.getInventory(MapleInventoryType.EQUIPPED).getItem((short) -49);\n         if (medalItem != null) {\n             medal = \"<\" + ii.getName(medalItem.getItemId()) + \"> \";\n         }\n-        if (toUse == null || toUse.getItemId() != itemId || toUse.getQuantity() < 1) {\n-            c.announce(MaplePacketCreator.enableActions());\n-            return;\n-        }\n         \n         if (itemType == 504) { // vip teleport rock\n             String error1 = \"Either the player could not be found or you were trying to teleport to an illegal location.\";\n             boolean vip = slea.readByte() == 1;\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n             if (!vip) {\n                 int mapId = slea.readInt();\n                 if (c.getChannelServer().getMapFactory().getMap(mapId).getForcedReturnId() == 999999999) {\n@@ -155,7 +170,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     return;\n                 }\n             }\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 506) {\n             Item eq = null;\n             if (itemId == 5060000) { // Item tag.\n@@ -193,7 +208,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     eq.setExpiration(currentServerTime() + (period * 60 * 60 * 24 * 1000));\n                 }\n \n-                remove(c, itemId);\n+                remove(c, position, itemId);\n             } else if (itemId == 5060002) { // Incubator\n                 byte inventory2 = (byte) slea.readInt();\n                 short slot2 = (short) slea.readInt();\n@@ -204,14 +219,14 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 }\n                 if (getIncubatedItem(c, itemId)) {\n                     MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.getByType(inventory2), slot2, (short) 1, false);\n-                    remove(c, itemId);\n+                    remove(c, position, itemId);\n                 }\n                 return;\n             }\n             slea.readInt(); // time stamp\n             if (eq != null) {\n                 player.forceUpdateItem(eq);\n-                remove(c, itemId);\n+                remove(c, position, itemId);\n             }\n         } else if (itemType == 507) {\n             boolean whisper;\n@@ -298,13 +313,13 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     Server.getInstance().broadcastMessage(c.getWorld(), MaplePacketCreator.getMultiMegaphone(msg2, c.getChannel(), whisper));\n                     break;\n             }\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 508) {   // graduation banner, thanks to tmskdl12. Also, thanks ratency for first pointing lack of Kite handling\n             MapleKite kite = new MapleKite(player, slea.readMapleAsciiString(), itemId);\n             \n             if (!GameConstants.isFreeMarketRoom(player.getMapId())) {\n                 player.getMap().spawnKite(kite);\n-                remove(c, itemId);\n+                remove(c, position, itemId);\n             } else {\n                 c.announce(MaplePacketCreator.sendCannotSpawnKite());\n             }\n@@ -316,18 +331,18 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             } catch (SQLException e) {\n                 e.printStackTrace();\n             }\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 510) {\n             player.getMap().broadcastMessage(MaplePacketCreator.musicChange(\"Jukebox/Congratulation\"));\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 512) {\n             if (ii.getStateChangeItem(itemId) != 0) {\n                 for (MapleCharacter mChar : player.getMap().getCharacters()) {\n                     ii.getItemEffect(ii.getStateChangeItem(itemId)).applyTo(mChar);\n                 }\n             }\n             player.getMap().startMapEffect(ii.getMsg(itemId).replaceFirst(\"%s\", player.getName()).replaceFirst(\"%s\", slea.readMapleAsciiString()), itemId);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 517) {\n             MaplePet pet = player.getPet(0);\n             if (pet == null) {\n@@ -344,18 +359,18 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             \n             player.getMap().broadcastMessage(player, MaplePacketCreator.changePetName(player, newName, 1), true);\n             c.announce(MaplePacketCreator.enableActions());\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 520) {\n             player.gainMeso(ii.getMeso(itemId), true, false, true);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n             c.announce(MaplePacketCreator.enableActions());\n         } else if (itemType == 523) {\n             int itemid = slea.readInt();\n             \n             if(!ServerConstants.USE_ENFORCE_ITEM_SUGGESTION) c.getWorldServer().addOwlItemSearch(itemid);\n             player.setOwlSearch(itemid);\n             List<Pair<MaplePlayerShopItem, AbstractMapleMapObject>> hmsAvailable = c.getWorldServer().getAvailableItemBundles(itemid);\n-            if(!hmsAvailable.isEmpty()) remove(c, itemId);\n+            if(!hmsAvailable.isEmpty()) remove(c, position, itemId);\n             \n             c.announce(MaplePacketCreator.owlOfMinerva(c, itemid, hmsAvailable));\n             c.announce(MaplePacketCreator.enableActions());\n@@ -368,7 +383,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                     \n                     if (p.getRight()) {\n                         pet.gainClosenessFullness(player, p.getLeft(), 100, 1);\n-                        remove(c, itemId);\n+                        remove(c, position, itemId);\n                         break;\n                     }\n                 } else {\n@@ -378,7 +393,7 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n             c.announce(MaplePacketCreator.enableActions());\n         } else if (itemType == 530) {\n             ii.getItemEffect(itemId).applyTo(player);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 533) {\n             NPCScriptManager.getInstance().start(c, 9010009, null);\n         } else if (itemType == 537) {\n@@ -399,7 +414,7 @@ public void run() {\n             \t\tServer.getInstance().broadcastMessage(world, MaplePacketCreator.byeAvatarMega());\n             \t}\n             }, 1000 * 10);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n         } else if (itemType == 543) {\n             if(itemId == 5432000 && !c.gainCharacterSlot()) {\n                 player.dropMessage(1, \"You have already used up all 12 extra character slots.\");\n@@ -442,7 +457,7 @@ public void run() {\n                 c.announce(MaplePacketCreator.sendMapleLifeError(0));   // success!\n                 \n                 player.showHint(\"#bSuccess#k on creation of the new character through the Maple Life card.\");\n-                remove(c, itemId);\n+                remove(c, position, itemId);\n             } else {\n                 if(createStatus == -1) {    // check name\n                     c.announce(MaplePacketCreator.sendMapleLifeNameError());\n@@ -455,7 +470,7 @@ public void run() {\n                 MapleShop shop = MapleShopFactory.getInstance().getShop(1338);\n                 if (shop != null) {\n                     shop.sendShop(c);\n-                    remove(c, itemId);\n+                    remove(c, position, itemId);\n                 }\n             } else {\n                 c.announce(MaplePacketCreator.enableActions());\n@@ -470,10 +485,10 @@ public void run() {\n                 c.announce(MaplePacketCreator.enableActions());\n                 return;\n             }\n-\n+            \n             MapleKarmaManipulator.setKarmaFlag(item);\n             player.forceUpdateItem(item);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n             c.announce(MaplePacketCreator.enableActions());\n         } else if (itemType == 552) { //DS EGG THING\n             c.announce(MaplePacketCreator.enableActions());\n@@ -487,7 +502,7 @@ public void run() {\n             }\n             equip.setVicious(equip.getVicious() + 1);\n             equip.setUpgradeSlots(equip.getUpgradeSlots() + 1);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n             c.announce(MaplePacketCreator.enableActions());\n             c.announce(MaplePacketCreator.sendHammerData(equip.getVicious()));\n             player.forceUpdateItem(equip);\n@@ -528,7 +543,7 @@ public void run() {\n             //opcodes 0x42, 0x44: \"this item cannot be used\"; 0x39, 0x45: crashes\n             \n             MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.USE, uSlot, (short) 1, false);\n-            remove(c, itemId);\n+            remove(c, position, itemId);\n             \n             final MapleClient client = c;\n             TimerManager.getInstance().schedule(new Runnable() {\n@@ -558,8 +573,22 @@ public void run() {\n         }\n     }\n \n-    private static void remove(MapleClient c, int itemId) {\n-        MapleInventoryManipulator.removeById(c, MapleInventoryType.CASH, itemId, 1, true, false);\n+    private static void remove(MapleClient c, short position, int itemid) {\n+        MapleInventory cashInv = c.getPlayer().getInventory(MapleInventoryType.CASH);\n+        cashInv.lockInventory();\n+        try {\n+            Item it = cashInv.getItem(position);\n+            if (it == null || it.getItemId() != itemid) {\n+                it = cashInv.findById(itemid);\n+                if (it != null) {\n+                    position = it.getPosition();\n+                }\n+            }\n+        } finally {\n+            cashInv.unlockInventory();\n+        }\n+        \n+        MapleInventoryManipulator.removeFromSlot(c, MapleInventoryType.CASH, position, (short) 1, true, false);\n     }\n \n     private static boolean getIncubatedItem(MapleClient c, int id) {"}, {"sha": "fac3ff981948e71893af9c684eed10ea97877b51", "filename": "src/net/server/channel/handlers/WhisperHandler.java", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/WhisperHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/channel/handlers/WhisperHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/WhisperHandler.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -128,17 +128,18 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n                 c.announce(MaplePacketCreator.getWhisperReply(recipient, (byte) 0));\n             }\n         } else if (mode == 0x44) {\n-            //Buddy find\n+            //Buddy find, thanks to Atoot\n+            \n             String recipient = slea.readMapleAsciiString();\n             MapleCharacter player = c.getWorldServer().getPlayerStorage().getCharacterByName(recipient);\n             if (player != null && c.getPlayer().gmLevel() >= player.gmLevel()) {\n                 if (player.getCashShop().isOpened()) {  // in CashShop\n-                    c.getSession().write(MaplePacketCreator.getFindReplyWithCS(recipient));\n+                    c.getSession().write(MaplePacketCreator.getFindReplyWithCS(recipient));  \n                 } else if (player.isAwayFromWorld()) {  // in MTS\n-                    c.getSession().write(MaplePacketCreator.getFindReplyWithMTS(recipient));\n+                    c.getSession().write(MaplePacketCreator.getFindReplyWithMTS(recipient));   \n                 } else {\n                     c.getSession().write(MaplePacketCreator.getFindReplyWithMap(player.getName(), player.getMap().getId()));\n-                }\n+                }        \n             }\n         }\n     }"}, {"sha": "8a73a673362bd3b27e2134b66614bc2200912875", "filename": "src/net/server/world/World.java", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/world/World.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/net/server/world/World.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/world/World.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -94,7 +94,7 @@\n  */\n public class World {\n \n-    private int id, flag, exprate, droprate, mesorate, questrate, travelrate;\n+    private int id, flag, exprate, droprate, bossdroprate, mesorate, questrate, travelrate;\n     private String eventmsg;\n     private List<Channel> channels = new ArrayList<>();\n     private Map<Integer, Byte> pnpcStep = new HashMap<>();\n@@ -158,12 +158,13 @@\n     private ScheduledFuture<?> charactersSchedule;\n     private ScheduledFuture<?> marriagesSchedule;\n     \n-    public World(int world, int flag, String eventmsg, int exprate, int droprate, int mesorate, int questrate, int travelrate) {\n+    public World(int world, int flag, String eventmsg, int exprate, int droprate, int bossdroprate, int mesorate, int questrate, int travelrate) {\n         this.id = world;\n         this.flag = flag;\n         this.eventmsg = eventmsg;\n         this.exprate = exprate;\n         this.droprate = droprate;\n+        this.bossdroprate = bossdroprate;\n         this.mesorate = mesorate;\n         this.questrate = questrate;\n         this.travelrate = travelrate;\n@@ -322,6 +323,14 @@ public void setDropRate(int drop) {\n             chr.setWorldRates();\n         }\n     }\n+    \n+    public int getBossDropRate() {  // boss rate concept thanks to Lapeiro\n+        return bossdroprate;\n+    }\n+    \n+    public void setBossDropRate(int bossdrop) {\n+        bossdroprate = bossdrop;\n+    }\n \n     public int getMesoRate() {\n         return mesorate;"}, {"sha": "09929317b85d3efb823733ddf3fb1067e10b5bf5", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -602,15 +602,13 @@ public synchronized void dispose(boolean shutdown) {    // should not trigger an\n                         ex.printStackTrace();\n                 }\n                 \n-                mapFactory.dispose();\n                 ess.dispose();\n                 \n                 wL.lock();\n                 try {\n                         for(MapleCharacter chr: chars.values()) chr.setEventInstance(null);\n                         chars.clear();\n                         mobs.clear();\n-                        mapFactory = null;\n                         ess = null;\n                 } finally {\n                         wL.unlock();\n@@ -635,7 +633,20 @@ public synchronized void dispose(boolean shutdown) {    // should not trigger an\n                         sL.unlock();\n                 }\n                 \n-                disposeLocks();\n+                TimerManager.getInstance().schedule(new Runnable() {\n+                        @Override\n+                        public void run() {\n+                                mapFactory.dispose();   // reactors issue on dispose event maps found thanks to MedicOP\n+                                wL.lock();\n+                                try {\n+                                        mapFactory = null;\n+                                } finally {\n+                                        wL.unlock();\n+                                }\n+\n+                                disposeLocks();\n+                        }\n+                }, 60 * 1000);\n \t}\n         \n         private void disposeLocks() {"}, {"sha": "696b89fd47d4fffa1fe37c46d9394562c0c9196b", "filename": "src/server/MapleItemInformationProvider.java", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/server/MapleItemInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/server/MapleItemInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/MapleItemInformationProvider.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -993,13 +993,13 @@ public Item scrollEquipWithId(Item equip, int scrollId, boolean usingWhiteScroll\n                             break;\n                     }\n                     if (!ItemConstants.isCleanSlate(scrollId)) {\n-                        if (!assertGM) {\n+                        if (!assertGM && !ItemConstants.isModifierScroll(scrollId)) {   // issue with modifier scrolls taking slots found thanks to Masterrulax, justin, BakaKnyx\n                             nEquip.setUpgradeSlots((byte) (nEquip.getUpgradeSlots() - 1));\n                         }\n                         nEquip.setLevel((byte) (nEquip.getLevel() + 1));\n                     }\n                 } else {\n-                    if (!ServerConstants.USE_PERFECT_SCROLLING && !usingWhiteScroll && !ItemConstants.isCleanSlate(scrollId) && !assertGM) {\n+                    if (!ServerConstants.USE_PERFECT_SCROLLING && !usingWhiteScroll && !ItemConstants.isCleanSlate(scrollId) && !assertGM && !ItemConstants.isModifierScroll(scrollId)) {\n                         nEquip.setUpgradeSlots((byte) (nEquip.getUpgradeSlots() - 1));\n                     }\n                     if (Randomizer.nextInt(100) < stats.get(\"cursed\")) {\n@@ -2055,7 +2055,7 @@ public int getMakerStimulant(int itemId) {  // thanks to Arnah\n             ps.setInt(1, itemId);\n             ResultSet rs = ps.executeQuery();\n             while(rs.next()) {\n-                String resultName = MapleMonsterInformationProvider.getMobNameFromId(rs.getInt(\"dropperid\"));\n+                String resultName = MapleMonsterInformationProvider.getInstance().getMobNameFromId(rs.getInt(\"dropperid\"));\n                 if (resultName != null) {\n                     list.add(resultName);\n                 }"}, {"sha": "393ce34b1a82050f1f66275c0bd75883e16ff90f", "filename": "src/server/expeditions/MapleExpeditionType.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/server/expeditions/MapleExpeditionType.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/server/expeditions/MapleExpeditionType.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/expeditions/MapleExpeditionType.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -40,7 +40,7 @@\n     CHAOS_ZAKUM(6, 30, 120, 255, 5),\n     CHAOS_HORNTAIL(6, 30, 120, 255, 5),\n     PINKBEAN(6, 30, 120, 255, 5),\n-    CWKPQ(6, 30, 100, 255, 5);\n+    CWKPQ(6, 30, 90, 255, 5);   // CWKPQ min-level 90, found thanks to Cato\n     \n     private int minSize;\n     private int maxSize;"}, {"sha": "e8c92fa190a4e1b7395b317a751c55ef88702d74", "filename": "src/server/life/MapleMonsterInformationProvider.java", "status": "modified", "additions": 43, "deletions": 30, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/server/life/MapleMonsterInformationProvider.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/server/life/MapleMonsterInformationProvider.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonsterInformationProvider.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -63,6 +63,9 @@ public static MapleMonsterInformationProvider getInstance() {\n         private final Map<MobSkill, Integer> mobSkillAnimationTime = new HashMap<>();\n         \n         private final Map<Integer, Pair<Integer, Integer>> mobAttackInfo = new HashMap<>();\n+        \n+        private final Map<Integer, Boolean> mobBossCache = new HashMap<>();\n+        private final Map<Integer, String> mobNameCache = new HashMap<>();\n \n \tprotected MapleMonsterInformationProvider() {\n \t\tretrieveGlobal();\n@@ -275,38 +278,48 @@ public final void setMobAttackInfo(int monsterId, int attackPos, int mpCon, int\n \t\treturn retMobs;\n \t}\n \n-\tpublic static String getMobNameFromId(int id) {\n-\t\ttry\n-\t\t{\n-\t\t\treturn MapleLifeFactory.getMonster(id).getName();\n-\t\t} \n-                catch (NullPointerException npe)\n-\t\t{\n-\t\t\treturn null; //nonexistant mob\n-\t\t}\n-                catch (Exception e)\n-\t\t{\n-                        e.printStackTrace();\n-                        System.err.println(\"Nonexistant mob id \" + id);\n-\t\t\treturn null; //nonexistant mob\n-\t\t}\n+        public boolean isBoss(int id) {\n+                Boolean boss = mobBossCache.get(id);\n+                if (boss == null) {\n+                        try {\n+                                boss = MapleLifeFactory.getMonster(id).isBoss();\n+                        } catch (NullPointerException npe) {\n+                                boss = false;\n+                        } catch (Exception e) {   //nonexistant mob\n+                                boss = false;\n+                                \n+                                e.printStackTrace();\n+                                System.err.println(\"Nonexistant mob id \" + id);\n+                        }\n+                        \n+                        mobBossCache.put(id, boss);\n+                }\n+                \n+                return boss;\n \t}\n         \n-        public static String getMobNameFromID(int id) {\n-\t\ttry\n-\t\t{\n-\t\t\treturn MapleLifeFactory.getMonster(id).getName();\n-\t\t}\n-                catch (NullPointerException npe)\n-\t\t{\n-\t\t\treturn null; //nonexistant mob\n-\t\t}\n-                catch (Exception e)\n-\t\t{\n-                        e.printStackTrace();\n-                        System.err.println(\"Nonexistant mob id \" + id);\n-\t\t\treturn null; //nonexistant mob\n-\t\t}\n+\tpublic String getMobNameFromId(int id) {\n+                String mobName = mobNameCache.get(id);\n+                if (mobName == null) {\n+                        try\n+                        {\n+                                mobName = MapleLifeFactory.getMonster(id).getName();\n+                        } \n+                        catch (NullPointerException npe)\n+                        {\n+                                mobName = \"\"; //nonexistant mob\n+                        }\n+                        catch (Exception e)\n+                        {\n+                                e.printStackTrace();\n+                                System.err.println(\"Nonexistant mob id \" + id);\n+                                mobName = \"\"; //nonexistant mob\n+                        }\n+                        \n+                        mobNameCache.put(id, mobName);\n+                }\n+                \n+                return mobName;\n \t}\n \n \tpublic final void clearDrops() {"}, {"sha": "d080065c3844a444e04364131dd8c57a28596c67", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 73, "deletions": 19, "changes": 92, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -697,7 +697,7 @@ private void dropFromMonster(final MapleCharacter chr, final MapleMonster mob, f\n         \n         final byte droptype = (byte) (mob.getStats().isExplosiveReward() ? 3 : mob.getStats().isFfaLoot() ? 2 : chr.getParty() != null ? 1 : 0);\n         final int mobpos = mob.getPosition().x;\n-        int chRate = chr.getDropRate();\n+        int chRate = !mob.isBoss() ? chr.getDropRate() : chr.getBossDropRate();\n         byte d = 1;\n         Point pos = new Point(0, mob.getPosition().y);\n \n@@ -1681,7 +1681,7 @@ public boolean containsNPC(int npcid) {\n         return false;\n     }\n     \n-    public void destroyNPC(int npcid) {\n+    public void destroyNPC(int npcid) {     // assumption: there's at most one of the same NPC in a map.\n         List<MapleMapObject> npcs = getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.NPC));\n \n         chrRLock.lock();\n@@ -1893,12 +1893,24 @@ public void run() {\n         }\n     }\n     \n+    private List<SpawnPoint> getMonsterSpawn() {\n+        synchronized (monsterSpawn) {\n+            return new ArrayList<>(monsterSpawn);\n+        }\n+    }\n+    \n+    private List<SpawnPoint> getAllMonsterSpawn() {\n+        synchronized (allMonsterSpawn) {\n+            return new ArrayList<>(allMonsterSpawn);\n+        }\n+    }\n+    \n     public void spawnAllMonsterIdFromMapSpawnList(int id) {\n         spawnAllMonsterIdFromMapSpawnList(id, 1, false);\n     }\n     \n     public void spawnAllMonsterIdFromMapSpawnList(int id, int difficulty, boolean isPq) {\n-        for(SpawnPoint sp: allMonsterSpawn) {\n+        for(SpawnPoint sp: getAllMonsterSpawn()) {\n             if(sp.getMonsterId() == id) {\n                 spawnMonster(sp.getMonster(), difficulty, isPq);\n             }\n@@ -1910,7 +1922,7 @@ public void spawnAllMonstersFromMapSpawnList() {\n     }\n     \n     public void spawnAllMonstersFromMapSpawnList(int difficulty, boolean isPq) {\n-        for(SpawnPoint sp: allMonsterSpawn) {\n+        for(SpawnPoint sp: getAllMonsterSpawn()) {\n             spawnMonster(sp.getMonster(), difficulty, isPq);\n         }\n     }\n@@ -2481,10 +2493,6 @@ public void run() {\n                     }\n                 }\n             }, travelTime);\n-        } else if (mapid == 103040400) {\n-            if (chr.getEventInstance() != null) {\n-                chr.getEventInstance().movePlayer(chr);\n-            }\n         } else if (MapleMiniDungeonInfo.isDungeonMap(mapid)) {\n             MapleMiniDungeon mmd = chr.getClient().getChannelServer().getMiniDungeon(mapid);\n             if(mmd != null) mmd.registerPlayer(chr);\n@@ -3053,9 +3061,55 @@ public void addAllMonsterSpawn(MapleMonster monster, int mobTime, int team) {\n         allMonsterSpawn.add(sp);\n     }\n     \n+    public void removeMonsterSpawn(int mobId, int x, int y) {\n+        // assumption: spawn points are identified by tuple (lifeid, x, y)\n+        \n+        Point checkpos = calcPointBelow(new Point(x, y));\n+        checkpos.y -= 1;\n+        \n+        List<SpawnPoint> toRemove = new LinkedList<>();\n+        for(SpawnPoint sp: getMonsterSpawn()) {\n+            Point pos = sp.getPosition();\n+            if (sp.getMonsterId() == mobId && checkpos.equals(pos)) {\n+                toRemove.add(sp);\n+            }\n+        }\n+        \n+        if (!toRemove.isEmpty()) {\n+            synchronized (monsterSpawn) {\n+                for (SpawnPoint sp : toRemove) {\n+                    monsterSpawn.remove(sp);\n+                }\n+            }\n+        }\n+    }\n+    \n+    public void removeAllMonsterSpawn(int mobId, int x, int y) {\n+        // assumption: spawn points are identified by tuple (lifeid, x, y)\n+        \n+        Point checkpos = calcPointBelow(new Point(x, y));\n+        checkpos.y -= 1;\n+        \n+        List<SpawnPoint> toRemove = new LinkedList<>();\n+        for(SpawnPoint sp: getAllMonsterSpawn()) {\n+            Point pos = sp.getPosition();\n+            if (sp.getMonsterId() == mobId && checkpos.equals(pos)) {\n+                toRemove.add(sp);\n+            }\n+        }\n+        \n+        if (!toRemove.isEmpty()) {\n+            synchronized (allMonsterSpawn) {\n+                for (SpawnPoint sp : toRemove) {\n+                    allMonsterSpawn.remove(sp);\n+                }\n+            }\n+        }\n+    }\n+    \n     public void reportMonsterSpawnPoints(MapleCharacter chr) {\n         chr.dropMessage(6, \"Mob spawnpoints on map \" + getId() + \", with available Mob SPs \" + monsterSpawn.size() + \", used \" + spawnedMonstersOnMap.get() + \":\");\n-        for(SpawnPoint sp: allMonsterSpawn) {\n+        for(SpawnPoint sp: getAllMonsterSpawn()) {\n             chr.dropMessage(6, \"  id: \" + sp.getMonsterId() + \" canSpawn: \" + !sp.getDenySpawn() + \" numSpawned: \" + sp.getSpawned() + \" x: \" + sp.getPosition().getX() + \" y: \" + sp.getPosition().getY() + \" time: \" + sp.getMobTime() + \" team: \" + sp.getTeam());\n         }\n     }\n@@ -3399,7 +3453,7 @@ public void run() {\n     }\n     \n     public void instanceMapFirstSpawn(int difficulty, boolean isPq) {\n-        for(SpawnPoint spawnPoint: allMonsterSpawn) {\n+        for(SpawnPoint spawnPoint: getAllMonsterSpawn()) {\n             if(spawnPoint.getMobTime() == -1) {   //just those allowed to be spawned only once\n                 spawnMonster(spawnPoint.getMonster());\n             }\n@@ -3411,7 +3465,7 @@ public void instanceMapRespawn() {\n         \n         final int numShouldSpawn = (short) ((monsterSpawn.size() - spawnedMonstersOnMap.get()));//Fking lol'd\n         if (numShouldSpawn > 0) {\n-            List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n+            List<SpawnPoint> randomSpawn = getMonsterSpawn();\n             Collections.shuffle(randomSpawn);\n             int spawned = 0;\n             for (SpawnPoint spawnPoint : randomSpawn) {\n@@ -3431,7 +3485,7 @@ public void instanceMapForceRespawn() {\n         \n         final int numShouldSpawn = (short) ((monsterSpawn.size() - spawnedMonstersOnMap.get()));//Fking lol'd\n         if (numShouldSpawn > 0) {\n-            List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n+            List<SpawnPoint> randomSpawn = getMonsterSpawn();\n             Collections.shuffle(randomSpawn);\n             int spawned = 0;\n             for (SpawnPoint spawnPoint : randomSpawn) {\n@@ -3447,27 +3501,27 @@ public void instanceMapForceRespawn() {\n     }\n     \n     public void closeMapSpawnPoints() {\n-        for (SpawnPoint spawnPoint : monsterSpawn) {\n+        for (SpawnPoint spawnPoint : getMonsterSpawn()) {\n             spawnPoint.setDenySpawn(true);\n         }\n     }\n     \n     public void restoreMapSpawnPoints() {\n-        for (SpawnPoint spawnPoint : monsterSpawn) {\n+        for (SpawnPoint spawnPoint : getMonsterSpawn()) {\n             spawnPoint.setDenySpawn(false);\n         }\n     }\n     \n     public void setAllowSpawnPointInBox(boolean allow, Rectangle box) {\n-        for(SpawnPoint sp: monsterSpawn)  {\n+        for(SpawnPoint sp: getMonsterSpawn())  {\n             if(box.contains(sp.getPosition())) {\n                 sp.setDenySpawn(!allow);\n             }\n         }\n     }\n     \n     public void setAllowSpawnPointInRange(boolean allow, Point from, double rangeSq) {\n-        for(SpawnPoint sp: monsterSpawn)  {\n+        for(SpawnPoint sp: getMonsterSpawn())  {\n             if(from.distanceSq(sp.getPosition()) <= rangeSq) {\n                 sp.setDenySpawn(!allow);\n             }\n@@ -3477,7 +3531,7 @@ public void setAllowSpawnPointInRange(boolean allow, Point from, double rangeSq)\n     public SpawnPoint findClosestSpawnpoint(Point from) {\n         SpawnPoint closest = null;\n         double shortestDistance = Double.POSITIVE_INFINITY;\n-        for (SpawnPoint sp : monsterSpawn) {\n+        for (SpawnPoint sp : getMonsterSpawn()) {\n             double distance = sp.getPosition().distanceSq(from);\n             if (distance < shortestDistance) {\n                 closest = sp;\n@@ -3494,7 +3548,7 @@ private static double getCurrentSpawnRate(int numPlayers) {\n     private int getNumShouldSpawn(int numPlayers) {\n         /*\n         System.out.println(\"----------------------------------\");\n-        for (SpawnPoint spawnPoint : monsterSpawn) {\n+        for (SpawnPoint spawnPoint : getMonsterSpawn()) {\n             System.out.println(\"sp \" + spawnPoint.getPosition().getX() + \", \" + spawnPoint.getPosition().getY() + \": \" + spawnPoint.getDenySpawn());\n         }\n         System.out.println(\"try \" + monsterSpawn.size() + \" - \" + spawnedMonstersOnMap.get());\n@@ -3526,7 +3580,7 @@ public void respawn() {\n         \n         int numShouldSpawn = getNumShouldSpawn(numPlayers);\n         if(numShouldSpawn > 0) {\n-            List<SpawnPoint> randomSpawn = new ArrayList<>(monsterSpawn);\n+            List<SpawnPoint> randomSpawn = new ArrayList<>(getMonsterSpawn());\n             Collections.shuffle(randomSpawn);\n             short spawned = 0;\n             for(SpawnPoint spawnPoint : randomSpawn) {"}, {"sha": "9b2c0d3f9879c73a314b822777bb759db4579096", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 83, "deletions": 35, "changes": 118, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -85,6 +85,77 @@ public MapleMap resetMap(int mapid) {\n         return getMap(mapid);\n     }\n     \n+    private void loadLifeFromWz(MapleMap map, MapleData mapData) {\n+        for (MapleData life : mapData.getChildByPath(\"life\")) {\n+            String id = MapleDataTool.getString(life.getChildByPath(\"id\"));\n+            String type = MapleDataTool.getString(life.getChildByPath(\"type\"));\n+            int cy = MapleDataTool.getInt(life.getChildByPath(\"cy\"));\n+            MapleData dF = life.getChildByPath(\"f\");\n+            int f = (dF != null) ? MapleDataTool.getInt(dF) : 0;\n+            int fh = MapleDataTool.getInt(life.getChildByPath(\"fh\"));\n+            int rx0 = MapleDataTool.getInt(life.getChildByPath(\"rx0\"));\n+            int rx1 = MapleDataTool.getInt(life.getChildByPath(\"rx1\"));\n+            int x = MapleDataTool.getInt(life.getChildByPath(\"x\"));\n+            int y = MapleDataTool.getInt(life.getChildByPath(\"y\"));\n+            int hide = MapleDataTool.getInt(\"hide\", life, 0);\n+            int mobTime = MapleDataTool.getInt(\"mobTime\", life, 0);\n+            int team = MapleDataTool.getInt(\"team\", life, -1);\n+\n+            loadLifeRaw(map, Integer.parseInt(id), type, cy, f, fh, rx0, rx1, x, y, hide, mobTime, team);\n+        }\n+    }\n+    \n+    private void loadLifeFromDb(MapleMap map) {\n+        try {\n+            Connection con = DatabaseConnection.getConnection();\n+            PreparedStatement ps = con.prepareStatement(\"SELECT * FROM plife WHERE map = ? and world = ?\");\n+            ps.setInt(1, map.getId());\n+            ps.setInt(2, map.getWorld());\n+\n+            ResultSet rs = ps.executeQuery();\n+            while(rs.next()) {\n+                int id = rs.getInt(\"life\");\n+                String type = rs.getString(\"type\");\n+                int cy = rs.getInt(\"cy\");\n+                int f = rs.getInt(\"f\");\n+                int fh = rs.getInt(\"fh\");\n+                int rx0 = rs.getInt(\"rx0\");\n+                int rx1 = rs.getInt(\"rx1\");\n+                int x = rs.getInt(\"x\");\n+                int y = rs.getInt(\"y\");\n+                int hide = rs.getInt(\"hide\");\n+                int mobTime = rs.getInt(\"mobtime\");\n+                int team = rs.getInt(\"team\");\n+\n+                loadLifeRaw(map, id, type, cy, f, fh, rx0, rx1, x, y, hide, mobTime, team);\n+            }\n+\n+            rs.close();\n+            ps.close();\n+            con.close();\n+        } catch (SQLException sqle) {\n+            sqle.printStackTrace();\n+        }\n+    }\n+    \n+    private void loadLifeRaw(MapleMap map, int id, String type, int cy, int f, int fh, int rx0, int rx1, int x, int y, int hide, int mobTime, int team) {\n+        AbstractLoadedMapleLife myLife = loadLife(id, type, cy, f, fh, rx0, rx1, x, y, hide);\n+        if (myLife instanceof MapleMonster) {\n+            MapleMonster monster = (MapleMonster) myLife;\n+            \n+            if (mobTime == -1) { //does not respawn, force spawn once\n+                map.spawnMonster(monster);\n+            } else {\n+                map.addMonsterSpawn(monster, mobTime, team);\n+            }\n+\n+            //should the map be reseted, use allMonsterSpawn list of monsters to spawn them again\n+            map.addAllMonsterSpawn(monster, mobTime, team);\n+        } else {\n+            map.addMapObject(myLife);\n+        }\n+    }\n+    \n     private synchronized MapleMap loadMapFromWz(int mapid, Integer omapid) {\n         MapleMap map;\n         \n@@ -225,27 +296,10 @@ private synchronized MapleMap loadMapFromWz(int mapid, Integer omapid) {\n                 }\n             }\n         }\n-        for (MapleData life : mapData.getChildByPath(\"life\")) {\n-            String id = MapleDataTool.getString(life.getChildByPath(\"id\"));\n-            String type = MapleDataTool.getString(life.getChildByPath(\"type\"));\n-            AbstractLoadedMapleLife myLife = loadLife(life, id, type);\n-            if (myLife instanceof MapleMonster) {\n-                MapleMonster monster = (MapleMonster) myLife;\n-                int mobTime = MapleDataTool.getInt(\"mobTime\", life, 0);\n-                int team = MapleDataTool.getInt(\"team\", life, -1);\n-                if (mobTime == -1) { //does not respawn, force spawn once\n-                    map.spawnMonster(monster);\n-                } else {\n-                    map.addMonsterSpawn(monster, mobTime, team);\n-                }\n-\n-                //should the map be reseted, use allMonsterSpawn list of monsters to spawn them again\n-                map.addAllMonsterSpawn(monster, mobTime, team);\n-            } else {\n-                map.addMapObject(myLife);\n-            }\n-        }\n-\n+        \n+        loadLifeFromWz(map, mapData);\n+        loadLifeFromDb(map);\n+        \n         if (mapData.getChildByPath(\"reactor\") != null) {\n             for (MapleData reactor : mapData.getChildByPath(\"reactor\")) {\n                 String id = MapleDataTool.getString(reactor.getChildByPath(\"id\"));\n@@ -333,21 +387,15 @@ public boolean isMapLoaded(int mapId) {\n             mapsRLock.unlock();\n         }\n     }\n-\n-    private AbstractLoadedMapleLife loadLife(MapleData life, String id, String type) {\n-        AbstractLoadedMapleLife myLife = MapleLifeFactory.getLife(Integer.parseInt(id), type);\n-        myLife.setCy(MapleDataTool.getInt(life.getChildByPath(\"cy\")));\n-        MapleData dF = life.getChildByPath(\"f\");\n-        if (dF != null) {\n-            myLife.setF(MapleDataTool.getInt(dF));\n-        }\n-        myLife.setFh(MapleDataTool.getInt(life.getChildByPath(\"fh\")));\n-        myLife.setRx0(MapleDataTool.getInt(life.getChildByPath(\"rx0\")));\n-        myLife.setRx1(MapleDataTool.getInt(life.getChildByPath(\"rx1\")));\n-        int x = MapleDataTool.getInt(life.getChildByPath(\"x\"));\n-        int y = MapleDataTool.getInt(life.getChildByPath(\"y\"));\n+    \n+    private AbstractLoadedMapleLife loadLife(int id, String type, int cy, int f, int fh, int rx0, int rx1, int x, int y, int hide) {\n+        AbstractLoadedMapleLife myLife = MapleLifeFactory.getLife(id, type);\n+        myLife.setCy(cy);\n+        myLife.setF(f);\n+        myLife.setFh(fh);\n+        myLife.setRx0(rx0);\n+        myLife.setRx1(rx1);\n         myLife.setPosition(new Point(x, y));\n-        int hide = MapleDataTool.getInt(\"hide\", life, 0);\n         if (hide == 1) {\n             myLife.setHide(true);\n         }"}, {"sha": "e8bf0d830efba6f53ca22b3039eff6d42724994a", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -1065,7 +1065,7 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.writeShort(chr.getHp());\n                 mplew.writeBool(false);\n                 mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(8);\n+                mplew.skip(10);\n                 return mplew.getPacket();\n         }\n         \n@@ -1082,7 +1082,7 @@ public int compare(Pair<MapleStat, Integer> o1, Pair<MapleStat, Integer> o2) {\n                 mplew.writeInt(spawnPosition.x);    // spawn position placement thanks to Arnah (Vertisy)\n                 mplew.writeInt(spawnPosition.y);\n                 mplew.writeLong(getTime(Server.getInstance().getCurrentTime()));\n-                mplew.skip(8);\n+                mplew.skip(10);\n                 return mplew.getPacket();\n         }\n         \n@@ -6066,15 +6066,15 @@ private static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MapleP\n                 }\n                 return mplew.getPacket();\n         }\n-\n+        \n         public static byte[] getFindReplyWithMap(String target, int mapid) {\n                 MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n                 mplew.writeShort(SendOpcode.WHISPER.getValue());\n                 mplew.write(72);\n                 mplew.writeMapleAsciiString(target);\n                 mplew.write(1);\n                 mplew.writeInt(mapid);\n-                mplew.write(new byte[8]);\n+                mplew.skip(8);\n                 return mplew.getPacket();\n         }\n "}, {"sha": "05d0b3102fcc668ef86945fe2d4f1981d3eb34d0", "filename": "tools/MapleEventMethodFiller/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEventMethodFiller/build.xml?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleEventMethodFiller\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleEventMethodFiller.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleEventMethodFiller-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "00556b119d45dd85a3c3073b1826916c3c60b9c4", "filename": "tools/MapleEventMethodFiller/lib/commons-io-2.6.jar", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/lib/commons-io-2.6.jar", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/lib/commons-io-2.6.jar", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEventMethodFiller/lib/commons-io-2.6.jar?ref=0203d45901fc57ab42fe4d64b559080f76886184"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleEventMethodFiller/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEventMethodFiller/manifest.mf?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "31e2a3650ea194f95ba2b6448394768dd9442d3f", "filename": "tools/MapleEventMethodFiller/src/mapleeventmethodfiller/MapleEventMethodFiller.java", "status": "added", "additions": 126, "deletions": 0, "changes": 126, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/src/mapleeventmethodfiller/MapleEventMethodFiller.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/tools/MapleEventMethodFiller/src/mapleeventmethodfiller/MapleEventMethodFiller.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleEventMethodFiller/src/mapleeventmethodfiller/MapleEventMethodFiller.java?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -0,0 +1,126 @@\n+/*\n+    This file is part of the HeavenMS MapleStory Server\n+    Copyleft (L) 2016 - 2018 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package mapleeventmethodfiller;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.IOException;\n+import java.io.PrintWriter;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import org.apache.commons.io.FileUtils;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ * \n+  This application objective is to read all scripts from the event folder\n+  and fill empty functions for every function name not yet present in the\n+  script.\n+  \n+  Estimated parse time: \n+ */\n+public class MapleEventMethodFiller {\n+\n+    private static boolean foundMatchingDataOnFile(String fileContent, Pattern pattern) {\n+        Matcher matcher = pattern.matcher(fileContent);\n+        return matcher.find();\n+    }\n+    \n+    private static void fileSearchMatchingData(File file, Map<Pattern, String> functions) {\n+        try {\n+            String fileContent = FileUtils.readFileToString(file, \"UTF-8\");\n+            List<String> fillFunctions = new LinkedList<>();\n+\n+            for(Entry<Pattern, String> f : functions.entrySet()) {\n+                if(!foundMatchingDataOnFile(fileContent, f.getKey())) {\n+                    fillFunctions.add(f.getValue());\n+                }\n+            }\n+            \n+            if (!fillFunctions.isEmpty()) {\n+                System.out.println(\"Filling out \" + file.getName() + \"...\");\n+                \n+                FileWriter fileWriter = new FileWriter(file, true);\n+                PrintWriter printWriter = new PrintWriter(fileWriter);\n+                \n+                printWriter.println();\n+                printWriter.println();\n+                printWriter.println(\"// ---------- FILLER FUNCTIONS ----------\");\n+                printWriter.println();\n+                \n+                for (String s : fillFunctions) {\n+                    printWriter.println(s);\n+                    printWriter.println();\n+                }\n+                \n+                printWriter.close();\n+            }\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    private static void filterDirectorySearchMatchingData(String directoryPath, Map<Pattern, String> functions) {\n+        Iterator iter = FileUtils.iterateFiles(new File(directoryPath), new String[]{\"sql\", \"js\", \"txt\",\"java\"}, true);\n+\n+        while(iter.hasNext()) {\n+            File file = (File) iter.next();\n+            fileSearchMatchingData(file, functions);\n+        }\n+    }\n+    \n+    private static String jsFunction = \"function(\\\\s)+\";\n+    \n+    private static Pattern compileJsFunctionPattern(String function) {\n+        return Pattern.compile(jsFunction + function);\n+    }\n+    \n+    public static final Map<Pattern, String> functions = new HashMap<Pattern, String>(17) {{\n+        put(compileJsFunctionPattern(\"playerEntry\"), \"function playerEntry(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"playerExit\"), \"function playerExit(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"scheduledTimeout\"), \"function scheduledTimeout(eim) {}\");\n+        put(compileJsFunctionPattern(\"playerUnregistered\"), \"function playerUnregistered(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"changedLeader\"), \"function changedLeader(eim, leader) {}\");\n+        put(compileJsFunctionPattern(\"monsterKilled\"), \"function monsterKilled(mob, eim) {}\");\n+        put(compileJsFunctionPattern(\"allMonstersDead\"), \"function allMonstersDead(eim) {}\");\n+        put(compileJsFunctionPattern(\"playerDisconnected\"), \"function playerDisconnected(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"monsterValue\"), \"function monsterValue(eim, mobid) {return 0;}\");\n+        put(compileJsFunctionPattern(\"dispose\"), \"function dispose() {}\");\n+        put(compileJsFunctionPattern(\"leftParty\"), \"function leftParty(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"disbandParty\"), \"function disbandParty(eim, player) {}\");\n+        put(compileJsFunctionPattern(\"clearPQ\"), \"function clearPQ(eim) {}\");\n+        put(compileJsFunctionPattern(\"afterSetup\"), \"function afterSetup(eim) {}\");\n+        put(compileJsFunctionPattern(\"cancelSchedule\"), \"function cancelSchedule() {}\");\n+        put(compileJsFunctionPattern(\"setup\"), \"function setup(eim, leaderid) {}\");\n+        //put(compileJsFunctionPattern(\"getEligibleParty\"), \"function getEligibleParty(party) {}\"); not really needed\n+    }};\n+    \n+    public static void main(String[] args) {\n+        filterDirectorySearchMatchingData(\"../../scripts/event\", functions);\n+    }\n+    \n+}"}, {"sha": "0dda7a55754bbd2bba28994297646417b01294c0", "filename": "world.ini", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/0203d45901fc57ab42fe4d64b559080f76886184/world.ini", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/0203d45901fc57ab42fe4d64b559080f76886184/world.ini", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/world.ini?ref=0203d45901fc57ab42fe4d64b559080f76886184", "patch": "@@ -11,10 +11,6 @@ servermessage0=Welcome to Scania!\n eventmessage0=Scania!\n whyamirecommended0=Welcome to Scania!\n channels0=3\n-exprate0=10\n-mesorate0=10\n-droprate0=10\n-questrate0=5\n \n #Properties for Bera 1\n flag1=0"}]}]},
