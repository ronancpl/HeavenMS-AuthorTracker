{"fetchDate": "2019-12-19", "content": [{"sha": "b7a259e2c45d0f2f6abb33c5698010f20da6b232", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6YjdhMjU5ZTJjNDVkMGYyZjZhYmIzM2M1Njk4MDEwZjIwZGE2YjIzMg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-22T23:58:56Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-22T23:58:56Z"}, "message": "Login bypass + MapleQuestlineFetcher\n\nSolved an exploit where anyone (via packet editing) could be able to login as any registered character after authenticating and selecting a character.\nNew tool: MapleQuestlineFetcher. It reports ids from quests which quest script files were not found on the scripts folder.", "tree": {"sha": "f8a2452ca02b9aca83721972ebe2126e1ea00a73", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/f8a2452ca02b9aca83721972ebe2126e1ea00a73"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/b7a259e2c45d0f2f6abb33c5698010f20da6b232", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b7a259e2c45d0f2f6abb33c5698010f20da6b232", "html_url": "https://github.com/ronancpl/HeavenMS/commit/b7a259e2c45d0f2f6abb33c5698010f20da6b232", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/b7a259e2c45d0f2f6abb33c5698010f20da6b232/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1fcf21ac9d2fb25411b1f65a9a6928359024a29", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/a1fcf21ac9d2fb25411b1f65a9a6928359024a29", "html_url": "https://github.com/ronancpl/HeavenMS/commit/a1fcf21ac9d2fb25411b1f65a9a6928359024a29"}], "stats": {"total": 1265, "additions": 1222, "deletions": 43}, "files": [{"sha": "12bf4644a3eb3ef588a3291eca4bfa7b298288b1", "filename": ".gitignore", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/.gitignore", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/.gitignore", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/.gitignore?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -55,6 +55,10 @@\n /tools/MapleQuestItemFetcher/dist/\n /tools/MapleQuestItemFetcher/nbproject/\n \n+/tools/MapleQuestlineFetcher/build/\n+/tools/MapleQuestlineFetcher/dist/\n+/tools/MapleQuestlineFetcher/nbproject/\n+\n /tools/MapleQuestMesoFetcher/build/\n /tools/MapleQuestMesoFetcher/dist/\n /tools/MapleQuestMesoFetcher/nbproject/"}, {"sha": "d703f102445936dfc44b95913c28b1c1a1b7bde9", "filename": "README.md", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/README.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/README.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/README.md?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -64,16 +64,6 @@ Now install the Java 7 Development Kit:\n * jdk-7u79-windows-x64.exe\n * netbeans-8.0.2-javase-windows.exe -> It's a NetBeans project, use other IDE at your own risk.\n \n-Overwrite whenever prompted with the JAR files under \"jce_policy-7/UnlimitedJCEPolicy\" in these Java folders:\n-\n-* C:\\Program Files\\Java\\jre7\\lib\n-* C:\\Program Files\\Java\\jre7\\lib\\ext\n-* C:\\Program Files\\Java\\jre7\\lib\\security\n-* C:\\Program Files\\Java\\jdk1.7.0_01\\lib\n-* C:\\Program Files\\Java\\jdk1.7.0_01\\jre\\lib\n-* C:\\Program Files\\Java\\jdk1.7.0_01\\jre\\lib\\ext\n-* C:\\Program Files\\Java\\jdk1.7.0_01\\jre\\lib\\security\n-\n Now that the tools have been installed, test if they are working.\n \n For WampServer:"}, {"sha": "a0331018246f077a987174ddb644bdcbcfd65e1e", "filename": "docs/feature_list.md", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/feature_list.md", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/feature_list.md", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/feature_list.md?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -126,6 +126,7 @@ External tools:\n * MapleMesoFetcher - Creates meso drop data for mobs with more than 4 items (thus overworld mobs), calculations based on mob level and whether it's a boss or not.\n * MapleMobBookIndexer - Generates a SQL table with all relations of cardid and mobid present in the mob book.\n * MapleMobBookUpdate - Generates a wz.xml that is a copy of the original MonsterBook.wz.xml, except it updates the drop data info in the book with those currently on DB.\n+* MapleQuestlineFetcher - Searches the quest WZ files and reports in all questids that currently doesn't have script files.\n * MapleQuestItemCountFetcher - Searches the quest WZ files and reports in all relevant data regarding missing \"count\" labels on item acts at \"complete quest\".\n * MapleQuestItemFetcher - Searches the SQL tables and project files and reports in all relevant data regarding missing/erroneous quest items.\n * MapleQuestMesoFetcher - Searches the quest WZ files and reports in all relevant data regarding missing/erroneous quest fee checks.\n@@ -141,6 +142,12 @@ Project:\n * Heavily reviewed future task management inside the project. Way less trivial schedules are spawned now, relieving task overload on the TimerManager.\n * ThreadTracker: embedded auditing tool for run-time deadlock scanning throughout the server source (relies heavily on memory usage, designed only for debugging purposes).\n \n+Exploits patched:\n+\n+* Player being given free access to any character of any account once they have authenticated their account on login phase.\n+* Player being given permission to delete any character of any account once they have authenticated their account on login phase.\n+* Player being able to start/complete any quest freely.\n+\n Localhost:\n \n * Removed the 'n' problem within NPC dialog."}, {"sha": "fd56727d0ab8691b5d2d81fb6f38217ac939bba0", "filename": "docs/mychanges_ptbr.txt", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/mychanges_ptbr.txt?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -872,4 +872,8 @@ Adicionado scripts para a questline de Full Swing de Aran.\n \n 19 Mar\u00e7o 2018,\n Tentativa de corre\u00e7\u00e3o em reactors desconectando jogadores que tentam ativ\u00e1-los com ataque b\u00e1sico ao mesmo tempo.\n-Adicionado feature de AutoJCE (cr\u00e9ditos ao Kradi-a).\n\\ No newline at end of file\n+Adicionado feature de AutoJCE (cr\u00e9ditos aos Acernis devs).\n+\n+20 - 22 Mar\u00e7o 2018,\n+Resolvido exploit com login, onde qualquer um (via packet editing) podia logar livremente com personagem de outras contas.\n+Nova ferramenta: MapleQuestlineFetcher. Busca nos XMLs e registra questids que ainda n\u00e3o possuem quest scripts.\n\\ No newline at end of file"}, {"sha": "087ff5a20769ee1a2054d3b150623ab4f57d05ac", "filename": "docs/todo.txt", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/todo.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/docs/todo.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/docs/todo.txt?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -46,8 +46,6 @@ ToDo / Missing features list:\n \n ---------------------------\n ** Jobs **\n-- Check Aran\n-- Check Cygnus Knights\n ---------------------------\n \n "}, {"sha": "19513862d5a2f7b4270bd19a51aa29654ad5644b", "filename": "scripts/npc/9201050.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/npc/9201050.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/npc/9201050.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201050.js?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -47,7 +47,7 @@ function action(mode, type, selection) {\n                     selStr += \"\\r\\n#L\" + i + \"# \" + info[i] + \"#l\";\n                 cm.sendSimple(selStr);\n             }\n-            else if (!cm.getQuestStarted(4911)){\n+            else if (!cm.isQuestStarted(4911)){\n                 cm.sendNext(\"Good job! You've solved all of my questions about NLC. Enjoy of your trip!\");\n                 cm.dispose();\n                 return;"}, {"sha": "962e18df64c663c85c07ee9bcb5c6336d0cb12c6", "filename": "scripts/quest/21749.js", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21749.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21749.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21749.js?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,47 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+var status = -1;\n+\n+function start(mode, type, selection) {\n+    if (mode == -1) {\n+        qm.dispose();\n+    } else {\n+        if(mode == 0 && type > 0) {\n+            qm.dispose();\n+            return;\n+        }\n+        \n+        if (mode == 1)\n+            status++;\n+        else\n+            status--;\n+        \n+        if (status == 0) {\n+            qm.sendNext(\"So we have lost #btwo seal stones#k so far, from the neighboring areas of #rOrbis#k and #rMu Lung#k... Things are starting to get out of control, it seems.\");\n+        } else if (status == 1) {\n+            qm.sendNext(\"Aran, your next objective will be to use the #btime gate to Ellin#k again. This time you will be retrieving the long lost #rSeal Stone of Ellin Forest#k. According to informations our network have gathered, #b#p2131002##k of that time have a clue about that gem, #rfind her#k. Please be successful on this task, our world is relying on you more than ever!\");\n+        } else {\n+            qm.gainExp(500 * qm.getPlayer().getExpRate());\n+            qm.forceCompleteQuest();\n+            qm.dispose();\n+        }\n+    }\n+}"}, {"sha": "5538f24c0243661b7bb445b8095f84ce0d6e82d6", "filename": "scripts/quest/21750.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21750.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21750.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21750.js?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -36,8 +36,8 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Aran, you're finally back!!! How you've been doing? Where did you go for so long? We have so much to catch up...\");\n+        } else {\n             qm.forceCompleteQuest();\n-            \n             qm.dispose();\n         }\n     }"}, {"sha": "c4afbf9989373cf2eb8a6ccae361b1bdc79fb112", "filename": "scripts/quest/21757.js", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21757.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/scripts/quest/21757.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/quest/21757.js?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -36,6 +36,7 @@ function end(mode, type, selection) {\n         \n         if (status == 0) {\n             qm.sendNext(\"Oh, a letter for the #rempress#k? From the #bheroes#k?!\");\n+        } else {\n             qm.gainExp(1000 * qm.getPlayer().getExpRate());\n             qm.gainItem(4032330, -1);\n             qm.forceCompleteQuest();"}, {"sha": "2faac327cd6050ada580e3b8768cd4e0c85bef05", "filename": "src/client/MapleCharacter.java", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/client/MapleCharacter.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/client/MapleCharacter.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/MapleCharacter.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -1716,27 +1716,26 @@ public void deleteBuddy(int otherCid) {\n     }\n     \n     public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n-            int cid = player.getId(), accId = -1, world = 0;\n+            int cid = player.getId();\n+            if(!Server.getInstance().haveCharacterid(senderAccId, cid)) {\n+                    return false;\n+            }\n             \n+            int accId = senderAccId, world = 0;\n             Connection con = null;\n             try {\n                     con = DatabaseConnection.getConnection();\n                     \n-                    try (PreparedStatement ps = con.prepareStatement(\"SELECT accountid, world FROM characters WHERE id = ?\")) {\n+                    try (PreparedStatement ps = con.prepareStatement(\"SELECT world FROM characters WHERE id = ?\")) {\n                             ps.setInt(1, cid);\n \n                             try (ResultSet rs = ps.executeQuery()) {\n                                     if(rs.next()) {\n-                                            accId = rs.getInt(\"accountid\");\n                                             world = rs.getInt(\"world\");\n                                     }\n                             }\n                     }\n                     \n-                    if(senderAccId != accId) {\n-                            return false;\n-                    }\n-                    \n                     try (PreparedStatement ps = con.prepareStatement(\"SELECT buddyid FROM buddies WHERE characterid = ?\")) {\n                             ps.setInt(1, cid);\n \n@@ -1896,6 +1895,7 @@ public static boolean deleteCharFromDB(MapleCharacter player, int senderAccId) {\n                     }\n                     \n                     con.close();\n+                    Server.getInstance().deleteCharacterid(accId, cid);\n                     return true;\n             } catch (SQLException e) {\n                     e.printStackTrace();"}, {"sha": "5f4aa4a02348d0f8293741a515cb290ddf265a8a", "filename": "src/client/inventory/Equip.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/client/inventory/Equip.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/client/inventory/Equip.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/client/inventory/Equip.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -470,7 +470,7 @@ private void gainLevel(MapleClient c) {\n             lvupStr += \"+UPGSLOT \";\n         }\n         \n-        showLevelupMessage(showStr, c); // thx to polaris devs !\n+        showLevelupMessage(showStr, c); // thx to Polaris dev team !\n         c.getPlayer().dropMessage(6, lvupStr);\n         \n         c.announce(MaplePacketCreator.showEquipmentLevelUp());"}, {"sha": "ea9e94cec693a5f1c6a9fb50d29edbb25ebaf1d5", "filename": "src/net/server/Server.java", "status": "modified", "additions": 103, "deletions": 1, "changes": 104, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/Server.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/Server.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/Server.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -42,7 +42,6 @@\n import java.util.Set;\n import tools.locks.MonitoredReentrantLock;\n import java.util.concurrent.locks.Lock;\n-import java.util.concurrent.ScheduledFuture;\n \n import net.MapleServerHandler;\n import net.mina.MapleCodecFactory;\n@@ -88,10 +87,13 @@\n     private List<World> worlds = new ArrayList<>();\n     private final Properties subnetInfo = new Properties();\n     private static Server instance = null;\n+    private final Map<Integer, Set<Integer>> accountChars = new HashMap<>();\n+    private final Map<String, Integer> transitioningChars = new HashMap<>();\n     private List<Pair<Integer, String>> worldRecommendedList = new LinkedList<>();\n     private final Map<Integer, MapleGuild> guilds = new HashMap<>(100);\n     private final Map<MapleClient, Long> inLoginState = new HashMap<>(100);\n     private final Lock srvLock = new MonitoredReentrantLock(MonitoredLockType.SERVER);\n+    private final Lock lgnLock = new MonitoredReentrantLock(MonitoredLockType.SERVER);\n     private final PlayerBuffStorage buffStorage = new PlayerBuffStorage();\n     private final Map<Integer, MapleAlliance> alliances = new HashMap<>(100);\n     private final Map<Integer, NewYearCardRecord> newyears = new HashMap<>();\n@@ -751,6 +753,106 @@ public World getWorld(int id) {\n         return worlds;\n     }\n \n+    private static void loadCharacteridsFromDb(Integer accountid, Set<Integer> accChars) {\n+        try {\n+            try (Connection con = DatabaseConnection.getConnection()) {\n+                try (PreparedStatement ps = con.prepareStatement(\"SELECT id FROM characters WHERE accountid = ?\")) {\n+                    ps.setInt(1, accountid);\n+\n+                    try (ResultSet rs = ps.executeQuery()) {\n+                        while(rs.next()) {\n+                            accChars.add(rs.getInt(\"id\"));\n+                        }\n+                    }\n+                }\n+            }\n+        } catch (SQLException sqle) {\n+            sqle.printStackTrace();\n+        }\n+    }\n+    \n+    public boolean haveCharacterid(Integer accountid, Integer chrid) {\n+        lgnLock.lock();\n+        try {\n+            Set<Integer> accChars = accountChars.get(accountid);\n+            if(accChars == null) {\n+                accChars = new HashSet<>(5);\n+                loadCharacteridsFromDb(accountid, accChars);\n+\n+                accountChars.put(accountid, accChars);\n+            }\n+\n+            return accChars.contains(chrid);\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    \n+    public void createCharacterid(Integer accountid, Integer chrid) {\n+        lgnLock.lock();\n+        try {\n+            Set<Integer> accChars = accountChars.get(accountid);\n+            if(accChars == null) {\n+                accChars = new HashSet<>(5);\n+                accountChars.put(accountid, accChars);\n+            }\n+\n+            accChars.add(chrid);\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    \n+    public void deleteCharacterid(Integer accountid, Integer chrid) {\n+        lgnLock.lock();\n+        try {\n+            Set<Integer> accChars = accountChars.get(accountid);\n+            if(accChars != null) {\n+                accChars.remove(chrid);\n+            }\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    \n+    /*\n+    public void deleteAccount(Integer accountid) { is this even a thing?\n+        lgnLock.lock();\n+        try {\n+            accountChars.remove(accountid);\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    */\n+    \n+    private static String getRemoteIp(InetSocketAddress isa) {\n+        return isa.getAddress().getHostAddress();\n+    }\n+    \n+    public void setCharacteridInTransition(InetSocketAddress isa, int charId) {\n+        String remoteIp = getRemoteIp(isa);\n+        \n+        lgnLock.lock();\n+        try {\n+            transitioningChars.put(remoteIp, charId);\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    \n+    public boolean validateCharacteridInTransition(InetSocketAddress isa, int charId) {\n+        String remoteIp = getRemoteIp(isa);\n+        \n+        lgnLock.lock();\n+        try {\n+            Integer cid = transitioningChars.remove(remoteIp);\n+            return cid != null && cid.equals(charId);\n+        } finally {\n+            lgnLock.unlock();\n+        }\n+    }\n+    \n     public void registerLoginState(MapleClient c) {\n         srvLock.lock();\n         try {"}, {"sha": "7087812a60d7751dfe953ca7fb74eb6e67f5cabe", "filename": "src/net/server/channel/handlers/PlayerLoggedinHandler.java", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/channel/handlers/PlayerLoggedinHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/PlayerLoggedinHandler.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -53,6 +53,7 @@\n import client.inventory.MaplePet;\n import constants.GameConstants;\n import constants.ServerConstants;\n+import java.net.InetSocketAddress;\n import java.util.Collections;\n import java.util.Comparator;\n import java.util.Map;\n@@ -71,6 +72,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleCharacter player = c.getWorldServer().getPlayerStorage().getCharacterById(cid);\n         boolean newcomer = false;\n         if (player == null) {\n+            if(!server.validateCharacteridInTransition((InetSocketAddress) c.getSession().getRemoteAddress(), cid)) {\n+                c.disconnect(true, false);\n+                return;\n+            }\n+            \n             try {\n                 player = MapleCharacter.loadCharFromDB(cid, c, true);\n                 newcomer = true;"}, {"sha": "4fe992196c48c6c9102b3590fd01aa4e4aefab17", "filename": "src/net/server/handlers/login/CharSelectedHandler.java", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CharSelectedHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CharSelectedHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharSelectedHandler.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -23,6 +23,7 @@\n \n import client.MapleClient;\n import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n import java.net.UnknownHostException;\n import net.AbstractMaplePacketHandler;\n import net.server.Server;\n@@ -35,16 +36,26 @@\n     public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n         int charId = slea.readInt();\n         String macs = slea.readMapleAsciiString();\n+        String hwid = slea.readMapleAsciiString();\n         c.updateMacs(macs);\n-        if (c.hasBannedMac()) {\n+        c.updateHWID(hwid);\n+        \n+        if (c.hasBannedMac() || c.hasBannedHWID()) {\n             c.getSession().close(true);\n             return;\n         }\n \n-        Server.getInstance().unregisterLoginState(c);\n+        Server server = Server.getInstance();\n+        if(!server.haveCharacterid(c.getAccID(), charId)) {\n+            c.getSession().close(true);\n+            return;\n+        }\n+        \n+        server.unregisterLoginState(c);\n         c.updateLoginState(MapleClient.LOGIN_SERVER_TRANSITION);\n+        server.setCharacteridInTransition((InetSocketAddress) c.getSession().getRemoteAddress(), charId);\n         \n-        String[] socket = Server.getInstance().getIP(c.getWorld(), c.getChannel()).split(\":\");\n+        String[] socket = server.getIP(c.getWorld(), c.getChannel()).split(\":\");\n         try {\n             c.announce(MaplePacketCreator.getServerIP(InetAddress.getByName(socket[0]), Integer.parseInt(socket[1]), charId));\n         } catch (UnknownHostException | NumberFormatException e) {"}, {"sha": "8b2fef33dcd213be4204fbbbbee514a54fc66199", "filename": "src/net/server/handlers/login/CharSelectedWithPicHandler.java", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CharSelectedWithPicHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CharSelectedWithPicHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CharSelectedWithPicHandler.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -1,6 +1,7 @@\n package net.server.handlers.login;\n \n import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n import java.net.UnknownHostException;\n \n import net.AbstractMaplePacketHandler;\n@@ -13,7 +14,6 @@\n \n     @Override\n     public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n-\n         String pic = slea.readMapleAsciiString();\n         int charId = slea.readInt();\n         String macs = slea.readMapleAsciiString();\n@@ -25,11 +25,19 @@ public void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c) {\n             c.getSession().close(true);\n             return;\n         }\n+        \n+        Server server = Server.getInstance();\n+        if(!server.haveCharacterid(c.getAccID(), charId)) {\n+            c.getSession().close(true);\n+            return;\n+        }\n+        \n         if (c.checkPic(pic)) {\n-            Server.getInstance().unregisterLoginState(c);\n+            server.unregisterLoginState(c);\n             c.updateLoginState(MapleClient.LOGIN_SERVER_TRANSITION);\n+            server.setCharacteridInTransition((InetSocketAddress) c.getSession().getRemoteAddress(), charId);\n \n-            String[] socket = Server.getInstance().getIP(c.getWorld(), c.getChannel()).split(\":\");\n+            String[] socket = server.getIP(c.getWorld(), c.getChannel()).split(\":\");\n             try {\n                 c.announce(MaplePacketCreator.getServerIP(InetAddress.getByName(socket[0]), Integer.parseInt(socket[1]), charId));\n             } catch (UnknownHostException | NumberFormatException e) {"}, {"sha": "18d90d0c5648af3ed6bfc8109b2bcb9cc886f111", "filename": "src/net/server/handlers/login/CreateCharHandler.java", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CreateCharHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/net/server/handlers/login/CreateCharHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/handlers/login/CreateCharHandler.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -112,17 +112,21 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t}\n \n \t\tMapleInventory equipped = newchar.getInventory(MapleInventoryType.EQUIPPED);\n-\n-\t\tItem eq_top = MapleItemInformationProvider.getInstance().getEquipById(top);\n+                MapleItemInformationProvider ii = MapleItemInformationProvider.getInstance();\n+                \n+\t\tItem eq_top = ii.getEquipById(top);\n \t\teq_top.setPosition((byte) -5);\n \t\tequipped.addFromDB(eq_top);\n-\t\tItem eq_bottom = MapleItemInformationProvider.getInstance().getEquipById(bottom);\n+                \n+\t\tItem eq_bottom = ii.getEquipById(bottom);\n \t\teq_bottom.setPosition((byte) -6);\n \t\tequipped.addFromDB(eq_bottom);\n-\t\tItem eq_shoes = MapleItemInformationProvider.getInstance().getEquipById(shoes);\n+                \n+\t\tItem eq_shoes = ii.getEquipById(shoes);\n \t\teq_shoes.setPosition((byte) -7);\n \t\tequipped.addFromDB(eq_shoes);\n-\t\tItem eq_weapon = MapleItemInformationProvider.getInstance().getEquipById(weapon);\n+                \n+\t\tItem eq_weapon = ii.getEquipById(weapon);\n \t\teq_weapon.setPosition((byte) -11);\n \t\tequipped.addFromDB(eq_weapon.copy());\n \n@@ -131,6 +135,8 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n \t\t\treturn;\n \t\t}\n \t\tc.announce(MaplePacketCreator.addNewCharEntry(newchar));\n-\t\tServer.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[NEW CHAR]: \" + c.getAccountName() + \" has created a new character with IGN \" + name));\n+                \n+                Server.getInstance().createCharacterid(newchar.getAccountID(), newchar.getId());\n+                Server.getInstance().broadcastGMMessage(c.getWorld(), MaplePacketCreator.sendYellowTip(\"[NEW CHAR]: \" + c.getAccountName() + \" has created a new character with IGN \" + name));\n \t}\n }\n\\ No newline at end of file"}, {"sha": "5ab9a175e5bd94e9482460753e59ab485221b5d6", "filename": "src/tools/AutoJCE.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/tools/AutoJCE.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/tools/AutoJCE.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/AutoJCE.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -6,7 +6,7 @@\n import java.security.PermissionCollection;\n import java.util.Map;\n \n-public class AutoJCE{   // AutoJCE into server source thanks to Kradi-a\n+public class AutoJCE{   // AutoJCE into server source thanks to Acernis dev team\n \n \t/**\n \t * Credits: ntoskrnl of StackOverflow"}, {"sha": "6b14b821e26c4beadd3bb09a928a8192e569411f", "filename": "src/tools/MapleAESOFB.java", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/tools/MapleAESOFB.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/src/tools/MapleAESOFB.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MapleAESOFB.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -63,7 +63,7 @@ public MapleAESOFB(byte iv[], short mapleVersion) {\n         } catch (NoSuchPaddingException e) {\n             System.out.println(\"ERROR \" + e);\n         } catch (InvalidKeyException e) {\n-            System.out.println(\"Error initalizing the encryption cipher.  Make sure you're using the Unlimited Strength cryptography jar files.\");\n+            System.out.println(\"Error initializing the encryption cipher.  Make sure you're using the Unlimited Strength cryptography jar files.\");\n         }\n         this.setIv(iv);\n         this.mapleVersion = (short) (((mapleVersion >> 8) & 0xFF) | ((mapleVersion << 8) & 0xFF00));"}, {"sha": "d1ce0d366fd7e3094589cd4a0fb326d4791bb713", "filename": "tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestItemCountFetcher/src/maplequestitemcountfetcher/MapleQuestItemCountFetcher.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -27,16 +27,11 @@ This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n import java.io.PrintWriter;\n import java.sql.Connection;\n import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.Comparator;\n-import java.util.LinkedList;\n import java.util.List;\n import java.util.LinkedHashMap;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.Map.Entry;\n-import java.util.HashSet;\n-import java.util.Set;\n \n /**\n  *"}, {"sha": "c18acb607bb147d73b2e99d1bd55bf66adf01ac0", "filename": "tools/MapleQuestlineFetcher/build.xml", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/build.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/build.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestlineFetcher/build.xml?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,73 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- You may freely edit this file. See commented blocks below for -->\n+<!-- some examples of how to customize the build. -->\n+<!-- (If you delete it and reopen the project it will be recreated.) -->\n+<!-- By default, only the Clean and Build commands use this build script. -->\n+<!-- Commands such as Run, Debug, and Test only use this build script if -->\n+<!-- the Compile on Save feature is turned off for the project. -->\n+<!-- You can turn off the Compile on Save (or Deploy on Save) setting -->\n+<!-- in the project's Project Properties dialog box.-->\n+<project name=\"MapleQuestlineFetcher\" default=\"default\" basedir=\".\">\n+    <description>Builds, tests, and runs the project MapleQuestlineFetcher.</description>\n+    <import file=\"nbproject/build-impl.xml\"/>\n+    <!--\n+\n+    There exist several targets which are by default empty and which can be \n+    used for execution of your tasks. These targets are usually executed \n+    before and after some main targets. They are: \n+\n+      -pre-init:                 called before initialization of project properties\n+      -post-init:                called after initialization of project properties\n+      -pre-compile:              called before javac compilation\n+      -post-compile:             called after javac compilation\n+      -pre-compile-single:       called before javac compilation of single file\n+      -post-compile-single:      called after javac compilation of single file\n+      -pre-compile-test:         called before javac compilation of JUnit tests\n+      -post-compile-test:        called after javac compilation of JUnit tests\n+      -pre-compile-test-single:  called before javac compilation of single JUnit test\n+      -post-compile-test-single: called after javac compilation of single JUunit test\n+      -pre-jar:                  called before JAR building\n+      -post-jar:                 called after JAR building\n+      -post-clean:               called after cleaning build products\n+\n+    (Targets beginning with '-' are not intended to be called on their own.)\n+\n+    Example of inserting an obfuscator after compilation could look like this:\n+\n+        <target name=\"-post-compile\">\n+            <obfuscate>\n+                <fileset dir=\"${build.classes.dir}\"/>\n+            </obfuscate>\n+        </target>\n+\n+    For list of available properties check the imported \n+    nbproject/build-impl.xml file. \n+\n+\n+    Another way to customize the build is by overriding existing main targets.\n+    The targets of interest are: \n+\n+      -init-macrodef-javac:     defines macro for javac compilation\n+      -init-macrodef-junit:     defines macro for junit execution\n+      -init-macrodef-debug:     defines macro for class debugging\n+      -init-macrodef-java:      defines macro for class execution\n+      -do-jar:                  JAR building\n+      run:                      execution of project \n+      -javadoc-build:           Javadoc generation\n+      test-report:              JUnit report generation\n+\n+    An example of overriding the target for project execution could look like this:\n+\n+        <target name=\"run\" depends=\"MapleQuestlineFetcher-impl.jar\">\n+            <exec dir=\"bin\" executable=\"launcher.exe\">\n+                <arg file=\"${dist.jar}\"/>\n+            </exec>\n+        </target>\n+\n+    Notice that the overridden target depends on the jar target and not only on \n+    the compile target as the regular run target does. Again, for a list of available \n+    properties which you can use, check the target you are overriding in the\n+    nbproject/build-impl.xml file. \n+\n+    -->\n+</project>"}, {"sha": "c4ef7db9fb6d4876eb4a86fa246f930d305eaf46", "filename": "tools/MapleQuestlineFetcher/lib/QuestReport.txt", "status": "added", "additions": 373, "deletions": 0, "changes": 373, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/lib/QuestReport.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/lib/QuestReport.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestlineFetcher/lib/QuestReport.txt?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,373 @@\n+ # Report File autogenerated from the MapleQuestlineFetcher feature by Ronan Lana.\n+ # Generated data takes into account several data info from the server-side WZ.xmls.\n+\n+SKILL-RELATED NON-SCRIPTED QUESTS\n+  20500 EXPIRED\n+  20502 EXPIRED\n+\n+\n+COMMON NON-SCRIPTED QUESTS\n+  1028\n+  1048 EXPIRED\n+  1049 EXPIRED\n+  1050 EXPIRED\n+  1051 EXPIRED\n+  1052 EXPIRED\n+  1053 EXPIRED\n+  1054 EXPIRED\n+  2147 EXPIRED\n+  2228\n+  2232\n+  2233\n+  2234\n+  2238\n+  2245\n+  2257\n+  2258\n+  2259\n+  2260\n+  2291\n+  2338\n+  3305 EXPIRED\n+  3306 EXPIRED\n+  3529\n+  3714\n+  4482 EXPIRED\n+  4483 EXPIRED\n+  4490 EXPIRED\n+  4676 EXPIRED\n+  6700 EXPIRED\n+  8247 EXPIRED\n+  9432 EXPIRED\n+  9633 EXPIRED\n+  9680 EXPIRED\n+  9682 EXPIRED\n+  9683 EXPIRED\n+  9684 EXPIRED\n+  9685 EXPIRED\n+  9690 EXPIRED\n+  9691 EXPIRED\n+  9692 EXPIRED\n+  9693 EXPIRED\n+  9694 EXPIRED\n+  9695 EXPIRED\n+  9696 EXPIRED\n+  9697 EXPIRED\n+  9698 EXPIRED\n+  9699 EXPIRED\n+  9700 EXPIRED\n+  9701 EXPIRED\n+  9702 EXPIRED\n+  9703 EXPIRED\n+  9730 EXPIRED\n+  9731 EXPIRED\n+  9732 EXPIRED\n+  9733 EXPIRED\n+  9734 EXPIRED\n+  9735 EXPIRED\n+  9745 EXPIRED\n+  9746 EXPIRED\n+  9747 EXPIRED\n+  9840 EXPIRED\n+  9841 EXPIRED\n+  9842 EXPIRED\n+  9844 EXPIRED\n+  9845 EXPIRED\n+  9846 EXPIRED\n+  9847 EXPIRED\n+  9849 EXPIRED\n+  9850 EXPIRED\n+  9851 EXPIRED\n+  9860 EXPIRED\n+  9875 EXPIRED\n+  9878 EXPIRED\n+  9880 EXPIRED\n+  9881 EXPIRED\n+  9882 EXPIRED\n+  9883 EXPIRED\n+  9884 EXPIRED\n+  9885 EXPIRED\n+  9887 EXPIRED\n+  9890 EXPIRED\n+  9891 EXPIRED\n+  9892 EXPIRED\n+  9893 EXPIRED\n+  9900 EXPIRED\n+  9901 EXPIRED\n+  9902 EXPIRED\n+  9903 EXPIRED\n+  9904 EXPIRED\n+  9905 EXPIRED\n+  9906 EXPIRED\n+  9907 EXPIRED\n+  9908 EXPIRED\n+  9909 EXPIRED\n+  9920 EXPIRED\n+  9922 EXPIRED\n+  9924 EXPIRED\n+  9925 EXPIRED\n+  9926 EXPIRED\n+  9927 EXPIRED\n+  9928 EXPIRED\n+  9929 EXPIRED\n+  9930 EXPIRED\n+  9931 EXPIRED\n+  9932 EXPIRED\n+  9933 EXPIRED\n+  9934 EXPIRED\n+  9935 EXPIRED\n+  9936 EXPIRED\n+  9937 EXPIRED\n+  9938 EXPIRED\n+  9939 EXPIRED\n+  9943 EXPIRED\n+  9947 EXPIRED\n+  9950 EXPIRED\n+  9951 EXPIRED\n+  9961 EXPIRED\n+  9965 EXPIRED\n+  9970 EXPIRED\n+  9980 EXPIRED\n+  9981 EXPIRED\n+  9982 EXPIRED\n+  9983 EXPIRED\n+  9984 EXPIRED\n+  9985 EXPIRED\n+  9990 EXPIRED\n+  9991 EXPIRED\n+  9997 EXPIRED\n+  10002 EXPIRED\n+  10008 EXPIRED\n+  10010 EXPIRED\n+  10011 EXPIRED\n+  10012 EXPIRED\n+  10014 EXPIRED\n+  10034 EXPIRED\n+  10036 EXPIRED\n+  10037 EXPIRED\n+  10039 EXPIRED\n+  10043 EXPIRED\n+  10046 EXPIRED\n+  10050 EXPIRED\n+  10052 EXPIRED\n+  10059 EXPIRED\n+  10066 EXPIRED\n+  10069 EXPIRED\n+  10074 EXPIRED\n+  10075 EXPIRED\n+  10076 EXPIRED\n+  10077 EXPIRED\n+  10078 EXPIRED\n+  10079 EXPIRED\n+  10082 EXPIRED\n+  10083 EXPIRED\n+  10084 EXPIRED\n+  10085 EXPIRED\n+  10086 EXPIRED\n+  10087 EXPIRED\n+  10088 EXPIRED\n+  10089 EXPIRED\n+  10090 EXPIRED\n+  10091 EXPIRED\n+  10092 EXPIRED\n+  10093 EXPIRED\n+  10094 EXPIRED\n+  10095 EXPIRED\n+  10096 EXPIRED\n+  10097 EXPIRED\n+  10098 EXPIRED\n+  10099 EXPIRED\n+  10100 EXPIRED\n+  10101 EXPIRED\n+  10102 EXPIRED\n+  10103 EXPIRED\n+  10104 EXPIRED\n+  10105 EXPIRED\n+  10106 EXPIRED\n+  10108 EXPIRED\n+  10110 EXPIRED\n+  10206 EXPIRED\n+  10207 EXPIRED\n+  10208 EXPIRED\n+  10209 EXPIRED\n+  10210 EXPIRED\n+  10211 EXPIRED\n+  10212 EXPIRED\n+  10213 EXPIRED\n+  10214 EXPIRED\n+  10215 EXPIRED\n+  10216 EXPIRED\n+  10217 EXPIRED\n+  10218 EXPIRED\n+  10219 EXPIRED\n+  10220 EXPIRED\n+  10222 EXPIRED\n+  10224 EXPIRED\n+  10231 EXPIRED\n+  10240 EXPIRED\n+  10241 EXPIRED\n+  10242 EXPIRED\n+  10243 EXPIRED\n+  10244 EXPIRED\n+  10245 EXPIRED\n+  10246 EXPIRED\n+  10247 EXPIRED\n+  10248 EXPIRED\n+  10249 EXPIRED\n+  10250 EXPIRED\n+  10251 EXPIRED\n+  10252 EXPIRED\n+  10253 EXPIRED\n+  10254 EXPIRED\n+  10255 EXPIRED\n+  10256 EXPIRED\n+  10260 EXPIRED\n+  10261 EXPIRED\n+  10262 EXPIRED\n+  10263 EXPIRED\n+  10264 EXPIRED\n+  10265 EXPIRED\n+  10266 EXPIRED\n+  10267 EXPIRED\n+  10268 EXPIRED\n+  10270 EXPIRED\n+  10271 EXPIRED\n+  10272 EXPIRED\n+  10274 EXPIRED\n+  10275 EXPIRED\n+  10276 EXPIRED\n+  10277 EXPIRED\n+  10278 EXPIRED\n+  10279 EXPIRED\n+  10280 EXPIRED\n+  10281 EXPIRED\n+  10282 EXPIRED\n+  10283 EXPIRED\n+  10284 EXPIRED\n+  10287 EXPIRED\n+  10300 EXPIRED\n+  10301 EXPIRED\n+  10302 EXPIRED\n+  10311 EXPIRED\n+  10312 EXPIRED\n+  10313 EXPIRED\n+  10314 EXPIRED\n+  10315 EXPIRED\n+  10316 EXPIRED\n+  10317 EXPIRED\n+  10318 EXPIRED\n+  10319 EXPIRED\n+  10320 EXPIRED\n+  10321 EXPIRED\n+  10324 EXPIRED\n+  10325 EXPIRED\n+  10326 EXPIRED\n+  10327 EXPIRED\n+  10329 EXPIRED\n+  10330 EXPIRED\n+  10331 EXPIRED\n+  10332 EXPIRED\n+  10333 EXPIRED\n+  10340 EXPIRED\n+  10341 EXPIRED\n+  10342 EXPIRED\n+  10344 EXPIRED\n+  10345 EXPIRED\n+  10346 EXPIRED\n+  10347 EXPIRED\n+  10348 EXPIRED\n+  10349 EXPIRED\n+  10350 EXPIRED\n+  10351 EXPIRED\n+  10352 EXPIRED\n+  10353 EXPIRED\n+  10354 EXPIRED\n+  10355 EXPIRED\n+  10356 EXPIRED\n+  10360 EXPIRED\n+  10370 EXPIRED\n+  10380 EXPIRED\n+  10394 EXPIRED\n+  10395 EXPIRED\n+  10396 EXPIRED\n+  10397 EXPIRED\n+  10398 EXPIRED\n+  10400 EXPIRED\n+  10401 EXPIRED\n+  10415 EXPIRED\n+  10417 EXPIRED\n+  10418 EXPIRED\n+  10419 EXPIRED\n+  10420 EXPIRED\n+  10450 EXPIRED\n+  10451 EXPIRED\n+  10452 EXPIRED\n+  10453 EXPIRED\n+  10454 EXPIRED\n+  10455 EXPIRED\n+  10456 EXPIRED\n+  10457 EXPIRED\n+  10470 EXPIRED\n+  19000\n+  19001\n+  19002\n+  19005 EXPIRED\n+  19006 EXPIRED\n+  20015\n+  20020\n+  20400\n+  20401\n+  20405\n+  20406\n+  20408\n+  20506 EXPIRED\n+  20507 EXPIRED\n+  20509 EXPIRED\n+  21303\n+  28004 EXPIRED\n+  28117 EXPIRED\n+  28118 EXPIRED\n+  28131 EXPIRED\n+  28137 EXPIRED\n+  28138 EXPIRED\n+  28139 EXPIRED\n+  28140 EXPIRED\n+  28141 EXPIRED\n+  28142 EXPIRED\n+  28143 EXPIRED\n+  28144 EXPIRED\n+  28145 EXPIRED\n+  28146 EXPIRED\n+  28147 EXPIRED\n+  28148 EXPIRED\n+  28149 EXPIRED\n+  28150 EXPIRED\n+  28151 EXPIRED\n+  28152 EXPIRED\n+  28153 EXPIRED\n+  28154 EXPIRED\n+  28155 EXPIRED\n+  28156 EXPIRED\n+  28157 EXPIRED\n+  28158 EXPIRED\n+  28159 EXPIRED\n+  28160 EXPIRED\n+  28161 EXPIRED\n+  28284 EXPIRED\n+  28285 EXPIRED\n+  28286 EXPIRED\n+  28304 EXPIRED\n+  28311 EXPIRED\n+  28318 EXPIRED\n+  28326 EXPIRED\n+  28327 EXPIRED\n+  28328 EXPIRED\n+  28333 EXPIRED\n+  28337 EXPIRED\n+  29500\n+  29501\n+  29502\n+  29503\n+  29505\n+  29506\n+  29508"}, {"sha": "328e8e5bc3b7f1f7bad2bc0751a933e00c801983", "filename": "tools/MapleQuestlineFetcher/manifest.mf", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/manifest.mf", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/manifest.mf", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestlineFetcher/manifest.mf?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,3 @@\n+Manifest-Version: 1.0\n+X-COMMENT: Main-Class will be added automatically by build\n+"}, {"sha": "d29de492b06206c32ddd5421e5a63176c2b73ed9", "filename": "tools/MapleQuestlineFetcher/src/maplequestlinefetcher/MapleQuestlineFetcher.java", "status": "added", "additions": 424, "deletions": 0, "changes": 424, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/MapleQuestlineFetcher.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/MapleQuestlineFetcher.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/MapleQuestlineFetcher.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,424 @@\n+/*\n+    This file is part of the HeavenMS (MapleSolaxiaV2) MapleStory Server\n+    Copyleft (L) 2017 RonanLana\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+package maplequestlinefetcher;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.sql.Connection;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.Stack;\n+\n+/**\n+ *\n+ * @author RonanLana\n+ \n+ This application parses the Quest.wz file inputted and generates a report showing\n+ all cases where quest script files have not been found for quests that requires a\n+ script file.\n+ As an extension, it highlights missing script files for questlines that hand over\n+ skills as rewards.\n+ \n+ Running it should generate a report file under \"lib\" folder with the search results.\n+ \n+ */\n+public class MapleQuestlineFetcher {\n+    static String actName = \"../../wz/Quest.wz/Act.img.xml\";\n+    static String checkName = \"../../wz/Quest.wz/Check.img.xml\";\n+    static String directoryName = \"../..\";\n+    static String newFile = \"lib/QuestReport.txt\";\n+\n+    static Connection con = null;\n+    static PrintWriter printWriter = null;\n+    static InputStreamReader fileReader = null;\n+    static BufferedReader bufferedReader = null;\n+    \n+    static int initialLength = 200;\n+    static int initialStringLength = 50;\n+    \n+    static byte status = 0;\n+    static int questId = -1;\n+    static int isCompleteState = 0;\n+    static boolean isScriptedQuest;\n+    static boolean isExpiredQuest;\n+    static List<Integer> questDependencyList;\n+    \n+    static int curQuestId;\n+    static int curQuestState;\n+    \n+    static Stack<Integer> skillObtainableQuests = new Stack<>();\n+    static Set<Integer> scriptedQuestFiles = new HashSet<>();\n+    static Set<Integer> expiredQuests = new HashSet<>();\n+    \n+    static Map<Integer, List<Integer>> questDependencies = new HashMap<>();\n+    \n+    static Set<Integer> nonScriptedQuests = new HashSet<>();\n+    static Set<Integer> skillObtainableNonScriptedQuests = new HashSet<>();\n+    \n+    private static String getName(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+\n+        i = token.lastIndexOf(\"name\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static String getValue(String token) {\n+        int i, j;\n+        char[] dest;\n+        String d;\n+\n+        i = token.lastIndexOf(\"value\");\n+        i = token.indexOf(\"\\\"\", i) + 1; //lower bound of the string\n+        j = token.indexOf(\"\\\"\", i);     //upper bound\n+\n+        dest = new char[initialStringLength];\n+        token.getChars(i, j, dest, 0);\n+\n+        d = new String(dest);\n+        return(d.trim());\n+    }\n+    \n+    private static void forwardCursor(int st) {\n+        String line = null;\n+\n+        try {\n+            while(status >= st && (line = bufferedReader.readLine()) != null) {\n+                simpleToken(line);\n+            }\n+        }\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+\n+    private static void simpleToken(String token) {\n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            status += 1;\n+        }\n+    }\n+    \n+    private static void translateTokenCheck(String token) {\n+        String d;\n+        \n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+            \n+            if(status == 1) {\n+                evaluateCurrentQuest();\n+            }\n+            else if(status == 4) {\n+                evaluateCurrentQuestDependency();\n+            }\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            if(status == 1) {           //getting QuestId\n+                d = getName(token);\n+                questId = Integer.parseInt(d);\n+                \n+                isScriptedQuest = false;\n+                isExpiredQuest = false;\n+                questDependencyList = new LinkedList<>();\n+            }\n+            else if(status == 2) {      //start/complete\n+                d = getName(token);\n+                isCompleteState = Integer.parseInt(d);\n+            }\n+            else if(status == 3) {\n+                if(isCompleteState == 1 || !token.contains(\"quest\")) {\n+                    forwardCursor(status);\n+                }\n+            }\n+            \n+            status += 1;\n+        }\n+        else {\n+            if(status == 3) {\n+                d = getName(token);\n+                \n+                if(d.contains(\"script\")) {\n+                    isScriptedQuest = true;\n+                } else if(d.contains(\"end\")) {\n+                    isExpiredQuest = true;\n+                }\n+            }\n+            else if(status == 5) {\n+                readQuestLabel(token);\n+            }\n+        }\n+    }\n+    \n+    private static void translateTokenAct(String token) {\n+        String d;\n+        \n+        if(token.contains(\"/imgdir\")) {\n+            status -= 1;\n+        }\n+        else if(token.contains(\"imgdir\")) {\n+            if(status == 1) {           //getting QuestId\n+                d = getName(token);\n+                questId = Integer.parseInt(d);\n+            }\n+            else if(status == 2) {      //start/complete\n+                d = getName(token);\n+                isCompleteState = Integer.parseInt(d);\n+            }\n+            else if(status == 3) {\n+                if(isCompleteState == 1 && token.contains(\"skill\")) {\n+                    skillObtainableQuests.add(questId);\n+                }\n+                \n+                forwardCursor(status);\n+            }\n+            \n+            status += 1;\n+        }\n+    }\n+\n+    private static void readQuestLabel(String token) {\n+        String name = getName(token);\n+        String value = getValue(token);\n+\n+        switch(name) {\n+            case \"id\":\n+                curQuestId = Integer.parseInt(value);\n+                break;\n+\n+            case \"state\":\n+                curQuestState = Integer.parseInt(value);\n+                break;\n+        }\n+    }\n+    \n+    private static void evaluateCurrentQuestDependency() {\n+        if(curQuestState == 2) {\n+            questDependencyList.add(curQuestId);\n+        }\n+    }\n+    \n+    private static void evaluateCurrentQuest() {\n+        if(isScriptedQuest && !scriptedQuestFiles.contains(questId)) {\n+            nonScriptedQuests.add(questId);\n+        }\n+        if(isExpiredQuest) {\n+            expiredQuests.add(questId);\n+        }\n+        \n+        questDependencies.put(questId, questDependencyList);\n+    }\n+    \n+    private static void instantiateQuestScriptFiles(String directoryName) {\n+        File directory = new File(directoryName);\n+\n+        // get all the files from a directory\n+        File[] fList = directory.listFiles();\n+        for (File file : fList) {\n+            if (file.isFile()) {\n+                String fname = file.getName();\n+                \n+                try {\n+                    Integer questid = Integer.parseInt(fname.substring(0, fname.indexOf('.')));\n+                    scriptedQuestFiles.add(questid);\n+                } catch(NumberFormatException nfe) {}\n+            }\n+        }\n+    }\n+    \n+    private static void readQuestsWithMissingScripts() throws IOException {\n+        String line;\n+        \n+        fileReader = new InputStreamReader(new FileInputStream(checkName), \"UTF-8\");\n+        bufferedReader = new BufferedReader(fileReader);\n+\n+        while((line = bufferedReader.readLine()) != null) {\n+            translateTokenCheck(line);\n+        }\n+\n+        bufferedReader.close();\n+        fileReader.close();\n+    }\n+    \n+    private static void readQuestsWithSkillReward() throws IOException {\n+        String line;\n+        \n+        fileReader = new InputStreamReader(new FileInputStream(actName), \"UTF-8\");\n+        bufferedReader = new BufferedReader(fileReader);\n+\n+        while((line = bufferedReader.readLine()) != null) {\n+            translateTokenAct(line);\n+        }\n+\n+        bufferedReader.close();\n+        fileReader.close();\n+    }\n+    \n+    private static void calculateSkillRelatedMissingQuestScripts() {\n+        Stack<Integer> frontierQuests = skillObtainableQuests;\n+        Set<Integer> solvedQuests = new HashSet<>();\n+        \n+        while(!frontierQuests.isEmpty()) {\n+            Integer questid = frontierQuests.pop();\n+            solvedQuests.add(questid);\n+            \n+            if(nonScriptedQuests.contains(questid)) {\n+                skillObtainableNonScriptedQuests.add(questid);\n+                nonScriptedQuests.remove(questid);\n+            }\n+            \n+            List<Integer> questDependency = questDependencies.get(questid);\n+            for(Integer i : questDependency) {\n+                if(!solvedQuests.contains(i)) {\n+                    frontierQuests.add(i);\n+                }\n+            }\n+        }\n+    }\n+    \n+    private static void printReportFileHeader() {\n+        printWriter.println(\" # Report File autogenerated from the MapleQuestlineFetcher feature by Ronan Lana.\");\n+        printWriter.println(\" # Generated data takes into account several data info from the server-side WZ.xmls.\");\n+        printWriter.println();\n+    }\n+    \n+    private static List<Integer> getSortedListEntries(Set<Integer> set) {\n+        List<Integer> list = new ArrayList<>(set);\n+        Collections.sort(list);\n+        \n+        return list;\n+    }\n+    \n+    private static void printReportFileResults() {\n+        if(!skillObtainableNonScriptedQuests.isEmpty()) {\n+            printWriter.println(\"SKILL-RELATED NON-SCRIPTED QUESTS\");\n+            for(Integer nsq : getSortedListEntries(skillObtainableNonScriptedQuests)) {\n+                printWriter.println(\"  \" + nsq + (expiredQuests.contains(nsq) ? \" EXPIRED\" : \"\"));\n+            }\n+            \n+            printWriter.println();\n+        }\n+        \n+        printWriter.println(\"\\nCOMMON NON-SCRIPTED QUESTS\");\n+        for(Integer nsq : getSortedListEntries(nonScriptedQuests)) {\n+            printWriter.println(\"  \" + nsq + (expiredQuests.contains(nsq) ? \" EXPIRED\" : \"\"));\n+        }\n+    }\n+    \n+    private static void ReportQuestlineData() {\n+        // This will reference one line at a time\n+        \n+        try {\n+            System.out.println(\"Reading quest scripts...\");\n+            instantiateQuestScriptFiles(directoryName + \"/scripts/quest\");\n+            \n+            System.out.println(\"Reading WZs...\");\n+            readQuestsWithSkillReward();\n+            readQuestsWithMissingScripts();\n+            \n+            System.out.println(\"Calculating skill related quests...\");\n+            calculateSkillRelatedMissingQuestScripts();\n+            \n+            System.out.println(\"Reporting results...\");\n+            printWriter = new PrintWriter(newFile, \"UTF-8\");\n+            \n+            printReportFileHeader();\n+            printReportFileResults();\n+            \n+            printWriter.close();\n+            System.out.println(\"Done!\");\n+        }\n+\n+        catch(FileNotFoundException ex) {\n+            System.out.println(\"Unable to open quest file.\");\n+        }\n+        catch(IOException ex) {\n+            System.out.println(\"Error reading quest file.\");\n+        }\n+\n+        catch(Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+    \n+    /*\n+    static private List<Pair<Integer, List<Integer>>> getSortedMapEntries(Map<Integer, List<Integer>> map) {\n+        List<Pair<Integer, List<Integer>>> list = new ArrayList<>(map.size());\n+        for(Map.Entry<Integer, List<Integer>> e : map.entrySet()) {\n+            List<Integer> il = new ArrayList<>(2);\n+            for(Integer i : e.getValue()) {\n+                il.add(i);\n+            }\n+            \n+            Collections.sort(il, new Comparator<Integer>() {\n+                @Override\n+                public int compare(Integer o1, Integer o2) {\n+                    return o1 - o2;\n+                }\n+            });\n+            \n+            list.add(new Pair<>(e.getKey(), il));\n+        }\n+        \n+        Collections.sort(list, new Comparator<Pair<Integer, List<Integer>>>() {\n+            @Override\n+            public int compare(Pair<Integer, List<Integer>> o1, Pair<Integer, List<Integer>> o2) {\n+                return o1.getLeft() - o2.getLeft();\n+            }\n+        });\n+        \n+        return list;\n+    }\n+    \n+    private static void DumpQuestlineData() {\n+        for(Pair<Integer, List<Integer>> questDependency : getSortedMapEntries(questDependencies)) {\n+            if(!questDependency.right.isEmpty()) {\n+                System.out.println(questDependency);\n+            }\n+        }\n+    }\n+    */\n+    \n+    public static void main(String[] args) {\n+        ReportQuestlineData();\n+    }\n+    \n+}"}, {"sha": "cbf35bed697eef08c313aea9333650749a9138cb", "filename": "tools/MapleQuestlineFetcher/src/maplequestlinefetcher/Pair.java", "status": "added", "additions": 121, "deletions": 0, "changes": 121, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/Pair.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/Pair.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/tools/MapleQuestlineFetcher/src/maplequestlinefetcher/Pair.java?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -0,0 +1,121 @@\n+/*\n+This file is part of the OdinMS Maple Story Server\n+Copyright (C) 2008 ~ 2010 Patrick Huy <patrick.huy@frz.cc> \n+Matthias Butz <matze@odinms.de>\n+Jan Christian Meyer <vimes@odinms.de>\n+\n+This program is free software: you can redistribute it and/or modify\n+it under the terms of the GNU Affero General Public License version 3\n+as published by the Free Software Foundation. You may not use, modify\n+or distribute this program under any other version of the\n+GNU Affero General Public License.\n+\n+This program is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU Affero General Public License for more details.\n+\n+You should have received a copy of the GNU Affero General Public License\n+along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package maplequestlinefetcher;\n+\n+/**\n+ * Represents a pair of values.\n+ * \n+ * @author Frz\n+ * @since Revision 333\n+ * @version 1.0\n+ * \n+ * @param <E> The type of the left value.\n+ * @param <F> The type of the right value.\n+ */\n+public class Pair<E, F> {\n+\n+    public E left;\n+    public F right;\n+\n+    /**\n+     * Class constructor - pairs two objects together.\n+     *\n+     * @param left The left object.\n+     * @param right The right object.\n+     */\n+    public Pair(E left, F right) {\n+        this.left = left;\n+        this.right = right;\n+    }\n+\n+    /**\n+     * Gets the left value.\n+     *\n+     * @return The left value.\n+     */\n+    public E getLeft() {\n+        return left;\n+    }\n+\n+    /**\n+     * Gets the right value.\n+     *\n+     * @return The right value.\n+     */\n+    public F getRight() {\n+        return right;\n+    }\n+\n+    /**\n+     * Turns the pair into a string.\n+     *\n+     * @return Each value of the pair as a string joined by a colon.\n+     */\n+    @Override\n+    public String toString() {\n+        return left.toString() + \":\" + right.toString();\n+    }\n+\n+    /**\n+     * Gets the hash code of this pair.\n+     */\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((left == null) ? 0 : left.hashCode());\n+        result = prime * result + ((right == null) ? 0 : right.hashCode());\n+        return result;\n+    }\n+\n+    /**\n+     * Checks to see if two pairs are equal.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        }\n+        if (obj == null) {\n+            return false;\n+        }\n+        if (getClass() != obj.getClass()) {\n+            return false;\n+        }\n+        final Pair other = (Pair) obj;\n+        if (left == null) {\n+            if (other.left != null) {\n+                return false;\n+            }\n+        } else if (!left.equals(other.left)) {\n+            return false;\n+        }\n+        if (right == null) {\n+            if (other.right != null) {\n+                return false;\n+            }\n+        } else if (!right.equals(other.right)) {\n+            return false;\n+        }\n+        return true;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "f9f7f46f000a643f56c19c5de22eb6cb1123145a", "filename": "wz/Quest.wz/Check.img.xml", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/b7a259e2c45d0f2f6abb33c5698010f20da6b232/wz/Quest.wz/Check.img.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/b7a259e2c45d0f2f6abb33c5698010f20da6b232/wz/Quest.wz/Check.img.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/wz/Quest.wz/Check.img.xml?ref=b7a259e2c45d0f2f6abb33c5698010f20da6b232", "patch": "@@ -22801,6 +22801,12 @@\n         <int name=\"1\" value=\"2111\"/>\n         <int name=\"2\" value=\"2112\"/>\n       </imgdir>\n+      <imgdir name=\"quest\">\n+        <imgdir name=\"0\">\n+          <int name=\"id\" value=\"21749\"/>\n+          <int name=\"state\" value=\"2\"/>\n+        </imgdir>\n+      </imgdir>\n     </imgdir>\n     <imgdir name=\"1\">\n       <int name=\"npc\" value=\"2131000\"/>"}]}]},
