{"fetchDate": "2019-12-19", "content": [{"sha": "f6935d3d3b875693e295b5c678e6550fafdd2052", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ZjY5MzVkM2QzYjg3NTY5M2UyOTViNWM2NzhlNjU1MGZhZmRkMjA1Mg==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-06T22:26:48Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-06T22:26:48Z"}, "message": "Rearranged travel packets\n\nAn approach on infinite loopings on \"Before Takeoff\" maps.", "tree": {"sha": "0b29d2e6207ef6a6e18a092df933571dabe7f36d", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/0b29d2e6207ef6a6e18a092df933571dabe7f36d"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/f6935d3d3b875693e295b5c678e6550fafdd2052", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f6935d3d3b875693e295b5c678e6550fafdd2052", "html_url": "https://github.com/ronancpl/HeavenMS/commit/f6935d3d3b875693e295b5c678e6550fafdd2052", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f6935d3d3b875693e295b5c678e6550fafdd2052/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67af338f8a0577f613e11ceeee163e70f58dfaa9", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/67af338f8a0577f613e11ceeee163e70f58dfaa9", "html_url": "https://github.com/ronancpl/HeavenMS/commit/67af338f8a0577f613e11ceeee163e70f58dfaa9"}], "stats": {"total": 245, "additions": 124, "deletions": 121}, "files": [{"sha": "f3d2fb934b6f09f9a6425f1752eb0e040bc4709f", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -3,13 +3,13 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/9201134.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2030010.js</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2091005.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/scripting/event/EventManager.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2012001.js</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/net/SendOpcode.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/src/server/life/SpawnPoint.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/scripts/npc/world0/2012002.js</file>\n             <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMapFactory.java</file>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/server/life/MapleMonster.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/tools/MaplePacketCreator.java</file>\n             <file>file:/C:/Nexon/MapleSolaxia/scripts/event/Boats.js</file>\n             <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMap.java</file>\n         </group>"}, {"sha": "4d9286cb13b269f1020d397bc855227beeb5b724", "filename": "scripts/event/AirPlane.js", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/AirPlane.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/AirPlane.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/AirPlane.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -22,6 +22,8 @@ function init() {\n }\n \n function scheduleNew() {\n+    em.setProperty(\"docked\", \"true\");\n+    em.setProperty(\"entry\", \"true\");\n     em.schedule(\"stopEntry\", closeTime);\n     em.schedule(\"takeoff\", beginTime);\n }\n@@ -31,16 +33,17 @@ function stopEntry() {\n }\n \n function takeoff() {\n-    em.setProperty(\"entry\", \"true\");\n-\tKC_bfd.warpEveryone(Plane_to_CBD.getId());\n-\tCBD_bfd.warpEveryone(Plane_to_KC.getId());\n-    em.schedule(\"arrived\", rideTime);\n-    scheduleNew();\n+    em.setProperty(\"docked\",\"false\");\n+    KC_bfd.warpEveryone(Plane_to_CBD.getId());\n+    CBD_bfd.warpEveryone(Plane_to_KC.getId());\n+    em.schedule(\"arrived\", rideTime); //The time that require move to destination\n }\n \n function arrived() {\n-\tPlane_to_CBD.warpEveryone(CBD_docked.getId());\n-\tPlane_to_KC.warpEveryone(KC_docked.getId());\n+    Plane_to_CBD.warpEveryone(CBD_docked.getId());\n+    Plane_to_KC.warpEveryone(KC_docked.getId());\n+        \n+    scheduleNew();\n }\n \n function cancelSchedule() {"}, {"sha": "c2ee975b455089e580dc5761657a22313f40f911", "filename": "scripts/event/Boats.js", "status": "modified", "additions": 33, "deletions": 38, "changes": 71, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Boats.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Boats.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Boats.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -25,21 +25,22 @@ function init() {\n     Ellinia_docked = em.getChannelServer().getMapFactory().getMap(101000300);\n     Orbis_Station = em.getChannelServer().getMapFactory().getMap(200000100);\n     Orbis_docked = em.getChannelServer().getMapFactory().getMap(200000111);\n-    OBoatsetup();\n-    EBoatsetup();\n+    \n     scheduleNew();\n }\n \n function scheduleNew() {\n+    em.setProperty(\"docked\", \"true\");\n     Ellinia_docked.setDocked(true);\n     Orbis_docked.setDocked(true);\n-    Ellinia_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-    em.setProperty(\"docked\", \"true\");\n+    \n     em.setProperty(\"entry\", \"true\");\n-    em.setProperty(\"haveBalrog\",\"false\");\n+    em.setProperty(\"haveBalrog\", \"false\");\n     em.schedule(\"stopentry\", closeTime);\n     em.schedule(\"takeoff\", beginTime);\n+\n+    Boat_to_Orbis.killAllMonsters();\n+    Boat_to_Ellinia.killAllMonsters();\n }\n \n function stopentry() {\n@@ -48,55 +49,49 @@ function stopentry() {\n     Ellinia_Boat_Cabin.resetReactors();\n }\n \n-\n-\n function takeoff() {\n+    Orbis_btf.warpEveryone(Boat_to_Ellinia.getId());\n+    Ellinia_btf.warpEveryone(Boat_to_Orbis.getId());\n+    Ellinia_docked.broadcastShip(false);\n+    Orbis_docked.broadcastShip(false);\n+    \n     em.setProperty(\"docked\",\"false\");\n-\tOrbis_btf.warpEveryone(Boat_to_Ellinia.getId());\n-\tEllinia_btf.warpEveryone(Boat_to_Orbis.getId());\n     Ellinia_docked.setDocked(false);\n     Orbis_docked.setDocked(false);\n-    Ellinia_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n+    \n     em.schedule(\"invasion\", invasionTime);\n     em.schedule(\"arrived\", rideTime);\n }\n \n function arrived() {\n-\tBoat_to_Orbis.warpEveryone(Orbis_Station.getId());\n-\tOrbis_Boat_Cabin.warpEveryone(Orbis_Station.getId());\n-\tBoat_to_Ellinia.warpEveryone(Ellinia_docked.getId());\n-\tEllinia_Boat_Cabin.warpEveryone(Ellinia_docked.getId());\n+    Boat_to_Orbis.warpEveryone(Orbis_Station.getId());\n+    Orbis_Boat_Cabin.warpEveryone(Orbis_Station.getId());\n+    Boat_to_Ellinia.warpEveryone(Ellinia_docked.getId());\n+    Ellinia_Boat_Cabin.warpEveryone(Ellinia_docked.getId());\n+    Orbis_docked.broadcastShip(true);\n+    Ellinia_docked.broadcastShip(true);\n     Boat_to_Orbis.killAllMonsters();\n     Boat_to_Ellinia.killAllMonsters();\n+    em.setProperty(\"haveBalrog\", \"false\");\n     scheduleNew();\n }\n \n function invasion() {\n-    var numspawn = 2;\n-    if(numspawn > 0) {\n-        for(var i=0; i < numspawn; i++) {\n-            Boat_to_Orbis.spawnMonsterOnGroudBelow(MapleLifeFactory.getMonster(8150000), new java.awt.Point(485, -221));\n-            Boat_to_Ellinia.spawnMonsterOnGroudBelow(MapleLifeFactory.getMonster(8150000), new java.awt.Point(-590, -221));\n-        }\n-        Boat_to_Orbis.setDocked(true);\n-        Boat_to_Ellinia.setDocked(true);\n-        Boat_to_Orbis.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-        Boat_to_Ellinia.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-        Boat_to_Orbis.broadcastMessage(MaplePacketCreator.musicChange(\"Bgm04/ArabPirate\"));\n-        Boat_to_Ellinia.broadcastMessage(MaplePacketCreator.musicChange(\"Bgm04/ArabPirate\"));\n-        em.setProperty(\"haveBalrog\",\"true\");\n-    }\n-}\n+    if (Math.floor(Math.random() * 10) < 10) {\n+\tvar map1 = Boat_to_Ellinia;\n+\tvar pos1 = new java.awt.Point(-538, 143);\n+\tmap1.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8150000), pos1);\n+\tmap1.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8150000), pos1);\n \n-function OBoatsetup() {\n-    em.getChannelServer().getMapFactory().getMap(200090011).getPortal(\"out00\").setScriptName(\"OBoat1\");\n-    em.getChannelServer().getMapFactory().getMap(200090011).getPortal(\"out01\").setScriptName(\"OBoat2\");\n-}\n+\tvar map2 = Boat_to_Orbis;\n+\tvar pos2 = new java.awt.Point(339, 148);\n+\tmap2.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8150000), pos2);\n+\tmap2.spawnMonsterOnGroundBelow(MapleLifeFactory.getMonster(8150000), pos2);\n \n-function EBoatsetup() {\n-    em.getChannelServer().getMapFactory().getMap(200090001).getPortal(\"out00\").setScriptName(\"EBoat1\");\n-    em.getChannelServer().getMapFactory().getMap(200090001).getPortal(\"out01\").setScriptName(\"EBoat2\");\n+        em.setProperty(\"haveBalrog\",\"true\");\n+        Boat_to_Ellinia.broadcastShip(true);\n+        Boat_to_Orbis.broadcastShip(true);\n+    }\n }\n \n function cancelSchedule() {"}, {"sha": "b5009c0488d9a1cf7b88b826ac246aeae26fd6cc", "filename": "scripts/event/Cabin.js", "status": "modified", "additions": 20, "deletions": 13, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Cabin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Cabin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Cabin.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -26,7 +26,7 @@\n -- By ---------------------------------------------------------------------------------------------\n \tInformation\n -- Version Info -----------------------------------------------------------------------------------\n-\t1.5 - Fix for infinity looping [Information]\n+        1.5 - Fix for infinity looping [Information]\n \t1.4 - Ship/boat is now showed\n \t    - Removed temp message[Information]\n \t    - Credit to Snow/superraz777 for old source\n@@ -61,38 +61,45 @@ function init() {\n     Leafre_docked = em.getChannelServer().getMapFactory().getMap(240000110);\n     Orbis_Station = em.getChannelServer().getMapFactory().getMap(200000100);\n     Leafre_Station = em.getChannelServer().getMapFactory().getMap(240000100);\n+    \n     scheduleNew();\n }\n \n function scheduleNew() {\n-    Leafre_docked.setDocked(true);\n-    Orbis_docked.setDocked(true);\n-    Leafre_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n     em.setProperty(\"docked\", \"true\");\n+    Orbis_docked.setDocked(true);\n+    Leafre_docked.setDocked(true);\n+    \n     em.setProperty(\"entry\", \"true\");\n-    em.schedule(\"stopEntry\", closeTime);\n-    em.schedule(\"takeoff\", beginTime);\n+    em.schedule(\"stopEntry\", closeTime); //The time to close the gate\n+    em.schedule(\"takeoff\", beginTime); //The time to begin the ride\n }\n \n function stopEntry() {\n     em.setProperty(\"entry\",\"false\");\n }\n \n function takeoff() {\n-    Leafre_docked.setDocked(false);\n-    Orbis_docked.setDocked(false);\n-    Leafre_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    em.setProperty(\"docked\",\"false\");\n     Orbis_btf.warpEveryone(Cabin_to_Leafre.getId());\n     Leafre_btf.warpEveryone(Cabin_to_Orbis.getId());\n-    em.schedule(\"arrived\", rideTime);\n+    \n+    Orbis_docked.broadcastShip(false);\n+    Leafre_docked.broadcastShip(false);\n+    \n+    em.setProperty(\"docked\",\"false\");\n+    Orbis_docked.setDocked(false);\n+    Leafre_docked.setDocked(false);\n+    \n+    em.schedule(\"arrived\", rideTime); //The time that require move to destination\n }\n \n function arrived() {\n     Cabin_to_Orbis.warpEveryone(Orbis_Station.getId());\n     Cabin_to_Leafre.warpEveryone(Leafre_Station.getId());\n+    \n+    Orbis_docked.broadcastShip(true);\n+    Leafre_docked.broadcastShip(true);\n+    \n     scheduleNew();\n }\n "}, {"sha": "c1dd41b9e152804de34abe04158c15b3988e9abe", "filename": "scripts/event/Genie.js", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Genie.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Genie.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Genie.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -40,38 +40,43 @@ function init() {\n     Orbis_docked = em.getChannelServer().getMapFactory().getMap(200000151);\n     Ariant_docked = em.getChannelServer().getMapFactory().getMap(260000100);\n     Orbis_Station = em.getChannelServer().getMapFactory().getMap(200000100);\n+    \n     scheduleNew();\n }\n \n function scheduleNew() {\n-    Ariant_docked.setDocked(true);\n-    Orbis_docked.setDocked(true);\n-    Ariant_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));    \n     em.setProperty(\"docked\", \"true\");\n+    Orbis_docked.setDocked(true);\n+    Ariant_docked.setDocked(true);\n+    \n     em.setProperty(\"entry\", \"true\");\n-    em.schedule(\"stopEntry\", closeTime);\n-    em.schedule(\"takeoff\", beginTime);\n+    em.schedule(\"stopEntry\", closeTime); //The time to close the gate\n+    em.schedule(\"takeoff\", beginTime); //The time to begin the ride\n }\n \n function stopEntry() {\n     em.setProperty(\"entry\",\"false\");\n }\n \n function takeoff() {\n-    em.setProperty(\"docked\",\"false\");\n     Orbis_btf.warpEveryone(Genie_to_Ariant.getId());\n     Ariant_btf.warpEveryone(Genie_to_Orbis.getId());\n-    Ariant_docked.setDocked(false);\n+    Orbis_docked.broadcastShip(false);\n+    Ariant_docked.broadcastShip(false);\n+ \n+    em.setProperty(\"docked\",\"false\");\n     Orbis_docked.setDocked(false);\n-    Ariant_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    em.schedule(\"arrived\", rideTime);\n+    Ariant_docked.setDocked(false);\n+    \n+    em.schedule(\"arrived\", rideTime); //The time that require move to destination\n }\n \n function arrived() {\n     Genie_to_Orbis.warpEveryone(Orbis_Station.getId());\n     Genie_to_Ariant.warpEveryone(Ariant_docked.getId());\n+    Orbis_docked.broadcastShip(true);\n+    Ariant_docked.broadcastShip(true);\n+    \n     scheduleNew();\n }\n "}, {"sha": "25618e3db6e1e3e7a780a0b6b8f329c33908ea49", "filename": "scripts/event/Hak.js", "status": "modified", "additions": 11, "deletions": 29, "changes": 40, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Hak.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Hak.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Hak.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -1,50 +1,32 @@\n-importPackage(Packages.tools);\n-\n var returnTo = new Array(200000141, 250000100);\n var rideTo = new Array(250000100, 200000141);\n var birdRide = new Array(200090300, 200090310);\n var myRide;\n var returnMap;\n var map;\n var docked;\n+\n var timeOnRide = 60; //Seconds\n-var onRide;\n \n function init() {\n-}\n-\n-function setup() {\n-\tvar eim = em.newInstance(\"Hak_\" + + em.getProperty(\"player\"));\n-\treturn eim;\n+    em.setProperty(\"isRiding\",\"false\");\n }\n \n function playerEntry(eim, player) {\n-\tif (player.getMapId() == returnTo[0]) {\n-\t\tmyRide = 0;\n-\t} else {\n-\t\tmyRide = 1;\n-\t}\n-\tdocked = eim.getEm().getChannelServer().getMapFactory().getMap(rideTo[myRide]);\n-    returnMap = eim.getMapFactory().getMap(returnTo[myRide]);\n-    onRide = eim.getMapFactory().getMap(birdRide[myRide]);\n-    player.changeMap(onRide, onRide.getPortal(0));\n-    player.getClient().getSession().write(MaplePacketCreator.getClock(timeOnRide));\n-    eim.schedule(\"timeOut\", timeOnRide * 1000);\n-}\n+    myRide = em.getProperty(\"myRide\");\n+    docked = em.getChannelServer().getMapFactory().getMap(rideTo[myRide]);\n+    returnMap = em.getChannelServer().getMapFactory().getMap(returnTo[myRide]);\n+    onRide = em.getChannelServer().getMapFactory().getMap(birdRide[myRide]);\n \n-function timeOut() {\n-\tonRide.warpEveryone(docked.getId());\n+    em.setProperty(\"isRiding\",\"true\");\n+    em.schedule(\"timeOut\", timeOnRide * 1000);\n+    player.changeMap(onRide, onRide.getPortal(0));\n+    player.getClient().getSession().write(tools.MaplePacketCreator.getClock(timeOnRide));\n }\n \n-\n-\n-\n function playerDisconnected(eim, player) {\n     return 0;\n }\n \n-function cancelSchedule() {}\n-\n-function dispose() {\n-    em.cancelSchedule();\n+function cancelSchedule() {\n }\n\\ No newline at end of file"}, {"sha": "385e6ca178651ff7079707dd1b5444c80a8af115", "filename": "scripts/event/Trains.js", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Trains.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/Trains.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Trains.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -23,38 +23,42 @@ function init() {\n     Ludibrium_docked = em.getChannelServer().getMapFactory().getMap(220000110);\n     Orbis_Station = em.getChannelServer().getMapFactory().getMap(200000100);\n     Ludibrium_Station = em.getChannelServer().getMapFactory().getMap(220000100);\n+    \n     scheduleNew();\n }\n \n function scheduleNew() {\n-    Ludibrium_docked.setDocked(true);\n-    Orbis_docked.setDocked(true);\n-    Ludibrium_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(true));\n     em.setProperty(\"docked\", \"true\");\n+    Orbis_docked.setDocked(true);\n+    Ludibrium_docked.setDocked(true);\n+    \n     em.setProperty(\"entry\", \"true\");\n-    em.schedule(\"stopEntry\", closeTime);\n-    em.schedule(\"takeoff\", beginTime);\n+    em.schedule(\"stopEntry\", closeTime); //The time to close the gate\n+    em.schedule(\"takeoff\", beginTime); //The time to begin the ride\n }\n \n function stopEntry() {\n     em.setProperty(\"entry\",\"false\");\n }\n \n function takeoff() {\n-    Ludibrium_docked.setDocked(false);\n-    Orbis_docked.setDocked(false);\n-    Ludibrium_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    Orbis_docked.broadcastMessage(MaplePacketCreator.boatPacket(false));\n-    em.setProperty(\"docked\",\"false\");\n     Orbis_btf.warpEveryone(Train_to_Ludibrium.getId());\n     Ludibrium_btf.warpEveryone(Train_to_Orbis.getId());\n-    em.schedule(\"arrived\", rideTime);\n+    Orbis_docked.broadcastShip(false);\n+    Ludibrium_docked.broadcastShip(false);\n+    \n+    em.setProperty(\"docked\",\"false\");\n+    Orbis_docked.setDocked(false);\n+    Ludibrium_docked.setDocked(false);\n+    \n+    em.schedule(\"arrived\", rideTime); //The time that require move to destination\n }\n \n function arrived() {\n     Train_to_Orbis.warpEveryone(Orbis_Station.getId());\n     Train_to_Ludibrium.warpEveryone(Ludibrium_Station.getId());\n+    Orbis_docked.broadcastShip(true);\n+    Ludibrium_docked.broadcastShip(true);\n     scheduleNew();\n }\n "}, {"sha": "6be6035ccb17a8deb6636033f637d54dccfc8c8b", "filename": "scripts/event/elevator.js", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/elevator.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/scripts/event/elevator.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/elevator.js?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -20,6 +20,9 @@ You should have received a copy of the GNU Affero General Public License\n along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n function init() {\n+    em.getChannelServer().getMapFactory().getMap(222020100).resetReactors();\n+    em.getChannelServer().getMapFactory().getMap(222020200).resetReactors();\n+    \n     scheduleNew();\n }\n "}, {"sha": "8c932edcf767e49a0928f641749f66c0df3a3926", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -99,7 +99,7 @@\n     private byte monsterRate;\n     private boolean clock;\n     private boolean boat;\n-    private boolean docked;\n+    private boolean docked = false;\n     private String mapName;\n     private String streetName;\n     private MapleMapEffect mapEffect = null;\n@@ -1278,7 +1278,7 @@ private void activateItemReactors(final MapleMapItem drop, final MapleClient c)\n     public void startMapEffect(String msg, int itemId) {\n         startMapEffect(msg, itemId, 30000);\n     }\n-\n+    \n     public void startMapEffect(String msg, int itemId, long time) {\n         if (mapEffect != null) {\n             return;\n@@ -1504,10 +1504,9 @@ public void run() {\n             Calendar cal = Calendar.getInstance();\n             chr.getClient().announce((MaplePacketCreator.getClockTime(cal.get(Calendar.HOUR_OF_DAY), cal.get(Calendar.MINUTE), cal.get(Calendar.SECOND))));\n         }\n-        if (hasBoat() == 2) {\n-            chr.getClient().announce((MaplePacketCreator.boatPacket(true)));\n-        } else if (hasBoat() == 1 && (chr.getMapId() != 200090000 || chr.getMapId() != 200090010)) {\n-            chr.getClient().announce(MaplePacketCreator.boatPacket(false));\n+        if (hasBoat() > 0) {\n+            if(hasBoat() == 1) chr.getClient().announce((MaplePacketCreator.boatPacket(true)));\n+            else chr.getClient().announce(MaplePacketCreator.boatPacket(false));\n         }\n         chr.receivePartyMemberHP();\n     }\n@@ -2120,7 +2119,7 @@ public void setHPDecProtect(int delta) {\n     }\n \n     private int hasBoat() {\n-        return docked ? 2 : (boat ? 1 : 0);\n+        return !boat ? 0 : (docked ? 1 : 2);\n     }\n \n     public void setBoat(boolean hasBoat) {\n@@ -2434,4 +2433,8 @@ public void resetMapObjects() {\n         restoreMapSpawnPoints();\n         instanceMapFirstSpawn();\n     }\n+    \n+    public void broadcastShip(final boolean state) {\n+        broadcastMessage(MaplePacketCreator.boatPacket(state));\n+    }\n }"}, {"sha": "7e7fa9bddb7d80674eef3bf8ccf29ad22627f32f", "filename": "src/tools/MaplePacketCreator.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6935d3d3b875693e295b5c678e6550fafdd2052/src/tools/MaplePacketCreator.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6935d3d3b875693e295b5c678e6550fafdd2052/src/tools/MaplePacketCreator.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/tools/MaplePacketCreator.java?ref=f6935d3d3b875693e295b5c678e6550fafdd2052", "patch": "@@ -4440,6 +4440,7 @@ public static void addPetInfo(final MaplePacketLittleEndianWriter mplew, MaplePe\n \t\t\t\t   return mplew.getPacket();\n \t\t\t   }\n \n+                           \n \t\t\t   public static byte[] boatPacket(boolean type) {//don't think this is correct..\n \t\t\t\t   final MaplePacketLittleEndianWriter mplew = new MaplePacketLittleEndianWriter();\n \t\t\t\t   mplew.writeShort(SendOpcode.CONTI_STATE.getValue());"}]}]},
