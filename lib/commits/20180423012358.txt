{"fetchDate": "2019-12-19", "content": [{"sha": "f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6ZjZjMDZlNWYyZWNmZGJmZmVhZDAxNGY5MjBkNjM2ZjlhZDhhNzAwYw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-23T01:23:58Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2018-04-23T01:23:58Z"}, "message": "Couple confirmation\n\nAdded couple vows confirmation before completing marriage and giving rings.", "tree": {"sha": "bec5bfa927bec58e2146e46bdace37ba482357e6", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/bec5bfa927bec58e2146e46bdace37ba482357e6"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "html_url": "https://github.com/ronancpl/HeavenMS/commit/f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ede8ad85513c065a21eb7cc89a1629500defef3c", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/ede8ad85513c065a21eb7cc89a1629500defef3c", "html_url": "https://github.com/ronancpl/HeavenMS/commit/ede8ad85513c065a21eb7cc89a1629500defef3c"}], "stats": {"total": 126, "additions": 75, "deletions": 51}, "files": [{"sha": "1041876effd61bb3cee4235e0d86e0116bedb09e", "filename": "scripts/event/WeddingCathedral.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/event/WeddingCathedral.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/event/WeddingCathedral.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/WeddingCathedral.js?ref=f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "patch": "@@ -65,6 +65,7 @@ function setup(level, lobbyid) {\n         eim.setProperty(\"canJoin\", \"1\");\n         eim.setProperty(\"groomId\", \"0\");\n         eim.setProperty(\"brideId\", \"0\");\n+        eim.setProperty(\"confirmedVows\", \"-1\");\n         \n         eim.getInstanceMap(680000400).resetPQ(level);\n         if(eventBoss) spawnCakeBoss(eim);\n@@ -92,7 +93,7 @@ function playerEntry(eim, player) {\n \n function stopBlessings(eim) {\n         var mapobj = eim.getMapInstance(entryMap + 10);\n-        mapobj.dropMessage(6, \"Wedding Assistant: Alright, now the couple is preparing to make it official. Tighten your seatbelts!\");\n+        mapobj.dropMessage(6, \"Wedding Assistant: Alright people, our couple are preparing their vows to each other right now.\");\n         \n         eim.setIntProperty(\"weddingStage\", 2);\n }"}, {"sha": "a859a9d336ae7bd28ac1fea9a16f7cd410c26b54", "filename": "scripts/event/WeddingChapel.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/event/WeddingChapel.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/event/WeddingChapel.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/WeddingChapel.js?ref=f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "patch": "@@ -65,6 +65,7 @@ function setup(level, lobbyid) {\n         eim.setProperty(\"canJoin\", \"1\");\n         eim.setProperty(\"groomId\", \"0\");\n         eim.setProperty(\"brideId\", \"0\");\n+        eim.setProperty(\"confirmedVows\", \"-1\");\n         \n         eim.getInstanceMap(680000400).resetPQ(level);\n         if(eventBoss) spawnCakeBoss(eim);\n@@ -92,7 +93,7 @@ function playerEntry(eim, player) {\n \n function stopBlessings(eim) {\n         var mapobj = eim.getMapInstance(entryMap + 10);\n-        mapobj.dropMessage(6, \"Wedding Assistant: Alright, now the couple is preparing to make it official. Tighten your seatbelts!\");\n+        mapobj.dropMessage(6, \"Wedding Assistant: Alright people, our couple are preparing their vows to each other right now.\");\n         \n         eim.setIntProperty(\"weddingStage\", 2);\n }"}, {"sha": "d2ce9b99e76a07929a827b34dfcaf163432fa5b3", "filename": "scripts/npc/9201002.js", "status": "modified", "additions": 33, "deletions": 22, "changes": 55, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/npc/9201002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/npc/9201002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201002.js?ref=f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "patch": "@@ -311,29 +311,40 @@ function action(mode, type, selection) {\n \n                             switch(state) {\n                                 case 0:\n-                                    eim.setIntProperty(\"weddingStage\", 3);\n-                                    var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n-\n-                                    var playerItemId = detectPlayerItemid(player);\n-                                    var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;\n-\n-                                    var marriageRingId = getRingId((playerItemId % 2 == 1) ? playerItemId : partnerItemId);\n-\n-                                    cm.gainItem(playerItemId, -1);\n-                                    cmPartner.gainItem(partnerItemId, -1);\n-\n-                                    RingActionHandler.giveMarriageRings(player, partner, marriageRingId);\n-                                    player.setMarriageItemId(marriageRingId);\n-                                    partner.setMarriageItemId(marriageRingId);\n-                                    \n-                                    //var marriageId = eim.getIntProperty(\"weddingId\");\n-                                    //player.announce(Wedding.OnMarriageResult(marriageId, player, true));\n-                                    //partner.announce(Wedding.OnMarriageResult(marriageId, player, true));\n-\n-                                    giveCoupleBlessings(eim, player, partner);\n+                                    var pid = eim.getIntProperty(\"confirmedVows\");\n+                                    if(pid != -1) {\n+                                        if(pid == player.getId()) {\n+                                            cm.sendOk(\"You have already confirmed your vows. All that is left is for your partner to confirm now.\");\n+                                        } else {\n+                                            eim.setIntProperty(\"weddingStage\", 3);\n+                                            var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n+\n+                                            var playerItemId = detectPlayerItemid(player);\n+                                            var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;\n+\n+                                            var marriageRingId = getRingId((playerItemId % 2 == 1) ? playerItemId : partnerItemId);\n+\n+                                            cm.gainItem(playerItemId, -1);\n+                                            cmPartner.gainItem(partnerItemId, -1);\n+\n+                                            RingActionHandler.giveMarriageRings(player, partner, marriageRingId);\n+                                            player.setMarriageItemId(marriageRingId);\n+                                            partner.setMarriageItemId(marriageRingId);\n+\n+                                            //var marriageId = eim.getIntProperty(\"weddingId\");\n+                                            //player.announce(Wedding.OnMarriageResult(marriageId, player, true));\n+                                            //partner.announce(Wedding.OnMarriageResult(marriageId, player, true));\n+\n+                                            giveCoupleBlessings(eim, player, partner);\n+\n+                                            cm.getMap().dropMessage(6, \"High Priest John: By the power vested in me through the mighty Maple tree, I now pronounce you  Husband and Wife. You may kiss the bride!\");\n+                                            eim.schedule(\"showMarriedMsg\", 2 * 1000);\n+                                        }\n+                                    } else {\n+                                        eim.setIntProperty(\"confirmedVows\", player.getId());\n+                                        mapobj.dropMessage(6, \"Wedding Assistant: \" + player.getName() + \" has confirmed vows! Alright, one step away to make it official. Tighten your seatbelts!\");\n+                                    }\n                                     \n-                                    cm.getMap().dropMessage(6, \"High Priest John: By the power vested in me through the mighty Maple tree, I now pronounce you  Husband and Wife. You may kiss the bride!\");\n-                                    eim.schedule(\"showMarriedMsg\", 2 * 1000);\n                                     break;\n \n                                 case -1:"}, {"sha": "a2e56e2ef957080a09cb9580a6256848c85b80a3", "filename": "scripts/npc/9201011.js", "status": "modified", "additions": 34, "deletions": 23, "changes": 57, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/npc/9201011.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/scripts/npc/9201011.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/9201011.js?ref=f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "patch": "@@ -192,29 +192,40 @@ function action(mode, type, selection) {\n \n                         switch(state) {\n                             case 0:\n-                                eim.setIntProperty(\"weddingStage\", 3);\n-                                var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n-\n-                                var playerItemId = detectPlayerItemid(player);\n-                                var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;\n-\n-                                var marriageRingId = getRingId((playerItemId % 2 == 1) ? playerItemId : partnerItemId);\n-\n-                                cm.gainItem(playerItemId, -1);\n-                                cmPartner.gainItem(partnerItemId, -1);\n-\n-                                RingActionHandler.giveMarriageRings(player, partner, marriageRingId);\n-                                player.setMarriageItemId(marriageRingId);\n-                                partner.setMarriageItemId(marriageRingId);\n-\n-                                //var marriageId = eim.getIntProperty(\"weddingId\");\n-                                //player.announce(Wedding.OnMarriageResult(marriageId, player, true));\n-                                //partner.announce(Wedding.OnMarriageResult(marriageId, player, true));\n-\n-                                giveCoupleBlessings(eim, player, partner);\n-\n-                                cm.getMap().dropMessage(6, \"Wayne: I'll call it out right now, and it shall go on: you guys are the key of the other's lock, a lace of a pendant. That's it, snog yourselves!\");\n-                                eim.schedule(\"showMarriedMsg\", 2 * 1000);\n+                                var pid = eim.getIntProperty(\"confirmedVows\");\n+                                if(pid != -1) {\n+                                    if(pid == player.getId()) {\n+                                        cm.sendOk(\"You have already confirmed your vows. All that is left is for your partner to confirm now.\");\n+                                    } else {\n+                                        eim.setIntProperty(\"weddingStage\", 3);\n+                                        var cmPartner = partner.getClient().getAbstractPlayerInteraction();\n+\n+                                        var playerItemId = detectPlayerItemid(player);\n+                                        var partnerItemId = (playerItemId % 2 == 1) ? playerItemId + 1 : playerItemId - 1;\n+\n+                                        var marriageRingId = getRingId((playerItemId % 2 == 1) ? playerItemId : partnerItemId);\n+\n+                                        cm.gainItem(playerItemId, -1);\n+                                        cmPartner.gainItem(partnerItemId, -1);\n+\n+                                        RingActionHandler.giveMarriageRings(player, partner, marriageRingId);\n+                                        player.setMarriageItemId(marriageRingId);\n+                                        partner.setMarriageItemId(marriageRingId);\n+\n+                                        //var marriageId = eim.getIntProperty(\"weddingId\");\n+                                        //player.announce(Wedding.OnMarriageResult(marriageId, player, true));\n+                                        //partner.announce(Wedding.OnMarriageResult(marriageId, player, true));\n+\n+                                        giveCoupleBlessings(eim, player, partner);\n+\n+                                        cm.getMap().dropMessage(6, \"Wayne: I'll call it out right now, and it shall go on: you guys are the key of the other's lock, a lace of a pendant. That's it, snog yourselves!\");\n+                                        eim.schedule(\"showMarriedMsg\", 2 * 1000);\n+                                    }\n+                                } else {\n+                                    eim.setIntProperty(\"confirmedVows\", player.getId());\n+                                    mapobj.dropMessage(6, \"Wedding Assistant: \" + player.getName() + \" has confirmed vows! Alright, one step away to make it official. Tighten your seatbelts!\");\n+                                }\n+                                \n                                 break;\n \n                             case -1:"}, {"sha": "620cfdd946ec2d48b819dbdd3edc3efc1011595a", "filename": "src/net/server/channel/handlers/DueyHandler.java", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/src/net/server/channel/handlers/DueyHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/f6c06e5f2ecfdbffead014f920d636f9ad8a700c/src/net/server/channel/handlers/DueyHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/DueyHandler.java?ref=f6c06e5f2ecfdbffead014f920d636f9ad8a700c", "patch": "@@ -252,11 +252,11 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         }\n     }\n \n-    private void addMesoToDB(int mesos, String sName, int recipientID) {\n+    private static void addMesoToDB(int mesos, String sName, int recipientID) {\n         addItemToDB(null, 1, mesos, sName, recipientID);\n     }\n \n-    private void addItemToDB(Item item, int quantity, int mesos, String sName, int recipientID) {\n+    public static void addItemToDB(Item item, int quantity, int mesos, String sName, int recipientID) {\n         Connection con = null;\n         try {\n             con = DatabaseConnection.getConnection();\n@@ -344,7 +344,7 @@ private void addItemToDB(Item item, int quantity, int mesos, String sName, int r\n         }\n     }\n \n-    private String getCurrentDate() {\n+    private static String getCurrentDate() {\n         String date = \"\";\n         Calendar cal = Calendar.getInstance();\n         int day = cal.get(Calendar.DATE) - 1; // instant duey ?\n@@ -373,7 +373,7 @@ private static int getFee(int meso) {\n         return fee;\n     }\n \n-    private void removeItemFromDB(int packageid) {\n+    private static void removeItemFromDB(int packageid) {\n         Connection con = null;\n         try {\n             con = DatabaseConnection.getConnection();"}]}]},
