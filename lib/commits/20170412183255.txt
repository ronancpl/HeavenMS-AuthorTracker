{"fetchDate": "2019-12-19", "content": [{"sha": "6791a3d47567a59d7d02803ae82d8ade3a948987", "node_id": "MDY6Q29tbWl0NDUwODIwMjM6Njc5MWEzZDQ3NTY3YTU5ZDdkMDI4MDNhZTgyZDhhZGUzYTk0ODk4Nw==", "commit": {"author": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-12T18:32:55Z"}, "committer": {"name": "ronancpl", "email": "rcpl2010@gmail.com", "date": "2017-04-12T18:32:55Z"}, "message": "Client clean-up + PiratePQ Implementation\n\nMajor update on client packets, now properly making unseen killed\nmonsters not appear as residual on a player's client. Many updates\nrevolving the PiratePQ environment as well.", "tree": {"sha": "68e09a9889e95fc92838c832a2d58dc48dc031cd", "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/trees/68e09a9889e95fc92838c832a2d58dc48dc031cd"}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/git/commits/6791a3d47567a59d7d02803ae82d8ade3a948987", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/6791a3d47567a59d7d02803ae82d8ade3a948987", "html_url": "https://github.com/ronancpl/HeavenMS/commit/6791a3d47567a59d7d02803ae82d8ade3a948987", "comments_url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/6791a3d47567a59d7d02803ae82d8ade3a948987/comments", "author": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ronancpl", "id": 9257761, "node_id": "MDQ6VXNlcjkyNTc3NjE=", "avatar_url": "https://avatars2.githubusercontent.com/u/9257761?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ronancpl", "html_url": "https://github.com/ronancpl", "followers_url": "https://api.github.com/users/ronancpl/followers", "following_url": "https://api.github.com/users/ronancpl/following{/other_user}", "gists_url": "https://api.github.com/users/ronancpl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ronancpl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ronancpl/subscriptions", "organizations_url": "https://api.github.com/users/ronancpl/orgs", "repos_url": "https://api.github.com/users/ronancpl/repos", "events_url": "https://api.github.com/users/ronancpl/events{/privacy}", "received_events_url": "https://api.github.com/users/ronancpl/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "768d9d02646b6b7ac12940524aedcd59257d192f", "url": "https://api.github.com/repos/ronancpl/HeavenMS/commits/768d9d02646b6b7ac12940524aedcd59257d192f", "html_url": "https://github.com/ronancpl/HeavenMS/commit/768d9d02646b6b7ac12940524aedcd59257d192f"}], "stats": {"total": 1178, "additions": 987, "deletions": 191}, "files": [{"sha": "cab8a43069d98918adeb4e93c8f9849acf1dd4c3", "filename": "mychanges_ptbr.txt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/mychanges_ptbr.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/mychanges_ptbr.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/mychanges_ptbr.txt?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -148,4 +148,7 @@ Diversas pequenas altera\n 10 Abril 2017,\n Navio de Crimson Balrogs agora s\ufffdo renderizados na tela, mesmo depois de mudar de mapas.\n Adi\ufffd\ufffdo de client alternativo: MapleStory sem Damage Cap.\n-Adi\ufffd\ufffdo de expedi\ufffd\ufffdes PiratePQ e EllinPQ.\n\\ No newline at end of file\n+Adi\ufffd\ufffdo de expedi\ufffd\ufffdes PiratePQ e EllinPQ.\n+\n+11 - 12 Abril 2017,\n+Implementa\ufffd\ufffdo do PiratePQ.\n\\ No newline at end of file"}, {"sha": "9b44440cfdc7a5677b10c4147aab1e02d898d34e", "filename": "nbproject/private/private.xml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/nbproject/private/private.xml", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/nbproject/private/private.xml", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/nbproject/private/private.xml?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -3,7 +3,7 @@\n     <editor-bookmarks xmlns=\"http://www.netbeans.org/ns/editor-bookmarks/2\" lastBookmarkId=\"0\"/>\n     <open-files xmlns=\"http://www.netbeans.org/ns/projectui-open-files/2\">\n         <group>\n-            <file>file:/C:/Nexon/MapleSolaxia/src/server/life/MobSkill.java</file>\n+            <file>file:/C:/Nexon/MapleSolaxia/src/server/maps/MapleMap.java</file>\n         </group>\n     </open-files>\n </project-private>"}, {"sha": "576581133a1c6cba010961e1a43eb0bde9a0b1b4", "filename": "scripts/event/Ellin.js", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/event/Ellin.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/event/Ellin.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/Ellin.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,4 +1,5 @@\n var minPlayers = 2;\n+var entryMap = 930000000;\n \n function init() {\n         em.setProperty(\"state\", \"0\");\n@@ -26,7 +27,7 @@ function setup(level, leaderid) {\n }\n \n function playerEntry(eim, player) {\n-        var map = eim.getMapInstance(0);\n+        var map = eim.getMapInstance(entryMap);\n         player.changeMap(map, map.getPortal(0));\n }\n "}, {"sha": "5b3d9f535deb313cfa9cc2d77922ae658673babf", "filename": "scripts/event/PiratePQ.js", "status": "modified", "additions": 84, "deletions": 31, "changes": 115, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/event/PiratePQ.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/event/PiratePQ.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/event/PiratePQ.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,20 +1,26 @@\n var isPq = true;\n var minPlayers = 1;\n+var entryMap = 925100000;\n+var exitMap = 925100700;\n \n function init() {\n-em.setProperty(\"state\", \"0\");\n+        em.setProperty(\"state\", \"0\");\n \tem.setProperty(\"leader\", \"true\");\n }\n \n function setup(level, leaderid) {\n-em.setProperty(\"state\", \"1\");\n+        em.setProperty(\"state\", \"1\");\n \tem.setProperty(\"leader\", \"true\");\n-    var eim = em.newInstance(\"Pirate\" + leaderid);\n+        var eim = em.newInstance(\"Pirate\" + leaderid);\n \tem.setProperty(\"stage2\", \"0\");\n-\tem.setProperty(\"stage2a\", \"0\");\n+        em.setProperty(\"stage2a\", \"0\");\n \tem.setProperty(\"stage3a\", \"0\");\n+        em.setProperty(\"stage2b\", \"0\");\n+\tem.setProperty(\"stage3b\", \"0\");\n \tem.setProperty(\"stage4\", \"0\");\n \tem.setProperty(\"stage5\", \"0\");\n+        em.setProperty(\"level\", level);\n+        em.setProperty(\"openedChests\", \"0\");\n         eim.setInstanceMap(925100000).resetPQ(level);\n \teim.setInstanceMap(925100100).resetPQ(level);\n \tvar map = eim.setInstanceMap(925100200);\n@@ -85,24 +91,27 @@ em.setProperty(\"state\", \"1\");\n \teim.setInstanceMap(925100302).resetPQ(level);\n \teim.setInstanceMap(925100400).resetPQ(level);\n \teim.setInstanceMap(925100500).resetPQ(level);\n-\n-    eim.startEventTimer(1200000); //20 mins\n-    return eim;\n+        \n+        respawnStg4(eim);\n+        eim.startEventTimer(1200000); //20 mins\n+        return eim;\n }\n \n function playerEntry(eim, player) {\n-    var map = eim.getMapInstance(0);\n+    var map = eim.getMapInstance(entryMap);\n     player.changeMap(map, map.getPortal(0));\n-    player.tryPartyQuest(1204);\n-}\n-\n-function playerRevive(eim, player) {\n }\n \n function scheduledTimeout(eim) {\n     end(eim);\n }\n \n+function removePlayer(eim, player) {\n+    eim.unregisterPlayer(player);\n+    player.getMap().removePlayer(player);\n+    player.setMap(exitMap);\n+}\n+\n function changedMap(eim, player, mapid) {\n     if (mapid < 925100000 || mapid > 925100500) {\n \teim.unregisterPlayer(player);\n@@ -114,42 +123,86 @@ function changedMap(eim, player, mapid) {\n     }\n }\n \n+function playerDead(eim, player) {}\n+\n+function playerRevive(eim, player) { // player presses ok on the death pop up.\n+    if (eim.isLeader(player) || party.size() <= minPlayers) { // Check for party leader\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++)\n+            playerExit(eim, party.get(i));\n+        eim.dispose();\n+    } else\n+        playerExit(eim, player);\n+}\n+\n+\n function playerDisconnected(eim, player) {\n-    return 0;\n+    var party = eim.getPlayers();\n+    if (eim.isLeader(player) || party.size() < minPlayers) {\n+        var party = eim.getPlayers();\n+        for (var i = 0; i < party.size(); i++)\n+            if (party.get(i).equals(player))\n+                removePlayer(eim, player);\n+            else\n+                playerExit(eim, party.get(i));\n+        eim.dispose();\n+    } else\n+        removePlayer(eim, player);\n }\n \n-function monsterValue(eim, mobId) {\n-    return 1;\n+function leftParty(eim, player) {\n+    var party = eim.getPlayers();\n+    if (party.size() < minPlayers) {\n+        for (var i = 0; i < party.size(); i++)\n+            playerExit(eim,party.get(i));\n+        eim.dispose();\n+    } else\n+        playerExit(eim, player);\n+}\n+\n+function disbandParty(eim) {\n+    var party = eim.getPlayers();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n+    }\n+    eim.dispose();\n }\n \n function playerExit(eim, player) {\n     eim.unregisterPlayer(player);\n+    player.changeMap(exitMap, exitMap.getPortal(0));\n+}\n \n-    if (eim.disposeIfPlayerBelow(0, 0)) {\n-\tem.setProperty(\"state\", \"0\");\n-\t\tem.setProperty(\"leader\", \"true\");\n-\t}\n+function monsterValue(eim, mobId) {\n+    return 1;\n }\n \n function end(eim) {\n-    eim.disposeIfPlayerBelow(100, 925100700);\n-\tem.setProperty(\"state\", \"0\");\n-\t\tem.setProperty(\"leader\", \"true\");\n+    var party = eim.getPlayers();\n+    for (var i = 0; i < party.size(); i++) {\n+        playerExit(eim, party.get(i));\n+    }\n+    eim.dispose();\n }\n \n function clearPQ(eim) {\n     end(eim);\n }\n \n-function allMonstersDead(eim) {\n-}\n+function allMonstersDead(eim) {}\n \n-function leftParty (eim, player) {\n-    // If only 2 players are left, uncompletable:\n-\tend(eim);\n+function cancelSchedule() {}\n+\n+function respawnStg4(eim) {\n+        //if(em.getProperty(\"stage4\") == \"0\") {\n+                eim.getMapInstance(925100400).instanceMapRespawn();\n+                em.schedule(\"respawnStg4\", eim, 10 * 1000);\n+        //}\n }\n-function disbandParty (eim) {\n-\tend(eim);\n+\n+function dispose(eim) {\n+    em.cancelSchedule();\n+    \n+    em.setProperty(\"state\", \"0\");\n+    em.setProperty(\"leader\", \"true\");\n }\n-function playerDead(eim, player) {}\n-function cancelSchedule() {}\n\\ No newline at end of file"}, {"sha": "e5c61c46438489fa2c4c1a9af932ed8f33fd281f", "filename": "scripts/npc/world0/2041029.js", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2041029.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2041029.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2041029.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,27 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+\n+function start() {\n+    cm.sendOk(\"Up ahead is the mysterious forest of Elin. Go through #bthe portal of time#k if you are ready to unveil some of the mysteries of the past of Victoria Island, as how it used to be at it's dawn.\");\n+    cm.dispose();\n+}\n+\t\n\\ No newline at end of file"}, {"sha": "ecaf90c500ba0d8442160642312d7a5d06d00abc", "filename": "scripts/npc/world0/2094000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094000.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -78,7 +78,7 @@ function action(mode, type, selection) {\n                         cm.dispose();\n                     }\n                     else {\n-                        em.startInstance(cm.getParty(),cm.getPlayer().getMap());\n+                        em.startInstance(cm.getParty(),cm.getPlayer().getMap(), 1);\n                         party = cm.getParty().getMembers();\n                     }\n                     cm.dispose();"}, {"sha": "d7f3ecc058dc4ab50ba35c5b4a9f90247dfcdb65", "filename": "scripts/npc/world0/2094001.js", "status": "modified", "additions": 73, "deletions": 3, "changes": 76, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -19,7 +19,77 @@\n     You should have received a copy of the GNU Affero General Public License\n     along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n+\n+var status = -1;\n+\n function start() {\n-    cm.warp(100000000, 0);\n-    cm.dispose();\n-}\n\\ No newline at end of file\n+    status = -1;\n+    action(1, 0, 0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1)\n+\tstatus++;\n+    else\n+\tstatus--;\n+    if (status == 0) {\n+\tcm.removeAll(4001117);\n+\tcm.removeAll(4001120);\n+\tcm.removeAll(4001121);\n+\tcm.removeAll(4001122);\n+\tcm.sendSimple(\"#b#L0#Get me out of here.#l\\r\\n#L1#Give me Pirate Hat.#l#k\");\n+    } else if (status == 1) {\n+\tif (selection == 0) {\n+\t\tif (!cm.canHold(4001129, 1)) {\n+\t\t\tcm.sendOk(\"Please make room in ETC.\");\n+\t\t\tcm.dispose();\n+\t\t\treturn;\n+\t\t}\n+\t\tcm.gainItem(4001129, 1);\n+                cm.warp(251010404,0);\n+\t} else { //TODO JUMP\n+\t\tif (cm.haveItem(1003267, 1)) {\n+\t\t\tcm.sendOk(\"You have the best hat.\");\n+\t\t} else if (cm.haveItem(1002573, 1)) {\n+\t\t    if (cm.haveItem(4001129, 20)) {\t\n+\t\t\t\tif (cm.canHold(1003267,1)) {\n+\t\t\t\t\tcm.gainItem(1002573, -1);\n+\t\t\t\t\tcm.gainItem(4001129, -20);\n+                                        cm.gainItem(1003267,1);\n+\t\t\t\t\tcm.sendOk(\"I have given you the hat.\");\n+                                } else {\n+\t\t\t\t\tcm.sendOk(\"Please make room.\");\n+                                } \n+\t\t    } else {\n+\t\t\t\tcm.sendOk(\"You need 20 #t4001129# to get the next hat.\");\n+\t\t    }\n+\t\t} else if (cm.haveItem(1002572, 1)) {\n+\t\t    if (cm.haveItem(4001129, 20)) {\t\n+\t\t\t\tif (cm.canHold(1002573,1)) {\n+\t\t\t\t\tcm.gainItem(1002572, -1);\n+\t\t\t\t\tcm.gainItem(4001129, -20);\n+\t\t    \t    cm.gainItem(1002573,1);\n+\t\t\t\t\tcm.sendOk(\"I have given you the hat.\");\n+\t\t    \t} else {\n+\t\t\t\t\tcm.sendOk(\"Please make room.\");\n+\t\t        } \n+\t\t    } else {\n+\t\t\t\tcm.sendOk(\"You need 20 #t4001129# to get the next hat.\");\n+\t\t    }\n+\t\t} else {\n+\t\t    if (cm.haveItem(4001129, 20)) {\t\n+\t\t\t\tif (cm.canHold(1002572,1)) {\n+\t\t\t\t\tcm.gainItem(4001129, -20);\n+\t\t    \t    cm.gainItem(1002572,1);\n+\t\t\t\t\tcm.sendOk(\"I have given you the hat.\");\n+\t\t    \t} else {\n+\t\t\t\t\tcm.sendOk(\"Please make room.\");\n+\t\t        } \n+\t\t    } else {\n+\t\t\t\tcm.sendOk(\"You need 20 #t4001129# to get the next hat.\");\n+\t\t    }\n+\t\t}\n+\t}\n+\tcm.dispose();\n+    }\n+}"}, {"sha": "f1c8339efc293437b338c393332135103e17f854", "filename": "scripts/npc/world0/2094002.js", "status": "added", "additions": 129, "deletions": 0, "changes": 129, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2094002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2094002.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,129 @@\n+var status = -1;\n+var level = 1;\n+\n+function start() {\n+    action(1,0,0);\n+}\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tstatus--;\n+    }\n+    if (cm.getPlayer().getMapId() == 925100700) {\n+\tcm.removeAll(4001117);\n+\tcm.removeAll(4001120);\n+\tcm.removeAll(4001121);\n+\tcm.removeAll(4001122);\n+\tcm.warp(251010404,0);\n+\tcm.dispose();\n+\treturn;\n+    }\n+    var em = cm.getEventManager(\"PiratePQ\");\n+    if (em == null) {\n+\tcm.sendNext(\"The event isn't started...\");\n+\tcm.dispose();\n+\treturn;\n+    }\n+    \n+    level = em.getProperty(\"level\");\n+    if (!cm.isLeader()) {\n+\tcm.sendNext(\"I wish for your leader to talk to me.\");\n+\tcm.dispose();\n+\treturn;\n+    }\n+    switch(cm.getPlayer().getMapId()) {\n+\tcase 925100000:\n+\t   cm.sendNext(\"We are heading into the Pirate Ship now! To get in, we must destroy all the monsters guarding it.\");\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100100:\n+\t   var emp = em.getProperty(\"stage2\");\n+\t   if (emp == null) {\n+\t\tem.setProperty(\"stage2\", \"0\");\n+\t\temp = \"0\";\n+\t   }\n+\t   if (emp.equals(\"0\")) {\n+\t\tif (cm.haveItem(4001120,20)) {\n+\t\t    cm.sendNext(\"Excellent! Now hunt me 20 Rising Medals.\");\n+\t\t    cm.gainItem(4001120,-20);\n+                    cm.getMap().killAllMonsters();\n+\t\t    em.setProperty(\"stage2\", \"1\");\n+\t\t} else {\n+\t   \t    cm.sendNext(\"We are heading into the Pirate Ship now! To get in, we must qualify ourselves as noble pirates. Hunt me 20 Rookie Medals.\");\n+                    if(cm.countMonster() < 1) cm.getPlayer().getMap().spawnAllMonsterIdFromMapSpawnList(9300114, level, true);\n+\t\t}\n+\t   } else if (emp.equals(\"1\")) {\n+\t\tif (cm.haveItem(4001121,20)) {\n+\t\t    cm.sendNext(\"Excellent! Now hunt me 20 Veteran Medals.\");\n+\t\t    cm.gainItem(4001121,-20);\n+                    cm.getMap().killAllMonsters();\n+\t\t    em.setProperty(\"stage2\", \"2\");\n+\t\t} else {\n+\t   \t    cm.sendNext(\"We are heading into the Pirate Ship now! To get in, we must qualify ourselves as noble pirates. Hunt me 20 Rising Medals.\");\n+                    if(cm.countMonster() < 1) cm.getPlayer().getMap().spawnAllMonsterIdFromMapSpawnList(9300115, level, true);\n+\t\t}\n+\t   } else if (emp.equals(\"2\")) {\n+\t\tif (cm.haveItem(4001122,20)) {\n+\t\t    cm.sendNext(\"Excellent! Now let us go.\");\n+\t\t    cm.gainItem(4001122,-20);\n+                    cm.getMap().killAllMonsters();\n+\t\t    em.setProperty(\"stage2\", \"3\");\n+\t\t} else {\n+\t   \t    cm.sendNext(\"We are heading into the Pirate Ship now! To get in, we must qualify ourselves as noble pirates. Hunt me 20 Veteran Medals.\");\n+                    if(cm.countMonster() < 1) cm.getPlayer().getMap().spawnAllMonsterIdFromMapSpawnList(9300116, level, true);\n+\t\t}\n+\t   } else {\n+\t\tcm.sendNext(\"The next stage has opened. GO!\");\n+\t   }\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100200:\n+        case 925100300:\n+\t   cm.sendNext(\"To assault the pirate ship, we must destroy the guards first.\");\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100201:\n+\t   if (cm.getMap().getMonsters().size() == 0) {\n+\t\tcm.sendNext(\"Excellent.\");\n+\t\tif (em.getProperty(\"stage2a\") == \"0\") {\n+\t\t    cm.getMap().setReactorState();\n+\t\t    em.setProperty(\"stage2a\", \"1\");\n+\t\t}\n+\t   } else {\n+\t   \tcm.sendNext(\"These bellflowers are in hiding. We must liberate them.\");\n+\t   }\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100301:\n+\t   if (cm.getMap().getMonsters().size() == 0) {\n+\t\tcm.sendNext(\"Excellent.\");\n+\t\tif (em.getProperty(\"stage3a\").equals(\"0\")) {\n+\t\t    cm.getMap().setReactorState();\n+\t\t    em.setProperty(\"stage3a\", \"1\");\n+\t\t}\n+\t   } else {\n+\t   \tcm.sendNext(\"These bellflowers are in hiding. We must liberate them.\");\n+\t   }\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100202:\n+\tcase 925100302:\n+\t   cm.sendNext(\"These are the Captains and Krus which devote their whole life to Lord Pirate. Kill them as you see fit.\");\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100400:\n+\t   cm.sendNext(\"These are the sources of the ship's power. We must seal it by using the Old Metal Keys on the doors!\");\n+\t   cm.dispose();\n+\t   break;\n+\tcase 925100500:\n+\t   if (cm.getMap().getMonsters().size() == 0) {\n+\t\tcm.warpParty(925100600);\n+\t   } else {\n+\t   \tcm.sendNext(\"Defeat all monsters! Even Lord Pirate's minions!\");\n+\t   }\n+\t   cm.dispose();\n+\t   break;\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "d122023769f61aa1afb82551c399ac4b00f4bd54", "filename": "scripts/npc/world0/2131001.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,7 +1,10 @@\n var status = -1;\n-\n var exchangeItem = 4000439;\n \n+function start() {\n+    action(1, 0, 0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "bcd563b2ca63a9b8e2d05e3cf1abe8ad46e27c6f", "filename": "scripts/npc/world0/2131003.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131003.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,7 +1,10 @@\n var status = -1;\n-\n var exchangeItem = 4000437;\n \n+function start() {\n+    action(1, 0, 0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "892ee889ae06fbfb5bd9c1988b292479f075a3b0", "filename": "scripts/npc/world0/2131004.js", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131004.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,8 @@\n+function start() {\n+    action(1,0,0);\n+}\n+\n+function action(mode, type, selection) {\n+    cm.sendNext(\"Zzzzz...\");\n+    cm.dispose();\n+}\n\\ No newline at end of file"}, {"sha": "50a6c55fd32e3a41b91df9d57e5953f979c0370c", "filename": "scripts/npc/world0/2131005.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131005.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131005.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131005.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,7 +1,10 @@\n var status = -1;\n-\n var exchangeItem = 4000436;\n \n+function start() {\n+    action(1, 0, 0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "d22bb1104fa663157da16e6657f6fdcf4efb2747", "filename": "scripts/npc/world0/2131006.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131006.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131006.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131006.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,7 +1,10 @@\n var status = -1;\n-\n var exchangeItem = 4000440;\n \n+function start() {\n+    action(1, 0, 0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "ea011fb7ed983a7e3acc2ad7b172dc44e0caaf7f", "filename": "scripts/npc/world0/2131007.js", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131007.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2131007.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2131007.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,7 +1,10 @@\n var status = -1;\n-\n var exchangeItem = 4000438;\n \n+function start() {\n+    action(1, 0, 0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "e55f830ff55970bcabe8a53bbee6c55c716cca41", "filename": "scripts/npc/world0/2132000.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2132000.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -7,4 +7,4 @@\n function start(){\n \tcm.sendOk(\"Hmmm! For you to make your way here, far away from the Camp, you must be one strong individual. Let's explore new areas and find a place to establish our own town!!\");\n \tcm.dispose();\n-\t}\n\\ No newline at end of file\n+}\n\\ No newline at end of file"}, {"sha": "1fd12b013a86f25b1688c4d955c7491a8f41f791", "filename": "scripts/npc/world0/2132001.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2132001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,3 +1,7 @@\n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     cm.sendNext(\"Call me Dark Lord. I will give thieves a place in society... watch in a few years!\");\n     cm.dispose();"}, {"sha": "3983d69bc1c301accb31f0d2c3a84ee3a262de40", "filename": "scripts/npc/world0/2132002.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2132002.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,3 +1,7 @@\n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     cm.sendNext(\"The magic of this forest is amazing...\");\n     cm.dispose();"}, {"sha": "7390fd0590669d9ace4eda0587dfa5b1c74e0912", "filename": "scripts/npc/world0/2132003.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2132003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2132003.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,3 +1,7 @@\n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     cm.sendNext(\"Being young doesn't mean I'm any different from those guys. I'll show them!\");\n     cm.dispose();"}, {"sha": "64608e1a7872e343a3a3183d4e502b35d72865b6", "filename": "scripts/npc/world0/2133000.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,5 +1,9 @@\n var status = -1;\n \n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "c76e2bd7a33320c9608581dcf084811e6b811ea0", "filename": "scripts/npc/world0/2133000.txt", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133000.txt", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133000.txt", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133000.txt?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,73 @@\n+var status = -1;\n+\n+function action(mode, type, selection) {\n+    if (mode == 1) {\n+\tstatus++;\n+    } else {\n+\tif (status == 0) {\n+\t    cm.dispose();\n+\t}\n+\tstatus--;\n+    }\n+    if (status == 0) {\n+\t    cm.removeAll(4001163);\n+\t    cm.removeAll(4001169);\n+\t    cm.removeAll(2270004);\n+\tcm.sendSimple(\"#b#L0#Give me Altaire Earrings.#l\\r\\n#L1#Give me Glittering Altaire Earrings.#l\\r\\n#L3#Give me Brilliant Altaire Earrings.#l\\r\\n#L2#Attempt Forest of Poison Haze.#l#k\");\n+    } else if (status == 1) {\n+\tif (selection == 0) {\n+\t    if (!cm.haveItem(1032060) && cm.haveItem(4001198, 10)) {\n+\t\tcm.gainItem(1032060,1);\n+\t\tcm.gainItem(4001198, -10);\n+\t    } else {\n+\t\tcm.sendOk(\"You either have Altair Earrings already or you do not have 10 Altair Fragments\");\n+\t    }\n+\t} else if (selection == 1){\n+\t    if (cm.haveItem(1032060) && !cm.haveItem(1032061) && cm.haveItem(4001198, 10)) {\n+\t\tcm.gainItem(1032060,-1);\n+\t\tcm.gainItem(1032061, 1);\n+\t\tcm.gainItem(4001198, -10);\n+\t    } else {\n+\t\tcm.sendOk(\"You either don't have Altair Earrings already or you do not have 10 Altair Fragments\");\n+\t    }\n+\t} else if (selection == 1){\n+\t    if (cm.haveItem(1032061) && !cm.haveItem(1032101) && cm.haveItem(4001198, 10)) {\n+\t\tcm.gainItem(1032061,-1);\n+\t\tcm.gainItem(1032101, 1);\n+\t\tcm.gainItem(4001198, -10);\n+\t    } else {\n+\t\tcm.sendOk(\"You either don't have Glittering Altair Earrings already or you do not have 10 Altair Fragments\");\n+\t    }\n+\t} else if (selection == 2) {\n+\t    if (cm.getPlayer().getParty() == null || !cm.isLeader()) {\n+\t\tcm.sendOk(\"The leader of the party must be here.\");\n+\t    } else {\n+\t\tvar party = cm.getPlayer().getParty().getMembers();\n+\t\tvar mapId = cm.getPlayer().getMapId();\n+\t\tvar next = true;\n+\t\tvar size = 0;\n+\t\tvar it = party.iterator();\n+\t\twhile (it.hasNext()) {\n+\t\t\tvar cPlayer = it.next();\n+\t\t\tvar ccPlayer = cm.getPlayer().getMap().getCharacterById(cPlayer.getId());\n+\t\t\tif (ccPlayer == null || ccPlayer.getLevel() < 70 || ccPlayer.getLevel() > 255) {\n+\t\t\t\tnext = false;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsize += (ccPlayer.isGM() ? 4 : 1);\n+\t\t}\t\n+\t\tif (next && size >= 2) {\n+\t\t\tvar em = cm.getEventManager(\"Ellin\");\n+\t\t\tif (em == null) {\n+\t\t\t\tcm.sendOk(\"Please try again later.\");\n+\t\t\t} else {\n+\t\t\t\tem.startInstance(cm.getPlayer().getParty(), cm.getPlayer().getMap(), 120);\n+\t\t\t}\n+\t\t} else {\n+\t\t\tcm.sendOk(\"All 2+ members of your party must be here and above level 70.\");\n+\t\t}\n+\t    }\n+\t}\n+\tcm.dispose();\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "aa0fe46249d6ed620d548a7f9a5a43b48819440f", "filename": "scripts/npc/world0/2133001.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,5 +1,9 @@\n var status = -1;\n \n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "a9f0e82e07f1952b0c0c3492a0a6de3fa7c67b42", "filename": "scripts/npc/world0/2133002.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133002.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,5 +1,9 @@\n var status = -1;\n \n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "a5133e59b84de650fe164f291f756ed626d24b6e", "filename": "scripts/npc/world0/2133004.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133004.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/npc/world0/2133004.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/npc/world0/2133004.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -1,5 +1,9 @@\n var status = -1;\n \n+function start() {\n+    action(1,0,0);\n+}\n+\n function action(mode, type, selection) {\n     if (mode == 1) {\n \tstatus++;"}, {"sha": "576f8302ca390a264c31a399d34325ddb66772ab", "filename": "scripts/portal/davy2_hd1.js", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy2_hd1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy2_hd1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy2_hd1.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,13 @@\n+var windowTime = 10 * 1000;\n+\n+function enter(pi) {\n+    var em = pi.getEventManager(\"PiratePQ\");\n+    var level = em.getProperty(\"level\");\n+    if(em.getProperty(\"stage2b\") == \"0\") {\n+        pi.getMap(925100202).spawnAllMonstersFromMapSpawnList(level, true);\n+        em.setProperty(\"stage2b\", \"1\");\n+    }\n+    \n+    pi.warp(925100202,0);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "480b4b2b1391c054807cdd4e3de131674a4ed1b2", "filename": "scripts/portal/davy3_hd1.js", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy3_hd1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy3_hd1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy3_hd1.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,13 @@\n+var windowTime = 10 * 1000;\n+\n+function enter(pi) {\n+    var em = pi.getEventManager(\"PiratePQ\");\n+    var level = em.getProperty(\"level\");\n+    if(em.getProperty(\"stage3b\") == \"0\") {\n+        pi.getMap(925100302).spawnAllMonstersFromMapSpawnList(level, true);\n+        em.setProperty(\"stage3b\", \"1\");\n+    }\n+    \n+    pi.warp(925100302,0);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "f3257a4a801e52278d8f3f391001d581c7149fa9", "filename": "scripts/portal/davy_next0.js", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next0.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next0.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy_next0.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -40,11 +40,10 @@ function enter(pi) {\n \t\teim.setProperty(\"entryTimeStamp\", 1000 * 60 * 6);\n \t\tfor(var g=0; g<party.size(); g++) {\n \t\t\tparty.get(g).changeMap(target, targetPortal);\n-\t\t\tparty.get(g).getClient().sendClock(party.get(g).getClient(), 300);\n \t\t}\n \t\treturn true;\n \t}else {\n-\t\tpi.getPlayer().dropMessage(6, \"Please kill all monsters before proceeding.\");\n+\t\tpi.getPlayer().dropMessage(6, \"You need to kill all monsters before proceeding.\");\n \t\treturn false;\n \t}\n }\n\\ No newline at end of file"}, {"sha": "1893a502cf54fd206b2ef856ca6d722c89855a2f", "filename": "scripts/portal/davy_next1.js", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next1.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next1.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy_next1.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,16 @@\n+function enter(pi) {\n+    try {\n+        var em = pi.getEventManager(\"PiratePQ\");\n+        if (em != null && em.getProperty(\"stage2\").equals(\"3\")) {\n+            pi.warp(925100200,0); //next\n+            return(true);\n+        } else {\n+            pi.playerMessage(5, \"The portal is not opened yet.\");\n+            return(false);\n+        }\n+    } catch(e) {\n+        pi.playerMessage(5, \"Error: \" + e);\n+    }\n+ \n+    return(false);\n+}\n\\ No newline at end of file"}, {"sha": "26c4e144841ded002ff8bb33c800a6b45efbabd6", "filename": "scripts/portal/davy_next2.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next2.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next2.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy_next2.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (pi.getMap().getMonsters().size() == 0) {\n+\tpi.warp(925100300,0); //next\n+        return(true);\n+    } else {\n+\tpi.playerMessage(5, \"The portal is not opened yet.\");\n+        return(false);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "45645f3e20744d2f2e52e9760214309c6c3a9b60", "filename": "scripts/portal/davy_next3.js", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next3.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next3.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy_next3.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,9 @@\n+function enter(pi) {\n+    if (pi.getMap().getMonsters().size() == 0) {\n+\tpi.warp(925100400,0); //next\n+        return(true);\n+    } else {\n+\tpi.playerMessage(5, \"The portal is not opened yet.\");\n+        return(false);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "7cd16651c92ad927d2c6fa8152297712cd4679fb", "filename": "scripts/portal/davy_next4.js", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next4.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/davy_next4.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/davy_next4.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,29 @@\n+importPackage(Packages.server.life);\n+\n+function enter(pi) {\n+    if (pi.getMap().getReactorByName(\"sMob1\").getState() >= 1 && pi.getMap().getReactorByName(\"sMob2\").getState() >= 1 && pi.getMap().getReactorByName(\"sMob3\").getState() >= 1 && pi.getMap().getReactorByName(\"sMob4\").getState() >= 1) {\n+\tif (pi.isLeader()) {\n+            var em = pi.getEventManager(\"PiratePQ\");\n+            \n+            var level = parseInt(em.getProperty(\"level\"));\n+            var chests = parseInt(em.getProperty(\"openedChests\"));\n+            var boss;                                               \n+            \n+            if(chests == 0) boss = MapleLifeFactory.getMonster(9300119);        //lord pirate\n+            else if(chests == 1) boss = MapleLifeFactory.getMonster(9300105);   //angry lord pirate\n+            else boss = MapleLifeFactory.getMonster(9300106);                   //enraged lord pirate\n+            \n+            boss.changeDifficulty(level, true);\n+            \n+            pi.getMap(925100500).spawnMonster(boss);\n+\t    pi.warpParty(925100500); //next\n+            return(true);\n+\t} else {\n+\t    pi.playerMessage(5, \"The leader must be here\");\n+            return(false);\n+\t}\n+    } else {\n+\tpi.playerMessage(5, \"The portal is not opened yet.\");\n+        return(false);\n+    }\n+}\n\\ No newline at end of file"}, {"sha": "fe16f833d60e102c14ef2a0ee61b748f4e7c938a", "filename": "scripts/portal/enterWarehouse.js", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/enterWarehouse.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/enterWarehouse.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/enterWarehouse.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,4 @@\n+function enter(pi) {\n+    pi.warp(300000011,0);\n+    return(true);\n+}\n\\ No newline at end of file"}, {"sha": "bf0deace1b4a5e7bffc0d7a65a38be9559c1d322", "filename": "scripts/portal/lpqboss.js", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/lpqboss.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/portal/lpqboss.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/portal/lpqboss.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -25,15 +25,16 @@ LudiPQ - 1 - 2 Portal\n \n function enter(pi) {\n \tvar nextMap = 922010900;\n-\tvar eim = pi.getPlayer().getEventInstance()\n+\tvar eim = pi.getPlayer().getEventInstance();\n \tvar target = eim.getMapInstance(nextMap);\n \tvar targetPortal = target.getPortal(\"st00\");\n \t// only let people through if the eim is ready\n \tvar avail = eim.getProperty(\"8stageclear\");\n \tif (avail == null) {\n \t\t// can't go thru eh?\n \t\tpi.getPlayer().dropMessage(5, \"Some seal is blocking this door.\");\n-\t\treturn false;\t}\n+\t\treturn false;\n+        }\n \telse {\n \t\tpi.getPlayer().changeMap(target, targetPortal);\n \t\treturn true;"}, {"sha": "9ea187c33230fdd356edabfa857342bdc32baed8", "filename": "scripts/reactor/2512001.js", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2512001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2512001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2512001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,33 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2512001.js\n+ *@Author Ronan\n+ *Pirate PQ Treasure chest\n+ */\n+ \n+function act() {\n+\tvar eim = rm.getPlayer().getEventInstance();\n+\tvar now = parseInt(eim.getProperty(\"openedChests\"));\n+\tvar nextNum = now + 1;\n+\teim.setProperty(\"openedChests\", nextNum);\n+\trm.dropItems(true, 1, 50, 100, 15);\n+}\n\\ No newline at end of file"}, {"sha": "6594d0d79772440bf66ca0e96605a9883846719f", "filename": "scripts/reactor/2519000.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519000.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519000.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2519000.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2519000.js - Reactor used at the door on stage 4.\n+ *@author Ronan\n+ */\n+ \n+function act() {\n+    rm.getPlayer().getMap().setAllowSpawnPointInRange(false, rm.getReactor().getPosition(), 120.0);\n+}"}, {"sha": "adeb312126ec1673830ab431d33b19cf8824c72a", "filename": "scripts/reactor/2519001.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519001.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519001.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2519001.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2519001.js - Reactor used at the door on stage 4.\n+ *@author Ronan\n+ */\n+ \n+function act() {\n+    rm.getPlayer().getMap().setAllowSpawnPointInRange(false, rm.getReactor().getPosition(), 120.0);\n+}"}, {"sha": "08f81b873fa5fdd11b752b1133ed6f20e570e72c", "filename": "scripts/reactor/2519002.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519002.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519002.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2519002.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2519002.js - Reactor used at the door on stage 4.\n+ *@author Ronan\n+ */\n+ \n+function act() {\n+    rm.getPlayer().getMap().setAllowSpawnPointInRange(false, rm.getReactor().getPosition(), 120.0);\n+}"}, {"sha": "c8f63018997a6ab6f63dfbab05f0ff7bc50f22e2", "filename": "scripts/reactor/2519003.js", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519003.js", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/scripts/reactor/2519003.js", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/scripts/reactor/2519003.js?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -0,0 +1,28 @@\n+/*\n+\tThis file is part of the OdinMS Maple Story Server\n+    Copyright (C) 2008 Patrick Huy <patrick.huy@frz.cc>\n+\t\t       Matthias Butz <matze@odinms.de>\n+\t\t       Jan Christian Meyer <vimes@odinms.de>\n+\n+    This program is free software: you can redistribute it and/or modify\n+    it under the terms of the GNU Affero General Public License as\n+    published by the Free Software Foundation version 3 as published by\n+    the Free Software Foundation. You may not use, modify or distribute\n+    this program under any other version of the GNU Affero General Public\n+    License.\n+\n+    This program is distributed in the hope that it will be useful,\n+    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+    GNU Affero General Public License for more details.\n+\n+    You should have received a copy of the GNU Affero General Public License\n+    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+*/\n+/*2519003.js - Reactor used at the door on stage 4.\n+ *@author Ronan\n+ */\n+ \n+function act() {\n+    rm.getPlayer().getMap().setAllowSpawnPointInRange(false, rm.getReactor().getPosition(), 120.0);\n+}"}, {"sha": "bc4cd0c7595ba4163b10201a7e8c2a6c0e536ff1", "filename": "sql/db_database.sql", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/sql/db_database.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/sql/db_database.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_database.sql?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -12786,8 +12786,8 @@ CREATE TABLE IF NOT EXISTS `drop_data_global` (\n ) ENGINE=InnoDB  DEFAULT CHARSET=latin1 ROW_FORMAT=DYNAMIC AUTO_INCREMENT=5 ;\n \n INSERT INTO `drop_data_global` (`id`, `continent`, `dropType`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`, `comments`) VALUES\n-(1, 0, 0, 4031865, 1, 1, 0, 125000, 'NX Card 100 PTS'),\n-(2, 0, 0, 4031866, 1, 1, 0, 78000, 'NX Card 250 PTS'),\n+(1, 0, 0, 4031865, 1, 1, 0, 40000, 'NX Card 100 PTS'),\n+(2, 0, 0, 4031866, 1, 1, 0, 25000, 'NX Card 250 PTS'),\n (3, 0, 0, 4001126, 1, 2, 0, 10000, 'Maple Leaves'),\n (4, 0, 0, 2049100, 1, 1, 0, 1500, 'Chaos Scroll 60%'),\n (5, 0, 0, 4001006, 1, 1, 0, 12000, 'Flaming Feather');"}, {"sha": "3ff5494f9ffce6fa705e31c54b87d121e2ee33af", "filename": "sql/db_drops.sql", "status": "modified", "additions": 47, "deletions": 7, "changes": 54, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/sql/db_drops.sql", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/sql/db_drops.sql", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/sql/db_drops.sql?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -18714,18 +18714,16 @@\n \n   #--------------------------------------------------------------------------------------------\n \n-  #insert things that should have been present already.\n+  #insert things that should be present by now, but aren't yet.\n \n   INSERT IGNORE INTO temp_data (`dropperid`, `itemid`, `minimum_quantity`, `maximum_quantity`, `questid`, `chance`) VALUES\n (2386010, 8143000, 1, 1, 0, 10000),\n (3230100, 4001004, 1, 1, 0, 5000),\n (3000002, 4000068, 1, 1, 0, 40000),\n (3000003, 4000068, 1, 1, 0, 40000),\n (3000004, 4000068, 1, 1, 0, 40000),\n-\n (8141000, 2386002, 1, 1, 0, 10000),\n (8141100, 2386009, 1, 1, 0, 10000),\n-\n (4230116, 2382042, 1, 1, 0, 10000),\n (4230117, 2382055, 1, 1, 0, 10000),\n (4230118, 2382067, 1, 1, 0, 10000),\n@@ -18772,7 +18770,31 @@\n (9500320, 2388027, 1, 1, 0, 8000),\n (8220002, 2388032, 1, 1, 0, 8000),\n (9300182, 2388039, 1, 1, 0, 8000),\n-(6130204, 0, 316, 478, 0, 400000);\n+(6130204, 0, 316, 478, 0, 400000),\n+(9300114, 4001120, 1, 1, 0, 200000),\n+(9300115, 4001121, 1, 1, 0, 200000),\n+(9300116, 4001122, 1, 1, 0, 200000),\n+(9300120, 4001117, 1, 1, 0, 80000),\n+(9300121, 4001117, 1, 1, 0, 80000),\n+(9300122, 4001117, 1, 1, 0, 80000),\n+(9300126, 4001117, 1, 1, 0, 80000),\n+(9300124, 2022131, 1, 1, 0, 40000),\n+(9300125, 2022131, 1, 1, 0, 40000),\n+(9300124, 2022132, 1, 1, 0, 40000),\n+(9300125, 2022132, 1, 1, 0, 40000),\n+(9300105, 4031437, 1, 1, 0, 40000),\n+(9300106, 4031437, 1, 1, 0, 40000),\n+(9300107, 4031437, 1, 1, 0, 40000),\n+(9300119, 4031437, 1, 1, 0, 40000),\n+(9300105, 4031438, 1, 1, 3829, 40000),\n+(9300106, 4031438, 1, 1, 3829, 40000),\n+(9300107, 4031438, 1, 1, 3829, 40000),\n+(9300119, 4031438, 1, 1, 3829, 40000),\n+(9300105, 4031551, 1, 1, 3829, 40000),\n+(9300106, 4031551, 1, 1, 3829, 40000),\n+(9300107, 4031551, 1, 1, 3829, 40000),\n+(9300119, 4031551, 1, 1, 3829, 40000);\n+\n \n # (dropperid, itemid, minqty, maxqty, questid, chance)\n \n@@ -18869,9 +18891,27 @@\n     (9102001, 4031158, 1, 2074),\n     (2502001, 2022116, 1, -1),\n     (2612000, 4031695, 1, 3335),\n-    (2402000, 2022087, 3, -1);\n+    (2402000, 2022087, 3, -1),\n     (2402001, 2022088, 1, -1),\n-    (2402001, 2022086, 1, -1);\n-\n+    (2402001, 2022086, 1, -1),\n+    (2512001, 4010004, 1, -1),\n+    (2512001, 4010005, 1, -1),\n+    (2512001, 4010006, 1, -1),\n+    (2512001, 4010007, 1, -1),\n+    (2512001, 4020007, 1, -1),\n+    (2512001, 4020008, 1, -1),\n+    (2512001, 4010004, 1, -1),\n+    (2512001, 4010005, 1, -1),\n+    (2512001, 4010006, 1, -1),\n+    (2512001, 4010007, 1, -1),\n+    (2512001, 4020007, 1, -1),\n+    (2512001, 4020008, 1, -1),\n+    (2512001, 2020000, 3, -1),\n+    (2512001, 2020001, 3, -1),\n+    (2512001, 2020003, 3, -1),\n+    (2512001, 2020004, 3, -1),\n+    (2512001, 2020009, 3, -1),\n+    (2512001, 2020010, 3, -1),\n+    (2512001, 2020028, 1, -1);\n \n   #global data already updated\n\\ No newline at end of file"}, {"sha": "6030f596d0c88015f70186dce191a7d85121f4df", "filename": "src/constants/ServerConstants.java", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/constants/ServerConstants.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/constants/ServerConstants.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/constants/ServerConstants.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -24,6 +24,7 @@\n     public static boolean JAVA_8;\n     public static boolean SHUTDOWNHOOK;\n     //Gameplay Configurations\n+    public static final boolean USE_MAXRANGE = true;            //will send and receive packets from all events of a map.\n     public static final boolean USE_DEBUG = true;\n     public static final boolean USE_MTS = false;\n     public static final boolean USE_FAMILY_SYSTEM = false;"}, {"sha": "0d1fe04c855c1105fec308216ba3ee5c2fdbd0c9", "filename": "src/net/server/channel/handlers/TakeDamageHandler.java", "status": "modified", "additions": 37, "deletions": 29, "changes": 66, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/net/server/channel/handlers/TakeDamageHandler.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/net/server/channel/handlers/TakeDamageHandler.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/net/server/channel/handlers/TakeDamageHandler.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -49,6 +49,7 @@\n import server.life.MobSkill;\n import server.life.MobSkillFactory;\n import server.maps.MapleMap;\n+import tools.FilePrinter;\n import tools.MaplePacketCreator;\n import tools.Randomizer;\n import tools.data.input.SeekableLittleEndianAccessor;\n@@ -69,42 +70,49 @@ public final void handlePacket(SeekableLittleEndianAccessor slea, MapleClient c)\n         MapleMonster attacker = null;\n         final MapleMap map = player.getMap();\n         if (damagefrom != -3 && damagefrom != -4) {\n-        \tmonsteridfrom = slea.readInt();\n-\t        oid = slea.readInt();\n-            attacker = (MapleMonster) map.getMapObject(oid);\n-            List<loseItem> loseItems;\n-            if (attacker != null) {\n-                if (attacker.isBuffed(MonsterStatus.NEUTRALISE)) {\n-                    return;\n-                }\n-                if (damage > 0) {\n-                    loseItems = map.getMonsterById(monsteridfrom).getStats().loseItem();\n-                    if (loseItems != null) {\n-                        MapleInventoryType type;\n-                        final int playerpos = player.getPosition().x;\n-                        byte d = 1;\n-                        Point pos = new Point(0, player.getPosition().y);\n-                        for (loseItem loseItem : loseItems) {\n-                            type = MapleItemInformationProvider.getInstance().getInventoryType(loseItem.getId());\n-                            for (byte b = 0; b < loseItem.getX(); b++) {//LOL?\n-                                if (Randomizer.nextInt(101) >= loseItem.getChance()) {\n-                                    if (player.haveItem(loseItem.getId())) {\n-                                        pos.x = (int) (playerpos + ((d % 2 == 0) ? (25 * (d + 1) / 2) : -(25 * (d / 2))));\n-                                        MapleInventoryManipulator.removeById(c, type, loseItem.getId(), 1, false, false);\n-                                        map.spawnItemDrop(c.getPlayer(), c.getPlayer(), new Item(loseItem.getId(), (short) 0, (short) 1), map.calcDropPos(pos, player.getPosition()), true, true);\n-                                        d++;\n-                                    } else {\n-                                        break;\n+            monsteridfrom = slea.readInt();\n+\t    oid = slea.readInt();\n+            \n+            try {\n+                attacker = (MapleMonster) map.getMapObject(oid);\n+                List<loseItem> loseItems;\n+                if (attacker != null) {\n+                    if (attacker.isBuffed(MonsterStatus.NEUTRALISE)) {\n+                        return;\n+                    }\n+                    if (damage > 0) {\n+                        loseItems = map.getMonsterById(monsteridfrom).getStats().loseItem();\n+                        if (loseItems != null) {\n+                            MapleInventoryType type;\n+                            final int playerpos = player.getPosition().x;\n+                            byte d = 1;\n+                            Point pos = new Point(0, player.getPosition().y);\n+                            for (loseItem loseItem : loseItems) {\n+                                type = MapleItemInformationProvider.getInstance().getInventoryType(loseItem.getId());\n+                                for (byte b = 0; b < loseItem.getX(); b++) {//LOL?\n+                                    if (Randomizer.nextInt(101) >= loseItem.getChance()) {\n+                                        if (player.haveItem(loseItem.getId())) {\n+                                            pos.x = (int) (playerpos + ((d % 2 == 0) ? (25 * (d + 1) / 2) : -(25 * (d / 2))));\n+                                            MapleInventoryManipulator.removeById(c, type, loseItem.getId(), 1, false, false);\n+                                            map.spawnItemDrop(c.getPlayer(), c.getPlayer(), new Item(loseItem.getId(), (short) 0, (short) 1), map.calcDropPos(pos, player.getPosition()), true, true);\n+                                            d++;\n+                                        } else {\n+                                            break;\n+                                        }\n                                     }\n                                 }\n                             }\n+                            map.removeMapObject(attacker);\n                         }\n-                        map.removeMapObject(attacker);\n                     }\n+                } else {\n+                    return;\n                 }\n-            } else {\n-                return;\n+            } catch(ClassCastException e) {\n+                e.printStackTrace();\n+                FilePrinter.print(FilePrinter.EXCEPTION_CAUGHT, \"Attacker is not a mob-type, rather is a \" + map.getMapObject(oid).getClass().getName() + \" entity.\");\n             }\n+            \n             direction = slea.readByte();\n         }\n         if (damagefrom != -1 && damagefrom != -2 && attacker != null) {"}, {"sha": "583ffea415630766d1cd788e83c14c8d1b174513", "filename": "src/scripting/AbstractPlayerInteraction.java", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/AbstractPlayerInteraction.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/AbstractPlayerInteraction.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/AbstractPlayerInteraction.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -87,6 +87,10 @@ public MapleCharacter getPlayer() {\n         public MapleCharacter getChar() {\n \t\treturn c.getPlayer();\n \t}\n+        \n+        public MapleMap getMap() {\n+                return c.getPlayer().getMap();\n+        }\n \n \tpublic void warp(int map) {\n \t\tgetPlayer().changeMap(getWarpMap(map), getWarpMap(map).getPortal(0));\n@@ -142,6 +146,14 @@ public MapleMap getMap(int map) {\n \t\treturn getWarpMap(map);\n \t}\n         \n+        public int countAllMonstersOnMap(int map) {\n+                return getMap(map).countAllMonsters();\n+        }\n+        \n+        public int countMonster() {\n+            return getPlayer().getMap().countAllMonsters();\n+        }\n+        \n         public void resetMapObjects(int mapid) {\n                 getWarpMap(mapid).resetMapObjects();\n         }\n@@ -651,10 +663,6 @@ public void resetMap(int mapid) {\n \t\t}\n \t}\n \n-\tpublic void sendClock(MapleClient d, int time) {\n-\t\td.announce(MaplePacketCreator.getClock((int) (time - System.currentTimeMillis()) / 1000));\n-\t}\n-\n \tpublic void useItem(int id) {\n \t\tMapleItemInformationProvider.getInstance().getItemEffect(id).applyTo(c.getPlayer());\n \t\tc.announce(MaplePacketCreator.getItemMessage(id));//Useful shet :3"}, {"sha": "9360091b5198e739fb54b14b1cfba8da0cf848ee", "filename": "src/scripting/event/EventInstanceManager.java", "status": "modified", "additions": 21, "deletions": 21, "changes": 42, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/event/EventInstanceManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/event/EventInstanceManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventInstanceManager.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -256,27 +256,27 @@ public int getKillCount(MapleCharacter chr) {\n \t}\n \n \tpublic void dispose() {\n-        try {\n-            em.getIv().invokeFunction(\"dispose\", this);\n-        } catch (ScriptException | NoSuchMethodException ex) {\n-            ex.printStackTrace();\n-        }\n-        \n-        wL.lock();\n-        try {\n-            chars.clear();\n-        } finally {\n-            wL.unlock();\n-        }\n-        \n-        mobs.clear();\n-        killCount.clear();\n-        mapFactory = null;\n-        if (expedition != null) {\n-                em.getChannelServer().getExpeditions().remove(expedition);\n-        }\n-        em.disposeInstance(name);\n-        em = null;\n+            try {\n+                em.getIv().invokeFunction(\"dispose\", this);\n+            } catch (ScriptException | NoSuchMethodException ex) {\n+                ex.printStackTrace();\n+            }\n+\n+            wL.lock();\n+            try {\n+                chars.clear();\n+            } finally {\n+                wL.unlock();\n+            }\n+\n+            mobs.clear();\n+            killCount.clear();\n+            mapFactory = null;\n+            if (expedition != null) {\n+                    em.getChannelServer().getExpeditions().remove(expedition);\n+            }\n+            em.disposeInstance(name);\n+            em = null;\n \t}\n \n \tpublic MapleMapFactory getMapFactory() {"}, {"sha": "d16dba4c57e4d01c1ac35d070652e95451608113", "filename": "src/scripting/event/EventManager.java", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/event/EventManager.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/scripting/event/EventManager.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/scripting/event/EventManager.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -38,6 +38,9 @@\n import server.TimerManager;\n import server.expeditions.MapleExpedition;\n import server.maps.MapleMap;\n+import server.life.MapleMonster;\n+import server.life.MapleLifeFactory;\n+\n import client.MapleCharacter;\n \n /**\n@@ -194,4 +197,8 @@ public void startInstance(EventInstanceManager eim, String leader) {\n             Logger.getLogger(EventManager.class.getName()).log(Level.SEVERE, null, ex);\n         }\n     }\n+    \n+    public MapleMonster getMonster(int mid) {\n+        return(MapleLifeFactory.getMonster(mid));\n+    }\n }"}, {"sha": "f2838649217f48f662db59de5c34e8c8325ed418", "filename": "src/server/life/MapleMonster.java", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/life/MapleMonster.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/life/MapleMonster.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/life/MapleMonster.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -82,7 +82,7 @@\n     private int team;\n     private final HashMap<Integer, AtomicInteger> takenDamage = new HashMap<>();\n \n-    public ReentrantLock monsterLock = new ReentrantLock();\n+    private ReentrantLock monsterLock = new ReentrantLock();\n \n     public MapleMonster(int id, MapleMonsterStats stats) {\n         super(id);\n@@ -93,6 +93,14 @@ public MapleMonster(MapleMonster monster) {\n         super(monster);\n         initWithStats(monster.stats);\n     }\n+    \n+    public void lockMonster() {\n+        monsterLock.lock();\n+    }\n+    \n+    public void unlockMonster() {\n+        monsterLock.unlock();\n+    }\n \n     private void initWithStats(MapleMonsterStats stats) {\n         setStance(5);\n@@ -994,7 +1002,7 @@ private float getDifficultyRate(final int difficulty) {\n         return(1.0f);\n     }\n     \n-    public final void changeLevelByDifficulty(final int difficulty, boolean pqMob) {\n+    private final void changeLevelByDifficulty(final int difficulty, boolean pqMob) {\n         changeLevel((int)(this.getLevel() * getDifficultyRate(difficulty)), pqMob);\n     }\n     "}, {"sha": "cf85327c1dd95fcb763d64719ec6aba3b8580f3a", "filename": "src/server/maps/MapleMap.java", "status": "modified", "additions": 102, "deletions": 29, "changes": 131, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleMap.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleMap.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMap.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -32,6 +32,7 @@\n import client.status.MonsterStatus;\n import client.status.MonsterStatusEffect;\n import constants.ItemConstants;\n+import constants.ServerConstants;\n import java.awt.Point;\n import java.awt.Rectangle;\n import java.util.ArrayList;\n@@ -181,6 +182,11 @@ public void broadcastGMMessage(MapleCharacter source, final byte[] packet) {\n     public void toggleDrops() {\n         this.dropsOn = !dropsOn;\n     }\n+    \n+    \n+    private double getRangedDistance() {\n+        return(ServerConstants.USE_MAXRANGE ? Double.POSITIVE_INFINITY : 722500);\n+    }\n \n     public List<MapleMapObject> getMapObjectsInRect(Rectangle box, List<MapleMapObjectType> types) {\n         objectRLock.lock();\n@@ -295,6 +301,25 @@ private void spawnAndAddRangedMapObject(MapleMapObject mapobject, DelayedPacketC\n             objectWLock.unlock();\n         }\n     }\n+    \n+    private void spawnRangedMapObject(MapleMapObject mapobject, DelayedPacketCreation packetbakery, SpawnCondition condition) {\n+        chrRLock.lock();\n+        \n+        try {\n+            int curOID = getUsableOID();\n+            mapobject.setObjectId(curOID);\n+            for (MapleCharacter chr : characters) {\n+                if (condition == null || condition.canSpawn(chr)) {\n+                    if (chr.getPosition().distanceSq(mapobject.getPosition()) <= 722500) {\n+                        packetbakery.sendPackets(chr.getClient());\n+                        chr.addVisibleMapObject(mapobject);\n+                    }\n+                }\n+            }\n+        } finally {\n+            chrRLock.unlock();\n+        }\n+    }\n \n     private int getUsableOID() {\n         if (runningOid.incrementAndGet() > 2000000000) {\n@@ -485,6 +510,10 @@ public int countMonster(int id) {\n         }\n         return count;\n     }\n+    \n+    public int countAllMonsters() {\n+        return getMapObjectsInRange(new Point(0, 0), Double.POSITIVE_INFINITY, Arrays.asList(MapleMapObjectType.MONSTER)).size();\n+    }\n \n     public boolean damageMonster(final MapleCharacter chr, final MapleMonster monster, final int damage) {\n         if (monster.getId() == 8800000) {\n@@ -499,7 +528,7 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n         }\n         if (monster.isAlive()) {\n             boolean killed = false;\n-            monster.monsterLock.lock();\n+            monster.lockMonster();\n             try {\n                 if (!monster.isAlive()) {\n                     return false;\n@@ -542,7 +571,7 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n                     }\n                 }\n             } finally {\n-                monster.monsterLock.unlock();\n+                monster.unlockMonster();\n             }\n             if (monster.getStats().selfDestruction() != null && monster.getStats().selfDestruction().getHp() > -1) {// should work ;p\n                 if (monster.getHp() <= monster.getStats().selfDestruction().getHp()) {\n@@ -561,7 +590,7 @@ public boolean damageMonster(final MapleCharacter chr, final MapleMonster monste\n     public List<MapleMonster> getMonsters() {\n         List<MapleMonster> mobs = new ArrayList<MapleMonster>();\n         for (MapleMapObject object : this.getMapObjects()) {\n-            mobs.add(this.getMonsterByOid(object.getObjectId()));\n+            if(object instanceof MapleMonster) mobs.add((MapleMonster)object);\n         }\n         return mobs;\n     }\n@@ -584,8 +613,10 @@ public void run() {\n         if (chr == null) {\n             spawnedMonstersOnMap.decrementAndGet();\n             monster.setHp(0);\n-            broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n             removeMapObject(monster);\n+            monster.dispatchMonsterKilled();\n+            broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n+            //System.out.println(\"Counter: \" + spawnedMonstersOnMap.toString() + \" Size: \" + countAllMonsters());\n             return;\n         }\n         if (monster.getStats().getLevel() >= chr.getLevel() + 30 && !chr.isGM()) {\n@@ -619,7 +650,6 @@ public void run() {\n         }\n         spawnedMonstersOnMap.decrementAndGet();\n         monster.setHp(0);\n-        broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n         //if (monster.getStats().selfDestruction() == null) {//FUU BOMBS D:\n         removeMapObject(monster);\n         //}\n@@ -663,6 +693,8 @@ public void run() {\n         }\n         \n         monster.dispatchMonsterKilled();\n+        broadcastMessage(MaplePacketCreator.killMonster(monster.getObjectId(), animation), monster.getPosition());\n+        //System.out.println(\"Counter: \" + spawnedMonstersOnMap.toString() + \" Size: \" + countAllMonsters());\n     }\n \n     public void killFriendlies(MapleMonster mob) {\n@@ -834,7 +866,7 @@ public MapleReactor getReactorById(int Id) {\n      * @param monster\n      */\n     public void updateMonsterController(MapleMonster monster) {\n-        monster.monsterLock.lock();\n+        monster.lockMonster();\n         try {\n             if (!monster.isAlive()) {\n                 return;\n@@ -869,7 +901,7 @@ public void updateMonsterController(MapleMonster monster) {\n                 }\n             }\n         } finally {\n-            monster.monsterLock.unlock();\n+            monster.unlockMonster();\n         }\n     }\n \n@@ -920,21 +952,12 @@ public MapleMapObject getMapObject(int oid) {\n      */\n     public MapleMonster getMonsterByOid(int oid) {\n         MapleMapObject mmo = getMapObject(oid);\n-        if (mmo == null) {\n-            return null;\n-        }\n-        if (mmo.getType() == MapleMapObjectType.MONSTER) {\n-            return (MapleMonster) mmo;\n-        }\n-        return null;\n+        return (mmo != null && mmo.getType() == MapleMapObjectType.MONSTER) ? (MapleMonster) mmo : null;\n     }\n \n     public MapleReactor getReactorByOid(int oid) {\n         MapleMapObject mmo = getMapObject(oid);\n-        if (mmo == null) {\n-            return null;\n-        }\n-        return mmo.getType() == MapleMapObjectType.REACTOR ? (MapleReactor) mmo : null;\n+        return (mmo != null && mmo.getType() == MapleMapObjectType.REACTOR) ? (MapleReactor) mmo : null;\n     }\n \n     public MapleReactor getReactorByName(String name) {\n@@ -1031,12 +1054,43 @@ public void sendPackets(MapleClient c) {\n         updateMonsterController(monster);\n         spawnedMonstersOnMap.incrementAndGet();\n     }\n+    \n+    public void spawnAllMonsterIdFromMapSpawnList(int id) {\n+        spawnAllMonsterIdFromMapSpawnList(id, 1, false);\n+    }\n+    \n+    public void spawnAllMonsterIdFromMapSpawnList(int id, int difficulty, boolean isPq) {\n+        for(SpawnPoint sp: allMonsterSpawn) {\n+            MapleMonster mm = sp.getMonster();\n+            \n+            if(mm.getId() == id) {\n+                spawnMonster(mm, difficulty, isPq);\n+            }\n+        }\n+    }\n+    \n+    public void spawnAllMonstersFromMapSpawnList() {\n+        spawnAllMonstersFromMapSpawnList(1, false);\n+    }\n+    \n+    public void spawnAllMonstersFromMapSpawnList(int difficulty, boolean isPq) {\n+        for(SpawnPoint sp: allMonsterSpawn) {\n+            MapleMonster mm = sp.getMonster();\n+            spawnMonster(mm, difficulty, isPq);\n+        }\n+    }\n \n     public void spawnMonster(final MapleMonster monster) {\n+        spawnMonster(monster, 1, false);\n+    }\n+    \n+    public void spawnMonster(final MapleMonster monster, int difficulty, boolean isPq) {\n         if (mobCapacity != -1 && mobCapacity == spawnedMonstersOnMap.get()) {\n-            System.out.println(\"got here\");\n             return;//PyPQ\n         }\n+        \n+        monster.changeDifficulty(difficulty, isPq);\n+        \n         monster.setMap(this);\n         if (!monster.getMap().getAllPlayer().isEmpty()) {\n             MapleCharacter chr = (MapleCharacter) getAllPlayer().get(0);\n@@ -1051,6 +1105,7 @@ public void sendPackets(MapleClient c) {\n                 c.announce(MaplePacketCreator.spawnMonster(monster, true));\n             }\n         }, null);\n+        \n         updateMonsterController(monster);\n \n         if (monster.getDropPeriodTime() > 0) { //9300102 - Watchhog, 9300061 - Moon Bunny (HPQ), 9300093 - Tylus\n@@ -1433,6 +1488,7 @@ public void run() {\n         }\n \n         sendObjectPlacement(chr.getClient());\n+        \n         if (isStartingEventMap() && !eventStarted()) {\n             chr.getMap().getPortal(\"join00\").setPortalStatus(false);\n         }\n@@ -1507,6 +1563,7 @@ public void run() {\n             if(hasBoat() == 1) chr.getClient().announce((MaplePacketCreator.boatPacket(true)));\n             else chr.getClient().announce(MaplePacketCreator.boatPacket(false));\n         }\n+        \n         chr.receivePartyMemberHP();\n     }\n \n@@ -1611,7 +1668,7 @@ public void broadcastMessage(MapleCharacter source, final byte[] packet, boolean\n      * @param rangedFrom\n      */\n     public void broadcastMessage(final byte[] packet, Point rangedFrom) {\n-        broadcastMessage(null, packet, 722500, rangedFrom);\n+        broadcastMessage(null, packet, getRangedDistance(), rangedFrom);\n     }\n \n     /**\n@@ -1622,7 +1679,7 @@ public void broadcastMessage(final byte[] packet, Point rangedFrom) {\n      * @param rangedFrom\n      */\n     public void broadcastMessage(MapleCharacter source, final byte[] packet, Point rangedFrom) {\n-        broadcastMessage(source, packet, 722500, rangedFrom);\n+        broadcastMessage(source, packet, getRangedDistance(), rangedFrom);\n     }\n \n     private void broadcastMessage(MapleCharacter source, final byte[] packet, double rangeSq, Point rangedFrom) {\n@@ -1687,7 +1744,7 @@ private void sendObjectPlacement(MapleClient mapleClient) {\n             objectRLock.unlock();\n         }\n         if (chr != null) {\n-            for (MapleMapObject o : getMapObjectsInRange(chr.getPosition(), 722500, rangedMapobjectTypes)) {\n+            for (MapleMapObject o : getMapObjectsInRange(chr.getPosition(), getRangedDistance(), rangedMapobjectTypes)) {\n                 if (o.getType() == MapleMapObjectType.REACTOR) {\n                     if (((MapleReactor) o).isAlive()) {\n                         o.sendSpawnData(chr.getClient());\n@@ -1865,7 +1922,7 @@ public void movePlayer(MapleCharacter player, Point newPosition) {\n             objectRLock.unlock();\n         }\n         \n-        for (MapleMapObject mo : getMapObjectsInRange(player.getPosition(), 722500, rangedMapobjectTypes)) {\n+        for (MapleMapObject mo : getMapObjectsInRange(player.getPosition(), getRangedDistance(), rangedMapobjectTypes)) {\n             if (!player.isMapObjectVisible(mo)) {\n                 mo.sendSpawnData(player.getClient());\n                 player.addVisibleMapObject(mo);\n@@ -2055,8 +2112,6 @@ public void instanceMapFirstSpawn(int difficulty, boolean isPq) {\n         for(SpawnPoint spawnPoint: allMonsterSpawn) {\n             if(spawnPoint.getMobTime() == -1) {   //just those allowed to be spawned only once\n                 MapleMonster monst = spawnPoint.getMonster();\n-                monst.changeLevelByDifficulty(difficulty, isPq);\n-                \n                 spawnMonster(monst);\n             }\n         }\n@@ -2069,10 +2124,12 @@ public void instanceMapRespawn() {\n             Collections.shuffle(randomSpawn);\n             int spawned = 0;\n             for (SpawnPoint spawnPoint : randomSpawn) {\n-                spawnMonster(spawnPoint.getMonster());\n-                spawned++;\n-                if (spawned >= numShouldSpawn) {\n-                    break;\n+                if(spawnPoint.shouldSpawn()) {\n+                    spawnMonster(spawnPoint.getMonster());\n+                    spawned++;\n+                    if (spawned >= numShouldSpawn) {\n+                        break;\n+                    }\n                 }\n             }\n         }\n@@ -2083,6 +2140,22 @@ public void restoreMapSpawnPoints() {\n             spawnPoint.setDenySpawn(false);\n         }\n     }\n+    \n+    public void setAllowSpawnPointInBox(boolean allow, Rectangle box) {\n+        for(SpawnPoint sp: monsterSpawn)  {\n+            if(box.contains(sp.getPosition())) {\n+                sp.setDenySpawn(!allow);\n+            }\n+        }\n+    }\n+    \n+    public void setAllowSpawnPointInRange(boolean allow, Point from, double rangeSq) {\n+        for(SpawnPoint sp: monsterSpawn)  {\n+            if(from.distanceSq(sp.getPosition()) <= rangeSq) {\n+                sp.setDenySpawn(!allow);\n+            }\n+        }\n+    }\n \n     public void respawn() {\n         chrRLock.lock();"}, {"sha": "2adf05578795d60eb0e58e48f6f959f623c68e88", "filename": "src/server/maps/MapleMapFactory.java", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleMapFactory.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleMapFactory.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleMapFactory.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -279,14 +279,20 @@ private String getMapStringName(int mapid) {\n             builder.append(\"victoria\");\n         } else if (mapid >= 200000000 && mapid < 300000000) {\n             builder.append(\"ossyria\");\n+        } else if (mapid >= 300000000 && mapid < 400000000) {\n+            builder.append(\"elin\");\n         } else if (mapid >= 540000000 && mapid < 560000000) {\n             builder.append(\"singapore\");\n         } else if (mapid >= 600000000 && mapid < 620000000) {\n             builder.append(\"MasteriaGL\");\n-        } else if (mapid >= 670000000 && mapid < 682000000) {\n+        } else if (mapid >= 677000000 && mapid < 677100000) {\n+            builder.append(\"Episode1GL\");\n+        } else if (mapid >= 670000000 && mapid < 690000000) {\n             builder.append(\"weddingGL\");\n         } else if (mapid >= 682000000 && mapid < 683000000) {\n             builder.append(\"HalloweenGL\");\n+        } else if (mapid >= 683000000 && mapid < 684000000) {\n+            builder.append(\"event\");\n         } else if (mapid >= 800000000 && mapid < 900000000) {\n             builder.append(\"jp\");\n         } else {"}, {"sha": "febc21dd7c476ac73dcafc969b86f96f7f8abb5b", "filename": "src/server/maps/MapleReactor.java", "status": "modified", "additions": 48, "deletions": 48, "changes": 96, "blob_url": "https://github.com/ronancpl/HeavenMS/blob/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleReactor.java", "raw_url": "https://github.com/ronancpl/HeavenMS/raw/6791a3d47567a59d7d02803ae82d8ade3a948987/src/server/maps/MapleReactor.java", "contents_url": "https://api.github.com/repos/ronancpl/HeavenMS/contents/src/server/maps/MapleReactor.java?ref=6791a3d47567a59d7d02803ae82d8ade3a948987", "patch": "@@ -127,11 +127,11 @@ public void sendSpawnData(MapleClient client) {\n         return MaplePacketCreator.spawnReactor(this);\n     }\n \n-\tpublic void forceHitReactor(final byte newState) {\n-\t\tsetState((byte) newState);\n-\t\tsetTimerActive(false);\n-\t\tmap.broadcastMessage(MaplePacketCreator.triggerReactor(this, (short) 0));\n-\t}\n+    public void forceHitReactor(final byte newState) {\n+        setState((byte) newState);\n+        setTimerActive(false);\n+        map.broadcastMessage(MaplePacketCreator.triggerReactor(this, (short) 0));\n+    }\n     \n     public void delayedHitReactor(final MapleClient c, long delay) {\n         TimerManager.getInstance().schedule(new Runnable() {\n@@ -147,49 +147,49 @@ public void hitReactor(MapleClient c) {\n     }\n \n     public synchronized void hitReactor(int charPos, short stance, int skillid, MapleClient c) {\n-        try {\n-\t\t\tif(!this.isAlive()) {\n-\t\t\t\treturn;\n-\t\t\t}\n-                        if(ServerConstants.USE_DEBUG == true) c.getPlayer().dropMessage(5, \"Hitted REACTOR \" + this.getId() + \" with POS \" + charPos + \" , STANCE \" + stance + \" , SkillID \" + skillid);\n-\t\t\tif (stats.getType(state) < 999 && stats.getType(state) != -1) {//type 2 = only hit from right (kerning swamp plants), 00 is air left 02 is ground left\n-                            if (!(stats.getType(state) == 2 && (stance == 0 || stance == 2))) { //get next state\t\n-\t\t\t\t\tfor (byte b = 0; b < stats.getStateSize(state); b++) {//YAY?\n-\t\t\t\t\t\tList<Integer> activeSkills = stats.getActiveSkills(state, b);\n-\t\t\t\t\t\tif (activeSkills != null) {\n-\t\t\t\t\t\t\tif (!activeSkills.contains(skillid)) continue;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tstate = stats.getNextState(state, b);\n-\t\t\t\t\t\tif (stats.getNextState(state, b) == -1) {//end of reactor\n-\t\t\t\t\t\t\tif (stats.getType(state) < 100) {//reactor broken\n-\t\t\t\t\t\t\t\tif (delay > 0) {\n-\t\t\t\t\t\t\t\t\tmap.destroyReactor(getObjectId());\n-\t\t\t\t\t\t\t\t} else {//trigger as normal\n-\t\t\t\t\t\t\t\t\tmap.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t} else {//item-triggered on final step\n-\t\t\t\t\t\t\t\tmap.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n-\t\t\t\t\t\t\t}\n-                                                        \n-                                                        if(ServerConstants.USE_DEBUG == true) c.getPlayer().dropMessage(5, \"REACTOR \" + this.getId() + \" activated\");\n-\t\t\t\t\t\t\tReactorScriptManager.getInstance().act(c, this);\n-\t\t\t\t\t\t} else { //reactor not broken yet\n-\t\t\t\t\t\t\tmap.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n-\t\t\t\t\t\t\tif (state == stats.getNextState(state, b)) {//current state = next state, looping reactor\n-\t\t\t\t\t\t\t\tReactorScriptManager.getInstance().act(c, this);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tbreak;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\tstate++;\n-\t\t\t\tmap.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n-\t\t\t\tReactorScriptManager.getInstance().act(c, this);\n-\t\t\t}\n-\t\t} catch(Exception e) {\n-\t\t\te.printStackTrace();\n-\t\t}\n+            try {\n+                    if(!this.isAlive()) {\n+                            return;\n+                    }\n+                    if(ServerConstants.USE_DEBUG == true) c.getPlayer().dropMessage(5, \"Hitted REACTOR \" + this.getId() + \" with POS \" + charPos + \" , STANCE \" + stance + \" , SkillID \" + skillid);\n+                    if (stats.getType(state) < 999 && stats.getType(state) != -1) {//type 2 = only hit from right (kerning swamp plants), 00 is air left 02 is ground left\n+                        if (!(stats.getType(state) == 2 && (stance == 0 || stance == 2))) { //get next state\t\n+                                    for (byte b = 0; b < stats.getStateSize(state); b++) {//YAY?\n+                                            List<Integer> activeSkills = stats.getActiveSkills(state, b);\n+                                            if (activeSkills != null) {\n+                                                    if (!activeSkills.contains(skillid)) continue;\n+                                            }\n+                                            state = stats.getNextState(state, b);\n+                                            if (stats.getNextState(state, b) == -1) {//end of reactor\n+                                                    if (stats.getType(state) < 100) {//reactor broken\n+                                                            if (delay > 0) {\n+                                                                    map.destroyReactor(getObjectId());\n+                                                            } else {//trigger as normal\n+                                                                    map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n+                                                            }\n+                                                    } else {//item-triggered on final step\n+                                                            map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n+                                                    }\n+\n+                                                    if(ServerConstants.USE_DEBUG == true) c.getPlayer().dropMessage(5, \"REACTOR \" + this.getId() + \" activated\");\n+                                                    ReactorScriptManager.getInstance().act(c, this);\n+                                            } else { //reactor not broken yet\n+                                                    map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n+                                                    if (state == stats.getNextState(state, b)) {//current state = next state, looping reactor\n+                                                            ReactorScriptManager.getInstance().act(c, this);\n+                                                    }\n+                                            }\n+                                            break;\n+                                    }\n+                            }\n+                    } else {\n+                            state++;\n+                            map.broadcastMessage(MaplePacketCreator.triggerReactor(this, stance));\n+                            ReactorScriptManager.getInstance().act(c, this);\n+                    }\n+            } catch(Exception e) {\n+                    e.printStackTrace();\n+            }\n     }\n \n     public Rectangle getArea() {"}]}]},
